import{Z as e}from"../index.js";import"node:process";import"events";import"buffer";import"string_decoder";import"path";import"node:crypto";import"http";import"crypto";import"url";import"timers/promises";import"fs";import"tty";import"os";import"util";import"stream";import"node:http";import"node:net";import"querystring";import"node:path";import"node:fs";import"node:zlib";import"node:events";import"node:buffer";import"node:url";import"node:util";import"node:child_process";import"node:fs/promises";import"node:os";import"zlib";import"https";import"net";import"tls";import"fs/promises";const r=Symbol("Let zodToJsonSchema decide on which parser to use"),t={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},getDefaultOptions=e=>"string"==typeof e?{...t,name:e}:{...t,...e},getRefs=e=>{const r=getDefaultOptions(e),t=void 0!==r.name?[...r.basePath,r.definitionPath,r.name]:r.basePath;return{...r,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(r.definitions).map(([name,e])=>[e._def,{def:e._def,path:[...r.basePath,r.definitionPath,name],jsonSchema:void 0}]))}};function addErrorMessage(e,r,t,a){a?.errorMessages&&t&&(e.errorMessage={...e.errorMessage,[r]:t})}function setResponseValueAndErrors(e,r,t,a,n){e[r]=t,addErrorMessage(e,r,a,n)}const getRelativePath=(e,r)=>{let t=0;for(;t<e.length&&t<r.length&&e[t]===r[t];t++);return[""+(e.length-t),...r.slice(t)].join("/")};function parseAnyDef(e){if("openAi"!==e.target)return{};const r=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?getRelativePath(r,e.currentPath):r.join("/")}}function parseArrayDef(r,t){const a={type:"array"};return r.type?._def&&r.type?._def?.typeName!==e.ZodAny&&(a.items=parseDef(r.type._def,{...t,currentPath:[...t.currentPath,"items"]})),r.minLength&&setResponseValueAndErrors(a,"minItems",r.minLength.value,r.minLength.message,t),r.maxLength&&setResponseValueAndErrors(a,"maxItems",r.maxLength.value,r.maxLength.message,t),r.exactLength&&(setResponseValueAndErrors(a,"minItems",r.exactLength.value,r.exactLength.message,t),setResponseValueAndErrors(a,"maxItems",r.exactLength.value,r.exactLength.message,t)),a}function parseBigintDef(e,r){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const a of e.checks)switch(a.kind){case"min":"jsonSchema7"===r.target?a.inclusive?setResponseValueAndErrors(t,"minimum",a.value,a.message,r):setResponseValueAndErrors(t,"exclusiveMinimum",a.value,a.message,r):(a.inclusive||(t.exclusiveMinimum=!0),setResponseValueAndErrors(t,"minimum",a.value,a.message,r));break;case"max":"jsonSchema7"===r.target?a.inclusive?setResponseValueAndErrors(t,"maximum",a.value,a.message,r):setResponseValueAndErrors(t,"exclusiveMaximum",a.value,a.message,r):(a.inclusive||(t.exclusiveMaximum=!0),setResponseValueAndErrors(t,"maximum",a.value,a.message,r));break;case"multipleOf":setResponseValueAndErrors(t,"multipleOf",a.value,a.message,r)}return t}function parseBooleanDef(){return{type:"boolean"}}function parseBrandedDef(e,r){return parseDef(e.type._def,r)}const parseCatchDef=(e,r)=>parseDef(e.innerType._def,r);function parseDateDef(e,r,t){const a=t??r.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((t,a)=>parseDateDef(e,r,t))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return integerDateParser(e,r)}}const integerDateParser=(e,r)=>{const t={type:"integer",format:"unix-time"};if("openApi3"===r.target)return t;for(const a of e.checks)switch(a.kind){case"min":setResponseValueAndErrors(t,"minimum",a.value,a.message,r);break;case"max":setResponseValueAndErrors(t,"maximum",a.value,a.message,r)}return t};function parseDefaultDef(e,r){return{...parseDef(e.innerType._def,r),default:e.defaultValue()}}function parseEffectsDef(e,r){return"input"===r.effectStrategy?parseDef(e.schema._def,r):parseAnyDef(r)}function parseEnumDef(e){return{type:"string",enum:Array.from(e.values)}}function parseIntersectionDef(e,r){const t=[parseDef(e.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),parseDef(e.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(e=>!!e);let a="jsonSchema2019-09"===r.target?{unevaluatedProperties:!1}:void 0;const n=[];return t.forEach(e=>{if("type"in(r=e)&&"string"===r.type||!("allOf"in r)){let r=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:t,...a}=e;r=a}else a=void 0;n.push(r)}else n.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);var r}),n.length?{allOf:n,...a}:void 0}function parseLiteralDef(e,r){const t=typeof e.value;return"bigint"!==t&&"number"!==t&&"boolean"!==t&&"string"!==t?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===r.target?{type:"bigint"===t?"integer":t,enum:[e.value]}:{type:"bigint"===t?"integer":t,const:e.value}}let a;const n={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===a&&(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function parseStringDef(e,r){const t={type:"string"};if(e.checks)for(const a of e.checks)switch(a.kind){case"min":setResponseValueAndErrors(t,"minLength","number"==typeof t.minLength?Math.max(t.minLength,a.value):a.value,a.message,r);break;case"max":setResponseValueAndErrors(t,"maxLength","number"==typeof t.maxLength?Math.min(t.maxLength,a.value):a.value,a.message,r);break;case"email":switch(r.emailStrategy){case"format:email":addFormat(t,"email",a.message,r);break;case"format:idn-email":addFormat(t,"idn-email",a.message,r);break;case"pattern:zod":addPattern(t,n.email,a.message,r)}break;case"url":addFormat(t,"uri",a.message,r);break;case"uuid":addFormat(t,"uuid",a.message,r);break;case"regex":addPattern(t,a.regex,a.message,r);break;case"cuid":addPattern(t,n.cuid,a.message,r);break;case"cuid2":addPattern(t,n.cuid2,a.message,r);break;case"startsWith":addPattern(t,RegExp("^"+escapeLiteralCheckValue(a.value,r)),a.message,r);break;case"endsWith":addPattern(t,RegExp(escapeLiteralCheckValue(a.value,r)+"$"),a.message,r);break;case"datetime":addFormat(t,"date-time",a.message,r);break;case"date":addFormat(t,"date",a.message,r);break;case"time":addFormat(t,"time",a.message,r);break;case"duration":addFormat(t,"duration",a.message,r);break;case"length":setResponseValueAndErrors(t,"minLength","number"==typeof t.minLength?Math.max(t.minLength,a.value):a.value,a.message,r),setResponseValueAndErrors(t,"maxLength","number"==typeof t.maxLength?Math.min(t.maxLength,a.value):a.value,a.message,r);break;case"includes":addPattern(t,RegExp(escapeLiteralCheckValue(a.value,r)),a.message,r);break;case"ip":"v6"!==a.version&&addFormat(t,"ipv4",a.message,r),"v4"!==a.version&&addFormat(t,"ipv6",a.message,r);break;case"base64url":addPattern(t,n.base64url,a.message,r);break;case"jwt":addPattern(t,n.jwt,a.message,r);break;case"cidr":"v6"!==a.version&&addPattern(t,n.ipv4Cidr,a.message,r),"v4"!==a.version&&addPattern(t,n.ipv6Cidr,a.message,r);break;case"emoji":addPattern(t,n.emoji(),a.message,r);break;case"ulid":addPattern(t,n.ulid,a.message,r);break;case"base64":switch(r.base64Strategy){case"format:binary":addFormat(t,"binary",a.message,r);break;case"contentEncoding:base64":setResponseValueAndErrors(t,"contentEncoding","base64",a.message,r);break;case"pattern:zod":addPattern(t,n.base64,a.message,r)}break;case"nanoid":addPattern(t,n.nanoid,a.message,r)}return t}function escapeLiteralCheckValue(e,r){return"escape"===r.patternStrategy?function(e){let r="";for(let t=0;t<e.length;t++)s.has(e[t])||(r+="\\"),r+=e[t];return r}(e):e}const s=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function addFormat(e,r,t,a){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:r,...t&&a.errorMessages&&{errorMessage:{format:t}}})):setResponseValueAndErrors(e,"format",r,t,a)}function addPattern(e,r,t,a){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:stringifyRegExpWithFlags(r,a),...t&&a.errorMessages&&{errorMessage:{pattern:t}}})):setResponseValueAndErrors(e,"pattern",stringifyRegExpWithFlags(r,a),t,a)}function stringifyRegExpWithFlags(e,r){if(!r.applyRegexFlags||!e.flags)return e.source;const t=e.flags.includes("i"),a=e.flags.includes("m"),n=e.flags.includes("s"),s=t?e.source.toLowerCase():e.source;let i="",o=!1,p=!1,f=!1;for(let e=0;e<s.length;e++)if(o)i+=s[e],o=!1;else{if(t)if(p){if(s[e].match(/[a-z]/)){f?(i+=s[e],i+=`${s[e-2]}-${s[e]}`.toUpperCase(),f=!1):"-"===s[e+1]&&s[e+2]?.match(/[a-z]/)?(i+=s[e],f=!0):i+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){i+=`[${s[e]}${s[e].toUpperCase()}]`;continue}if(a){if("^"===s[e]){i+="(^|(?<=[\r\n]))";continue}if("$"===s[e]){i+="($|(?=[\r\n]))";continue}}n&&"."===s[e]?i+=p?s[e]+"\r\n":`[${s[e]}\r\n]`:(i+=s[e],"\\"===s[e]?o=!0:p&&"]"===s[e]?p=!1:p||"["!==s[e]||(p=!0))}try{RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${r.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return i}function parseRecordDef(r,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&r.keyType?._def.typeName===e.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((e,a)=>({...e,[a]:parseDef(r.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??parseAnyDef(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const a={type:"object",additionalProperties:parseDef(r.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return a;if(r.keyType?._def.typeName===e.ZodString&&r.keyType._def.checks?.length){const{type:e,...n}=parseStringDef(r.keyType._def,t);return{...a,propertyNames:n}}if(r.keyType?._def.typeName===e.ZodEnum)return{...a,propertyNames:{enum:r.keyType._def.values}};if(r.keyType?._def.typeName===e.ZodBranded&&r.keyType._def.type._def.typeName===e.ZodString&&r.keyType._def.type._def.checks?.length){const{type:e,...n}=parseBrandedDef(r.keyType._def,t);return{...a,propertyNames:n}}return a}function parseMapDef(e,r){return"record"===r.mapStrategy?parseRecordDef(e,r):{type:"array",maxItems:125,items:{type:"array",items:[parseDef(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||parseAnyDef(r),parseDef(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||parseAnyDef(r)],minItems:2,maxItems:2}}}function parseNativeEnumDef(e){const r=e.values,t=Object.keys(e.values).filter(e=>"number"!=typeof r[r[e]]).map(e=>r[e]),a=Array.from(new Set(t.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:t}}function parseNeverDef(e){return"openAi"===e.target?void 0:{not:parseAnyDef({...e,currentPath:[...e.currentPath,"not"]})}}function parseNullDef(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}const i={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function parseUnionDef(e,r){if("openApi3"===r.target)return asAnyOf(e,r);const t=e.options instanceof Map?Array.from(e.options.values()):e.options;if(t.every(e=>e._def.typeName in i&&(!e._def.checks||!e._def.checks.length))){const e=t.reduce((e,r)=>{const t=i[r._def.typeName];return t&&!e.includes(t)?[...e,t]:e},[]);return{type:e.length>1?e:e[0]}}if(t.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){const e=t.reduce((e,r)=>{const t=typeof r._def.value;switch(t){case"string":case"number":case"boolean":return[...e,t];case"bigint":return[...e,"integer"];case"object":if(null===r._def.value)return[...e,"null"];default:return e}},[]);if(e.length===t.length){const r=e.filter((e,r,t)=>t.indexOf(e)===r);return{type:r.length>1?r:r[0],enum:t.reduce((e,r)=>e.includes(r._def.value)?e:[...e,r._def.value],[])}}}else if(t.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:t.reduce((e,r)=>[...e,...r._def.values.filter(r=>!e.includes(r))],[])};return asAnyOf(e,r)}const asAnyOf=(e,r)=>{const t=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,t)=>parseDef(e._def,{...r,currentPath:[...r.currentPath,"anyOf",""+t]})).filter(e=>!!e&&(!r.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return t.length?{anyOf:t}:void 0};function parseNullableDef(e,r){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===r.target?{type:i[e.innerType._def.typeName],nullable:!0}:{type:[i[e.innerType._def.typeName],"null"]};if("openApi3"===r.target){const t=parseDef(e.innerType._def,{...r,currentPath:[...r.currentPath]});return t&&"$ref"in t?{allOf:[t],nullable:!0}:t&&{...t,nullable:!0}}const t=parseDef(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function parseNumberDef(e,r){const t={type:"number"};if(!e.checks)return t;for(const a of e.checks)switch(a.kind){case"int":t.type="integer",addErrorMessage(t,"type",a.message,r);break;case"min":"jsonSchema7"===r.target?a.inclusive?setResponseValueAndErrors(t,"minimum",a.value,a.message,r):setResponseValueAndErrors(t,"exclusiveMinimum",a.value,a.message,r):(a.inclusive||(t.exclusiveMinimum=!0),setResponseValueAndErrors(t,"minimum",a.value,a.message,r));break;case"max":"jsonSchema7"===r.target?a.inclusive?setResponseValueAndErrors(t,"maximum",a.value,a.message,r):setResponseValueAndErrors(t,"exclusiveMaximum",a.value,a.message,r):(a.inclusive||(t.exclusiveMaximum=!0),setResponseValueAndErrors(t,"maximum",a.value,a.message,r));break;case"multipleOf":setResponseValueAndErrors(t,"multipleOf",a.value,a.message,r)}return t}function parseObjectDef(e,r){const t="openAi"===r.target,a={type:"object",properties:{}},n=[],s=e.shape();for(const e in s){let i=s[e];if(void 0===i||void 0===i._def)continue;let o=safeIsOptional(i);o&&t&&("ZodOptional"===i._def.typeName&&(i=i._def.innerType),i.isNullable()||(i=i.nullable()),o=!1);const p=parseDef(i._def,{...r,currentPath:[...r.currentPath,"properties",e],propertyPath:[...r.currentPath,"properties",e]});void 0!==p&&(a.properties[e]=p,o||n.push(e))}n.length&&(a.required=n);const i=function(e,r){if("ZodNever"!==e.catchall._def.typeName)return parseDef(e.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return r.allowedAdditionalProperties;case"strict":return r.rejectedAdditionalProperties;case"strip":return"strict"===r.removeAdditionalStrategy?r.allowedAdditionalProperties:r.rejectedAdditionalProperties}}(e,r);return void 0!==i&&(a.additionalProperties=i),a}function safeIsOptional(e){try{return e.isOptional()}catch{return!0}}const parseOptionalDef=(e,r)=>{if(r.currentPath.toString()===r.propertyPath?.toString())return parseDef(e.innerType._def,r);const t=parseDef(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return t?{anyOf:[{not:parseAnyDef(r)},t]}:parseAnyDef(r)},parsePipelineDef=(e,r)=>{if("input"===r.pipeStrategy)return parseDef(e.in._def,r);if("output"===r.pipeStrategy)return parseDef(e.out._def,r);const t=parseDef(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]});return{allOf:[t,parseDef(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",t?"1":"0"]})].filter(e=>void 0!==e)}};function parsePromiseDef(e,r){return parseDef(e.type._def,r)}function parseSetDef(e,r){const t={type:"array",uniqueItems:!0,items:parseDef(e.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})};return e.minSize&&setResponseValueAndErrors(t,"minItems",e.minSize.value,e.minSize.message,r),e.maxSize&&setResponseValueAndErrors(t,"maxItems",e.maxSize.value,e.maxSize.message,r),t}function parseTupleDef(e,r){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>parseDef(e._def,{...r,currentPath:[...r.currentPath,"items",""+t]})).reduce((e,r)=>void 0===r?e:[...e,r],[]),additionalItems:parseDef(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>parseDef(e._def,{...r,currentPath:[...r.currentPath,"items",""+t]})).reduce((e,r)=>void 0===r?e:[...e,r],[])}}function parseUndefinedDef(e){return{not:parseAnyDef(e)}}function parseUnknownDef(e){return parseAnyDef(e)}const parseReadonlyDef=(e,r)=>parseDef(e.innerType._def,r),selectParser=(r,t,a)=>{switch(t){case e.ZodString:return parseStringDef(r,a);case e.ZodNumber:return parseNumberDef(r,a);case e.ZodObject:return parseObjectDef(r,a);case e.ZodBigInt:return parseBigintDef(r,a);case e.ZodBoolean:return{type:"boolean"};case e.ZodDate:return parseDateDef(r,a);case e.ZodUndefined:return parseUndefinedDef(a);case e.ZodNull:return parseNullDef(a);case e.ZodArray:return parseArrayDef(r,a);case e.ZodUnion:case e.ZodDiscriminatedUnion:return parseUnionDef(r,a);case e.ZodIntersection:return parseIntersectionDef(r,a);case e.ZodTuple:return parseTupleDef(r,a);case e.ZodRecord:return parseRecordDef(r,a);case e.ZodLiteral:return parseLiteralDef(r,a);case e.ZodEnum:return parseEnumDef(r);case e.ZodNativeEnum:return parseNativeEnumDef(r);case e.ZodNullable:return parseNullableDef(r,a);case e.ZodOptional:return parseOptionalDef(r,a);case e.ZodMap:return parseMapDef(r,a);case e.ZodSet:return parseSetDef(r,a);case e.ZodLazy:return()=>r.getter()._def;case e.ZodPromise:return parsePromiseDef(r,a);case e.ZodNaN:case e.ZodNever:return parseNeverDef(a);case e.ZodEffects:return parseEffectsDef(r,a);case e.ZodAny:return parseAnyDef(a);case e.ZodUnknown:return parseUnknownDef(a);case e.ZodDefault:return parseDefaultDef(r,a);case e.ZodBranded:return parseBrandedDef(r,a);case e.ZodReadonly:return parseReadonlyDef(r,a);case e.ZodCatch:return parseCatchDef(r,a);case e.ZodPipeline:return parsePipelineDef(r,a);case e.ZodFunction:case e.ZodVoid:case e.ZodSymbol:default:return}};function parseDef(e,t,a=!1){const n=t.seen.get(e);if(t.override){const s=t.override?.(e,t,n,a);if(s!==r)return s}if(n&&!a){const e=get$ref(n,t);if(void 0!==e)return e}const s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);const i=selectParser(e,e.typeName,t),o="function"==typeof i?parseDef(i(),t):i;if(o&&addMeta(e,t,o),t.postProcess){const r=t.postProcess(o,e,t);return s.jsonSchema=o,r}return s.jsonSchema=o,o}const get$ref=(e,r)=>{switch(r.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:getRelativePath(r.currentPath,e.path)};case"none":case"seen":return e.path.length<r.currentPath.length&&e.path.every((e,t)=>r.currentPath[t]===e)?(console.warn(`Recursive reference detected at ${r.currentPath.join("/")}! Defaulting to any`),parseAnyDef(r)):"seen"===r.$refStrategy?parseAnyDef(r):void 0}},addMeta=(e,r,t)=>(e.description&&(t.description=e.description,r.markdownDescription&&(t.markdownDescription=e.description)),t),zodToJsonSchema=(e,r)=>{const t=getRefs(r);let a="object"==typeof r&&r.definitions?Object.entries(r.definitions).reduce((e,[name,r])=>({...e,[name]:parseDef(r._def,{...t,currentPath:[...t.basePath,t.definitionPath,name]},!0)??parseAnyDef(t)}),{}):void 0;const name="string"==typeof r?r:"title"===r?.nameStrategy?void 0:r?.name,n=parseDef(e._def,void 0===name?t:{...t,currentPath:[...t.basePath,t.definitionPath,name]},!1)??parseAnyDef(t),s="object"==typeof r&&void 0!==r.name&&"title"===r.nameStrategy?r.name:void 0;void 0!==s&&(n.title=s),t.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[t.openAiAnyTypeName]||(a[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===t.$refStrategy?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));const i=void 0===name?a?{...n,[t.definitionPath]:a}:n:{$ref:[..."relative"===t.$refStrategy?[]:t.basePath,t.definitionPath,name].join("/"),[t.definitionPath]:{...a,[name]:n}};return"jsonSchema7"===t.target?i.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"!==t.target&&"openAi"!==t.target||(i.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===t.target&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};export{addErrorMessage,zodToJsonSchema as default,t as defaultOptions,getDefaultOptions,getRefs,getRelativePath,r as ignoreOverride,parseAnyDef,parseArrayDef,parseBigintDef,parseBooleanDef,parseBrandedDef,parseCatchDef,parseDateDef,parseDef,parseDefaultDef,parseEffectsDef,parseEnumDef,parseIntersectionDef,parseLiteralDef,parseMapDef,parseNativeEnumDef,parseNeverDef,parseNullDef,parseNullableDef,parseNumberDef,parseObjectDef,parseOptionalDef,parsePipelineDef,parsePromiseDef,parseReadonlyDef,parseRecordDef,parseSetDef,parseStringDef,parseTupleDef,parseUndefinedDef,parseUnionDef,parseUnknownDef,i as primitiveMappings,selectParser,setResponseValueAndErrors,n as zodPatterns,zodToJsonSchema};
