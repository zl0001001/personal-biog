(()=>{"use strict";var e={5:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.validateDevContainerConfigWithSchema=async function(e,t){try{const t=s.Uri.file(e),n=s.languages.getDiagnostics(t),o=[],r=[];for(const e of n)e.severity===s.DiagnosticSeverity.Error?o.push(e):e.severity===s.DiagnosticSeverity.Warning&&r.push(e);return{isValid:0===o.length,errors:o,warnings:r}}catch(e){return console.error("Failed to validate with schema:",e),{isValid:!0,errors:[],warnings:[]}}},t.validateDevContainerJsonContent=async function(e,t){try{JSON.parse(e);const t=await s.workspace.openTextDocument({language:"json",content:e});await new Promise(e=>setTimeout(e,100));const n=s.languages.getDiagnostics(t.uri),o=[],r=[];for(const e of n)e.severity===s.DiagnosticSeverity.Error?o.push(e):e.severity===s.DiagnosticSeverity.Warning&&r.push(e);return{isValid:0===o.length,errors:o,warnings:r}}catch(e){return{isValid:!1,errors:[new s.Diagnostic(new s.Range(0,0,0,0),`Failed to parse JSON: ${e instanceof Error?e.message:String(e)}`,s.DiagnosticSeverity.Error)],warnings:[]}}},t.getValidationMessages=function(e){return{errors:e.errors.map(e=>`Line ${e.range.start.line+1}: ${e.message}`),warnings:e.warnings.map(e=>`Line ${e.range.start.line+1}: ${e.message}`)}};const s=a(n(398))},9:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DevContainerResolver=void 0,t.getDevContainerAuthority=function(e){return`${f.DEV_CONTAINER_AUTHORITY}+${e}`};const c=a(n(398)),l=n(704),d=n(343),u=n(523),f=n(603),h=n(323),g=n(86),p=n(303),m=s(n(877));t.DevContainerResolver=class{constructor(e){this.monitoringAbortControllers=[],this.context=e,this.logger=m.default.getInstance()}resolve(e,t){const n=void 0!==t.execServer;return this.resolveHelper(e,t).then(({localPort:e,connectionToken:t})=>new c.ResolvedAuthority("127.0.0.1",e,t)).catch(e=>{throw new Error(n?`Failed to resolve authority: ${e}`:`Failed to resolve remote server connector: ${e}`)})}async resolveHelper(e,t){const n=l.DevContainerDestination.parseAuthority(e);return this.logger.info(`Resolving dev container authority '${e}' (attempt #${t.resolveAttempt}) container '${n.toJSON()}'`),c.window.withProgress({location:c.ProgressLocation.Notification,title:"Setting up Dev Container ([details](command:codebuddy-dev-containers.showLog))",cancellable:!1},async e=>{this.logger.show();const o=t.execServer?t.execServer:new h.LocalExecServer,r=(0,u.getVSCodeServerConfig)(o),i=await r,a=await(0,u.getDevContainerCliPath)(this.context,o,i);let s,l=!1;return this.logger.info("setup devContainers"),new Promise(async(t,r)=>{e.report({message:"Starting Codebuddy Dev Containers..."}),this.logger.info("Starting Codebuddy Dev Containers...");const h=e=>{this.logger.error(e),l||(l=!0,this.logger.show(),c.window.showErrorMessage(e,{modal:!0}).then(()=>{r(e)})),r(e)};let m,_="root",v=[],E=null;e.report({message:"Checking docker version runs"}),this.logger.info("Checking docker version runs");let w=null;try{if(w=await(0,d.findDockerPath)(o),!w)throw new Error("Docker executable not found in PATH or common locations");this.logger.info(`Found Docker at: ${w}`),await(0,d.checkDockerVersion)(o,w)}catch(e){return h(`Failed to check docker version: ${e.message}`)}const O=await a;if("config"===n.getType()){const t=n.getConfigSetting();e.report({message:"Starting Dev Container..."});const[r,i]=await this.startDevContainer(t,O,o);if(i)return h(i);if(!r?.containerId)return h("No container ID found in output");s=r.containerId,e.report({message:`Finished starting Dev Container ${s}`}),this.logger.info(`Finished starting Dev Container ${s}: ${JSON.stringify(r)}`);const a=await(0,u.readDevContainerConfig)({workspaceFolder:t.workspacePath,includeMergedConfig:!1,devcontainerId:s,devcontainerPath:t.devcontainerPath,execServer:o,devcontainerCliPath:O});if(!a)return h("Failed to read Dev Container configuration. Please ensure the container exists and the configuration is valid.");e.report({message:"Finished Read Dev Container Configuration."}),this.logger.info("Finished Read Dev Container Configuration."),a.configuration.customizations?.vscode?.extensions&&(v=a.configuration.customizations.vscode.extensions,this.logger.info(`Found ${v.length} extensions to install: ${v.join(", ")}`)),E=a,_=await(0,d.findBestRemoteUser)(a,s,o);const c=a.workspace.workspaceFolder;this.logger.info(`Container workspace folder: ${c}`),await(0,d.ensureWorkspaceExists)(s,c,o)}else{s=n.getContainerSetting().containerId;try{const e=await(0,d.inspectDockerContainer)(s,o);if("running"!==e.State.Status)return h(`Failed to start Dev Container: container is not running: ${s}`);_=await(0,d.findBestRemoteUserForAttach)(e,s,o);const t=await(0,d.getContainerWorkspaceFolder)(e);this.logger.info(`Container workspace folder: ${t}`),await(0,d.ensureWorkspaceExists)(s,t,o);const[n,r]=await this.setupDevContainer(s,O,o);if(r)return h(r)}catch(e){return h(`Failed to start Dev Container: container doesn't exist or isn't running: ${e}`)}}this.logger.info(`Remote user: ${_}`);const C=(0,d.getContainerImageName)(s,o).catch(e=>{this.logger.error(`Failed to get image name from container: ${e}`)}),D=(0,d.getContainerName)(s,o).catch(e=>{this.logger.error(`Failed to get container name: ${e}`)});let S;e.report({message:"Starting install VS Code Server..."});try{S=await(0,g.installAndStartVSCodeServer)(this.context,s,_,o,i,e,v)}catch(e){return h(`Failed to install VS Code Server: ${e.message}`)}if(E?.configuration?.postAttachCommand){e.report({message:"Executing postAttachCommand..."}),this.logger.info("Executing postAttachCommand...");try{await(0,d.executePostAttachCommand)(E.configuration.postAttachCommand,s,_,o,w||void 0),this.logger.info("postAttachCommand completed successfully")}catch(e){this.logger.error(`postAttachCommand failed: ${e.message}`)}}const R=c.workspace.getConfiguration("remote.codebuddyDevContainers").get("enableSSHAgentForwarding",!0);this.logger.info(`SSH Agent Forwarding: ${R}`);const y=(await o.env()).env.SSH_AUTH_SOCK;if(this.logger.info(`SSH_AUTH_SOCK: ${y}`),R&&y){e.report({message:"Forwarding SSH agent socket..."}),this.logger.info(`Forwarding SSH agent socket: ${y}`);try{const e=`/tmp/codebuddy-remote-ssh-${Math.random().toString(36).substring(7)}.sock`,t=new AbortController,n=(0,p.forwardSocket)(s,y,e,S.nodeServerPath,_,this.logger,o,t),r=new Promise(e=>{setTimeout(()=>{e("SSH agent forwarding timed out after 5 seconds")},5e3)}),i=await Promise.race([n,r]);"string"==typeof i&&""!==i?this.logger.error(`Failed to forward SSH_AUTH_SOCK: ${i}`):this.monitoringAbortControllers.push(()=>t.abort())}catch(e){this.logger.error(`Failed to forward SSH agent socket: ${e.message}`)}}this.logger.info(`Verifying container ${s} exists...`);try{await(0,d.inspectDockerContainer)(s,o),this.logger.info(`Container ${s} verified successfully`)}catch(e){return h(`Container verification failed: ${e.message}`)}e.report({message:"Forwarding port..."});const[I,$]=await this.forwardPortWithRetry(S.remotePort,s,S.nodeServerPath,_,3,o);if($)return h($);m=await C;const b=await D,k=m||"<unknown>";this.logger.info(`Image name: ${k}`),this.logger.info(`Container name: ${b||"<unknown>"}`);const P=b||k;this.logger.info(`Registering label formatter with authority pattern: ${f.DEV_CONTAINER_AUTHORITY}+*`),this.logger.info(`Display name: ${P}`),this.labelFormatterDisposable?.dispose(),this.labelFormatterDisposable=c.workspace.registerResourceLabelFormatter({scheme:"vscode-remote",authority:`${f.DEV_CONTAINER_AUTHORITY}+*`,formatting:{label:"${path}",separator:"/",tildify:!0,workspaceSuffix:`Dev Container: ${P}`}}),this.logger.info(`DevContainer setup completed. Local port: ${I}, Connection token: ${S.connectionToken}`),e.report({message:"Dev Container is ready!"}),t({localPort:I,connectionToken:S.connectionToken})})})}async startDevContainer(e,t,n){return this.logger.info("Start devcontainer up ..."),await(0,u.startDevContainer)(e.workspacePath,e.devcontainerPath,t,n,this.logger)}async setupDevContainer(e,t,n){return this.logger.info(`Setup devcontainer on docker container ${e} ...`),await(0,u.setupDevContainer)(e,t,n,this.logger)}async forwardPortWithRetry(e,t,n,o,r=3,i){let a=0,s="";for(;a<r;){try{const r=new AbortController,a=await(0,p.forwardPort)(e,t,n,o,this.logger,i||new h.LocalExecServer,r);return this.monitoringAbortControllers.push(()=>r.abort()),this.logger.info(`Forwarded port: ${a}`),[a,""]}catch(e){s=e.message}a++,a<r&&(this.logger.info(`Port forwarding attempt ${a} failed, retrying in 1 second...`),await new Promise(e=>setTimeout(e,1e3)))}return[0,`Port forwarding failed after ${r} attempts. Last error: ${s}`]}dispose(){this.monitoringAbortControllers.forEach(e=>e()),this.labelFormatterDisposable?.dispose()}}},34:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReopenInContainerCommand=void 0;const c=a(n(398)),l=n(299),d=n(890),u=n(343),f=n(801),h=n(523),g=n(704),p=n(603),m=n(323),_=n(283),v=s(n(877)),E=n(489);class w extends d.BaseCommand{constructor(e){super(e),this.commandId=l.COMMAND_REOPEN_IN_CONTAINER,this.containerManager=f.ContainerManager.getInstance(e),this.logger=v.default.getInstance()}async run(e){const t=_.EnvironmentUtils.getBaseRemoteAuthority(),n=_.EnvironmentUtils.getIsLocal(),o=t?await c.workspace.getRemoteExecServer(t):void 0,r=new m.LocalExecServer;this.logger.show();const i=n?r:o;if(!i)return this.logger.info("Exec server is not available"),void c.window.showErrorMessage("Exec server is not available");const a=this.getDevContainerPath(e)||await this.findDevContainerPath();if(!a)return void c.window.showErrorMessage("No devcontainer.json file selected");const s=this.findWorkspaceFolder(a);if(!s)return void c.window.showErrorMessage("The selected devcontainer.json must be within a workspace folder");this.logger.info("Checking docker version runs");let l=null;try{if(l=await(0,u.findDockerPath)(i),!l)throw new Error("Docker executable not found in PATH or common locations");this.logger.info(`Found Docker at: ${l}`),await(0,u.checkDockerVersion)(i,l)}catch(e){this.logger.show(),this.logger.info(`Docker check failed: ${e}`);const t={type:E.ErrorType.DOCKER_NOT_AVAILABLE,message:"Docker is not available. Please install Docker and make sure it's running.",suggestions:["Install Docker Desktop","Start Docker service","Add Docker to PATH"]};return void await E.ErrorHandler.showErrorWithActions(t)}const d=c.Uri.file(a),f=await(0,h.getVSCodeServerConfig)(i),v=await(0,h.getDevContainerCliPath)(this.context,i,f),w=n?s.uri.fsPath:s.uri.path,O=n?d.fsPath:d.path,C=await(0,h.readDevContainerConfig)({workspaceFolder:w,includeMergedConfig:!1,devcontainerId:void 0,devcontainerPath:O,execServer:i,devcontainerCliPath:v});if(!C)return this.logger.show(),void c.window.showErrorMessage("Failed to read devcontainer configuration.");const D=g.DevContainerDestination.withDevContainerConfig(w,O).toEncodedString(),S=t?`${p.DEV_CONTAINER_AUTHORITY}+${D}@${t}`:`${p.DEV_CONTAINER_AUTHORITY}+${D}`,R=t?this.getLocationName(t):"Local";this.containerManager.addContainer(R,D,S,C.workspace.workspaceFolder,O),c.commands.executeCommand("vscode.openFolder",c.Uri.from({scheme:"vscode-remote",authority:S,path:C.workspace.workspaceFolder}))}getDevContainerPath(e){if(!e)return"";const t=_.EnvironmentUtils.getIsLocal(),n=c.Uri.parse(e),o=t?n.fsPath:n.path;return o.endsWith("devcontainer.json")?o:(c.window.showErrorMessage("The selected file is not a devcontainer.json file"),"")}async findDevContainerPath(){const e=_.EnvironmentUtils.getIsLocal(),t=await c.workspace.findFiles(".devcontainer/**/devcontainer.json"),n=t.map(t=>({label:e?t.fsPath:t.path,value:e?t.fsPath:t.path}));if(0===n.length)return c.window.showErrorMessage("No devcontainer.json files found"),"";let o,r;if(1===n.length)o=n[0];else{const n=[...t.map(t=>({label:e?t.fsPath:t.path,value:e?t.fsPath:t.path})),{label:"$(folder) Browse...",description:"Select a devcontainer.json file",value:"browse"}];o=await c.window.showQuickPick(n,{placeHolder:"Select the devcontainer.json file"})}if(!o)return"";if("browse"===o.value){const t=await c.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{"DevContainer Config":["json"]},title:"Select devcontainer.json file",openLabel:"Select"});if(!t||0===t.length)return"";r=e?t[0].fsPath:t[0].path}else r=o.value;return r.endsWith("devcontainer.json")?r:(c.window.showErrorMessage("The selected file is not a devcontainer.json file"),"")}findWorkspaceFolder(e){const t=_.EnvironmentUtils.getIsLocal(),n=c.workspace.workspaceFolders;if(n&&0!==n.length)return e?n.find(n=>e.startsWith(t?n.uri.fsPath:n.uri.path)):n[0]}getLocationName(e){if(e.startsWith("wsl+"))return e.split("+")[1]+" (WSL)";try{const t=e.split("+")[1],n=Buffer.from(t,"hex").toString(),o=JSON.parse(n);return(o.hostname||o.hostName||e)+" (remote)"}catch{return e+" (remote)"}}}t.ReopenInContainerCommand=w},66:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceListener=void 0;const r=o(n(398)),i=n(299),a=n(362);class s extends a.BaseListener{constructor(e){super(e);const t=r.default.workspace.onDidChangeWorkspaceFolders(()=>{this.run()});this.context.subscriptions.push(t)}run(){r.default.commands.executeCommand(i.COMMAND_REFRESH_TREE)}}t.WorkspaceListener=s},69:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LOGGER_OUTPUT_CHANNEL_NAME=void 0,t.LOGGER_OUTPUT_CHANNEL_NAME="Remote - Codebuddy Dev Containers"},86:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.installAndStartVSCodeServer=async function(e,t,n,o,r,i,a=[]){let s=String(Math.floor(0xffffffffff*Math.random()));const v=l.randomBytes(12).toString("hex"),E=p.default.getInstance();E.info(`Installing VS Code Server in container ${t}`),i.report({message:"Installing VS Code Server..."});const w=await async function(e,t,n){const o=p.default.getInstance(),r=await(0,h.getRemoteHomeDir)(n),i=[`${r}/.vscode-server/bin/*/node`,`${r}/.codebuddy-server/bin/*/node`,`${r}/.vscode-server/cli/servers/*/server/node`];for(const r of i)try{const{stdout:i}=await(0,h.executeCommandWithExecServer)("docker",["exec","-u",t,e,"sh","-c",`find ${r.substring(0,r.lastIndexOf("/"))} -name node -type f 2>/dev/null | head -1`],n),a=i.trim();if(a)return o.info(`Found VSCode Server's bundled node at ${a}`),a}catch(e){}const a=["/usr/local/bin/node","/usr/bin/node","/bin/node","/opt/nodejs/bin/node"];for(const r of a)try{return await(0,h.executeCommandWithExecServer)("docker",["exec","-u",t,e,"test","-f",r],n),o.info(`Found node at ${r}`),r}catch(e){}try{const r=(await(0,h.executeCommandWithExecServer)("docker",["exec","-u",t,e,"which","node"],n)).stdout.trim();if(r)return o.info(`Found node using 'which': ${r}`),r}catch(e){}return o.warn("Could not find node in container, using default /usr/bin/node"),"/usr/bin/node"}(t,n,o),O="true"===process.env.VSCODE_DEBUG_MODE||e.extensionMode===c.default.ExtensionMode.Development,C=c.default.workspace.getConfiguration("remote.codebuddyDevContainers").get("serverDownloadUrlTemplate")||r.serverDownloadUrlTemplate||_;E.info("Server configuration:"),E.info(`  - Version: ${r.version}`),E.info(`  - Commit: ${r.commit}`),E.info(`  - Quality: ${r.quality}`),E.info(`  - Application Name: ${r.serverApplicationName}`),E.info(`  - Data Folder: ${r.serverDataFolderName}`),E.info(`  - Download URL Template: ${C}`);const D=r.quality||"stable",S={id:v,quality:D,version:r.version,commit:r.commit,release:r.release,extensionIds:a,envVariables:[],useSocketPath:!1,serverApplicationName:r.serverApplicationName,serverDataFolderName:r.serverDataFolderName,serverDownloadUrlTemplate:C,distroId:`${D}-${r.commit}`+(O?"-dev":""),disableServerChecksum:r.disableServerChecksum||!1};E.info(`Install options: ${JSON.stringify(S,void 0,2)}`);const R=(0,g.generateBashInstallScript)(S,s);E.info(`Bash script:\n${R}`);const y=`${v}.sh`,I=o instanceof f.LocalExecServer?d.join(u.tmpdir(),y):d.posix.join("/tmp",y);E.info(`local script path:\n${I}`);try{await(0,h.setupBashScript)(I,R,o),E.info(`Script written to ${I}`)}catch(e){throw new Error(`Error writing server installation script: ${e.message}`)}const $=d.posix.join("/tmp",y);E.info(`container script path:\n${$}`);try{const{stdout:e,stderr:n}=await(0,h.executeCommandWithExecServer)("docker",["cp","-a",I,`${t}:${$}`],o,void 0);if(n)throw new Error(`Error copying script to container: ${n}\nstdout: ${e}`)}catch(e){throw new Error(`Failed to copy script to container: ${e.message}`)}E.info("Change ownership and permissions of the script in container");try{await(0,h.executeCommandWithExecServer)("docker",["exec","-u","root",t,"chown",`${n}:${n}`,$],o,void 0),await(0,h.executeCommandWithExecServer)("docker",["exec","-u","root",t,"chmod","+x",$],o,void 0)}catch(e){E.warn(`Failed to change script permissions: ${e.message}`)}const b=c.default.workspace.getConfiguration("remote.codebuddyDevContainers").get("enableSSHAgentForwarding",!0);E.info(`SSH Agent Forwarding: ${b}`);const k=(await o.env()).env.SSH_AUTH_SOCK,P=d.posix.join("/tmp",`codebuddy-remote-ssh-${v}.sock`);i.report({message:"Executing server installation script in container..."}),E.info("Executing server installation script in container...");try{const e=b&&k?["exec","-e",`SSH_AUTH_SOCK=${P}`,"-u",n,t,"bash",$]:["exec","-u",n,t,"bash",$],{stdout:r,stderr:c}=await(0,h.executeCommandWithExecServer)("docker",e,o,{ELECTRON_RUN_AS_NODE:"1"},6e5),l=r+c;E.info("Server installation output:",l),console.log("Server installation output:",l),i.report({message:"Server installation complete."});const d=`${v}: start`,u=`${v}: end`,g=l.indexOf(d),p=l.indexOf(u);if(-1===g||-1===p)throw new Error("Failed to find installation result markers in output");const _=l.substring(g+d.length,p),O=e=>{const t=_.match(new RegExp(`${e}==(.+?)==`));return t?t[1]:void 0},C=O("exitCode"),D=C?parseInt(C,10):1;if(0!==D){const e=O("logFile");let r=`Server installation failed with exit code ${D}`;if(e)try{const{stdout:i}=await(0,h.executeCommandWithExecServer)("docker",["exec","-u",n,t,"cat",e],o);i&&(r+=`\n\nServer log:\n${i}`)}catch(e){E.warn("Could not read server log file:",e)}throw r+=`\n\nFull installation output:\n${l}`,E.error(r),new Error(r)}const S=O("listeningOn"),R=O("connectionToken");if(!S)throw new Error("Failed to extract server port from output");let y;y=S.includes("/")?0:parseInt(S,10),R&&(s=R),E.info(`VS Code Server is listening on ${S}`),i.report({message:"VS Code Server started successfully"});const N=O("logFile");if(a.length>0&&N){E.info("=== Extension Installation Logs ===");try{const{stdout:e}=await(0,h.executeCommandWithExecServer)("docker",["exec","-u",n,t,"cat",N],o),r=e.split("\n").filter(e=>e.toLowerCase().includes("extension")||e.toLowerCase().includes("installing")).join("\n");r?E.info(r):E.info("No extension installation logs found in server log file")}catch(e){E.warn(`Could not read extension logs from server log file: ${e.message}`)}E.info("=== End of Extension Logs ===")}E.info("Cleaning up temporary script files...");try{await(0,h.executeCommandWithExecServer)("docker",["exec","-u",n,t,"rm",$],o)}catch(e){E.info(`Failed to delete script from container: ${e.message}`)}try{o instanceof f.LocalExecServer?await(0,m.unlink)(I):await o.fs.rm(I)}catch(e){E.info(`Failed to delete temporary script: ${e.message}`)}return{remotePort:y,connectionToken:s,nodeServerPath:w}}catch(e){throw E.error("Failed to install VS Code Server:",e),new Error(`Failed to install VS Code Server: ${e.message}`)}},t.installExtensions=async function(e,t,n,o,r){if(!n||0===n.length)return;const i=p.default.getInstance();i.info(`Installing ${n.length} extensions: ${n.join(", ")}`),r.report({message:"Installing extensions..."});const a=await(0,h.getRemoteHomeDir)(o),s=d.posix.join(a,".codebuddy-server");let c;try{const{stdout:n}=await(0,h.executeCommandWithExecServer)("docker",["exec","-u",t,e,"sh","-c",`find ${s}/bin -type f -name codebuddy-server -o -name code-server 2>/dev/null | head -1`],o),r=n.trim();r&&r.length>0&&(c=r,i.info(`Found server script at: ${c}`))}catch(e){i.warn(`Could not find server script automatically: ${e.message}`)}if(!c)try{const{stdout:n}=await(0,h.executeCommandWithExecServer)("docker",["exec","-u",t,e,"sh","-c",`ls -1d ${s}/bin/*/bin 2>/dev/null | head -1`],o),r=n.trim();r&&(c=d.posix.join(r,"codebuddy-server"),i.info(`Constructed server script path: ${c}`))}catch(e){i.warn(`Could not construct server script path: ${e.message}`)}if(!c)throw new Error(`Could not find server script in container. Expected location: ${s}/bin/{commit}/bin/codebuddy-server. Make sure the VS Code Server was installed successfully.`);i.info(`Using server script: ${c}`);for(const a of n)try{i.info(`Installing extension: ${a}`),r.report({message:`Installing ${a}...`});const{stdout:n,stderr:s}=await(0,h.executeCommandWithExecServer)("docker",["exec","-u",t,e,c,"--install-extension",a,"--force"],o);s&&s.includes("error")?i.warn(`Extension ${a} installation had warnings: ${s}`):i.info(`Successfully installed extension: ${a}`)}catch(e){i.error(`Failed to install extension ${a}: ${e.message}`)}r.report({message:"Extensions installed"}),i.info("Finished installing extensions")};const c=s(n(398)),l=a(n(982)),d=a(n(928)),u=a(n(857)),f=n(323),h=n(798),g=n(143),p=s(n(877)),m=n(943),_="https://codebuddy-1328495429.cos.accelerate.myqcloud.com/ssh/release/${os}-${arch}/codebuddy-reh-${os}-${arch}-${version}.tar.gz"},90:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.TreeDataProvider=void 0;const s=a(n(398)),c=n(879),l=n(587),d=n(801);class u{constructor(e){this._onDidChangeTreeData=new s.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this.containerManager=d.ContainerManager.getInstance(e)}static getInstance(e){return u.instance||(u.instance=new u(e)),u.instance}static resetInstance(){u.instance=void 0}refresh(e){this.containerManager.reloadFromStorage(),this._onDidChangeTreeData.fire(e)}getTreeItem(e){return e}async getChildren(e){try{return e?e instanceof l.GroupTreeItem?this.containerManager.getDevContainers(e.location).map(t=>new c.ContainerTreeItem(e.location,t,this.containerManager.getAuthority(e.location,t),this.containerManager.getWorkspacePath(e.location,t),this.containerManager.getConfigPath(e.location,t))):[]:this.containerManager.getLocations().map(e=>new l.GroupTreeItem(e))}catch(e){return console.error("[DevContainersTreeProvider#getChildren] Error:",e),[]}}}t.TreeDataProvider=u},143:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateBashInstallScript=function(e,t){const{id:n,quality:r,version:i,commit:a,release:s,extensionIds:c,envVariables:l,useSocketPath:d,serverApplicationName:u,serverDataFolderName:f,serverDownloadUrlTemplate:h,distroId:g,disableServerChecksum:p}=e;return`\n#Server installation script\nDISABLE_SERVER_CHECKSUM="${p}"\nTMP_DIR="\${XDG_RUNTIME_DIR:-/tmp}"\n\nDISTRO_IDE_VERSION="${i}"\nDISTRO_COMMIT="${a}"\nDISTRO_ID="${g}"\nDISTRO_QUALITY="${r}"\nDISTRO_VSCODIUM_RELEASE="${s??""}"\n\nSERVER_APP_NAME="${u}"\nSERVER_INITIAL_EXTENSIONS="${c.map(e=>`--install-extension ${e}`).join(" ")}"\nSERVER_LISTEN_FLAG="${d?`--socket-path="$TMP_DIR/vscode-server-sock-${(0,o.randomUUID)()}"`:"--port=0"}"\nSERVER_DATA_DIR="$HOME/${f}"\nSERVER_DIR="$SERVER_DATA_DIR/bin/$DISTRO_ID"\nSERVER_SCRIPT="$SERVER_DIR/bin/$SERVER_APP_NAME"\nSERVER_LOGFILE="$SERVER_DATA_DIR/.$DISTRO_ID.log"\nSERVER_PIDFILE="$SERVER_DATA_DIR/.$DISTRO_ID.pid"\nSERVER_TOKENFILE="$SERVER_DATA_DIR/.$DISTRO_ID.token"\nSERVER_SSH_AGENT_SOCKET="$SERVER_DATA_DIR/.$DISTRO_ID-ssh-auth.sock"\nSERVER_ARCH=\nSERVER_CONNECTION_TOKEN=\nSERVER_DOWNLOAD_URL=\n\nLISTENING_ON=\nOS_RELEASE_ID=\nARCH=\nPLATFORM=\nSERVER_PID=\n\nGLIBC_VERSION_GOOD=\n\n#Add lock mechanism\nLOCK_FILE="$SERVER_DATA_DIR/.installation_lock"\n\n#Function to acquire lock\nacquire_lock() {\n\texec 200>$LOCK_FILE\n\techo "Waiting for lock..."\n\tflock 200\n\techo "Lock acquired, proceeding with installation."\n}\n\n#Function to release lock\nrelease_lock() {\n\tflock -u 200\n\texec 200>&-\n}\n\ntrap release_lock EXIT INT TERM\n\n#Mimic output from logs of remote-ssh extension\nprint_install_results_and_exit() {\n\tif [[ $1 -eq 1 ]]; then\n\t\techo ""\n\t\techo "Error: installation failed."\n\t\tif [[ -f "$SERVER_LOGFILE" ]]; then\n\t\t\techo "Server log:\\n$(cat "$SERVER_LOGFILE")\\n"\n\t\tfi\n\tfi\n\tif [[ "$GLIBC_VERSION_GOOD" = "false" ]]; then\n\t\techo "Warning: valid glibc version not found. Codebuddy only supports remote connections with glibc >= 2.28, such as Ubuntu 20.04, Debian 10, or CentOS 8."\n\t\techo ""\n\tfi\n\techo "${n}: start"\n\techo "exitCode==$1=="\n\techo "listeningOn==$LISTENING_ON=="\n\techo "connectionToken==$SERVER_CONNECTION_TOKEN=="\n\techo "logFile==$SERVER_LOGFILE=="\n\techo "osReleaseId==$OS_RELEASE_ID=="\n\techo "arch==$ARCH=="\n\techo "platform==$PLATFORM=="\n\techo "tmpDir==$TMP_DIR=="\n\t${l.map(e=>`echo "${e}==$${e}=="`).join("\n\t")}\n\techo "${n}: end"\n\n\texit 0\n}\n\ndelete_server() {\n\tif [[ -n "$OLD_DISTRO_ID" ]]; then\n\t\techo "Cleaning up files for $OLD_DISTRO_ID..."\n\t\trm -rf "$SERVER_DATA_DIR/bin/$OLD_DISTRO_ID"\n\t\trm -f "$SERVER_DATA_DIR/.$OLD_DISTRO_ID.pid"\n\t\trm -f "$SERVER_DATA_DIR/.$OLD_DISTRO_ID.log"\n\t\trm -f "$SERVER_DATA_DIR/.$OLD_DISTRO_ID.token"\n\t\trm -f "$SERVER_DATA_DIR/.$OLD_DISTRO_ID-ssh-auth.sock"\n\t\techo "$OLD_DISTRO_ID cleaned up."\n\tfi\n}\n\nclean_up_old_servers() {\n\techo "Cleaning up old server installations..."\n\tif [[ -d "$SERVER_DATA_DIR/bin" ]]; then\n\t\tfor OLD_DISTRO_DIR_FULL_PATH in "$SERVER_DATA_DIR"/bin/*; do\n\t\t\tif [[ -d "$OLD_DISTRO_DIR_FULL_PATH" ]]; then\n\t\t\t\tOLD_DISTRO_ID=$(basename "$OLD_DISTRO_DIR_FULL_PATH")\n\n\t\t\t\tif [[ "$OLD_DISTRO_ID" = "$DISTRO_ID" ]]; then\n\t\t\t\t\tcontinue\n\t\t\t\tfi\n\n\t\t\t\techo "Checking old server: $OLD_DISTRO_ID"\n\t\t\t\tOLD_SERVER_PIDFILE="$SERVER_DATA_DIR/.$OLD_DISTRO_ID.pid"\n\n\t\t\t\techo "Old server PID file: $OLD_SERVER_PIDFILE"\n\n\t\t\t\tNUMBER_OF_EXECUTABLES=$(find "$OLD_DISTRO_DIR_FULL_PATH/bin/" -maxdepth 1 -type f -executable | wc -l)\n\t\t\t\tif (( $NUMBER_OF_EXECUTABLES == 0 )); then\n\t\t\t\t\techo "No executables found in $OLD_DISTRO_DIR_FULL_PATH/bin/"\n\t\t\t\t\tdelete_server\n\t\t\t\t\tcontinue\n\t\t\t\telif (( $NUMBER_OF_EXECUTABLES > 1 )); then\n\t\t\t\t\techo "Multiple executables found in $OLD_DISTRO_DIR_FULL_PATH/bin/, leaving it alone."\n\t\t\t\t\tcontinue\n\t\t\t\telse\n\t\t\t\t\tOLD_SERVER_SCRIPT=$(find "$OLD_DISTRO_DIR_FULL_PATH/bin/" -maxdepth 1 -type f -executable)\n\t\t\t\t\techo "Old server script: $OLD_SERVER_SCRIPT"\n\t\t\t\tfi\n\n\t\t\t\tOLD_SERVER_SCRIPT_PATH=$(readlink -f "$OLD_SERVER_SCRIPT")\n\t\t\t\techo "Old server script path: $OLD_SERVER_SCRIPT_PATH"\n\n\t\t\t\tif [[ -z "$OLD_SERVER_SCRIPT_PATH" ]]; then\n\t\t\t\t\techo "Something went wrong, old server script path is empty. Skipping old server $OLD_DISTRO_ID."\n\t\t\t\t\tcontinue\n\t\t\t\tfi\n\n\t\t\t\tif [[ ! -f "$OLD_SERVER_PIDFILE" ]]; then\n\t\t\t\t\tOLD_PID=$(pgrep -f "$OLD_SERVER_SCRIPT_PATH")\n\t\t\t\t\tif [[ -n "$OLD_PID" ]]; then\n\t\t\t\t\t\ttouch "$OLD_SERVER_PIDFILE"\n\t\t\t\t\t\techo "$OLD_PID" > "$OLD_SERVER_PIDFILE"\n\t\t\t\t\t\techo "Wrote to PID file for $OLD_DISTRO_ID: $OLD_SERVER_PIDFILE"\n\t\t\t\t\tfi\n\t\t\t\tfi\n\n\t\t\t\tif [[ -f "$OLD_SERVER_PIDFILE" ]]; then\n\t\t\t\t\tOLD_PID=$(cat "$OLD_SERVER_PIDFILE")\n\t\t\t\t\techo "Old server PID: $OLD_PID"\n\t\t\t\t\tif [[ -z "$OLD_PID" ]]; then\n\t\t\t\t\t\tOLD_PID=$(pgrep -f "$OLD_SERVER_SCRIPT_PATH")\n\t\t\t\t\t\tif [[ -n "$OLD_PID" ]]; then\n\t\t\t\t\t\t\techo "$OLD_PID" > "$OLD_SERVER_PIDFILE"\n\t\t\t\t\t\t\techo "Restored PID file for $OLD_DISTRO_ID: $OLD_SERVER_PIDFILE."\n\t\t\t\t\t\tfi\n\t\t\t\t\tfi\n\t\t\t\t\t# Check if PID is non-empty and if process with OLD_PID is running\n\t\t\t\t\tif [[ -n "$OLD_PID" ]] && ps -p "$OLD_PID" > /dev/null 2>&1; then\n\t\t\t\t\t\tOLD_RUNNING_PROCESS="$(ps -o pid,args -p $OLD_PID | grep -F $OLD_SERVER_SCRIPT_PATH)"\n\t\t\t\t\t\tif [[ -n "$OLD_RUNNING_PROCESS" ]]; then\n\t\t\t\t\t\t\techo "Old server $OLD_DISTRO_ID (PID $OLD_PID) is running."\n\t\t\t\t\t\tfi\n\t\t\t\t\telse\n\t\t\t\t\t\techo "Old server $OLD_DISTRO_ID (PID $OLD_PID) is not running."\n\t\t\t\t\t\tdelete_server\n\t\t\t\t\t\tcontinue\n\t\t\t\t\tfi\n\t\t\t\telse\n\t\t\t\t\techo "No PID file found for old server $OLD_DISTRO_ID ($OLD_SERVER_PIDFILE) and no processes matching the script path."\n\t\t\t\t\tdelete_server\n\t\t\t\t\tcontinue\n\t\t\t\tfi\n\t\t\tfi\n\t\tdone\n\t\techo "Finished cleaning up old server installations."\n\telse\n\t\techo "No server bin directory found at $SERVER_DATA_DIR/bin. Skipping cleanup of old servers."\n\tfi\n}\n\nterminateTree() {\n\tfor cpid in $(/usr/bin/pgrep -P $1); do\n\t\tterminateTree $cpid\n\tdone\n\tkill -9 $1 > /dev/null 2>&1\n}\n\nkill_running_server() {\n\tif [[ -n "$1" ]]; then\n\t\techo "Killing server process with PID $1 (and all its children)"\n\t\tterminateTree $1\n\tfi\n}\n\n# Check if platform is supported\nKERNEL="$(uname -s)"\ncase $KERNEL in\n\tDarwin)\n\t\tPLATFORM="darwin"\n\t\t;;\n\tLinux)\n\t\tPLATFORM="linux"\n\t\t;;\n\tFreeBSD)\n\t\tPLATFORM="freebsd"\n\t\t;;\n\tDragonFly)\n\t\tPLATFORM="dragonfly"\n\t\t;;\n\t*)\n\t\techo "Error platform not supported: $KERNEL"\n\t\tprint_install_results_and_exit 1\n\t\t;;\nesac\n\n# Check machine architecture\nARCH="$(uname -m)"\ncase $ARCH in\n\tx86_64 | amd64)\n\t\tSERVER_ARCH="x64"\n\t\t;;\n\tarmv7l | armv8l)\n\t\tSERVER_ARCH="armhf"\n\t\t;;\n\tarm64 | aarch64)\n\t\tSERVER_ARCH="arm64"\n\t\t;;\n\tppc64le)\n\t\tSERVER_ARCH="ppc64le"\n\t\t;;\n\triscv64)\n\t\tSERVER_ARCH="riscv64"\n\t\t;;\n\t    loongarch64)\n        SERVER_ARCH="loong64"\n        ;;\n    s390x)\n        SERVER_ARCH="s390x"\n        ;;\n\t*)\n\t\techo "Error architecture not supported: $ARCH"\n\t\tprint_install_results_and_exit 1\n\t\t;;\nesac\n\n# https://www.freedesktop.org/software/systemd/man/os-release.html\nOS_RELEASE_ID="$(grep -i '^ID=' /etc/os-release 2>/dev/null | sed 's/^ID=//gi' | sed 's/"//g')"\nif [ -z $OS_RELEASE_ID ]; then\n\tOS_RELEASE_ID="$(grep -i '^ID=' /usr/lib/os-release 2>/dev/null | sed 's/^ID=//gi' | sed 's/"//g')"\n\tif [ -z $OS_RELEASE_ID ]; then\n\t\tOS_RELEASE_ID="unknown"\n\tfi\nfi\n\n# Create installation folder\nif [ ! -d $SERVER_DIR ]; then\n\tmkdir -p $SERVER_DIR\n\tif (( $? > 0 )); then\n\t\techo "Error creating server install directory"\n\t\tprint_install_results_and_exit 1\n\tfi\nfi\n\n# Acquire lock at the beginning of the script\nacquire_lock\n\n# Add trap to release lock on exit\ntrap release_lock EXIT\n\nclean_up_old_servers\n\nif [ -n "$SSH_AUTH_SOCK" ]; then\n\tln -s -f $SSH_AUTH_SOCK $SERVER_SSH_AGENT_SOCKET\nfi\nexport SSH_AUTH_SOCK=$SERVER_SSH_AGENT_SOCKET\n\n\nSERVER_DOWNLOAD_URL="$(echo "${h.replace(/\$\{/g,"\\${")}" | sed "s/\\\${quality}/$DISTRO_QUALITY/g" | sed "s/\\\${version}/$DISTRO_IDE_VERSION/g" | sed "s/\\\${commit}/$DISTRO_COMMIT/g" | sed "s/\\\${os}/$PLATFORM/g" | sed "s/\\\${arch}/$SERVER_ARCH/g" | sed "s/\\\${release}/$DISTRO_VSCODIUM_RELEASE/g")"\necho "Downloading server from $SERVER_DOWNLOAD_URL"\n\nif [[ "$PLATFORM" == "linux" ]]; then\n\t# Check ldd version based on format "ldd (.*) 2.28"\n\tversion=$(ldd --version | head -n 1 | grep -oE '[0-9]+.[0-9]+$')\n\tif (( $? > 0 )); then\n\t\techo "Warning: ldd not found"\n\t\tGLIBC_VERSION_GOOD="false"\n\telse\n\t\tmajor=$(echo "$version" | cut -d '.' -f 1)\n\t\tminor=$(echo "$version" | cut -d '.' -f 2)\n\n\t\tif [[ "$major" -eq 2 && "$minor" -ge 28 ]]; then\n\t\t\tGLIBC_VERSION_GOOD="true"\n\t\telse\n\t\t\tGLIBC_VERSION_GOOD="false"\n\t\tfi\n\tfi\n\n\tif [[ "$GLIBC_VERSION_GOOD" = "false" ]]; then\n\t\techo "Warning: valid glibc version not found. Codebuddy only supports remote connections with glibc >= 2.28, such as Ubuntu 20.04, Debian 10, or CentOS 8."\n\tfi\nfi\n\nif [ ! -f $SERVER_SCRIPT ] || [ "$NEED_REINSTALL" = "true" ]; then\n\tif [ "$PLATFORM" != "darwin" ] && [ "$PLATFORM" != "linux" ]; then\n\t\techo "Error "$PLATFORM" needs manual installation of remote extension host"\n\t\tprint_install_results_and_exit 1\n\tfi\n\n\tpushd $SERVER_DIR > /dev/null\n\n\ttemp_file=$(mktemp)\n\tdownload_status=1\n\n\tif command -v wget &> /dev/null; then\n        echo "Using wget for download with enhanced options"\n        echo "wget command: wget --tries=1 --timeout=60 --connect-timeout=30 --read-timeout=300 --progress=dot:giga --output-document="$temp_file" "$SERVER_DOWNLOAD_URL""\n        # Use wget with enhanced options and capture both stdout and stderr\n        wget --tries=1 --timeout=60 --connect-timeout=30 --read-timeout=300 --progress=dot:giga --output-document="$temp_file" "$SERVER_DOWNLOAD_URL" 2>&1 | tee wget_output.log\n        download_status=\${PIPESTATUS[0]}\n        echo "wget exit code: $download_status"\n        if [[ -f wget_output.log ]]; then\n            echo "wget output summary:"\n            tail -5 wget_output.log\n            rm -f wget_output.log\n        fi\n    elif command -v curl &> /dev/null; then\n        echo "Using curl for download with enhanced options"\n        echo "curl command: curl --connect-timeout 30 --max-time 600 --location --show-error --fail --progress-bar --output "$temp_file" "$SERVER_DOWNLOAD_URL""\n        # Use curl with enhanced options and capture output\n        curl --connect-timeout 30 --max-time 600 --location --show-error --fail --progress-bar --output "$temp_file" "$SERVER_DOWNLOAD_URL" 2>&1 | tee curl_output.log\n        download_status=\${PIPESTATUS[0]}\n        echo "curl exit code: $download_status"\n        if [[ -f curl_output.log ]]; then\n            echo "curl output summary:"\n            tail -5 curl_output.log\n            rm -f curl_output.log\n        fi\n    else\n        echo "Error: No download tool available (wget or curl required)"\n        print_install_results_and_exit 1\n    fi\n\n\tif [ $download_status -ne 0 ]; then\n\t\techo "Error: Failed to download server from $SERVER_DOWNLOAD_URL"\n\t\techo "Download status: $download_status"\n\t\techo "Please check:"\n\t\techo "  1. Network connectivity"\n\t\techo "  2. Server URL is accessible"\n\t\techo "  3. Firewall settings"\n\t\trm -f $temp_file\n\t\tprint_install_results_and_exit 1\n\tfi\n\n\t# Check if downloaded file is not empty\n\tif [ ! -s $temp_file ]; then\n\t\techo "Error: Downloaded file is empty"\n\t\trm -f $temp_file\n\t\tprint_install_results_and_exit 1\n\tfi\n\n\tmv $temp_file vscode-server.tar.gz\n\n\t# Before extracting it, check the checksum\n\tif [[ ! -z $SHA256_HASH ]]; then\n\t\t# Calculate the checksum of the downloaded file\n\t\tCALCULATED_HASH="$(sha256sum vscode-server.tar.gz | cut -d ' ' -f 1)"\n\n\t\t# Compare with the expected hash\n\t\tif [[ "$CALCULATED_HASH" != "$SHA256_HASH" ]]; then\n\t\t\techo "Error: Checksum verification failed: this usually means the server failed to download correctly."\n\t\t\techo "Expected: $SHA256_HASH"\n\t\t\techo "Got: $CALCULATED_HASH"\n\n\t\t\trm -f vscode-server.tar.gz\n\n\t\t\tprint_install_results_and_exit 1\n\t\telse\n\t\t\techo "Checksum verification passed: $CALCULATED_HASH"\n\t\tfi\n\telse\n\t\techo "Skipping checksum verification"\n\tfi\n\n\ttar -xf vscode-server.tar.gz --strip-components 1\n\tif (( $? > 0 )); then\n\t\techo "Error while extracting server contents"\n\t\tprint_install_results_and_exit 1\n\tfi\n\n\tif [ ! -f $SERVER_SCRIPT ]; then\n\t\techo "Error server contents are corrupted"\n\t\tprint_install_results_and_exit 1\n\tfi\n\n\trm -f vscode-server.tar.gz\n\n\tpopd > /dev/null\nelse\n\techo "Server script already installed in $SERVER_SCRIPT"\nfi\n\n# Try to find if server is already running\nif [[ -f $SERVER_PIDFILE ]]; then\n\tSERVER_PID="$(cat $SERVER_PIDFILE)"\n\tif [[ -z $SERVER_PID ]]; then\n\t\tSERVER_PID=$(pgrep -f "$SERVER_SCRIPT")\n\t\tif [[ -n $SERVER_PID ]]; then\n\t\t\ttouch $SERVER_PIDFILE\n\t\t\techo $SERVER_PID > $SERVER_PIDFILE\n\t\tfi\n\tfi\n\tif [[ -n $SERVER_PID ]]; then\n\t\tif [[ -n $(ps -o pid,args -p $SERVER_PID | grep $SERVER_SCRIPT) ]]; then\n\t\t\tSERVER_RUNNING_PROCESS="$SERVER_PID"\n\t\t\techo "Found running server process: $SERVER_RUNNING_PROCESS"\n\t\tfi\n\tfi\nelse\n\tSERVER_RUNNING_PROCESS="$(pgrep -f "$SERVER_SCRIPT")"\n\tif [[ -z $SERVER_RUNNING_PROCESS ]]; then\n\t\tSERVER_PID=\n\telse\n\t\tSERVER_PID=$SERVER_RUNNING_PROCESS\n\t\ttouch $SERVER_PIDFILE\n\t\techo $SERVER_PID > $SERVER_PIDFILE\n\tfi\nfi\n\nif [ -z "$SERVER_RUNNING_PROCESS" ]; then\n\tif [ -f "$SERVER_LOGFILE" ]; then\n\t\trm $SERVER_LOGFILE\n\tfi\n\tif [ -f "$SERVER_TOKENFILE" ]; then\n\t\trm $SERVER_TOKENFILE\n\tfi\n\n\ttouch $SERVER_TOKENFILE\n\tchmod 600 $SERVER_TOKENFILE\n\tSERVER_CONNECTION_TOKEN="${t}"\n\techo $SERVER_CONNECTION_TOKEN > $SERVER_TOKENFILE\n\n\texport REMOTE_CONTAINERS=true\n\n\t$SERVER_SCRIPT --start-server --host=127.0.0.1 $SERVER_LISTEN_FLAG $SERVER_INITIAL_EXTENSIONS --connection-token-file $SERVER_TOKENFILE --telemetry-level off --enable-remote-auto-shutdown --accept-server-license-terms &> $SERVER_LOGFILE & disown\n\techo $! > $SERVER_PIDFILE\n\tSERVER_PID=$(cat $SERVER_PIDFILE)\nelse\n\techo "Server script is already running $SERVER_SCRIPT"\nfi\n\nif [[ -f $SERVER_TOKENFILE && -n $(cat $SERVER_TOKENFILE) ]]; then\n\tSERVER_CONNECTION_TOKEN="$(cat $SERVER_TOKENFILE)"\nelse\n\techo "Error server token file not found $SERVER_TOKENFILE"\n\tif [[ -n $SERVER_PID ]]; then\n\t\tkill_running_server $SERVER_PID\n\tfi\n\tprint_install_results_and_exit 1\nfi\n\nif [ -f "$SERVER_LOGFILE" ]; then\n\tfor i in {1..5}; do\n\t\tLISTENING_ON="$(cat $SERVER_LOGFILE | grep -E 'Extension host agent listening on .+' | sed 's/Extension host agent listening on //')"\n\t\tif [ -n "$LISTENING_ON" ]; then\n\t\t\tbreak\n\t\tfi\n\t\tsleep 0.5\n\tdone\n\n\tif [ -z "$LISTENING_ON" ]; then\n\t\techo "Error server did not start sucessfully"\n\t\tif [[ -n $SERVER_PID ]]; then\n\t\t\tkill_running_server $SERVER_PID\n\t\tfi\n\t\tprint_install_results_and_exit 1\n\tfi\nelse\n\techo "Error server log file not found $SERVER_LOGFILE"\n\tif [[ -n $SERVER_PID ]]; then\n\t\tkill_running_server $SERVER_PID\n\tfi\n\tprint_install_results_and_exit 1\nfi\n\n# Finish server setup\nprint_install_results_and_exit 0\n`};const o=n(982)},265:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.activate=async function(e){console.log('Congratulations, your extension "codebuddy-dev-containers" is now active!');const t=S.default.getInstance();if(e.subscriptions.push(t),c.env.remoteAuthority){const e=c.env.remoteAuthority.includes("@");c.commands.executeCommand("setContext","codebuddy.isNestedContainer",e)}const n=new O.DevContainerResolver(e);console.log(`[Extension] Registering RemoteAuthorityResolver for: ${C.DEV_CONTAINER_AUTHORITY}`),t.info(`[Extension] Registering RemoteAuthorityResolver for: ${C.DEV_CONTAINER_AUTHORITY}`),e.subscriptions.push(c.workspace.registerRemoteAuthorityResolver(C.DEV_CONTAINER_AUTHORITY,n)),e.subscriptions.push(n),D.EnvironmentUtils.initialize(),t.info(c.env.remoteName?`Remote name: ${c.env.remoteName}`:"Remote name is not set"),t.info(c.env.remoteAuthority?`Remote authority: ${c.env.remoteAuthority}`:"Remote authority is not set"),t.info(`Base remote authority: ${D.EnvironmentUtils.getBaseRemoteAuthority()||"none"}`),t.info(`Is local environment: ${D.EnvironmentUtils.getIsLocal()}`);const o=l.TreeDataProvider.getInstance(e);(function(e,t){const n=c.window.createTreeView("codebuddyDevContainers",{treeDataProvider:t});e.subscriptions.push(n.onDidChangeVisibility(e=>{e.visible&&t.refresh()})),e.subscriptions.push(n)})(e,o),function(e){new d.RefreshTreeCommand(e).init();new g.OpenFolderInContainerCommand(e).init();new p.ReopenInContainerCommand(e).init();new m.AttachToRunningContainerCommand(e).init();new _.ReopenFolderLocallyCommand(e).init();new v.ShowLogCommand(e).init();new E.OpenFromHistoryCommand(e).init();new w.DeleteContainerCommand(e).init()}(e),function(e){new f.WorkspaceListener(e),new u.ConfigurationListener(e)}(e);const r=new h.DevContainerDetector(e);c.env.remoteAuthority?.startsWith(C.DEV_CONTAINER_AUTHORITY)&&(await r.markOpenedInContainer(),o.refresh()),e.subscriptions.push(r)},t.deactivate=function(){};const c=a(n(398)),l=n(90),d=n(904),u=n(353),f=n(66),h=n(681),g=n(780),p=n(34),m=n(682),_=n(370),v=n(517),E=n(985),w=n(650),O=n(9),C=n(603),D=n(283),S=s(n(877))},278:e=>{e.exports=require("net")},283:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.EnvironmentUtils=void 0;const s=a(n(398));t.EnvironmentUtils=class{static initialize(){let e=s.env.remoteAuthority;e?.includes("@")&&(e=e.split("@")[1]),e?.startsWith("dev-container+")&&(e=void 0),this.baseRemoteAuthority=e,this.isLocal=void 0===e}static getBaseRemoteAuthority(){return this.baseRemoteAuthority}static getIsLocal(){return this.isLocal}static refresh(){this.initialize()}}},299:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.COMMAND_EXPLORER_DELETE_CONTAINER=t.COMMAND_EXPLORER_OPEN_FROM_HISTORY=t.COMMAND_SHOW_LOG=t.COMMAND_REOPEN_FOLDER_LOCALLY=t.COMMAND_ATTACH_TO_RUNNING_CONTAINER=t.COMMAND_REOPEN_IN_CONTAINER=t.COMMAND_OPEN_FOLDER_IN_CONTAINER=t.COMMAND_REFRESH_TREE=void 0,t.COMMAND_REFRESH_TREE="codebuddy-dev-containers.explorer.refresh",t.COMMAND_OPEN_FOLDER_IN_CONTAINER="codebuddy-dev-containers.openFolderInContainer",t.COMMAND_REOPEN_IN_CONTAINER="codebuddy-dev-containers.reopenInContainer",t.COMMAND_ATTACH_TO_RUNNING_CONTAINER="codebuddy-dev-containers.attachToRunningContainer",t.COMMAND_REOPEN_FOLDER_LOCALLY="codebuddy-dev-containers.reopenFolderLocally",t.COMMAND_SHOW_LOG="codebuddy-dev-containers.showLog",t.COMMAND_EXPLORER_OPEN_FROM_HISTORY="codebuddy-dev-containers.openFromHistory",t.COMMAND_EXPLORER_DELETE_CONTAINER="codebuddy-dev-containers.explorer.deleteContainer"},303:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.forwardPort=async function(e,t,n,o,r,i,a){const c=s.createServer(a=>{!async function({socket:e,containerId:t,options:n,remoteServerNodePath:o,remoteUser:r,execServer:i,logger:a}){const s=f(n);try{a.info("Got connection.");const n=["docker","exec","-u",r,"-i",t,"bash","-c",`${o} -e "${s}"`],c=await i.spawn(n[0],n.slice(1),{env:l(await d(i))});c.onExit.then(()=>{e.end()}),e.on("close",()=>{c.stdin.write(Buffer.from("--kill--\n"))}),c.stdin&&c.stdout&&(a.info("Bidirectional pipe set up"),c.stdout.onDidReceiveMessage(t=>{e.write(t)}),e.on("data",e=>{c.stdin.write(e)}))}catch(t){a.error(`handleClient error: ${t}`),e.end()}}({socket:a,containerId:t,options:{port:e},remoteServerNodePath:n,remoteUser:o,execServer:i,logger:r})});return new Promise((e,n)=>{c.on("error",n),c.listen(0,"127.0.0.1",()=>{const o=c.address();if(o&&"string"!=typeof o){const n=o.port;h(t,r,i,a?.signal).then(()=>{c.close()}),e(n)}else n(new Error("Failed to get server address"))})})},t.forwardSocket=async function(e,t,n,o,r,i,a,s){const c=new Map;await async function(e,t,n,o,r,i,a,s){const c=f(n);try{a.info("Got connection.");const n=["docker","exec","-u",r,"-i",t,"bash","-c",`${o} -e "${c}"`],f=await i.spawn(n[0],n.slice(1),{env:l(await d(i))});if(f.onExit.then(()=>{s.forEach(e=>{e.end()})}),f.stdin&&f.stdout){let t=Buffer.alloc(0),n=u.HeaderId,o=0,r=0,a=0;const c=new Map,l=new Map,d=4,h=4;f.stdout.onDidReceiveMessage(g=>{t=Buffer.concat([t,g]);let m=!1;do{m=!1;let g=0;if(n===u.HeaderId&&a+d<=t.length&&(o=t.subarray(a,a+d).readUInt32BE(),g=o,a+=d,n=u.HeaderLen,!c.has(g))){const t=Promise.resolve(),n=Promise.resolve();c.set(g,t),l.set(g,n),p(i,e).then(e=>{s.set(g,e),e.on("close",()=>{s.has(g)&&s.delete(g)}),e.on("data",e=>{const t=Buffer.alloc(d);t.writeUInt32BE(g);const n=Buffer.alloc(h);n.writeUInt32BE(e.length),f.stdin.write(Buffer.concat([t,n,e]))})})}if(n===u.HeaderLen&&a+h<=t.length&&(r=t.subarray(a,a+h).readUInt32BE(),a+=h,n=u.Payload),n===u.Payload&&a+r<=t.length){const e=t.subarray(a,a+r);a+=r,n=u.HeaderId,m=!0,g=o;const i=0===e.length?c.get(g):l.get(g);i?.then(()=>{0===e.length?(s.get(g)?.end(),s.delete(g)):s.get(g)?.write(e)})}}while(m);a>0&&(t=t.subarray(a),a=0)})}}catch(e){a.error(`handleSocketForward error: ${e}`)}}(t,e,{socket:n},o,r,a,i,c),i.info("====socketForward=success===="),await h(e,i,a,s?.signal).then(()=>{c.forEach(e=>{e.end()})})};const s=a(n(278)),c=n(323);function l(e){const t={};for(const[n,o]of Object.entries(e))void 0!==o&&(t[n]=o);return t}async function d(e){return new Promise(t=>{e.env().then(e=>{t(e.env)})})}var u;function f(e){if(e.socket&&e.port||!e.socket&&!e.port)throw new Error("Invalid arguments, exactly one of socket or port must be provided.");const t=e.port?`{ host: '127.0.0.1', port: ${e.port}}`:`{ path: '${e.socket}'}`,n="\n\t\tconsole.error('--- SCRIPT STARTED ---');\n\t\tconst net = require('net');\n\t\tconst fs = require('fs');\n\t\tconst handleError = (err) => process.stderr.write(err && (err.stack || err.message) || String(err));\n\t\tconst handleClose = (hadError) => {\n\t\t\tconsole.error(hadError ? 'Remote close with error' : 'Remote close');\n\t\t\tprocess.exit(hadError ? 1 : 0);\n\t\t};\n\t\tprocess.stdin.on('close', handleClose);\n\t\tprocess.on('uncaughtException', (err) => {\n\t\t\tfs.writeSync(process.stderr.fd, 'error: ' + (err.stack || err.message) + '\\n');\n\t\t\tprocess.exit(1);\n\t\t});";if(e.port||e.usePortVersionForSocket)return n+`\n\t\tconst Transform = require('stream').Transform;\n\t\tprocess.stdin.pause();\n\t\tconst client = net.createConnection(${t}, () => {\n\t\t\tconsole.error('Connection established');\n\t\t\tconst filterKill = new Transform({\n\t\t\t\ttransform(chunk, _enc, cb) {\n\t\t\t\t\tif (chunk.toString().trim() !== '--kill--') this.push(chunk);\n\t\t\t\t\telse process.exit(0);\n\t\t\t\t\tcb();\n\t\t\t\t}\n\t\t\t});\n\t\t\tclient.pipe(process.stdout);\n\t\t\tprocess.stdin.pipe(filterKill).pipe(client);\n\t\t});\n\t\tclient.on('close', handleClose);\n\t\tclient.on('error', handleError);\n\t\tprocess.stdin.on('data', (data) => {\n\t\t\tif (data.toString().trim() === '--kill--') process.exit(0);\n\t\t});`;if(e.socket)return n+`\n\t\tconst [ID, LEN, PAYLOAD] = [0, 1, 2], [idLen, lenLen] = [4, 4];\n\t\tlet buffer = Buffer.alloc(0), state = ID, parsedId = 0, parsedLen = 0, offset = 0, id = 0;\n\t\tconst socketMap = new Map();\n\t\tconst writeFrame = (socketId, data) => {\n\t\t\tconst idBuf = Buffer.allocUnsafe(idLen), lenBuf = Buffer.allocUnsafe(lenLen);\n\t\t\tidBuf.writeUInt32BE(socketId); lenBuf.writeUInt32BE(data.length);\n\t\t\tprocess.stdout.write(Buffer.concat([idBuf, lenBuf, data]));\n\t\t};\n\t\tconst server = net.createServer((socket) => {\n\t\t\tconsole.error('Connection established');\n\t\t\tconst socketId = id++;\n\t\t\tsocketMap.set(socketId, socket);\n\t\t\tsocket.on('data', (data) => writeFrame(socketId, data));\n\t\t\tconst endSocket = () => {\n\t\t\t\tif (socketMap.has(socketId)) {\n\t\t\t\t\twriteFrame(socketId, Buffer.alloc(0));\n\t\t\t\t\tsocketMap.delete(socketId);\n\t\t\t\t}\n\t\t\t\tsocket.destroy();\n\t\t\t};\n\t\t\tsocket.on('close', endSocket);\n\t\t\tsocket.on('error', (err) => { console.error(err); endSocket(); });\n\t\t\tsocket.on('end', () => socket.end());\n\t\t});\n\t\tprocess.stdin.on('data', (data) => {\n\t\t\tbuffer = Buffer.concat([buffer, data]);\n\t\t\twhile (true) {\n\t\t\t\tif (state === ID && offset + idLen <= buffer.length) {\n\t\t\t\t\tparsedId = buffer.readUInt32BE(offset);\n\t\t\t\t\toffset += idLen; state = LEN;\n\t\t\t\t}\n\t\t\t\tif (state === LEN && offset + lenLen <= buffer.length) {\n\t\t\t\t\tparsedLen = buffer.readUInt32BE(offset);\n\t\t\t\t\toffset += lenLen; state = PAYLOAD;\n\t\t\t\t}\n\t\t\t\tif (state === PAYLOAD && offset + parsedLen <= buffer.length) {\n\t\t\t\t\tconst payload = buffer.subarray(offset, offset + parsedLen);\n\t\t\t\t\toffset += parsedLen; state = ID;\n\t\t\t\t\tsocketMap.get(parsedId)?.write(payload);\n\t\t\t\t}\n\t\t\t\telse break;\n\t\t\t}\n\t\t\tif (offset > 0) { buffer = buffer.subarray(offset); offset = 0; }\n\t\t});\n\t\tserver.listen(${t});\n\t\tserver.on('close', handleClose);\n\t\tserver.on('error', handleError);`;throw new Error("Invalid arguments, exactly one of socket or port must be provided.")}async function h(e,t,n,o){for(;!o?.aborted;){const r=await g(e,".State.Running","true",t,n),i=await g(e,".State.Restarting","true",t,n);if(!await g(e,".State.Status","created",t,n)&&!i&&!r)break;await new Promise(e=>{const t=setTimeout(e,1e4);o&&o.addEventListener("abort",()=>{clearTimeout(t),e()},{once:!0})})}}async function g(e,t,n,o,r){try{const o=await r.spawn("docker",["inspect","-f",`{{${t}}}`,e],{env:l(await d(r))});let i="";return o.stdout.onDidReceiveMessage(e=>{i+=Buffer.from(e).toString()}),await o.onExit,i.trim()===n}catch(e){return o.error(`Error getting container status: ${e.message}`),!1}}async function p(e,t){if(e instanceof c.LocalExecServer)return s.createConnection(t);throw new Error("Remote socket connections not yet implemented")}!function(e){e[e.HeaderId=0]="HeaderId",e[e.HeaderLen=1]="HeaderLen",e[e.Payload=2]="Payload"}(u||(u={}))},317:e=>{e.exports=require("child_process")},323:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.LocalExecServer=void 0,t.getExecServer=async function(e){if(!e)return new l;if("function"!=typeof c.workspace.getRemoteExecServer)return new l;try{const t=await c.workspace.getRemoteExecServer(e);if(!t)throw new Error(`Failed to get remote exec server ${e}`);return t}catch(e){throw e}};const s=a(n(317)),c=a(n(398));class l{constructor(){this.fs=new d}async spawn(e,t,n){return new Promise((o,r)=>{const i=s.spawn(e,t,{cwd:n?.cwd,env:n?.env?{...process.env,...n.env}:process.env});i.on("error",r),i.on("spawn",()=>{const e={stdin:f(i.stdin),stdout:u(i.stdout),stderr:u(i.stderr),onExit:new Promise(e=>{i.on("close",t=>{e({status:t||0})})})};o(e)})})}async env(){const e={};for(const[t,n]of Object.entries(process.env))void 0!==n&&(e[t]=n);return{env:e,osPlatform:process.platform}}async kill(e){try{process.kill(e)}catch(t){throw new Error(`Failed to kill process ${e}: ${t}`)}}async tcpConnect(e,t){const o=n(278);return new Promise((n,r)=>{const i=new o.Socket;i.connect(t,e,()=>{const e=new c.EventEmitter,t={write:e=>i.write(e),end:()=>i.end(),onDidReceiveMessage:e.event,onEnd:new Promise(e=>{i.on("end",()=>e())})},o=new Promise(e=>{i.on("close",()=>e())});i.on("data",t=>{e.fire(new Uint8Array(t))}),n({stream:t,done:o})}),i.on("error",e=>{r(e)})})}}t.LocalExecServer=l;class d{async stat(e){const t=n(896),o=await t.promises.stat(e);return{type:o.isFile()?c.FileType.File:o.isDirectory()?c.FileType.Directory:o.isSymbolicLink()?c.FileType.SymbolicLink:c.FileType.Unknown,ctime:o.ctimeMs,mtime:o.mtimeMs,size:o.size,permissions:o.mode}}async mkdirp(e){const t=n(896);await t.promises.mkdir(e,{recursive:!0})}async rm(e){const t=n(896);try{(await t.promises.stat(e)).isDirectory()?await t.promises.rm(e,{recursive:!0,force:!0}):await t.promises.unlink(e)}catch(e){if("ENOENT"!==e?.code)throw e}}async read(e){return u(n(896).createReadStream(e))}async write(e){const t=n(896).createWriteStream(e),o=new Promise(e=>{t.on("finish",()=>e())});return{stream:f(t),done:o}}async connect(e){throw new Error("Unix domain socket connection not implemented in LocalFileSystem")}async rename(e,t){const o=n(896);await o.promises.rename(e,t)}async readdir(e){const t=n(896);return(await t.promises.readdir(e,{withFileTypes:!0})).map(e=>({name:e.name,type:e.isFile()?c.FileType.File:e.isDirectory()?c.FileType.Directory:e.isSymbolicLink()?c.FileType.SymbolicLink:c.FileType.Unknown}))}}function u(e){const t=new c.EventEmitter,n=new Promise(n=>{e.on("end",()=>{t.dispose(),n()})});return e.on("data",e=>{t.fire(new Uint8Array(e))}),{onDidReceiveMessage:t.event,onEnd:n}}function f(e){return{write:t=>e.write(Buffer.from(t)),end:()=>e.end()}}},343:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ROOT_USER=t.DockerUtils=void 0,t.checkDockerVersion=async function(e,t){const n=t||"docker";try{const t=await(0,u.executeCommandWithExecServer)(n,["--version"],e,void 0);return console.log("Docker version:",t.stdout),t.stdout.trim()}catch(e){throw new Error(t?`Docker not found at ${t}. Please ensure Docker is installed correctly.`:"Docker not found in PATH. Please ensure Docker is installed and accessible.")}},t.findDockerPath=async function(e){const t=["docker","/usr/local/bin/docker","/usr/bin/docker","/opt/homebrew/bin/docker","/Applications/Docker.app/Contents/Resources/bin/docker","/snap/bin/docker","/c/Program Files/Docker/Docker/resources/bin/docker.exe","C:\\Program Files\\Docker\\Docker\\resources\\bin\\docker.exe"];for(const n of t)try{const{stdout:t}=await(0,u.executeCommandWithExecServer)(n,["--version"],e,void 0);if(t&&t.includes("Docker"))return n}catch{}return null},t.inspectDockerContainer=g,t.getContainerImageName=async function(e,t){try{const{stdout:n}=await(0,u.executeCommandWithExecServer)("docker",["inspect","-f","{{ .Config.Image }}",e],t,void 0);return n.trim()}catch(e){return void console.error("Failed to get container image name:",e)}},t.getContainerName=async function(e,t){try{const{stdout:n}=await(0,u.executeCommandWithExecServer)("docker",["inspect","-f","{{ .Name }}",e],t,void 0);return n.trim().replace(/^\//,"")}catch(e){return void console.error("Failed to get container name:",e)}},t.findBestRemoteUser=async function(e,t,n){if(e.configuration?.remoteUser)return e.configuration.remoteUser;try{const e=await g(t,n);if(e.Config?.User)return e.Config.User}catch(e){console.error("Failed to inspect container:",e)}return"root"},t.findBestRemoteUserForAttach=async function(e,t,n){return e.Config?.User?e.Config.User:"root"},t.getContainerWorkspaceFolder=async function(e){if(e.Config?.WorkingDir&&"/"!==e.Config.WorkingDir)return e.Config.WorkingDir;if(e.Mounts&&Array.isArray(e.Mounts))for(const t of e.Mounts)if(t.Destination&&t.Destination.includes("workspace"))return t.Destination;return"/workspace"},t.ensureWorkspaceExists=async function(e,t,n){try{await(0,u.executeCommandWithExecServer)("docker",["exec",e,"mkdir","-p",t],n,void 0)}catch(e){console.error(`Failed to create workspace directory ${t}:`,e)}},t.executePostAttachCommand=async function(e,t,n,o,r){if(e)try{if(h.getOutputChannel().appendLine("Executing postAttachCommand..."),"object"==typeof e&&!Array.isArray(e)){h.getOutputChannel().appendLine("Executing postAttachCommand in parallel mode...");const i=Object.entries(e).map(([e,i])=>(h.getOutputChannel().appendLine(`Starting parallel command: ${e}`),p(i,t,n,o,r,e)));return await Promise.all(i),void h.getOutputChannel().appendLine("All parallel postAttachCommands completed successfully")}await p(e,t,n,o,r),h.getOutputChannel().appendLine("postAttachCommand completed successfully")}catch(e){h.getOutputChannel().appendLine(`Warning: postAttachCommand failed: ${e}`)}};const s=a(n(398)),c=a(n(317)),l=a(n(928)),d=a(n(896)),u=n(798),f=n(603);class h{static getOutputChannel(){return h.outputChannel||(h.outputChannel=s.window.createOutputChannel("Codebuddy Dev Containers")),h.outputChannel}static async getRunningContainers(){try{const e=await h.executeCommand('docker ps --format "{{.ID}}|{{.Names}}|{{.Image}}|{{.Status}}|{{.CreatedAt}}"'),t=[],n=e.trim().split("\n").filter(e=>e.trim());for(const e of n){const[n,o,r,i,a]=e.split("|");t.push({id:n.trim(),name:o.trim(),image:r.trim(),status:i.toLowerCase().includes("up")?"running":"stopped",createdAt:new Date(a.trim()),lastUsed:new Date})}return t}catch(e){return h.getOutputChannel().appendLine(`Error getting running containers: ${e}`),[]}}static async getRunningContainersWithExecServer(e,t){try{const n=await h.executeDockerCommand(["ps","--format","{{.ID}}|{{.Names}}|{{.Image}}|{{.Status}}|{{.CreatedAt}}"],e,t),o=[],r=n.trim().split("\n").filter(e=>e.trim());for(const e of r){const[t,n,r,i,a]=e.split("|");o.push({id:t.trim(),name:n.trim(),image:r.trim(),status:i.toLowerCase().includes("up")?"running":"stopped",createdAt:new Date(a.trim()),lastUsed:new Date})}return o}catch(e){return h.getOutputChannel().appendLine(`Error getting running containers: ${e}`),[]}}static async buildDevContainer(e,t,n){const o=`codebuddy-devcontainer-${l.basename(e)}-${Date.now()}`;try{if(n.report({message:"Preparing build context..."}),t.image)return await h.createContainerFromImage(e,t,o,n);if(t.build?.dockerfile||t.dockerFile)return await h.buildFromDockerfile(e,t,o,n);throw new Error("No image or Dockerfile specified in devcontainer configuration")}catch(e){throw h.getOutputChannel().appendLine(`Error building dev container: ${e}`),e}}static async createContainerFromImage(e,t,n,o){o.report({message:`Pulling image ${t.image}...`});try{await h.executeCommand(`docker pull ${t.image}`)}catch(e){h.getOutputChannel().appendLine(`Warning: Could not pull image ${t.image}: ${e}`)}o.report({message:"Creating container..."});const r=["docker","run","-d","--name",n,"-v",`${e}:${t.workspaceFolder||"/workspace"}`];if(t.forwardPorts)for(const e of t.forwardPorts)r.push("-p",`${e}:${e}`);if(t.mounts)for(const e of t.mounts)r.push("--mount","string"==typeof e?e:JSON.stringify(e));t.workspaceFolder&&r.push("-w",t.workspaceFolder),t.remoteUser&&r.push("--user",t.remoteUser),r.push(t.image),r.push("sleep","infinity");const i=await h.executeCommand(r.join(" "));return o.report({message:"Running post-create commands..."}),await h.runPostCreateCommands(i.trim(),t),i.trim()}static async buildFromDockerfile(e,t,n,o){const r=t.build?.dockerfile||t.dockerFile||"Dockerfile",i=t.build?.context||".",a=l.join(e,r);if(!d.existsSync(a))throw new Error(`Dockerfile not found at ${a}`);o.report({message:"Building Docker image..."});const s=`codebuddy-devcontainer-${l.basename(e).toLowerCase()}:latest`,c=["docker","build","-t",s];if(t.build?.args)for(const[e,n]of Object.entries(t.build.args))c.push("--build-arg",`${e}=${n}`);c.push("-f",r,i),await h.executeCommand(c.join(" "),{cwd:e}),o.report({message:"Creating container from built image..."});const u={...t,image:s};return await h.createContainerFromImage(e,u,n,o)}static async runPostCreateCommands(e,t){const n=[t.postCreateCommand,t.postStartCommand].filter(e=>e);for(const t of n)if(t)try{const n=Array.isArray(t)?t.join(" && "):t;await h.executeCommand(`docker exec ${e} sh -c "${n}"`)}catch(e){h.getOutputChannel().appendLine(`Warning: Post-create command failed: ${e}`)}}static async startContainer(e){await h.executeCommand(`docker start ${e}`)}static async stopContainer(e){await h.executeCommand(`docker stop ${e}`)}static async removeContainer(e){try{await h.executeCommand(`docker stop ${e}`)}catch(e){}await h.executeCommand(`docker rm ${e}`)}static async getContainerInfo(e){try{const t=await h.executeCommand(`docker inspect ${e} --format "{{.Name}}|{{.Config.Image}}|{{.State.Status}}|{{.Created}}"`),[n,o,r,i]=t.trim().split("|");return{id:e,name:n.replace(/^\//,""),image:o,status:r,createdAt:new Date(i),lastUsed:new Date}}catch(e){return null}}static executeCommand(e,t){return new Promise((n,o)=>{h.getOutputChannel().appendLine(`Executing: ${e}`),c.exec(e,t,(e,t,r)=>{e?(h.getOutputChannel().appendLine(`Error: ${e.message}`),r&&h.getOutputChannel().appendLine(`Stderr: ${r}`),o(e)):(t&&h.getOutputChannel().appendLine(`Output: ${t}`),n(t?t.toString():""))})})}static async executeDockerCommand(e,t,n){const o=n||"docker";h.getOutputChannel().appendLine(`Executing: ${o} ${e.join(" ")}`);try{const{stdout:n,stderr:r}=await(0,u.executeCommandWithExecServer)(o,e,t,void 0);return n&&h.getOutputChannel().appendLine(`Output: ${n}`),r&&h.getOutputChannel().appendLine(`Stderr: ${r}`),n}catch(e){const t=e instanceof Error?e.message:String(e);throw h.getOutputChannel().appendLine(`Error: ${t}`),e}}static async openContainerInVSCode(e,t){try{const n=`vscode-remote://${f.DEV_CONTAINER_AUTHORITY}+${Buffer.from(e).toString("hex")}${t||"/workspace"}`;await s.commands.executeCommand("vscode.openFolder",s.Uri.parse(n),!0)}catch(e){throw new Error(`Failed to open container in VSCode: ${e}`)}}}async function g(e,t){const{stdout:n}=await(0,u.executeCommandWithExecServer)("docker",["inspect",e],t,void 0);return JSON.parse(n)[0]}async function p(e,n,o,r,i,a){const s=i||"docker",c=["exec"];o&&o!==t.ROOT_USER&&c.push("-u",o),c.push(n),Array.isArray(e)?c.push(...e):c.push("sh","-c",e);const l=a?`[${a}] `:"";h.getOutputChannel().appendLine(`${l}Running: ${Array.isArray(e)?e.join(" "):e}`),await(0,u.executeCommandWithExecServer)(s,c,r,void 0),a&&h.getOutputChannel().appendLine(`${l}Completed successfully`)}t.DockerUtils=h,t.ROOT_USER="root"},353:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationListener=void 0;const r=o(n(398)),i=n(362),a=n(299);class s extends i.BaseListener{constructor(e){super(e),r.default.workspace.onDidChangeConfiguration(e=>{this.run(e)})}run(e){e.affectsConfiguration("codebuddy-dev-containers")&&r.default.commands.executeCommand(a.COMMAND_REFRESH_TREE)}}t.ConfigurationListener=s},362:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseListener=void 0,t.BaseListener=class{constructor(e){this.context=e}}},370:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReopenFolderLocallyCommand=void 0;const c=a(n(398)),l=n(299),d=n(890),u=n(704),f=s(n(877));class h extends d.BaseCommand{constructor(e){super(e),this.commandId=l.COMMAND_REOPEN_FOLDER_LOCALLY,this.logger=f.default.getInstance()}async run(){try{const e=this.getDevContainerWorkspaceInfo();if(!e)return void c.window.showErrorMessage("Failed to get Dev Container workspace information.");if("config"!==e.getType())return void c.window.showErrorMessage("The container is not linked to any local workspace.");const t=e.getConfigSetting();await c.commands.executeCommand("workbench.action.remote.close"),await c.commands.executeCommand("vscode.openFolder",c.Uri.file(t.workspacePath))}catch(e){this.logger.error("Failed to reopen folder locally:",e),this.logger.show(),c.window.showErrorMessage("Failed to reopen folder locally.")}}getDevContainerWorkspaceInfo(){try{const e=c.workspace.workspaceFolders||[];for(const t of e)return u.DevContainerDestination.parseAuthority(t.uri.authority);return null}catch(e){return this.logger.error("Failed to get Dev Container workspace information:",e),this.logger.show(),null}}}t.ReopenFolderLocallyCommand=h},398:e=>{e.exports=require("vscode")},489:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorHandler=t.ErrorType=void 0;const s=a(n(398));var c;!function(e){e.DOCKER_NOT_AVAILABLE="DOCKER_NOT_AVAILABLE",e.CONTAINER_BUILD_FAILED="CONTAINER_BUILD_FAILED",e.CONTAINER_START_FAILED="CONTAINER_START_FAILED",e.CONFIG_INVALID="CONFIG_INVALID",e.CONFIG_NOT_FOUND="CONFIG_NOT_FOUND",e.PERMISSION_DENIED="PERMISSION_DENIED",e.NETWORK_ERROR="NETWORK_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(c||(t.ErrorType=c={}));class l{static getOutputChannel(){return l.outputChannel||(l.outputChannel=s.window.createOutputChannel("Codebuddy Dev Containers - Errors")),l.outputChannel}static handleError(e,t){const n=l.categorizeError(e),o=l.getOutputChannel();return o.appendLine(`[${(new Date).toISOString()}] Error in ${t||"unknown context"}`),o.appendLine(`Type: ${n.type}`),o.appendLine(`Message: ${n.message}`),n.details&&o.appendLine(`Details: ${n.details}`),o.appendLine("---"),n}static async showErrorWithActions(e){const t=[];switch(e.type){case c.DOCKER_NOT_AVAILABLE:t.push("Install Docker","Show Logs");break;case c.CONFIG_INVALID:t.push("Edit Configuration","Show Validation Details");break;case c.CONFIG_NOT_FOUND:t.push("Create Configuration","Use Default");break;case c.CONTAINER_BUILD_FAILED:t.push("Show Build Logs","Retry","Edit Configuration");break;case c.PERMISSION_DENIED:t.push("Show Docker Setup Guide","Show Logs");break;default:t.push("Show Logs","Report Issue")}const n=await s.window.showErrorMessage(e.message,...t);n&&await l.executeAction(n,e)}static categorizeError(e){const t=e?.message||e?.toString()||"Unknown error",n=t.toLowerCase();return n.includes("docker")&&(n.includes("not found")||n.includes("command not found"))?{type:c.DOCKER_NOT_AVAILABLE,message:"Docker is not installed or not available in PATH",details:t,suggestions:["Install Docker Desktop from https://docker.com","Make sure Docker is running","Add Docker to your system PATH"]}:n.includes("cannot connect to the docker daemon")?{type:c.DOCKER_NOT_AVAILABLE,message:"Docker daemon is not running",details:t,suggestions:["Start Docker Desktop",'Run "sudo systemctl start docker" on Linux',"Check Docker service status"]}:n.includes("permission denied")||n.includes("access denied")?{type:c.PERMISSION_DENIED,message:"Permission denied when accessing Docker",details:t,suggestions:["Add your user to the docker group: sudo usermod -aG docker $USER","Run Docker Desktop as administrator","Check file permissions for Docker socket"]}:n.includes("network")||n.includes("timeout")||n.includes("connection refused")?{type:c.NETWORK_ERROR,message:"Network error occurred during container operation",details:t,suggestions:["Check your internet connection","Verify Docker registry accessibility","Check firewall settings"]}:n.includes("build")&&n.includes("failed")?{type:c.CONTAINER_BUILD_FAILED,message:"Failed to build dev container",details:t,suggestions:["Check Dockerfile syntax","Verify base image availability","Check build context and file paths"]}:n.includes("start")&&n.includes("failed")?{type:c.CONTAINER_START_FAILED,message:"Failed to start container",details:t,suggestions:["Check container logs","Verify port availability","Check resource constraints"]}:n.includes("config")||n.includes("devcontainer.json")?{type:c.CONFIG_INVALID,message:"Invalid devcontainer configuration",details:t,suggestions:["Validate JSON syntax","Check configuration schema","Review devcontainer documentation"]}:{type:c.UNKNOWN_ERROR,message:`An unexpected error occurred: ${t}`,details:t,suggestions:["Check the output logs for more details","Try restarting VSCode","Report this issue if it persists"]}}static async executeAction(e,t){switch(e){case"Install Docker":s.env.openExternal(s.Uri.parse("https://docs.docker.com/get-docker/"));break;case"Show Logs":l.getOutputChannel().show();break;case"Show Build Logs":s.commands.executeCommand("workbench.action.output.show");break;case"Edit Configuration":const e=s.workspace.workspaceFolders;if(e&&e.length>0){const t=s.Uri.joinPath(e[0].uri,".devcontainer","devcontainer.json");try{const e=await s.workspace.openTextDocument(t);await s.window.showTextDocument(e)}catch(e){s.window.showErrorMessage("Could not open devcontainer configuration file")}}break;case"Create Configuration":s.commands.executeCommand("codebuddy-dev-containers.createConfig");break;case"Use Default":s.commands.executeCommand("codebuddy-dev-containers.useDefaultConfig");break;case"Show Docker Setup Guide":s.env.openExternal(s.Uri.parse("https://docs.docker.com/engine/install/"));break;case"Show Validation Details":if(t.suggestions){const e=`Configuration issues:\n${t.suggestions.join("\n")}`;s.window.showInformationMessage(e)}break;case"Retry":s.commands.executeCommand("codebuddy-dev-containers.openInContainer");break;case"Report Issue":const n="";s.env.openExternal(s.Uri.parse(n))}}static createProgressReporter(e,t=!0){return s.window.withProgress({location:s.ProgressLocation.Notification,title:e,cancellable:t},async(e,t)=>({progress:e,token:t,report:(t,n)=>{e.report({message:t,increment:n})},isCancelled:()=>t.isCancellationRequested}))}}t.ErrorHandler=l},517:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShowLogCommand=void 0;const r=n(299),i=n(890),a=o(n(877));class s extends i.BaseCommand{constructor(e){super(e),this.commandId=r.COMMAND_SHOW_LOG,this.logger=a.default.getInstance()}async run(){this.logger.show()}}t.ShowLogCommand=s},523:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getVSCodeServerConfig=async function(e){const t=await async function(){if(!g){const e=await(0,u.readFile)(l.join(c.env.appRoot,"product.json"),"utf8");g=JSON.parse(e)}return g}(),n=c.workspace.getConfiguration("remote.SSH.experimental").get("serverBinaryName","");return{version:t.genieVersion||c.version.replace("-insider",""),commit:t.commit||t.genieVersion,quality:t.quality||"stable",release:t.release,serverApplicationName:n||t.serverApplicationName,serverDataFolderName:t.serverDataFolderName||".vscode-server",serverDownloadUrlTemplate:t.serverDownloadUrlTemplate,disableServerChecksum:!1}},t.getDevContainerCliPath=async function(e,t,n){if(t instanceof h.LocalExecServer)return process.execArgv.some(e=>"--inspect"===e||"--inspect-brk"===e)?l.join(e.extensionPath,"node_modules","@devcontainers","cli","dist","spec-node","devContainersSpecCLI.js"):l.join(e.extensionPath,"dist","@devcontainers","cli","dist","spec-node","devContainersSpecCLI.js");const o=f.default.getInstance(),r=await(0,d.getRemoteHomeDir)(t),i=e.extension.packageJSON.publisher.toLowerCase()+"."+e.extension.packageJSON.name+"-0.0.1",a=n.quality||"stable",s=l.posix.join("dist","@devcontainers","cli","dist","spec-node","devContainersSpecCLI.js"),c=[l.posix.join(r,n.serverDataFolderName,"cli","servers",`${a}-${n.commit}`,"server","extensions",i,s),l.posix.join(r,n.serverDataFolderName,"bin",`${a}-${n.commit}${n.isDevelopment?"-dev":""}`,"extensions","genie-dev-container",s)];for(const e of c)try{return await(0,d.executeCommandWithExecServer)("test",["-f",e],t,void 0),o.info(`[DevContainer] Found CLI at: ${e}`),e}catch{}throw new Error(`Could not find devcontainer CLI on remote server.\nExtension: ${i}\nSearched paths:\n${c.map(e=>`  - ${e}`).join("\n")}\nPlease ensure the extension is installed on the remote server.`)},t.readDevContainerConfig=async function(e){try{const t=f.default.getInstance(),n=await(0,d.getNodePath)(e.execServer);t.info(`Node path: ${n}`);const o=[e.devcontainerCliPath,"read-configuration",`--workspace-folder=${e.workspaceFolder}`];e.devcontainerId&&o.push(`--container-id=${e.devcontainerId}`),e.devcontainerPath&&o.push(`--config=${e.devcontainerPath}`),e.includeMergedConfig&&o.push("--include-merged-configuration");const{stdout:r}=await(0,d.executeCommandWithExecServer)(n,o,e.execServer,{ELECTRON_RUN_AS_NODE:"1"});return JSON.parse(r.trim())}catch(e){const t=e instanceof Error?e.message:String(e);throw console.error("Failed to read devcontainer config:",t),e}},t.startDevContainer=async function(e,t,n,o,r){try{r?.info("Starting devcontainer up...");const i=await(0,d.getNodePath)(o);r?.info(`Node path: ${i}`),r?.info(`DevContainer CLI path: ${n}`);const a=await p(o,r);if(!a){const e="Docker not found. Please ensure Docker is installed and accessible in PATH.";throw r?.info(e),new Error(e)}r?.info(`Docker path: ${a}`);const s=[n,"up",`--workspace-folder=${e}`,`--config=${t}`,`--docker-path=${a}`,"--workspace-mount-consistency=cached","--gpu-availability=detect","--log-level=debug","--log-format=text","--default-user-env-probe=loginInteractiveShell","--update-remote-user-uid-default","--include-configuration","--include-merged-configuration","--skip-post-create"],{stdout:c,stderr:l}=await(0,d.executeCommandWithProgress)(i,s,o,{ELECTRON_RUN_AS_NODE:"1"});l.onDidReceiveMessage(e=>{r?.info(`startDevContainer stderr: ${e}`)});return m(await c,r)}catch(e){return r?.info(`Failed to start devcontainer: ${e}`),[null,e instanceof Error?e.message:String(e)]}},t.setupDevContainer=async function(e,t,n,o){try{o?.info(`Setting up devcontainer on docker container ${e}...`);const r=await(0,d.getNodePath)(n);o?.info(`Node path: ${r}`);const i=await p(n,o);if(!i){const e="Docker not found. Please ensure Docker is installed and accessible in PATH.";throw o?.info(e),new Error(e)}o?.info(`Docker path: ${i}`);const a=[t,"set-up",`--container-id=${e}`,`--docker-path=${i}`,"--log-level=debug","--log-format=text","--default-user-env-probe=loginInteractiveShell","--include-configuration","--include-merged-configuration","--skip-post-create"],{stdout:s,stderr:c}=await(0,d.executeCommandWithProgress)(r,a,n,{ELECTRON_RUN_AS_NODE:"1"});c.onDidReceiveMessage(e=>{o?.info(`setupDevContainer stderr: ${e}`)});return m(await s,o)}catch(e){return o?.info(`Failed to setup devcontainer: ${e}`),[null,e instanceof Error?e.message:String(e)]}};const c=a(n(398)),l=a(n(928)),d=n(798),u=n(943),f=s(n(877)),h=n(323);let g;async function p(e,t){try{t?.info("Trying to locate docker using which command...");const{stdout:n}=await(0,d.executeCommandWithExecServer)("which",["docker"],e,void 0),o=n.trim();if(o)try{const{stdout:n}=await(0,d.executeCommandWithExecServer)(o,["--version"],e,void 0);if(n&&n.includes("Docker"))return t?.info(`Found docker at: ${o} (${n.trim()})`),o}catch{}}catch(e){t?.info("which command failed, trying common paths...")}const n=["docker","/usr/local/bin/docker","/usr/bin/docker","/opt/homebrew/bin/docker","/Applications/Docker.app/Contents/Resources/bin/docker","/snap/bin/docker"];for(const o of n)try{t?.info(`Trying docker path: ${o}`);const{stdout:n}=await(0,d.executeCommandWithExecServer)(o,["--version"],e,void 0);if(n&&n.includes("Docker"))return t?.info(`Found docker at: ${o} (${n.trim()})`),o}catch(e){t?.info(`Docker not found at: ${o}`)}return t?.info("Docker not found in any common path"),null}function m(e,t){try{const n=JSON.parse(e);if(t?.info(`DevContainer output as JSON: ${JSON.stringify(n,null,2)}`),!n||"object"!=typeof n)return[null,"Invalid JSON structure"];const o=n;return"success"!==o.outcome?[o,`Failed to start devcontainer: ${o.message}`]:(t?.info(`Found container ID: ${o.containerId}`),[o,""])}catch(e){return t?.info(`Failed to parse devcontainer output as JSON: ${e}`),[null,"Failed to parse output as JSON"]}}},587:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.GroupTreeItem=void 0;const s=a(n(398));class c extends s.TreeItem{constructor(e){super(e,s.TreeItemCollapsibleState.Collapsed),this.location=e,this.iconPath=new s.ThemeIcon("folder"),this.contextValue="location"}}t.GroupTreeItem=c},603:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEV_CONTAINER_AUTHORITY=void 0,t.DEV_CONTAINER_AUTHORITY="dev-container"},650:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteContainerCommand=void 0;const s=a(n(398)),c=n(299),l=n(890),d=n(801),u=n(90);class f extends l.BaseCommand{constructor(e){super(e),this.commandId=c.COMMAND_EXPLORER_DELETE_CONTAINER,this.containerManager=d.ContainerManager.getInstance(e),this.treeDataProvider=u.TreeDataProvider.getInstance(e)}async run(e){if(e)try{await this.containerManager.removeContainer(e.location,e.devId),this.treeDataProvider.refresh()}catch(e){console.error("[DeleteContainerCommand] Error removing container:",e),s.window.showErrorMessage(`Failed to remove container: ${e instanceof Error?e.message:String(e)}`)}else s.window.showErrorMessage("No container item selected")}}t.DeleteContainerCommand=f},658:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateDevContainerConfig=async function(e,t){let n=[],r=[];if(t)try{const i=await(0,o.validateDevContainerConfigWithSchema)(t,e),a=(0,o.getValidationMessages)(i);if(n=a.errors,r=a.warnings,i.isValid)return{isValid:!0,errors:[],warnings:r}}catch(e){console.warn("Schema validation failed, falling back to custom validation:",e)}const i=function(e){const t=[],n=[];if(e.image||e.dockerFile||e.build?.dockerfile||t.push('Must specify either "image", "dockerFile", or "build.dockerfile"'),e.image&&(/^[a-z0-9]+([\.\-_][a-z0-9]+)*([\/][a-z0-9]+([\.\-_][a-z0-9]+)*)*(:[\w][\w\.\-]{0,127})?$/i.test(e.image)||t.push(`Invalid image name format: ${e.image}`)),e.dockerFile&&!e.dockerFile.endsWith("Dockerfile")&&n.push('Dockerfile should typically be named "Dockerfile"'),e.build&&(e.build.dockerfile&&!e.build.dockerfile.endsWith("Dockerfile")&&n.push('Build dockerfile should typically be named "Dockerfile"'),e.build.context&&e.build.context.includes("..")&&n.push("Build context should not reference parent directories for security reasons")),e.forwardPorts)for(const n of e.forwardPorts)("number"!=typeof n||n<1||n>65535)&&t.push(`Invalid port number: ${n}. Ports must be between 1 and 65535`);if(e.workspaceFolder&&(e.workspaceFolder.startsWith("/")||t.push('workspaceFolder must be an absolute path starting with "/"')),e.remoteUser&&(/^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\$)$/.test(e.remoteUser)||n.push(`Remote user "${e.remoteUser}" may not be a valid username`)),e.mounts)for(const o of e.mounts)"string"==typeof o?o.includes("=")||o.includes(":")||n.push(`Mount "${o}" may not be in correct format`):t.push("Mount specifications must be strings");if(e.customizations?.vscode?.extensions)for(const o of e.customizations.vscode.extensions)"string"==typeof o?/^[a-z0-9\-]+\.[a-z0-9\-]+$/i.test(o)||n.push(`Extension ID "${o}" may not be in correct format (publisher.name)`):t.push("VSCode extensions must be specified as strings");const o=[e.postCreateCommand,e.postStartCommand,e.postAttachCommand];for(const[e,n]of o.entries())if(n){const o=["postCreateCommand","postStartCommand","postAttachCommand"];if("string"==typeof n||Array.isArray(n)||t.push(`${o[e]} must be a string or array of strings`),Array.isArray(n))for(const r of n)"string"!=typeof r&&t.push(`All items in ${o[e]} array must be strings`)}if(e.features)if("object"!=typeof e.features||Array.isArray(e.features))t.push("Features must be an object");else for(const[t,o]of Object.entries(e.features))t.includes("/")||n.push(`Feature "${t}" should include namespace (e.g., "ghcr.io/devcontainers/features/node")`);return{isValid:0===t.length,errors:t,warnings:n}}(e),a=[...new Set([...n,...i.errors])],s=[...new Set([...r,...i.warnings])];return{isValid:0===a.length,errors:a,warnings:s}},t.getConfigurationRecommendations=function(e){const t=[];return e.name||t.push('Consider adding a "name" field to identify your dev container'),e.workspaceFolder||t.push('Consider specifying "workspaceFolder" to set the working directory'),!e.postCreateCommand&&e.image?.includes("node")&&t.push('Consider adding "postCreateCommand": "npm install" for Node.js projects'),!e.postCreateCommand&&e.image?.includes("python")&&t.push('Consider adding "postCreateCommand": "pip install -r requirements.txt" for Python projects'),e.customizations?.vscode?.extensions||t.push('Consider adding VSCode extensions in "customizations.vscode.extensions"'),e.forwardPorts||!e.image?.includes("node")&&!e.image?.includes("nginx")||t.push('Consider adding "forwardPorts" for web development (e.g., [3000, 8080])'),t};const o=n(5)},681:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DevContainerDetector=void 0;const c=a(n(398)),l=n(603),d=n(299),u=s(n(877));class f{constructor(e){this.context=e,this.disposables=[],this.logger=u.default.getInstance(),this.initialize()}async initialize(){this.isInDevContainer()?this.logger.info("Already in dev container, skipping detection prompt"):c.workspace.workspaceFolders&&0!==c.workspace.workspaceFolders.length?setTimeout(()=>this.checkForDevContainer(),1e3):this.logger.info("No workspace folder open, skipping dev container detection")}isInDevContainer(){return c.env.remoteAuthority?.startsWith(l.DEV_CONTAINER_AUTHORITY)??!1}getWorkspaceKey(){const e=c.workspace.workspaceFolders;return e&&0!==e.length?e[0].uri.toString():null}async markOpenedInContainer(){const e=this.getWorkspaceKey();if(!e)return;const t=this.context.globalState.get(f.OPENED_IN_CONTAINER_KEY,[]);t.includes(e)||(t.push(e),await this.context.globalState.update(f.OPENED_IN_CONTAINER_KEY,t),this.logger.info(`Marked workspace as opened in container: ${e}`))}wasOpenedInContainer(){const e=this.getWorkspaceKey();return!!e&&this.context.globalState.get(f.OPENED_IN_CONTAINER_KEY,[]).includes(e)}getDismissKey(){const e=this.getWorkspaceKey();return e?`${f.DISMISS_KEY_PREFIX}.${Buffer.from(e).toString("base64")}`:null}async checkForDevContainer(){try{const e=await c.workspace.findFiles("{.devcontainer/devcontainer.json,.devcontainer.json,.devcontainer/**/devcontainer.json}","**/node_modules/**",1);if(0===e.length)return void this.logger.info("No devcontainer.json found in workspace");const t=e[0];this.logger.info(`Found devcontainer.json at: ${t.fsPath}`);const n=this.getDismissKey();if(n&&this.context.globalState.get(n,!1))return void this.logger.info("User previously dismissed dev container prompt for this workspace");const o=this.wasOpenedInContainer();await this.showPrompt(t,o)}catch(e){this.logger.error(`Error detecting devcontainer: ${e}`)}}async showPrompt(e,t){if(!c.workspace.getConfiguration("remote.codebuddyDevContainers").get("showReopenInContainerPrompt",!0))return void this.logger.info("Reopen in container prompt is disabled in settings");this.logger.info(`Current language: ${c.env.language}`),this.logger.info("l10n bundle: "+(c.l10n.bundle?"loaded":"not loaded")),this.logger.info(`l10n uri: ${c.l10n.uri?.toString()??"undefined"}`);const n=t?c.l10n.t("Folder contains a dev container configuration file. Reopen folder to develop in a container?"):c.l10n.t("Folder contains a dev container configuration file. Open folder to develop in a container?"),o=t?c.l10n.t("Reopen in Container"):c.l10n.t("Open in Container"),r=c.l10n.t("Cancel"),i=c.l10n.t("Don't Show Again");switch(this.logger.info(`Translated message: ${n}`),this.logger.info(`Translated button: ${o}`),await c.window.showInformationMessage(n,o,r,i)){case o:await this.openInContainer(e,t);break;case i:const n=this.getDismissKey();n&&(await this.context.globalState.update(n,!0),this.logger.info("User dismissed dev container prompt for this workspace"));break;default:this.logger.info("User cancelled dev container prompt")}}async openInContainer(e,t){try{this.logger.info(`${t?"Reopening":"Opening"} in container with config: ${e.fsPath}`),await c.commands.executeCommand(d.COMMAND_REOPEN_IN_CONTAINER,e.toString())}catch(e){this.logger.error(`Failed to open in container: ${e}`),c.window.showErrorMessage(`Failed to open in container: ${e}`)}}dispose(){this.disposables.forEach(e=>e.dispose())}}t.DevContainerDetector=f,f.DISMISS_KEY_PREFIX="devcontainer.dismissPrompt",f.OPENED_IN_CONTAINER_KEY="devcontainer.openedInContainer"},682:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AttachToRunningContainerCommand=void 0;const c=a(n(398)),l=n(299),d=n(890),u=n(343),f=n(801),h=n(704),g=n(603),p=n(323),m=n(283),_=s(n(877)),v=n(798);class E extends d.BaseCommand{constructor(e){super(e),this.commandId=l.COMMAND_ATTACH_TO_RUNNING_CONTAINER,this.containerManager=f.ContainerManager.getInstance(e),this.logger=_.default.getInstance()}async run(){this.logger.show();const e=m.EnvironmentUtils.getBaseRemoteAuthority(),t=e?await c.workspace.getRemoteExecServer(e):void 0,n=new p.LocalExecServer,o=e?t:n;if(!o)return this.logger.info("Exec server is not available"),void c.window.showErrorMessage("Exec server is not available");this.logger.info("Checking docker version runs");let r,i=null;try{if(i=await(0,u.findDockerPath)(o),!i)throw new Error("Docker executable not found in PATH or common locations");this.logger.info(`Found Docker at: ${i}`),await(0,u.checkDockerVersion)(o,i)}catch(e){return this.logger.show(),void c.window.showErrorMessage(`Error checking Docker version: ${e?.message}`)}try{r=(await(0,v.executeCommandWithExecServer)(i,["ps","--format","{{.Names}}\t{{.Image}}"],o)).stdout.trim()}catch(e){return this.logger.show(),void c.window.showErrorMessage(`Failed to list running containers: ${e?.message}`)}if(!r)return void c.window.showErrorMessage("No running containers found!");const a=r.split("\n").map(e=>{const[t,n]=e.split("\t");return{label:t,description:n}}),s=await c.window.showQuickPick(a,{title:"Select a running container"});if(!s)return;this.logger.info(`Attaching to running container: ${s.label}`);const l=h.DevContainerDestination.withContainerId(s.label).toEncodedString(),d=e?`${g.DEV_CONTAINER_AUTHORITY}+${l}@${e}`:`${g.DEV_CONTAINER_AUTHORITY}+${l}`;this.logger.info(`Container authority: ${d}`);const f=e?this.getLocationName(e):"Local";this.containerManager.addContainer(f,l,d,"/"),c.commands.executeCommand("vscode.newWindow",{remoteAuthority:d})}getLocationName(e){if(e.startsWith("wsl+"))return e.split("+")[1]+" (WSL)";try{const t=e.split("+")[1],n=Buffer.from(t,"hex").toString(),o=JSON.parse(n);return(o.hostname||o.hostName||e)+" (remote)"}catch{return e+" (remote)"}}}t.AttachToRunningContainerCommand=E},704:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DevContainerDestination=void 0;class n{constructor(e){this.setting=e}static withDevContainerConfig(e,t){return new n({settingType:"config",workspacePath:e,devcontainerPath:t})}static withContainerId(e){return new n({settingType:"container",containerId:e})}getType(){return this.setting.settingType}getContainerSetting(){if("container"!==this.setting.settingType)throw new Error("Dev Container is not a container");return this.setting}getConfigSetting(){if("config"!==this.setting.settingType)throw new Error("Dev Container is not a config");return this.setting}static parseJSON(e){const t=JSON.parse(e);if(t.containerId)return new n({settingType:"container",containerId:t.containerId});if(t.workspacePath&&t.devcontainerPath)return new n({settingType:"config",workspacePath:t.workspacePath,devcontainerPath:t.devcontainerPath});throw new Error(`Invalid DevContainerDestination JSON: ${e}`)}toJSON(){const e="config"===this.setting.settingType?{workspacePath:this.setting.workspacePath,devcontainerPath:this.setting.devcontainerPath}:{containerId:this.setting.containerId};return JSON.stringify(e)}static parseAuthority(e){const t=e.split("+");return n.parseEncoded(t[t.length-1])}static parseEncoded(e){try{const t=Buffer.from(e,"hex").toString();return n.parseJSON(t)}catch{}return n.parse(e.replace(/\\x([0-9a-f]{2})/g,(e,t)=>String.fromCharCode(parseInt(t,16))))}static parse(e){const t=e.split("+"),o=t[t.length-1].split("?");return o[1].endsWith(".json")?new n({settingType:"config",workspacePath:o[0],devcontainerPath:o[1]}):new n({settingType:"container",containerId:o[1]})}toEncodedString(){return Buffer.from(this.toJSON()).toString("hex")}}t.DevContainerDestination=n},780:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenFolderInContainerCommand=void 0;const c=a(n(398)),l=n(299),d=n(890),u=n(343),f=n(489),h=n(801),g=n(658),p=n(523),m=n(704),_=n(603),v=n(323),E=n(283),w=s(n(877));class O extends d.BaseCommand{constructor(e){super(e),this.commandId=l.COMMAND_OPEN_FOLDER_IN_CONTAINER,h.ContainerManager.getInstance(e),this.logger=w.default.getInstance()}async run(){try{this.logger.show();const e=E.EnvironmentUtils.getBaseRemoteAuthority(),t=E.EnvironmentUtils.getIsLocal();let n;this.logger.info(`[OpenFolderInContainerCommand] isLocal: ${t}`);try{n=await(0,v.getExecServer)(e)}catch(e){return void this.logger.error(`[OpenFolderInContainerCommand] Error: ${e}`)}this.logger.info(`[OpenFolderInContainerCommand] execServer: ${n}`);const o=await c.window.showOpenDialog({title:"Select a workspace folder",canSelectMany:!1,defaultUri:t?c.Uri.file("/"):c.Uri.from({scheme:"vscode-remote",authority:e}),canSelectFolders:!0});if(!o||!o[0])return;const r=o[0],i=await this.loadDevContainerConfigFile(r);if(!i)return;this.logger.info(`selected config file: ${i}`);try{const e=await(0,u.findDockerPath)(n);if(!e)throw new Error("Docker executable not found in PATH or common locations");this.logger.info(`Found Docker at: ${e}`),await(0,u.checkDockerVersion)(n,e)}catch(e){this.logger.info(`Docker check failed: ${e}`);const t={type:f.ErrorType.DOCKER_NOT_AVAILABLE,message:"Docker is not available. Please install Docker and make sure it's running.",suggestions:["Install Docker Desktop","Start Docker service","Add Docker to PATH"]};return void await f.ErrorHandler.showErrorWithActions(t)}const a=h.ContainerManager.getInstance(),s=t?r.fsPath:r.path,l=t?i.fsPath:i.path,d=await this.loadDevContainerConfig(n,s,l);if(null===d)return;const g=m.DevContainerDestination.withDevContainerConfig(s,l).toEncodedString(),p=e?`${_.DEV_CONTAINER_AUTHORITY}+${g}@${e}`:`${_.DEV_CONTAINER_AUTHORITY}+${g}`,w=d.workspace.workspaceFolder;this.logger.info(`[OpenFolderInContainerCommand] Opening with authority: ${p}`),this.logger.info(`[OpenFolderInContainerCommand] Remote workspace folder: ${w}`),this.logger.info(`[OpenFolderInContainerCommand] Encoded config: ${g}`);const O=e?`${e.split("+")[1]} (remote)`:"Local";a.addContainer(O,g,p,w,l);const C=c.Uri.from({scheme:"vscode-remote",authority:p,path:w});this.logger.info(`[OpenFolderInContainerCommand] Target URI: ${C.toString()}`),this.logger.info(`[OpenFolderInContainerCommand] URI scheme: ${C.scheme}`),this.logger.info(`[OpenFolderInContainerCommand] URI authority: ${C.authority}`),this.logger.info(`[OpenFolderInContainerCommand] URI path: ${C.path}`);const D="true"===process.env.VSCODE_DEBUG_MODE||this.context.extensionMode===c.ExtensionMode.Development;console.log(`[OpenFolderInContainerCommand] Extension mode: ${this.context.extensionMode}`),console.log(`[OpenFolderInContainerCommand] VSCODE_DEBUG_MODE: ${process.env.VSCODE_DEBUG_MODE}`),console.log(`[OpenFolderInContainerCommand] Opening in ${D?"current":"new"} window (development mode: ${D})`);try{const e=!D,t=await c.commands.executeCommand("vscode.openFolder",C,e);this.logger.info("[OpenFolderInContainerCommand] vscode.openFolder returned:",t)}catch(e){throw this.logger.error("[OpenFolderInContainerCommand] vscode.openFolder failed:",e),e}c.window.showInformationMessage(`Successfully opened ${s} in dev container!`)}catch(e){this.logger.error("[OpenInContainerCommand#run] Error:",e)}}async loadDevContainerConfigFile(e){const t=await c.workspace.findFiles(new c.RelativePattern(e,".devcontainer/**/devcontainer.json"));if(0===t.length){const t=E.EnvironmentUtils.getIsLocal()?e.fsPath:e.path;return c.window.showErrorMessage(`No devcontainer.json files found in the selected folder ${t}. Please create a devcontainer.json file in the following path: ${e.path}/.devcontainer/devcontainer.json (or the Windows equivalent).`),null}let n;if(1===t.length)n=t[0];else{const e=E.EnvironmentUtils.getIsLocal(),o=t.map(t=>({label:e?t.fsPath:t.path})),r=await c.window.showQuickPick(o,{title:"Select a devcontainer.json file"});if(!r)return null;n=c.Uri.file(r.label)}return n}async loadDevContainerConfig(e,t,n){try{const o=await(0,p.getVSCodeServerConfig)(e);this.logger.info("[OpenFolderInContainerCommand] getVSCodeServerConfig:",JSON.stringify(o));const r=await(0,p.getDevContainerCliPath)(this.context,e,o);this.logger.info("[OpenFolderInContainerCommand] getDevContainerCliPath:",r);const i=await(0,p.readDevContainerConfig)({workspaceFolder:t,includeMergedConfig:!1,devcontainerId:void 0,devcontainerPath:n,execServer:e,devcontainerCliPath:r});if(!i||!i.configuration)return this.logger.info("[OpenFolderInContainerCommand] Failed to read devcontainer configuration"),c.window.showErrorMessage("Failed to read devcontainer configuration"),null;const a=i.configuration,s=await(0,g.validateDevContainerConfig)(a,n);if(!s.isValid){const e={type:f.ErrorType.CONFIG_INVALID,message:"Invalid devcontainer configuration detected",details:s.errors.join(", "),suggestions:s.errors};return await f.ErrorHandler.showErrorWithActions(e),this.logger.error("[OpenFolderInContainerCommand] Invalid devcontainer configuration"),null}if(s.warnings.length>0){const e=`Configuration warnings: ${s.warnings.join(", ")}`;c.window.showWarningMessage(e),this.logger.warn("[OpenFolderInContainerCommand] Invalid devcontainer configuration")}const l=(0,g.getConfigurationRecommendations)(a);if(l.length>0&&"Show Recommendations"===await c.window.showInformationMessage("We have some recommendations to improve your dev container configuration.","Show Recommendations","Continue")){const e=l.join("\n ");c.window.showInformationMessage(`Recommendations:\n ${e}`)}return i}catch(e){const o=[e instanceof Error?e.message:String(e),"Possible causes:","1. Docker daemon is not running","2. Docker not found in PATH","3. devcontainer.json not found or invalid",`Workspace folder: ${t}`,`Config path: ${n}`];return c.window.showErrorMessage(`Failed to load devcontainer config: ${o.join("\n")}`),this.logger.error("Failed to load devcontainer config:",e),null}}}t.OpenFolderInContainerCommand=O},798:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.executeCommandWithExecServer=h,t.executeCommandWithProgress=async function(e,t,n,o){const r={},i=await n.env();Object.assign(r,i.env),o&&Object.assign(r,o);const a=await n.spawn(e,t,{env:r});let s="";const c=[];return a.stdout.onDidReceiveMessage(e=>{s+=Buffer.from(e).toString()}),a.stderr.onDidReceiveMessage(e=>{const t=Buffer.from(e).toString();c.forEach(e=>e(t))}),{stdout:new Promise((e,t)=>{Promise.resolve(a.onExit).then(n=>{0===n.status?e(s):t(new Error(`Command failed with code ${n.status}`))}).catch(t)}),stderr:{onDidReceiveMessage:e=>{c.push(e)}}}},t.getNodePath=async function(e){if(e instanceof c.LocalExecServer)return process.execPath;try{const t=await(0,u.getVSCodeServerConfig)(e),n=await m(e);if(!n)throw new Error("Could not determine remote home directory");const o=t.serverDataFolderName||".vscode-server",r=t.commit,i=t.quality||"stable",a=i.charAt(0).toUpperCase()+i.slice(1),s=[d.posix.join(n,o,"cli","servers",`${a}-${r}`,"server","node"),d.posix.join(n,o,"bin",`${i}-${r}${t.isDevelopment?"-dev":""}`,"node"),d.posix.join(n,o,"bin",r,"node"),"node"];for(const t of s)try{const{stdout:n}=await h(t,["--version"],e,void 0);if(n&&n.trim().startsWith("v"))return t}catch{}throw new Error(`Could not find Node.js in VSCode Server installation.\nSearched paths:\n${s.map(e=>`  - ${e}`).join("\n")}\nVSCode Server may not be properly installed on the remote machine.`)}catch(e){throw new Error(`Failed to locate VSCode Server's Node.js: ${e instanceof Error?e.message:String(e)}\nThis usually means VSCode Server is not properly installed on the remote machine.`)}},t.getEnv=async function(e){return(await e.env()).env},t.sanitizeEnv=function(e){const t={};for(const[n,o]of Object.entries(e))null!=o&&(t[n]=o);return t},t.writeRemoteFile=g,t.chmodFile=p,t.setupBashScript=async function(e,t,n){const o=f.default.getInstance();o.info(`[setupBashScript] Starting to setup script at: ${e}`),await g(n,e,t),o.info(`[setupBashScript] Wrote script to ${e}`),await p(n,e,"755"),o.info(`[setupBashScript] Made script executable at ${e}`)},t.getRemoteHomeDir=m;const c=n(323),l=a(n(896)),d=a(n(928)),u=n(523),f=s(n(877));async function h(e,t,n,o,r){return new Promise(async(i,a)=>{let s;try{const c={},l=await n.env();Object.assign(c,l.env),o&&Object.assign(c,o);const d=await n.spawn(e,t,{env:c});let u="",f="";r&&r>0&&(s=setTimeout(()=>{a(new Error(`Command timed out after ${r}ms: ${e} ${t.join(" ")}`))},r));const h=d.stdout.onDidReceiveMessage(e=>{const t=Buffer.from(e).toString();u+=t,t.trim()&&console.log(`[STDOUT] ${t.trim()}`)}),g=d.stderr.onDidReceiveMessage(e=>{const t=Buffer.from(e).toString();f+=t,t.trim()&&console.error(`[STDERR] ${t.trim()}`)});Promise.resolve(d.onExit).then(e=>{s&&clearTimeout(s),h.dispose(),g.dispose(),0===e.status?i({stdout:u,stderr:f}):a(new Error(`Command failed with code ${e.status}: ${f||u}`))}).catch(a)}catch(e){s&&clearTimeout(s),a(e)}})}async function g(e,t,n){const o=f.default.getInstance();if(e instanceof c.LocalExecServer)return o.info(`[writeRemoteFile] Writing to local file: ${t}`),l.promises.writeFile(t,n);o.info(`[writeRemoteFile] Opening remote file for writing: ${t}`);const{stream:r,done:i}=await e.fs.write(t);o.info(`[writeRemoteFile] Remote file stream opened, writing content (${n.length} bytes)`),r.write(Buffer.from(n)),o.info("[writeRemoteFile] Content written, ending stream"),r.end(),o.info("[writeRemoteFile] Stream ended, waiting for done promise"),await i,o.info(`[writeRemoteFile] File write completed: ${t}`)}async function p(e,t,n){const o=f.default.getInstance();if(e instanceof c.LocalExecServer)return o.info(`[chmodFile] Changing local file permissions: ${t} to ${n}`),l.promises.chmod(t,parseInt(n,8));o.info(`[chmodFile] Changing remote file permissions: ${t} to ${n}`),await h("chmod",[n,t],e,void 0),o.info(`[chmodFile] Permissions changed successfully: ${t}`)}async function m(e){return(await e.env()).env.HOME||"/root"}},801:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerManager=void 0;const s=a(n(928)),c=a(n(896));class l{constructor(e){this.storageFilePath=s.join(e.globalStorageUri.fsPath,l.STORAGE_FILE),this.store=this.loadFromFile()}static getInstance(e){return!l.instance&&e&&(l.instance=new l(e)),l.instance}getLocations(){return Object.keys(this.store)}getDevContainers(e){return Object.keys(this.store[e]||{})}getAuthority(e,t){return this.store[e][t].authority}getWorkspacePath(e,t){return this.store[e][t].workspacePath}getConfigPath(e,t){return this.store[e]?.[t]?.configPath}getContainerHistory(){const e=[];for(const t of this.getLocations())for(const n of this.getDevContainers(t)){const o=this.store[t][n];e.push({id:n,name:n,image:"unknown",status:"created",workspacePath:o.workspacePath,configPath:o.configPath,location:t,createdAt:new Date,lastUsed:new Date})}return e}async addContainer(e,t,n,o="/",r){this.store[e]||(this.store[e]={}),this.store[e][t]={authority:n,workspacePath:o,configPath:r},await this.save()}async removeContainer(e,t){this.store[e]&&(delete this.store[e][t],0===Object.keys(this.store[e]).length&&delete this.store[e],await this.save())}removeFromHistory(e){for(const t of this.getLocations())this.store[t][e]&&this.removeContainer(t,e)}updateContainerStatus(e,t){console.log(`Container ${e} status updated to ${t} (no-op in new storage model)`)}async findDevContainerConfig(e){const t=[s.join(e,".devcontainer","devcontainer.json"),s.join(e,".devcontainer.json")];for(const e of t)try{if(c.existsSync(e)){const t=c.readFileSync(e,"utf8").replace(/\/\*[\s\S]*?\*\/|\/\/.*$/gm,"");return JSON.parse(t)}}catch(t){console.error(`Failed to parse devcontainer config at ${e}:`,t)}return null}async readDevContainerConfig(e,t){try{if(c.existsSync(t)){const e=c.readFileSync(t,"utf8").replace(/\/\*[\s\S]*?\*\/|\/\/.*$/gm,""),n=JSON.parse(e);return n.workspaceFolder||(n.workspaceFolder="/workspace"),n}}catch(e){console.error(`Failed to parse devcontainer config at ${t}:`,e)}return null}async getRunningContainers(){return[{id:"container1",name:"my-project-dev",image:"node:18",status:"running",workspacePath:"/workspace/my-project",createdAt:new Date(Date.now()-864e5),lastUsed:new Date},{id:"container2",name:"web-app-dev",image:"python:3.9",status:"running",workspacePath:"/workspace/web-app",createdAt:new Date(Date.now()-1728e5),lastUsed:new Date(Date.now()-36e5)}]}loadFromFile(){try{if(c.existsSync(this.storageFilePath)){const e=c.readFileSync(this.storageFilePath,"utf8");return JSON.parse(e)}}catch(e){console.error("Failed to load container history from file:",e)}return{}}async save(){try{const e=s.dirname(this.storageFilePath);c.existsSync(e)||c.mkdirSync(e,{recursive:!0}),c.writeFileSync(this.storageFilePath,JSON.stringify(this.store,null,2),"utf8")}catch(e){console.error("Failed to save container history to file:",e)}}reloadFromStorage(){const e=this.loadFromFile();for(const e of Object.keys(this.store))delete this.store[e];Object.assign(this.store,e)}}t.ContainerManager=l,l.STORAGE_FILE="container-history.json"},857:e=>{e.exports=require("os")},877:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(398)),i=n(69);class a{constructor(e){this.output=r.default.window.createOutputChannel(e)}static getInstance(e=i.LOGGER_OUTPUT_CHANNEL_NAME){return a.instance||(a.instance=new a(e)),a.instance}static resetInstance(){a.instance&&(a.instance.dispose(),a.instance=null)}data2String(e){return e instanceof Error?e.stack||e.message:!1===e.success&&e.message?e.message:e.toString()}trace(e,t){this.logLevel("Trace",e,t)}info(e,t){this.logLevel("Info",e,t)}error(e,t){this.logLevel("Error",e,t)}warn(e,t){this.logLevel("Warn",e,t)}logLevel(e,t,n){this.output.appendLine(`[${e}  - ${this.now()}] ${t}`),n&&this.output.appendLine(this.data2String(n))}now(){const e=new Date;return s(e.getUTCHours()+"",2,"0")+":"+s(e.getMinutes()+"",2,"0")+":"+s(e.getUTCSeconds()+"",2,"0")+"."+e.getMilliseconds()}show(){this.output.show()}dispose(){this.output.dispose()}}function s(e,t,n=" "){return n.repeat(Math.max(0,t-e.length))+e}a.instance=null,t.default=a},879:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerTreeItem=void 0;const c=s(n(398)),l=a(n(928)),d=n(704);class u extends c.default.TreeItem{constructor(e,t,n,o,r){const i=d.DevContainerDestination.parseEncoded(t),a=i.getType();let s;if("config"===a){const t=i.getConfigSetting();s=("Local"===e?l:l.posix).basename(t.workspacePath)}else s=i.getContainerSetting().containerId;super(s,c.default.TreeItemCollapsibleState.None),this.location=e,this.devId=t,this.authority=n,this.workspacePath=o,this.configPath=r,this.description="config"===a&&r||"",this.tooltip="config"===a?`Workspace: ${o}\nConfig: ${r||"Unknown"}`:`Container: ${s}\nWorkspace: ${o}`,this.contextValue="codebuddy-dev-containers.container";const u=this.isCurrentContainer();this.iconPath="config"===a?u?new c.default.ThemeIcon("package",new c.default.ThemeColor("charts.green")):new c.default.ThemeIcon("package"):u?new c.default.ThemeIcon("vm-running",new c.default.ThemeColor("charts.green")):new c.default.ThemeIcon("vm-running")}isCurrentContainer(){const e=c.default.env.remoteAuthority;return!!e&&e.includes(this.authority)}}t.ContainerTreeItem=u},890:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCommand=void 0;const r=o(n(398));t.BaseCommand=class{constructor(e){this.context=e}registerCommand(){this.commandId&&(this.disposable=r.default.commands.registerCommand(this.commandId,(...e)=>{this.run(...e)}),this.context.subscriptions.push(this.disposable))}init(){this.registerCommand()}dispose(){this.disposable?.dispose()}}},896:e=>{e.exports=require("fs")},904:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshTreeCommand=void 0;const o=n(299),r=n(90),i=n(890);class a extends i.BaseCommand{constructor(e){super(e),this.commandId=o.COMMAND_REFRESH_TREE}run(){r.TreeDataProvider.getInstance(this.context).refresh()}}t.RefreshTreeCommand=a},928:e=>{e.exports=require("path")},943:e=>{e.exports=require("fs/promises")},982:e=>{e.exports=require("crypto")},985:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.OpenFromHistoryCommand=void 0;const s=a(n(398)),c=n(299),l=n(890),d=n(704);class u extends l.BaseCommand{constructor(e){super(e),this.commandId=c.COMMAND_EXPLORER_OPEN_FROM_HISTORY}async run(e){if(e)try{const t=d.DevContainerDestination.parseEncoded(e.devId),n=e.authority,o=!("true"===process.env.VSCODE_DEBUG_MODE||this.context.extensionMode===s.ExtensionMode.Development),r=s.Uri.from({scheme:"vscode-remote",authority:n,path:e.workspacePath});"config"===t.getType()?await s.commands.executeCommand("vscode.openFolder",r,o):await s.commands.executeCommand("vscode.newWindow",{remoteAuthority:n})}catch(e){console.error("[OpenFromHistoryCommand] Error opening container:",e),s.window.showErrorMessage(`Failed to open container: ${e instanceof Error?e.message:String(e)}`)}else s.window.showErrorMessage("No container item selected")}}t.OpenFromHistoryCommand=u}},t={},n=function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(265);module.exports=n})();