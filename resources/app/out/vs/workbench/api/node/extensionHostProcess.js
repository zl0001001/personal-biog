/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/var av=function(e,t){return av=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])},av(e,t)};export function __extends(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");av(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}export var __assign=function(){return __assign=Object.assign||function(t){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},__assign.apply(this,arguments)};export function __rest(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i}export function __decorate(e,t,i,r){var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n}export function __param(e,t){return function(i,r){t(i,r,e)}}export function __esDecorate(e,t,i,r,s,n){function o(S){if(S!==void 0&&typeof S!="function")throw new TypeError("Function expected");return S}for(var a=r.kind,l=a==="getter"?"get":a==="setter"?"set":"value",c=!t&&e?r.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),d,f=!1,p=i.length-1;p>=0;p--){var g={};for(var v in r)g[v]=v==="access"?{}:r[v];for(var v in r.access)g.access[v]=r.access[v];g.addInitializer=function(S){if(f)throw new TypeError("Cannot add initializers after decoration has completed");n.push(o(S||null))};var y=(0,i[p])(a==="accessor"?{get:u.get,set:u.set}:u[l],g);if(a==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(d=o(y.get))&&(u.get=d),(d=o(y.set))&&(u.set=d),(d=o(y.init))&&s.unshift(d)}else(d=o(y))&&(a==="field"?s.unshift(d):u[l]=d)}c&&Object.defineProperty(c,r.name,u),f=!0}export function __runInitializers(e,t,i){for(var r=arguments.length>2,s=0;s<t.length;s++)i=r?t[s].call(e,i):t[s].call(e);return r?i:void 0}export function __propKey(e){return typeof e=="symbol"?e:"".concat(e)}export function __setFunctionName(e,t,i){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}export function __metadata(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}export function __awaiter(e,t,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((r=r.apply(e,t||[])).next())})}export function __generator(e,t){var i={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(r=1,s&&(n=c[0]&2?s.return:c[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,c[1])).done)return n;switch(s=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,s=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(n=i.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){i=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){i.label=c[1];break}if(c[0]===6&&i.label<n[1]){i.label=n[1],n=c;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(c);break}n[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(u){c=[6,u],s=0}finally{r=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}export var __createBinding=Object.create?function(e,t,i,r){r===void 0&&(r=i);var s=Object.getOwnPropertyDescriptor(t,i);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,s)}:function(e,t,i,r){r===void 0&&(r=i),e[r]=t[i]};export function __exportStar(e,t){for(var i in e)i!=="default"&&!Object.prototype.hasOwnProperty.call(t,i)&&__createBinding(t,e,i)}export function __values(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}export function __read(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r=i.call(e),s,n=[],o;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return n}export function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}export function __spreadArrays(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var r=Array(e),s=0,t=0;t<i;t++)for(var n=arguments[t],o=0,a=n.length;o<a;o++,s++)r[s]=n[o];return r}export function __spreadArray(e,t,i){if(i||arguments.length===2)for(var r=0,s=t.length,n;r<s;r++)(n||!(r in t))&&(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}export function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}export function __asyncGenerator(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(e,t||[]),s,n=[];return s={},a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(p){return function(g){return Promise.resolve(g).then(p,d)}}function a(p,g){r[p]&&(s[p]=function(v){return new Promise(function(y,S){n.push([p,v,y,S])>1||l(p,v)})},g&&(s[p]=g(s[p])))}function l(p,g){try{c(r[p](g))}catch(v){f(n[0][3],v)}}function c(p){p.value instanceof __await?Promise.resolve(p.value.v).then(u,d):f(n[0][2],p)}function u(p){l("next",p)}function d(p){l("throw",p)}function f(p,g){p(g),n.shift(),n.length&&l(n[0][0],n[0][1])}}export function __asyncDelegator(e){var t,i;return t={},r("next"),r("throw",function(s){throw s}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(s,n){t[s]=e[s]?function(o){return(i=!i)?{value:__await(e[s](o)),done:!1}:n?n(o):o}:n}}export function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],i;return t?t.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),i={},r("next"),r("throw"),r("return"),i[Symbol.asyncIterator]=function(){return this},i);function r(n){i[n]=e[n]&&function(o){return new Promise(function(a,l){o=e[n](o),s(a,l,o.done,o.value)})}}function s(n,o,a,l){Promise.resolve(l).then(function(c){n({value:c,done:a})},o)}}export function __makeTemplateObject(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var _R=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};export function __importStar(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)i!=="default"&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return _R(t,e),t}export function __importDefault(e){return e&&e.__esModule?e:{default:e}}export function __classPrivateFieldGet(e,t,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(e):r?r.value:t.get(e)}export function __classPrivateFieldSet(e,t,i,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(e,i):s?s.value=i:t.set(e,i),i}export function __classPrivateFieldIn(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}export function __addDisposableResource(e,t,i){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var r,s;if(i){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],i&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(n){return Promise.reject(n)}}),e.stack.push({value:t,dispose:r,async:i})}else i&&e.stack.push({async:!0});return t}var wR=typeof SuppressedError=="function"?SuppressedError:function(e,t,i){var r=new Error(i);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};export function __disposeResources(e){function t(r){e.error=e.hasError?new wR(r,e.error,"An error was suppressed during disposal."):r,e.hasError=!0}function i(){for(;e.stack.length;){var r=e.stack.pop();try{var s=r.dispose&&r.dispose.call(r.value);if(r.async)return Promise.resolve(s).then(i,function(n){return t(n),i()})}catch(n){t(n)}}if(e.hasError)throw e.error}return i()}export default{__extends,__assign,__rest,__decorate,__param,__metadata,__awaiter,__generator,__createBinding,__exportStar,__values,__read,__spread,__spreadArrays,__spreadArray,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet,__classPrivateFieldSet,__classPrivateFieldIn,__addDisposableResource,__disposeResources};var yR=Object.create,lv=Object.defineProperty,bR=Object.getOwnPropertyDescriptor,GS=Object.getOwnPropertyNames,SR=Object.getPrototypeOf,xR=Object.prototype.hasOwnProperty,ER=(e,t)=>function(){return t||(0,e[GS(e)[0]])((t={exports:{}}).exports,t),t.exports},CR=(e,t)=>{for(var i in t)lv(e,i,{get:t[i],enumerable:!0})},DR=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of GS(t))!xR.call(e,s)&&s!==i&&lv(e,s,{get:()=>t[s],enumerable:!(r=bR(t,s))||r.enumerable});return e},QS=(e,t,i)=>(i=e!=null?yR(SR(e)):{},DR(t||!e||!e.__esModule?lv(i,"default",{value:e,enumerable:!0}):i,e)),JS=ER({"node_modules/minimist/index.js"(e,t){"use strict";function i(n,o){var a=n;o.slice(0,-1).forEach(function(c){a=a[c]||{}});var l=o[o.length-1];return l in a}function r(n){return typeof n=="number"||/^0x[0-9a-f]+$/i.test(n)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(n)}function s(n,o){return o==="constructor"&&typeof n[o]=="function"||o==="__proto__"}t.exports=function(n,o){o||(o={});var a={bools:{},strings:{},unknownFn:null};typeof o.unknown=="function"&&(a.unknownFn=o.unknown),typeof o.boolean=="boolean"&&o.boolean?a.allBools=!0:[].concat(o.boolean).filter(Boolean).forEach(function(H){a.bools[H]=!0});var l={};function c(H){return l[H].some(function(K){return a.bools[K]})}Object.keys(o.alias||{}).forEach(function(H){l[H]=[].concat(o.alias[H]),l[H].forEach(function(K){l[K]=[H].concat(l[H].filter(function(Ee){return K!==Ee}))})}),[].concat(o.string).filter(Boolean).forEach(function(H){a.strings[H]=!0,l[H]&&[].concat(l[H]).forEach(function(K){a.strings[K]=!0})});var u=o.default||{},d={_:[]};function f(H,K){return a.allBools&&/^--[^=]+$/.test(K)||a.strings[H]||a.bools[H]||l[H]}function p(H,K,Ee){for(var ne=H,ct=0;ct<K.length-1;ct++){var j=K[ct];if(s(ne,j))return;ne[j]===void 0&&(ne[j]={}),(ne[j]===Object.prototype||ne[j]===Number.prototype||ne[j]===String.prototype)&&(ne[j]={}),ne[j]===Array.prototype&&(ne[j]=[]),ne=ne[j]}var B=K[K.length-1];s(ne,B)||((ne===Object.prototype||ne===Number.prototype||ne===String.prototype)&&(ne={}),ne===Array.prototype&&(ne=[]),ne[B]===void 0||a.bools[B]||typeof ne[B]=="boolean"?ne[B]=Ee:Array.isArray(ne[B])?ne[B].push(Ee):ne[B]=[ne[B],Ee])}function g(H,K,Ee){if(!(Ee&&a.unknownFn&&!f(H,Ee)&&a.unknownFn(Ee)===!1)){var ne=!a.strings[H]&&r(K)?Number(K):K;p(d,H.split("."),ne),(l[H]||[]).forEach(function(ct){p(d,ct.split("."),ne)})}}Object.keys(a.bools).forEach(function(H){g(H,u[H]===void 0?!1:u[H])});var v=[];n.indexOf("--")!==-1&&(v=n.slice(n.indexOf("--")+1),n=n.slice(0,n.indexOf("--")));for(var y=0;y<n.length;y++){var S=n[y],x,P;if(/^--.+=/.test(S)){var $=S.match(/^--([^=]+)=([\s\S]*)$/);x=$[1];var A=$[2];a.bools[x]&&(A=A!=="false"),g(x,A,S)}else if(/^--no-.+/.test(S))x=S.match(/^--no-(.+)/)[1],g(x,!1,S);else if(/^--.+/.test(S))x=S.match(/^--(.+)/)[1],P=n[y+1],P!==void 0&&!/^(-|--)[^-]/.test(P)&&!a.bools[x]&&!a.allBools&&(!l[x]||!c(x))?(g(x,P,S),y+=1):/^(true|false)$/.test(P)?(g(x,P==="true",S),y+=1):g(x,a.strings[x]?"":!0,S);else if(/^-[^-]+/.test(S)){for(var W=S.slice(1,-1).split(""),G=!1,J=0;J<W.length;J++){if(P=S.slice(J+2),P==="-"){g(W[J],P,S);continue}if(/[A-Za-z]/.test(W[J])&&P[0]==="="){g(W[J],P.slice(1),S),G=!0;break}if(/[A-Za-z]/.test(W[J])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(P)){g(W[J],P,S),G=!0;break}if(W[J+1]&&W[J+1].match(/\W/)){g(W[J],S.slice(J+2),S),G=!0;break}else g(W[J],a.strings[W[J]]?"":!0,S)}x=S.slice(-1)[0],!G&&x!=="-"&&(n[y+1]&&!/^(-|--)[^-]/.test(n[y+1])&&!a.bools[x]&&(!l[x]||!c(x))?(g(x,n[y+1],S),y+=1):n[y+1]&&/^(true|false)$/.test(n[y+1])?(g(x,n[y+1]==="true",S),y+=1):g(x,a.strings[x]?"":!0,S))}else if((!a.unknownFn||a.unknownFn(S)!==!1)&&d._.push(a.strings._||!r(S)?S:Number(S)),o.stopEarly){d._.push.apply(d._,n.slice(y+1));break}}return Object.keys(u).forEach(function(H){i(d,H.split("."))||(p(d,H.split("."),u[H]),(l[H]||[]).forEach(function(K){p(d,K.split("."),u[H])}))}),o["--"]?d["--"]=v.slice():v.forEach(function(H){d._.push(H)}),d}}}),kR=QS(JS(),1);import*as IR from"net";var KS;function cv(e,t){const i=Object.create(null);for(const r of e){const s=t(r);let n=i[s];n||(n=i[s]=[]),n.push(r)}return i}function PR(e,t){const i=[],r=[];for(const s of e)t.has(s)||i.push(s);for(const s of t)e.has(s)||r.push(s);return{removed:i,added:r}}var cK=class{static{KS=Symbol.toStringTag}constructor(e,t){this.toKey=t,this._map=new Map,this[KS]="SetWithKey";for(const i of e)this.add(i)}get size(){return this._map.size}add(e){const t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(const e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(const e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[Symbol.iterator](){return this.values()}},TR=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?xr.isErrorNoTelemetry(e)?new xr(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},lc=new TR;function uv(e){lc.setUnexpectedErrorHandler(e)}function AR(e){if(!e||typeof e!="object")return!1;const t=e;return t.code==="EPIPE"&&t.syscall?.toUpperCase()==="WRITE"}function Yd(e){lc.onUnexpectedError(e)}function pt(e){Yi(e)||lc.onUnexpectedError(e)}function XS(e){Yi(e)||lc.onUnexpectedExternalError(e)}function wa(e){if(e instanceof Error){const{name:t,message:i,cause:r}=e,s=e.stacktrace||e.stack;return{$isError:!0,name:t,message:i,stack:s,noTelemetry:xr.isErrorNoTelemetry(e),cause:r?wa(r):void 0,code:e.code}}return e}function YS(e){let t;return e.noTelemetry?t=new xr:(t=new Error,t.name=e.name),t.message=e.message,t.stack=e.stack,e.code&&(t.code=e.code),e.cause&&(t.cause=YS(e.cause)),t}var Zd="Canceled";function Yi(e){return e instanceof oi?!0:e instanceof Error&&e.name===Zd&&e.message===Zd}var oi=class extends Error{constructor(){super(Zd),this.name=this.message}};function cc(){const e=new Error(Zd);return e.name=e.message,e}function De(e){return e?new Error(`Illegal argument: ${e}`):new Error("Illegal argument")}function dv(e){return e?new Error(`Illegal state: ${e}`):new Error("Illegal state")}var Zn=class extends TypeError{constructor(e){super(e?`${e} is read-only and cannot be changed`:"Cannot change read-only property")}};function ZS(e){return e?e.message?e.message:e.stack?e.stack.split(`
`)[0]:String(e):"Error"}var RR=class extends Error{constructor(e){super("NotImplemented"),e&&(this.message=e)}},hv=class extends Error{constructor(e){super("NotSupported"),e&&(this.message=e)}},xr=class mS extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof mS)return t;const i=new mS;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}},Zi=class D9 extends Error{constructor(t){super(t||"An unexpected bug occurred."),Object.setPrototypeOf(this,D9.prototype)}};function eh(e,t){const i=this;let r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}function LR(e,t,i=e.length-1){const r=NR(e,t,i);if(r!==-1)return e[r]}function NR(e,t,i=e.length-1){for(let r=i;r>=0;r--){const s=e[r];if(t(s))return r}return-1}function MR(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){const o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}function OR(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){const o=Math.floor((s+n)/2);t(e[o])?n=o:s=o+1}return s}var uK=class k9{static{this.assertInvariants=!1}constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(k9.assertInvariants){if(this._prevFindLastPredicate){for(const r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}const i=MR(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};function Er(e,t,i=(r,s)=>r===s){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let r=0,s=e.length;r<s;r++)if(!i(e[r],t[r]))return!1;return!0}function FR(e,t){const i=[];let r;for(const s of e.slice(0).sort(t))!r||t(r[0],s)!==0?(r=[s],i.push(r)):r.push(s);return i}function ex(e,t,i){const r=[];function s(a,l,c){if(l===0&&c.length===0)return;const u=r[r.length-1];u&&u.start+u.deleteCount===a?(u.deleteCount+=l,u.toInsert.push(...c)):r.push({start:a,deleteCount:l,toInsert:c})}let n=0,o=0;for(;;){if(n===e.length){s(n,0,t.slice(o));break}if(o===t.length){s(n,e.length-n,[]);break}const a=e[n],l=t[o],c=i(a,l);c===0?(n+=1,o+=1):c<0?(s(n,1,[]),n+=1):c>0&&(s(n,0,[l]),o+=1)}return r}function $R(e,t,i){const r=ex(e,t,i),s=[],n=[];for(const o of r)s.push(...e.slice(o.start,o.start+o.deleteCount)),n.push(...o.toInsert);return{removed:s,added:n}}function HR(e,t,i,r,s){return i===0?Promise.resolve([]):new Promise((n,o)=>{(async()=>{const a=e.length,l=e.slice(0,i).sort(t);for(let c=i,u=Math.min(i+r,a);c<a;c=u,u=Math.min(u+r,a)){if(c>i&&await new Promise(d=>setTimeout(d)),s&&s.isCancellationRequested)throw new oi;UR(e,t,l,c,u)}return l})().then(n,o)})}function UR(e,t,i,r,s){for(const n=i.length;r<s;r++){const o=e[r];if(t(o,i[n-1])<0){i.pop();const a=OR(i,l=>t(o,l)<0);i.splice(a,0,o)}}}function Et(e){return e.filter(t=>!!t)}function WR(e){let t=0;for(let i=0;i<e.length;i++)e[i]&&(e[t]=e[i],t+=1);e.length=t}function fv(e){return!Array.isArray(e)||e.length===0}function ya(e){return Array.isArray(e)&&e.length>0}function ba(e,t=i=>i){const i=new Set;return e.filter(r=>{const s=t(r);return i.has(s)?!1:(i.add(s),!0)})}function tx(e,t){return e.push(t),()=>BR(e,t)}function BR(e,t){const i=e.indexOf(t);if(i>-1)return e.splice(i,1),t}function ix(e,t){let i;if(typeof t=="number"){let r=t;i=()=>{const s=Math.sin(r++)*179426549;return s-Math.floor(s)}}else i=Math.random;for(let r=e.length-1;r>0;r-=1){const s=Math.floor(i()*(r+1)),n=e[r];e[r]=e[s],e[s]=n}}function th(e,t){return Array.isArray(e)?e.map(t):t(e)}function er(e){return Array.isArray(e)?e:[e]}var pv;(function(e){function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(pv||(pv={}));function VR(e,t){return(i,r)=>t(e(i),e(r))}var zR=(e,t)=>e-t,dK=class Um{static{this.empty=new Um(t=>{})}constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){const t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new Um(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new Um(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||pv.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}},rx,sx,nx;function qR(e,t,i){let r=e.get(t);return r===void 0&&(r=i,e.set(t,r)),r}var jR=class{constructor(e,t){this.uri=e,this.value=t}};function GR(e){return Array.isArray(e)}var Vt=class Fd{static{this.defaultToKey=t=>t.toString()}constructor(t,i){if(this[rx]="ResourceMap",t instanceof Fd)this.map=new Map(t.map),this.toKey=i??Fd.defaultToKey;else if(GR(t)){this.map=new Map,this.toKey=i??Fd.defaultToKey;for(const[r,s]of t)this.set(r,s)}else this.map=new Map,this.toKey=t??Fd.defaultToKey}set(t,i){return this.map.set(this.toKey(t),new jR(t,i)),this}get(t){return this.map.get(this.toKey(t))?.value}has(t){return this.map.has(this.toKey(t))}get size(){return this.map.size}clear(){this.map.clear()}delete(t){return this.map.delete(this.toKey(t))}forEach(t,i){typeof i<"u"&&(t=t.bind(i));for(const[r,s]of this.map)t(s.value,s.uri,this)}*values(){for(const t of this.map.values())yield t.value}*keys(){for(const t of this.map.values())yield t.uri}*entries(){for(const t of this.map.values())yield[t.uri,t.value]}*[(rx=Symbol.toStringTag,Symbol.iterator)](){for(const[,t]of this.map)yield[t.uri,t.value]}},ox=class{constructor(e,t){this[sx]="ResourceSet",!e||typeof e=="function"?this._map=new Vt(e):(this._map=new Vt(t),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,t){this._map.forEach((i,r)=>e.call(t,r,r,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(sx=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}},ax;(function(e){e[e.None=0]="None",e[e.AsOld=1]="AsOld",e[e.AsNew=2]="AsNew"})(ax||(ax={}));var QR=class{constructor(){this[nx]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=0){const i=this._map.get(e);if(i)return t!==0&&this.touch(i,t),i.value}set(e,t,i=0){let r=this._map.get(e);if(r)r.value=t,i!==0&&this.touch(r,i);else{switch(r={key:e,value:t,next:void 0,previous:void 0},i){case 0:this.addItemLast(r);break;case 1:this.addItemFirst(r);break;case 2:this.addItemLast(r);break;default:this.addItemLast(r);break}this._map.set(e,r),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){const t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){const i=this._state;let r=this._head;for(;r;){if(t?e.bind(t)(r.value,r.key,this):e(r.value,r.key,this),this._state!==i)throw new Error("LinkedMap got modified during iteration.");r=r.next}}keys(){const e=this,t=this._state;let i=this._head;const r={[Symbol.iterator](){return r},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(i){const s={value:i.key,done:!1};return i=i.next,s}else return{value:void 0,done:!0}}};return r}values(){const e=this,t=this._state;let i=this._head;const r={[Symbol.iterator](){return r},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(i){const s={value:i.value,done:!1};return i=i.next,s}else return{value:void 0,done:!0}}};return r}entries(){const e=this,t=this._state;let i=this._head;const r={[Symbol.iterator](){return r},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(i){const s={value:[i.key,i.value],done:!1};return i=i.next,s}else return{value:void 0,done:!0}}};return r}[(nx=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,i=this.size;for(;t&&i>e;)this._map.delete(t.key),t=t.next,i--;this._head=t,this._size=i,t&&(t.previous=void 0),this._state++}trimNew(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._tail,i=this.size;for(;t&&i>e;)this._map.delete(t.key),t=t.previous,i--;this._tail=t,this._size=i,t&&(t.next=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const t=e.next,i=e.previous;if(!t||!i)throw new Error("Invalid list");t.previous=i,i.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==1&&t!==2)){if(t===1){if(e===this._head)return;const i=e.next,r=e.previous;e===this._tail?(r.next=void 0,this._tail=r):(i.previous=r,r.next=i),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===2){if(e===this._tail)return;const i=e.next,r=e.previous;e===this._head?(i.previous=void 0,this._head=i):(i.previous=r,r.next=i),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){const e=[];return this.forEach((t,i)=>{e.push([i,t])}),e}fromJSON(e){this.clear();for(const[t,i]of e)this.set(t,i)}},JR=class extends QR{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=2){return super.get(e,t)}peek(e){return super.get(e,0)}set(e,t){return super.set(e,t,2),this}checkTrim(){this.size>this._limit&&this.trim(Math.round(this._limit*this._ratio))}},uc=class extends JR{constructor(e,t=1){super(e,t)}trim(e){this.trimOld(e)}set(e,t){return super.set(e,t),this.checkTrim(),this}},KR=class{constructor(e){if(this._m1=new Map,this._m2=new Map,e)for(const[t,i]of e)this.set(t,i)}clear(){this._m1.clear(),this._m2.clear()}set(e,t){this._m1.set(e,t),this._m2.set(t,e)}get(e){return this._m1.get(e)}getKey(e){return this._m2.get(e)}delete(e){const t=this._m1.get(e);return t===void 0?!1:(this._m1.delete(e),this._m2.delete(t),!0)}forEach(e,t){this._m1.forEach((i,r)=>{e.call(t,i,r,this)})}keys(){return this._m1.keys()}values(){return this._m1.values()}},lx=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){const i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){const i=this.map.get(e);i&&i.forEach(t)}get(e){const t=this.map.get(e);return t||new Set}};function vi(e,t){if(!e)throw new Error(t?`Assertion failed (${t})`:"Assertion Failed")}function gv(e,t="Unreachable"){throw new Error(t)}function mv(e,t="unexpected state"){if(!e)throw typeof t=="string"?new Zi(`Assertion Failed: ${t}`):t}function cx(e){if(!e()){debugger;e(),pt(new Zi("Assertion Failed"))}}function Oe(e){return typeof e=="string"}function XR(e){return Array.isArray(e)&&e.every(t=>Oe(t))}function It(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)&&!(e instanceof RegExp)&&!(e instanceof Date)}function YR(e){const t=Object.getPrototypeOf(Uint8Array);return typeof e=="object"&&e instanceof t}function cr(e){return typeof e=="number"&&!isNaN(e)}function ZR(e){return!!e&&typeof e[Symbol.iterator]=="function"}function ux(e){return e===!0||e===!1}function dc(e){return typeof e>"u"}function ur(e){return!Lt(e)}function Lt(e){return dc(e)||e===null}function vv(e,t){if(!e)throw new Error(t?`Unexpected type, expected '${t}'`:"Unexpected type")}function Sa(e){return mv(e!=null,"Argument is `undefined` or `null`."),e}var eL=Object.prototype.hasOwnProperty;function dx(e){if(!It(e))return!1;for(const t in e)if(eL.call(e,t))return!1;return!0}function hx(e){return typeof e=="function"}function tL(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++)fx(e[r],t[r])}function fx(e,t){if(Oe(t)){if(typeof e!==t)throw new Error(`argument does not match constraint: typeof ${t}`)}else if(hx(t)){try{if(e instanceof t)return}catch{}if(!Lt(e)&&e.constructor===t||t.length===1&&t.call(void 0,e)===!0)return;throw new Error("argument does not match one of these constraints: arg instanceof constraint, arg.constructor === constraint, nor constraint(arg) === true")}}var ai;(function(e){function t(A){return A&&typeof A=="object"&&typeof A[Symbol.iterator]=="function"}e.is=t;const i=Object.freeze([]);function r(){return i}e.empty=r;function*s(A){yield A}e.single=s;function n(A){return t(A)?A:s(A)}e.wrap=n;function o(A){return A||i}e.from=o;function*a(A){for(let W=A.length-1;W>=0;W--)yield A[W]}e.reverse=a;function l(A){return!A||A[Symbol.iterator]().next().done===!0}e.isEmpty=l;function c(A){return A[Symbol.iterator]().next().value}e.first=c;function u(A,W){let G=0;for(const J of A)if(W(J,G++))return!0;return!1}e.some=u;function d(A,W){for(const G of A)if(W(G))return G}e.find=d;function*f(A,W){for(const G of A)W(G)&&(yield G)}e.filter=f;function*p(A,W){let G=0;for(const J of A)yield W(J,G++)}e.map=p;function*g(A,W){let G=0;for(const J of A)yield*W(J,G++)}e.flatMap=g;function*v(...A){for(const W of A)ZR(W)?yield*W:yield W}e.concat=v;function y(A,W,G){let J=G;for(const H of A)J=W(J,H);return J}e.reduce=y;function S(A){let W=0;for(const G of A)W++;return W}e.length=S;function*x(A,W,G=A.length){for(W<-A.length&&(W=0),W<0&&(W+=A.length),G<0?G+=A.length:G>A.length&&(G=A.length);W<G;W++)yield A[W]}e.slice=x;function P(A,W=Number.POSITIVE_INFINITY){const G=[];if(W===0)return[G,A];const J=A[Symbol.iterator]();for(let H=0;H<W;H++){const K=J.next();if(K.done)return[G,e.empty()];G.push(K.value)}return[G,{[Symbol.iterator](){return J}}]}e.consume=P;async function $(A){const W=[];for await(const G of A)W.push(G);return Promise.resolve(W)}e.asyncToArray=$})(ai||(ai={}));var iL=!1,eo=null,hK=class I9{constructor(){this.livingDisposables=new Map}static{this.idx=0}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:I9.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){const i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){const r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){const r=i.get(t);if(r)return r;const s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){const t=new Map;return[...this.livingDisposables.entries()].filter(([,r])=>r.source!==null&&!this.getRootParent(r,t).isSingleton).flatMap(([r])=>r)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{const l=new Map,c=[...this.livingDisposables.values()].filter(d=>d.source!==null&&!this.getRootParent(d,l).isSingleton);if(c.length===0)return;const u=new Set(c.map(d=>d.value));if(r=c.filter(d=>!(d.parent&&u.has(d.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(l){function c(d,f){for(;d.length>0&&f.some(p=>typeof p=="string"?p===d[0]:d[0].match(p));)d.shift()}const u=l.source.split(`
`).map(d=>d.trim().replace("at ","")).filter(d=>d!=="");return c(u,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),u.reverse()}const n=new lx;for(const l of r){const c=s(l);for(let u=0;u<=c.length;u++)n.add(c.slice(0,u).join(`
`),l)}r.sort(VR(l=>l.idx,zR));let o="",a=0;for(const l of r.slice(0,t)){a++;const c=s(l),u=[];for(let d=0;d<c.length;d++){let f=c[d];f=`(shared with ${n.get(c.slice(0,d+1).join(`
`)).size}/${r.length} leaks) at ${f}`;const g=n.get(c.slice(0,d).join(`
`)),v=cv([...g].map(y=>s(y)[d]),y=>y);delete v[c[d]];for(const[y,S]of Object.entries(v))u.unshift(`    - stacktraces of ${S.length} other leaks continue with ${y}`);u.unshift(f)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${l.value.constructor.name} ====================
${u.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};function rL(e){eo=e}if(iL){const e="__is_disposable_tracked__";rL(new class{trackDisposable(t){const i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==X.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==X.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function xa(e){return eo?.trackDisposable(e),e}function Ea(e){eo?.markAsDisposed(e)}function hc(e,t){eo?.setParent(e,t)}function sL(e,t){if(eo)for(const i of e)eo.setParent(i,t)}function _v(e){return eo?.markAsSingleton(e),e}function px(e){return typeof e=="object"&&e!==null&&typeof e.dispose=="function"&&e.dispose.length===0}function Cr(e){if(ai.is(e)){const t=[];for(const i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function wv(...e){const t=ie(()=>Cr(e));return sL(e,t),t}function ie(e){const t=xa({dispose:eh(()=>{Ea(t),e()})});return t}var oe=class P9{static{this.DISABLE_DISPOSED_WARNING=!1}constructor(){this._toDispose=new Set,this._isDisposed=!1,xa(this)}dispose(){this._isDisposed||(Ea(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Cr(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return hc(t,this),this._isDisposed?P9.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),hc(t,null))}},X=class{static{this.None=Object.freeze({dispose(){}})}constructor(){this._store=new oe,xa(this),hc(this._store,this)}dispose(){Ea(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}},Kr=class{constructor(){this._isDisposed=!1,xa(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&hc(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,Ea(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){const e=this._value;return this._value=void 0,e&&hc(e,null),e}},fc=class{constructor(){this._store=new Map,this._isDisposed=!1,xa(this)}dispose(){Ea(this),this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{Cr(this._store.values())}finally{this._store.clear()}}has(e){return this._store.has(e)}get size(){return this._store.size}get(e){return this._store.get(e)}set(e,t,i=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),i||this._store.get(e)?.dispose(),this._store.set(e,t)}deleteAndDispose(e){this._store.get(e)?.dispose(),this._store.delete(e)}deleteAndLeak(e){const t=this._store.get(e);return this._store.delete(e),t}keys(){return this._store.keys()}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}},Nt=class Wm{static{this.Undefined=new Wm(void 0)}constructor(t){this.element=t,this.next=Wm.Undefined,this.prev=Wm.Undefined}},hn=class{constructor(){this._first=Nt.Undefined,this._last=Nt.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===Nt.Undefined}clear(){let e=this._first;for(;e!==Nt.Undefined;){const t=e.next;e.prev=Nt.Undefined,e.next=Nt.Undefined,e=t}this._first=Nt.Undefined,this._last=Nt.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){const i=new Nt(e);if(this._first===Nt.Undefined)this._first=i,this._last=i;else if(t){const s=this._last;this._last=i,i.prev=s,s.next=i}else{const s=this._first;this._first=i,i.next=s,s.prev=i}this._size+=1;let r=!1;return()=>{r||(r=!0,this._remove(i))}}shift(){if(this._first!==Nt.Undefined){const e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==Nt.Undefined){const e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==Nt.Undefined&&e.next!==Nt.Undefined){const t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===Nt.Undefined&&e.next===Nt.Undefined?(this._first=Nt.Undefined,this._last=Nt.Undefined):e.next===Nt.Undefined?(this._last=this._last.prev,this._last.next=Nt.Undefined):e.prev===Nt.Undefined&&(this._first=this._first.next,this._first.prev=Nt.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==Nt.Undefined;)yield e.element,e=e.next}},nL=globalThis.performance.now.bind(globalThis.performance),Hi=class T9{static create(t){return new T9(t)}constructor(t){this._now=t===!1?Date.now:nL,this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},gx=!1,oL=!1,Fe;(function(e){e.None=()=>X.None;function t(j){if(oL){const{onDidAddListener:B}=j,te=yv.create();let Y=0;j.onDidAddListener=()=>{++Y===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),te.print()),B?.()}}}function i(j,B){return p(j,()=>{},0,void 0,!0,void 0,B)}e.defer=i;function r(j){return(B,te=null,Y)=>{let ee=!1,_e;return _e=j(Re=>{if(!ee)return _e?_e.dispose():ee=!0,B.call(te,Re)},null,Y),ee&&_e.dispose(),_e}}e.once=r;function s(j,B){return e.once(e.filter(j,B))}e.onceIf=s;function n(j,B,te){return d((Y,ee=null,_e)=>j(Re=>Y.call(ee,B(Re)),null,_e),te)}e.map=n;function o(j,B,te){return d((Y,ee=null,_e)=>j(Re=>{B(Re),Y.call(ee,Re)},null,_e),te)}e.forEach=o;function a(j,B,te){return d((Y,ee=null,_e)=>j(Re=>B(Re)&&Y.call(ee,Re),null,_e),te)}e.filter=a;function l(j){return j}e.signal=l;function c(...j){return(B,te=null,Y)=>{const ee=wv(...j.map(_e=>_e(Re=>B.call(te,Re))));return f(ee,Y)}}e.any=c;function u(j,B,te,Y){let ee=te;return n(j,_e=>(ee=B(ee,_e),ee),Y)}e.reduce=u;function d(j,B){let te;const Y={onWillAddFirstListener(){te=j(ee.fire,ee)},onDidRemoveLastListener(){te?.dispose()}};B||t(Y);const ee=new D(Y);return B?.add(ee),ee.event}function f(j,B){return B instanceof Array?B.push(j):B&&B.add(j),j}function p(j,B,te=100,Y=!1,ee=!1,_e,Re){let be,et,Zt,xt=0,si;const gi={leakWarningThreshold:_e,onWillAddFirstListener(){be=j(ws=>{xt++,et=B(et,ws),Y&&!Zt&&(tt.fire(et),et=void 0),si=()=>{const ga=et;et=void 0,Zt=void 0,(!Y||xt>1)&&tt.fire(ga),xt=0},typeof te=="number"?(clearTimeout(Zt),Zt=setTimeout(si,te)):Zt===void 0&&(Zt=0,queueMicrotask(si))})},onWillRemoveListener(){ee&&xt>0&&si?.()},onDidRemoveLastListener(){si=void 0,be.dispose()}};Re||t(gi);const tt=new D(gi);return Re?.add(tt),tt.event}e.debounce=p;function g(j,B=0,te){return e.debounce(j,(Y,ee)=>Y?(Y.push(ee),Y):[ee],B,void 0,!0,void 0,te)}e.accumulate=g;function v(j,B=(Y,ee)=>Y===ee,te){let Y=!0,ee;return a(j,_e=>{const Re=Y||!B(_e,ee);return Y=!1,ee=_e,Re},te)}e.latch=v;function y(j,B,te){return[e.filter(j,B,te),e.filter(j,Y=>!B(Y),te)]}e.split=y;function S(j,B=!1,te=[],Y){let ee=te.slice(),_e=j(et=>{ee?ee.push(et):be.fire(et)});Y&&Y.add(_e);const Re=()=>{ee?.forEach(et=>be.fire(et)),ee=null},be=new D({onWillAddFirstListener(){_e||(_e=j(et=>be.fire(et)),Y&&Y.add(_e))},onDidAddFirstListener(){ee&&(B?setTimeout(Re):Re())},onDidRemoveLastListener(){_e&&_e.dispose(),_e=null}});return Y&&Y.add(be),be.event}e.buffer=S;function x(j,B){return(Y,ee,_e)=>{const Re=B(new $);return j(function(be){const et=Re.evaluate(be);et!==P&&Y.call(ee,et)},void 0,_e)}}e.chain=x;const P=Symbol("HaltChainable");class ${constructor(){this.steps=[]}map(B){return this.steps.push(B),this}forEach(B){return this.steps.push(te=>(B(te),te)),this}filter(B){return this.steps.push(te=>B(te)?te:P),this}reduce(B,te){let Y=te;return this.steps.push(ee=>(Y=B(Y,ee),Y)),this}latch(B=(te,Y)=>te===Y){let te=!0,Y;return this.steps.push(ee=>{const _e=te||!B(ee,Y);return te=!1,Y=ee,_e?ee:P}),this}evaluate(B){for(const te of this.steps)if(B=te(B),B===P)break;return B}}function A(j,B,te=Y=>Y){const Y=(...be)=>Re.fire(te(...be)),ee=()=>j.on(B,Y),_e=()=>j.removeListener(B,Y),Re=new D({onWillAddFirstListener:ee,onDidRemoveLastListener:_e});return Re.event}e.fromNodeEventEmitter=A;function W(j,B,te=Y=>Y){const Y=(...be)=>Re.fire(te(...be)),ee=()=>j.addEventListener(B,Y),_e=()=>j.removeEventListener(B,Y),Re=new D({onWillAddFirstListener:ee,onDidRemoveLastListener:_e});return Re.event}e.fromDOMEventEmitter=W;function G(j,B){return new Promise(te=>r(j)(te,null,B))}e.toPromise=G;function J(j){const B=new D;return j.then(te=>{B.fire(te)},()=>{B.fire(void 0)}).finally(()=>{B.dispose()}),B.event}e.fromPromise=J;function H(j,B){return j(te=>B.fire(te))}e.forward=H;function K(j,B,te){return B(te),j(Y=>B(Y))}e.runAndSubscribe=K;class Ee{constructor(B,te){this._observable=B,this._counter=0,this._hasChanged=!1;const Y={onWillAddFirstListener:()=>{B.addObserver(this),this._observable.reportChanges()},onDidRemoveLastListener:()=>{B.removeObserver(this)}};te||t(Y),this.emitter=new D(Y),te&&te.add(this.emitter)}beginUpdate(B){this._counter++}handlePossibleChange(B){}handleChange(B,te){this._hasChanged=!0}endUpdate(B){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function ne(j,B){return new Ee(j,B).emitter.event}e.fromObservable=ne;function ct(j){return(B,te,Y)=>{let ee=0,_e=!1;const Re={beginUpdate(){ee++},endUpdate(){ee--,ee===0&&(j.reportChanges(),_e&&(_e=!1,B.call(te)))},handlePossibleChange(){},handleChange(){_e=!0}};j.addObserver(Re),j.reportChanges();const be={dispose(){j.removeObserver(Re)}};return Y instanceof oe?Y.add(be):Array.isArray(Y)&&Y.push(be),be}}e.fromObservableLight=ct})(Fe||(Fe={}));var aL=class vS{static{this.all=new Set}static{this._idPool=0}constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${vS._idPool++}`,vS.all.add(this)}start(t){this._stopWatch=new Hi,this.listenerCount=t}stop(){if(this._stopWatch){const t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}},mx=-1,lL=class A9{static{this._idPool=1}constructor(t,i,r=(A9._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=i,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,i){const r=this.threshold;if(r<=0||i<r)return;this._stacks||(this._stacks=new Map);const s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;const[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);const l=new cL(a,n);this._errorHandler(l)}return()=>{const n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,i=0;for(const[r,s]of this._stacks)(!t||i<s)&&(t=[r,s],i=s);return t}},yv=class R9{static create(){const t=new Error;return new R9(t.stack??"")}constructor(t){this.value=t}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},cL=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},uL=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},dL=0,ih=class{constructor(e){this.value=e,this.id=dL++}},hL=2,vx=(e,t)=>{if(e instanceof ih)t(e);else for(let i=0;i<e.length;i++){const r=e[i];r&&t(r)}},D=class{constructor(e){this._size=0,this._options=e,this._leakageMon=mx>0||this._options?.leakWarningThreshold?new lL(e?.onListenerError??pt,this._options?.leakWarningThreshold??mx):void 0,this._perfMon=this._options?._profName?new aL(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(gx){const e=this._listeners;queueMicrotask(()=>{vx(e,t=>t.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,t,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){const a=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(a);const l=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],c=new uL(`${a}. HINT: Stack shows most frequent listener (${l[1]}-times)`,l[0]);return(this._options?.onListenerError||pt)(c),X.None}if(this._disposed)return X.None;t&&(e=e.bind(t));const r=new ih(e);let s,n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=yv.create(),s=this._leakageMon.check(r.stack,this._size+1)),gx&&(r.stack=n??yv.create()),this._listeners?this._listeners instanceof ih?(this._deliveryQueue??=new fL,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._options?.onDidAddListener?.(this),this._size++;const o=ie(()=>{s?.(),this._removeListener(r)});return i instanceof oe?i.add(o):Array.isArray(i)&&i.push(o),o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}const t=this._listeners,i=t.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[i]=void 0;const r=this._deliveryQueue.current===this;if(this._size*hL<=t.length){let s=0;for(let n=0;n<t.length;n++)t[n]?t[s++]=t[n]:r&&s<this._deliveryQueue.end&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=s}}_deliver(e,t){if(!e)return;const i=this._options?.onListenerError||pt;if(!i){e.value(t);return}try{e.value(t)}catch(r){i(r)}}_deliverQueue(e){const t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof ih)this._deliver(this._listeners,e);else{const t=this._deliveryQueue;t.enqueue(this,e,this._listeners.length),this._deliverQueue(t)}this._perfMon?.stop()}hasListeners(){return this._size>0}},fL=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,i){this.i=0,this.end=i,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},pc=class extends D{async fireAsync(e,t,i){if(this._listeners)for(this._asyncDeliveryQueue||(this._asyncDeliveryQueue=new hn),vx(this._listeners,r=>this._asyncDeliveryQueue.push([r.value,e]));this._asyncDeliveryQueue.size>0&&!t.isCancellationRequested;){const[r,s]=this._asyncDeliveryQueue.shift(),n=[],o={...s,token:t,waitUntil:a=>{if(Object.isFrozen(n))throw new Error("waitUntil can NOT be called asynchronous");i&&(a=i(a,r)),n.push(a)}};try{r(o)}catch(a){pt(a);continue}Object.freeze(n),await Promise.allSettled(n).then(a=>{for(const l of a)l.status==="rejected"&&pt(l.reason)})}}},gc=class extends D{get isPaused(){return this._isPaused!==0}constructor(e){super(e),this._isPaused=0,this._eventQueue=new hn,this._mergeFn=e?.merge}pause(){this._isPaused++}resume(){if(this._isPaused!==0&&--this._isPaused===0)if(this._mergeFn){if(this._eventQueue.size>0){const e=Array.from(this._eventQueue);this._eventQueue.clear(),super.fire(this._mergeFn(e))}}else for(;!this._isPaused&&this._eventQueue.size!==0;)super.fire(this._eventQueue.shift())}fire(e){this._size&&(this._isPaused!==0?this._eventQueue.push(e):super.fire(e))}},pL=class extends gc{constructor(e){super(e),this._delay=e.delay??100}fire(e){this._handle||(this.pause(),this._handle=setTimeout(()=>{this._handle=void 0,this.resume()},this._delay)),super.fire(e)}},gL=class extends D{constructor(e){super(e),this._queuedEvents=[],this._mergeFn=e?.merge}fire(e){this.hasListeners()&&(this._queuedEvents.push(e),this._queuedEvents.length===1&&queueMicrotask(()=>{this._mergeFn?super.fire(this._mergeFn(this._queuedEvents)):this._queuedEvents.forEach(t=>super.fire(t)),this._queuedEvents=[]}))}},mL=class{constructor(){this.listening=!1,this.inputEvent=Fe.None,this.inputEventListener=X.None,this.emitter=new D({onDidAddFirstListener:()=>{this.listening=!0,this.inputEventListener=this.inputEvent(this.emitter.fire,this.emitter)},onDidRemoveLastListener:()=>{this.listening=!1,this.inputEventListener.dispose()}}),this.event=this.emitter.event}set input(e){this.inputEvent=e,this.listening&&(this.inputEventListener.dispose(),this.inputEventListener=e(this.emitter.fire,this.emitter))}dispose(){this.inputEventListener.dispose(),this.emitter.dispose()}},_x=Object.freeze(function(e,t){const i=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(i)}}}),Be;(function(e){function t(i){return i===e.None||i===e.Cancelled||i instanceof rh?!0:!i||typeof i!="object"?!1:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Fe.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:_x})})(Be||(Be={}));var rh=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?_x:(this._emitter||(this._emitter=new D),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},rt=class{constructor(e){this._token=void 0,this._parentListener=void 0,this._parentListener=e&&e.onCancellationRequested(this.cancel,this)}get token(){return this._token||(this._token=new rh),this._token}cancel(){this._token?this._token instanceof rh&&this._token.cancel():this._token=Be.Cancelled}dispose(e=!1){e&&this.cancel(),this._parentListener?.dispose(),this._token?this._token instanceof rh&&this._token.dispose():this._token=Be.None}};function vL(){return globalThis._VSCODE_NLS_MESSAGES}function wx(){return globalThis._VSCODE_NLS_LANGUAGE}var _L=wx()==="pseudo"||typeof document<"u"&&document.location&&typeof document.location.hash=="string"&&document.location.hash.indexOf("pseudo=true")>=0;function sh(e,t){let i;return t.length===0?i=e:i=e.replace(/\{(\d+)\}/g,(r,s)=>{const n=s[0],o=t[n];let a=r;return typeof o=="string"?a=o:(typeof o=="number"||typeof o=="boolean"||o===void 0||o===null)&&(a=String(o)),a}),_L&&(i="\uFF3B"+i.replace(/[aouei]/g,"$&$&")+"\uFF3D"),i}function h(e,t,...i){return sh(typeof e=="number"?yx(e,t):t,i)}function yx(e,t){const i=vL()?.[e];if(typeof i!="string"){if(typeof t=="string")return t;throw new Error(`!!! NLS MISSING: ${e} !!!`)}return i}function nh(e,t,...i){let r;typeof e=="number"?r=yx(e,t):r=t;const s=sh(r,i);return{value:s,original:t===r?s:sh(t,i)}}var fn="en",mc=!1,vc=!1,_c=!1,wL=!1,bx=!1,bv=!1,yL=!1,Sv=!1,Sx=!1,xx=!1,oh=void 0,ah=fn,Ex=fn,bL=void 0,bs=void 0,Ss=globalThis,tr=void 0;typeof Ss.vscode<"u"&&typeof Ss.vscode.process<"u"?tr=Ss.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(tr=process);var Cx=typeof tr?.versions?.electron=="string",SL=Cx&&tr?.type==="renderer";if(typeof tr=="object"){mc=tr.platform==="win32",vc=tr.platform==="darwin",_c=tr.platform==="linux",wL=_c&&!!tr.env.SNAP&&!!tr.env.SNAP_REVISION,yL=Cx,Sx=!!tr.env.CI||!!tr.env.BUILD_ARTIFACTSTAGINGDIRECTORY,oh=fn,ah=fn;const e=tr.env.VSCODE_NLS_CONFIG;if(e)try{const t=JSON.parse(e);oh=t.userLocale,Ex=t.osLocale,ah=t.resolvedLanguage||fn,bL=t.languagePack?.translationsConfigFile}catch{}bx=!0}else typeof navigator=="object"&&!SL?(bs=navigator.userAgent,mc=bs.indexOf("Windows")>=0,vc=bs.indexOf("Macintosh")>=0,Sv=(bs.indexOf("Macintosh")>=0||bs.indexOf("iPad")>=0||bs.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,_c=bs.indexOf("Linux")>=0,xx=bs?.indexOf("Mobi")>=0,bv=!0,ah=wx()||fn,oh=navigator.language.toLowerCase(),Ex=oh):console.error("Unable to resolve platform.");var Dx;(function(e){e[e.Web=0]="Web",e[e.Mac=1]="Mac",e[e.Linux=2]="Linux",e[e.Windows=3]="Windows"})(Dx||(Dx={}));function xL(e){switch(e){case 0:return"Web";case 1:return"Mac";case 2:return"Linux";case 3:return"Windows"}}var lh=0;vc?lh=1:mc?lh=3:_c&&(lh=2);var Ve=mc,Mt=vc,Ct=_c,kx=bx,Ca=bv,EL=bv&&typeof Ss.importScripts=="function",CL=EL?Ss.origin:void 0,DL=Sv,kL=xx,to=Sx,IL=lh,Xr=bs,pn=ah,Ix;(function(e){function t(){return pn}e.value=t;function i(){return pn.length===2?pn==="en":pn.length>=3?pn[0]==="e"&&pn[1]==="n"&&pn[2]==="-":!1}e.isDefaultVariant=i;function r(){return pn==="en"}e.isDefault=r})(Ix||(Ix={}));var PL=typeof Ss.postMessage=="function"&&!Ss.importScripts,Px=(()=>{if(PL){const e=[];Ss.addEventListener("message",i=>{if(i.data&&i.data.vscodeScheduleAsyncWork)for(let r=0,s=e.length;r<s;r++){const n=e[r];if(n.id===i.data.vscodeScheduleAsyncWork){e.splice(r,1),n.callback();return}}});let t=0;return i=>{const r=++t;e.push({id:r,callback:i}),Ss.postMessage({vscodeScheduleAsyncWork:r},"*")}}return e=>setTimeout(e)})(),Tx;(function(e){e[e.Windows=1]="Windows",e[e.Macintosh=2]="Macintosh",e[e.Linux=3]="Linux"})(Tx||(Tx={}));var io=vc||Sv?2:mc?1:3,Ax=!0,Rx=!1;function Lx(){if(!Rx){Rx=!0;const e=new Uint8Array(2);e[0]=1,e[1]=2,Ax=new Uint16Array(e.buffer)[0]===513}return Ax}var xv=!!(Xr&&Xr.indexOf("Chrome")>=0),TL=!!(Xr&&Xr.indexOf("Firefox")>=0),AL=!!(!xv&&Xr&&Xr.indexOf("Safari")>=0),Nx=!!(Xr&&Xr.indexOf("Edg/")>=0),fK=!!(Xr&&Xr.indexOf("Android")>=0),ro,Ev=globalThis.vscode;if(typeof Ev<"u"&&typeof Ev.process<"u"){const e=Ev.process;ro={get platform(){return e.platform},get arch(){return e.arch},get env(){return e.env},cwd(){return e.cwd()}}}else typeof process<"u"&&typeof process?.versions?.node=="string"?ro={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:ro={get platform(){return Ve?"win32":Mt?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var so=ro.cwd,gn=ro.env,RL=ro.platform,pK=ro.arch,LL=65,NL=97,ML=90,OL=122,no=46,li=47,Ui=92,xs=58,FL=63,Mx=class extends Error{constructor(e,t,i){let r;typeof t=="string"&&t.indexOf("not ")===0?(r="must not be",t=t.replace(/^not /,"")):r="must be";const s=e.indexOf(".")!==-1?"property":"argument";let n=`The "${e}" ${s} ${r} of type ${t}`;n+=`. Received type ${typeof i}`,super(n),this.code="ERR_INVALID_ARG_TYPE"}};function $L(e,t){if(e===null||typeof e!="object")throw new Mx(t,"Object",e)}function $t(e,t){if(typeof e!="string")throw new Mx(t,"string",e)}var Wi=RL==="win32";function Ae(e){return e===li||e===Ui}function Cv(e){return e===li}function Es(e){return e>=LL&&e<=ML||e>=NL&&e<=OL}function ch(e,t,i,r){let s="",n=0,o=-1,a=0,l=0;for(let c=0;c<=e.length;++c){if(c<e.length)l=e.charCodeAt(c);else{if(r(l))break;l=li}if(r(l)){if(!(o===c-1||a===1))if(a===2){if(s.length<2||n!==2||s.charCodeAt(s.length-1)!==no||s.charCodeAt(s.length-2)!==no){if(s.length>2){const u=s.lastIndexOf(i);u===-1?(s="",n=0):(s=s.slice(0,u),n=s.length-1-s.lastIndexOf(i)),o=c,a=0;continue}else if(s.length!==0){s="",n=0,o=c,a=0;continue}}t&&(s+=s.length>0?`${i}..`:"..",n=2)}else s.length>0?s+=`${i}${e.slice(o+1,c)}`:s=e.slice(o+1,c),n=c-o-1;o=c,a=0}else l===no&&a!==-1?++a:a=-1}return s}function HL(e){return e?`${e[0]==="."?"":"."}${e}`:""}function Ox(e,t){$L(t,"pathObject");const i=t.dir||t.root,r=t.base||`${t.name||""}${HL(t.ext)}`;return i?i===t.root?`${i}${r}`:`${i}${e}${r}`:r}var Ht={resolve(...e){let t="",i="",r=!1;for(let s=e.length-1;s>=-1;s--){let n;if(s>=0){if(n=e[s],$t(n,`paths[${s}]`),n.length===0)continue}else t.length===0?n=so():(n=gn[`=${t}`]||so(),(n===void 0||n.slice(0,2).toLowerCase()!==t.toLowerCase()&&n.charCodeAt(2)===Ui)&&(n=`${t}\\`));const o=n.length;let a=0,l="",c=!1;const u=n.charCodeAt(0);if(o===1)Ae(u)&&(a=1,c=!0);else if(Ae(u))if(c=!0,Ae(n.charCodeAt(1))){let d=2,f=d;for(;d<o&&!Ae(n.charCodeAt(d));)d++;if(d<o&&d!==f){const p=n.slice(f,d);for(f=d;d<o&&Ae(n.charCodeAt(d));)d++;if(d<o&&d!==f){for(f=d;d<o&&!Ae(n.charCodeAt(d));)d++;(d===o||d!==f)&&(l=`\\\\${p}\\${n.slice(f,d)}`,a=d)}}}else a=1;else Es(u)&&n.charCodeAt(1)===xs&&(l=n.slice(0,2),a=2,o>2&&Ae(n.charCodeAt(2))&&(c=!0,a=3));if(l.length>0)if(t.length>0){if(l.toLowerCase()!==t.toLowerCase())continue}else t=l;if(r){if(t.length>0)break}else if(i=`${n.slice(a)}\\${i}`,r=c,c&&t.length>0)break}return i=ch(i,!r,"\\",Ae),r?`${t}\\${i}`:`${t}${i}`||"."},normalize(e){$t(e,"path");const t=e.length;if(t===0)return".";let i=0,r,s=!1;const n=e.charCodeAt(0);if(t===1)return Cv(n)?"\\":e;if(Ae(n))if(s=!0,Ae(e.charCodeAt(1))){let a=2,l=a;for(;a<t&&!Ae(e.charCodeAt(a));)a++;if(a<t&&a!==l){const c=e.slice(l,a);for(l=a;a<t&&Ae(e.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&!Ae(e.charCodeAt(a));)a++;if(a===t)return`\\\\${c}\\${e.slice(l)}\\`;a!==l&&(r=`\\\\${c}\\${e.slice(l,a)}`,i=a)}}}else i=1;else Es(n)&&e.charCodeAt(1)===xs&&(r=e.slice(0,2),i=2,t>2&&Ae(e.charCodeAt(2))&&(s=!0,i=3));let o=i<t?ch(e.slice(i),!s,"\\",Ae):"";if(o.length===0&&!s&&(o="."),o.length>0&&Ae(e.charCodeAt(t-1))&&(o+="\\"),!s&&r===void 0&&e.includes(":")){if(o.length>=2&&Es(o.charCodeAt(0))&&o.charCodeAt(1)===xs)return`.\\${o}`;let a=e.indexOf(":");do if(a===t-1||Ae(e.charCodeAt(a+1)))return`.\\${o}`;while((a=e.indexOf(":",a+1))!==-1)}return r===void 0?s?`\\${o}`:o:s?`${r}\\${o}`:`${r}${o}`},isAbsolute(e){$t(e,"path");const t=e.length;if(t===0)return!1;const i=e.charCodeAt(0);return Ae(i)||t>2&&Es(i)&&e.charCodeAt(1)===xs&&Ae(e.charCodeAt(2))},join(...e){if(e.length===0)return".";let t,i;for(let n=0;n<e.length;++n){const o=e[n];$t(o,"path"),o.length>0&&(t===void 0?t=i=o:t+=`\\${o}`)}if(t===void 0)return".";let r=!0,s=0;if(typeof i=="string"&&Ae(i.charCodeAt(0))){++s;const n=i.length;n>1&&Ae(i.charCodeAt(1))&&(++s,n>2&&(Ae(i.charCodeAt(2))?++s:r=!1))}if(r){for(;s<t.length&&Ae(t.charCodeAt(s));)s++;s>=2&&(t=`\\${t.slice(s)}`)}return Ht.normalize(t)},relative(e,t){if($t(e,"from"),$t(t,"to"),e===t)return"";const i=Ht.resolve(e),r=Ht.resolve(t);if(i===r||(e=i.toLowerCase(),t=r.toLowerCase(),e===t))return"";if(i.length!==e.length||r.length!==t.length){const g=i.split("\\"),v=r.split("\\");g[g.length-1]===""&&g.pop(),v[v.length-1]===""&&v.pop();const y=g.length,S=v.length,x=y<S?y:S;let P;for(P=0;P<x&&g[P].toLowerCase()===v[P].toLowerCase();P++);return P===0?r:P===x?S>x?v.slice(P).join("\\"):y>x?"..\\".repeat(y-1-P)+"..":"":"..\\".repeat(y-P)+v.slice(P).join("\\")}let s=0;for(;s<e.length&&e.charCodeAt(s)===Ui;)s++;let n=e.length;for(;n-1>s&&e.charCodeAt(n-1)===Ui;)n--;const o=n-s;let a=0;for(;a<t.length&&t.charCodeAt(a)===Ui;)a++;let l=t.length;for(;l-1>a&&t.charCodeAt(l-1)===Ui;)l--;const c=l-a,u=o<c?o:c;let d=-1,f=0;for(;f<u;f++){const g=e.charCodeAt(s+f);if(g!==t.charCodeAt(a+f))break;g===Ui&&(d=f)}if(f!==u){if(d===-1)return r}else{if(c>u){if(t.charCodeAt(a+f)===Ui)return r.slice(a+f+1);if(f===2)return r.slice(a+f)}o>u&&(e.charCodeAt(s+f)===Ui?d=f:f===2&&(d=3)),d===-1&&(d=0)}let p="";for(f=s+d+1;f<=n;++f)(f===n||e.charCodeAt(f)===Ui)&&(p+=p.length===0?"..":"\\..");return a+=d,p.length>0?`${p}${r.slice(a,l)}`:(r.charCodeAt(a)===Ui&&++a,r.slice(a,l))},toNamespacedPath(e){if(typeof e!="string"||e.length===0)return e;const t=Ht.resolve(e);if(t.length<=2)return e;if(t.charCodeAt(0)===Ui){if(t.charCodeAt(1)===Ui){const i=t.charCodeAt(2);if(i!==FL&&i!==no)return`\\\\?\\UNC\\${t.slice(2)}`}}else if(Es(t.charCodeAt(0))&&t.charCodeAt(1)===xs&&t.charCodeAt(2)===Ui)return`\\\\?\\${t}`;return t},dirname(e){$t(e,"path");const t=e.length;if(t===0)return".";let i=-1,r=0;const s=e.charCodeAt(0);if(t===1)return Ae(s)?e:".";if(Ae(s)){if(i=r=1,Ae(e.charCodeAt(1))){let a=2,l=a;for(;a<t&&!Ae(e.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&Ae(e.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&!Ae(e.charCodeAt(a));)a++;if(a===t)return e;a!==l&&(i=r=a+1)}}}}else Es(s)&&e.charCodeAt(1)===xs&&(i=t>2&&Ae(e.charCodeAt(2))?3:2,r=i);let n=-1,o=!0;for(let a=t-1;a>=r;--a)if(Ae(e.charCodeAt(a))){if(!o){n=a;break}}else o=!1;if(n===-1){if(i===-1)return".";n=i}return e.slice(0,n)},basename(e,t){t!==void 0&&$t(t,"suffix"),$t(e,"path");let i=0,r=-1,s=!0,n;if(e.length>=2&&Es(e.charCodeAt(0))&&e.charCodeAt(1)===xs&&(i=2),t!==void 0&&t.length>0&&t.length<=e.length){if(t===e)return"";let o=t.length-1,a=-1;for(n=e.length-1;n>=i;--n){const l=e.charCodeAt(n);if(Ae(l)){if(!s){i=n+1;break}}else a===-1&&(s=!1,a=n+1),o>=0&&(l===t.charCodeAt(o)?--o===-1&&(r=n):(o=-1,r=a))}return i===r?r=a:r===-1&&(r=e.length),e.slice(i,r)}for(n=e.length-1;n>=i;--n)if(Ae(e.charCodeAt(n))){if(!s){i=n+1;break}}else r===-1&&(s=!1,r=n+1);return r===-1?"":e.slice(i,r)},extname(e){$t(e,"path");let t=0,i=-1,r=0,s=-1,n=!0,o=0;e.length>=2&&e.charCodeAt(1)===xs&&Es(e.charCodeAt(0))&&(t=r=2);for(let a=e.length-1;a>=t;--a){const l=e.charCodeAt(a);if(Ae(l)){if(!n){r=a+1;break}continue}s===-1&&(n=!1,s=a+1),l===no?i===-1?i=a:o!==1&&(o=1):i!==-1&&(o=-1)}return i===-1||s===-1||o===0||o===1&&i===s-1&&i===r+1?"":e.slice(i,s)},format:Ox.bind(null,"\\"),parse(e){$t(e,"path");const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;const i=e.length;let r=0,s=e.charCodeAt(0);if(i===1)return Ae(s)?(t.root=t.dir=e,t):(t.base=t.name=e,t);if(Ae(s)){if(r=1,Ae(e.charCodeAt(1))){let d=2,f=d;for(;d<i&&!Ae(e.charCodeAt(d));)d++;if(d<i&&d!==f){for(f=d;d<i&&Ae(e.charCodeAt(d));)d++;if(d<i&&d!==f){for(f=d;d<i&&!Ae(e.charCodeAt(d));)d++;d===i?r=d:d!==f&&(r=d+1)}}}}else if(Es(s)&&e.charCodeAt(1)===xs){if(i<=2)return t.root=t.dir=e,t;if(r=2,Ae(e.charCodeAt(2))){if(i===3)return t.root=t.dir=e,t;r=3}}r>0&&(t.root=e.slice(0,r));let n=-1,o=r,a=-1,l=!0,c=e.length-1,u=0;for(;c>=r;--c){if(s=e.charCodeAt(c),Ae(s)){if(!l){o=c+1;break}continue}a===-1&&(l=!1,a=c+1),s===no?n===-1?n=c:u!==1&&(u=1):n!==-1&&(u=-1)}return a!==-1&&(n===-1||u===0||u===1&&n===a-1&&n===o+1?t.base=t.name=e.slice(o,a):(t.name=e.slice(o,n),t.base=e.slice(o,a),t.ext=e.slice(n,a))),o>0&&o!==r?t.dir=e.slice(0,o-1):t.dir=t.root,t},sep:"\\",delimiter:";",win32:null,posix:null},UL=(()=>{if(Wi){const e=/\\/g;return()=>{const t=so().replace(e,"/");return t.slice(t.indexOf("/"))}}return()=>so()})(),$e={resolve(...e){let t="",i=!1;for(let r=e.length-1;r>=0&&!i;r--){const s=e[r];$t(s,`paths[${r}]`),s.length!==0&&(t=`${s}/${t}`,i=s.charCodeAt(0)===li)}if(!i){const r=UL();t=`${r}/${t}`,i=r.charCodeAt(0)===li}return t=ch(t,!i,"/",Cv),i?`/${t}`:t.length>0?t:"."},normalize(e){if($t(e,"path"),e.length===0)return".";const t=e.charCodeAt(0)===li,i=e.charCodeAt(e.length-1)===li;return e=ch(e,!t,"/",Cv),e.length===0?t?"/":i?"./":".":(i&&(e+="/"),t?`/${e}`:e)},isAbsolute(e){return $t(e,"path"),e.length>0&&e.charCodeAt(0)===li},join(...e){if(e.length===0)return".";const t=[];for(let i=0;i<e.length;++i){const r=e[i];$t(r,"path"),r.length>0&&t.push(r)}return t.length===0?".":$e.normalize(t.join("/"))},relative(e,t){if($t(e,"from"),$t(t,"to"),e===t||(e=$e.resolve(e),t=$e.resolve(t),e===t))return"";const i=1,r=e.length,s=r-i,n=1,o=t.length-n,a=s<o?s:o;let l=-1,c=0;for(;c<a;c++){const d=e.charCodeAt(i+c);if(d!==t.charCodeAt(n+c))break;d===li&&(l=c)}if(c===a)if(o>a){if(t.charCodeAt(n+c)===li)return t.slice(n+c+1);if(c===0)return t.slice(n+c)}else s>a&&(e.charCodeAt(i+c)===li?l=c:c===0&&(l=0));let u="";for(c=i+l+1;c<=r;++c)(c===r||e.charCodeAt(c)===li)&&(u+=u.length===0?"..":"/..");return`${u}${t.slice(n+l)}`},toNamespacedPath(e){return e},dirname(e){if($t(e,"path"),e.length===0)return".";const t=e.charCodeAt(0)===li;let i=-1,r=!0;for(let s=e.length-1;s>=1;--s)if(e.charCodeAt(s)===li){if(!r){i=s;break}}else r=!1;return i===-1?t?"/":".":t&&i===1?"//":e.slice(0,i)},basename(e,t){t!==void 0&&$t(t,"suffix"),$t(e,"path");let i=0,r=-1,s=!0,n;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t===e)return"";let o=t.length-1,a=-1;for(n=e.length-1;n>=0;--n){const l=e.charCodeAt(n);if(l===li){if(!s){i=n+1;break}}else a===-1&&(s=!1,a=n+1),o>=0&&(l===t.charCodeAt(o)?--o===-1&&(r=n):(o=-1,r=a))}return i===r?r=a:r===-1&&(r=e.length),e.slice(i,r)}for(n=e.length-1;n>=0;--n)if(e.charCodeAt(n)===li){if(!s){i=n+1;break}}else r===-1&&(s=!1,r=n+1);return r===-1?"":e.slice(i,r)},extname(e){$t(e,"path");let t=-1,i=0,r=-1,s=!0,n=0;for(let o=e.length-1;o>=0;--o){const a=e[o];if(a==="/"){if(!s){i=o+1;break}continue}r===-1&&(s=!1,r=o+1),a==="."?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||r===-1||n===0||n===1&&t===r-1&&t===i+1?"":e.slice(t,r)},format:Ox.bind(null,"/"),parse(e){$t(e,"path");const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;const i=e.charCodeAt(0)===li;let r;i?(t.root="/",r=1):r=0;let s=-1,n=0,o=-1,a=!0,l=e.length-1,c=0;for(;l>=r;--l){const u=e.charCodeAt(l);if(u===li){if(!a){n=l+1;break}continue}o===-1&&(a=!1,o=l+1),u===no?s===-1?s=l:c!==1&&(c=1):s!==-1&&(c=-1)}if(o!==-1){const u=n===0&&i?1:n;s===-1||c===0||c===1&&s===o-1&&s===n+1?t.base=t.name=e.slice(u,o):(t.name=e.slice(u,s),t.base=e.slice(u,o),t.ext=e.slice(s,o))}return n>0?t.dir=e.slice(0,n-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};$e.win32=Ht.win32=Ht,$e.posix=Ht.posix=$e;var Cs=Wi?Ht.normalize:$e.normalize,Dr=Wi?Ht.isAbsolute:$e.isAbsolute,Xe=Wi?Ht.join:$e.join,WL=Wi?Ht.resolve:$e.resolve,Da=Wi?Ht.relative:$e.relative,Bi=Wi?Ht.dirname:$e.dirname,bt=Wi?Ht.basename:$e.basename,uh=Wi?Ht.extname:$e.extname,gK=Wi?Ht.format:$e.format,mK=Wi?Ht.parse:$e.parse,vK=Wi?Ht.toNamespacedPath:$e.toNamespacedPath,St=Wi?Ht.sep:$e.sep,Fx=Wi?Ht.delimiter:$e.delimiter;function BL(e){return e}var VL=class{constructor(e,t){this.lastCache=void 0,this.lastArgKey=void 0,typeof e=="function"?(this._fn=e,this._computeKey=BL):(this._fn=t,this._computeKey=e.getCacheKey)}get(e){const t=this._computeKey(e);return this.lastArgKey!==t&&(this.lastArgKey=t,this.lastCache=this._fn(e)),this.lastCache}},Si=class{constructor(e){this.executor=e,this._didRun=!1}get hasValue(){return this._didRun}get value(){if(!this._didRun)try{this._value=this.executor()}catch(e){this._error=e}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}};function dh(e){return!e||typeof e!="string"?!0:e.trim().length===0}var zL=/{([^}]+)}/g;function $x(e,t){return Object.keys(t).length===0?e:e.replace(zL,(i,r)=>t[r]??i)}function mn(e){return e.replace(/[\\\{\}\*\+\?\|\^\$\.\[\]\(\)]/g,"\\$&")}function qL(e,t){let i=0,r=e.indexOf(t);for(;r!==-1;)i++,r=e.indexOf(t,r+t.length);return i}function jL(e,t){if(!e||!t)return e;const i=t.length;if(i===0||e.length===0)return e;let r=0;for(;e.indexOf(t,r)===r;)r=r+i;return e.substring(r)}function vn(e,t){if(!e||!t)return e;const i=t.length,r=e.length;if(i===0||r===0)return e;let s=r,n=-1;for(;n=e.lastIndexOf(t,s-1),!(n===-1||n+i!==s);){if(n===0)return"";s=n}return e.substring(0,s)}function GL(e){return e.replace(/\*/g,"")}function Hx(e,t,i={}){if(!e)throw new Error("Cannot create regex from empty string");t||(e=mn(e)),i.wholeWord&&(/\B/.test(e.charAt(0))||(e="\\b"+e),/\B/.test(e.charAt(e.length-1))||(e=e+"\\b"));let r="";return i.global&&(r+="g"),i.matchCase||(r+="i"),i.multiline&&(r+="m"),i.unicode&&(r+="u"),new RegExp(e,r)}function Ux(e){return e.source==="^"||e.source==="^$"||e.source==="$"||e.source==="^\\s*$"?!1:!!(e.exec("")&&e.lastIndex===0)}function Wx(e){return e.split(/\r\n|\r|\n/)}function Dv(e){for(let t=0,i=e.length;t<i;t++){const r=e.charCodeAt(t);if(r!==32&&r!==9)return t}return-1}function QL(e,t=e.length-1){for(let i=t;i>=0;i--){const r=e.charCodeAt(i);if(r!==32&&r!==9)return i}return-1}function oo(e,t){return e<t?-1:e>t?1:0}function kv(e,t,i=0,r=e.length,s=0,n=t.length){for(;i<r&&s<n;i++,s++){const l=e.charCodeAt(i),c=t.charCodeAt(s);if(l<c)return-1;if(l>c)return 1}const o=r-i,a=n-s;return o<a?-1:o>a?1:0}function Iv(e,t){return wc(e,t,0,e.length,0,t.length)}function wc(e,t,i=0,r=e.length,s=0,n=t.length){for(;i<r&&s<n;i++,s++){let l=e.charCodeAt(i),c=t.charCodeAt(s);if(l===c)continue;if(l>=128||c>=128)return kv(e.toLowerCase(),t.toLowerCase(),i,r,s,n);Bx(l)&&(l-=32),Bx(c)&&(c-=32);const u=l-c;if(u!==0)return u}const o=r-i,a=n-s;return o<a?-1:o>a?1:0}function Bx(e){return e>=97&&e<=122}function Vx(e){return e>=65&&e<=90}function kr(e,t){return e.length===t.length&&wc(e,t)===0}function hh(e,t){const i=t.length;return t.length>e.length?!1:wc(e,t,0,i)===0}function JL(e,t){const i=Math.min(e.length,t.length);let r;for(r=0;r<i;r++)if(e.charCodeAt(r)!==t.charCodeAt(r))return r;return i}function fh(e){return 55296<=e&&e<=56319}function ph(e){return 56320<=e&&e<=57343}function Pv(e,t){return(e-55296<<10)+(t-56320)+65536}function zx(e,t,i){const r=e.charCodeAt(i);if(fh(r)&&i+1<t){const s=e.charCodeAt(i+1);if(ph(s))return Pv(r,s)}return r}function KL(e,t){const i=e.charCodeAt(t-1);if(ph(i)&&t>1){const r=e.charCodeAt(t-2);if(fh(r))return Pv(r,i)}return i}var XL=class{get offset(){return this._offset}constructor(e,t=0){this._str=e,this._len=e.length,this._offset=t}setOffset(e){this._offset=e}prevCodePoint(){const e=KL(this._str,this._offset);return this._offset-=e>=65536?2:1,e}nextCodePoint(){const e=zx(this._str,this._len,this._offset);return this._offset+=e>=65536?2:1,e}eol(){return this._offset>=this._len}},YL=class{get offset(){return this._iterator.offset}constructor(e,t=0){this._iterator=new XL(e,t)}nextGraphemeLength(){const e=Xx.getInstance(),t=this._iterator,i=t.offset;let r=e.getGraphemeBreakType(t.nextCodePoint());for(;!t.eol();){const s=t.offset,n=e.getGraphemeBreakType(t.nextCodePoint());if(Jx(r,n)){t.setOffset(s);break}r=n}return t.offset-i}prevGraphemeLength(){const e=Xx.getInstance(),t=this._iterator,i=t.offset;let r=e.getGraphemeBreakType(t.prevCodePoint());for(;t.offset>0;){const s=t.offset,n=e.getGraphemeBreakType(t.prevCodePoint());if(Jx(n,r)){t.setOffset(s);break}r=n}return i-t.offset}eol(){return this._iterator.eol()}};function qx(e,t){return new YL(e,t).nextGraphemeLength()}var Tv=void 0;function ZL(){return/(?:[\u05BE\u05C0\u05C3\u05C6\u05D0-\u05F4\u0608\u060B\u060D\u061B-\u064A\u066D-\u066F\u0671-\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u0710\u0712-\u072F\u074D-\u07A5\u07B1-\u07EA\u07F4\u07F5\u07FA\u07FE-\u0815\u081A\u0824\u0828\u0830-\u0858\u085E-\u088E\u08A0-\u08C9\u200F\uFB1D\uFB1F-\uFB28\uFB2A-\uFD3D\uFD50-\uFDC7\uFDF0-\uFDFC\uFE70-\uFEFC]|\uD802[\uDC00-\uDD1B\uDD20-\uDE00\uDE10-\uDE35\uDE40-\uDEE4\uDEEB-\uDF35\uDF40-\uDFFF]|\uD803[\uDC00-\uDD23\uDE80-\uDEA9\uDEAD-\uDF45\uDF51-\uDF81\uDF86-\uDFF6]|\uD83A[\uDC00-\uDCCF\uDD00-\uDD43\uDD4B-\uDFFF]|\uD83B[\uDC00-\uDEBB])/}function jx(e){return Tv||(Tv=ZL()),Tv.test(e)}var e3=/^[\t\n\r\x20-\x7E]*$/;function t3(e){return e3.test(e)}var i3=/[\u2028\u2029]/;function Gx(e){return i3.test(e)}var r3=/(?:\x1b\[|\x9b)[=?>!]?[\d;:]*["$#'* ]?[a-zA-Z@^`{}|~]/,s3=/(?:\x1b\]|\x9d).*?(?:\x1b\\|\x07|\x9c)/,n3=/\x1b(?:[ #%\(\)\*\+\-\.\/]?[a-zA-Z0-9\|}~@])/,_K=new RegExp("(?:"+[r3.source,s3.source,n3.source].join("|")+")","g"),o3="\uFEFF";function a3(e){return!!(e&&e.length>0&&e.charCodeAt(0)===65279)}function l3(e,t){if(!e||!t||e.length<t.length)return!1;const i=t.length,r=e.toLowerCase();let s=0,n=-1;for(;s<i;){const o=r.indexOf(t[s],n+1);if(o<0)return!1;n=o,s++}return!0}function Qx(e,t=!1){return e?(t&&(e=e.replace(/\\./g,"")),e.toLowerCase()!==e):!1}function c3(e){return e.charAt(0).toUpperCase()+e.slice(1)}function u3(e,t=1){if(t===0)return"";let i=-1;do i=e.indexOf(`
`,i+1),t--;while(t>0&&i>=0);return i===-1?e:(e[i-1]==="\r"&&i--,e.substr(0,i))}function Jx(e,t){return e===0?t!==5&&t!==7:e===2&&t===3?!1:e===4||e===2||e===3||t===4||t===2||t===3?!0:!(e===8&&(t===8||t===9||t===11||t===12)||(e===11||e===9)&&(t===9||t===10)||(e===12||e===10)&&t===10||t===5||t===13||t===7||e===1||e===13&&t===14||e===6&&t===6)}var Kx;(function(e){e[e.Other=0]="Other",e[e.Prepend=1]="Prepend",e[e.CR=2]="CR",e[e.LF=3]="LF",e[e.Control=4]="Control",e[e.Extend=5]="Extend",e[e.Regional_Indicator=6]="Regional_Indicator",e[e.SpacingMark=7]="SpacingMark",e[e.L=8]="L",e[e.V=9]="V",e[e.T=10]="T",e[e.LV=11]="LV",e[e.LVT=12]="LVT",e[e.ZWJ=13]="ZWJ",e[e.Extended_Pictographic=14]="Extended_Pictographic"})(Kx||(Kx={}));var Xx=class $d{static{this._INSTANCE=null}static getInstance(){return $d._INSTANCE||($d._INSTANCE=new $d),$d._INSTANCE}constructor(){this._data=d3()}getGraphemeBreakType(t){if(t<32)return t===10?3:t===13?2:4;if(t<127)return 0;const i=this._data,r=i.length/3;let s=1;for(;s<=r;)if(t<i[3*s])s=2*s;else if(t>i[3*s+1])s=2*s+1;else return i[3*s+2];return 0}};function d3(){return JSON.parse("[0,0,0,51229,51255,12,44061,44087,12,127462,127487,6,7083,7085,5,47645,47671,12,54813,54839,12,128678,128678,14,3270,3270,5,9919,9923,14,45853,45879,12,49437,49463,12,53021,53047,12,71216,71218,7,128398,128399,14,129360,129374,14,2519,2519,5,4448,4519,9,9742,9742,14,12336,12336,14,44957,44983,12,46749,46775,12,48541,48567,12,50333,50359,12,52125,52151,12,53917,53943,12,69888,69890,5,73018,73018,5,127990,127990,14,128558,128559,14,128759,128760,14,129653,129655,14,2027,2035,5,2891,2892,7,3761,3761,5,6683,6683,5,8293,8293,4,9825,9826,14,9999,9999,14,43452,43453,5,44509,44535,12,45405,45431,12,46301,46327,12,47197,47223,12,48093,48119,12,48989,49015,12,49885,49911,12,50781,50807,12,51677,51703,12,52573,52599,12,53469,53495,12,54365,54391,12,65279,65279,4,70471,70472,7,72145,72147,7,119173,119179,5,127799,127818,14,128240,128244,14,128512,128512,14,128652,128652,14,128721,128722,14,129292,129292,14,129445,129450,14,129734,129743,14,1476,1477,5,2366,2368,7,2750,2752,7,3076,3076,5,3415,3415,5,4141,4144,5,6109,6109,5,6964,6964,5,7394,7400,5,9197,9198,14,9770,9770,14,9877,9877,14,9968,9969,14,10084,10084,14,43052,43052,5,43713,43713,5,44285,44311,12,44733,44759,12,45181,45207,12,45629,45655,12,46077,46103,12,46525,46551,12,46973,46999,12,47421,47447,12,47869,47895,12,48317,48343,12,48765,48791,12,49213,49239,12,49661,49687,12,50109,50135,12,50557,50583,12,51005,51031,12,51453,51479,12,51901,51927,12,52349,52375,12,52797,52823,12,53245,53271,12,53693,53719,12,54141,54167,12,54589,54615,12,55037,55063,12,69506,69509,5,70191,70193,5,70841,70841,7,71463,71467,5,72330,72342,5,94031,94031,5,123628,123631,5,127763,127765,14,127941,127941,14,128043,128062,14,128302,128317,14,128465,128467,14,128539,128539,14,128640,128640,14,128662,128662,14,128703,128703,14,128745,128745,14,129004,129007,14,129329,129330,14,129402,129402,14,129483,129483,14,129686,129704,14,130048,131069,14,173,173,4,1757,1757,1,2200,2207,5,2434,2435,7,2631,2632,5,2817,2817,5,3008,3008,5,3201,3201,5,3387,3388,5,3542,3542,5,3902,3903,7,4190,4192,5,6002,6003,5,6439,6440,5,6765,6770,7,7019,7027,5,7154,7155,7,8205,8205,13,8505,8505,14,9654,9654,14,9757,9757,14,9792,9792,14,9852,9853,14,9890,9894,14,9937,9937,14,9981,9981,14,10035,10036,14,11035,11036,14,42654,42655,5,43346,43347,7,43587,43587,5,44006,44007,7,44173,44199,12,44397,44423,12,44621,44647,12,44845,44871,12,45069,45095,12,45293,45319,12,45517,45543,12,45741,45767,12,45965,45991,12,46189,46215,12,46413,46439,12,46637,46663,12,46861,46887,12,47085,47111,12,47309,47335,12,47533,47559,12,47757,47783,12,47981,48007,12,48205,48231,12,48429,48455,12,48653,48679,12,48877,48903,12,49101,49127,12,49325,49351,12,49549,49575,12,49773,49799,12,49997,50023,12,50221,50247,12,50445,50471,12,50669,50695,12,50893,50919,12,51117,51143,12,51341,51367,12,51565,51591,12,51789,51815,12,52013,52039,12,52237,52263,12,52461,52487,12,52685,52711,12,52909,52935,12,53133,53159,12,53357,53383,12,53581,53607,12,53805,53831,12,54029,54055,12,54253,54279,12,54477,54503,12,54701,54727,12,54925,54951,12,55149,55175,12,68101,68102,5,69762,69762,7,70067,70069,7,70371,70378,5,70720,70721,7,71087,71087,5,71341,71341,5,71995,71996,5,72249,72249,7,72850,72871,5,73109,73109,5,118576,118598,5,121505,121519,5,127245,127247,14,127568,127569,14,127777,127777,14,127872,127891,14,127956,127967,14,128015,128016,14,128110,128172,14,128259,128259,14,128367,128368,14,128424,128424,14,128488,128488,14,128530,128532,14,128550,128551,14,128566,128566,14,128647,128647,14,128656,128656,14,128667,128673,14,128691,128693,14,128715,128715,14,128728,128732,14,128752,128752,14,128765,128767,14,129096,129103,14,129311,129311,14,129344,129349,14,129394,129394,14,129413,129425,14,129466,129471,14,129511,129535,14,129664,129666,14,129719,129722,14,129760,129767,14,917536,917631,5,13,13,2,1160,1161,5,1564,1564,4,1807,1807,1,2085,2087,5,2307,2307,7,2382,2383,7,2497,2500,5,2563,2563,7,2677,2677,5,2763,2764,7,2879,2879,5,2914,2915,5,3021,3021,5,3142,3144,5,3263,3263,5,3285,3286,5,3398,3400,7,3530,3530,5,3633,3633,5,3864,3865,5,3974,3975,5,4155,4156,7,4229,4230,5,5909,5909,7,6078,6085,7,6277,6278,5,6451,6456,7,6744,6750,5,6846,6846,5,6972,6972,5,7074,7077,5,7146,7148,7,7222,7223,5,7416,7417,5,8234,8238,4,8417,8417,5,9000,9000,14,9203,9203,14,9730,9731,14,9748,9749,14,9762,9763,14,9776,9783,14,9800,9811,14,9831,9831,14,9872,9873,14,9882,9882,14,9900,9903,14,9929,9933,14,9941,9960,14,9974,9974,14,9989,9989,14,10006,10006,14,10062,10062,14,10160,10160,14,11647,11647,5,12953,12953,14,43019,43019,5,43232,43249,5,43443,43443,5,43567,43568,7,43696,43696,5,43765,43765,7,44013,44013,5,44117,44143,12,44229,44255,12,44341,44367,12,44453,44479,12,44565,44591,12,44677,44703,12,44789,44815,12,44901,44927,12,45013,45039,12,45125,45151,12,45237,45263,12,45349,45375,12,45461,45487,12,45573,45599,12,45685,45711,12,45797,45823,12,45909,45935,12,46021,46047,12,46133,46159,12,46245,46271,12,46357,46383,12,46469,46495,12,46581,46607,12,46693,46719,12,46805,46831,12,46917,46943,12,47029,47055,12,47141,47167,12,47253,47279,12,47365,47391,12,47477,47503,12,47589,47615,12,47701,47727,12,47813,47839,12,47925,47951,12,48037,48063,12,48149,48175,12,48261,48287,12,48373,48399,12,48485,48511,12,48597,48623,12,48709,48735,12,48821,48847,12,48933,48959,12,49045,49071,12,49157,49183,12,49269,49295,12,49381,49407,12,49493,49519,12,49605,49631,12,49717,49743,12,49829,49855,12,49941,49967,12,50053,50079,12,50165,50191,12,50277,50303,12,50389,50415,12,50501,50527,12,50613,50639,12,50725,50751,12,50837,50863,12,50949,50975,12,51061,51087,12,51173,51199,12,51285,51311,12,51397,51423,12,51509,51535,12,51621,51647,12,51733,51759,12,51845,51871,12,51957,51983,12,52069,52095,12,52181,52207,12,52293,52319,12,52405,52431,12,52517,52543,12,52629,52655,12,52741,52767,12,52853,52879,12,52965,52991,12,53077,53103,12,53189,53215,12,53301,53327,12,53413,53439,12,53525,53551,12,53637,53663,12,53749,53775,12,53861,53887,12,53973,53999,12,54085,54111,12,54197,54223,12,54309,54335,12,54421,54447,12,54533,54559,12,54645,54671,12,54757,54783,12,54869,54895,12,54981,55007,12,55093,55119,12,55243,55291,10,66045,66045,5,68325,68326,5,69688,69702,5,69817,69818,5,69957,69958,7,70089,70092,5,70198,70199,5,70462,70462,5,70502,70508,5,70750,70750,5,70846,70846,7,71100,71101,5,71230,71230,7,71351,71351,5,71737,71738,5,72000,72000,7,72160,72160,5,72273,72278,5,72752,72758,5,72882,72883,5,73031,73031,5,73461,73462,7,94192,94193,7,119149,119149,7,121403,121452,5,122915,122916,5,126980,126980,14,127358,127359,14,127535,127535,14,127759,127759,14,127771,127771,14,127792,127793,14,127825,127867,14,127897,127899,14,127945,127945,14,127985,127986,14,128000,128007,14,128021,128021,14,128066,128100,14,128184,128235,14,128249,128252,14,128266,128276,14,128335,128335,14,128379,128390,14,128407,128419,14,128444,128444,14,128481,128481,14,128499,128499,14,128526,128526,14,128536,128536,14,128543,128543,14,128556,128556,14,128564,128564,14,128577,128580,14,128643,128645,14,128649,128649,14,128654,128654,14,128660,128660,14,128664,128664,14,128675,128675,14,128686,128689,14,128695,128696,14,128705,128709,14,128717,128719,14,128725,128725,14,128736,128741,14,128747,128748,14,128755,128755,14,128762,128762,14,128981,128991,14,129009,129023,14,129160,129167,14,129296,129304,14,129320,129327,14,129340,129342,14,129356,129356,14,129388,129392,14,129399,129400,14,129404,129407,14,129432,129442,14,129454,129455,14,129473,129474,14,129485,129487,14,129648,129651,14,129659,129660,14,129671,129679,14,129709,129711,14,129728,129730,14,129751,129753,14,129776,129782,14,917505,917505,4,917760,917999,5,10,10,3,127,159,4,768,879,5,1471,1471,5,1536,1541,1,1648,1648,5,1767,1768,5,1840,1866,5,2070,2073,5,2137,2139,5,2274,2274,1,2363,2363,7,2377,2380,7,2402,2403,5,2494,2494,5,2507,2508,7,2558,2558,5,2622,2624,7,2641,2641,5,2691,2691,7,2759,2760,5,2786,2787,5,2876,2876,5,2881,2884,5,2901,2902,5,3006,3006,5,3014,3016,7,3072,3072,5,3134,3136,5,3157,3158,5,3260,3260,5,3266,3266,5,3274,3275,7,3328,3329,5,3391,3392,7,3405,3405,5,3457,3457,5,3536,3537,7,3551,3551,5,3636,3642,5,3764,3772,5,3895,3895,5,3967,3967,7,3993,4028,5,4146,4151,5,4182,4183,7,4226,4226,5,4253,4253,5,4957,4959,5,5940,5940,7,6070,6070,7,6087,6088,7,6158,6158,4,6432,6434,5,6448,6449,7,6679,6680,5,6742,6742,5,6754,6754,5,6783,6783,5,6912,6915,5,6966,6970,5,6978,6978,5,7042,7042,7,7080,7081,5,7143,7143,7,7150,7150,7,7212,7219,5,7380,7392,5,7412,7412,5,8203,8203,4,8232,8232,4,8265,8265,14,8400,8412,5,8421,8432,5,8617,8618,14,9167,9167,14,9200,9200,14,9410,9410,14,9723,9726,14,9733,9733,14,9745,9745,14,9752,9752,14,9760,9760,14,9766,9766,14,9774,9774,14,9786,9786,14,9794,9794,14,9823,9823,14,9828,9828,14,9833,9850,14,9855,9855,14,9875,9875,14,9880,9880,14,9885,9887,14,9896,9897,14,9906,9916,14,9926,9927,14,9935,9935,14,9939,9939,14,9962,9962,14,9972,9972,14,9978,9978,14,9986,9986,14,9997,9997,14,10002,10002,14,10017,10017,14,10055,10055,14,10071,10071,14,10133,10135,14,10548,10549,14,11093,11093,14,12330,12333,5,12441,12442,5,42608,42610,5,43010,43010,5,43045,43046,5,43188,43203,7,43302,43309,5,43392,43394,5,43446,43449,5,43493,43493,5,43571,43572,7,43597,43597,7,43703,43704,5,43756,43757,5,44003,44004,7,44009,44010,7,44033,44059,12,44089,44115,12,44145,44171,12,44201,44227,12,44257,44283,12,44313,44339,12,44369,44395,12,44425,44451,12,44481,44507,12,44537,44563,12,44593,44619,12,44649,44675,12,44705,44731,12,44761,44787,12,44817,44843,12,44873,44899,12,44929,44955,12,44985,45011,12,45041,45067,12,45097,45123,12,45153,45179,12,45209,45235,12,45265,45291,12,45321,45347,12,45377,45403,12,45433,45459,12,45489,45515,12,45545,45571,12,45601,45627,12,45657,45683,12,45713,45739,12,45769,45795,12,45825,45851,12,45881,45907,12,45937,45963,12,45993,46019,12,46049,46075,12,46105,46131,12,46161,46187,12,46217,46243,12,46273,46299,12,46329,46355,12,46385,46411,12,46441,46467,12,46497,46523,12,46553,46579,12,46609,46635,12,46665,46691,12,46721,46747,12,46777,46803,12,46833,46859,12,46889,46915,12,46945,46971,12,47001,47027,12,47057,47083,12,47113,47139,12,47169,47195,12,47225,47251,12,47281,47307,12,47337,47363,12,47393,47419,12,47449,47475,12,47505,47531,12,47561,47587,12,47617,47643,12,47673,47699,12,47729,47755,12,47785,47811,12,47841,47867,12,47897,47923,12,47953,47979,12,48009,48035,12,48065,48091,12,48121,48147,12,48177,48203,12,48233,48259,12,48289,48315,12,48345,48371,12,48401,48427,12,48457,48483,12,48513,48539,12,48569,48595,12,48625,48651,12,48681,48707,12,48737,48763,12,48793,48819,12,48849,48875,12,48905,48931,12,48961,48987,12,49017,49043,12,49073,49099,12,49129,49155,12,49185,49211,12,49241,49267,12,49297,49323,12,49353,49379,12,49409,49435,12,49465,49491,12,49521,49547,12,49577,49603,12,49633,49659,12,49689,49715,12,49745,49771,12,49801,49827,12,49857,49883,12,49913,49939,12,49969,49995,12,50025,50051,12,50081,50107,12,50137,50163,12,50193,50219,12,50249,50275,12,50305,50331,12,50361,50387,12,50417,50443,12,50473,50499,12,50529,50555,12,50585,50611,12,50641,50667,12,50697,50723,12,50753,50779,12,50809,50835,12,50865,50891,12,50921,50947,12,50977,51003,12,51033,51059,12,51089,51115,12,51145,51171,12,51201,51227,12,51257,51283,12,51313,51339,12,51369,51395,12,51425,51451,12,51481,51507,12,51537,51563,12,51593,51619,12,51649,51675,12,51705,51731,12,51761,51787,12,51817,51843,12,51873,51899,12,51929,51955,12,51985,52011,12,52041,52067,12,52097,52123,12,52153,52179,12,52209,52235,12,52265,52291,12,52321,52347,12,52377,52403,12,52433,52459,12,52489,52515,12,52545,52571,12,52601,52627,12,52657,52683,12,52713,52739,12,52769,52795,12,52825,52851,12,52881,52907,12,52937,52963,12,52993,53019,12,53049,53075,12,53105,53131,12,53161,53187,12,53217,53243,12,53273,53299,12,53329,53355,12,53385,53411,12,53441,53467,12,53497,53523,12,53553,53579,12,53609,53635,12,53665,53691,12,53721,53747,12,53777,53803,12,53833,53859,12,53889,53915,12,53945,53971,12,54001,54027,12,54057,54083,12,54113,54139,12,54169,54195,12,54225,54251,12,54281,54307,12,54337,54363,12,54393,54419,12,54449,54475,12,54505,54531,12,54561,54587,12,54617,54643,12,54673,54699,12,54729,54755,12,54785,54811,12,54841,54867,12,54897,54923,12,54953,54979,12,55009,55035,12,55065,55091,12,55121,55147,12,55177,55203,12,65024,65039,5,65520,65528,4,66422,66426,5,68152,68154,5,69291,69292,5,69633,69633,5,69747,69748,5,69811,69814,5,69826,69826,5,69932,69932,7,70016,70017,5,70079,70080,7,70095,70095,5,70196,70196,5,70367,70367,5,70402,70403,7,70464,70464,5,70487,70487,5,70709,70711,7,70725,70725,7,70833,70834,7,70843,70844,7,70849,70849,7,71090,71093,5,71103,71104,5,71227,71228,7,71339,71339,5,71344,71349,5,71458,71461,5,71727,71735,5,71985,71989,7,71998,71998,5,72002,72002,7,72154,72155,5,72193,72202,5,72251,72254,5,72281,72283,5,72344,72345,5,72766,72766,7,72874,72880,5,72885,72886,5,73023,73029,5,73104,73105,5,73111,73111,5,92912,92916,5,94095,94098,5,113824,113827,4,119142,119142,7,119155,119162,4,119362,119364,5,121476,121476,5,122888,122904,5,123184,123190,5,125252,125258,5,127183,127183,14,127340,127343,14,127377,127386,14,127491,127503,14,127548,127551,14,127744,127756,14,127761,127761,14,127769,127769,14,127773,127774,14,127780,127788,14,127796,127797,14,127820,127823,14,127869,127869,14,127894,127895,14,127902,127903,14,127943,127943,14,127947,127950,14,127972,127972,14,127988,127988,14,127992,127994,14,128009,128011,14,128019,128019,14,128023,128041,14,128064,128064,14,128102,128107,14,128174,128181,14,128238,128238,14,128246,128247,14,128254,128254,14,128264,128264,14,128278,128299,14,128329,128330,14,128348,128359,14,128371,128377,14,128392,128393,14,128401,128404,14,128421,128421,14,128433,128434,14,128450,128452,14,128476,128478,14,128483,128483,14,128495,128495,14,128506,128506,14,128519,128520,14,128528,128528,14,128534,128534,14,128538,128538,14,128540,128542,14,128544,128549,14,128552,128555,14,128557,128557,14,128560,128563,14,128565,128565,14,128567,128576,14,128581,128591,14,128641,128642,14,128646,128646,14,128648,128648,14,128650,128651,14,128653,128653,14,128655,128655,14,128657,128659,14,128661,128661,14,128663,128663,14,128665,128666,14,128674,128674,14,128676,128677,14,128679,128685,14,128690,128690,14,128694,128694,14,128697,128702,14,128704,128704,14,128710,128714,14,128716,128716,14,128720,128720,14,128723,128724,14,128726,128727,14,128733,128735,14,128742,128744,14,128746,128746,14,128749,128751,14,128753,128754,14,128756,128758,14,128761,128761,14,128763,128764,14,128884,128895,14,128992,129003,14,129008,129008,14,129036,129039,14,129114,129119,14,129198,129279,14,129293,129295,14,129305,129310,14,129312,129319,14,129328,129328,14,129331,129338,14,129343,129343,14,129351,129355,14,129357,129359,14,129375,129387,14,129393,129393,14,129395,129398,14,129401,129401,14,129403,129403,14,129408,129412,14,129426,129431,14,129443,129444,14,129451,129453,14,129456,129465,14,129472,129472,14,129475,129482,14,129484,129484,14,129488,129510,14,129536,129647,14,129652,129652,14,129656,129658,14,129661,129663,14,129667,129670,14,129680,129685,14,129705,129708,14,129712,129718,14,129723,129727,14,129731,129733,14,129744,129750,14,129754,129759,14,129768,129775,14,129783,129791,14,917504,917504,4,917506,917535,4,917632,917759,4,918000,921599,4,0,9,4,11,12,4,14,31,4,169,169,14,174,174,14,1155,1159,5,1425,1469,5,1473,1474,5,1479,1479,5,1552,1562,5,1611,1631,5,1750,1756,5,1759,1764,5,1770,1773,5,1809,1809,5,1958,1968,5,2045,2045,5,2075,2083,5,2089,2093,5,2192,2193,1,2250,2273,5,2275,2306,5,2362,2362,5,2364,2364,5,2369,2376,5,2381,2381,5,2385,2391,5,2433,2433,5,2492,2492,5,2495,2496,7,2503,2504,7,2509,2509,5,2530,2531,5,2561,2562,5,2620,2620,5,2625,2626,5,2635,2637,5,2672,2673,5,2689,2690,5,2748,2748,5,2753,2757,5,2761,2761,7,2765,2765,5,2810,2815,5,2818,2819,7,2878,2878,5,2880,2880,7,2887,2888,7,2893,2893,5,2903,2903,5,2946,2946,5,3007,3007,7,3009,3010,7,3018,3020,7,3031,3031,5,3073,3075,7,3132,3132,5,3137,3140,7,3146,3149,5,3170,3171,5,3202,3203,7,3262,3262,7,3264,3265,7,3267,3268,7,3271,3272,7,3276,3277,5,3298,3299,5,3330,3331,7,3390,3390,5,3393,3396,5,3402,3404,7,3406,3406,1,3426,3427,5,3458,3459,7,3535,3535,5,3538,3540,5,3544,3550,7,3570,3571,7,3635,3635,7,3655,3662,5,3763,3763,7,3784,3789,5,3893,3893,5,3897,3897,5,3953,3966,5,3968,3972,5,3981,3991,5,4038,4038,5,4145,4145,7,4153,4154,5,4157,4158,5,4184,4185,5,4209,4212,5,4228,4228,7,4237,4237,5,4352,4447,8,4520,4607,10,5906,5908,5,5938,5939,5,5970,5971,5,6068,6069,5,6071,6077,5,6086,6086,5,6089,6099,5,6155,6157,5,6159,6159,5,6313,6313,5,6435,6438,7,6441,6443,7,6450,6450,5,6457,6459,5,6681,6682,7,6741,6741,7,6743,6743,7,6752,6752,5,6757,6764,5,6771,6780,5,6832,6845,5,6847,6862,5,6916,6916,7,6965,6965,5,6971,6971,7,6973,6977,7,6979,6980,7,7040,7041,5,7073,7073,7,7078,7079,7,7082,7082,7,7142,7142,5,7144,7145,5,7149,7149,5,7151,7153,5,7204,7211,7,7220,7221,7,7376,7378,5,7393,7393,7,7405,7405,5,7415,7415,7,7616,7679,5,8204,8204,5,8206,8207,4,8233,8233,4,8252,8252,14,8288,8292,4,8294,8303,4,8413,8416,5,8418,8420,5,8482,8482,14,8596,8601,14,8986,8987,14,9096,9096,14,9193,9196,14,9199,9199,14,9201,9202,14,9208,9210,14,9642,9643,14,9664,9664,14,9728,9729,14,9732,9732,14,9735,9741,14,9743,9744,14,9746,9746,14,9750,9751,14,9753,9756,14,9758,9759,14,9761,9761,14,9764,9765,14,9767,9769,14,9771,9773,14,9775,9775,14,9784,9785,14,9787,9791,14,9793,9793,14,9795,9799,14,9812,9822,14,9824,9824,14,9827,9827,14,9829,9830,14,9832,9832,14,9851,9851,14,9854,9854,14,9856,9861,14,9874,9874,14,9876,9876,14,9878,9879,14,9881,9881,14,9883,9884,14,9888,9889,14,9895,9895,14,9898,9899,14,9904,9905,14,9917,9918,14,9924,9925,14,9928,9928,14,9934,9934,14,9936,9936,14,9938,9938,14,9940,9940,14,9961,9961,14,9963,9967,14,9970,9971,14,9973,9973,14,9975,9977,14,9979,9980,14,9982,9985,14,9987,9988,14,9992,9996,14,9998,9998,14,10000,10001,14,10004,10004,14,10013,10013,14,10024,10024,14,10052,10052,14,10060,10060,14,10067,10069,14,10083,10083,14,10085,10087,14,10145,10145,14,10175,10175,14,11013,11015,14,11088,11088,14,11503,11505,5,11744,11775,5,12334,12335,5,12349,12349,14,12951,12951,14,42607,42607,5,42612,42621,5,42736,42737,5,43014,43014,5,43043,43044,7,43047,43047,7,43136,43137,7,43204,43205,5,43263,43263,5,43335,43345,5,43360,43388,8,43395,43395,7,43444,43445,7,43450,43451,7,43454,43456,7,43561,43566,5,43569,43570,5,43573,43574,5,43596,43596,5,43644,43644,5,43698,43700,5,43710,43711,5,43755,43755,7,43758,43759,7,43766,43766,5,44005,44005,5,44008,44008,5,44012,44012,7,44032,44032,11,44060,44060,11,44088,44088,11,44116,44116,11,44144,44144,11,44172,44172,11,44200,44200,11,44228,44228,11,44256,44256,11,44284,44284,11,44312,44312,11,44340,44340,11,44368,44368,11,44396,44396,11,44424,44424,11,44452,44452,11,44480,44480,11,44508,44508,11,44536,44536,11,44564,44564,11,44592,44592,11,44620,44620,11,44648,44648,11,44676,44676,11,44704,44704,11,44732,44732,11,44760,44760,11,44788,44788,11,44816,44816,11,44844,44844,11,44872,44872,11,44900,44900,11,44928,44928,11,44956,44956,11,44984,44984,11,45012,45012,11,45040,45040,11,45068,45068,11,45096,45096,11,45124,45124,11,45152,45152,11,45180,45180,11,45208,45208,11,45236,45236,11,45264,45264,11,45292,45292,11,45320,45320,11,45348,45348,11,45376,45376,11,45404,45404,11,45432,45432,11,45460,45460,11,45488,45488,11,45516,45516,11,45544,45544,11,45572,45572,11,45600,45600,11,45628,45628,11,45656,45656,11,45684,45684,11,45712,45712,11,45740,45740,11,45768,45768,11,45796,45796,11,45824,45824,11,45852,45852,11,45880,45880,11,45908,45908,11,45936,45936,11,45964,45964,11,45992,45992,11,46020,46020,11,46048,46048,11,46076,46076,11,46104,46104,11,46132,46132,11,46160,46160,11,46188,46188,11,46216,46216,11,46244,46244,11,46272,46272,11,46300,46300,11,46328,46328,11,46356,46356,11,46384,46384,11,46412,46412,11,46440,46440,11,46468,46468,11,46496,46496,11,46524,46524,11,46552,46552,11,46580,46580,11,46608,46608,11,46636,46636,11,46664,46664,11,46692,46692,11,46720,46720,11,46748,46748,11,46776,46776,11,46804,46804,11,46832,46832,11,46860,46860,11,46888,46888,11,46916,46916,11,46944,46944,11,46972,46972,11,47000,47000,11,47028,47028,11,47056,47056,11,47084,47084,11,47112,47112,11,47140,47140,11,47168,47168,11,47196,47196,11,47224,47224,11,47252,47252,11,47280,47280,11,47308,47308,11,47336,47336,11,47364,47364,11,47392,47392,11,47420,47420,11,47448,47448,11,47476,47476,11,47504,47504,11,47532,47532,11,47560,47560,11,47588,47588,11,47616,47616,11,47644,47644,11,47672,47672,11,47700,47700,11,47728,47728,11,47756,47756,11,47784,47784,11,47812,47812,11,47840,47840,11,47868,47868,11,47896,47896,11,47924,47924,11,47952,47952,11,47980,47980,11,48008,48008,11,48036,48036,11,48064,48064,11,48092,48092,11,48120,48120,11,48148,48148,11,48176,48176,11,48204,48204,11,48232,48232,11,48260,48260,11,48288,48288,11,48316,48316,11,48344,48344,11,48372,48372,11,48400,48400,11,48428,48428,11,48456,48456,11,48484,48484,11,48512,48512,11,48540,48540,11,48568,48568,11,48596,48596,11,48624,48624,11,48652,48652,11,48680,48680,11,48708,48708,11,48736,48736,11,48764,48764,11,48792,48792,11,48820,48820,11,48848,48848,11,48876,48876,11,48904,48904,11,48932,48932,11,48960,48960,11,48988,48988,11,49016,49016,11,49044,49044,11,49072,49072,11,49100,49100,11,49128,49128,11,49156,49156,11,49184,49184,11,49212,49212,11,49240,49240,11,49268,49268,11,49296,49296,11,49324,49324,11,49352,49352,11,49380,49380,11,49408,49408,11,49436,49436,11,49464,49464,11,49492,49492,11,49520,49520,11,49548,49548,11,49576,49576,11,49604,49604,11,49632,49632,11,49660,49660,11,49688,49688,11,49716,49716,11,49744,49744,11,49772,49772,11,49800,49800,11,49828,49828,11,49856,49856,11,49884,49884,11,49912,49912,11,49940,49940,11,49968,49968,11,49996,49996,11,50024,50024,11,50052,50052,11,50080,50080,11,50108,50108,11,50136,50136,11,50164,50164,11,50192,50192,11,50220,50220,11,50248,50248,11,50276,50276,11,50304,50304,11,50332,50332,11,50360,50360,11,50388,50388,11,50416,50416,11,50444,50444,11,50472,50472,11,50500,50500,11,50528,50528,11,50556,50556,11,50584,50584,11,50612,50612,11,50640,50640,11,50668,50668,11,50696,50696,11,50724,50724,11,50752,50752,11,50780,50780,11,50808,50808,11,50836,50836,11,50864,50864,11,50892,50892,11,50920,50920,11,50948,50948,11,50976,50976,11,51004,51004,11,51032,51032,11,51060,51060,11,51088,51088,11,51116,51116,11,51144,51144,11,51172,51172,11,51200,51200,11,51228,51228,11,51256,51256,11,51284,51284,11,51312,51312,11,51340,51340,11,51368,51368,11,51396,51396,11,51424,51424,11,51452,51452,11,51480,51480,11,51508,51508,11,51536,51536,11,51564,51564,11,51592,51592,11,51620,51620,11,51648,51648,11,51676,51676,11,51704,51704,11,51732,51732,11,51760,51760,11,51788,51788,11,51816,51816,11,51844,51844,11,51872,51872,11,51900,51900,11,51928,51928,11,51956,51956,11,51984,51984,11,52012,52012,11,52040,52040,11,52068,52068,11,52096,52096,11,52124,52124,11,52152,52152,11,52180,52180,11,52208,52208,11,52236,52236,11,52264,52264,11,52292,52292,11,52320,52320,11,52348,52348,11,52376,52376,11,52404,52404,11,52432,52432,11,52460,52460,11,52488,52488,11,52516,52516,11,52544,52544,11,52572,52572,11,52600,52600,11,52628,52628,11,52656,52656,11,52684,52684,11,52712,52712,11,52740,52740,11,52768,52768,11,52796,52796,11,52824,52824,11,52852,52852,11,52880,52880,11,52908,52908,11,52936,52936,11,52964,52964,11,52992,52992,11,53020,53020,11,53048,53048,11,53076,53076,11,53104,53104,11,53132,53132,11,53160,53160,11,53188,53188,11,53216,53216,11,53244,53244,11,53272,53272,11,53300,53300,11,53328,53328,11,53356,53356,11,53384,53384,11,53412,53412,11,53440,53440,11,53468,53468,11,53496,53496,11,53524,53524,11,53552,53552,11,53580,53580,11,53608,53608,11,53636,53636,11,53664,53664,11,53692,53692,11,53720,53720,11,53748,53748,11,53776,53776,11,53804,53804,11,53832,53832,11,53860,53860,11,53888,53888,11,53916,53916,11,53944,53944,11,53972,53972,11,54000,54000,11,54028,54028,11,54056,54056,11,54084,54084,11,54112,54112,11,54140,54140,11,54168,54168,11,54196,54196,11,54224,54224,11,54252,54252,11,54280,54280,11,54308,54308,11,54336,54336,11,54364,54364,11,54392,54392,11,54420,54420,11,54448,54448,11,54476,54476,11,54504,54504,11,54532,54532,11,54560,54560,11,54588,54588,11,54616,54616,11,54644,54644,11,54672,54672,11,54700,54700,11,54728,54728,11,54756,54756,11,54784,54784,11,54812,54812,11,54840,54840,11,54868,54868,11,54896,54896,11,54924,54924,11,54952,54952,11,54980,54980,11,55008,55008,11,55036,55036,11,55064,55064,11,55092,55092,11,55120,55120,11,55148,55148,11,55176,55176,11,55216,55238,9,64286,64286,5,65056,65071,5,65438,65439,5,65529,65531,4,66272,66272,5,68097,68099,5,68108,68111,5,68159,68159,5,68900,68903,5,69446,69456,5,69632,69632,7,69634,69634,7,69744,69744,5,69759,69761,5,69808,69810,7,69815,69816,7,69821,69821,1,69837,69837,1,69927,69931,5,69933,69940,5,70003,70003,5,70018,70018,7,70070,70078,5,70082,70083,1,70094,70094,7,70188,70190,7,70194,70195,7,70197,70197,7,70206,70206,5,70368,70370,7,70400,70401,5,70459,70460,5,70463,70463,7,70465,70468,7,70475,70477,7,70498,70499,7,70512,70516,5,70712,70719,5,70722,70724,5,70726,70726,5,70832,70832,5,70835,70840,5,70842,70842,5,70845,70845,5,70847,70848,5,70850,70851,5,71088,71089,7,71096,71099,7,71102,71102,7,71132,71133,5,71219,71226,5,71229,71229,5,71231,71232,5,71340,71340,7,71342,71343,7,71350,71350,7,71453,71455,5,71462,71462,7,71724,71726,7,71736,71736,7,71984,71984,5,71991,71992,7,71997,71997,7,71999,71999,1,72001,72001,1,72003,72003,5,72148,72151,5,72156,72159,7,72164,72164,7,72243,72248,5,72250,72250,1,72263,72263,5,72279,72280,7,72324,72329,1,72343,72343,7,72751,72751,7,72760,72765,5,72767,72767,5,72873,72873,7,72881,72881,7,72884,72884,7,73009,73014,5,73020,73021,5,73030,73030,1,73098,73102,7,73107,73108,7,73110,73110,7,73459,73460,5,78896,78904,4,92976,92982,5,94033,94087,7,94180,94180,5,113821,113822,5,118528,118573,5,119141,119141,5,119143,119145,5,119150,119154,5,119163,119170,5,119210,119213,5,121344,121398,5,121461,121461,5,121499,121503,5,122880,122886,5,122907,122913,5,122918,122922,5,123566,123566,5,125136,125142,5,126976,126979,14,126981,127182,14,127184,127231,14,127279,127279,14,127344,127345,14,127374,127374,14,127405,127461,14,127489,127490,14,127514,127514,14,127538,127546,14,127561,127567,14,127570,127743,14,127757,127758,14,127760,127760,14,127762,127762,14,127766,127768,14,127770,127770,14,127772,127772,14,127775,127776,14,127778,127779,14,127789,127791,14,127794,127795,14,127798,127798,14,127819,127819,14,127824,127824,14,127868,127868,14,127870,127871,14,127892,127893,14,127896,127896,14,127900,127901,14,127904,127940,14,127942,127942,14,127944,127944,14,127946,127946,14,127951,127955,14,127968,127971,14,127973,127984,14,127987,127987,14,127989,127989,14,127991,127991,14,127995,127999,5,128008,128008,14,128012,128014,14,128017,128018,14,128020,128020,14,128022,128022,14,128042,128042,14,128063,128063,14,128065,128065,14,128101,128101,14,128108,128109,14,128173,128173,14,128182,128183,14,128236,128237,14,128239,128239,14,128245,128245,14,128248,128248,14,128253,128253,14,128255,128258,14,128260,128263,14,128265,128265,14,128277,128277,14,128300,128301,14,128326,128328,14,128331,128334,14,128336,128347,14,128360,128366,14,128369,128370,14,128378,128378,14,128391,128391,14,128394,128397,14,128400,128400,14,128405,128406,14,128420,128420,14,128422,128423,14,128425,128432,14,128435,128443,14,128445,128449,14,128453,128464,14,128468,128475,14,128479,128480,14,128482,128482,14,128484,128487,14,128489,128494,14,128496,128498,14,128500,128505,14,128507,128511,14,128513,128518,14,128521,128525,14,128527,128527,14,128529,128529,14,128533,128533,14,128535,128535,14,128537,128537,14]")}var Yx;(function(e){e[e.zwj=8205]="zwj",e[e.emojiVariantSelector=65039]="emojiVariantSelector",e[e.enclosingKeyCap=8419]="enclosingKeyCap",e[e.space=32]="space"})(Yx||(Yx={}));var wK=class Hd{static{this.ambiguousCharacterData=new Si(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,1523,96,8242,96,1370,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,118002,50,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,118003,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,118004,52,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,118005,53,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,118006,54,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,118007,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,118008,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,118009,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,117974,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,117975,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71913,67,71922,67,65315,67,8557,67,8450,67,8493,67,117976,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,117977,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,117978,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,117979,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,117980,71,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,117981,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,117983,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,117984,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,118001,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,117982,108,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,117985,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,117986,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,117987,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,118000,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,117988,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,117989,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,117990,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,117991,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,117992,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,117993,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,117994,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,117995,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71910,87,71919,87,117996,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,117997,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,117998,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,71909,90,66293,90,65338,90,8484,90,8488,90,117999,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65283,35,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125,119846,109],"_default":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"cs":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"es":[8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"fr":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"it":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"ja":[8211,45,8218,44,65281,33,8216,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65292,44,65297,49,65307,59],"ko":[8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"pt-BR":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"ru":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"zh-hans":[160,32,65374,126,8218,44,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65297,49],"zh-hant":[8211,45,65374,126,8218,44,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89]}'))}static{this.cache=new VL({getCacheKey:JSON.stringify},t=>{function i(u){const d=new Map;for(let f=0;f<u.length;f+=2)d.set(u[f],u[f+1]);return d}function r(u,d){const f=new Map(u);for(const[p,g]of d)f.set(p,g);return f}function s(u,d){if(!u)return d;const f=new Map;for(const[p,g]of u)d.has(p)&&f.set(p,g);return f}const n=this.ambiguousCharacterData.value;let o=t.filter(u=>!u.startsWith("_")&&u in n);o.length===0&&(o=["_default"]);let a;for(const u of o){const d=i(n[u]);a=s(a,d)}const l=i(n._common),c=r(l,a);return new Hd(c)})}static getInstance(t){return Hd.cache.get(Array.from(t))}static{this._locales=new Si(()=>Object.keys(Hd.ambiguousCharacterData.value).filter(t=>!t.startsWith("_")))}static getLocales(){return Hd._locales.value}constructor(t){this.confusableDictionary=t}isAmbiguous(t){return this.confusableDictionary.has(t)}containsAmbiguousCharacter(t){for(let i=0;i<t.length;i++){const r=t.codePointAt(i);if(typeof r=="number"&&this.isAmbiguous(r))return!0}return!1}getPrimaryConfusable(t){return this.confusableDictionary.get(t)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}},yK=class Ud{static getRawData(){return JSON.parse('{"_common":[11,12,13,127,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999],"cs":[173,8203,12288],"de":[173,8203,12288],"es":[8203,12288],"fr":[173,8203,12288],"it":[160,173,12288],"ja":[173],"ko":[173,12288],"pl":[173,8203,12288],"pt-BR":[173,8203,12288],"qps-ploc":[160,173,8203,12288],"ru":[173,12288],"tr":[160,173,8203,12288],"zh-hans":[160,173,8203,12288],"zh-hant":[173,12288]}')}static{this._data=void 0}static getData(){return this._data||(this._data=new Set([...Object.values(Ud.getRawData())].flat())),this._data}static isInvisibleCharacter(t){return Ud.getData().has(t)}static containsInvisibleCharacter(t){for(let i=0;i<t.length;i++){const r=t.codePointAt(i);if(typeof r=="number"&&(Ud.isInvisibleCharacter(r)||r===32))return!0}return!1}static get codePoints(){return Ud.getData()}};function _n(e){return e===47||e===92}function Zx(e){return e.replace(/[\\/]/g,$e.sep)}function h3(e){return e.indexOf("/")===-1&&(e=Zx(e)),/^[a-zA-Z]:(\/|$)/.test(e)&&(e="/"+e),e}function Av(e,t=$e.sep){if(!e)return"";const i=e.length,r=e.charCodeAt(0);if(_n(r)){if(_n(e.charCodeAt(1))&&!_n(e.charCodeAt(2))){let n=3;const o=n;for(;n<i&&!_n(e.charCodeAt(n));n++);if(o!==n&&!_n(e.charCodeAt(n+1))){for(n+=1;n<i;n++)if(_n(e.charCodeAt(n)))return e.slice(0,n+1).replace(/[\\/]/g,t)}}return t}else if(eE(r)&&e.charCodeAt(1)===58)return _n(e.charCodeAt(2))?e.slice(0,2)+t:e.slice(0,2);let s=e.indexOf("://");if(s!==-1){for(s+=3;s<i;s++)if(_n(e.charCodeAt(s)))return e.slice(0,s+1)}return""}var f3=/[\\/:\*\?"<>\|]/g,p3=/[/]/g,g3=/^(con|prn|aux|clock\$|nul|lpt[0-9]|com[0-9])(\.(.*?))?$/i;function m3(e,t=Ve){const i=t?f3:p3;return!(!e||e.length===0||/^\s+$/.test(e)||(i.lastIndex=0,i.test(e))||t&&g3.test(e)||e==="."||e===".."||t&&e[e.length-1]==="."||t&&e.length!==e.trim().length||e.length>255)}function gh(e,t,i){const r=e===t;return!i||r?r:!e||!t?!1:kr(e,t)}function ao(e,t,i,r=St){if(e===t)return!0;if(!e||!t||t.length>e.length)return!1;if(i){if(!hh(e,t))return!1;if(t.length===e.length)return!0;let n=t.length;return t.charAt(t.length-1)===r&&n--,e.charAt(n)===r}return t.charAt(t.length-1)!==r&&(t+=r),e.indexOf(t)===0}function eE(e){return e>=65&&e<=90||e>=97&&e<=122}function v3(e){return Ve?(e=vn(e,St),e.endsWith(":")&&(e+=St)):(e=vn(e,St),e||(e=St)),e}function tE(e){const t=Cs(e);return Ve?e.length>3?!1:Rv(t)&&(e.length===2||t.charCodeAt(2)===92):t===$e.sep}function Rv(e,t=Ve){return t?eE(e.charCodeAt(0))&&e.charCodeAt(1)===58:!1}function iE(e,t=Ve){return Rv(e,t)?e[0]:void 0}var _3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",w3="BDEFGHIJKMOQRSTUVWXYZbdefghijkmoqrstuvwxyz0123456789";function y3(e,t,i=8){let r="";for(let n=0;n<i;n++){let o;n===0&&Ve&&!t&&(i===3||i===4)?o=w3:o=_3,r+=o.charAt(Math.floor(Math.random()*o.length))}let s;return t?s=`${t}-${r}`:s=r,e?Xe(e,s):s}var b3=/^\w[\w\d+.-]*$/,S3=/^\//,x3=/^\/\//;function E3(e,t){if(!e.scheme&&t)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${e.authority}", path: "${e.path}", query: "${e.query}", fragment: "${e.fragment}"}`);if(e.scheme&&!b3.test(e.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(e.path){if(e.authority){if(!S3.test(e.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(x3.test(e.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}function C3(e,t){return!e&&!t?"file":e}function D3(e,t){switch(e){case"https":case"http":case"file":t?t[0]!==Ir&&(t=Ir+t):t=Ir;break}return t}var _t="",Ir="/",k3=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,b=class Bm{static isUri(t){return t instanceof Bm?!0:t?typeof t.authority=="string"&&typeof t.fragment=="string"&&typeof t.path=="string"&&typeof t.query=="string"&&typeof t.scheme=="string"&&typeof t.fsPath=="string"&&typeof t.with=="function"&&typeof t.toString=="function":!1}constructor(t,i,r,s,n,o=!1){typeof t=="object"?(this.scheme=t.scheme||_t,this.authority=t.authority||_t,this.path=t.path||_t,this.query=t.query||_t,this.fragment=t.fragment||_t):(this.scheme=C3(t,o),this.authority=i||_t,this.path=D3(this.scheme,r||_t),this.query=s||_t,this.fragment=n||_t,E3(this,o))}get fsPath(){return vh(this,!1)}with(t){if(!t)return this;let{scheme:i,authority:r,path:s,query:n,fragment:o}=t;return i===void 0?i=this.scheme:i===null&&(i=_t),r===void 0?r=this.authority:r===null&&(r=_t),s===void 0?s=this.path:s===null&&(s=_t),n===void 0?n=this.query:n===null&&(n=_t),o===void 0?o=this.fragment:o===null&&(o=_t),i===this.scheme&&r===this.authority&&s===this.path&&n===this.query&&o===this.fragment?this:new ka(i,r,s,n,o)}static parse(t,i=!1){const r=k3.exec(t);return r?new ka(r[2]||_t,_h(r[4]||_t),_h(r[5]||_t),_h(r[7]||_t),_h(r[9]||_t),i):new ka(_t,_t,_t,_t,_t)}static file(t){let i=_t;if(Ve&&(t=t.replace(/\\/g,Ir)),t[0]===Ir&&t[1]===Ir){const r=t.indexOf(Ir,2);r===-1?(i=t.substring(2),t=Ir):(i=t.substring(2,r),t=t.substring(r)||Ir)}return new ka("file",i,t,_t,_t)}static from(t,i){return new ka(t.scheme,t.authority,t.path,t.query,t.fragment,i)}static joinPath(t,...i){if(!t.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let r;return Ve&&t.scheme==="file"?r=Bm.file(Ht.join(vh(t,!0),...i)).path:r=$e.join(t.path,...i),t.with({path:r})}toString(t=!1){return Lv(this,t)}toJSON(){return this}static revive(t){if(t){if(t instanceof Bm)return t;{const i=new ka(t);return i._formatted=t.external??null,i._fsPath=t._sep===rE?t.fsPath??null:null,i}}else return t}[Symbol.for("debug.description")](){return`URI(${this.toString()})`}};function mh(e){return!e||typeof e!="object"?!1:typeof e.scheme=="string"&&(typeof e.authority=="string"||typeof e.authority>"u")&&(typeof e.path=="string"||typeof e.path>"u")&&(typeof e.query=="string"||typeof e.query>"u")&&(typeof e.fragment=="string"||typeof e.fragment>"u")}var rE=Ve?1:void 0,ka=class extends b{constructor(){super(...arguments),this._formatted=null,this._fsPath=null}get fsPath(){return this._fsPath||(this._fsPath=vh(this,!1)),this._fsPath}toString(e=!1){return e?Lv(this,!0):(this._formatted||(this._formatted=Lv(this,!1)),this._formatted)}toJSON(){const e={$mid:1};return this._fsPath&&(e.fsPath=this._fsPath,e._sep=rE),this._formatted&&(e.external=this._formatted),this.path&&(e.path=this.path),this.scheme&&(e.scheme=this.scheme),this.authority&&(e.authority=this.authority),this.query&&(e.query=this.query),this.fragment&&(e.fragment=this.fragment),e}},sE={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function nE(e,t,i){let r,s=-1;for(let n=0;n<e.length;n++){const o=e.charCodeAt(n);if(o>=97&&o<=122||o>=65&&o<=90||o>=48&&o<=57||o===45||o===46||o===95||o===126||t&&o===47||i&&o===91||i&&o===93||i&&o===58)s!==-1&&(r+=encodeURIComponent(e.substring(s,n)),s=-1),r!==void 0&&(r+=e.charAt(n));else{r===void 0&&(r=e.substr(0,n));const a=sE[o];a!==void 0?(s!==-1&&(r+=encodeURIComponent(e.substring(s,n)),s=-1),r+=a):s===-1&&(s=n)}}return s!==-1&&(r+=encodeURIComponent(e.substring(s))),r!==void 0?r:e}function I3(e){let t;for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);r===35||r===63?(t===void 0&&(t=e.substr(0,i)),t+=sE[r]):t!==void 0&&(t+=e[i])}return t!==void 0?t:e}function vh(e,t){let i;return e.authority&&e.path.length>1&&e.scheme==="file"?i=`//${e.authority}${e.path}`:e.path.charCodeAt(0)===47&&(e.path.charCodeAt(1)>=65&&e.path.charCodeAt(1)<=90||e.path.charCodeAt(1)>=97&&e.path.charCodeAt(1)<=122)&&e.path.charCodeAt(2)===58?t?i=e.path.substr(1):i=e.path[1].toLowerCase()+e.path.substr(2):i=e.path,Ve&&(i=i.replace(/\//g,"\\")),i}function Lv(e,t){const i=t?I3:nE;let r="",{scheme:s,authority:n,path:o,query:a,fragment:l}=e;if(s&&(r+=s,r+=":"),(n||s==="file")&&(r+=Ir,r+=Ir),n){let c=n.indexOf("@");if(c!==-1){const u=n.substr(0,c);n=n.substr(c+1),c=u.lastIndexOf(":"),c===-1?r+=i(u,!1,!1):(r+=i(u.substr(0,c),!1,!1),r+=":",r+=i(u.substr(c+1),!1,!0)),r+="@"}n=n.toLowerCase(),c=n.lastIndexOf(":"),c===-1?r+=i(n,!1,!0):(r+=i(n.substr(0,c),!1,!0),r+=n.substr(c))}if(o){if(o.length>=3&&o.charCodeAt(0)===47&&o.charCodeAt(2)===58){const c=o.charCodeAt(1);c>=65&&c<=90&&(o=`/${String.fromCharCode(c+32)}:${o.substr(3)}`)}else if(o.length>=2&&o.charCodeAt(1)===58){const c=o.charCodeAt(0);c>=65&&c<=90&&(o=`${String.fromCharCode(c+32)}:${o.substr(2)}`)}r+=i(o,!0,!1)}return a&&(r+="?",r+=i(a,!1,!1)),l&&(r+="#",r+=t?l:nE(l,!1,!1)),r}function oE(e){try{return decodeURIComponent(e)}catch{return e.length>3?e.substr(0,3)+oE(e.substr(3)):e}}var aE=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function _h(e){return e.match(aE)?e.replace(aE,t=>oE(t)):e}var V;(function(e){e.inMemory="inmemory",e.vscode="vscode",e.internal="private",e.walkThrough="walkThrough",e.walkThroughSnippet="walkThroughSnippet",e.http="http",e.https="https",e.file="file",e.mailto="mailto",e.untitled="untitled",e.data="data",e.command="command",e.vscodeRemote="vscode-remote",e.vscodeRemoteResource="vscode-remote-resource",e.vscodeManagedRemoteResource="vscode-managed-remote-resource",e.vscodeUserData="vscode-userdata",e.vscodeCustomEditor="vscode-custom-editor",e.vscodeNotebookCell="vscode-notebook-cell",e.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",e.vscodeNotebookCellMetadataDiff="vscode-notebook-cell-metadata-diff",e.vscodeNotebookCellOutput="vscode-notebook-cell-output",e.vscodeNotebookCellOutputDiff="vscode-notebook-cell-output-diff",e.vscodeNotebookMetadata="vscode-notebook-metadata",e.vscodeInteractiveInput="vscode-interactive-input",e.vscodeSettings="vscode-settings",e.vscodeWorkspaceTrust="vscode-workspace-trust",e.vscodeTerminal="vscode-terminal",e.vscodeChatCodeBlock="vscode-chat-code-block",e.vscodeChatCodeCompareBlock="vscode-chat-code-compare-block",e.vscodeChatSesssion="vscode-chat-editor",e.webviewPanel="webview-panel",e.vscodeWebview="vscode-webview",e.extension="extension",e.vscodeFileResource="vscode-file",e.tmp="tmp",e.vsls="vsls",e.vscodeSourceControl="vscode-scm",e.commentsInput="comment",e.codeSetting="code-setting",e.outputChannel="output",e.accessibleView="accessible-view"})(V||(V={}));function Nv(e,t){return b.isUri(e)?kr(e.scheme,t):hh(e,t+":")}function P3(e,...t){return t.some(i=>Nv(e,i))}var T3="tkn",A3=class{constructor(){this._hosts=Object.create(null),this._ports=Object.create(null),this._connectionTokens=Object.create(null),this._preferredWebSchema="http",this._delegate=null,this._serverRootPath="/"}setPreferredWebSchema(e){this._preferredWebSchema=e}setDelegate(e){this._delegate=e}setServerRootPath(e,t){this._serverRootPath=$e.join(t??"/",R3(e))}getServerRootPath(){return this._serverRootPath}get _remoteResourcesPath(){return $e.join(this._serverRootPath,V.vscodeRemoteResource)}set(e,t,i){this._hosts[e]=t,this._ports[e]=i}setConnectionToken(e,t){this._connectionTokens[e]=t}getPreferredWebSchema(){return this._preferredWebSchema}rewrite(e){if(this._delegate)try{return this._delegate(e)}catch(o){return pt(o),e}const t=e.authority;let i=this._hosts[t];i&&i.indexOf(":")!==-1&&i.indexOf("[")===-1&&(i=`[${i}]`);const r=this._ports[t],s=this._connectionTokens[t];let n=`path=${encodeURIComponent(e.path)}`;return typeof s=="string"&&(n+=`&${T3}=${encodeURIComponent(s)}`),b.from({scheme:Ca?this._preferredWebSchema:V.vscodeRemoteResource,authority:`${i}:${r}`,path:this._remoteResourcesPath,query:n})}},lE=new A3;function R3(e){return`${e.quality??"oss"}-${e.commit??"dev"}`}var L3="vs/../../node_modules",N3="vs/../../node_modules.asar",cE="vscode-app",M3=class Vm{static{this.FALLBACK_AUTHORITY=cE}asBrowserUri(t){const i=this.toUri(t);return this.uriToBrowserUri(i)}uriToBrowserUri(t){return t.scheme===V.vscodeRemote?lE.rewrite(t):t.scheme===V.file&&(kx||CL===`${V.vscodeFileResource}://${Vm.FALLBACK_AUTHORITY}`)?t.with({scheme:V.vscodeFileResource,authority:t.authority||Vm.FALLBACK_AUTHORITY,query:null,fragment:null}):t}asFileUri(t){const i=this.toUri(t);return this.uriToFileUri(i)}uriToFileUri(t){return t.scheme===V.vscodeFileResource?t.with({scheme:V.file,authority:t.authority!==Vm.FALLBACK_AUTHORITY?t.authority:null,query:null,fragment:null}):t}toUri(t){if(b.isUri(t))return t;if(globalThis._VSCODE_FILE_ROOT){const i=globalThis._VSCODE_FILE_ROOT;if(/^\w[\w\d+.-]*:\/\//.test(i))return b.joinPath(b.parse(i,!0),t);const r=Xe(i,t);return b.file(r)}throw new Error("Cannot determine URI for module id!")}},Mv=new M3,bK=Object.freeze({"Cache-Control":"no-cache, no-store"}),SK=Object.freeze({"Document-Policy":"include-js-call-stacks-in-crash-reports"}),uE;(function(e){const t=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);e.CoopAndCoep=Object.freeze(t.get("3"));const i="vscode-coi";function r(n){let o;typeof n=="string"?o=new URL(n).searchParams:n instanceof URL?o=n.searchParams:b.isUri(n)&&(o=new URL(n.toString(!0)).searchParams);const a=o?.get(i);if(a)return t.get(a)}e.getHeadersFromQuery=r;function s(n,o,a){if(!globalThis.crossOriginIsolated)return;const l=o&&a?"3":a?"2":"1";n instanceof URLSearchParams?n.set(i,l):n[i]=l}e.addSearchParam=s})(uE||(uE={}));function Pr(e){return vh(e,!0)}var yc=class{constructor(e){this._ignorePathCasing=e}compare(e,t,i=!1){return e===t?0:oo(this.getComparisonKey(e,i),this.getComparisonKey(t,i))}isEqual(e,t,i=!1){return e===t?!0:!e||!t?!1:this.getComparisonKey(e,i)===this.getComparisonKey(t,i)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:t?null:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,t,i=!1){if(e.scheme===t.scheme){if(e.scheme===V.file)return ao(Pr(e),Pr(t),this._ignorePathCasing(e))&&e.query===t.query&&(i||e.fragment===t.fragment);if(fE(e.authority,t.authority))return ao(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(i||e.fragment===t.fragment)}return!1}joinPath(e,...t){return b.joinPath(e,...t)}basenameOrAuthority(e){return ir(e)||e.authority}basename(e){return $e.basename(e.path)}extname(e){return $e.extname(e.path)}dirname(e){if(e.path.length===0)return e;let t;return e.scheme===V.file?t=b.file(Bi(Pr(e))).path:(t=$e.dirname(e.path),e.authority&&t.length&&t.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return e.scheme===V.file?t=b.file(Cs(Pr(e))).path:t=$e.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!fE(e.authority,t.authority))return;if(e.scheme===V.file){const s=Da(Pr(e),Pr(t));return Ve?Zx(s):s}let i=e.path||"/";const r=t.path||"/";if(this._ignorePathCasing(e)){let s=0;for(const n=Math.min(i.length,r.length);s<n&&!(i.charCodeAt(s)!==r.charCodeAt(s)&&i.charAt(s).toLowerCase()!==r.charAt(s).toLowerCase());s++);i=r.substr(0,s)+i.substr(s)}return $e.relative(i,r)}resolvePath(e,t){if(e.scheme===V.file){const i=b.file(WL(Pr(e),t));return e.with({authority:i.authority,path:i.path})}return t=h3(t),e.with({path:$e.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,t){return e===t||e!==void 0&&t!==void 0&&kr(e,t)}hasTrailingPathSeparator(e,t=St){if(e.scheme===V.file){const i=Pr(e);return i.length>Av(i).length&&i[i.length-1]===t}else{const i=e.path;return i.length>1&&i.charCodeAt(i.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=St){return pE(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=St){let i=!1;if(e.scheme===V.file){const r=Pr(e);i=r!==void 0&&r.length===Av(r).length&&r[r.length-1]===t}else{t="/";const r=e.path;i=r.length===1&&r.charCodeAt(r.length-1)===47}return!i&&!pE(e,t)?e.with({path:e.path+"/"}):e}},Ge=new yc(()=>!1),Ov=new yc(e=>e.scheme===V.file?!Ct:!0),O3=new yc(e=>!0),lo=Ge.isEqual.bind(Ge),xK=Ge.isEqualOrParent.bind(Ge),EK=Ge.getComparisonKey.bind(Ge),Fv=Ge.basenameOrAuthority.bind(Ge),ir=Ge.basename.bind(Ge),dE=Ge.extname.bind(Ge),bc=Ge.dirname.bind(Ge),Dt=Ge.joinPath.bind(Ge),CK=Ge.normalizePath.bind(Ge),hE=Ge.relativePath.bind(Ge),DK=Ge.resolvePath.bind(Ge),F3=Ge.isAbsolutePath.bind(Ge),fE=Ge.isEqualAuthority.bind(Ge),pE=Ge.hasTrailingPathSeparator.bind(Ge),kK=Ge.removeTrailingPathSeparator.bind(Ge),IK=Ge.addTrailingPathSeparator.bind(Ge),gE;(function(e){e.META_DATA_LABEL="label",e.META_DATA_DESCRIPTION="description",e.META_DATA_SIZE="size",e.META_DATA_MIME="mime";function t(i){const r=new Map;i.path.substring(i.path.indexOf(";")+1,i.path.lastIndexOf(";")).split(";").forEach(o=>{const[a,l]=o.split(":");a&&l&&r.set(a,l)});const n=i.path.substring(0,i.path.indexOf(";"));return n&&r.set(e.META_DATA_MIME,n),r}e.parseMetaData=t})(gE||(gE={}));var $3=Symbol("MicrotaskDelay");function wn(e){return!!e&&typeof e.then=="function"}function Ds(e){const t=new rt,i=e(t.token);let r=!1;const s=new Promise((n,o)=>{const a=t.token.onCancellationRequested(()=>{r=!0,a.dispose(),o(new oi)});Promise.resolve(i).then(l=>{a.dispose(),t.dispose(),r?px(l)&&l.dispose():n(l)},l=>{a.dispose(),t.dispose(),o(l)})});return new class{cancel(){t.cancel(),t.dispose()}then(n,o){return s.then(n,o)}catch(n){return this.then(void 0,n)}finally(n){return s.finally(n)}}}function mE(e,t,i){return new Promise((r,s)=>{const n=t.onCancellationRequested(()=>{n.dispose(),r(i)});e.then(r,s).finally(()=>n.dispose())})}function wh(e,t){return new Promise((i,r)=>{const s=t.onCancellationRequested(()=>{s.dispose(),r(new oi)});e.then(i,r).finally(()=>s.dispose())})}function ci(e){return new Promise((t,i)=>{const r=e();wn(r)?r.then(t,i):t(r)})}function vE(){let e,t;return{promise:new Promise((r,s)=>{e=r,t=s}),resolve:e,reject:t}}var H3=class{constructor(){this.isDisposed=!1,this.activePromise=null,this.queuedPromise=null,this.queuedPromiseFactory=null}queue(e){if(this.isDisposed)return Promise.reject(new Error("Throttler is disposed"));if(this.activePromise){if(this.queuedPromiseFactory=e,!this.queuedPromise){const t=()=>{if(this.queuedPromise=null,this.isDisposed)return;const i=this.queue(this.queuedPromiseFactory);return this.queuedPromiseFactory=null,i};this.queuedPromise=new Promise(i=>{this.activePromise.then(t,t).then(i)})}return new Promise((t,i)=>{this.queuedPromise.then(t,i)})}return this.activePromise=e(),new Promise((t,i)=>{this.activePromise.then(r=>{this.activePromise=null,t(r)},r=>{this.activePromise=null,i(r)})})}dispose(){this.isDisposed=!0}},U3=class{constructor(){this.current=Promise.resolve(null)}queue(e){return this.current=this.current.then(()=>e(),()=>e())}},W3=(e,t)=>{let i=!0;const r=setTimeout(()=>{i=!1,t()},e);return{isTriggered:()=>i,dispose:()=>{clearTimeout(r),i=!1}}},B3=e=>{let t=!0;return queueMicrotask(()=>{t&&(t=!1,e())}),{isTriggered:()=>t,dispose:()=>{t=!1}}},_E=class{constructor(e){this.defaultDelay=e,this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}trigger(e,t=this.defaultDelay){this.task=e,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((r,s)=>{this.doResolve=r,this.doReject=s}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){const r=this.task;return this.task=null,r()}}));const i=()=>{this.deferred=null,this.doResolve?.(null)};return this.deferred=t===$3?B3(i):W3(t,i),this.completionPromise}isTriggered(){return!!this.deferred?.isTriggered()}cancel(){this.cancelTimeout(),this.completionPromise&&(this.doReject?.(new oi),this.completionPromise=null)}cancelTimeout(){this.deferred?.dispose(),this.deferred=null}dispose(){this.cancel()}},yh=class{constructor(e){this.delayer=new _E(e),this.throttler=new H3}trigger(e,t){return this.delayer.trigger(()=>this.throttler.queue(e),t)}isTriggered(){return this.delayer.isTriggered()}cancel(){this.delayer.cancel()}dispose(){this.delayer.dispose(),this.throttler.dispose()}},dr=class{constructor(){this._isOpen=!1,this._promise=new Promise((e,t)=>{this._completePromise=e})}isOpen(){return this._isOpen}open(){this._isOpen=!0,this._completePromise(!0)}wait(){return this._promise}};function ui(e,t){return t?new Promise((i,r)=>{const s=setTimeout(()=>{n.dispose(),i()},e),n=t.onCancellationRequested(()=>{clearTimeout(s),n.dispose(),r(new oi)})}):Ds(i=>ui(e,i))}function $v(e,t=0,i){const r=setTimeout(()=>{e(),i&&s.dispose()},t),s=ie(()=>{clearTimeout(r),i?.delete(s)});return i?.add(s),s}function V3(e,t=r=>!!r,i=null){if(e.length===0)return Promise.resolve(i);let r=e.length;const s=()=>{r=-1;for(const n of e)n.cancel?.()};return new Promise((n,o)=>{for(const a of e)a.then(l=>{--r>=0&&t(l)?(s(),n(l)):r===0&&n(i)}).catch(l=>{--r>=0&&(s(),o(l))})})}var z3=class{constructor(e){this._size=0,this._isDisposed=!1,this.maxDegreeOfParalellism=e,this.outstandingPromises=[],this.runningPromises=0,this._onDrained=new D}whenIdle(){return this.size>0?Fe.toPromise(this.onDrained):Promise.resolve()}get onDrained(){return this._onDrained.event}get size(){return this._size}queue(e){if(this._isDisposed)throw new Error("Object has been disposed");return this._size++,new Promise((t,i)=>{this.outstandingPromises.push({factory:e,c:t,e:i}),this.consume()})}consume(){for(;this.outstandingPromises.length&&this.runningPromises<this.maxDegreeOfParalellism;){const e=this.outstandingPromises.shift();this.runningPromises++;const t=e.factory();t.then(e.c,e.e),t.then(()=>this.consumed(),()=>this.consumed())}}consumed(){this._isDisposed||(this.runningPromises--,--this._size===0&&this._onDrained.fire(),this.outstandingPromises.length>0&&this.consume())}clear(){if(this._isDisposed)throw new Error("Object has been disposed");this.outstandingPromises.length=0,this._size=this.runningPromises}dispose(){this._isDisposed=!0,this.outstandingPromises.length=0,this._size=0,this._onDrained.dispose()}},q3=class extends z3{constructor(){super(1)}},wE=class{constructor(){this.queues=new Map,this.drainers=new Set,this.drainListeners=void 0,this.drainListenerCount=0}async whenDrained(){if(this.isDrained())return;const e=new hr;return this.drainers.add(e),e.p}isDrained(){for(const[,e]of this.queues)if(e.size>0)return!1;return!0}queueSize(e,t=Ge){const i=t.getComparisonKey(e);return this.queues.get(i)?.size??0}queueFor(e,t,i=Ge){const r=i.getComparisonKey(e);let s=this.queues.get(r);if(!s){s=new q3;const n=this.drainListenerCount++,o=Fe.once(s.onDrained)(()=>{s?.dispose(),this.queues.delete(r),this.onDidQueueDrain(),this.drainListeners?.deleteAndDispose(n),this.drainListeners?.size===0&&(this.drainListeners.dispose(),this.drainListeners=void 0)});this.drainListeners||(this.drainListeners=new fc),this.drainListeners.set(n,o),this.queues.set(r,s)}return s.queue(t)}onDidQueueDrain(){this.isDrained()&&this.releaseDrainers()}releaseDrainers(){for(const e of this.drainers)e.complete();this.drainers.clear()}dispose(){for(const[,e]of this.queues)e.dispose();this.queues.clear(),this.releaseDrainers(),this.drainListeners?.dispose()}},yE=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){this.disposable?.dispose(),this.disposable=void 0}cancelAndSet(e,t,i=globalThis){if(this.isDisposed)throw new Zi("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();const r=i.setInterval(()=>{e()},t);this.disposable=ie(()=>{i.clearInterval(r),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},ks=class{constructor(e,t){this.timeoutToken=-1,this.runner=e,this.timeout=t,this.timeoutHandler=this.onTimeout.bind(this)}dispose(){this.cancel(),this.runner=null}cancel(){this.isScheduled()&&(clearTimeout(this.timeoutToken),this.timeoutToken=-1)}schedule(e=this.timeout){this.cancel(),this.timeoutToken=setTimeout(this.timeoutHandler,e)}get delay(){return this.timeout}set delay(e){this.timeout=e}isScheduled(){return this.timeoutToken!==-1}flush(){this.isScheduled()&&(this.cancel(),this.doRun())}onTimeout(){this.timeoutToken=-1,this.runner&&this.doRun()}doRun(){this.runner?.()}},bE=class{constructor(e,t){t%1e3!==0&&console.warn(`ProcessTimeRunOnceScheduler resolution is 1s, ${t}ms is not a multiple of 1000ms.`),this.runner=e,this.timeout=t,this.counter=0,this.intervalToken=-1,this.intervalHandler=this.onInterval.bind(this)}dispose(){this.cancel(),this.runner=null}cancel(){this.isScheduled()&&(clearInterval(this.intervalToken),this.intervalToken=-1)}schedule(e=this.timeout){e%1e3!==0&&console.warn(`ProcessTimeRunOnceScheduler resolution is 1s, ${e}ms is not a multiple of 1000ms.`),this.cancel(),this.counter=Math.ceil(e/1e3),this.intervalToken=setInterval(this.intervalHandler,1e3)}isScheduled(){return this.intervalToken!==-1}onInterval(){this.counter--,!(this.counter>0)&&(clearInterval(this.intervalToken),this.intervalToken=-1,this.runner?.())}},j3=class extends ks{constructor(e,t){super(e,t),this.units=[]}work(e){this.units.push(e),this.isScheduled()||this.schedule()}doRun(){const e=this.units;this.units=[],this.runner?.(e)}dispose(){this.units=[],super.dispose()}},SE=class extends X{constructor(e,t){super(),this.options=e,this.handler=t,this.pendingWork=[],this.throttler=this._register(new Kr),this.disposed=!1,this.lastExecutionTime=0}get pending(){return this.pendingWork.length}work(e){if(this.disposed)return!1;if(typeof this.options.maxBufferedWork=="number"){if(this.throttler.value){if(this.pending+e.length>this.options.maxBufferedWork)return!1}else if(this.pending+e.length-this.options.maxWorkChunkSize>this.options.maxBufferedWork)return!1}for(const i of e)this.pendingWork.push(i);const t=Date.now()-this.lastExecutionTime;return!this.throttler.value&&(!this.options.waitThrottleDelayBetweenWorkUnits||t>=this.options.throttleDelay)?this.doWork():!this.throttler.value&&this.options.waitThrottleDelayBetweenWorkUnits&&this.scheduleThrottler(Math.max(this.options.throttleDelay-t,0)),!0}doWork(){this.lastExecutionTime=Date.now(),this.handler(this.pendingWork.splice(0,this.options.maxWorkChunkSize)),this.pendingWork.length>0&&this.scheduleThrottler()}scheduleThrottler(e=this.options.throttleDelay){this.throttler.value=new ks(()=>{this.throttler.clear(),this.doWork()},e),this.throttler.value.schedule()}dispose(){super.dispose(),this.pendingWork.length=0,this.disposed=!0}},xE,bh;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?bh=(e,t,i)=>{Px(()=>{if(r)return;const s=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,s-Date.now())}}))});let r=!1;return{dispose(){r||(r=!0)}}}:bh=(e,t,i)=>{const r=e.requestIdleCallback(t,typeof i=="number"?{timeout:i}:void 0);let s=!1;return{dispose(){s||(s=!0,e.cancelIdleCallback(r))}}},xE=(e,t)=>bh(globalThis,e,t)})();var G3=class{constructor(e,t){this._didRun=!1,this._executor=()=>{try{this._value=t()}catch(i){this._error=i}finally{this._didRun=!0}},this._handle=bh(e,()=>this._executor())}dispose(){this._handle.dispose()}get value(){if(this._didRun||(this._handle.dispose(),this._executor()),this._error)throw this._error;return this._value}get isInitialized(){return this._didRun}},Q3=class extends G3{constructor(e){super(globalThis,e)}};async function J3(e,t,i){let r;for(let s=0;s<i;s++)try{return await e()}catch(n){r=n,await ui(t)}throw r}var EE;(function(e){e[e.Resolved=0]="Resolved",e[e.Rejected=1]="Rejected"})(EE||(EE={}));var hr=class{get isRejected(){return this.outcome?.outcome===1}get isResolved(){return this.outcome?.outcome===0}get isSettled(){return!!this.outcome}get value(){return this.outcome?.outcome===0?this.outcome?.value:void 0}constructor(){this.p=new Promise((e,t)=>{this.completeCallback=e,this.errorCallback=t})}complete(e){return new Promise(t=>{this.completeCallback(e),this.outcome={outcome:0,value:e},t()})}error(e){return new Promise(t=>{this.errorCallback(e),this.outcome={outcome:1,value:e},t()})}cancel(){return this.error(new oi)}},yn;(function(e){async function t(r){let s;const n=await Promise.all(r.map(o=>o.then(a=>a,a=>{s||(s=a)})));if(typeof s<"u")throw s;return n}e.settled=t;function i(r){return new Promise(async(s,n)=>{try{await r(s,n)}catch(o){n(o)}})}e.withAsyncBody=i})(yn||(yn={}));var CE;(function(e){e[e.Initial=0]="Initial",e[e.DoneOK=1]="DoneOK",e[e.DoneError=2]="DoneError"})(CE||(CE={}));var Sc=class or{static fromArray(t){return new or(i=>{i.emitMany(t)})}static fromPromise(t){return new or(async i=>{i.emitMany(await t)})}static fromPromisesResolveOrder(t){return new or(async i=>{await Promise.all(t.map(async r=>i.emitOne(await r)))})}static merge(t){return new or(async i=>{await Promise.all(t.map(async r=>{for await(const s of r)i.emitOne(s)}))})}static{this.EMPTY=or.fromArray([])}constructor(t,i){this._state=0,this._results=[],this._error=null,this._onReturn=i,this._onStateChanged=new D,queueMicrotask(async()=>{const r={emitOne:s=>this.emitOne(s),emitMany:s=>this.emitMany(s),reject:s=>this.reject(s)};try{await Promise.resolve(t(r)),this.resolve()}catch(s){this.reject(s)}finally{r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await Fe.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,i){return new or(async r=>{for await(const s of t)r.emitOne(i(s))})}map(t){return or.map(this,t)}static filter(t,i){return new or(async r=>{for await(const s of t)i(s)&&r.emitOne(s)})}filter(t){return or.filter(this,t)}static coalesce(t){return or.filter(t,i=>!!i)}coalesce(){return or.coalesce(this)}static async toPromise(t){const i=[];for await(const r of t)i.push(r);return i}toPromise(){return or.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}},Hv=class{constructor(e){this._deferred=new hr,this._asyncIterable=new Sc(r=>{if(t){r.reject(t);return}return i&&r.emitMany(i),this._errorFn=s=>r.reject(s),this._emitFn=s=>r.emitOne(s),this._deferred.p},e);let t,i;this._emitFn=r=>{i||(i=[]),i.push(r)},this._errorFn=r=>{t||(t=r)}}get asyncIterable(){return this._asyncIterable}resolve(){this._deferred.complete()}reject(e){this._errorFn(e),this._deferred.complete()}emitOne(e){this._emitFn(e)}};function Sh(e,t){return new K3(e,t)}var K3=class{constructor(e,t){this.reducer=e,this.options=t,this.state={flowing:!1,ended:!1,destroyed:!1},this.buffer={data:[],error:[]},this.listeners={data:[],error:[],end:[]},this.pendingWritePromises=[]}pause(){this.state.destroyed||(this.state.flowing=!1)}resume(){this.state.destroyed||this.state.flowing||(this.state.flowing=!0,this.flowData(),this.flowErrors(),this.flowEnd())}write(e){if(!this.state.destroyed){if(this.state.flowing)this.emitData(e);else if(this.buffer.data.push(e),typeof this.options?.highWaterMark=="number"&&this.buffer.data.length>this.options.highWaterMark)return new Promise(t=>this.pendingWritePromises.push(t))}}error(e){this.state.destroyed||(this.state.flowing?this.emitError(e):this.buffer.error.push(e))}end(e){this.state.destroyed||(typeof e<"u"&&this.write(e),this.state.flowing?(this.emitEnd(),this.destroy()):this.state.ended=!0)}emitData(e){this.listeners.data.slice(0).forEach(t=>t(e))}emitError(e){this.listeners.error.length===0?pt(e):this.listeners.error.slice(0).forEach(t=>t(e))}emitEnd(){this.listeners.end.slice(0).forEach(e=>e())}on(e,t){if(!this.state.destroyed)switch(e){case"data":this.listeners.data.push(t),this.resume();break;case"end":this.listeners.end.push(t),this.state.flowing&&this.flowEnd()&&this.destroy();break;case"error":this.listeners.error.push(t),this.state.flowing&&this.flowErrors();break}}removeListener(e,t){if(this.state.destroyed)return;let i;switch(e){case"data":i=this.listeners.data;break;case"end":i=this.listeners.end;break;case"error":i=this.listeners.error;break}if(i){const r=i.indexOf(t);r>=0&&i.splice(r,1)}}flowData(){if(this.buffer.data.length===0)return;if(typeof this.reducer=="function"){const t=this.reducer(this.buffer.data);this.emitData(t)}else for(const t of this.buffer.data)this.emitData(t);this.buffer.data.length=0;const e=[...this.pendingWritePromises];this.pendingWritePromises.length=0,e.forEach(t=>t())}flowErrors(){if(this.listeners.error.length>0){for(const e of this.buffer.error)this.emitError(e);this.buffer.error.length=0}}flowEnd(){return this.state.ended?(this.emitEnd(),this.listeners.end.length>0):!1}destroy(){this.state.destroyed||(this.state.destroyed=!0,this.state.ended=!0,this.buffer.data.length=0,this.buffer.error.length=0,this.listeners.data.length=0,this.listeners.error.length=0,this.listeners.end.length=0,this.pendingWritePromises.length=0)}};function X3(e,t){const i=[];let r;for(;(r=e.read())!==null;)i.push(r);return t(i)}function DE(e,t){return new Promise((i,r)=>{const s=[];Uv(e,{onData:n=>{t&&s.push(n)},onError:n=>{t?r(n):i(void 0)},onEnd:()=>{i(t?t(s):void 0)}})})}function Uv(e,t,i){e.on("error",r=>{i?.isCancellationRequested||t.onError(r)}),e.on("end",()=>{i?.isCancellationRequested||t.onEnd()}),e.on("data",r=>{i?.isCancellationRequested||t.onData(r)})}function Y3(e,t){const i=Sh(t);return i.end(e),i}function Z3(e,t,i){const r=Sh(i);return Uv(e,{onData:s=>r.write(t.data(s)),onError:s=>r.error(t.error?t.error(s):s),onEnd:()=>r.end()}),r}var xh=typeof Buffer<"u",eN=new Si(()=>new Uint8Array(256)),Wv,Bv,z=class wr{static alloc(t){return xh?new wr(Buffer.allocUnsafe(t)):new wr(new Uint8Array(t))}static wrap(t){return xh&&!Buffer.isBuffer(t)&&(t=Buffer.from(t.buffer,t.byteOffset,t.byteLength)),new wr(t)}static fromString(t,i){return!(i?.dontUseNodeBuffer||!1)&&xh?new wr(Buffer.from(t)):(Wv||(Wv=new TextEncoder),new wr(Wv.encode(t)))}static fromByteArray(t){const i=wr.alloc(t.length);for(let r=0,s=t.length;r<s;r++)i.buffer[r]=t[r];return i}static concat(t,i){if(typeof i>"u"){i=0;for(let n=0,o=t.length;n<o;n++)i+=t[n].byteLength}const r=wr.alloc(i);let s=0;for(let n=0,o=t.length;n<o;n++){const a=t[n];r.set(a,s),s+=a.byteLength}return r}constructor(t){this.buffer=t,this.byteLength=this.buffer.byteLength}clone(){const t=wr.alloc(this.byteLength);return t.set(this),t}toString(){return xh?this.buffer.toString():(Bv||(Bv=new TextDecoder),Bv.decode(this.buffer))}slice(t,i){return new wr(this.buffer.subarray(t,i))}set(t,i){if(t instanceof wr)this.buffer.set(t.buffer,i);else if(t instanceof Uint8Array)this.buffer.set(t,i);else if(t instanceof ArrayBuffer)this.buffer.set(new Uint8Array(t),i);else if(ArrayBuffer.isView(t))this.buffer.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i);else throw new Error("Unknown argument 'array'")}readUInt32BE(t){return Eh(this.buffer,t)}writeUInt32BE(t,i){Ch(this.buffer,t,i)}readUInt32LE(t){return rN(this.buffer,t)}writeUInt32LE(t,i){sN(this.buffer,t,i)}readUInt8(t){return nN(this.buffer,t)}writeUInt8(t,i){oN(this.buffer,t,i)}indexOf(t,i=0){return kE(this.buffer,t instanceof wr?t.buffer:t,i)}equals(t){return this===t?!0:this.byteLength!==t.byteLength?!1:this.buffer.every((i,r)=>i===t.buffer[r])}};function kE(e,t,i=0){const r=t.byteLength,s=e.byteLength;if(r===0)return 0;if(r===1)return e.indexOf(t[0]);if(r>s-i)return-1;const n=eN.value;n.fill(t.length);for(let c=0;c<t.length;c++)n[t[c]]=t.length-c-1;let o=i+t.length-1,a=o,l=-1;for(;o<s;)if(e[o]===t[a]){if(a===0){l=o;break}o--,a--}else o+=Math.max(t.length-a,n[e[o]]),a=t.length-1;return l}function tN(e,t){return e[t+0]<<0>>>0|e[t+1]<<8>>>0}function iN(e,t,i){e[i+0]=t&255,t=t>>>8,e[i+1]=t&255}function Eh(e,t){return e[t]*2**24+e[t+1]*2**16+e[t+2]*2**8+e[t+3]}function Ch(e,t,i){e[i+3]=t,t=t>>>8,e[i+2]=t,t=t>>>8,e[i+1]=t,t=t>>>8,e[i]=t}function rN(e,t){return e[t+0]<<0>>>0|e[t+1]<<8>>>0|e[t+2]<<16>>>0|e[t+3]<<24>>>0}function sN(e,t,i){e[i+0]=t&255,t=t>>>8,e[i+1]=t&255,t=t>>>8,e[i+2]=t&255,t=t>>>8,e[i+3]=t&255}function nN(e,t){return e[t]}function oN(e,t,i){e[i]=t}function aN(e){return X3(e,t=>z.concat(t))}function lN(e){return DE(e,t=>z.concat(t))}function cN(e){return Y3(e,t=>z.concat(t))}function uN(e){return Z3(e,{data:t=>typeof t=="string"?z.fromString(t):z.wrap(t)},t=>z.concat(t))}function Dh(e){let t=0,i=0,r=0;const s=new Uint8Array(Math.floor(e.length/4*3)),n=a=>{switch(i){case 3:s[r++]=t|a,i=0;break;case 2:s[r++]=t|a>>>2,t=a<<6,i=3;break;case 1:s[r++]=t|a>>>4,t=a<<4,i=2;break;default:t=a<<2,i=1}};for(let a=0;a<e.length;a++){const l=e.charCodeAt(a);if(l>=65&&l<=90)n(l-65);else if(l>=97&&l<=122)n(l-97+26);else if(l>=48&&l<=57)n(l-48+52);else if(l===43||l===45)n(62);else if(l===47||l===95)n(63);else{if(l===61)break;throw new SyntaxError(`Unexpected base64 character ${e[a]}`)}}const o=r;for(;i>0;)n(0);return z.wrap(s).slice(0,o)}var dN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function kh({buffer:e},t=!0,i=!1){const r=i?hN:dN;let s="";const n=e.byteLength%3;let o=0;for(;o<e.byteLength-n;o+=3){const a=e[o+0],l=e[o+1],c=e[o+2];s+=r[a>>>2],s+=r[(a<<4|l>>>4)&63],s+=r[(l<<2|c>>>6)&63],s+=r[c&63]}if(n===1){const a=e[o+0];s+=r[a>>>2],s+=r[a<<4&63],t&&(s+="==")}else if(n===2){const a=e[o+0],l=e[o+1];s+=r[a>>>2],s+=r[(a<<4|l>>>4)&63],s+=r[l<<2&63],t&&(s+="=")}return s}function Vv(e){const t=[];typeof e=="number"&&t.push("code/timeOrigin",e);function i(s,n){t.push(s,n?.startTime??Date.now())}function r(){const s=[];for(let n=0;n<t.length;n+=2)s.push({name:t[n],startTime:t[n+1]});return s}return{mark:i,getMarks:r}}function fN(){if(typeof performance=="object"&&typeof performance.mark=="function"&&!performance.nodeTiming)return typeof performance.timeOrigin!="number"&&!performance.timing?Vv():{mark(e,t){performance.mark(e,t)},getMarks(){let e=performance.timeOrigin;typeof e!="number"&&(e=performance.timing.navigationStart||performance.timing.redirectStart||performance.timing.fetchStart);const t=[{name:"code/timeOrigin",startTime:Math.round(e)}];for(const i of performance.getEntriesByType("mark"))t.push({name:i.name,startTime:Math.round(e+i.startTime)});return t}};if(typeof process=="object"){const e=performance?.timeOrigin;return Vv(e)}else return console.trace("perf-util loaded in UNKNOWN environment"),Vv()}function pN(e){return e.MonacoPerformanceMarks||(e.MonacoPerformanceMarks=fN()),e.MonacoPerformanceMarks}var IE=pN(globalThis),Pt=IE.mark,gN=IE.getMarks;import*as xc from"fs";var Ih={};CR(Ih,{Promises:()=>dt,RimRafMode:()=>co,SymlinkSupport:()=>xi,configureFlushOnWrite:()=>jv,readdirSync:()=>xN,rimrafSync:()=>bN,whenDeleted:()=>CN,writeFileSync:()=>PN});import*as We from"fs";import{tmpdir as mN}from"os";import{promisify as Ec}from"util";var vN=new uc(1e4);function Ph(e){return TE(e,"NFC",vN)}var _N=new uc(1e4);function PE(e){return TE(e,"NFD",_N)}var wN=/[^\u0000-\u0080]/;function TE(e,t,i){if(!e)return e;const r=i.get(e);if(r)return r;let s;return wN.test(e)?s=e.normalize(t):s=e,i.set(e,s),s}var co;(function(e){e[e.UNLINK=0]="UNLINK",e[e.MOVE=1]="MOVE"})(co||(co={}));async function AE(e,t=co.UNLINK,i){if(tE(e))throw new Error("rimraf - will refuse to recursively delete root");return t===co.UNLINK?zv(e):yN(e,i)}async function yN(e,t=y3(mN())){try{try{await We.promises.rename(e,t)}catch(i){return i.code==="ENOENT"?void 0:zv(e)}zv(t).catch(i=>{})}catch(i){if(i.code!=="ENOENT")throw i}}async function zv(e){return We.promises.rm(e,{recursive:!0,force:!0,maxRetries:3})}function bN(e){if(tE(e))throw new Error("rimraf - will refuse to recursively delete root");We.rmSync(e,{recursive:!0,force:!0,maxRetries:3})}async function Th(e,t){return RE(await(t?SN(e):We.promises.readdir(e)))}async function SN(e){try{return await We.promises.readdir(e,{withFileTypes:!0})}catch(r){console.warn("[node.js fs] readdir with filetypes failed with error: ",r)}const t=[],i=await Th(e);for(const r of i){let s=!1,n=!1,o=!1;try{const a=await We.promises.lstat(Xe(e,r));s=a.isFile(),n=a.isDirectory(),o=a.isSymbolicLink()}catch(a){console.warn("[node.js fs] unexpected error from lstat after readdir: ",a)}t.push({name:r,isFile:()=>s,isDirectory:()=>n,isSymbolicLink:()=>o})}return t}function xN(e){return RE(We.readdirSync(e))}function RE(e){return e.map(t=>typeof t=="string"?Mt?Ph(t):t:(t.name=Mt?Ph(t.name):t.name,t))}async function EN(e){const t=await Th(e),i=[];for(const r of t)await xi.existsDirectory(Xe(e,r))&&i.push(r);return i}function CN(e,t=1e3){return new Promise(i=>{let r=!1;const s=setInterval(()=>{r||(r=!0,We.access(e,n=>{r=!1,n&&(clearInterval(s),i(void 0))}))},t)})}var xi;(function(e){async function t(s){let n;try{if(n=await We.promises.lstat(s),!n.isSymbolicLink())return{stat:n}}catch{}try{return{stat:await We.promises.stat(s),symbolicLink:n?.isSymbolicLink()?{dangling:!1}:void 0}}catch(o){if(o.code==="ENOENT"&&n)return{stat:n,symbolicLink:{dangling:!0}};if(Ve&&o.code==="EACCES")try{return{stat:await We.promises.stat(await We.promises.readlink(s)),symbolicLink:{dangling:!1}}}catch(a){if(a.code==="ENOENT"&&n)return{stat:n,symbolicLink:{dangling:!0}};throw a}throw o}}e.stat=t;async function i(s){try{const{stat:n,symbolicLink:o}=await e.stat(s);return n.isFile()&&o?.dangling!==!0}catch{}return!1}e.existsFile=i;async function r(s){try{const{stat:n,symbolicLink:o}=await e.stat(s);return n.isDirectory()&&o?.dangling!==!0}catch{}return!1}e.existsDirectory=r})(xi||(xi={}));var DN=new wE;function kN(e,t,i){return DN.queueFor(b.file(e),()=>{const r=LE(i);return new Promise((s,n)=>IN(e,t,r,o=>o?n(o):s()))},Ov)}var qv=!0;function jv(e){qv=e}function IN(e,t,i,r){if(!qv)return We.writeFile(e,t,{mode:i.mode,flag:i.flag},r);We.open(e,i.flag,i.mode,(s,n)=>{if(s)return r(s);We.writeFile(n,t,o=>{if(o)return We.close(n,()=>r(o));We.fdatasync(n,a=>(a&&(console.warn("[node.js fs] fdatasync is now disabled for this session because it failed: ",a),jv(!1)),We.close(n,l=>r(l))))})})}function PN(e,t,i){const r=LE(i);if(!qv)return We.writeFileSync(e,t,{mode:r.mode,flag:r.flag});const s=We.openSync(e,r.flag,r.mode);try{We.writeFileSync(s,t);try{We.fdatasyncSync(s)}catch(n){console.warn("[node.js fs] fdatasyncSync is now disabled for this session because it failed: ",n),jv(!1)}}finally{We.closeSync(s)}}function LE(e){return e?{mode:typeof e.mode=="number"?e.mode:438,flag:typeof e.flag=="string"?e.flag:"w"}:{mode:438,flag:"w"}}async function TN(e,t,i=6e4){if(e!==t)try{Ve&&typeof i=="number"?await NE(e,t,Date.now(),i):await We.promises.rename(e,t)}catch(r){if(e.toLowerCase()!==t.toLowerCase()&&r.code==="EXDEV"||e.endsWith("."))await ME(e,t,{preserveSymlinks:!1}),await AE(e,co.MOVE);else throw r}}async function NE(e,t,i,r,s=0){try{return await We.promises.rename(e,t)}catch(n){if(n.code!=="EACCES"&&n.code!=="EPERM"&&n.code!=="EBUSY")throw n;if(Date.now()-i>=r)throw console.error(`[node.js fs] rename failed after ${s} retries with error: ${n}`),n;if(s===0){let o=!1;try{const{stat:a}=await xi.stat(t);a.isFile()||(o=!0)}catch{}if(o)throw n}return await ui(Math.min(100,s*10)),NE(e,t,i,r,s+1)}}async function ME(e,t,i){return FE(e,t,{root:{source:e,target:t},options:i,handledSourcePaths:new Set})}var OE=511;async function FE(e,t,i){if(i.handledSourcePaths.has(e))return;i.handledSourcePaths.add(e);const{stat:r,symbolicLink:s}=await xi.stat(e);if(s){if(i.options.preserveSymlinks)try{return await LN(e,t,i)}catch{}if(s.dangling)return}return r.isDirectory()?AN(e,t,r.mode&OE,i):RN(e,t,r.mode&OE)}async function AN(e,t,i,r){await We.promises.mkdir(t,{recursive:!0,mode:i});const s=await Th(e);for(const n of s)await FE(Xe(e,n),Xe(t,n),r)}async function RN(e,t,i){await We.promises.copyFile(e,t),await We.promises.chmod(t,i)}async function LN(e,t,i){let r=await We.promises.readlink(e);ao(r,i.root.source,!Ct)&&(r=Xe(i.root.target,r.substr(i.root.source.length+1))),await We.promises.symlink(r,t)}var dt=new class{get read(){return(e,t,i,r,s)=>new Promise((n,o)=>{We.read(e,t,i,r,s,(a,l,c)=>a?o(a):n({bytesRead:l,buffer:c}))})}get write(){return(e,t,i,r,s)=>new Promise((n,o)=>{We.write(e,t,i,r,s,(a,l,c)=>a?o(a):n({bytesWritten:l,buffer:c}))})}get fdatasync(){return Ec(We.fdatasync)}get open(){return Ec(We.open)}get close(){return Ec(We.close)}get realpath(){return Ec(We.realpath)}get ftruncate(){return Ec(We.ftruncate)}async exists(e){try{return await We.promises.access(e),!0}catch{return!1}}get readdir(){return Th}get readDirsInDir(){return EN}get writeFile(){return kN}get rm(){return AE}get rename(){return TN}get copy(){return ME}};async function $E(e){try{return await dt.realpath(e)}catch{const i=HE(e);return await xc.promises.access(i,xc.constants.R_OK),i}}function NN(e){try{return xc.realpathSync(e)}catch{const i=HE(e);return xc.accessSync(i,xc.constants.R_OK),i}}function HE(e){return vn(Cs(e),St)}function UE(e){return(t,i,r)=>{let s=null,n=null;if(typeof r.value=="function"?(s="value",n=r.value):typeof r.get=="function"&&(s="get",n=r.get),!n||typeof i=="symbol")throw new Error("not supported");r[s]=e(n,i)}}function WE(e,t,i){let r=null,s=null;if(typeof i.value=="function"?(r="value",s=i.value,s.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof i.get=="function"&&(r="get",s=i.get),!s)throw new Error("not supported");const n=`$memoize$${t}`;i[r]=function(...o){return this.hasOwnProperty(n)||Object.defineProperty(this,n,{configurable:!1,enumerable:!1,writable:!1,value:s.apply(this,o)}),this[n]}}function Ah(e,t,i){return UE((r,s)=>{const n=`$debounce$${s}`,o=`$debounce$result$${s}`;return function(...a){this[o]||(this[o]=i?i():void 0),clearTimeout(this[n]),t&&(this[o]=t(this[o],...a),a=[this[o]]),this[n]=setTimeout(()=>{r.apply(this,a),this[o]=i?i():void 0},e)}})}function MN(e,t,i){return UE((r,s)=>{const n=`$throttle$timer$${s}`,o=`$throttle$result$${s}`,a=`$throttle$lastRun$${s}`,l=`$throttle$pending$${s}`;return function(...c){if(this[o]||(this[o]=i?i():void 0),(this[a]===null||this[a]===void 0)&&(this[a]=-Number.MAX_VALUE),t&&(this[o]=t(this[o],...c)),this[l])return;const u=this[a]+e;u<=Date.now()?(this[a]=Date.now(),r.apply(this,[this[o]]),this[o]=i?i():void 0):(this[l]=!0,this[n]=setTimeout(()=>{this[l]=!1,this[a]=Date.now(),r.apply(this,[this[o]]),this[o]=i?i():void 0},u-Date.now()))}})}function ON(e){return JSON.stringify(e,FN)}function BE(e){let t=JSON.parse(e);return t=kt(t),t}function FN(e,t){return t instanceof RegExp?{$mid:2,source:t.source,flags:t.flags}:t}function kt(e,t=0){if(!e||t>200)return e;if(typeof e=="object"){switch(e.$mid){case 1:return b.revive(e);case 2:return new RegExp(e.source,e.flags);case 17:return new Date(e.source)}if(e instanceof z||e instanceof Uint8Array)return e;if(Array.isArray(e))for(let i=0;i<e.length;++i)e[i]=kt(e[i],t+1);else for(const i in e)Object.hasOwnProperty.call(e,i)&&(e[i]=kt(e[i],t+1))}return e}var VE;(function(e){e[e.Promise=100]="Promise",e[e.PromiseCancel=101]="PromiseCancel",e[e.EventListen=102]="EventListen",e[e.EventDispose=103]="EventDispose"})(VE||(VE={}));function zE(e){switch(e){case 100:return"req";case 101:return"cancel";case 102:return"subscribe";case 103:return"unsubscribe"}}var qE;(function(e){e[e.Initialize=200]="Initialize",e[e.PromiseSuccess=201]="PromiseSuccess",e[e.PromiseError=202]="PromiseError",e[e.PromiseErrorObj=203]="PromiseErrorObj",e[e.EventFire=204]="EventFire"})(qE||(qE={}));function jE(e){switch(e){case 200:return"init";case 201:return"reply:";case 202:case 203:return"replyErr:";case 204:return"event:"}}var uo;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Idle=1]="Idle"})(uo||(uo={}));function Ia(e){let t=0;for(let i=0;;i+=7){const r=e.read(1);if(t|=(r.buffer[0]&127)<<i,!(r.buffer[0]&128))return t}}var $N=bn(0);function Pa(e,t){if(t===0){e.write($N);return}let i=0;for(let s=t;s!==0;s=s>>>7)i++;const r=z.alloc(i);for(let s=0;t!==0;s++)r.buffer[s]=t&127,t=t>>>7,t>0&&(r.buffer[s]|=128);e.write(r)}var HN=class{constructor(e){this.buffer=e,this.pos=0}read(e){const t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=t.byteLength,t}},UN=class{constructor(){this.buffers=[]}get buffer(){return z.concat(this.buffers)}write(e){this.buffers.push(e)}},_i;(function(e){e[e.Undefined=0]="Undefined",e[e.String=1]="String",e[e.Buffer=2]="Buffer",e[e.VSBuffer=3]="VSBuffer",e[e.Array=4]="Array",e[e.Object=5]="Object",e[e.Int=6]="Int"})(_i||(_i={}));function bn(e){const t=z.alloc(1);return t.writeUInt8(e,0),t}var ho={Undefined:bn(_i.Undefined),String:bn(_i.String),Buffer:bn(_i.Buffer),VSBuffer:bn(_i.VSBuffer),Array:bn(_i.Array),Object:bn(_i.Object),Uint:bn(_i.Int)},WN=typeof Buffer<"u";function Gv(e,t){if(typeof t>"u")e.write(ho.Undefined);else if(typeof t=="string"){const i=z.fromString(t);e.write(ho.String),Pa(e,i.byteLength),e.write(i)}else if(WN&&Buffer.isBuffer(t)){const i=z.wrap(t);e.write(ho.Buffer),Pa(e,i.byteLength),e.write(i)}else if(t instanceof z)e.write(ho.VSBuffer),Pa(e,t.byteLength),e.write(t);else if(Array.isArray(t)){e.write(ho.Array),Pa(e,t.length);for(const i of t)Gv(e,i)}else if(typeof t=="number"&&(t|0)===t)e.write(ho.Uint),Pa(e,t);else{const i=z.fromString(JSON.stringify(t));e.write(ho.Object),Pa(e,i.byteLength),e.write(i)}}function Qv(e){switch(e.read(1).readUInt8(0)){case _i.Undefined:return;case _i.String:return e.read(Ia(e)).toString();case _i.Buffer:return e.read(Ia(e)).buffer;case _i.VSBuffer:return e.read(Ia(e));case _i.Array:{const i=Ia(e),r=[];for(let s=0;s<i;s++)r.push(Qv(e));return r}case _i.Object:return JSON.parse(e.read(Ia(e)).toString());case _i.Int:return Ia(e)}}var GE;(function(e){e[e.LocalSide=0]="LocalSide",e[e.OtherSide=1]="OtherSide"})(GE||(GE={}));var QE=class{constructor(e,t=null){this.protocol=e,this.isDisposed=!1,this.state=uo.Uninitialized,this.activeRequests=new Set,this.handlers=new Map,this.lastRequestId=0,this._onDidInitialize=new D,this.onDidInitialize=this._onDidInitialize.event,this.protocolListener=this.protocol.onMessage(i=>this.onBuffer(i)),this.logger=t}getChannel(e){const t=this;return{call(i,r,s){return t.isDisposed?Promise.reject(new oi):t.requestPromise(e,i,r,s)},listen(i,r){return t.isDisposed?Fe.None:t.requestEvent(e,i,r)}}}requestPromise(e,t,i,r=Be.None){const s=this.lastRequestId++,o={id:s,type:100,channelName:e,name:t,arg:i};if(r.isCancellationRequested)return Promise.reject(new oi);let a,l;return new Promise((u,d)=>{if(r.isCancellationRequested)return d(new oi);const f=()=>{const v=y=>{switch(y.type){case 201:this.handlers.delete(s),u(y.data);break;case 202:{this.handlers.delete(s);const S=new Error(y.data.message);S.stack=Array.isArray(y.data.stack)?y.data.stack.join(`
`):y.data.stack,S.name=y.data.name,d(S);break}case 203:this.handlers.delete(s),d(y.data);break}};this.handlers.set(s,v),this.sendRequest(o)};let p=null;this.state===uo.Idle?f():(p=Ds(v=>this.whenInitialized()),p.then(()=>{p=null,f()}));const g=()=>{p?(p.cancel(),p=null):this.sendRequest({id:s,type:101}),d(new oi)};a=r.onCancellationRequested(g),l={dispose:eh(()=>{g(),a.dispose()})},this.activeRequests.add(l)}).finally(()=>{a?.dispose(),this.activeRequests.delete(l)})}requestEvent(e,t,i){const r=this.lastRequestId++,n={id:r,type:102,channelName:e,name:t,arg:i};let o=null;const a=new D({onWillAddFirstListener:()=>{const c=()=>{this.activeRequests.add(a),this.sendRequest(n)};this.state===uo.Idle?c():(o=Ds(u=>this.whenInitialized()),o.then(()=>{o=null,c()}))},onDidRemoveLastListener:()=>{o?(o.cancel(),o=null):(this.activeRequests.delete(a),this.sendRequest({id:r,type:103}))}}),l=c=>a.fire(c.data);return this.handlers.set(r,l),a.event}sendRequest(e){switch(e.type){case 100:case 102:{const t=this.send([e.type,e.id,e.channelName,e.name],e.arg);this.logger?.logOutgoing(t,e.id,0,`${zE(e.type)}: ${e.channelName}.${e.name}`,e.arg);return}case 101:case 103:{const t=this.send([e.type,e.id]);this.logger?.logOutgoing(t,e.id,0,zE(e.type));return}}}send(e,t=void 0){const i=new UN;return Gv(i,e),Gv(i,t),this.sendBuffer(i.buffer)}sendBuffer(e){try{return this.protocol.send(e),e.byteLength}catch{return 0}}onBuffer(e){const t=new HN(e),i=Qv(t),r=Qv(t),s=i[0];switch(s){case 200:return this.logger?.logIncoming(e.byteLength,0,0,jE(s)),this.onResponse({type:i[0]});case 201:case 202:case 204:case 203:return this.logger?.logIncoming(e.byteLength,i[1],0,jE(s),r),this.onResponse({type:i[0],id:i[1],data:r})}}onResponse(e){if(e.type===200){this.state=uo.Idle,this._onDidInitialize.fire();return}this.handlers.get(e.id)?.(e)}get onDidInitializePromise(){return Fe.toPromise(this.onDidInitialize)}whenInitialized(){return this.state===uo.Idle?Promise.resolve():this.onDidInitializePromise}dispose(){this.isDisposed=!0,this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),Cr(this.activeRequests.values()),this.activeRequests.clear()}};__decorate([WE],QE.prototype,"onDidInitializePromise",null);function BN(e){let t=!1;return{call(i,r,s){return t?e.call(i,r,s):ui(0).then(()=>t=!0).then(()=>e.call(i,r,s))},listen(i,r){if(t)return e.listen(i,r);const s=new mL;return ui(0).then(()=>t=!0).then(()=>s.input=e.listen(i,r)),s.event}}}var Jv;(function(e){function t(n,o,a){const l=n,c=a&&a.disableMarshalling,u=new Map;for(const d in l)r(d)&&u.set(d,Fe.buffer(l[d],!0,void 0,o));return new class{listen(d,f,p){const g=u.get(f);if(g)return g;const v=l[f];if(typeof v=="function"){if(s(f))return v.call(l,p);if(r(f))return u.set(f,Fe.buffer(l[f],!0,void 0,o)),u.get(f)}throw new xr(`Event not found: ${f}`)}call(d,f,p){const g=l[f];if(typeof g=="function"){if(!c&&Array.isArray(p))for(let y=0;y<p.length;y++)p[y]=kt(p[y]);let v=g.apply(l,p);return v instanceof Promise||(v=Promise.resolve(v)),v}throw new xr(`Method not found: ${f}`)}}}e.fromService=t;function i(n,o){const a=o&&o.disableMarshalling;return new Proxy({},{get(l,c){if(typeof c=="string")return o?.properties?.has(c)?o.properties.get(c):s(c)?function(u){return n.listen(c,u)}:r(c)?n.listen(c):async function(...u){let d;o&&!Lt(o.context)?d=[o.context,...u]:d=u;const f=await n.call(c,d);return a?f:kt(f)};throw new xr(`Property not found: ${String(c)}`)}})}e.toService=i;function r(n){return n[0]==="o"&&n[1]==="n"&&Vx(n.charCodeAt(2))}function s(n){return/^onDynamic/.test(n)&&Vx(n.charCodeAt(9))}})(Jv||(Jv={}));var JE;(function(e){e.Created="created",e.Read="read",e.Write="write",e.Open="open",e.Error="error",e.Close="close",e.BrowserWebSocketBlobReceived="browserWebSocketBlobReceived",e.NodeEndReceived="nodeEndReceived",e.NodeEndSent="nodeEndSent",e.NodeDrainBegin="nodeDrainBegin",e.NodeDrainEnd="nodeDrainEnd",e.zlibInflateError="zlibInflateError",e.zlibInflateData="zlibInflateData",e.zlibInflateInitialWrite="zlibInflateInitialWrite",e.zlibInflateInitialFlushFired="zlibInflateInitialFlushFired",e.zlibInflateWrite="zlibInflateWrite",e.zlibInflateFlushFired="zlibInflateFlushFired",e.zlibDeflateError="zlibDeflateError",e.zlibDeflateData="zlibDeflateData",e.zlibDeflateWrite="zlibDeflateWrite",e.zlibDeflateFlushFired="zlibDeflateFlushFired",e.WebSocketNodeSocketWrite="webSocketNodeSocketWrite",e.WebSocketNodeSocketPeekedHeader="webSocketNodeSocketPeekedHeader",e.WebSocketNodeSocketReadHeader="webSocketNodeSocketReadHeader",e.WebSocketNodeSocketReadData="webSocketNodeSocketReadData",e.WebSocketNodeSocketUnmaskedData="webSocketNodeSocketUnmaskedData",e.WebSocketNodeSocketDrainBegin="webSocketNodeSocketDrainBegin",e.WebSocketNodeSocketDrainEnd="webSocketNodeSocketDrainEnd",e.ProtocolHeaderRead="protocolHeaderRead",e.ProtocolMessageRead="protocolMessageRead",e.ProtocolHeaderWrite="protocolHeaderWrite",e.ProtocolMessageWrite="protocolMessageWrite",e.ProtocolWrite="protocolWrite"})(JE||(JE={}));var Rh;(function(e){e.enableDiagnostics=!1,e.records=[];const t=new WeakMap;let i=0;function r(n,o){if(!t.has(n)){const a=String(++i);t.set(n,a)}return t.get(n)}function s(n,o,a,l){if(!e.enableDiagnostics)return;const c=r(n,o);if(l instanceof z||l instanceof Uint8Array||l instanceof ArrayBuffer||ArrayBuffer.isView(l)){const u=z.alloc(l.byteLength);u.set(l),e.records.push({timestamp:Date.now(),id:c,label:o,type:a,buff:u})}else e.records.push({timestamp:Date.now(),id:c,label:o,type:a,data:l})}e.traceSocketEvent=s})(Rh||(Rh={}));var KE;(function(e){e[e.NodeSocketCloseEvent=0]="NodeSocketCloseEvent",e[e.WebSocketCloseEvent=1]="WebSocketCloseEvent"})(KE||(KE={}));var Kv=null;function Sn(){return Kv||(Kv=z.alloc(0)),Kv}var XE=class{get byteLength(){return this._totalLength}constructor(){this._chunks=[],this._totalLength=0}acceptChunk(e){this._chunks.push(e),this._totalLength+=e.byteLength}read(e){return this._read(e,!0)}peek(e){return this._read(e,!1)}_read(e,t){if(e===0)return Sn();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){const n=this._chunks[0];return t&&(this._chunks.shift(),this._totalLength-=e),n}if(this._chunks[0].byteLength>e){const n=this._chunks[0].slice(0,e);return t&&(this._chunks[0]=this._chunks[0].slice(e),this._totalLength-=e),n}const i=z.alloc(e);let r=0,s=0;for(;e>0;){const n=this._chunks[s];if(n.byteLength>e){const o=n.slice(0,e);i.set(o,r),r+=e,t&&(this._chunks[s]=n.slice(e),this._totalLength-=e),e-=e}else i.set(n,r),r+=n.byteLength,t?(this._chunks.shift(),this._totalLength-=n.byteLength):s++,e-=n.byteLength}return i}},YE;(function(e){e[e.None=0]="None",e[e.Regular=1]="Regular",e[e.Control=2]="Control",e[e.Ack=3]="Ack",e[e.Disconnect=5]="Disconnect",e[e.ReplayRequest=6]="ReplayRequest",e[e.Pause=7]="Pause",e[e.Resume=8]="Resume",e[e.KeepAlive=9]="KeepAlive"})(YE||(YE={}));function ZE(e){switch(e){case 0:return"None";case 1:return"Regular";case 2:return"Control";case 3:return"Ack";case 5:return"Disconnect";case 6:return"ReplayRequest";case 7:return"PauseWriting";case 8:return"ResumeWriting";case 9:return"KeepAlive"}}var eC;(function(e){e[e.HeaderLength=13]="HeaderLength",e[e.AcknowledgeTime=2e3]="AcknowledgeTime",e[e.TimeoutTime=2e4]="TimeoutTime",e[e.ReconnectionGraceTime=108e5]="ReconnectionGraceTime",e[e.ReconnectionShortGraceTime=3e5]="ReconnectionShortGraceTime",e[e.KeepAliveSendTime=5e3]="KeepAliveSendTime"})(eC||(eC={}));var Yr=class{constructor(e,t,i,r){this.type=e,this.id=t,this.ack=i,this.data=r,this.writtenTime=0}get size(){return this.data.byteLength}},tC=class extends X{constructor(e){super(),this._onMessage=this._register(new D),this.onMessage=this._onMessage.event,this._state={readHead:!0,readLen:13,messageType:0,id:0,ack:0},this._socket=e,this._isDisposed=!1,this._incomingData=new XE,this._register(this._socket.onData(t=>this.acceptChunk(t))),this.lastReadTime=Date.now()}acceptChunk(e){if(!(!e||e.byteLength===0))for(this.lastReadTime=Date.now(),this._incomingData.acceptChunk(e);this._incomingData.byteLength>=this._state.readLen;){const t=this._incomingData.read(this._state.readLen);if(this._state.readHead)this._state.readHead=!1,this._state.readLen=t.readUInt32BE(9),this._state.messageType=t.readUInt8(0),this._state.id=t.readUInt32BE(1),this._state.ack=t.readUInt32BE(5),this._socket.traceSocketEvent("protocolHeaderRead",{messageType:ZE(this._state.messageType),id:this._state.id,ack:this._state.ack,messageSize:this._state.readLen});else{const i=this._state.messageType,r=this._state.id,s=this._state.ack;if(this._state.readHead=!0,this._state.readLen=13,this._state.messageType=0,this._state.id=0,this._state.ack=0,this._socket.traceSocketEvent("protocolMessageRead",t),this._onMessage.fire(new Yr(i,r,s,t)),this._isDisposed)break}}}readEntireBuffer(){return this._incomingData.read(this._incomingData.byteLength)}dispose(){this._isDisposed=!0,super.dispose()}},iC=class{constructor(e){this._writeNowTimeout=null,this._isDisposed=!1,this._isPaused=!1,this._socket=e,this._data=[],this._totalLength=0,this.lastWriteTime=0}dispose(){try{this.flush()}catch{}this._isDisposed=!0}drain(){return this.flush(),this._socket.drain()}flush(){this._writeNow()}pause(){this._isPaused=!0}resume(){this._isPaused=!1,this._scheduleWriting()}write(e){if(this._isDisposed)return;e.writtenTime=Date.now(),this.lastWriteTime=Date.now();const t=z.alloc(13);t.writeUInt8(e.type,0),t.writeUInt32BE(e.id,1),t.writeUInt32BE(e.ack,5),t.writeUInt32BE(e.data.byteLength,9),this._socket.traceSocketEvent("protocolHeaderWrite",{messageType:ZE(e.type),id:e.id,ack:e.ack,messageSize:e.data.byteLength}),this._socket.traceSocketEvent("protocolMessageWrite",e.data),this._writeSoon(t,e.data)}_bufferAdd(e,t){const i=this._totalLength===0;return this._data.push(e,t),this._totalLength+=e.byteLength+t.byteLength,i}_bufferTake(){const e=z.concat(this._data,this._totalLength);return this._data.length=0,this._totalLength=0,e}_writeSoon(e,t){this._bufferAdd(e,t)&&this._scheduleWriting()}_scheduleWriting(){this._writeNowTimeout||(this._writeNowTimeout=setTimeout(()=>{this._writeNowTimeout=null,this._writeNow()}))}_writeNow(){if(this._totalLength===0||this._isPaused)return;const e=this._bufferTake();this._socket.traceSocketEvent("protocolWrite",{byteLength:e.byteLength}),this._socket.write(e)}},fo=class{constructor(){this._hasListeners=!1,this._isDeliveringMessages=!1,this._bufferedMessages=[],this._emitter=new D({onWillAddFirstListener:()=>{this._hasListeners=!0,queueMicrotask(()=>this._deliverMessages())},onDidRemoveLastListener:()=>{this._hasListeners=!1}}),this.event=this._emitter.event}_deliverMessages(){if(!this._isDeliveringMessages){for(this._isDeliveringMessages=!0;this._hasListeners&&this._bufferedMessages.length>0;)this._emitter.fire(this._bufferedMessages.shift());this._isDeliveringMessages=!1}}fire(e){this._hasListeners?this._bufferedMessages.length>0?this._bufferedMessages.push(e):this._emitter.fire(e):this._bufferedMessages.push(e)}flushBuffer(){this._bufferedMessages=[]}},VN=class{constructor(e){this.data=e,this.next=null}},zN=class{constructor(){this._first=null,this._last=null}length(){let e=0,t=this._first;for(;t;)t=t.next,e++;return e}peek(){return this._first?this._first.data:null}toArray(){const e=[];let t=0,i=this._first;for(;i;)e[t++]=i.data,i=i.next;return e}pop(){if(this._first){if(this._first===this._last){this._first=null,this._last=null;return}this._first=this._first.next}}push(e){const t=new VN(e);if(!this._first){this._first=t,this._last=t;return}this._last.next=t,this._last=t}},qN=class gs{static{this._HISTORY_LENGTH=10}static{this._INSTANCE=null}static getInstance(){return gs._INSTANCE||(gs._INSTANCE=new gs),gs._INSTANCE}constructor(){this.lastRuns=[];const t=Date.now();for(let i=0;i<gs._HISTORY_LENGTH;i++)this.lastRuns[i]=t-1e3*i;setInterval(()=>{for(let i=gs._HISTORY_LENGTH;i>=1;i--)this.lastRuns[i]=this.lastRuns[i-1];this.lastRuns[0]=Date.now()},1e3)}load(){const t=Date.now(),i=(1+gs._HISTORY_LENGTH)*1e3;let r=0;for(let s=0;s<gs._HISTORY_LENGTH;s++)t-this.lastRuns[s]<=i&&r++;return 1-r/gs._HISTORY_LENGTH}hasHighLoad(){return this.load()>=.5}},Xv=class{get unacknowledgedCount(){return this._outgoingMsgId-this._outgoingAckId}constructor(e){this._onControlMessage=new fo,this.onControlMessage=this._onControlMessage.event,this._onMessage=new fo,this.onMessage=this._onMessage.event,this._onDidDispose=new fo,this.onDidDispose=this._onDidDispose.event,this._onSocketClose=new fo,this.onSocketClose=this._onSocketClose.event,this._onSocketTimeout=new fo,this.onSocketTimeout=this._onSocketTimeout.event,this._loadEstimator=e.loadEstimator??qN.getInstance(),this._shouldSendKeepAlive=e.sendKeepAlive??!0,this._isReconnecting=!1,this._outgoingUnackMsg=new zN,this._outgoingMsgId=0,this._outgoingAckId=0,this._outgoingAckTimeout=null,this._incomingMsgId=0,this._incomingAckId=0,this._incomingMsgLastTime=0,this._incomingAckTimeout=null,this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socketDisposables=new oe,this._socket=e.socket,this._socketWriter=this._socketDisposables.add(new iC(this._socket)),this._socketReader=this._socketDisposables.add(new tC(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(t=>this._receiveMessage(t))),this._socketDisposables.add(this._socket.onClose(t=>this._onSocketClose.fire(t))),e.initialChunk&&this._socketReader.acceptChunk(e.initialChunk),this._shouldSendKeepAlive?this._keepAliveInterval=setInterval(()=>{this._sendKeepAlive()},5e3):this._keepAliveInterval=null}dispose(){this._outgoingAckTimeout&&(clearTimeout(this._outgoingAckTimeout),this._outgoingAckTimeout=null),this._incomingAckTimeout&&(clearTimeout(this._incomingAckTimeout),this._incomingAckTimeout=null),this._keepAliveInterval&&(clearInterval(this._keepAliveInterval),this._keepAliveInterval=null),this._socketDisposables.dispose()}drain(){return this._socketWriter.drain()}sendDisconnect(){if(!this._didSendDisconnect){this._didSendDisconnect=!0;const e=new Yr(5,0,0,Sn());this._socketWriter.write(e),this._socketWriter.flush()}}sendPause(){const e=new Yr(7,0,0,Sn());this._socketWriter.write(e)}sendResume(){const e=new Yr(8,0,0,Sn());this._socketWriter.write(e)}pauseSocketWriting(){this._socketWriter.pause()}getSocket(){return this._socket}getMillisSinceLastIncomingData(){return Date.now()-this._socketReader.lastReadTime}beginAcceptReconnection(e,t){this._isReconnecting=!0,this._socketDisposables.dispose(),this._socketDisposables=new oe,this._onControlMessage.flushBuffer(),this._onSocketClose.flushBuffer(),this._onSocketTimeout.flushBuffer(),this._socket.dispose(),this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socket=e,this._socketWriter=this._socketDisposables.add(new iC(this._socket)),this._socketReader=this._socketDisposables.add(new tC(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(i=>this._receiveMessage(i))),this._socketDisposables.add(this._socket.onClose(i=>this._onSocketClose.fire(i))),this._socketReader.acceptChunk(t)}endAcceptReconnection(){this._isReconnecting=!1,this._incomingAckId=this._incomingMsgId;const e=new Yr(3,0,this._incomingAckId,Sn());this._socketWriter.write(e);const t=this._outgoingUnackMsg.toArray();for(let i=0,r=t.length;i<r;i++)this._socketWriter.write(t[i]);this._recvAckCheck()}acceptDisconnect(){this._onDidDispose.fire()}_receiveMessage(e){if(e.ack>this._outgoingAckId){this._outgoingAckId=e.ack;do{const t=this._outgoingUnackMsg.peek();if(t&&t.id<=e.ack)this._outgoingUnackMsg.pop();else break}while(!0)}switch(e.type){case 0:break;case 1:{if(e.id>this._incomingMsgId)if(e.id!==this._incomingMsgId+1){const t=Date.now();t-this._lastReplayRequestTime>1e4&&(this._lastReplayRequestTime=t,this._socketWriter.write(new Yr(6,0,0,Sn())))}else this._incomingMsgId=e.id,this._incomingMsgLastTime=Date.now(),this._sendAckCheck(),this._onMessage.fire(e.data);break}case 2:{this._onControlMessage.fire(e.data);break}case 3:break;case 5:{this._onDidDispose.fire();break}case 6:{const t=this._outgoingUnackMsg.toArray();for(let i=0,r=t.length;i<r;i++)this._socketWriter.write(t[i]);this._recvAckCheck();break}case 7:{this._socketWriter.pause();break}case 8:{this._socketWriter.resume();break}case 9:break}}readEntireBuffer(){return this._socketReader.readEntireBuffer()}flush(){this._socketWriter.flush()}send(e){const t=++this._outgoingMsgId;this._incomingAckId=this._incomingMsgId;const i=new Yr(1,t,this._incomingAckId,e);this._outgoingUnackMsg.push(i),this._isReconnecting||(this._socketWriter.write(i),this._recvAckCheck())}sendControl(e){const t=new Yr(2,0,0,e);this._socketWriter.write(t)}_sendAckCheck(){if(this._incomingMsgId<=this._incomingAckId||this._incomingAckTimeout)return;const e=Date.now()-this._incomingMsgLastTime;if(e>=2e3){this._sendAck();return}this._incomingAckTimeout=setTimeout(()=>{this._incomingAckTimeout=null,this._sendAckCheck()},2e3-e+5)}_recvAckCheck(){if(this._outgoingMsgId<=this._outgoingAckId||this._outgoingAckTimeout||this._isReconnecting)return;const e=this._outgoingUnackMsg.peek(),t=Date.now()-e.writtenTime,i=Date.now()-this._socketReader.lastReadTime,r=Date.now()-this._lastSocketTimeoutTime;if(t>=2e4&&i>=2e4&&r>=2e4&&!this._loadEstimator.hasHighLoad()){this._lastSocketTimeoutTime=Date.now(),this._onSocketTimeout.fire({unacknowledgedMsgCount:this._outgoingUnackMsg.length(),timeSinceOldestUnacknowledgedMsg:t,timeSinceLastReceivedSomeData:i});return}const s=Math.max(2e4-t,2e4-i,2e4-r,500);this._outgoingAckTimeout=setTimeout(()=>{this._outgoingAckTimeout=null,this._recvAckCheck()},s)}_sendAck(){if(this._incomingMsgId<=this._incomingAckId)return;this._incomingAckId=this._incomingMsgId;const e=new Yr(3,0,this._incomingAckId,Sn());this._socketWriter.write(e)}_sendKeepAlive(){this._incomingAckId=this._incomingMsgId;const e=new Yr(9,0,this._incomingAckId,Sn());this._socketWriter.write(e)}};import"crypto";import"net";import{tmpdir as jN}from"os";import{createDeflateRaw as GN,createInflateRaw as QN}from"zlib";var mt=function(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);const e=new Uint8Array(16),t=[];for(let i=0;i<256;i++)t.push(i.toString(16).padStart(2,"0"));return function(){crypto.getRandomValues(e),e[6]=e[6]&15|64,e[8]=e[8]&63|128;let r=0,s="";return s+=t[e[r++]],s+=t[e[r++]],s+=t[e[r++]],s+=t[e[r++]],s+="-",s+=t[e[r++]],s+=t[e[r++]],s+="-",s+=t[e[r++]],s+=t[e[r++]],s+="-",s+=t[e[r++]],s+=t[e[r++]],s+="-",s+=t[e[r++]],s+=t[e[r++]],s+=t[e[r++]],s+=t[e[r++]],s+=t[e[r++]],s+=t[e[r++]],s}}(),JN=3e4,Cc=class{traceSocketEvent(e,t){Rh.traceSocketEvent(this.socket,this.debugLabel,e,t)}constructor(e,t=""){this._canWrite=!0,this.debugLabel=t,this.socket=e,this.traceSocketEvent("created",{type:"NodeSocket"}),this._errorListener=r=>{if(this.traceSocketEvent("error",{code:r?.code,message:r?.message}),r){if(r.code==="EPIPE")return;pt(r)}},this.socket.on("error",this._errorListener);let i;this._closeListener=r=>{this.traceSocketEvent("close",{hadError:r}),this._canWrite=!1,i&&clearTimeout(i)},this.socket.on("close",this._closeListener),this._endListener=()=>{this.traceSocketEvent("nodeEndReceived"),this._canWrite=!1,i=setTimeout(()=>e.destroy(),JN)},this.socket.on("end",this._endListener)}dispose(){this.socket.off("error",this._errorListener),this.socket.off("close",this._closeListener),this.socket.off("end",this._endListener),this.socket.destroy()}onData(e){const t=i=>{this.traceSocketEvent("read",i),e(z.wrap(i))};return this.socket.on("data",t),{dispose:()=>this.socket.off("data",t)}}onClose(e){const t=i=>{e({type:0,hadError:i,error:void 0})};return this.socket.on("close",t),{dispose:()=>this.socket.off("close",t)}}onEnd(e){const t=()=>{e()};return this.socket.on("end",t),{dispose:()=>this.socket.off("end",t)}}write(e){if(!(this.socket.destroyed||!this._canWrite))try{this.traceSocketEvent("write",e),this.socket.write(e.buffer,t=>{if(t){if(t.code==="EPIPE")return;pt(t)}})}catch(t){if(t.code==="EPIPE")return;pt(t)}}end(){this.traceSocketEvent("nodeEndSent"),this.socket.end()}drain(){return this.traceSocketEvent("nodeDrainBegin"),new Promise((e,t)=>{if(this.socket.bufferSize===0){this.traceSocketEvent("nodeDrainEnd"),e();return}const i=()=>{this.socket.off("close",i),this.socket.off("end",i),this.socket.off("error",i),this.socket.off("timeout",i),this.socket.off("drain",i),this.traceSocketEvent("nodeDrainEnd"),e()};this.socket.on("close",i),this.socket.on("end",i),this.socket.on("error",i),this.socket.on("timeout",i),this.socket.on("drain",i)})}},rC;(function(e){e[e.MinHeaderByteSize=2]="MinHeaderByteSize",e[e.MaxWebSocketMessageLength=262144]="MaxWebSocketMessageLength"})(rC||(rC={}));var sC;(function(e){e[e.PeekHeader=1]="PeekHeader",e[e.ReadHeader=2]="ReadHeader",e[e.ReadBody=3]="ReadBody",e[e.Fin=4]="Fin"})(sC||(sC={}));var KN=class extends X{get permessageDeflate(){return this._flowManager.permessageDeflate}get recordedInflateBytes(){return this._flowManager.recordedInflateBytes}traceSocketEvent(e,t){this.socket.traceSocketEvent(e,t)}constructor(e,t,i,r){super(),this._onData=this._register(new D),this._onClose=this._register(new D),this._isEnded=!1,this._state={state:1,readLen:2,fin:0,compressed:!1,firstFrameOfMessage:!0,mask:0,opcode:0},this.socket=e,this.traceSocketEvent("created",{type:"WebSocketNodeSocket",permessageDeflate:t,inflateBytesLength:i?.byteLength||0,recordInflateBytes:r}),this._flowManager=this._register(new XN(this,t,i,r,this._onData,(s,n)=>this._write(s,n))),this._register(this._flowManager.onError(s=>{console.error(s),pt(s),this._onClose.fire({type:0,hadError:!0,error:s})})),this._incomingData=new XE,this._register(this.socket.onData(s=>this._acceptChunk(s))),this._register(this.socket.onClose(async s=>{this._flowManager.isProcessingReadQueue()&&await Fe.toPromise(this._flowManager.onDidFinishProcessingReadQueue),this._onClose.fire(s)}))}dispose(){this._flowManager.isProcessingWriteQueue()?this._register(this._flowManager.onDidFinishProcessingWriteQueue(()=>{this.dispose()})):(this.socket.dispose(),super.dispose())}onData(e){return this._onData.event(e)}onClose(e){return this._onClose.event(e)}onEnd(e){return this.socket.onEnd(e)}write(e){let t=0;for(;t<e.byteLength;)this._flowManager.writeMessage(e.slice(t,Math.min(t+262144,e.byteLength)),{compressed:!0,opcode:2}),t+=262144}_write(e,{compressed:t,opcode:i}){if(this._isEnded)return;this.traceSocketEvent("webSocketNodeSocketWrite",e);let r=2;e.byteLength<126?r+=0:e.byteLength<2**16?r+=2:r+=8;const s=z.alloc(r),n=t?64:0,o=i&15;if(s.writeUInt8(128|n|o,0),e.byteLength<126)s.writeUInt8(e.byteLength,1);else if(e.byteLength<2**16){s.writeUInt8(126,1);let a=1;s.writeUInt8(e.byteLength>>>8&255,++a),s.writeUInt8(e.byteLength>>>0&255,++a)}else{s.writeUInt8(127,1);let a=1;s.writeUInt8(0,++a),s.writeUInt8(0,++a),s.writeUInt8(0,++a),s.writeUInt8(0,++a),s.writeUInt8(e.byteLength>>>24&255,++a),s.writeUInt8(e.byteLength>>>16&255,++a),s.writeUInt8(e.byteLength>>>8&255,++a),s.writeUInt8(e.byteLength>>>0&255,++a)}this.socket.write(z.concat([s,e]))}end(){this._isEnded=!0,this.socket.end()}_acceptChunk(e){if(e.byteLength!==0){for(this._incomingData.acceptChunk(e);this._incomingData.byteLength>=this._state.readLen;)if(this._state.state===1){const t=this._incomingData.peek(this._state.readLen),i=t.readUInt8(0),r=(i&128)>>>7,s=(i&64)>>>6,n=i&15,o=t.readUInt8(1),a=(o&128)>>>7,l=o&127;this._state.state=2,this._state.readLen=2+(a?4:0)+(l===126?2:0)+(l===127?8:0),this._state.fin=r,this._state.firstFrameOfMessage&&(this._state.compressed=!!s),this._state.firstFrameOfMessage=!!r,this._state.mask=0,this._state.opcode=n,this.traceSocketEvent("webSocketNodeSocketPeekedHeader",{headerSize:this._state.readLen,compressed:this._state.compressed,fin:this._state.fin,opcode:this._state.opcode})}else if(this._state.state===2){const t=this._incomingData.read(this._state.readLen),i=t.readUInt8(1),r=(i&128)>>>7;let s=i&127,n=1;s===126?s=t.readUInt8(++n)*2**8+t.readUInt8(++n):s===127&&(s=t.readUInt8(++n)*0+t.readUInt8(++n)*0+t.readUInt8(++n)*0+t.readUInt8(++n)*0+t.readUInt8(++n)*2**24+t.readUInt8(++n)*2**16+t.readUInt8(++n)*2**8+t.readUInt8(++n));let o=0;r&&(o=t.readUInt8(++n)*2**24+t.readUInt8(++n)*2**16+t.readUInt8(++n)*2**8+t.readUInt8(++n)),this._state.state=3,this._state.readLen=s,this._state.mask=o,this.traceSocketEvent("webSocketNodeSocketPeekedHeader",{bodySize:this._state.readLen,compressed:this._state.compressed,fin:this._state.fin,mask:this._state.mask,opcode:this._state.opcode})}else if(this._state.state===3){const t=this._incomingData.read(this._state.readLen);this.traceSocketEvent("webSocketNodeSocketReadData",t),e2(t,this._state.mask),this.traceSocketEvent("webSocketNodeSocketUnmaskedData",t),this._state.state=1,this._state.readLen=2,this._state.mask=0,this._state.opcode<=2?this._flowManager.acceptFrame(t,this._state.compressed,!!this._state.fin):this._state.opcode===9&&this._flowManager.writeMessage(t,{compressed:!1,opcode:10})}}}async drain(){this.traceSocketEvent("webSocketNodeSocketDrainBegin"),this._flowManager.isProcessingWriteQueue()&&await Fe.toPromise(this._flowManager.onDidFinishProcessingWriteQueue),await this.socket.drain(),this.traceSocketEvent("webSocketNodeSocketDrainEnd")}},XN=class extends X{get permessageDeflate(){return!!(this._zlibInflateStream&&this._zlibDeflateStream)}get recordedInflateBytes(){return this._zlibInflateStream?this._zlibInflateStream.recordedInflateBytes:z.alloc(0)}constructor(e,t,i,r,s,n){super(),this._tracer=e,this._onData=s,this._writeFn=n,this._onError=this._register(new D),this.onError=this._onError.event,this._writeQueue=[],this._readQueue=[],this._onDidFinishProcessingReadQueue=this._register(new D),this.onDidFinishProcessingReadQueue=this._onDidFinishProcessingReadQueue.event,this._onDidFinishProcessingWriteQueue=this._register(new D),this.onDidFinishProcessingWriteQueue=this._onDidFinishProcessingWriteQueue.event,this._isProcessingWriteQueue=!1,this._isProcessingReadQueue=!1,t?(this._zlibInflateStream=this._register(new YN(this._tracer,r,i,{windowBits:15})),this._zlibDeflateStream=this._register(new ZN(this._tracer,{windowBits:15})),this._register(this._zlibInflateStream.onError(o=>this._onError.fire(o))),this._register(this._zlibDeflateStream.onError(o=>this._onError.fire(o)))):(this._zlibInflateStream=null,this._zlibDeflateStream=null)}writeMessage(e,t){this._writeQueue.push({data:e,options:t}),this._processWriteQueue()}async _processWriteQueue(){if(!this._isProcessingWriteQueue){for(this._isProcessingWriteQueue=!0;this._writeQueue.length>0;){const{data:e,options:t}=this._writeQueue.shift();if(this._zlibDeflateStream&&t.compressed){const i=await this._deflateMessage(this._zlibDeflateStream,e);this._writeFn(i,t)}else this._writeFn(e,{...t,compressed:!1})}this._isProcessingWriteQueue=!1,this._onDidFinishProcessingWriteQueue.fire()}}isProcessingWriteQueue(){return this._isProcessingWriteQueue}_deflateMessage(e,t){return new Promise((i,r)=>{e.write(t),e.flush(s=>i(s))})}acceptFrame(e,t,i){this._readQueue.push({data:e,isCompressed:t,isLastFrameOfMessage:i}),this._processReadQueue()}async _processReadQueue(){if(!this._isProcessingReadQueue){for(this._isProcessingReadQueue=!0;this._readQueue.length>0;){const e=this._readQueue.shift();if(this._zlibInflateStream&&e.isCompressed){const t=await this._inflateFrame(this._zlibInflateStream,e.data,e.isLastFrameOfMessage);this._onData.fire(t)}else this._onData.fire(e.data)}this._isProcessingReadQueue=!1,this._onDidFinishProcessingReadQueue.fire()}}isProcessingReadQueue(){return this._isProcessingReadQueue}_inflateFrame(e,t,i){return new Promise((r,s)=>{e.write(t),i&&e.write(z.fromByteArray([0,0,255,255])),e.flush(n=>r(n))})}},YN=class extends X{get recordedInflateBytes(){return this._recordInflateBytes?z.concat(this._recordedInflateBytes):z.alloc(0)}constructor(e,t,i,r){super(),this._tracer=e,this._recordInflateBytes=t,this._onError=this._register(new D),this.onError=this._onError.event,this._recordedInflateBytes=[],this._pendingInflateData=[],this._zlibInflate=QN(r),this._zlibInflate.on("error",s=>{this._tracer.traceSocketEvent("zlibInflateError",{message:s?.message,code:s?.code}),this._onError.fire(s)}),this._zlibInflate.on("data",s=>{this._tracer.traceSocketEvent("zlibInflateData",s),this._pendingInflateData.push(z.wrap(s))}),i&&(this._tracer.traceSocketEvent("zlibInflateInitialWrite",i.buffer),this._zlibInflate.write(i.buffer),this._zlibInflate.flush(()=>{this._tracer.traceSocketEvent("zlibInflateInitialFlushFired"),this._pendingInflateData.length=0}))}write(e){this._recordInflateBytes&&this._recordedInflateBytes.push(e.clone()),this._tracer.traceSocketEvent("zlibInflateWrite",e),this._zlibInflate.write(e.buffer)}flush(e){this._zlibInflate.flush(()=>{this._tracer.traceSocketEvent("zlibInflateFlushFired");const t=z.concat(this._pendingInflateData);this._pendingInflateData.length=0,e(t)})}},ZN=class extends X{constructor(e,t){super(),this._tracer=e,this._onError=this._register(new D),this.onError=this._onError.event,this._pendingDeflateData=[],this._zlibDeflate=GN({windowBits:15}),this._zlibDeflate.on("error",i=>{this._tracer.traceSocketEvent("zlibDeflateError",{message:i?.message,code:i?.code}),this._onError.fire(i)}),this._zlibDeflate.on("data",i=>{this._tracer.traceSocketEvent("zlibDeflateData",i),this._pendingDeflateData.push(z.wrap(i))})}write(e){this._tracer.traceSocketEvent("zlibDeflateWrite",e.buffer),this._zlibDeflate.write(e.buffer)}flush(e){this._zlibDeflate.flush(2,()=>{this._tracer.traceSocketEvent("zlibDeflateFlushFired");let t=z.concat(this._pendingDeflateData);this._pendingDeflateData.length=0,t=t.slice(0,t.byteLength-4),e(t)})}};function e2(e,t){if(t===0)return;const i=e.byteLength>>>2;for(let l=0;l<i;l++){const c=e.readUInt32BE(l*4);e.writeUInt32BE(c^t,l*4)}const r=i*4,s=e.byteLength-r,n=t>>>24&255,o=t>>>16&255,a=t>>>8&255;s>=1&&e.writeUInt8(e.readUInt8(r)^n,r),s>=2&&e.writeUInt8(e.readUInt8(r+1)^o,r+1),s>=3&&e.writeUInt8(e.readUInt8(r+2)^a,r+2)}var nC=process.env.XDG_RUNTIME_DIR,t2={2:107,1:103};function i2(){const e=mt();if(process.platform==="win32")return`\\\\.\\pipe\\vscode-ipc-${e}-sock`;const t=process.platform!=="darwin"&&nC?nC:jN(),i=Xe(t,`vscode-ipc-${e}.sock`);return r2(i),i}function r2(e){const t=t2[IL];typeof t=="number"&&e.length>=t&&console.warn(`WARNING: IPC handle "${e}" is longer than ${t} chars, try a shorter --user-data-dir`)}function Ye(e){if(!e||typeof e!="object"||e instanceof RegExp)return e;const t=Array.isArray(e)?[]:{};return Object.entries(e).forEach(([i,r])=>{t[i]=r&&typeof r=="object"?Ye(r):r}),t}function oC(e){if(!e||typeof e!="object")return e;const t=[e];for(;t.length>0;){const i=t.shift();Object.freeze(i);for(const r in i)if(aC.call(i,r)){const s=i[r];typeof s=="object"&&!Object.isFrozen(s)&&!YR(s)&&t.push(s)}}return e}var aC=Object.prototype.hasOwnProperty;function Ta(e,t){return Yv(e,t,new Set)}function Yv(e,t,i){if(Lt(e))return e;const r=t(e);if(typeof r<"u")return r;if(Array.isArray(e)){const s=[];for(const n of e)s.push(Yv(n,t,i));return s}if(It(e)){if(i.has(e))throw new Error("Cannot clone recursive data-structure");i.add(e);const s={};for(const n in e)aC.call(e,n)&&(s[n]=Yv(e[n],t,i));return i.delete(e),s}return e}function Is(e,t,i=!0){return It(e)?(It(t)&&Object.keys(t).forEach(r=>{r in e?i&&(It(e[r])&&It(t[r])?Is(e[r],t[r],i):e[r]=t[r]):e[r]=t[r]}),e):t}function Ei(e,t){if(e===t)return!0;if(e==null||t===null||t===void 0||typeof e!=typeof t||typeof e!="object"||Array.isArray(e)!==Array.isArray(t))return!1;let i,r;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(!Ei(e[i],t[i]))return!1}else{const s=[];for(r in e)s.push(r);s.sort();const n=[];for(r in t)n.push(r);if(n.sort(),!Ei(s,n))return!1;for(i=0;i<s.length;i++)if(!Ei(e[s[i]],t[s[i]]))return!1}return!0}function s2(e){const t=new Set;return JSON.stringify(e,(i,r)=>{if(It(r)||Array.isArray(r)){if(t.has(r))return"[Circular]";t.add(r)}return typeof r=="bigint"?`[BigInt ${r.toString()}]`:r})}function lC(e,t){const i=t.toLowerCase(),r=Object.keys(e).find(s=>s.toLowerCase()===i);return r?e[r]:e[t]}function cC(e,t){const i=Object.create(null);for(const[r,s]of Object.entries(e))t(r,s)&&(i[r]=s);return i}var uC={tabSize:4,indentSize:4,insertSpaces:!0,detectIndentation:!0,trimAutoWhitespace:!0,largeFileOptimizations:!0,bracketPairColorizationOptions:{enabled:!0,independentColorPoolPerBracketType:!1}},dC="`~!@#$%^&*()-=+[{]}\\|;:'\",.<>/?";function n2(e=""){let t="(-?\\d*\\.\\d\\w*)|([^";for(const i of dC)e.indexOf(i)>=0||(t+="\\"+i);return t+="\\s]+)",new RegExp(t,"g")}var o2=n2();function hC(e){let t=o2;if(e&&e instanceof RegExp)if(e.global)t=e;else{let i="g";e.ignoreCase&&(i+="i"),e.multiline&&(i+="m"),e.unicode&&(i+="u"),t=new RegExp(e.source,i)}return t.lastIndex=0,t}var fC=new hn;fC.unshift({maxLen:1e3,windowSize:15,timeBudget:150});function pC(e,t,i,r,s){if(t=hC(t),s||(s=ai.first(fC)),i.length>s.maxLen){let c=e-s.maxLen/2;return c<0?c=0:r+=c,i=i.substring(c,e+s.maxLen/2),pC(e,t,i,r,s)}const n=Date.now(),o=e-1-r;let a=-1,l=null;for(let c=1;!(Date.now()-n>=s.timeBudget);c++){const u=o-s.windowSize*c;t.lastIndex=Math.max(0,u);const d=a2(t,i,o,a);if(!d&&l||(l=d,u<=0))break;a=u}if(l){const c={word:l[0],startColumn:r+1+l.index,endColumn:r+1+l.index+l[0].length};return t.lastIndex=0,c}return null}function a2(e,t,i,r){let s;for(;s=e.exec(t);){const n=s.index||0;if(n<=i&&e.lastIndex>=i)return s;if(r>0&&n>r)return null}return null}var Vi,Zv=globalThis.vscode;if(typeof Zv<"u"&&typeof Zv.context<"u"){const e=Zv.context.configuration();if(e)Vi=e.product;else throw new Error("Sandbox: unable to resolve product configuration from preload script.")}else if(globalThis._VSCODE_PRODUCT_JSON&&globalThis._VSCODE_PACKAGE_JSON){if(Vi=globalThis._VSCODE_PRODUCT_JSON,gn.VSCODE_DEV&&Object.assign(Vi,{nameShort:`${Vi.nameShort} Dev`,nameLong:`${Vi.nameLong} Dev`,dataFolderName:`${Vi.dataFolderName}-dev`,serverDataFolderName:Vi.serverDataFolderName?`${Vi.serverDataFolderName}-dev`:void 0}),!Vi.version){const e=globalThis._VSCODE_PACKAGE_JSON;Object.assign(Vi,{version:e.version})}}else Vi={},Object.keys(Vi).length===0&&Object.assign(Vi,{version:"1.95.0-dev",nameShort:"Code - OSS Dev",nameLong:"Code - OSS Dev",applicationName:"code-oss",dataFolderName:".vscode-oss",urlProtocol:"code-oss",reportIssueUrl:"https://github.com/microsoft/vscode/issues/new",licenseName:"MIT",licenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt",serverLicenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt"});var l2=Vi,gC;(function(e){e[e.None=0]="None",e[e.Keep=1]="Keep",e[e.Brackets=2]="Brackets",e[e.Advanced=3]="Advanced",e[e.Full=4]="Full"})(gC||(gC={}));var c2=8,u2=class{constructor(){this.stableMinimapLayoutInput=null,this.stableFitMaxMinimapScale=0,this.stableFitRemainingWidth=0}},Ze=class{constructor(e,t,i,r){this.id=e,this.name=t,this.defaultValue=i,this.schema=r}applyUpdate(e,t){return Nh(e,t)}compute(e,t,i){return i}},Lh=class{constructor(e,t){this.newValue=e,this.didChange=t}};function Nh(e,t){if(typeof e!="object"||typeof t!="object"||!e||!t)return new Lh(t,e!==t);if(Array.isArray(e)||Array.isArray(t)){const r=Array.isArray(e)&&Array.isArray(t)&&Er(e,t);return new Lh(t,!r)}let i=!1;for(const r in t)if(t.hasOwnProperty(r)){const s=Nh(e[r],t[r]);s.didChange&&(e[r]=s.newValue,i=!0)}return new Lh(e,i)}var po=class{constructor(e){this.schema=void 0,this.id=e,this.name="_never_",this.defaultValue=void 0}applyUpdate(e,t){return Nh(e,t)}validate(e){return this.defaultValue}},Aa=class{constructor(e,t,i,r){this.id=e,this.name=t,this.defaultValue=i,this.schema=r}applyUpdate(e,t){return Nh(e,t)}validate(e){return typeof e>"u"?this.defaultValue:e}compute(e,t,i){return i}};function Z(e,t){return typeof e>"u"?t:e==="false"?!1:!!e}var ye=class extends Aa{constructor(e,t,i,r=void 0){typeof r<"u"&&(r.type="boolean",r.default=i),super(e,t,i,r)}validate(e){return Z(e,this.defaultValue)}};function d2(e,t,i,r){if(typeof e>"u")return t;let s=parseInt(e,10);return isNaN(s)?t:(s=Math.max(i,s),s=Math.min(r,s),s|0)}var ze=class L9 extends Aa{static clampedInt(t,i,r,s){return d2(t,i,r,s)}constructor(t,i,r,s,n,o=void 0){typeof o<"u"&&(o.type="integer",o.default=r,o.minimum=s,o.maximum=n),super(t,i,r,o),this.minimum=s,this.maximum=n}validate(t){return L9.clampedInt(t,this.defaultValue,this.minimum,this.maximum)}},Zr=class N9 extends Aa{static clamp(t,i,r){return t<i?i:t>r?r:t}static float(t,i){if(typeof t=="number")return t;if(typeof t>"u")return i;const r=parseFloat(t);return isNaN(r)?i:r}constructor(t,i,r,s,n){typeof n<"u"&&(n.type="number",n.default=r),super(t,i,r,n),this.validationFn=s}validate(t){return this.validationFn(N9.float(t,this.defaultValue))}},Ci=class M9 extends Aa{static string(t,i){return typeof t!="string"?i:t}constructor(t,i,r,s=void 0){typeof s<"u"&&(s.type="string",s.default=r),super(t,i,r,s)}validate(t){return M9.string(t,this.defaultValue)}};function ot(e,t,i,r){return typeof e!="string"?t:r&&e in r?r[e]:i.indexOf(e)===-1?t:e}var st=class extends Aa{constructor(e,t,i,r,s=void 0){typeof s<"u"&&(s.type="string",s.enum=r,s.default=i),super(e,t,i,s),this._allowedValues=r}validate(e){return ot(e,this.defaultValue,this._allowedValues)}},Dc=class extends Ze{constructor(e,t,i,r,s,n,o=void 0){typeof o<"u"&&(o.type="string",o.enum=s,o.default=r),super(e,t,i,o),this._allowedValues=s,this._convert=n}validate(e){return typeof e!="string"?this.defaultValue:this._allowedValues.indexOf(e)===-1?this.defaultValue:this._convert(e)}};function h2(e){switch(e){case"none":return 0;case"keep":return 1;case"brackets":return 2;case"advanced":return 3;case"full":return 4}}var f2=class extends Ze{constructor(){super(2,"accessibilitySupport",0,{type:"string",enum:["auto","on","off"],enumDescriptions:[h(319,null),h(320,null),h(321,null)],default:"auto",tags:["accessibility"],description:h(322,null)})}validate(e){switch(e){case"auto":return 0;case"off":return 1;case"on":return 2}return this.defaultValue}compute(e,t,i){return i===0?e.accessibilitySupport:i}},p2=class extends Ze{constructor(){const e={insertSpace:!0,ignoreEmptyLines:!0};super(23,"comments",e,{"editor.comments.insertSpace":{type:"boolean",default:e.insertSpace,description:h(323,null)},"editor.comments.ignoreEmptyLines":{type:"boolean",default:e.ignoreEmptyLines,description:h(324,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{insertSpace:Z(t.insertSpace,this.defaultValue.insertSpace),ignoreEmptyLines:Z(t.ignoreEmptyLines,this.defaultValue.ignoreEmptyLines)}}},mC;(function(e){e[e.Hidden=0]="Hidden",e[e.Blink=1]="Blink",e[e.Smooth=2]="Smooth",e[e.Phase=3]="Phase",e[e.Expand=4]="Expand",e[e.Solid=5]="Solid"})(mC||(mC={}));function g2(e){switch(e){case"blink":return 1;case"smooth":return 2;case"phase":return 3;case"expand":return 4;case"solid":return 5}}var Tr;(function(e){e[e.Line=1]="Line",e[e.Block=2]="Block",e[e.Underline=3]="Underline",e[e.LineThin=4]="LineThin",e[e.BlockOutline=5]="BlockOutline",e[e.UnderlineThin=6]="UnderlineThin"})(Tr||(Tr={}));function vC(e){switch(e){case"line":return Tr.Line;case"block":return Tr.Block;case"underline":return Tr.Underline;case"line-thin":return Tr.LineThin;case"block-outline":return Tr.BlockOutline;case"underline-thin":return Tr.UnderlineThin}}var m2=class extends po{constructor(){super(148)}compute(e,t,i){const r=["monaco-editor"];return t.get(41)&&r.push(t.get(41)),e.extraEditorClassName&&r.push(e.extraEditorClassName),t.get(75)==="default"?r.push("mouse-default"):t.get(75)==="copy"&&r.push("mouse-copy"),t.get(116)&&r.push("showUnused"),t.get(145)&&r.push("showDeprecated"),r.join(" ")}},v2=class extends ye{constructor(){super(38,"emptySelectionClipboard",!0,{description:h(325,null)})}compute(e,t,i){return i&&e.emptySelectionClipboard}},_2=class extends Ze{constructor(){const e={cursorMoveOnType:!0,seedSearchStringFromSelection:"always",autoFindInSelection:"never",globalFindClipboard:!1,addExtraSpaceOnTop:!0,loop:!0,history:"workspace",replaceHistory:"workspace"};super(43,"find",e,{"editor.find.cursorMoveOnType":{type:"boolean",default:e.cursorMoveOnType,description:h(326,null)},"editor.find.seedSearchStringFromSelection":{type:"string",enum:["never","always","selection"],default:e.seedSearchStringFromSelection,enumDescriptions:[h(327,null),h(328,null),h(329,null)],description:h(330,null)},"editor.find.autoFindInSelection":{type:"string",enum:["never","always","multiline"],default:e.autoFindInSelection,enumDescriptions:[h(331,null),h(332,null),h(333,null)],description:h(334,null)},"editor.find.globalFindClipboard":{type:"boolean",default:e.globalFindClipboard,description:h(335,null),included:Mt},"editor.find.addExtraSpaceOnTop":{type:"boolean",default:e.addExtraSpaceOnTop,description:h(336,null)},"editor.find.loop":{type:"boolean",default:e.loop,description:h(337,null)},"editor.find.history":{type:"string",enum:["never","workspace"],default:"workspace",enumDescriptions:[h(338,null),h(339,null)],description:h(340,null)},"editor.find.replaceHistory":{type:"string",enum:["never","workspace"],default:"workspace",enumDescriptions:[h(341,null),h(342,null)],description:h(343,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{cursorMoveOnType:Z(t.cursorMoveOnType,this.defaultValue.cursorMoveOnType),seedSearchStringFromSelection:typeof e.seedSearchStringFromSelection=="boolean"?e.seedSearchStringFromSelection?"always":"never":ot(t.seedSearchStringFromSelection,this.defaultValue.seedSearchStringFromSelection,["never","always","selection"]),autoFindInSelection:typeof e.autoFindInSelection=="boolean"?e.autoFindInSelection?"always":"never":ot(t.autoFindInSelection,this.defaultValue.autoFindInSelection,["never","always","multiline"]),globalFindClipboard:Z(t.globalFindClipboard,this.defaultValue.globalFindClipboard),addExtraSpaceOnTop:Z(t.addExtraSpaceOnTop,this.defaultValue.addExtraSpaceOnTop),loop:Z(t.loop,this.defaultValue.loop),history:ot(t.history,this.defaultValue.history,["never","workspace"]),replaceHistory:ot(t.replaceHistory,this.defaultValue.replaceHistory,["never","workspace"])}}},w2=class Zl extends Ze{static{this.OFF='"liga" off, "calt" off'}static{this.ON='"liga" on, "calt" on'}constructor(){super(53,"fontLigatures",Zl.OFF,{anyOf:[{type:"boolean",description:h(344,null)},{type:"string",description:h(345,null)}],description:h(346,null),default:!1})}validate(t){return typeof t>"u"?this.defaultValue:typeof t=="string"?t==="false"||t.length===0?Zl.OFF:t==="true"?Zl.ON:t:t?Zl.ON:Zl.OFF}},y2=class ec extends Ze{static{this.OFF="normal"}static{this.TRANSLATE="translate"}constructor(){super(56,"fontVariations",ec.OFF,{anyOf:[{type:"boolean",description:h(347,null)},{type:"string",description:h(348,null)}],description:h(349,null),default:!1})}validate(t){return typeof t>"u"?this.defaultValue:typeof t=="string"?t==="false"?ec.OFF:t==="true"?ec.TRANSLATE:t:t?ec.TRANSLATE:ec.OFF}compute(t,i,r){return t.fontInfo.fontVariationSettings}},b2=class extends po{constructor(){super(52)}compute(e,t,i){return e.fontInfo}},S2=class extends po{constructor(){super(147)}compute(e,t,i){return e.inputMode==="overtype"?t.get(84):t.get(28)}},x2=class extends po{constructor(){super(156)}compute(e,t){return e.editContextSupported&&t.get(37)}},E2=class extends Aa{constructor(){super(54,"fontSize",Ts.fontSize,{type:"number",minimum:6,maximum:100,default:Ts.fontSize,description:h(350,null)})}validate(e){const t=Zr.float(e,this.defaultValue);return t===0?Ts.fontSize:Zr.clamp(t,6,100)}compute(e,t,i){return e.fontInfo.fontSize}},C2=class tc extends Ze{static{this.SUGGESTION_VALUES=["normal","bold","100","200","300","400","500","600","700","800","900"]}static{this.MINIMUM_VALUE=1}static{this.MAXIMUM_VALUE=1e3}constructor(){super(55,"fontWeight",Ts.fontWeight,{anyOf:[{type:"number",minimum:tc.MINIMUM_VALUE,maximum:tc.MAXIMUM_VALUE,errorMessage:h(351,null)},{type:"string",pattern:"^(normal|bold|1000|[1-9][0-9]{0,2})$"},{enum:tc.SUGGESTION_VALUES}],default:Ts.fontWeight,description:h(352,null)})}validate(t){return t==="normal"||t==="bold"?t:String(ze.clampedInt(t,Ts.fontWeight,tc.MINIMUM_VALUE,tc.MAXIMUM_VALUE))}},D2=class extends Ze{constructor(){const e={multiple:"peek",multipleDefinitions:"peek",multipleTypeDefinitions:"peek",multipleDeclarations:"peek",multipleImplementations:"peek",multipleReferences:"peek",multipleTests:"peek",alternativeDefinitionCommand:"editor.action.goToReferences",alternativeTypeDefinitionCommand:"editor.action.goToReferences",alternativeDeclarationCommand:"editor.action.goToReferences",alternativeImplementationCommand:"",alternativeReferenceCommand:"",alternativeTestsCommand:""},t={type:"string",enum:["peek","gotoAndPeek","goto"],default:e.multiple,enumDescriptions:[h(353,null),h(354,null),h(355,null)]},i=["","editor.action.referenceSearch.trigger","editor.action.goToReferences","editor.action.peekImplementation","editor.action.goToImplementation","editor.action.peekTypeDefinition","editor.action.goToTypeDefinition","editor.action.peekDeclaration","editor.action.revealDeclaration","editor.action.peekDefinition","editor.action.revealDefinitionAside","editor.action.revealDefinition"];super(60,"gotoLocation",e,{"editor.gotoLocation.multiple":{deprecationMessage:h(356,null)},"editor.gotoLocation.multipleDefinitions":{description:h(357,null),...t},"editor.gotoLocation.multipleTypeDefinitions":{description:h(358,null),...t},"editor.gotoLocation.multipleDeclarations":{description:h(359,null),...t},"editor.gotoLocation.multipleImplementations":{description:h(360,null),...t},"editor.gotoLocation.multipleReferences":{description:h(361,null),...t},"editor.gotoLocation.alternativeDefinitionCommand":{type:"string",default:e.alternativeDefinitionCommand,enum:i,description:h(362,null)},"editor.gotoLocation.alternativeTypeDefinitionCommand":{type:"string",default:e.alternativeTypeDefinitionCommand,enum:i,description:h(363,null)},"editor.gotoLocation.alternativeDeclarationCommand":{type:"string",default:e.alternativeDeclarationCommand,enum:i,description:h(364,null)},"editor.gotoLocation.alternativeImplementationCommand":{type:"string",default:e.alternativeImplementationCommand,enum:i,description:h(365,null)},"editor.gotoLocation.alternativeReferenceCommand":{type:"string",default:e.alternativeReferenceCommand,enum:i,description:h(366,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{multiple:ot(t.multiple,this.defaultValue.multiple,["peek","gotoAndPeek","goto"]),multipleDefinitions:t.multipleDefinitions??ot(t.multipleDefinitions,"peek",["peek","gotoAndPeek","goto"]),multipleTypeDefinitions:t.multipleTypeDefinitions??ot(t.multipleTypeDefinitions,"peek",["peek","gotoAndPeek","goto"]),multipleDeclarations:t.multipleDeclarations??ot(t.multipleDeclarations,"peek",["peek","gotoAndPeek","goto"]),multipleImplementations:t.multipleImplementations??ot(t.multipleImplementations,"peek",["peek","gotoAndPeek","goto"]),multipleReferences:t.multipleReferences??ot(t.multipleReferences,"peek",["peek","gotoAndPeek","goto"]),multipleTests:t.multipleTests??ot(t.multipleTests,"peek",["peek","gotoAndPeek","goto"]),alternativeDefinitionCommand:Ci.string(t.alternativeDefinitionCommand,this.defaultValue.alternativeDefinitionCommand),alternativeTypeDefinitionCommand:Ci.string(t.alternativeTypeDefinitionCommand,this.defaultValue.alternativeTypeDefinitionCommand),alternativeDeclarationCommand:Ci.string(t.alternativeDeclarationCommand,this.defaultValue.alternativeDeclarationCommand),alternativeImplementationCommand:Ci.string(t.alternativeImplementationCommand,this.defaultValue.alternativeImplementationCommand),alternativeReferenceCommand:Ci.string(t.alternativeReferenceCommand,this.defaultValue.alternativeReferenceCommand),alternativeTestsCommand:Ci.string(t.alternativeTestsCommand,this.defaultValue.alternativeTestsCommand)}}},k2=class extends Ze{constructor(){const e={enabled:!0,delay:300,hidingDelay:300,sticky:!0,above:!0};super(62,"hover",e,{"editor.hover.enabled":{type:"boolean",default:e.enabled,description:h(367,null)},"editor.hover.delay":{type:"number",default:e.delay,minimum:0,maximum:1e4,description:h(368,null)},"editor.hover.sticky":{type:"boolean",default:e.sticky,description:h(369,null)},"editor.hover.hidingDelay":{type:"integer",minimum:0,default:e.hidingDelay,description:h(370,null)},"editor.hover.above":{type:"boolean",default:e.above,description:h(371,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:Z(t.enabled,this.defaultValue.enabled),delay:ze.clampedInt(t.delay,this.defaultValue.delay,0,1e4),sticky:Z(t.sticky,this.defaultValue.sticky),hidingDelay:ze.clampedInt(t.hidingDelay,this.defaultValue.hidingDelay,0,6e5),above:Z(t.above,this.defaultValue.above)}}},_C;(function(e){e[e.None=0]="None",e[e.Text=1]="Text",e[e.Blocks=2]="Blocks"})(_C||(_C={}));var I2=class zm extends po{constructor(){super(151)}compute(t,i,r){return zm.computeLayout(i,{memory:t.memory,outerWidth:t.outerWidth,outerHeight:t.outerHeight,isDominatedByLongLines:t.isDominatedByLongLines,lineHeight:t.fontInfo.lineHeight,viewLineCount:t.viewLineCount,lineNumbersDigitCount:t.lineNumbersDigitCount,typicalHalfwidthCharacterWidth:t.fontInfo.typicalHalfwidthCharacterWidth,maxDigitWidth:t.fontInfo.maxDigitWidth,pixelRatio:t.pixelRatio,glyphMarginDecorationLaneCount:t.glyphMarginDecorationLaneCount})}static computeContainedMinimapLineCount(t){const i=t.height/t.lineHeight,r=Math.floor(t.paddingTop/t.lineHeight);let s=Math.floor(t.paddingBottom/t.lineHeight);t.scrollBeyondLastLine&&(s=Math.max(s,i-1));const n=(r+t.viewLineCount+s)/(t.pixelRatio*t.height),o=Math.floor(t.viewLineCount/n);return{typicalViewportLineCount:i,extraLinesBeforeFirstLine:r,extraLinesBeyondLastLine:s,desiredRatio:n,minimapLineCount:o}}static _computeMinimapLayout(t,i){const r=t.outerWidth,s=t.outerHeight,n=t.pixelRatio;if(!t.minimap.enabled)return{renderMinimap:0,minimapLeft:0,minimapWidth:0,minimapHeightIsEditorHeight:!1,minimapIsSampling:!1,minimapScale:1,minimapLineHeight:1,minimapCanvasInnerWidth:0,minimapCanvasInnerHeight:Math.floor(n*s),minimapCanvasOuterWidth:0,minimapCanvasOuterHeight:s};const o=i.stableMinimapLayoutInput,a=o&&t.outerHeight===o.outerHeight&&t.lineHeight===o.lineHeight&&t.typicalHalfwidthCharacterWidth===o.typicalHalfwidthCharacterWidth&&t.pixelRatio===o.pixelRatio&&t.scrollBeyondLastLine===o.scrollBeyondLastLine&&t.paddingTop===o.paddingTop&&t.paddingBottom===o.paddingBottom&&t.minimap.enabled===o.minimap.enabled&&t.minimap.side===o.minimap.side&&t.minimap.size===o.minimap.size&&t.minimap.showSlider===o.minimap.showSlider&&t.minimap.renderCharacters===o.minimap.renderCharacters&&t.minimap.maxColumn===o.minimap.maxColumn&&t.minimap.scale===o.minimap.scale&&t.verticalScrollbarWidth===o.verticalScrollbarWidth&&t.isViewportWrapping===o.isViewportWrapping,l=t.lineHeight,c=t.typicalHalfwidthCharacterWidth,u=t.scrollBeyondLastLine,d=t.minimap.renderCharacters;let f=n>=2?Math.round(t.minimap.scale*2):t.minimap.scale;const p=t.minimap.maxColumn,g=t.minimap.size,v=t.minimap.side,y=t.verticalScrollbarWidth,S=t.viewLineCount,x=t.remainingWidth,P=t.isViewportWrapping,$=d?2:3;let A=Math.floor(n*s);const W=A/n;let G=!1,J=!1,H=$*f,K=f/n,Ee=1;if(g==="fill"||g==="fit"){const{typicalViewportLineCount:ee,extraLinesBeforeFirstLine:_e,extraLinesBeyondLastLine:Re,desiredRatio:be,minimapLineCount:et}=zm.computeContainedMinimapLineCount({viewLineCount:S,scrollBeyondLastLine:u,paddingTop:t.paddingTop,paddingBottom:t.paddingBottom,height:s,lineHeight:l,pixelRatio:n});if(S/et>1)G=!0,J=!0,f=1,H=1,K=f/n;else{let xt=!1,si=f+1;if(g==="fit"){const gi=Math.ceil((_e+S+Re)*H);P&&a&&x<=i.stableFitRemainingWidth?(xt=!0,si=i.stableFitMaxMinimapScale):xt=gi>A}if(g==="fill"||xt){G=!0;const gi=f;H=Math.min(l*n,Math.max(1,Math.floor(1/be))),P&&a&&x<=i.stableFitRemainingWidth&&(si=i.stableFitMaxMinimapScale),f=Math.min(si,Math.max(1,Math.floor(H/$))),f>gi&&(Ee=Math.min(2,f/gi)),K=f/n/Ee,A=Math.ceil(Math.max(ee,_e+S+Re)*H),P?(i.stableMinimapLayoutInput=t,i.stableFitRemainingWidth=x,i.stableFitMaxMinimapScale=f):(i.stableMinimapLayoutInput=null,i.stableFitRemainingWidth=0)}}}const ne=Math.floor(p*K),ct=Math.min(ne,Math.max(0,Math.floor((x-y-2)*K/(c+K)))+c2);let j=Math.floor(n*ct);const B=j/n;j=Math.floor(j*Ee);const te=d?1:2,Y=v==="left"?0:r-ct-y;return{renderMinimap:te,minimapLeft:Y,minimapWidth:ct,minimapHeightIsEditorHeight:G,minimapIsSampling:J,minimapScale:f,minimapLineHeight:H,minimapCanvasInnerWidth:j,minimapCanvasInnerHeight:A,minimapCanvasOuterWidth:B,minimapCanvasOuterHeight:W}}static computeLayout(t,i){const r=i.outerWidth|0,s=i.outerHeight|0,n=i.lineHeight|0,o=i.lineNumbersDigitCount|0,a=i.typicalHalfwidthCharacterWidth,l=i.maxDigitWidth,c=i.pixelRatio,u=i.viewLineCount,d=t.get(142),f=d==="inherit"?t.get(141):d,p=f==="inherit"?t.get(137):f,g=t.get(140),v=i.isDominatedByLongLines,y=t.get(59),S=t.get(69).renderType!==0,x=t.get(70),P=t.get(110),$=t.get(88),A=t.get(74),W=t.get(108),G=W.verticalScrollbarSize,J=W.verticalHasArrows,H=W.arrowSize,K=W.horizontalScrollbarSize,Ee=t.get(45),ne=t.get(115)!=="never";let ct=t.get(67);Ee&&ne&&(ct+=16);let j=0;if(S){const ws=Math.max(o,x);j=Math.round(ws*l)}let B=0;y&&(B=n*i.glyphMarginDecorationLaneCount);let te=0,Y=te+B,ee=Y+j,_e=ee+ct;const Re=r-B-j-ct;let be=!1,et=!1,Zt=-1;f==="inherit"&&v?(be=!0,et=!0):p==="on"||p==="bounded"?et=!0:p==="wordWrapColumn"&&(Zt=g);const xt=zm._computeMinimapLayout({outerWidth:r,outerHeight:s,lineHeight:n,typicalHalfwidthCharacterWidth:a,pixelRatio:c,scrollBeyondLastLine:P,paddingTop:$.top,paddingBottom:$.bottom,minimap:A,verticalScrollbarWidth:G,viewLineCount:u,remainingWidth:Re,isViewportWrapping:et},i.memory||new u2);xt.renderMinimap!==0&&xt.minimapLeft===0&&(te+=xt.minimapWidth,Y+=xt.minimapWidth,ee+=xt.minimapWidth,_e+=xt.minimapWidth);const si=Re-xt.minimapWidth,gi=Math.max(1,Math.floor((si-G-2)/a)),tt=J?H:0;return et&&(Zt=Math.max(1,gi),p==="bounded"&&(Zt=Math.min(Zt,g))),{width:r,height:s,glyphMarginLeft:te,glyphMarginWidth:B,glyphMarginDecorationLaneCount:i.glyphMarginDecorationLaneCount,lineNumbersLeft:Y,lineNumbersWidth:j,decorationsLeft:ee,decorationsWidth:ct,contentLeft:_e,contentWidth:si,minimap:xt,viewportColumn:gi,isWordWrapMinified:be,isViewportWrapping:et,wrappingColumn:Zt,verticalScrollbarWidth:G,horizontalScrollbarHeight:K,overviewRuler:{top:tt,width:G,height:s-2*tt,right:0}}}},P2=class extends Ze{constructor(){super(144,"wrappingStrategy","simple",{"editor.wrappingStrategy":{enumDescriptions:[h(372,null),h(373,null)],type:"string",enum:["simple","advanced"],default:"simple",description:h(374,null)}})}validate(e){return ot(e,"simple",["simple","advanced"])}compute(e,t,i){return t.get(2)===2?"advanced":i}},Ps;(function(e){e.Off="off",e.OnCode="onCode",e.On="on"})(Ps||(Ps={}));var T2=class extends Ze{constructor(){const e={enabled:Ps.OnCode};super(66,"lightbulb",e,{"editor.lightbulb.enabled":{type:"string",enum:[Ps.Off,Ps.OnCode,Ps.On],default:e.enabled,enumDescriptions:[h(375,null),h(376,null),h(377,null)],description:h(378,null)}})}validate(e){return!e||typeof e!="object"?this.defaultValue:{enabled:ot(e.enabled,this.defaultValue.enabled,[Ps.Off,Ps.OnCode,Ps.On])}}},A2=class extends Ze{constructor(){const e={enabled:!0,maxLineCount:5,defaultModel:"outlineModel",scrollWithEditor:!0};super(120,"stickyScroll",e,{"editor.stickyScroll.enabled":{type:"boolean",default:e.enabled,description:h(379,null)},"editor.stickyScroll.maxLineCount":{type:"number",default:e.maxLineCount,minimum:1,maximum:20,description:h(380,null)},"editor.stickyScroll.defaultModel":{type:"string",enum:["outlineModel","foldingProviderModel","indentationModel"],default:e.defaultModel,description:h(381,null)},"editor.stickyScroll.scrollWithEditor":{type:"boolean",default:e.scrollWithEditor,description:h(382,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:Z(t.enabled,this.defaultValue.enabled),maxLineCount:ze.clampedInt(t.maxLineCount,this.defaultValue.maxLineCount,1,20),defaultModel:ot(t.defaultModel,this.defaultValue.defaultModel,["outlineModel","foldingProviderModel","indentationModel"]),scrollWithEditor:Z(t.scrollWithEditor,this.defaultValue.scrollWithEditor)}}},R2=class extends Ze{constructor(){const e={enabled:"on",fontSize:0,fontFamily:"",padding:!1,maximumLength:43};super(146,"inlayHints",e,{"editor.inlayHints.enabled":{type:"string",default:e.enabled,description:h(383,null),enum:["on","onUnlessPressed","offUnlessPressed","off"],markdownEnumDescriptions:[h(384,null),h(385,null,Mt?"Ctrl+Option":"Ctrl+Alt"),h(386,null,Mt?"Ctrl+Option":"Ctrl+Alt"),h(387,null)]},"editor.inlayHints.fontSize":{type:"number",default:e.fontSize,markdownDescription:h(388,null,"`#editor.fontSize#`","`5`")},"editor.inlayHints.fontFamily":{type:"string",default:e.fontFamily,markdownDescription:h(389,null,"`#editor.fontFamily#`")},"editor.inlayHints.padding":{type:"boolean",default:e.padding,description:h(390,null)},"editor.inlayHints.maximumLength":{type:"number",default:e.maximumLength,markdownDescription:h(391,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return typeof t.enabled=="boolean"&&(t.enabled=t.enabled?"on":"off"),{enabled:ot(t.enabled,this.defaultValue.enabled,["on","off","offUnlessPressed","onUnlessPressed"]),fontSize:ze.clampedInt(t.fontSize,this.defaultValue.fontSize,0,100),fontFamily:Ci.string(t.fontFamily,this.defaultValue.fontFamily),padding:Z(t.padding,this.defaultValue.padding),maximumLength:ze.clampedInt(t.maximumLength,this.defaultValue.maximumLength,0,Number.MAX_SAFE_INTEGER)}}},L2=class extends Ze{constructor(){super(67,"lineDecorationsWidth",10)}validate(e){return typeof e=="string"&&/^\d+(\.\d+)?ch$/.test(e)?-parseFloat(e.substring(0,e.length-2)):ze.clampedInt(e,this.defaultValue,0,1e3)}compute(e,t,i){return i<0?ze.clampedInt(-i*e.fontInfo.typicalHalfwidthCharacterWidth,this.defaultValue,0,1e3):i}},N2=class extends Zr{constructor(){super(68,"lineHeight",Ts.lineHeight,e=>Zr.clamp(e,0,150),{markdownDescription:h(392,null)})}compute(e,t,i){return e.fontInfo.lineHeight}},M2=class extends Ze{constructor(){const e={enabled:!1,size:"proportional",side:"right",showSlider:"mouseover",autohide:!1,renderCharacters:!0,maxColumn:120,scale:1,showRegionSectionHeaders:!0,showMarkSectionHeaders:!0,markSectionHeaderRegex:"\\bMARK:\\s*(?<separator>-?)\\s*(?<label>.*)$",sectionHeaderFontSize:9,sectionHeaderLetterSpacing:1};super(74,"minimap",e,{"editor.minimap.enabled":{type:"boolean",default:e.enabled,description:h(393,null)},"editor.minimap.autohide":{type:"boolean",default:e.autohide,description:h(394,null)},"editor.minimap.size":{type:"string",enum:["proportional","fill","fit"],enumDescriptions:[h(395,null),h(396,null),h(397,null)],default:e.size,description:h(398,null)},"editor.minimap.side":{type:"string",enum:["left","right"],default:e.side,description:h(399,null)},"editor.minimap.showSlider":{type:"string",enum:["always","mouseover"],default:e.showSlider,description:h(400,null)},"editor.minimap.scale":{type:"number",default:e.scale,minimum:1,maximum:3,enum:[1,2,3],description:h(401,null)},"editor.minimap.renderCharacters":{type:"boolean",default:e.renderCharacters,description:h(402,null)},"editor.minimap.maxColumn":{type:"number",default:e.maxColumn,description:h(403,null)},"editor.minimap.showRegionSectionHeaders":{type:"boolean",default:e.showRegionSectionHeaders,description:h(404,null)},"editor.minimap.showMarkSectionHeaders":{type:"boolean",default:e.showMarkSectionHeaders,description:h(405,null)},"editor.minimap.markSectionHeaderRegex":{type:"string",default:e.markSectionHeaderRegex,description:h(406,null)},"editor.minimap.sectionHeaderFontSize":{type:"number",default:e.sectionHeaderFontSize,description:h(407,null)},"editor.minimap.sectionHeaderLetterSpacing":{type:"number",default:e.sectionHeaderLetterSpacing,description:h(408,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;let i=this.defaultValue.markSectionHeaderRegex;const r=e.markSectionHeaderRegex;if(typeof r=="string")try{new RegExp(r,"d"),i=r}catch{}return{enabled:Z(t.enabled,this.defaultValue.enabled),autohide:Z(t.autohide,this.defaultValue.autohide),size:ot(t.size,this.defaultValue.size,["proportional","fill","fit"]),side:ot(t.side,this.defaultValue.side,["right","left"]),showSlider:ot(t.showSlider,this.defaultValue.showSlider,["always","mouseover"]),renderCharacters:Z(t.renderCharacters,this.defaultValue.renderCharacters),scale:ze.clampedInt(t.scale,1,1,3),maxColumn:ze.clampedInt(t.maxColumn,this.defaultValue.maxColumn,1,1e4),showRegionSectionHeaders:Z(t.showRegionSectionHeaders,this.defaultValue.showRegionSectionHeaders),showMarkSectionHeaders:Z(t.showMarkSectionHeaders,this.defaultValue.showMarkSectionHeaders),markSectionHeaderRegex:i,sectionHeaderFontSize:Zr.clamp(t.sectionHeaderFontSize??this.defaultValue.sectionHeaderFontSize,4,32),sectionHeaderLetterSpacing:Zr.clamp(t.sectionHeaderLetterSpacing??this.defaultValue.sectionHeaderLetterSpacing,0,5)}}};function O2(e){return e==="ctrlCmd"?Mt?"metaKey":"ctrlKey":"altKey"}var F2=class extends Ze{constructor(){super(88,"padding",{top:0,bottom:0},{"editor.padding.top":{type:"number",default:0,minimum:0,maximum:1e3,description:h(409,null)},"editor.padding.bottom":{type:"number",default:0,minimum:0,maximum:1e3,description:h(410,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{top:ze.clampedInt(t.top,0,0,1e3),bottom:ze.clampedInt(t.bottom,0,0,1e3)}}},$2=class extends Ze{constructor(){const e={enabled:!0,cycle:!0};super(90,"parameterHints",e,{"editor.parameterHints.enabled":{type:"boolean",default:e.enabled,description:h(411,null)},"editor.parameterHints.cycle":{type:"boolean",default:e.cycle,description:h(412,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:Z(t.enabled,this.defaultValue.enabled),cycle:Z(t.cycle,this.defaultValue.cycle)}}},H2=class extends po{constructor(){super(149)}compute(e,t,i){return e.pixelRatio}},U2=class extends Ze{constructor(){super(92,"placeholder",void 0)}validate(e){return typeof e>"u"?this.defaultValue:typeof e=="string"?e:this.defaultValue}},W2=class extends Ze{constructor(){const e={other:"on",comments:"off",strings:"off"},t=[{type:"boolean"},{type:"string",enum:["on","inline","off"],enumDescriptions:[h(413,null),h(414,null),h(415,null)]}];super(94,"quickSuggestions",e,{type:"object",additionalProperties:!1,properties:{strings:{anyOf:t,default:e.strings,description:h(416,null)},comments:{anyOf:t,default:e.comments,description:h(417,null)},other:{anyOf:t,default:e.other,description:h(418,null)}},default:e,markdownDescription:h(419,null,"`#editor.suggestOnTriggerCharacters#`")}),this.defaultValue=e}validate(e){if(typeof e=="boolean"){const l=e?"on":"off";return{comments:l,strings:l,other:l}}if(!e||typeof e!="object")return this.defaultValue;const{other:t,comments:i,strings:r}=e,s=["on","inline","off"];let n,o,a;return typeof t=="boolean"?n=t?"on":"off":n=ot(t,this.defaultValue.other,s),typeof i=="boolean"?o=i?"on":"off":o=ot(i,this.defaultValue.comments,s),typeof r=="boolean"?a=r?"on":"off":a=ot(r,this.defaultValue.strings,s),{other:n,comments:o,strings:a}}},wC;(function(e){e[e.Off=0]="Off",e[e.On=1]="On",e[e.Relative=2]="Relative",e[e.Interval=3]="Interval",e[e.Custom=4]="Custom"})(wC||(wC={}));var B2=class extends Ze{constructor(){super(69,"lineNumbers",{renderType:1,renderFn:null},{type:"string",enum:["off","on","relative","interval"],enumDescriptions:[h(420,null),h(421,null),h(422,null),h(423,null)],default:"on",description:h(424,null)})}validate(e){let t=this.defaultValue.renderType,i=this.defaultValue.renderFn;return typeof e<"u"&&(typeof e=="function"?(t=4,i=e):e==="interval"?t=3:e==="relative"?t=2:e==="on"?t=1:t=0),{renderType:t,renderFn:i}}},V2=class extends Ze{constructor(){const e=[],t={type:"number",description:h(425,null)};super(107,"rulers",e,{type:"array",items:{anyOf:[t,{type:["object"],properties:{column:t,color:{type:"string",description:h(426,null),format:"color-hex"}}}]},default:e,description:h(427,null)})}validate(e){if(Array.isArray(e)){const t=[];for(const i of e)if(typeof i=="number")t.push({column:ze.clampedInt(i,0,0,1e4),color:null});else if(i&&typeof i=="object"){const r=i;t.push({column:ze.clampedInt(r.column,0,0,1e4),color:r.color})}return t.sort((i,r)=>i.column-r.column),t}return this.defaultValue}},z2=class extends Ze{constructor(){super(97,"readOnlyMessage",void 0)}validate(e){return!e||typeof e!="object"?this.defaultValue:e}};function yC(e,t){if(typeof e!="string")return t;switch(e){case"hidden":return 2;case"visible":return 3;default:return 1}}var q2=class extends Ze{constructor(){const e={vertical:1,horizontal:1,arrowSize:11,useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,horizontalScrollbarSize:12,horizontalSliderSize:12,verticalScrollbarSize:14,verticalSliderSize:14,handleMouseWheel:!0,alwaysConsumeMouseWheel:!0,scrollByPage:!1,ignoreHorizontalScrollbarInContentHeight:!1};super(108,"scrollbar",e,{"editor.scrollbar.vertical":{type:"string",enum:["auto","visible","hidden"],enumDescriptions:[h(428,null),h(429,null),h(430,null)],default:"auto",description:h(431,null)},"editor.scrollbar.horizontal":{type:"string",enum:["auto","visible","hidden"],enumDescriptions:[h(432,null),h(433,null),h(434,null)],default:"auto",description:h(435,null)},"editor.scrollbar.verticalScrollbarSize":{type:"number",default:e.verticalScrollbarSize,description:h(436,null)},"editor.scrollbar.horizontalScrollbarSize":{type:"number",default:e.horizontalScrollbarSize,description:h(437,null)},"editor.scrollbar.scrollByPage":{type:"boolean",default:e.scrollByPage,description:h(438,null)},"editor.scrollbar.ignoreHorizontalScrollbarInContentHeight":{type:"boolean",default:e.ignoreHorizontalScrollbarInContentHeight,description:h(439,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e,i=ze.clampedInt(t.horizontalScrollbarSize,this.defaultValue.horizontalScrollbarSize,0,1e3),r=ze.clampedInt(t.verticalScrollbarSize,this.defaultValue.verticalScrollbarSize,0,1e3);return{arrowSize:ze.clampedInt(t.arrowSize,this.defaultValue.arrowSize,0,1e3),vertical:yC(t.vertical,this.defaultValue.vertical),horizontal:yC(t.horizontal,this.defaultValue.horizontal),useShadows:Z(t.useShadows,this.defaultValue.useShadows),verticalHasArrows:Z(t.verticalHasArrows,this.defaultValue.verticalHasArrows),horizontalHasArrows:Z(t.horizontalHasArrows,this.defaultValue.horizontalHasArrows),handleMouseWheel:Z(t.handleMouseWheel,this.defaultValue.handleMouseWheel),alwaysConsumeMouseWheel:Z(t.alwaysConsumeMouseWheel,this.defaultValue.alwaysConsumeMouseWheel),horizontalScrollbarSize:i,horizontalSliderSize:ze.clampedInt(t.horizontalSliderSize,i,0,1e3),verticalScrollbarSize:r,verticalSliderSize:ze.clampedInt(t.verticalSliderSize,r,0,1e3),scrollByPage:Z(t.scrollByPage,this.defaultValue.scrollByPage),ignoreHorizontalScrollbarInContentHeight:Z(t.ignoreHorizontalScrollbarInContentHeight,this.defaultValue.ignoreHorizontalScrollbarInContentHeight)}}},Ar="inUntrustedWorkspace",go={allowedCharacters:"editor.unicodeHighlight.allowedCharacters",invisibleCharacters:"editor.unicodeHighlight.invisibleCharacters",nonBasicASCII:"editor.unicodeHighlight.nonBasicASCII",ambiguousCharacters:"editor.unicodeHighlight.ambiguousCharacters",includeComments:"editor.unicodeHighlight.includeComments",includeStrings:"editor.unicodeHighlight.includeStrings",allowedLocales:"editor.unicodeHighlight.allowedLocales"},j2=class extends Ze{constructor(){const e={nonBasicASCII:Ar,invisibleCharacters:!0,ambiguousCharacters:!0,includeComments:Ar,includeStrings:!0,allowedCharacters:{},allowedLocales:{_os:!0,_vscode:!0}};super(130,"unicodeHighlight",e,{[go.nonBasicASCII]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,Ar],default:e.nonBasicASCII,description:h(440,null)},[go.invisibleCharacters]:{restricted:!0,type:"boolean",default:e.invisibleCharacters,description:h(441,null)},[go.ambiguousCharacters]:{restricted:!0,type:"boolean",default:e.ambiguousCharacters,description:h(442,null)},[go.includeComments]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,Ar],default:e.includeComments,description:h(443,null)},[go.includeStrings]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,Ar],default:e.includeStrings,description:h(444,null)},[go.allowedCharacters]:{restricted:!0,type:"object",default:e.allowedCharacters,description:h(445,null),additionalProperties:{type:"boolean"}},[go.allowedLocales]:{restricted:!0,type:"object",additionalProperties:{type:"boolean"},default:e.allowedLocales,description:h(446,null)}})}applyUpdate(e,t){let i=!1;t.allowedCharacters&&e&&(Ei(e.allowedCharacters,t.allowedCharacters)||(e={...e,allowedCharacters:t.allowedCharacters},i=!0)),t.allowedLocales&&e&&(Ei(e.allowedLocales,t.allowedLocales)||(e={...e,allowedLocales:t.allowedLocales},i=!0));const r=super.applyUpdate(e,t);return i?new Lh(r.newValue,!0):r}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{nonBasicASCII:Ra(t.nonBasicASCII,Ar,[!0,!1,Ar]),invisibleCharacters:Z(t.invisibleCharacters,this.defaultValue.invisibleCharacters),ambiguousCharacters:Z(t.ambiguousCharacters,this.defaultValue.ambiguousCharacters),includeComments:Ra(t.includeComments,Ar,[!0,!1,Ar]),includeStrings:Ra(t.includeStrings,Ar,[!0,!1,Ar]),allowedCharacters:this.validateBooleanMap(e.allowedCharacters,this.defaultValue.allowedCharacters),allowedLocales:this.validateBooleanMap(e.allowedLocales,this.defaultValue.allowedLocales)}}validateBooleanMap(e,t){if(typeof e!="object"||!e)return t;const i={};for(const[r,s]of Object.entries(e))s===!0&&(i[r]=!0);return i}},G2=class extends Ze{constructor(){const e={enabled:!0,mode:"subwordSmart",showToolbar:"onHover",suppressSuggestions:!1,keepOnBlur:!1,fontFamily:"default",syntaxHighlightingEnabled:!0,edits:{enabled:!0,showCollapsed:!1,renderSideBySide:"auto",allowCodeShifting:"always",useMultiLineGhostText:!0}};super(64,"inlineSuggest",e,{"editor.inlineSuggest.enabled":{type:"boolean",default:e.enabled,description:h(447,null)},"editor.inlineSuggest.showToolbar":{type:"string",default:e.showToolbar,enum:["always","onHover","never"],enumDescriptions:[h(448,null),h(449,null),h(450,null)],description:h(451,null)},"editor.inlineSuggest.syntaxHighlightingEnabled":{type:"boolean",default:e.syntaxHighlightingEnabled,description:h(452,null)},"editor.inlineSuggest.suppressSuggestions":{type:"boolean",default:e.suppressSuggestions,description:h(453,null)},"editor.inlineSuggest.fontFamily":{type:"string",default:e.fontFamily,description:h(454,null)},"editor.inlineSuggest.edits.allowCodeShifting":{type:"string",default:e.edits.allowCodeShifting,description:h(455,null),enum:["always","horizontal","never"],tags:["nextEditSuggestions"]},"editor.inlineSuggest.edits.renderSideBySide":{type:"string",default:e.edits.renderSideBySide,description:h(456,null),enum:["auto","never"],enumDescriptions:[h(457,null),h(458,null)],tags:["nextEditSuggestions"]},"editor.inlineSuggest.edits.showCollapsed":{type:"boolean",default:e.edits.showCollapsed,description:h(459,null),tags:["nextEditSuggestions"]}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:Z(t.enabled,this.defaultValue.enabled),mode:ot(t.mode,this.defaultValue.mode,["prefix","subword","subwordSmart"]),showToolbar:ot(t.showToolbar,this.defaultValue.showToolbar,["always","onHover","never"]),suppressSuggestions:Z(t.suppressSuggestions,this.defaultValue.suppressSuggestions),keepOnBlur:Z(t.keepOnBlur,this.defaultValue.keepOnBlur),fontFamily:Ci.string(t.fontFamily,this.defaultValue.fontFamily),syntaxHighlightingEnabled:Z(t.syntaxHighlightingEnabled,this.defaultValue.syntaxHighlightingEnabled),edits:{enabled:Z(t.edits?.enabled,this.defaultValue.edits.enabled),showCollapsed:Z(t.edits?.showCollapsed,this.defaultValue.edits.showCollapsed),allowCodeShifting:ot(t.edits?.allowCodeShifting,this.defaultValue.edits.allowCodeShifting,["always","horizontal","never"]),renderSideBySide:ot(t.edits?.renderSideBySide,this.defaultValue.edits.renderSideBySide,["never","auto"]),useMultiLineGhostText:Z(t.edits?.useMultiLineGhostText,this.defaultValue.edits.useMultiLineGhostText)}}}},Q2=class extends Ze{constructor(){const e={enabled:uC.bracketPairColorizationOptions.enabled,independentColorPoolPerBracketType:uC.bracketPairColorizationOptions.independentColorPoolPerBracketType};super(15,"bracketPairColorization",e,{"editor.bracketPairColorization.enabled":{type:"boolean",default:e.enabled,markdownDescription:h(460,null,"`#workbench.colorCustomizations#`")},"editor.bracketPairColorization.independentColorPoolPerBracketType":{type:"boolean",default:e.independentColorPoolPerBracketType,description:h(461,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:Z(t.enabled,this.defaultValue.enabled),independentColorPoolPerBracketType:Z(t.independentColorPoolPerBracketType,this.defaultValue.independentColorPoolPerBracketType)}}},J2=class extends Ze{constructor(){const e={bracketPairs:!1,bracketPairsHorizontal:"active",highlightActiveBracketPair:!0,indentation:!0,highlightActiveIndentation:!0};super(16,"guides",e,{"editor.guides.bracketPairs":{type:["boolean","string"],enum:[!0,"active",!1],enumDescriptions:[h(462,null),h(463,null),h(464,null)],default:e.bracketPairs,description:h(465,null)},"editor.guides.bracketPairsHorizontal":{type:["boolean","string"],enum:[!0,"active",!1],enumDescriptions:[h(466,null),h(467,null),h(468,null)],default:e.bracketPairsHorizontal,description:h(469,null)},"editor.guides.highlightActiveBracketPair":{type:"boolean",default:e.highlightActiveBracketPair,description:h(470,null)},"editor.guides.indentation":{type:"boolean",default:e.indentation,description:h(471,null)},"editor.guides.highlightActiveIndentation":{type:["boolean","string"],enum:[!0,"always",!1],enumDescriptions:[h(472,null),h(473,null),h(474,null)],default:e.highlightActiveIndentation,description:h(475,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{bracketPairs:Ra(t.bracketPairs,this.defaultValue.bracketPairs,[!0,!1,"active"]),bracketPairsHorizontal:Ra(t.bracketPairsHorizontal,this.defaultValue.bracketPairsHorizontal,[!0,!1,"active"]),highlightActiveBracketPair:Z(t.highlightActiveBracketPair,this.defaultValue.highlightActiveBracketPair),indentation:Z(t.indentation,this.defaultValue.indentation),highlightActiveIndentation:Ra(t.highlightActiveIndentation,this.defaultValue.highlightActiveIndentation,[!0,!1,"always"])}}};function Ra(e,t,i){const r=i.indexOf(e);return r===-1?t:i[r]}var K2=class extends Ze{constructor(){const e={insertMode:"insert",filterGraceful:!0,snippetsPreventQuickSuggestions:!1,localityBonus:!1,shareSuggestSelections:!1,selectionMode:"always",showIcons:!0,showStatusBar:!1,preview:!1,previewMode:"subwordSmart",showInlineDetails:!0,showMethods:!0,showFunctions:!0,showConstructors:!0,showDeprecated:!0,matchOnWordStartOnly:!0,showFields:!0,showVariables:!0,showClasses:!0,showStructs:!0,showInterfaces:!0,showModules:!0,showProperties:!0,showEvents:!0,showOperators:!0,showUnits:!0,showValues:!0,showConstants:!0,showEnums:!0,showEnumMembers:!0,showKeywords:!0,showWords:!0,showColors:!0,showFiles:!0,showReferences:!0,showFolders:!0,showTypeParameters:!0,showSnippets:!0,showUsers:!0,showIssues:!0};super(123,"suggest",e,{"editor.suggest.insertMode":{type:"string",enum:["insert","replace"],enumDescriptions:[h(476,null),h(477,null)],default:e.insertMode,description:h(478,null)},"editor.suggest.filterGraceful":{type:"boolean",default:e.filterGraceful,description:h(479,null)},"editor.suggest.localityBonus":{type:"boolean",default:e.localityBonus,description:h(480,null)},"editor.suggest.shareSuggestSelections":{type:"boolean",default:e.shareSuggestSelections,markdownDescription:h(481,null)},"editor.suggest.selectionMode":{type:"string",enum:["always","never","whenTriggerCharacter","whenQuickSuggestion"],enumDescriptions:[h(482,null),h(483,null),h(484,null),h(485,null)],default:e.selectionMode,markdownDescription:h(486,null,"`#editor.quickSuggestions#`","`#editor.suggestOnTriggerCharacters#`")},"editor.suggest.snippetsPreventQuickSuggestions":{type:"boolean",default:e.snippetsPreventQuickSuggestions,description:h(487,null)},"editor.suggest.showIcons":{type:"boolean",default:e.showIcons,description:h(488,null)},"editor.suggest.showStatusBar":{type:"boolean",default:e.showStatusBar,description:h(489,null)},"editor.suggest.preview":{type:"boolean",default:e.preview,description:h(490,null)},"editor.suggest.showInlineDetails":{type:"boolean",default:e.showInlineDetails,description:h(491,null)},"editor.suggest.maxVisibleSuggestions":{type:"number",deprecationMessage:h(492,null)},"editor.suggest.filteredTypes":{type:"object",deprecationMessage:h(493,null)},"editor.suggest.showMethods":{type:"boolean",default:!0,markdownDescription:h(494,null)},"editor.suggest.showFunctions":{type:"boolean",default:!0,markdownDescription:h(495,null)},"editor.suggest.showConstructors":{type:"boolean",default:!0,markdownDescription:h(496,null)},"editor.suggest.showDeprecated":{type:"boolean",default:!0,markdownDescription:h(497,null)},"editor.suggest.matchOnWordStartOnly":{type:"boolean",default:!0,markdownDescription:h(498,null)},"editor.suggest.showFields":{type:"boolean",default:!0,markdownDescription:h(499,null)},"editor.suggest.showVariables":{type:"boolean",default:!0,markdownDescription:h(500,null)},"editor.suggest.showClasses":{type:"boolean",default:!0,markdownDescription:h(501,null)},"editor.suggest.showStructs":{type:"boolean",default:!0,markdownDescription:h(502,null)},"editor.suggest.showInterfaces":{type:"boolean",default:!0,markdownDescription:h(503,null)},"editor.suggest.showModules":{type:"boolean",default:!0,markdownDescription:h(504,null)},"editor.suggest.showProperties":{type:"boolean",default:!0,markdownDescription:h(505,null)},"editor.suggest.showEvents":{type:"boolean",default:!0,markdownDescription:h(506,null)},"editor.suggest.showOperators":{type:"boolean",default:!0,markdownDescription:h(507,null)},"editor.suggest.showUnits":{type:"boolean",default:!0,markdownDescription:h(508,null)},"editor.suggest.showValues":{type:"boolean",default:!0,markdownDescription:h(509,null)},"editor.suggest.showConstants":{type:"boolean",default:!0,markdownDescription:h(510,null)},"editor.suggest.showEnums":{type:"boolean",default:!0,markdownDescription:h(511,null)},"editor.suggest.showEnumMembers":{type:"boolean",default:!0,markdownDescription:h(512,null)},"editor.suggest.showKeywords":{type:"boolean",default:!0,markdownDescription:h(513,null)},"editor.suggest.showWords":{type:"boolean",default:!0,markdownDescription:h(514,null)},"editor.suggest.showColors":{type:"boolean",default:!0,markdownDescription:h(515,null)},"editor.suggest.showFiles":{type:"boolean",default:!0,markdownDescription:h(516,null)},"editor.suggest.showReferences":{type:"boolean",default:!0,markdownDescription:h(517,null)},"editor.suggest.showCustomcolors":{type:"boolean",default:!0,markdownDescription:h(518,null)},"editor.suggest.showFolders":{type:"boolean",default:!0,markdownDescription:h(519,null)},"editor.suggest.showTypeParameters":{type:"boolean",default:!0,markdownDescription:h(520,null)},"editor.suggest.showSnippets":{type:"boolean",default:!0,markdownDescription:h(521,null)},"editor.suggest.showUsers":{type:"boolean",default:!0,markdownDescription:h(522,null)},"editor.suggest.showIssues":{type:"boolean",default:!0,markdownDescription:h(523,null)}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{insertMode:ot(t.insertMode,this.defaultValue.insertMode,["insert","replace"]),filterGraceful:Z(t.filterGraceful,this.defaultValue.filterGraceful),snippetsPreventQuickSuggestions:Z(t.snippetsPreventQuickSuggestions,this.defaultValue.filterGraceful),localityBonus:Z(t.localityBonus,this.defaultValue.localityBonus),shareSuggestSelections:Z(t.shareSuggestSelections,this.defaultValue.shareSuggestSelections),selectionMode:ot(t.selectionMode,this.defaultValue.selectionMode,["always","never","whenQuickSuggestion","whenTriggerCharacter"]),showIcons:Z(t.showIcons,this.defaultValue.showIcons),showStatusBar:Z(t.showStatusBar,this.defaultValue.showStatusBar),preview:Z(t.preview,this.defaultValue.preview),previewMode:ot(t.previewMode,this.defaultValue.previewMode,["prefix","subword","subwordSmart"]),showInlineDetails:Z(t.showInlineDetails,this.defaultValue.showInlineDetails),showMethods:Z(t.showMethods,this.defaultValue.showMethods),showFunctions:Z(t.showFunctions,this.defaultValue.showFunctions),showConstructors:Z(t.showConstructors,this.defaultValue.showConstructors),showDeprecated:Z(t.showDeprecated,this.defaultValue.showDeprecated),matchOnWordStartOnly:Z(t.matchOnWordStartOnly,this.defaultValue.matchOnWordStartOnly),showFields:Z(t.showFields,this.defaultValue.showFields),showVariables:Z(t.showVariables,this.defaultValue.showVariables),showClasses:Z(t.showClasses,this.defaultValue.showClasses),showStructs:Z(t.showStructs,this.defaultValue.showStructs),showInterfaces:Z(t.showInterfaces,this.defaultValue.showInterfaces),showModules:Z(t.showModules,this.defaultValue.showModules),showProperties:Z(t.showProperties,this.defaultValue.showProperties),showEvents:Z(t.showEvents,this.defaultValue.showEvents),showOperators:Z(t.showOperators,this.defaultValue.showOperators),showUnits:Z(t.showUnits,this.defaultValue.showUnits),showValues:Z(t.showValues,this.defaultValue.showValues),showConstants:Z(t.showConstants,this.defaultValue.showConstants),showEnums:Z(t.showEnums,this.defaultValue.showEnums),showEnumMembers:Z(t.showEnumMembers,this.defaultValue.showEnumMembers),showKeywords:Z(t.showKeywords,this.defaultValue.showKeywords),showWords:Z(t.showWords,this.defaultValue.showWords),showColors:Z(t.showColors,this.defaultValue.showColors),showFiles:Z(t.showFiles,this.defaultValue.showFiles),showReferences:Z(t.showReferences,this.defaultValue.showReferences),showFolders:Z(t.showFolders,this.defaultValue.showFolders),showTypeParameters:Z(t.showTypeParameters,this.defaultValue.showTypeParameters),showSnippets:Z(t.showSnippets,this.defaultValue.showSnippets),showUsers:Z(t.showUsers,this.defaultValue.showUsers),showIssues:Z(t.showIssues,this.defaultValue.showIssues)}}},X2=class extends Ze{constructor(){super(118,"smartSelect",{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},{"editor.smartSelect.selectLeadingAndTrailingWhitespace":{description:h(524,null),default:!0,type:"boolean"},"editor.smartSelect.selectSubwords":{description:h(525,null),default:!0,type:"boolean"}})}validate(e){return!e||typeof e!="object"?this.defaultValue:{selectLeadingAndTrailingWhitespace:Z(e.selectLeadingAndTrailingWhitespace,this.defaultValue.selectLeadingAndTrailingWhitespace),selectSubwords:Z(e.selectSubwords,this.defaultValue.selectSubwords)}}},Y2=class extends Ze{constructor(){const e=[];super(135,"wordSegmenterLocales",e,{anyOf:[{description:h(526,null),type:"string"},{description:h(527,null),type:"array",items:{type:"string"}}]})}validate(e){if(typeof e=="string"&&(e=[e]),Array.isArray(e)){const t=[];for(const i of e)if(typeof i=="string")try{Intl.Segmenter.supportedLocalesOf(i).length>0&&t.push(i)}catch{}return t}return this.defaultValue}},bC;(function(e){e[e.None=0]="None",e[e.Same=1]="Same",e[e.Indent=2]="Indent",e[e.DeepIndent=3]="DeepIndent"})(bC||(bC={}));var Z2=class extends Ze{constructor(){super(143,"wrappingIndent",1,{"editor.wrappingIndent":{type:"string",enum:["none","same","indent","deepIndent"],enumDescriptions:[h(528,null),h(529,null),h(530,null),h(531,null)],description:h(532,null),default:"same"}})}validate(e){switch(e){case"none":return 0;case"same":return 1;case"indent":return 2;case"deepIndent":return 3}return 1}compute(e,t,i){return t.get(2)===2?0:i}},eM=class extends po{constructor(){super(152)}compute(e,t,i){const r=t.get(151);return{isDominatedByLongLines:e.isDominatedByLongLines,isWordWrapMinified:r.isWordWrapMinified,isViewportWrapping:r.isViewportWrapping,wrappingColumn:r.wrappingColumn}}},tM=class extends Ze{constructor(){const e={enabled:!0,showDropSelector:"afterDrop"};super(36,"dropIntoEditor",e,{"editor.dropIntoEditor.enabled":{type:"boolean",default:e.enabled,markdownDescription:h(533,null)},"editor.dropIntoEditor.showDropSelector":{type:"string",markdownDescription:h(534,null),enum:["afterDrop","never"],enumDescriptions:[h(535,null),h(536,null)],default:"afterDrop"}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:Z(t.enabled,this.defaultValue.enabled),showDropSelector:ot(t.showDropSelector,this.defaultValue.showDropSelector,["afterDrop","never"])}}},iM=class extends Ze{constructor(){const e={enabled:!0,showPasteSelector:"afterPaste"};super(89,"pasteAs",e,{"editor.pasteAs.enabled":{type:"boolean",default:e.enabled,markdownDescription:h(537,null)},"editor.pasteAs.showPasteSelector":{type:"string",markdownDescription:h(538,null),enum:["afterPaste","never"],enumDescriptions:[h(539,null),h(540,null)],default:"afterPaste"}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:Z(t.enabled,this.defaultValue.enabled),showPasteSelector:ot(t.showPasteSelector,this.defaultValue.showPasteSelector,["afterPaste","never"])}}},rM="Consolas, 'Courier New', monospace",sM="Menlo, Monaco, 'Courier New', monospace",nM="'Droid Sans Mono', 'monospace', monospace",Ts={fontFamily:Mt?sM:Ct?nM:rM,fontWeight:"normal",fontSize:Mt?12:14,lineHeight:0,letterSpacing:0},oM=[];function R(e){return oM[e.id]=e,e}var SC;(function(e){e[e.acceptSuggestionOnCommitCharacter=0]="acceptSuggestionOnCommitCharacter",e[e.acceptSuggestionOnEnter=1]="acceptSuggestionOnEnter",e[e.accessibilitySupport=2]="accessibilitySupport",e[e.accessibilityPageSize=3]="accessibilityPageSize",e[e.ariaLabel=4]="ariaLabel",e[e.ariaRequired=5]="ariaRequired",e[e.autoClosingBrackets=6]="autoClosingBrackets",e[e.autoClosingComments=7]="autoClosingComments",e[e.screenReaderAnnounceInlineSuggestion=8]="screenReaderAnnounceInlineSuggestion",e[e.autoClosingDelete=9]="autoClosingDelete",e[e.autoClosingOvertype=10]="autoClosingOvertype",e[e.autoClosingQuotes=11]="autoClosingQuotes",e[e.autoIndent=12]="autoIndent",e[e.automaticLayout=13]="automaticLayout",e[e.autoSurround=14]="autoSurround",e[e.bracketPairColorization=15]="bracketPairColorization",e[e.guides=16]="guides",e[e.codeLens=17]="codeLens",e[e.codeLensFontFamily=18]="codeLensFontFamily",e[e.codeLensFontSize=19]="codeLensFontSize",e[e.colorDecorators=20]="colorDecorators",e[e.colorDecoratorsLimit=21]="colorDecoratorsLimit",e[e.columnSelection=22]="columnSelection",e[e.comments=23]="comments",e[e.contextmenu=24]="contextmenu",e[e.copyWithSyntaxHighlighting=25]="copyWithSyntaxHighlighting",e[e.cursorBlinking=26]="cursorBlinking",e[e.cursorSmoothCaretAnimation=27]="cursorSmoothCaretAnimation",e[e.cursorStyle=28]="cursorStyle",e[e.cursorSurroundingLines=29]="cursorSurroundingLines",e[e.cursorSurroundingLinesStyle=30]="cursorSurroundingLinesStyle",e[e.cursorWidth=31]="cursorWidth",e[e.disableLayerHinting=32]="disableLayerHinting",e[e.disableMonospaceOptimizations=33]="disableMonospaceOptimizations",e[e.domReadOnly=34]="domReadOnly",e[e.dragAndDrop=35]="dragAndDrop",e[e.dropIntoEditor=36]="dropIntoEditor",e[e.experimentalEditContextEnabled=37]="experimentalEditContextEnabled",e[e.emptySelectionClipboard=38]="emptySelectionClipboard",e[e.experimentalGpuAcceleration=39]="experimentalGpuAcceleration",e[e.experimentalWhitespaceRendering=40]="experimentalWhitespaceRendering",e[e.extraEditorClassName=41]="extraEditorClassName",e[e.fastScrollSensitivity=42]="fastScrollSensitivity",e[e.find=43]="find",e[e.fixedOverflowWidgets=44]="fixedOverflowWidgets",e[e.folding=45]="folding",e[e.foldingStrategy=46]="foldingStrategy",e[e.foldingHighlight=47]="foldingHighlight",e[e.foldingImportsByDefault=48]="foldingImportsByDefault",e[e.foldingMaximumRegions=49]="foldingMaximumRegions",e[e.unfoldOnClickAfterEndOfLine=50]="unfoldOnClickAfterEndOfLine",e[e.fontFamily=51]="fontFamily",e[e.fontInfo=52]="fontInfo",e[e.fontLigatures=53]="fontLigatures",e[e.fontSize=54]="fontSize",e[e.fontWeight=55]="fontWeight",e[e.fontVariations=56]="fontVariations",e[e.formatOnPaste=57]="formatOnPaste",e[e.formatOnType=58]="formatOnType",e[e.glyphMargin=59]="glyphMargin",e[e.gotoLocation=60]="gotoLocation",e[e.hideCursorInOverviewRuler=61]="hideCursorInOverviewRuler",e[e.hover=62]="hover",e[e.inDiffEditor=63]="inDiffEditor",e[e.inlineSuggest=64]="inlineSuggest",e[e.letterSpacing=65]="letterSpacing",e[e.lightbulb=66]="lightbulb",e[e.lineDecorationsWidth=67]="lineDecorationsWidth",e[e.lineHeight=68]="lineHeight",e[e.lineNumbers=69]="lineNumbers",e[e.lineNumbersMinChars=70]="lineNumbersMinChars",e[e.linkedEditing=71]="linkedEditing",e[e.links=72]="links",e[e.matchBrackets=73]="matchBrackets",e[e.minimap=74]="minimap",e[e.mouseStyle=75]="mouseStyle",e[e.mouseWheelScrollSensitivity=76]="mouseWheelScrollSensitivity",e[e.mouseWheelZoom=77]="mouseWheelZoom",e[e.multiCursorMergeOverlapping=78]="multiCursorMergeOverlapping",e[e.multiCursorModifier=79]="multiCursorModifier",e[e.multiCursorPaste=80]="multiCursorPaste",e[e.multiCursorLimit=81]="multiCursorLimit",e[e.occurrencesHighlight=82]="occurrencesHighlight",e[e.occurrencesHighlightDelay=83]="occurrencesHighlightDelay",e[e.overtypeCursorStyle=84]="overtypeCursorStyle",e[e.overtypeOnPaste=85]="overtypeOnPaste",e[e.overviewRulerBorder=86]="overviewRulerBorder",e[e.overviewRulerLanes=87]="overviewRulerLanes",e[e.padding=88]="padding",e[e.pasteAs=89]="pasteAs",e[e.parameterHints=90]="parameterHints",e[e.peekWidgetDefaultFocus=91]="peekWidgetDefaultFocus",e[e.placeholder=92]="placeholder",e[e.definitionLinkOpensInPeek=93]="definitionLinkOpensInPeek",e[e.quickSuggestions=94]="quickSuggestions",e[e.quickSuggestionsDelay=95]="quickSuggestionsDelay",e[e.readOnly=96]="readOnly",e[e.readOnlyMessage=97]="readOnlyMessage",e[e.renameOnType=98]="renameOnType",e[e.renderControlCharacters=99]="renderControlCharacters",e[e.renderFinalNewline=100]="renderFinalNewline",e[e.renderLineHighlight=101]="renderLineHighlight",e[e.renderLineHighlightOnlyWhenFocus=102]="renderLineHighlightOnlyWhenFocus",e[e.renderValidationDecorations=103]="renderValidationDecorations",e[e.renderWhitespace=104]="renderWhitespace",e[e.revealHorizontalRightPadding=105]="revealHorizontalRightPadding",e[e.roundedSelection=106]="roundedSelection",e[e.rulers=107]="rulers",e[e.scrollbar=108]="scrollbar",e[e.scrollBeyondLastColumn=109]="scrollBeyondLastColumn",e[e.scrollBeyondLastLine=110]="scrollBeyondLastLine",e[e.scrollPredominantAxis=111]="scrollPredominantAxis",e[e.selectionClipboard=112]="selectionClipboard",e[e.selectionHighlight=113]="selectionHighlight",e[e.selectOnLineNumbers=114]="selectOnLineNumbers",e[e.showFoldingControls=115]="showFoldingControls",e[e.showUnused=116]="showUnused",e[e.snippetSuggestions=117]="snippetSuggestions",e[e.smartSelect=118]="smartSelect",e[e.smoothScrolling=119]="smoothScrolling",e[e.stickyScroll=120]="stickyScroll",e[e.stickyTabStops=121]="stickyTabStops",e[e.stopRenderingLineAfter=122]="stopRenderingLineAfter",e[e.suggest=123]="suggest",e[e.suggestFontSize=124]="suggestFontSize",e[e.suggestLineHeight=125]="suggestLineHeight",e[e.suggestOnTriggerCharacters=126]="suggestOnTriggerCharacters",e[e.suggestSelection=127]="suggestSelection",e[e.tabCompletion=128]="tabCompletion",e[e.tabIndex=129]="tabIndex",e[e.unicodeHighlighting=130]="unicodeHighlighting",e[e.unusualLineTerminators=131]="unusualLineTerminators",e[e.useShadowDOM=132]="useShadowDOM",e[e.useTabStops=133]="useTabStops",e[e.wordBreak=134]="wordBreak",e[e.wordSegmenterLocales=135]="wordSegmenterLocales",e[e.wordSeparators=136]="wordSeparators",e[e.wordWrap=137]="wordWrap",e[e.wordWrapBreakAfterCharacters=138]="wordWrapBreakAfterCharacters",e[e.wordWrapBreakBeforeCharacters=139]="wordWrapBreakBeforeCharacters",e[e.wordWrapColumn=140]="wordWrapColumn",e[e.wordWrapOverride1=141]="wordWrapOverride1",e[e.wordWrapOverride2=142]="wordWrapOverride2",e[e.wrappingIndent=143]="wrappingIndent",e[e.wrappingStrategy=144]="wrappingStrategy",e[e.showDeprecated=145]="showDeprecated",e[e.inlayHints=146]="inlayHints",e[e.effectiveCursorStyle=147]="effectiveCursorStyle",e[e.editorClassName=148]="editorClassName",e[e.pixelRatio=149]="pixelRatio",e[e.tabFocusMode=150]="tabFocusMode",e[e.layoutInfo=151]="layoutInfo",e[e.wrappingInfo=152]="wrappingInfo",e[e.defaultColorDecorators=153]="defaultColorDecorators",e[e.colorDecoratorsActivatedOn=154]="colorDecoratorsActivatedOn",e[e.inlineCompletionsAccessibilityVerbose=155]="inlineCompletionsAccessibilityVerbose",e[e.effectiveExperimentalEditContextEnabled=156]="effectiveExperimentalEditContextEnabled"})(SC||(SC={}));var $K={acceptSuggestionOnCommitCharacter:R(new ye(0,"acceptSuggestionOnCommitCharacter",!0,{markdownDescription:h(541,null)})),acceptSuggestionOnEnter:R(new st(1,"acceptSuggestionOnEnter","on",["on","smart","off"],{markdownEnumDescriptions:["",h(542,null),""],markdownDescription:h(543,null)})),accessibilitySupport:R(new f2),accessibilityPageSize:R(new ze(3,"accessibilityPageSize",500,1,1073741824,{description:h(544,null),tags:["accessibility"]})),ariaLabel:R(new Ci(4,"ariaLabel",h(545,null))),ariaRequired:R(new ye(5,"ariaRequired",!1,void 0)),screenReaderAnnounceInlineSuggestion:R(new ye(8,"screenReaderAnnounceInlineSuggestion",!0,{description:h(546,null),tags:["accessibility"]})),autoClosingBrackets:R(new st(6,"autoClosingBrackets","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",h(547,null),h(548,null),""],description:h(549,null)})),autoClosingComments:R(new st(7,"autoClosingComments","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",h(550,null),h(551,null),""],description:h(552,null)})),autoClosingDelete:R(new st(9,"autoClosingDelete","auto",["always","auto","never"],{enumDescriptions:["",h(553,null),""],description:h(554,null)})),autoClosingOvertype:R(new st(10,"autoClosingOvertype","auto",["always","auto","never"],{enumDescriptions:["",h(555,null),""],description:h(556,null)})),autoClosingQuotes:R(new st(11,"autoClosingQuotes","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",h(557,null),h(558,null),""],description:h(559,null)})),autoIndent:R(new Dc(12,"autoIndent",4,"full",["none","keep","brackets","advanced","full"],h2,{enumDescriptions:[h(560,null),h(561,null),h(562,null),h(563,null),h(564,null)],description:h(565,null)})),automaticLayout:R(new ye(13,"automaticLayout",!1)),autoSurround:R(new st(14,"autoSurround","languageDefined",["languageDefined","quotes","brackets","never"],{enumDescriptions:[h(566,null),h(567,null),h(568,null),""],description:h(569,null)})),bracketPairColorization:R(new Q2),bracketPairGuides:R(new J2),stickyTabStops:R(new ye(121,"stickyTabStops",!1,{description:h(570,null)})),codeLens:R(new ye(17,"codeLens",!0,{description:h(571,null)})),codeLensFontFamily:R(new Ci(18,"codeLensFontFamily","",{description:h(572,null)})),codeLensFontSize:R(new ze(19,"codeLensFontSize",0,0,100,{type:"number",default:0,minimum:0,maximum:100,markdownDescription:h(573,null)})),colorDecorators:R(new ye(20,"colorDecorators",!0,{description:h(574,null)})),colorDecoratorActivatedOn:R(new st(154,"colorDecoratorsActivatedOn","clickAndHover",["clickAndHover","hover","click"],{enumDescriptions:[h(575,null),h(576,null),h(577,null)],description:h(578,null)})),colorDecoratorsLimit:R(new ze(21,"colorDecoratorsLimit",500,1,1e6,{markdownDescription:h(579,null)})),columnSelection:R(new ye(22,"columnSelection",!1,{description:h(580,null)})),comments:R(new p2),contextmenu:R(new ye(24,"contextmenu",!0)),copyWithSyntaxHighlighting:R(new ye(25,"copyWithSyntaxHighlighting",!0,{description:h(581,null)})),cursorBlinking:R(new Dc(26,"cursorBlinking",1,"blink",["blink","smooth","phase","expand","solid"],g2,{description:h(582,null)})),cursorSmoothCaretAnimation:R(new st(27,"cursorSmoothCaretAnimation","off",["off","explicit","on"],{enumDescriptions:[h(583,null),h(584,null),h(585,null)],description:h(586,null)})),cursorStyle:R(new Dc(28,"cursorStyle",Tr.Line,"line",["line","block","underline","line-thin","block-outline","underline-thin"],vC,{description:h(587,null)})),overtypeCursorStyle:R(new Dc(84,"overtypeCursorStyle",Tr.Block,"block",["line","block","underline","line-thin","block-outline","underline-thin"],vC,{description:h(588,null)})),cursorSurroundingLines:R(new ze(29,"cursorSurroundingLines",0,0,1073741824,{description:h(589,null)})),cursorSurroundingLinesStyle:R(new st(30,"cursorSurroundingLinesStyle","default",["default","all"],{enumDescriptions:[h(590,null),h(591,null)],markdownDescription:h(592,null)})),cursorWidth:R(new ze(31,"cursorWidth",0,0,1073741824,{markdownDescription:h(593,null)})),disableLayerHinting:R(new ye(32,"disableLayerHinting",!1)),disableMonospaceOptimizations:R(new ye(33,"disableMonospaceOptimizations",!1)),domReadOnly:R(new ye(34,"domReadOnly",!1)),dragAndDrop:R(new ye(35,"dragAndDrop",!0,{description:h(594,null)})),emptySelectionClipboard:R(new v2),dropIntoEditor:R(new tM),experimentalEditContextEnabled:R(new ye(37,"experimentalEditContextEnabled",l2.quality!=="stable",{description:h(595,null),included:xv||Nx||kx})),stickyScroll:R(new A2),experimentalGpuAcceleration:R(new st(39,"experimentalGpuAcceleration","off",["off","on"],{tags:["experimental"],enumDescriptions:[h(596,null),h(597,null)],description:h(598,null)})),experimentalWhitespaceRendering:R(new st(40,"experimentalWhitespaceRendering","svg",["svg","font","off"],{enumDescriptions:[h(599,null),h(600,null),h(601,null)],description:h(602,null)})),extraEditorClassName:R(new Ci(41,"extraEditorClassName","")),fastScrollSensitivity:R(new Zr(42,"fastScrollSensitivity",5,e=>e<=0?5:e,{markdownDescription:h(603,null)})),find:R(new _2),fixedOverflowWidgets:R(new ye(44,"fixedOverflowWidgets",!1)),folding:R(new ye(45,"folding",!0,{description:h(604,null)})),foldingStrategy:R(new st(46,"foldingStrategy","auto",["auto","indentation"],{enumDescriptions:[h(605,null),h(606,null)],description:h(607,null)})),foldingHighlight:R(new ye(47,"foldingHighlight",!0,{description:h(608,null)})),foldingImportsByDefault:R(new ye(48,"foldingImportsByDefault",!1,{description:h(609,null)})),foldingMaximumRegions:R(new ze(49,"foldingMaximumRegions",5e3,10,65e3,{description:h(610,null)})),unfoldOnClickAfterEndOfLine:R(new ye(50,"unfoldOnClickAfterEndOfLine",!1,{description:h(611,null)})),fontFamily:R(new Ci(51,"fontFamily",Ts.fontFamily,{description:h(612,null)})),fontInfo:R(new b2),fontLigatures2:R(new w2),fontSize:R(new E2),fontWeight:R(new C2),fontVariations:R(new y2),formatOnPaste:R(new ye(57,"formatOnPaste",!1,{description:h(613,null)})),formatOnType:R(new ye(58,"formatOnType",!1,{description:h(614,null)})),glyphMargin:R(new ye(59,"glyphMargin",!0,{description:h(615,null)})),gotoLocation:R(new D2),hideCursorInOverviewRuler:R(new ye(61,"hideCursorInOverviewRuler",!1,{description:h(616,null)})),hover:R(new k2),inDiffEditor:R(new ye(63,"inDiffEditor",!1)),letterSpacing:R(new Zr(65,"letterSpacing",Ts.letterSpacing,e=>Zr.clamp(e,-5,20),{description:h(617,null)})),lightbulb:R(new T2),lineDecorationsWidth:R(new L2),lineHeight:R(new N2),lineNumbers:R(new B2),lineNumbersMinChars:R(new ze(70,"lineNumbersMinChars",5,1,300)),linkedEditing:R(new ye(71,"linkedEditing",!1,{description:h(618,null)})),links:R(new ye(72,"links",!0,{description:h(619,null)})),matchBrackets:R(new st(73,"matchBrackets","always",["always","near","never"],{description:h(620,null)})),minimap:R(new M2),mouseStyle:R(new st(75,"mouseStyle","text",["text","default","copy"])),mouseWheelScrollSensitivity:R(new Zr(76,"mouseWheelScrollSensitivity",1,e=>e===0?1:e,{markdownDescription:h(621,null)})),mouseWheelZoom:R(new ye(77,"mouseWheelZoom",!1,{markdownDescription:h(Mt?622:623,null)})),multiCursorMergeOverlapping:R(new ye(78,"multiCursorMergeOverlapping",!0,{description:h(624,null)})),multiCursorModifier:R(new Dc(79,"multiCursorModifier","altKey","alt",["ctrlCmd","alt"],O2,{markdownEnumDescriptions:[h(625,null),h(626,null)],markdownDescription:h(627,null)})),multiCursorPaste:R(new st(80,"multiCursorPaste","spread",["spread","full"],{markdownEnumDescriptions:[h(628,null),h(629,null)],markdownDescription:h(630,null)})),multiCursorLimit:R(new ze(81,"multiCursorLimit",1e4,1,1e5,{markdownDescription:h(631,null)})),occurrencesHighlight:R(new st(82,"occurrencesHighlight","singleFile",["off","singleFile","multiFile"],{markdownEnumDescriptions:[h(632,null),h(633,null),h(634,null)],markdownDescription:h(635,null)})),occurrencesHighlightDelay:R(new ze(83,"occurrencesHighlightDelay",0,0,2e3,{description:h(636,null),tags:["preview"]})),overtypeOnPaste:R(new ye(85,"overtypeOnPaste",!0,{description:h(637,null)})),overviewRulerBorder:R(new ye(86,"overviewRulerBorder",!0,{description:h(638,null)})),overviewRulerLanes:R(new ze(87,"overviewRulerLanes",3,0,3)),padding:R(new F2),pasteAs:R(new iM),parameterHints:R(new $2),peekWidgetDefaultFocus:R(new st(91,"peekWidgetDefaultFocus","tree",["tree","editor"],{enumDescriptions:[h(639,null),h(640,null)],description:h(641,null)})),placeholder:R(new U2),definitionLinkOpensInPeek:R(new ye(93,"definitionLinkOpensInPeek",!1,{description:h(642,null)})),quickSuggestions:R(new W2),quickSuggestionsDelay:R(new ze(95,"quickSuggestionsDelay",10,0,1073741824,{description:h(643,null)})),readOnly:R(new ye(96,"readOnly",!1)),readOnlyMessage:R(new z2),renameOnType:R(new ye(98,"renameOnType",!1,{description:h(644,null),markdownDeprecationMessage:h(645,null)})),renderControlCharacters:R(new ye(99,"renderControlCharacters",!0,{description:h(646,null),restricted:!0})),renderFinalNewline:R(new st(100,"renderFinalNewline",Ct?"dimmed":"on",["off","on","dimmed"],{description:h(647,null)})),renderLineHighlight:R(new st(101,"renderLineHighlight","line",["none","gutter","line","all"],{enumDescriptions:["","","",h(648,null)],description:h(649,null)})),renderLineHighlightOnlyWhenFocus:R(new ye(102,"renderLineHighlightOnlyWhenFocus",!1,{description:h(650,null)})),renderValidationDecorations:R(new st(103,"renderValidationDecorations","editable",["editable","on","off"])),renderWhitespace:R(new st(104,"renderWhitespace","selection",["none","boundary","selection","trailing","all"],{enumDescriptions:["",h(651,null),h(652,null),h(653,null),""],description:h(654,null)})),revealHorizontalRightPadding:R(new ze(105,"revealHorizontalRightPadding",15,0,1e3)),roundedSelection:R(new ye(106,"roundedSelection",!0,{description:h(655,null)})),rulers:R(new V2),scrollbar:R(new q2),scrollBeyondLastColumn:R(new ze(109,"scrollBeyondLastColumn",4,0,1073741824,{description:h(656,null)})),scrollBeyondLastLine:R(new ye(110,"scrollBeyondLastLine",!0,{description:h(657,null)})),scrollPredominantAxis:R(new ye(111,"scrollPredominantAxis",!0,{description:h(658,null)})),selectionClipboard:R(new ye(112,"selectionClipboard",!0,{description:h(659,null),included:Ct})),selectionHighlight:R(new ye(113,"selectionHighlight",!0,{description:h(660,null)})),selectOnLineNumbers:R(new ye(114,"selectOnLineNumbers",!0)),showFoldingControls:R(new st(115,"showFoldingControls","mouseover",["always","never","mouseover"],{enumDescriptions:[h(661,null),h(662,null),h(663,null)],description:h(664,null)})),showUnused:R(new ye(116,"showUnused",!0,{description:h(665,null)})),showDeprecated:R(new ye(145,"showDeprecated",!0,{description:h(666,null)})),inlayHints:R(new R2),snippetSuggestions:R(new st(117,"snippetSuggestions","inline",["top","bottom","inline","none"],{enumDescriptions:[h(667,null),h(668,null),h(669,null),h(670,null)],description:h(671,null)})),smartSelect:R(new X2),smoothScrolling:R(new ye(119,"smoothScrolling",!1,{description:h(672,null)})),stopRenderingLineAfter:R(new ze(122,"stopRenderingLineAfter",1e4,-1,1073741824)),suggest:R(new K2),inlineSuggest:R(new G2),inlineCompletionsAccessibilityVerbose:R(new ye(155,"inlineCompletionsAccessibilityVerbose",!1,{description:h(673,null)})),suggestFontSize:R(new ze(124,"suggestFontSize",0,0,1e3,{markdownDescription:h(674,null,"`0`","`#editor.fontSize#`")})),suggestLineHeight:R(new ze(125,"suggestLineHeight",0,0,1e3,{markdownDescription:h(675,null,"`0`","`#editor.lineHeight#`")})),suggestOnTriggerCharacters:R(new ye(126,"suggestOnTriggerCharacters",!0,{description:h(676,null)})),suggestSelection:R(new st(127,"suggestSelection","first",["first","recentlyUsed","recentlyUsedByPrefix"],{markdownEnumDescriptions:[h(677,null),h(678,null),h(679,null)],description:h(680,null)})),tabCompletion:R(new st(128,"tabCompletion","off",["on","off","onlySnippets"],{enumDescriptions:[h(681,null),h(682,null),h(683,null)],description:h(684,null)})),tabIndex:R(new ze(129,"tabIndex",0,-1,1073741824)),unicodeHighlight:R(new j2),unusualLineTerminators:R(new st(131,"unusualLineTerminators","prompt",["auto","off","prompt"],{enumDescriptions:[h(685,null),h(686,null),h(687,null)],description:h(688,null)})),useShadowDOM:R(new ye(132,"useShadowDOM",!0)),useTabStops:R(new ye(133,"useTabStops",!0,{description:h(689,null)})),wordBreak:R(new st(134,"wordBreak","normal",["normal","keepAll"],{markdownEnumDescriptions:[h(690,null),h(691,null)],description:h(692,null)})),wordSegmenterLocales:R(new Y2),wordSeparators:R(new Ci(136,"wordSeparators",dC,{description:h(693,null)})),wordWrap:R(new st(137,"wordWrap","off",["off","on","wordWrapColumn","bounded"],{markdownEnumDescriptions:[h(694,null),h(695,null),h(696,null),h(697,null)],description:h(698,null)})),wordWrapBreakAfterCharacters:R(new Ci(138,"wordWrapBreakAfterCharacters"," 	})]?|/&.,;\xA2\xB0\u2032\u2033\u2030\u2103\u3001\u3002\uFF61\uFF64\uFFE0\uFF0C\uFF0E\uFF1A\uFF1B\uFF1F\uFF01\uFF05\u30FB\uFF65\u309D\u309E\u30FD\u30FE\u30FC\u30A1\u30A3\u30A5\u30A7\u30A9\u30C3\u30E3\u30E5\u30E7\u30EE\u30F5\u30F6\u3041\u3043\u3045\u3047\u3049\u3063\u3083\u3085\u3087\u308E\u3095\u3096\u31F0\u31F1\u31F2\u31F3\u31F4\u31F5\u31F6\u31F7\u31F8\u31F9\u31FA\u31FB\u31FC\u31FD\u31FE\u31FF\u3005\u303B\uFF67\uFF68\uFF69\uFF6A\uFF6B\uFF6C\uFF6D\uFF6E\uFF6F\uFF70\u201D\u3009\u300B\u300D\u300F\u3011\u3015\uFF09\uFF3D\uFF5D\uFF63")),wordWrapBreakBeforeCharacters:R(new Ci(139,"wordWrapBreakBeforeCharacters","([{\u2018\u201C\u3008\u300A\u300C\u300E\u3010\u3014\uFF08\uFF3B\uFF5B\uFF62\xA3\xA5\uFF04\uFFE1\uFFE5+\uFF0B")),wordWrapColumn:R(new ze(140,"wordWrapColumn",80,1,1073741824,{markdownDescription:h(699,null)})),wordWrapOverride1:R(new st(141,"wordWrapOverride1","inherit",["off","on","inherit"])),wordWrapOverride2:R(new st(142,"wordWrapOverride2","inherit",["off","on","inherit"])),effectiveCursorStyle:R(new S2),editorClassName:R(new m2),defaultColorDecorators:R(new st(153,"defaultColorDecorators","auto",["auto","always","never"],{enumDescriptions:[h(700,null),h(701,null),h(702,null)],description:h(703,null)})),pixelRatio:R(new H2),tabFocusMode:R(new ye(150,"tabFocusMode",!1,{markdownDescription:h(704,null)})),layoutInfo:R(new I2),wrappingInfo:R(new eM),wrappingIndent:R(new Z2),wrappingStrategy:R(new P2),effectiveExperimentalEditContextEnabled:R(new x2)},xC=class O9{static{this.count=0}constructor(t){this._proxyIdentifierBrand=void 0,this.sid=t,this.nid=++O9.count}},EC=[];function L(e){const t=new xC(e);return EC[t.nid]=t,t}function Mh(e){return EC[e].sid}var wi=class{constructor(e){this.value=e}},CC;(function(e){e[e.Default=0]="Default",e[e.InCenter=1]="InCenter",e[e.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",e[e.AtTop=3]="AtTop"})(CC||(CC={}));var DC;(function(e){e[e.UnknownInput=0]="UnknownInput",e[e.TextInput=1]="TextInput",e[e.TextDiffInput=2]="TextDiffInput",e[e.TextMergeInput=3]="TextMergeInput",e[e.NotebookInput=4]="NotebookInput",e[e.NotebookDiffInput=5]="NotebookDiffInput",e[e.CustomEditorInput=6]="CustomEditorInput",e[e.WebviewEditorInput=7]="WebviewEditorInput",e[e.TerminalEditorInput=8]="TerminalEditorInput",e[e.InteractiveEditorInput=9]="InteractiveEditorInput",e[e.ChatEditorInput=10]="ChatEditorInput",e[e.MultiDiffEditorInput=11]="MultiDiffEditorInput"})(DC||(DC={}));var kC;(function(e){e[e.TAB_OPEN=0]="TAB_OPEN",e[e.TAB_CLOSE=1]="TAB_CLOSE",e[e.TAB_UPDATE=2]="TAB_UPDATE",e[e.TAB_MOVE=3]="TAB_MOVE"})(kC||(kC={}));var IC;(function(e){e[e.Editable=0]="Editable",e[e.SupportsHotExit=1]="SupportsHotExit"})(IC||(IC={}));var PC;(function(e){e[e.Int8Array=1]="Int8Array",e[e.Uint8Array=2]="Uint8Array",e[e.Uint8ClampedArray=3]="Uint8ClampedArray",e[e.Int16Array=4]="Int16Array",e[e.Uint16Array=5]="Uint16Array",e[e.Int32Array=6]="Int32Array",e[e.Uint32Array=7]="Uint32Array",e[e.Float32Array=8]="Float32Array",e[e.Float64Array=9]="Float64Array",e[e.BigInt64Array=10]="BigInt64Array",e[e.BigUint64Array=11]="BigUint64Array"})(PC||(PC={}));var TC;(function(e){e[e.Text=1]="Text",e[e.Error=2]="Error",e[e.Rich=3]="Rich"})(TC||(TC={}));var AC;(function(e){e[e.Default=0]="Default",e[e.InCenter=1]="InCenter",e[e.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",e[e.AtTop=3]="AtTop"})(AC||(AC={}));var e1;(function(e){e[e.None=0]="None",e[e.Process=1]="Process",e[e.Output=2]="Output",e[e.Hybrid=3]="Hybrid"})(e1||(e1={}));var HK=class F9{static{this._n=0}static mixin(t){return t._id=F9._n++,t}},RC;(function(e){e.label="a",e.kind="b",e.detail="c",e.documentation="d",e.sortText="e",e.filterText="f",e.preselect="g",e.insertText="h",e.insertTextRules="i",e.range="j",e.commitCharacters="k",e.additionalTextEdits="l",e.kindModifier="m",e.commandIdent="n",e.commandId="o",e.commandArguments="p"})(RC||(RC={}));var LC;(function(e){e.defaultRanges="a",e.completions="b",e.isIncomplete="c",e.duration="d"})(LC||(LC={}));var NC;(function(e){e[e.Workspace=0]="Workspace",e[e.TextDocument=1]="TextDocument"})(NC||(NC={}));var Q={MainThreadAuthentication:L("MainThreadAuthentication"),MainThreadBulkEdits:L("MainThreadBulkEdits"),MainThreadLanguageModels:L("MainThreadLanguageModels"),MainThreadEmbeddings:L("MainThreadEmbeddings"),MainThreadChatAgents2:L("MainThreadChatAgents2"),MainThreadCodeMapper:L("MainThreadCodeMapper"),MainThreadLanguageModelTools:L("MainThreadChatSkills"),MainThreadClipboard:L("MainThreadClipboard"),MainThreadCommands:L("MainThreadCommands"),MainThreadComments:L("MainThreadComments"),MainThreadConfiguration:L("MainThreadConfiguration"),MainThreadConsole:L("MainThreadConsole"),MainThreadDebugService:L("MainThreadDebugService"),MainThreadDecorations:L("MainThreadDecorations"),MainThreadDiagnostics:L("MainThreadDiagnostics"),MainThreadDialogs:L("MainThreadDiaglogs"),MainThreadDocuments:L("MainThreadDocuments"),MainThreadDocumentContentProviders:L("MainThreadDocumentContentProviders"),MainThreadTextEditors:L("MainThreadTextEditors"),MainThreadEditorInsets:L("MainThreadEditorInsets"),MainThreadEditorTabs:L("MainThreadEditorTabs"),MainThreadErrors:L("MainThreadErrors"),MainThreadTreeViews:L("MainThreadTreeViews"),MainThreadDownloadService:L("MainThreadDownloadService"),MainThreadLanguageFeatures:L("MainThreadLanguageFeatures"),MainThreadLanguages:L("MainThreadLanguages"),MainThreadLogger:L("MainThreadLogger"),MainThreadMessageService:L("MainThreadMessageService"),MainThreadOutputService:L("MainThreadOutputService"),MainThreadProgress:L("MainThreadProgress"),MainThreadQuickDiff:L("MainThreadQuickDiff"),MainThreadQuickOpen:L("MainThreadQuickOpen"),MainThreadStatusBar:L("MainThreadStatusBar"),MainThreadSecretState:L("MainThreadSecretState"),MainThreadStorage:L("MainThreadStorage"),MainThreadSpeech:L("MainThreadSpeechProvider"),MainThreadTelemetry:L("MainThreadTelemetry"),MainThreadTerminalService:L("MainThreadTerminalService"),MainThreadTerminalShellIntegration:L("MainThreadTerminalShellIntegration"),MainThreadWebviews:L("MainThreadWebviews"),MainThreadWebviewPanels:L("MainThreadWebviewPanels"),MainThreadWebviewViews:L("MainThreadWebviewViews"),MainThreadCustomEditors:L("MainThreadCustomEditors"),MainThreadUrls:L("MainThreadUrls"),MainThreadUriOpeners:L("MainThreadUriOpeners"),MainThreadProfileContentHandlers:L("MainThreadProfileContentHandlers"),MainThreadWorkspace:L("MainThreadWorkspace"),MainThreadFileSystem:L("MainThreadFileSystem"),MainThreadFileSystemEventService:L("MainThreadFileSystemEventService"),MainThreadExtensionService:L("MainThreadExtensionService"),MainThreadSCM:L("MainThreadSCM"),MainThreadSearch:L("MainThreadSearch"),MainThreadShare:L("MainThreadShare"),MainThreadTask:L("MainThreadTask"),MainThreadWindow:L("MainThreadWindow"),MainThreadLabelService:L("MainThreadLabelService"),MainThreadNotebook:L("MainThreadNotebook"),MainThreadNotebookDocuments:L("MainThreadNotebookDocumentsShape"),MainThreadNotebookEditors:L("MainThreadNotebookEditorsShape"),MainThreadNotebookKernels:L("MainThreadNotebookKernels"),MainThreadNotebookRenderers:L("MainThreadNotebookRenderers"),MainThreadInteractive:L("MainThreadInteractive"),MainThreadTheming:L("MainThreadTheming"),MainThreadTunnelService:L("MainThreadTunnelService"),MainThreadManagedSockets:L("MainThreadManagedSockets"),MainThreadTimeline:L("MainThreadTimeline"),MainThreadTesting:L("MainThreadTesting"),MainThreadLocalization:L("MainThreadLocalizationShape"),MainThreadMcp:L("MainThreadMcpShape"),MainThreadAiRelatedInformation:L("MainThreadAiRelatedInformation"),MainThreadAiEmbeddingVector:L("MainThreadAiEmbeddingVector"),MainThreadChatStatus:L("MainThreadChatStatus"),MainThreadAiSettingsSearch:L("MainThreadAiSettingsSearch"),MainThreadInlineDiff:L("MainThreadInlineDiff"),MainThreadEditorBottomWidget:L("MainThreadEditorBottomWidget"),MainThreadInlineChat:L("MainThreadInlineChat"),MainThreadTerminalCommandChat:L("MainThreadTerminalCommandChat"),MainThreadSelectionAction:L("MainThreadSelectionAction"),MainThreadTerminalSelectionAction:L("MainThreadTerminalSelectionAction"),MainThreadEditCode:L("MainThreadEditCode")},re={ExtHostCodeMapper:L("ExtHostCodeMapper"),ExtHostCommands:L("ExtHostCommands"),ExtHostConfiguration:L("ExtHostConfiguration"),ExtHostDiagnostics:L("ExtHostDiagnostics"),ExtHostDebugService:L("ExtHostDebugService"),ExtHostDecorations:L("ExtHostDecorations"),ExtHostDocumentsAndEditors:L("ExtHostDocumentsAndEditors"),ExtHostDocuments:L("ExtHostDocuments"),ExtHostDocumentContentProviders:L("ExtHostDocumentContentProviders"),ExtHostDocumentSaveParticipant:L("ExtHostDocumentSaveParticipant"),ExtHostEditors:L("ExtHostEditors"),ExtHostTreeViews:L("ExtHostTreeViews"),ExtHostFileSystem:L("ExtHostFileSystem"),ExtHostFileSystemInfo:L("ExtHostFileSystemInfo"),ExtHostFileSystemEventService:L("ExtHostFileSystemEventService"),ExtHostLanguages:L("ExtHostLanguages"),ExtHostLanguageFeatures:L("ExtHostLanguageFeatures"),ExtHostQuickOpen:L("ExtHostQuickOpen"),ExtHostQuickDiff:L("ExtHostQuickDiff"),ExtHostStatusBar:L("ExtHostStatusBar"),ExtHostShare:L("ExtHostShare"),ExtHostExtensionService:L("ExtHostExtensionService"),ExtHostLogLevelServiceShape:L("ExtHostLogLevelServiceShape"),ExtHostTerminalService:L("ExtHostTerminalService"),ExtHostTerminalShellIntegration:L("ExtHostTerminalShellIntegration"),ExtHostSCM:L("ExtHostSCM"),ExtHostSearch:L("ExtHostSearch"),ExtHostTask:L("ExtHostTask"),ExtHostWorkspace:L("ExtHostWorkspace"),ExtHostWindow:L("ExtHostWindow"),ExtHostWebviews:L("ExtHostWebviews"),ExtHostWebviewPanels:L("ExtHostWebviewPanels"),ExtHostCustomEditors:L("ExtHostCustomEditors"),ExtHostWebviewViews:L("ExtHostWebviewViews"),ExtHostEditorInsets:L("ExtHostEditorInsets"),ExtHostEditorTabs:L("ExtHostEditorTabs"),ExtHostProgress:L("ExtHostProgress"),ExtHostComments:L("ExtHostComments"),ExtHostSecretState:L("ExtHostSecretState"),ExtHostStorage:L("ExtHostStorage"),ExtHostUrls:L("ExtHostUrls"),ExtHostUriOpeners:L("ExtHostUriOpeners"),ExtHostProfileContentHandlers:L("ExtHostProfileContentHandlers"),ExtHostOutputService:L("ExtHostOutputService"),ExtHostLabelService:L("ExtHostLabelService"),ExtHostNotebook:L("ExtHostNotebook"),ExtHostNotebookDocuments:L("ExtHostNotebookDocuments"),ExtHostNotebookEditors:L("ExtHostNotebookEditors"),ExtHostNotebookKernels:L("ExtHostNotebookKernels"),ExtHostNotebookRenderers:L("ExtHostNotebookRenderers"),ExtHostNotebookDocumentSaveParticipant:L("ExtHostNotebookDocumentSaveParticipant"),ExtHostInteractive:L("ExtHostInteractive"),ExtHostChatAgents2:L("ExtHostChatAgents"),ExtHostLanguageModelTools:L("ExtHostChatSkills"),ExtHostChatProvider:L("ExtHostChatProvider"),ExtHostSpeech:L("ExtHostSpeech"),ExtHostEmbeddings:L("ExtHostEmbeddings"),ExtHostAiRelatedInformation:L("ExtHostAiRelatedInformation"),ExtHostAiEmbeddingVector:L("ExtHostAiEmbeddingVector"),ExtHostAiSettingsSearch:L("ExtHostAiSettingsSearch"),ExtHostTheming:L("ExtHostTheming"),ExtHostTunnelService:L("ExtHostTunnelService"),ExtHostManagedSockets:L("ExtHostManagedSockets"),ExtHostAuthentication:L("ExtHostAuthentication"),ExtHostTimeline:L("ExtHostTimeline"),ExtHostTesting:L("ExtHostTesting"),ExtHostTelemetry:L("ExtHostTelemetry"),ExtHostLocalization:L("ExtHostLocalization"),ExtHostMcp:L("ExtHostMcp"),ExtHostInlineDiff:L("ExtHostInlineDiff"),ExtHostEditorBottomWidget:L("ExtHostEditorBottomWidget"),ExtHostInlineChat:L("ExtHostInlineChat"),ExtHostTerminalCommandChat:L("ExtHostTerminalCommandChat"),ExtHostSelectionAction:L("ExtHostSelectionAction"),ExtHostTerminalSelectionAction:L("ExtHostTerminalSelectionAction"),ExtHostEditCode:L("ExtHostEditCode")};function MC(e){return e.toJSON()}var aM=class{constructor(e){this._uriTransformer=e}transformIncoming(e){const t=this._uriTransformer.transformIncoming(e);return t===e?e:MC(b.from(t))}transformOutgoing(e){const t=this._uriTransformer.transformOutgoing(e);return t===e?e:MC(b.from(t))}transformOutgoingURI(e){const t=this._uriTransformer.transformOutgoing(e);return t===e?e:b.from(t)}transformOutgoingScheme(e){return this._uriTransformer.transformOutgoingScheme(e)}},UK=new class{transformIncoming(e){return e}transformOutgoing(e){return e}transformOutgoingURI(e){return e}transformOutgoingScheme(e){return e}};function OC(e,t,i,r){if(!e||r>200)return null;if(typeof e=="object"){if(e.$mid===1)return i?b.revive(t.transformIncoming(e)):t.transformIncoming(e);if(e instanceof z)return null;for(const s in e)if(Object.hasOwnProperty.call(e,s)){const n=OC(e[s],t,i,r+1);n!==null&&(e[s]=n)}}return null}function kc(e,t){const i=OC(e,t,!1,0);return i===null?e:i}var FC=class{constructor(){this._actual=null,this._actualOk=null,this._actualErr=null,this._hasValue=!1,this._value=null,this._hasErr=!1,this._err=null}get[Symbol.toStringTag](){return this.toString()}_ensureActual(){return this._actual||(this._actual=new Promise((e,t)=>{this._actualOk=e,this._actualErr=t,this._hasValue&&this._actualOk(this._value),this._hasErr&&this._actualErr(this._err)})),this._actual}resolveOk(e){this._hasValue||this._hasErr||(this._hasValue=!0,this._value=e,this._actual&&this._actualOk(e))}resolveErr(e){this._hasValue||this._hasErr||(this._hasErr=!0,this._err=e,this._actual?this._actualErr(e):pt(e))}then(e,t){return this._ensureActual().then(e,t)}catch(e){return this._ensureActual().then(void 0,e)}finally(e){return this._ensureActual().finally(e)}},lM=class extends FC{constructor(){super(),this._hasErr=!0,this._err=new oi}},$C;function t1(e,t){try{return JSON.stringify(e,t)}catch{return"null"}}var i1="$$ref$$",cM={[i1]:-1};function HC(e,t=null,i=!1){const r=[];return{jsonString:(i?t1:JSON.stringify)(e,(n,o)=>{if(typeof o>"u")return cM;if(typeof o=="object"){if(o instanceof z){const a=r.push(o)-1;return{[i1]:a}}if(t)return t(n,o)}return o}),referencedBuffers:r}}function UC(e,t,i){return JSON.parse(e,(r,s)=>{if(s){const n=s[i1];if(typeof n=="number")return t[n];if(i&&s.$mid===1)return i.transformIncoming(s)}return s})}function WC(e,t){return JSON.stringify(e,t)}function uM(e){return e?(t,i)=>i&&i.$mid===1?e.transformOutgoing(i):i:null}var BC;(function(e){e[e.LocalSide=0]="LocalSide",e[e.OtherSide=1]="OtherSide"})(BC||(BC={}));var VC;(function(e){e[e.Responsive=0]="Responsive",e[e.Unresponsive=1]="Unresponsive"})(VC||(VC={}));var dM=()=>{},hM=Symbol.for("rpcProtocol"),fM=Symbol.for("rpcProxy"),pM=class _S extends X{static{$C=hM}static{this.UNRESPONSIVE_TIME=3*1e3}constructor(t,i=null,r=null){super(),this[$C]=!0,this._onDidChangeResponsiveState=this._register(new D),this.onDidChangeResponsiveState=this._onDidChangeResponsiveState.event,this._protocol=t,this._logger=i,this._uriTransformer=r,this._uriReplacer=uM(this._uriTransformer),this._isDisposed=!1,this._locals=[],this._proxies=[];for(let s=0,n=xC.count;s<n;s++)this._locals[s]=null,this._proxies[s]=null;this._lastMessageId=0,this._cancelInvokedHandlers=Object.create(null),this._pendingRPCReplies={},this._responsiveState=0,this._unacknowledgedCount=0,this._unresponsiveTime=0,this._asyncCheckUresponsive=this._register(new ks(()=>this._checkUnresponsive(),1e3)),this._register(this._protocol.onMessage(s=>this._receiveOneMessage(s)))}dispose(){this._isDisposed=!0,Object.keys(this._pendingRPCReplies).forEach(t=>{const i=this._pendingRPCReplies[t];delete this._pendingRPCReplies[t],i.resolveErr(cc())}),super.dispose()}drain(){return typeof this._protocol.drain=="function"?this._protocol.drain():Promise.resolve()}_onWillSendRequest(t){this._unacknowledgedCount===0&&(this._unresponsiveTime=Date.now()+_S.UNRESPONSIVE_TIME),this._unacknowledgedCount++,this._asyncCheckUresponsive.isScheduled()||this._asyncCheckUresponsive.schedule()}_onDidReceiveAcknowledge(t){this._unresponsiveTime=Date.now()+_S.UNRESPONSIVE_TIME,this._unacknowledgedCount--,this._unacknowledgedCount===0&&this._asyncCheckUresponsive.cancel(),this._setResponsiveState(0)}_checkUnresponsive(){this._unacknowledgedCount!==0&&(Date.now()>this._unresponsiveTime?this._setResponsiveState(1):this._asyncCheckUresponsive.schedule())}_setResponsiveState(t){this._responsiveState!==t&&(this._responsiveState=t,this._onDidChangeResponsiveState.fire(this._responsiveState))}get responsiveState(){return this._responsiveState}transformIncomingURIs(t){return this._uriTransformer?kc(t,this._uriTransformer):t}getProxy(t){const{nid:i,sid:r}=t;return this._proxies[i]||(this._proxies[i]=this._createProxy(i,r)),this._proxies[i]}_createProxy(t,i){const r={get:(s,n)=>(typeof n=="string"&&!s[n]&&n.charCodeAt(0)===36&&(s[n]=(...o)=>this._remoteCall(t,n,o)),n===fM?i:s[n])};return new Proxy(Object.create(null),r)}set(t,i){return this._locals[t.nid]=i,i}assertRegistered(t){for(let i=0,r=t.length;i<r;i++){const s=t[i];if(!this._locals[s.nid])throw new Error(`Missing proxy instance ${s.sid}`)}}_receiveOneMessage(t){if(this._isDisposed)return;const i=t.byteLength,r=Ot.read(t,0),s=r.readUInt8(),n=r.readUInt32();switch(s){case 1:case 2:{let{rpcId:o,method:a,args:l}=fr.deserializeRequestJSONArgs(r);this._uriTransformer&&(l=kc(l,this._uriTransformer)),this._receiveRequest(i,n,o,a,l,s===2);break}case 3:case 4:{let{rpcId:o,method:a,args:l}=fr.deserializeRequestMixedArgs(r);this._uriTransformer&&(l=kc(l,this._uriTransformer)),this._receiveRequest(i,n,o,a,l,s===4);break}case 5:{this._logger?.logIncoming(i,n,0,"ack"),this._onDidReceiveAcknowledge(n);break}case 6:{this._receiveCancel(i,n);break}case 7:{this._receiveReply(i,n,void 0);break}case 9:{let o=fr.deserializeReplyOKJSON(r);this._uriTransformer&&(o=kc(o,this._uriTransformer)),this._receiveReply(i,n,o);break}case 10:{const o=fr.deserializeReplyOKJSONWithBuffers(r,this._uriTransformer);this._receiveReply(i,n,o);break}case 8:{const o=fr.deserializeReplyOKVSBuffer(r);this._receiveReply(i,n,o);break}case 11:{let o=fr.deserializeReplyErrError(r);this._uriTransformer&&(o=kc(o,this._uriTransformer)),this._receiveReplyErr(i,n,o);break}case 12:{this._receiveReplyErr(i,n,void 0);break}default:console.error("received unexpected message"),console.error(t)}}_receiveRequest(t,i,r,s,n,o){this._logger?.logIncoming(t,i,1,`receiveRequest ${Mh(r)}.${s}(`,n);const a=String(i);let l,c;if(o){const d=new rt;n.push(d.token),l=this._invokeHandler(r,s,n),c=()=>d.cancel()}else l=this._invokeHandler(r,s,n),c=dM;this._cancelInvokedHandlers[a]=c;const u=fr.serializeAcknowledged(i);this._logger?.logOutgoing(u.byteLength,i,1,"ack"),this._protocol.send(u),l.then(d=>{delete this._cancelInvokedHandlers[a];const f=fr.serializeReplyOK(i,d,this._uriReplacer);this._logger?.logOutgoing(f.byteLength,i,1,"reply:",d),this._protocol.send(f)},d=>{delete this._cancelInvokedHandlers[a];const f=fr.serializeReplyErr(i,d);this._logger?.logOutgoing(f.byteLength,i,1,"replyErr:",d),this._protocol.send(f)})}_receiveCancel(t,i){this._logger?.logIncoming(t,i,1,"receiveCancel");const r=String(i);this._cancelInvokedHandlers[r]?.()}_receiveReply(t,i,r){this._logger?.logIncoming(t,i,0,"receiveReply:",r);const s=String(i);if(!this._pendingRPCReplies.hasOwnProperty(s))return;const n=this._pendingRPCReplies[s];delete this._pendingRPCReplies[s],n.resolveOk(r)}_receiveReplyErr(t,i,r){this._logger?.logIncoming(t,i,0,"receiveReplyErr:",r);const s=String(i);if(!this._pendingRPCReplies.hasOwnProperty(s))return;const n=this._pendingRPCReplies[s];delete this._pendingRPCReplies[s];let o;r&&(r.$isError?(o=new Error,o.name=r.name,o.message=r.message,o.stack=r.stack):o=r),n.resolveErr(o)}_invokeHandler(t,i,r){try{return Promise.resolve(this._doInvokeHandler(t,i,r))}catch(s){return Promise.reject(s)}}_doInvokeHandler(t,i,r){const s=this._locals[t];if(!s)throw new Error("Unknown actor "+Mh(t));const n=s[i];if(typeof n!="function")throw new Error("Unknown method "+i+" on actor "+Mh(t));return n.apply(s,r)}_remoteCall(t,i,r){if(this._isDisposed)return new lM;let s=null;if(r.length>0&&Be.isCancellationToken(r[r.length-1])&&(s=r.pop()),s&&s.isCancellationRequested)return Promise.reject(cc());const n=fr.serializeRequestArguments(r,this._uriReplacer),o=++this._lastMessageId,a=String(o),l=new FC,c=new oe;s&&c.add(s.onCancellationRequested(()=>{const d=fr.serializeCancel(o);this._logger?.logOutgoing(d.byteLength,o,0,"cancel"),this._protocol.send(d)})),this._pendingRPCReplies[a]=new gM(l,c),this._onWillSendRequest(o);const u=fr.serializeRequest(o,t,i,n,!!s);return this._logger?.logOutgoing(u.byteLength,o,0,`request: ${Mh(t)}.${i}(`,r),this._protocol.send(u),l}},gM=class{constructor(e,t){this._promise=e,this._disposable=t}resolveOk(e){this._promise.resolveOk(e),this._disposable.dispose()}resolveErr(e){this._promise.resolveErr(e),this._disposable.dispose()}},Ot=class wS{static alloc(t,i,r){const s=new wS(z.alloc(r+1+4),0);return s.writeUInt8(t),s.writeUInt32(i),s}static read(t,i){return new wS(t,i)}get buffer(){return this._buff}constructor(t,i){this._buff=t,this._offset=i}static sizeUInt8(){return 1}static{this.sizeUInt32=4}writeUInt8(t){this._buff.writeUInt8(t,this._offset),this._offset+=1}readUInt8(){const t=this._buff.readUInt8(this._offset);return this._offset+=1,t}writeUInt32(t){this._buff.writeUInt32BE(t,this._offset),this._offset+=4}readUInt32(){const t=this._buff.readUInt32BE(this._offset);return this._offset+=4,t}static sizeShortString(t){return 1+t.byteLength}writeShortString(t){this._buff.writeUInt8(t.byteLength,this._offset),this._offset+=1,this._buff.set(t,this._offset),this._offset+=t.byteLength}readShortString(){const t=this._buff.readUInt8(this._offset);this._offset+=1;const r=this._buff.slice(this._offset,this._offset+t).toString();return this._offset+=t,r}static sizeLongString(t){return 4+t.byteLength}writeLongString(t){this._buff.writeUInt32BE(t.byteLength,this._offset),this._offset+=4,this._buff.set(t,this._offset),this._offset+=t.byteLength}readLongString(){const t=this._buff.readUInt32BE(this._offset);this._offset+=4;const r=this._buff.slice(this._offset,this._offset+t).toString();return this._offset+=t,r}writeBuffer(t){this._buff.writeUInt32BE(t.byteLength,this._offset),this._offset+=4,this._buff.set(t,this._offset),this._offset+=t.byteLength}static sizeVSBuffer(t){return 4+t.byteLength}writeVSBuffer(t){this._buff.writeUInt32BE(t.byteLength,this._offset),this._offset+=4,this._buff.set(t,this._offset),this._offset+=t.byteLength}readVSBuffer(){const t=this._buff.readUInt32BE(this._offset);this._offset+=4;const i=this._buff.slice(this._offset,this._offset+t);return this._offset+=t,i}static sizeMixedArray(t){let i=0;i+=1;for(let r=0,s=t.length;r<s;r++){const n=t[r];switch(i+=1,n.type){case 1:i+=this.sizeLongString(n.value);break;case 2:i+=this.sizeVSBuffer(n.value);break;case 3:i+=this.sizeUInt32,i+=this.sizeLongString(n.value);for(let o=0;o<n.buffers.length;++o)i+=this.sizeVSBuffer(n.buffers[o]);break;case 4:break}}return i}writeMixedArray(t){this._buff.writeUInt8(t.length,this._offset),this._offset+=1;for(let i=0,r=t.length;i<r;i++){const s=t[i];switch(s.type){case 1:this.writeUInt8(1),this.writeLongString(s.value);break;case 2:this.writeUInt8(2),this.writeVSBuffer(s.value);break;case 3:this.writeUInt8(3),this.writeUInt32(s.buffers.length),this.writeLongString(s.value);for(let n=0;n<s.buffers.length;++n)this.writeBuffer(s.buffers[n]);break;case 4:this.writeUInt8(4);break}}}readMixedArray(){const t=this._buff.readUInt8(this._offset);this._offset+=1;const i=new Array(t);for(let r=0;r<t;r++)switch(this.readUInt8()){case 1:i[r]=this.readLongString();break;case 2:i[r]=this.readVSBuffer();break;case 3:{const n=this.readUInt32(),o=this.readLongString(),a=[];for(let l=0;l<n;++l)a.push(this.readVSBuffer());i[r]=new wi(UC(o,a,null));break}case 4:i[r]=void 0;break}return i}},zC;(function(e){e[e.Simple=0]="Simple",e[e.Mixed=1]="Mixed"})(zC||(zC={}));var fr=class{static _useMixedArgSerialization(e){for(let t=0,i=e.length;t<i;t++)if(e[t]instanceof z||e[t]instanceof wi||typeof e[t]>"u")return!0;return!1}static serializeRequestArguments(e,t){if(this._useMixedArgSerialization(e)){const i=[];for(let r=0,s=e.length;r<s;r++){const n=e[r];if(n instanceof z)i[r]={type:2,value:n};else if(typeof n>"u")i[r]={type:4};else if(n instanceof wi){const{jsonString:o,referencedBuffers:a}=HC(n.value,t);i[r]={type:3,value:z.fromString(o),buffers:a}}else i[r]={type:1,value:z.fromString(WC(n,t))}}return{type:1,args:i}}return{type:0,args:WC(e,t)}}static serializeRequest(e,t,i,r,s){switch(r.type){case 0:return this._requestJSONArgs(e,t,i,r.args,s);case 1:return this._requestMixedArgs(e,t,i,r.args,s)}}static _requestJSONArgs(e,t,i,r,s){const n=z.fromString(i),o=z.fromString(r);let a=0;a+=Ot.sizeUInt8(),a+=Ot.sizeShortString(n),a+=Ot.sizeLongString(o);const l=Ot.alloc(s?2:1,e,a);return l.writeUInt8(t),l.writeShortString(n),l.writeLongString(o),l.buffer}static deserializeRequestJSONArgs(e){const t=e.readUInt8(),i=e.readShortString(),r=e.readLongString();return{rpcId:t,method:i,args:JSON.parse(r)}}static _requestMixedArgs(e,t,i,r,s){const n=z.fromString(i);let o=0;o+=Ot.sizeUInt8(),o+=Ot.sizeShortString(n),o+=Ot.sizeMixedArray(r);const a=Ot.alloc(s?4:3,e,o);return a.writeUInt8(t),a.writeShortString(n),a.writeMixedArray(r),a.buffer}static deserializeRequestMixedArgs(e){const t=e.readUInt8(),i=e.readShortString(),r=e.readMixedArray(),s=new Array(r.length);for(let n=0,o=r.length;n<o;n++){const a=r[n];typeof a=="string"?s[n]=JSON.parse(a):s[n]=a}return{rpcId:t,method:i,args:s}}static serializeAcknowledged(e){return Ot.alloc(5,e,0).buffer}static serializeCancel(e){return Ot.alloc(6,e,0).buffer}static serializeReplyOK(e,t,i){if(typeof t>"u")return this._serializeReplyOKEmpty(e);if(t instanceof z)return this._serializeReplyOKVSBuffer(e,t);if(t instanceof wi){const{jsonString:r,referencedBuffers:s}=HC(t.value,i,!0);return this._serializeReplyOKJSONWithBuffers(e,r,s)}else return this._serializeReplyOKJSON(e,t1(t,i))}static _serializeReplyOKEmpty(e){return Ot.alloc(7,e,0).buffer}static _serializeReplyOKVSBuffer(e,t){let i=0;i+=Ot.sizeVSBuffer(t);const r=Ot.alloc(8,e,i);return r.writeVSBuffer(t),r.buffer}static deserializeReplyOKVSBuffer(e){return e.readVSBuffer()}static _serializeReplyOKJSON(e,t){const i=z.fromString(t);let r=0;r+=Ot.sizeLongString(i);const s=Ot.alloc(9,e,r);return s.writeLongString(i),s.buffer}static _serializeReplyOKJSONWithBuffers(e,t,i){const r=z.fromString(t);let s=0;s+=Ot.sizeUInt32,s+=Ot.sizeLongString(r);for(const o of i)s+=Ot.sizeVSBuffer(o);const n=Ot.alloc(10,e,s);n.writeUInt32(i.length),n.writeLongString(r);for(const o of i)n.writeBuffer(o);return n.buffer}static deserializeReplyOKJSON(e){const t=e.readLongString();return JSON.parse(t)}static deserializeReplyOKJSONWithBuffers(e,t){const i=e.readUInt32(),r=e.readLongString(),s=[];for(let n=0;n<i;++n)s.push(e.readVSBuffer());return new wi(UC(r,s,t))}static serializeReplyErr(e,t){const i=t?t1(wa(t),null):void 0;if(typeof i!="string")return this._serializeReplyErrEmpty(e);const r=z.fromString(i);let s=0;s+=Ot.sizeLongString(r);const n=Ot.alloc(11,e,s);return n.writeLongString(r),n.buffer}static deserializeReplyErrError(e){const t=e.readLongString();return JSON.parse(t)}static _serializeReplyErrEmpty(e){return Ot.alloc(12,e,0).buffer}},qC;(function(e){e[e.RequestJSONArgs=1]="RequestJSONArgs",e[e.RequestJSONArgsWithCancellation=2]="RequestJSONArgsWithCancellation",e[e.RequestMixedArgs=3]="RequestMixedArgs",e[e.RequestMixedArgsWithCancellation=4]="RequestMixedArgsWithCancellation",e[e.Acknowledged=5]="Acknowledged",e[e.Cancel=6]="Cancel",e[e.ReplyOKEmpty=7]="ReplyOKEmpty",e[e.ReplyOKVSBuffer=8]="ReplyOKVSBuffer",e[e.ReplyOKJSON=9]="ReplyOKJSON",e[e.ReplyOKJSONWithBuffers=10]="ReplyOKJSONWithBuffers",e[e.ReplyErrError=11]="ReplyErrError",e[e.ReplyErrEmpty=12]="ReplyErrEmpty"})(qC||(qC={}));var jC;(function(e){e[e.String=1]="String",e[e.VSBuffer=2]="VSBuffer",e[e.SerializedObjectWithBuffers=3]="SerializedObjectWithBuffers",e[e.Undefined=4]="Undefined"})(jC||(jC={}));var Rr;(function(e){e.serviceIds=new Map,e.DI_TARGET="$di$target",e.DI_DEPENDENCIES="$di$dependencies";function t(i){return i[e.DI_DEPENDENCIES]||[]}e.getServiceDependencies=t})(Rr||(Rr={}));var Ic=q("instantiationService");function mM(e,t,i){t[Rr.DI_TARGET]===t?t[Rr.DI_DEPENDENCIES].push({id:e,index:i}):(t[Rr.DI_DEPENDENCIES]=[{id:e,index:i}],t[Rr.DI_TARGET]=t)}function q(e){if(Rr.serviceIds.has(e))return Rr.serviceIds.get(e);const t=function(i,r,s){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");mM(t,i,s)};return t.toString=()=>e,Rr.serviceIds.set(e,t),t}function WK(e){return e}function r1(e){if(!e)return;const t=e.indexOf("+");return t<0?e:e.substr(0,t)}var GC=["AI","Azure","Chat","Data Science","Debuggers","Extension Packs","Education","Formatters","Keymaps","Language Packs","Linters","Machine Learning","Notebooks","Programming Languages","SCM Providers","Snippets","Testing","Themes","Visualization","Other"],QC;(function(e){e[e.System=0]="System",e[e.User=1]="User"})(QC||(QC={}));var JC;(function(e){e.WIN32_X64="win32-x64",e.WIN32_ARM64="win32-arm64",e.LINUX_X64="linux-x64",e.LINUX_ARM64="linux-arm64",e.LINUX_ARMHF="linux-armhf",e.ALPINE_X64="alpine-x64",e.ALPINE_ARM64="alpine-arm64",e.DARWIN_X64="darwin-x64",e.DARWIN_ARM64="darwin-arm64",e.WEB="web",e.UNIVERSAL="universal",e.UNKNOWN="unknown",e.UNDEFINED="undefined"})(JC||(JC={}));var qe=class{constructor(e){this.value=e,this._lower=e.toLowerCase()}static equals(e,t){if(typeof e>"u"||e===null)return typeof t>"u"||t===null;if(typeof t>"u"||t===null)return!1;if(typeof e=="string"||typeof t=="string"){const i=typeof e=="string"?e:e.value,r=typeof t=="string"?t:t.value;return kr(i,r)}return e._lower===t._lower}static toKey(e){return typeof e=="string"?e.toLowerCase():e._lower}},mo=class{get size(){return this._set.size}constructor(e){if(this._set=new Set,e)for(const t of e)this.add(t)}add(e){this._set.add(qe.toKey(e))}delete(e){return this._set.delete(qe.toKey(e))}has(e){return this._set.has(qe.toKey(e))}},As=class{constructor(){this._map=new Map}clear(){this._map.clear()}delete(e){this._map.delete(qe.toKey(e))}get(e){return this._map.get(qe.toKey(e))}has(e){return this._map.has(qe.toKey(e))}set(e,t){this._map.set(qe.toKey(e),t)}values(){return this._map.values()}forEach(e){this._map.forEach(e)}[Symbol.iterator](){return this._map[Symbol.iterator]()}},KC=class extends Error{constructor(e,t,i){super(`Error in extension ${qe.toKey(e)}: ${i??t.message}`,{cause:t}),this.name="ExtensionError",this.extension=e}},BK=q("IBuiltinExtensionsScannerService");function s1(e,t){return t&&(e.stack||e.stacktrace)?h(112,null,YC(e),XC(e.stack)||XC(e.stacktrace)):YC(e)}function XC(e){return Array.isArray(e)?e.join(`
`):e}function YC(e){return e.code==="ERR_UNC_HOST_NOT_ALLOWED"?`${e.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof e.code=="string"&&typeof e.errno=="number"&&typeof e.syscall=="string"?h(113,null,e.message):e.message||h(114,null)}function es(e=null,t=!1){if(!e)return h(115,null);if(Array.isArray(e)){const i=Et(e),r=es(i[0],t);return i.length>1?h(116,null,r,i.length):r}if(Oe(e))return e;if(e.detail){const i=e.detail;if(i.error)return s1(i.error,t);if(i.exception)return s1(i.exception,t)}return e.stack?s1(e,t):e.message?e.message:h(117,null)}function Rs(e){return n1(e,0)}function n1(e,t){switch(typeof e){case"object":return e===null?Ls(349,t):Array.isArray(e)?_M(e,t):wM(e,t);case"string":return ZC(e,t);case"boolean":return vM(e,t);case"number":return Ls(e,t);case"undefined":return Ls(937,t);default:return Ls(617,t)}}function Ls(e,t){return(t<<5)-t+e|0}function vM(e,t){return Ls(e?433:863,t)}function ZC(e,t){t=Ls(149417,t);for(let i=0,r=e.length;i<r;i++)t=Ls(e.charCodeAt(i),t);return t}function _M(e,t){return t=Ls(104579,t),e.reduce((i,r)=>n1(r,i),t)}function wM(e,t){return t=Ls(181387,t),Object.keys(e).sort().reduce((i,r)=>(i=ZC(r,i),n1(e[r],i)),t)}var eD;(function(e){e[e.BLOCK_SIZE=64]="BLOCK_SIZE",e[e.UNICODE_REPLACEMENT=65533]="UNICODE_REPLACEMENT"})(eD||(eD={}));function o1(e,t,i=32){const r=i-t,s=~((1<<r)-1);return(e<<t|(s&e)>>>r)>>>0}function Pc(e,t=32){return e instanceof ArrayBuffer?Array.from(new Uint8Array(e)).map(i=>i.toString(16).padStart(2,"0")).join(""):(e>>>0).toString(16).padStart(t/4,"0")}var VK=class $9{static{this._bigBlock32=new DataView(new ArrayBuffer(320))}constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(t){const i=t.length;if(i===0)return;const r=this._buff;let s=this._buffLen,n=this._leftoverHighSurrogate,o,a;for(n!==0?(o=n,a=-1,n=0):(o=t.charCodeAt(0),a=0);;){let l=o;if(fh(o))if(a+1<i){const c=t.charCodeAt(a+1);ph(c)?(a++,l=Pv(o,c)):l=65533}else{n=o;break}else ph(o)&&(l=65533);if(s=this._push(r,s,l),a++,a<i)o=t.charCodeAt(a);else break}this._buffLen=s,this._leftoverHighSurrogate=n}_push(t,i,r){return r<128?t[i++]=r:r<2048?(t[i++]=192|(r&1984)>>>6,t[i++]=128|(r&63)>>>0):r<65536?(t[i++]=224|(r&61440)>>>12,t[i++]=128|(r&4032)>>>6,t[i++]=128|(r&63)>>>0):(t[i++]=240|(r&1835008)>>>18,t[i++]=128|(r&258048)>>>12,t[i++]=128|(r&4032)>>>6,t[i++]=128|(r&63)>>>0),i>=64&&(this._step(),i-=64,this._totalLen+=64,t[0]=t[64],t[1]=t[65],t[2]=t[66]),i}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),Pc(this._h0)+Pc(this._h1)+Pc(this._h2)+Pc(this._h3)+Pc(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,this._buff.subarray(this._buffLen).fill(0),this._buffLen>56&&(this._step(),this._buff.fill(0));const t=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(t/4294967296),!1),this._buffDV.setUint32(60,t%4294967296,!1),this._step()}_step(){const t=$9._bigBlock32,i=this._buffDV;for(let d=0;d<64;d+=4)t.setUint32(d,i.getUint32(d,!1),!1);for(let d=64;d<320;d+=4)t.setUint32(d,o1(t.getUint32(d-12,!1)^t.getUint32(d-32,!1)^t.getUint32(d-56,!1)^t.getUint32(d-64,!1),1),!1);let r=this._h0,s=this._h1,n=this._h2,o=this._h3,a=this._h4,l,c,u;for(let d=0;d<80;d++)d<20?(l=s&n|~s&o,c=1518500249):d<40?(l=s^n^o,c=1859775393):d<60?(l=s&n|s&o|n&o,c=2400959708):(l=s^n^o,c=3395469782),u=o1(r,5)+l+a+c+t.getUint32(d*4,!1)&4294967295,a=o,o=n,n=o1(s,30),s=r,r=u;this._h0=this._h0+r&4294967295,this._h1=this._h1+s&4294967295,this._h2=this._h2+n&4294967295,this._h3=this._h3+o&4294967295,this._h4=this._h4+a&4294967295}},tD;(function(e){e[e.LParen=0]="LParen",e[e.RParen=1]="RParen",e[e.Neg=2]="Neg",e[e.Eq=3]="Eq",e[e.NotEq=4]="NotEq",e[e.Lt=5]="Lt",e[e.LtEq=6]="LtEq",e[e.Gt=7]="Gt",e[e.GtEq=8]="GtEq",e[e.RegexOp=9]="RegexOp",e[e.RegexStr=10]="RegexStr",e[e.True=11]="True",e[e.False=12]="False",e[e.In=13]="In",e[e.Not=14]="Not",e[e.And=15]="And",e[e.Or=16]="Or",e[e.Str=17]="Str",e[e.QuotedStr=18]="QuotedStr",e[e.Error=19]="Error",e[e.EOF=20]="EOF"})(tD||(tD={}));function a1(...e){switch(e.length){case 1:return h(1834,null,e[0]);case 2:return h(1835,null,e[0],e[1]);case 3:return h(1836,null,e[0],e[1],e[2]);default:return}}var yM=h(1837,null),bM=h(1838,null),Tc=class yS{constructor(){this._input="",this._start=0,this._current=0,this._tokens=[],this._errors=[],this.stringRe=/[a-zA-Z0-9_<>\-\./\\:\*\?\+\[\]\^,#@;"%\$\p{L}-]+/uy}static getLexeme(t){switch(t.type){case 0:return"(";case 1:return")";case 2:return"!";case 3:return t.isTripleEq?"===":"==";case 4:return t.isTripleEq?"!==":"!=";case 5:return"<";case 6:return"<=";case 7:return">=";case 8:return">=";case 9:return"=~";case 10:return t.lexeme;case 11:return"true";case 12:return"false";case 13:return"in";case 14:return"not";case 15:return"&&";case 16:return"||";case 17:return t.lexeme;case 18:return t.lexeme;case 19:return t.lexeme;case 20:return"EOF";default:throw dv(`unhandled token type: ${JSON.stringify(t)}; have you forgotten to add a case?`)}}static{this._regexFlags=new Set(["i","g","s","m","y","u"].map(t=>t.charCodeAt(0)))}static{this._keywords=new Map([["not",14],["in",13],["false",12],["true",11]])}get errors(){return this._errors}reset(t){return this._input=t,this._start=0,this._current=0,this._tokens=[],this._errors=[],this}scan(){for(;!this._isAtEnd();)switch(this._start=this._current,this._advance()){case 40:this._addToken(0);break;case 41:this._addToken(1);break;case 33:if(this._match(61)){const i=this._match(61);this._tokens.push({type:4,offset:this._start,isTripleEq:i})}else this._addToken(2);break;case 39:this._quotedString();break;case 47:this._regex();break;case 61:if(this._match(61)){const i=this._match(61);this._tokens.push({type:3,offset:this._start,isTripleEq:i})}else this._match(126)?this._addToken(9):this._error(a1("==","=~"));break;case 60:this._addToken(this._match(61)?6:5);break;case 62:this._addToken(this._match(61)?8:7);break;case 38:this._match(38)?this._addToken(15):this._error(a1("&&"));break;case 124:this._match(124)?this._addToken(16):this._error(a1("||"));break;case 32:case 13:case 9:case 10:case 160:break;default:this._string()}return this._start=this._current,this._addToken(20),Array.from(this._tokens)}_match(t){return this._isAtEnd()||this._input.charCodeAt(this._current)!==t?!1:(this._current++,!0)}_advance(){return this._input.charCodeAt(this._current++)}_peek(){return this._isAtEnd()?0:this._input.charCodeAt(this._current)}_addToken(t){this._tokens.push({type:t,offset:this._start})}_error(t){const i=this._start,r=this._input.substring(this._start,this._current),s={type:19,offset:this._start,lexeme:r};this._errors.push({offset:i,lexeme:r,additionalInfo:t}),this._tokens.push(s)}_string(){this.stringRe.lastIndex=this._start;const t=this.stringRe.exec(this._input);if(t){this._current=this._start+t[0].length;const i=this._input.substring(this._start,this._current),r=yS._keywords.get(i);r?this._addToken(r):this._tokens.push({type:17,lexeme:i,offset:this._start})}}_quotedString(){for(;this._peek()!==39&&!this._isAtEnd();)this._advance();if(this._isAtEnd()){this._error(yM);return}this._advance(),this._tokens.push({type:18,lexeme:this._input.substring(this._start+1,this._current-1),offset:this._start+1})}_regex(){let t=this._current,i=!1,r=!1;for(;;){if(t>=this._input.length){this._current=t,this._error(bM);return}const n=this._input.charCodeAt(t);if(i)i=!1;else if(n===47&&!r){t++;break}else n===91?r=!0:n===92?i=!0:n===93&&(r=!1);t++}for(;t<this._input.length&&yS._regexFlags.has(this._input.charCodeAt(t));)t++;this._current=t;const s=this._input.substring(this._start,this._current);this._tokens.push({type:10,lexeme:s,offset:this._start})}_isAtEnd(){return this._current>=this._input.length}},ii=new Map;ii.set("false",!1),ii.set("true",!0),ii.set("isMac",Mt),ii.set("isLinux",Ct),ii.set("isWindows",Ve),ii.set("isWeb",Ca),ii.set("isMacNative",Mt&&!Ca),ii.set("isEdge",Nx),ii.set("isFirefox",TL),ii.set("isChrome",xv),ii.set("isSafari",AL);var SM=Object.prototype.hasOwnProperty,iD;(function(e){e[e.False=0]="False",e[e.True=1]="True",e[e.Defined=2]="Defined",e[e.Not=3]="Not",e[e.Equals=4]="Equals",e[e.NotEquals=5]="NotEquals",e[e.And=6]="And",e[e.Regex=7]="Regex",e[e.NotRegex=8]="NotRegex",e[e.Or=9]="Or",e[e.In=10]="In",e[e.NotIn=11]="NotIn",e[e.Greater=12]="Greater",e[e.GreaterEquals=13]="GreaterEquals",e[e.Smaller=14]="Smaller",e[e.SmallerEquals=15]="SmallerEquals"})(iD||(iD={}));var xM={regexParsingWithErrorRecovery:!0},EM=h(1814,null),CM=h(1815,null),DM=h(1816,null),rD=h(1817,null),kM=h(1818,null),IM=h(1819,null),PM=h(1820,null),TM=h(1821,null),sD=class Wd{static{this._parseError=new Error}get lexingErrors(){return this._scanner.errors}get parsingErrors(){return this._parsingErrors}constructor(t=xM){this._config=t,this._scanner=new Tc,this._tokens=[],this._current=0,this._parsingErrors=[],this._flagsGYRe=/g|y/g}parse(t){if(t===""){this._parsingErrors.push({message:EM,offset:0,lexeme:"",additionalInfo:CM});return}this._tokens=this._scanner.reset(t).scan(),this._current=0,this._parsingErrors=[];try{const i=this._expr();if(!this._isAtEnd()){const r=this._peek(),s=r.type===17?IM:void 0;throw this._parsingErrors.push({message:kM,offset:r.offset,lexeme:Tc.getLexeme(r),additionalInfo:s}),Wd._parseError}return i}catch(i){if(i!==Wd._parseError)throw i;return}}_expr(){return this._or()}_or(){const t=[this._and()];for(;this._matchOne(16);){const i=this._and();t.push(i)}return t.length===1?t[0]:Ut.or(...t)}_and(){const t=[this._term()];for(;this._matchOne(15);){const i=this._term();t.push(i)}return t.length===1?t[0]:Ut.and(...t)}_term(){if(this._matchOne(2)){const t=this._peek();switch(t.type){case 11:return this._advance(),Di.INSTANCE;case 12:return this._advance(),zi.INSTANCE;case 0:{this._advance();const i=this._expr();return this._consume(1,rD),i?.negate()}case 17:return this._advance(),Lc.create(t.lexeme);default:throw this._errExpectedButGot("KEY | true | false | '(' expression ')'",t)}}return this._primary()}_primary(){const t=this._peek();switch(t.type){case 11:return this._advance(),Ut.true();case 12:return this._advance(),Ut.false();case 0:{this._advance();const i=this._expr();return this._consume(1,rD),i}case 17:{const i=t.lexeme;if(this._advance(),this._matchOne(9)){const s=this._peek();if(!this._config.regexParsingWithErrorRecovery){if(this._advance(),s.type!==10)throw this._errExpectedButGot("REGEX",s);const n=s.lexeme,o=n.lastIndexOf("/"),a=o===n.length-1?void 0:this._removeFlagsGY(n.substring(o+1));let l;try{l=new RegExp(n.substring(1,o),a)}catch{throw this._errExpectedButGot("REGEX",s)}return f1.create(i,l)}switch(s.type){case 10:case 19:{const n=[s.lexeme];this._advance();let o=this._peek(),a=0;for(let f=0;f<s.lexeme.length;f++)s.lexeme.charCodeAt(f)===40?a++:s.lexeme.charCodeAt(f)===41&&a--;for(;!this._isAtEnd()&&o.type!==15&&o.type!==16;){switch(o.type){case 0:a++;break;case 1:a--;break;case 10:case 18:for(let f=0;f<o.lexeme.length;f++)o.lexeme.charCodeAt(f)===40?a++:s.lexeme.charCodeAt(f)===41&&a--}if(a<0)break;n.push(Tc.getLexeme(o)),this._advance(),o=this._peek()}const l=n.join(""),c=l.lastIndexOf("/"),u=c===l.length-1?void 0:this._removeFlagsGY(l.substring(c+1));let d;try{d=new RegExp(l.substring(1,c),u)}catch{throw this._errExpectedButGot("REGEX",s)}return Ut.regex(i,d)}case 18:{const n=s.lexeme;this._advance();let o=null;if(!dh(n)){const a=n.indexOf("/"),l=n.lastIndexOf("/");if(a!==l&&a>=0){const c=n.slice(a+1,l),u=n[l+1]==="i"?"i":"";try{o=new RegExp(c,u)}catch{throw this._errExpectedButGot("REGEX",s)}}}if(o===null)throw this._errExpectedButGot("REGEX",s);return f1.create(i,o)}default:throw this._errExpectedButGot("REGEX",this._peek())}}if(this._matchOne(14)){this._consume(13,DM);const s=this._value();return Ut.notIn(i,s)}switch(this._peek().type){case 3:{this._advance();const s=this._value();if(this._previous().type===18)return Ut.equals(i,s);switch(s){case"true":return Ut.has(i);case"false":return Ut.not(i);default:return Ut.equals(i,s)}}case 4:{this._advance();const s=this._value();if(this._previous().type===18)return Ut.notEquals(i,s);switch(s){case"true":return Ut.not(i);case"false":return Ut.has(i);default:return Ut.notEquals(i,s)}}case 5:return this._advance(),d1.create(i,this._value());case 6:return this._advance(),h1.create(i,this._value());case 7:return this._advance(),Fh.create(i,this._value());case 8:return this._advance(),u1.create(i,this._value());case 13:return this._advance(),Ut.in(i,this._value());default:return Ut.has(i)}}case 20:throw this._parsingErrors.push({message:PM,offset:t.offset,lexeme:"",additionalInfo:TM}),Wd._parseError;default:throw this._errExpectedButGot(`true | false | KEY 
	| KEY '=~' REGEX 
	| KEY ('==' | '!=' | '<' | '<=' | '>' | '>=' | 'in' | 'not' 'in') value`,this._peek())}}_value(){const t=this._peek();switch(t.type){case 17:case 18:return this._advance(),t.lexeme;case 11:return this._advance(),"true";case 12:return this._advance(),"false";case 13:return this._advance(),"in";default:return""}}_removeFlagsGY(t){return t.replaceAll(this._flagsGYRe,"")}_previous(){return this._tokens[this._current-1]}_matchOne(t){return this._check(t)?(this._advance(),!0):!1}_advance(){return this._isAtEnd()||this._current++,this._previous()}_consume(t,i){if(this._check(t))return this._advance();throw this._errExpectedButGot(i,this._peek())}_errExpectedButGot(t,i,r){const s=h(1822,null,t,Tc.getLexeme(i)),n=i.offset,o=Tc.getLexeme(i);return this._parsingErrors.push({message:s,offset:n,lexeme:o,additionalInfo:r}),Wd._parseError}_check(t){return this._peek().type===t}_peek(){return this._tokens[this._current]}_isAtEnd(){return this._peek().type===20}},Ut=class{static false(){return Di.INSTANCE}static true(){return zi.INSTANCE}static has(e){return Rc.create(e)}static equals(e,t){return l1.create(e,t)}static notEquals(e,t){return c1.create(e,t)}static regex(e,t){return f1.create(e,t)}static in(e,t){return nD.create(e,t)}static notIn(e,t){return oD.create(e,t)}static not(e){return Lc.create(e)}static and(...e){return lD.create(e,null,!0)}static or(...e){return p1.create(e,null,!0)}static greater(e,t){return Fh.create(e,t)}static greaterEquals(e,t){return u1.create(e,t)}static smaller(e,t){return d1.create(e,t)}static smallerEquals(e,t){return h1.create(e,t)}static{this._parser=new sD({regexParsingWithErrorRecovery:!1})}static deserialize(e){return e==null?void 0:this._parser.parse(e)}};function AM(e){const t=new sD({regexParsingWithErrorRecovery:!1});return e.map(i=>(t.parse(i),t.lexingErrors.length>0?t.lexingErrors.map(r=>({errorMessage:r.additionalInfo?h(1823,null,r.additionalInfo):h(1824,null),offset:r.offset,length:r.lexeme.length})):t.parsingErrors.length>0?t.parsingErrors.map(r=>({errorMessage:r.additionalInfo?`${r.message}. ${r.additionalInfo}`:r.message,offset:r.offset,length:r.lexeme.length})):[]))}function Ac(e,t){return e.cmp(t)}var Di=class H9{static{this.INSTANCE=new H9}constructor(){this.type=0}cmp(t){return this.type-t.type}equals(t){return t.type===this.type}substituteConstants(){return this}evaluate(t){return!1}serialize(){return"false"}keys(){return[]}map(t){return this}negate(){return zi.INSTANCE}},zi=class U9{static{this.INSTANCE=new U9}constructor(){this.type=1}cmp(t){return this.type-t.type}equals(t){return t.type===this.type}substituteConstants(){return this}evaluate(t){return!0}serialize(){return"true"}keys(){return[]}map(t){return this}negate(){return Di.INSTANCE}},Rc=class W9{static create(t,i=null){const r=ii.get(t);return typeof r=="boolean"?r?zi.INSTANCE:Di.INSTANCE:new W9(t,i)}constructor(t,i){this.key=t,this.negated=i,this.type=2}cmp(t){return t.type!==this.type?this.type-t.type:cD(this.key,t.key)}equals(t){return t.type===this.type?this.key===t.key:!1}substituteConstants(){const t=ii.get(this.key);return typeof t=="boolean"?t?zi.INSTANCE:Di.INSTANCE:this}evaluate(t){return!!t.getValue(this.key)}serialize(){return this.key}keys(){return[this.key]}map(t){return t.mapDefined(this.key)}negate(){return this.negated||(this.negated=Lc.create(this.key,this)),this.negated}},l1=class B9{static create(t,i,r=null){if(typeof i=="boolean")return i?Rc.create(t,r):Lc.create(t,r);const s=ii.get(t);return typeof s=="boolean"?i===(s?"true":"false")?zi.INSTANCE:Di.INSTANCE:new B9(t,i,r)}constructor(t,i,r){this.key=t,this.value=i,this.negated=r,this.type=4}cmp(t){return t.type!==this.type?this.type-t.type:vo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){const t=ii.get(this.key);if(typeof t=="boolean"){const i=t?"true":"false";return this.value===i?zi.INSTANCE:Di.INSTANCE}return this}evaluate(t){return t.getValue(this.key)==this.value}serialize(){return`${this.key} == '${this.value}'`}keys(){return[this.key]}map(t){return t.mapEquals(this.key,this.value)}negate(){return this.negated||(this.negated=c1.create(this.key,this.value,this)),this.negated}},nD=class V9{static create(t,i){return new V9(t,i)}constructor(t,i){this.key=t,this.valueKey=i,this.type=10,this.negated=null}cmp(t){return t.type!==this.type?this.type-t.type:vo(this.key,this.valueKey,t.key,t.valueKey)}equals(t){return t.type===this.type?this.key===t.key&&this.valueKey===t.valueKey:!1}substituteConstants(){return this}evaluate(t){const i=t.getValue(this.valueKey),r=t.getValue(this.key);return Array.isArray(i)?i.includes(r):typeof r=="string"&&typeof i=="object"&&i!==null?SM.call(i,r):!1}serialize(){return`${this.key} in '${this.valueKey}'`}keys(){return[this.key,this.valueKey]}map(t){return t.mapIn(this.key,this.valueKey)}negate(){return this.negated||(this.negated=oD.create(this.key,this.valueKey)),this.negated}},oD=class z9{static create(t,i){return new z9(t,i)}constructor(t,i){this.key=t,this.valueKey=i,this.type=11,this._negated=nD.create(t,i)}cmp(t){return t.type!==this.type?this.type-t.type:this._negated.cmp(t._negated)}equals(t){return t.type===this.type?this._negated.equals(t._negated):!1}substituteConstants(){return this}evaluate(t){return!this._negated.evaluate(t)}serialize(){return`${this.key} not in '${this.valueKey}'`}keys(){return this._negated.keys()}map(t){return t.mapNotIn(this.key,this.valueKey)}negate(){return this._negated}},c1=class q9{static create(t,i,r=null){if(typeof i=="boolean")return i?Lc.create(t,r):Rc.create(t,r);const s=ii.get(t);return typeof s=="boolean"?i===(s?"true":"false")?Di.INSTANCE:zi.INSTANCE:new q9(t,i,r)}constructor(t,i,r){this.key=t,this.value=i,this.negated=r,this.type=5}cmp(t){return t.type!==this.type?this.type-t.type:vo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){const t=ii.get(this.key);if(typeof t=="boolean"){const i=t?"true":"false";return this.value===i?Di.INSTANCE:zi.INSTANCE}return this}evaluate(t){return t.getValue(this.key)!=this.value}serialize(){return`${this.key} != '${this.value}'`}keys(){return[this.key]}map(t){return t.mapNotEquals(this.key,this.value)}negate(){return this.negated||(this.negated=l1.create(this.key,this.value,this)),this.negated}},Lc=class j9{static create(t,i=null){const r=ii.get(t);return typeof r=="boolean"?r?Di.INSTANCE:zi.INSTANCE:new j9(t,i)}constructor(t,i){this.key=t,this.negated=i,this.type=3}cmp(t){return t.type!==this.type?this.type-t.type:cD(this.key,t.key)}equals(t){return t.type===this.type?this.key===t.key:!1}substituteConstants(){const t=ii.get(this.key);return typeof t=="boolean"?t?Di.INSTANCE:zi.INSTANCE:this}evaluate(t){return!t.getValue(this.key)}serialize(){return`!${this.key}`}keys(){return[this.key]}map(t){return t.mapNot(this.key)}negate(){return this.negated||(this.negated=Rc.create(this.key,this)),this.negated}};function Oh(e,t){if(typeof e=="string"){const i=parseFloat(e);isNaN(i)||(e=i)}return typeof e=="string"||typeof e=="number"?t(e):Di.INSTANCE}var Fh=class G9{static create(t,i,r=null){return Oh(i,s=>new G9(t,s,r))}constructor(t,i,r){this.key=t,this.value=i,this.negated=r,this.type=12}cmp(t){return t.type!==this.type?this.type-t.type:vo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))>this.value}serialize(){return`${this.key} > ${this.value}`}keys(){return[this.key]}map(t){return t.mapGreater(this.key,this.value)}negate(){return this.negated||(this.negated=h1.create(this.key,this.value,this)),this.negated}},u1=class Q9{static create(t,i,r=null){return Oh(i,s=>new Q9(t,s,r))}constructor(t,i,r){this.key=t,this.value=i,this.negated=r,this.type=13}cmp(t){return t.type!==this.type?this.type-t.type:vo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))>=this.value}serialize(){return`${this.key} >= ${this.value}`}keys(){return[this.key]}map(t){return t.mapGreaterEquals(this.key,this.value)}negate(){return this.negated||(this.negated=d1.create(this.key,this.value,this)),this.negated}},d1=class J9{static create(t,i,r=null){return Oh(i,s=>new J9(t,s,r))}constructor(t,i,r){this.key=t,this.value=i,this.negated=r,this.type=14}cmp(t){return t.type!==this.type?this.type-t.type:vo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))<this.value}serialize(){return`${this.key} < ${this.value}`}keys(){return[this.key]}map(t){return t.mapSmaller(this.key,this.value)}negate(){return this.negated||(this.negated=u1.create(this.key,this.value,this)),this.negated}},h1=class K9{static create(t,i,r=null){return Oh(i,s=>new K9(t,s,r))}constructor(t,i,r){this.key=t,this.value=i,this.negated=r,this.type=15}cmp(t){return t.type!==this.type?this.type-t.type:vo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))<=this.value}serialize(){return`${this.key} <= ${this.value}`}keys(){return[this.key]}map(t){return t.mapSmallerEquals(this.key,this.value)}negate(){return this.negated||(this.negated=Fh.create(this.key,this.value,this)),this.negated}},f1=class X9{static create(t,i){return new X9(t,i)}constructor(t,i){this.key=t,this.regexp=i,this.type=7,this.negated=null}cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.key<t.key)return-1;if(this.key>t.key)return 1;const i=this.regexp?this.regexp.source:"",r=t.regexp?t.regexp.source:"";return i<r?-1:i>r?1:0}equals(t){if(t.type===this.type){const i=this.regexp?this.regexp.source:"",r=t.regexp?t.regexp.source:"";return this.key===t.key&&i===r}return!1}substituteConstants(){return this}evaluate(t){const i=t.getValue(this.key);return this.regexp?this.regexp.test(i):!1}serialize(){const t=this.regexp?`/${this.regexp.source}/${this.regexp.flags}`:"/invalid/";return`${this.key} =~ ${t}`}keys(){return[this.key]}map(t){return t.mapRegex(this.key,this.regexp)}negate(){return this.negated||(this.negated=RM.create(this)),this.negated}},RM=class bS{static create(t){return new bS(t)}constructor(t){this._actual=t,this.type=8}cmp(t){return t.type!==this.type?this.type-t.type:this._actual.cmp(t._actual)}equals(t){return t.type===this.type?this._actual.equals(t._actual):!1}substituteConstants(){return this}evaluate(t){return!this._actual.evaluate(t)}serialize(){return`!(${this._actual.serialize()})`}keys(){return this._actual.keys()}map(t){return new bS(this._actual.map(t))}negate(){return this._actual}};function aD(e){let t=null;for(let i=0,r=e.length;i<r;i++){const s=e[i].substituteConstants();if(e[i]!==s&&t===null){t=[];for(let n=0;n<i;n++)t[n]=e[n]}t!==null&&(t[i]=s)}return t===null?e:t}var lD=class ic{static create(t,i,r){return ic._normalizeArr(t,i,r)}constructor(t,i){this.expr=t,this.negated=i,this.type=6}cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.expr.length<t.expr.length)return-1;if(this.expr.length>t.expr.length)return 1;for(let i=0,r=this.expr.length;i<r;i++){const s=Ac(this.expr[i],t.expr[i]);if(s!==0)return s}return 0}equals(t){if(t.type===this.type){if(this.expr.length!==t.expr.length)return!1;for(let i=0,r=this.expr.length;i<r;i++)if(!this.expr[i].equals(t.expr[i]))return!1;return!0}return!1}substituteConstants(){const t=aD(this.expr);return t===this.expr?this:ic.create(t,this.negated,!1)}evaluate(t){for(let i=0,r=this.expr.length;i<r;i++)if(!this.expr[i].evaluate(t))return!1;return!0}static _normalizeArr(t,i,r){const s=[];let n=!1;for(const o of t)if(o){if(o.type===1){n=!0;continue}if(o.type===0)return Di.INSTANCE;if(o.type===6){s.push(...o.expr);continue}s.push(o)}if(s.length===0&&n)return zi.INSTANCE;if(s.length!==0){if(s.length===1)return s[0];s.sort(Ac);for(let o=1;o<s.length;o++)s[o-1].equals(s[o])&&(s.splice(o,1),o--);if(s.length===1)return s[0];for(;s.length>1;){const o=s[s.length-1];if(o.type!==9)break;s.pop();const a=s.pop(),l=s.length===0,c=p1.create(o.expr.map(u=>ic.create([u,a],null,r)),null,l);c&&(s.push(c),s.sort(Ac))}if(s.length===1)return s[0];if(r){for(let o=0;o<s.length;o++)for(let a=o+1;a<s.length;a++)if(s[o].negate().equals(s[a]))return Di.INSTANCE;if(s.length===1)return s[0]}return new ic(s,i)}}serialize(){return this.expr.map(t=>t.serialize()).join(" && ")}keys(){const t=[];for(const i of this.expr)t.push(...i.keys());return t}map(t){return new ic(this.expr.map(i=>i.map(t)),null)}negate(){if(!this.negated){const t=[];for(const i of this.expr)t.push(i.negate());this.negated=p1.create(t,this,!0)}return this.negated}},p1=class ua{static create(t,i,r){return ua._normalizeArr(t,i,r)}constructor(t,i){this.expr=t,this.negated=i,this.type=9}cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.expr.length<t.expr.length)return-1;if(this.expr.length>t.expr.length)return 1;for(let i=0,r=this.expr.length;i<r;i++){const s=Ac(this.expr[i],t.expr[i]);if(s!==0)return s}return 0}equals(t){if(t.type===this.type){if(this.expr.length!==t.expr.length)return!1;for(let i=0,r=this.expr.length;i<r;i++)if(!this.expr[i].equals(t.expr[i]))return!1;return!0}return!1}substituteConstants(){const t=aD(this.expr);return t===this.expr?this:ua.create(t,this.negated,!1)}evaluate(t){for(let i=0,r=this.expr.length;i<r;i++)if(this.expr[i].evaluate(t))return!0;return!1}static _normalizeArr(t,i,r){let s=[],n=!1;if(t){for(let o=0,a=t.length;o<a;o++){const l=t[o];if(l){if(l.type===0){n=!0;continue}if(l.type===1)return zi.INSTANCE;if(l.type===9){s=s.concat(l.expr);continue}s.push(l)}}if(s.length===0&&n)return Di.INSTANCE;s.sort(Ac)}if(s.length!==0){if(s.length===1)return s[0];for(let o=1;o<s.length;o++)s[o-1].equals(s[o])&&(s.splice(o,1),o--);if(s.length===1)return s[0];if(r){for(let o=0;o<s.length;o++)for(let a=o+1;a<s.length;a++)if(s[o].negate().equals(s[a]))return zi.INSTANCE;if(s.length===1)return s[0]}return new ua(s,i)}}serialize(){return this.expr.map(t=>t.serialize()).join(" || ")}keys(){const t=[];for(const i of this.expr)t.push(...i.keys());return t}map(t){return new ua(this.expr.map(i=>i.map(t)),null)}negate(){if(!this.negated){const t=[];for(const i of this.expr)t.push(i.negate());for(;t.length>1;){const i=t.shift(),r=t.shift(),s=[];for(const n of uD(i))for(const o of uD(r))s.push(lD.create([n,o],null,!1));t.unshift(ua.create(s,null,!1))}this.negated=ua.create(t,this,!0)}return this.negated}},I=class qm extends Rc{static{this._info=[]}static all(){return qm._info.values()}constructor(t,i,r){super(t,null),this._defaultValue=i,typeof r=="object"?qm._info.push({...r,key:t}):r!==!0&&qm._info.push({key:t,description:r,type:i!=null?typeof i:void 0})}bindTo(t){return t.createKey(this.key,this._defaultValue)}getValue(t){return t.getContextKeyValue(this.key)}toNegated(){return this.negate()}isEqualTo(t){return l1.create(this.key,t)}notEqualsTo(t){return c1.create(this.key,t)}greater(t){return Fh.create(this.key,t)}},$h=q("contextKeyService");function cD(e,t){return e<t?-1:e>t?1:0}function vo(e,t,i,r){return e<i?-1:e>i?1:t<r?-1:t>r?1:0}function uD(e){return e.type===9?e.expr:[e]}var ke=q("logService"),La=q("loggerService"),ae;(function(e){e[e.Off=0]="Off",e[e.Trace=1]="Trace",e[e.Debug=2]="Debug",e[e.Info=3]="Info",e[e.Warning=4]="Warning",e[e.Error=5]="Error"})(ae||(ae={}));var LM=ae.Info;function NM(e,t){return e!==ae.Off&&e<=t}function MM(e,t,i){switch(t){case ae.Trace:e.trace(i);break;case ae.Debug:e.debug(i);break;case ae.Info:e.info(i);break;case ae.Warning:e.warn(i);break;case ae.Error:e.error(i);break;case ae.Off:break;default:throw new Error(`Invalid log level ${t}`)}}function Na(e,t=!1){let i="";for(let r=0;r<e.length;r++){let s=e[r];if(s instanceof Error&&(s=es(s,t)),typeof s=="object")try{s=JSON.stringify(s)}catch{}i+=(r>0?" ":"")+s}return i}var dD=class extends X{constructor(){super(...arguments),this.level=LM,this._onDidChangeLogLevel=this._register(new D),this.onDidChangeLogLevel=this._onDidChangeLogLevel.event}setLevel(e){this.level!==e&&(this.level=e,this._onDidChangeLogLevel.fire(this.level))}getLevel(){return this.level}checkLogLevel(e){return NM(this.level,e)}canLog(e){return this._store.isDisposed?!1:this.checkLogLevel(e)}},g1=class extends dD{constructor(e){super(),this.logAlways=e}checkLogLevel(e){return this.logAlways||super.checkLogLevel(e)}trace(e,...t){this.canLog(ae.Trace)&&this.log(ae.Trace,Na([e,...t],!0))}debug(e,...t){this.canLog(ae.Debug)&&this.log(ae.Debug,Na([e,...t]))}info(e,...t){this.canLog(ae.Info)&&this.log(ae.Info,Na([e,...t]))}warn(e,...t){this.canLog(ae.Warning)&&this.log(ae.Warning,Na([e,...t]))}error(e,...t){if(this.canLog(ae.Error))if(e instanceof Error){const i=Array.prototype.slice.call(arguments);i[0]=e.stack,this.log(ae.Error,Na(i))}else this.log(ae.Error,Na([e,...t]))}flush(){}},OM=class extends dD{constructor(e){super(),this.loggers=e,e.length&&this.setLevel(e[0].getLevel())}setLevel(e){for(const t of this.loggers)t.setLevel(e);super.setLevel(e)}trace(e,...t){for(const i of this.loggers)i.trace(e,...t)}debug(e,...t){for(const i of this.loggers)i.debug(e,...t)}info(e,...t){for(const i of this.loggers)i.info(e,...t)}warn(e,...t){for(const i of this.loggers)i.warn(e,...t)}error(e,...t){for(const i of this.loggers)i.error(e,...t)}flush(){for(const e of this.loggers)e.flush()}dispose(){for(const e of this.loggers)e.dispose();super.dispose()}},FM=class extends X{constructor(e,t,i){if(super(),this.logLevel=e,this.logsHome=t,this._loggers=new Vt,this._onDidChangeLoggers=this._register(new D),this.onDidChangeLoggers=this._onDidChangeLoggers.event,this._onDidChangeLogLevel=this._register(new D),this.onDidChangeLogLevel=this._onDidChangeLogLevel.event,this._onDidChangeVisibility=this._register(new D),this.onDidChangeVisibility=this._onDidChangeVisibility.event,i)for(const r of i)this._loggers.set(r.resource,{logger:void 0,info:r})}getLoggerEntry(e){return Oe(e)?[...this._loggers.values()].find(t=>t.info.id===e):this._loggers.get(e)}getLogger(e){return this.getLoggerEntry(e)?.logger}createLogger(e,t){const i=this.toResource(e),r=Oe(e)?e:t?.id??Rs(i.toString()).toString(16);let s=this._loggers.get(i)?.logger;const n=t?.logLevel==="always"?ae.Trace:t?.logLevel;s||(s=this.doCreateLogger(i,n??this.getLogLevel(i)??this.logLevel,{...t,id:r}));const o={logger:s,info:{resource:i,id:r,logLevel:n,name:t?.name,hidden:t?.hidden,group:t?.group,extensionId:t?.extensionId,when:t?.when}};return this.registerLogger(o.info),this._loggers.set(i,o),s}toResource(e){return Oe(e)?Dt(this.logsHome,`${e}.log`):e}setLogLevel(e,t){if(b.isUri(e)){const i=e,r=t,s=this._loggers.get(i);s&&r!==s.info.logLevel&&(s.info.logLevel=r===this.logLevel?void 0:r,s.logger?.setLevel(r),this._loggers.set(s.info.resource,s),this._onDidChangeLogLevel.fire([i,r]))}else{this.logLevel=e;for(const[i,r]of this._loggers.entries())this._loggers.get(i)?.info.logLevel===void 0&&r.logger?.setLevel(this.logLevel);this._onDidChangeLogLevel.fire(this.logLevel)}}setVisibility(e,t){const i=this.getLoggerEntry(e);i&&t!==!i.info.hidden&&(i.info.hidden=!t,this._loggers.set(i.info.resource,i),this._onDidChangeVisibility.fire([i.info.resource,t]))}getLogLevel(e){let t;return e&&(t=this._loggers.get(e)?.info.logLevel),t??this.logLevel}registerLogger(e){const t=this._loggers.get(e.resource);t?t.info.hidden!==e.hidden&&this.setVisibility(e.resource,!e.hidden):(this._loggers.set(e.resource,{info:e,logger:void 0}),this._onDidChangeLoggers.fire({added:[e],removed:[]}))}deregisterLogger(e){const t=this.toResource(e),i=this._loggers.get(t);i&&(i.logger&&i.logger.dispose(),this._loggers.delete(t),this._onDidChangeLoggers.fire({added:[],removed:[i.info]}))}*getRegisteredLoggers(){for(const e of this._loggers.values())yield e.info}getRegisteredLogger(e){return this._loggers.get(e)?.info}dispose(){this._loggers.forEach(e=>e.logger?.dispose()),this._loggers.clear(),super.dispose()}};function $M(e){switch(e){case ae.Trace:return"trace";case ae.Debug:return"debug";case ae.Info:return"info";case ae.Warning:return"warn";case ae.Error:return"error";case ae.Off:return"off"}}function HM(e){switch(e){case"trace":return ae.Trace;case"debug":return ae.Debug;case"info":return ae.Info;case"warn":return ae.Warning;case"error":return ae.Error;case"critical":return ae.Error;case"off":return ae.Off}}var zK=new I("logLevel",$M(ae.Info)),ts=class{constructor(e,t=[],i=!1){this.ctor=e,this.staticArguments=t,this.supportsDelayedInstantiation=i}},hD=[],fD;(function(e){e[e.Eager=0]="Eager",e[e.Delayed=1]="Delayed"})(fD||(fD={}));function Ne(e,t,i){t instanceof ts||(t=new ts(t,[],!!i)),hD.push([e,t])}function UM(){return hD}var m1=class{constructor(...e){this._entries=new Map;for(const[t,i]of e)this.set(t,i)}set(e,t){const i=this._entries.get(e);return this._entries.set(e,t),i}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}},zt=q("IExtHostInitDataService"),WM=class{constructor(e,t){this.key=e,this.data=t,this.incoming=new Map,this.outgoing=new Map}},pD=class{constructor(e){this._hashFn=e,this._nodes=new Map}roots(){const e=[];for(const t of this._nodes.values())t.outgoing.size===0&&e.push(t);return e}insertEdge(e,t){const i=this.lookupOrInsertNode(e),r=this.lookupOrInsertNode(t);i.outgoing.set(r.key,r),r.incoming.set(i.key,i)}removeNode(e){const t=this._hashFn(e);this._nodes.delete(t);for(const i of this._nodes.values())i.outgoing.delete(t),i.incoming.delete(t)}lookupOrInsertNode(e){const t=this._hashFn(e);let i=this._nodes.get(t);return i||(i=new WM(t,e),this._nodes.set(t,i)),i}lookup(e){return this._nodes.get(this._hashFn(e))}isEmpty(){return this._nodes.size===0}toString(){const e=[];for(const[t,i]of this._nodes)e.push(`${t}
	(-> incoming)[${[...i.incoming.keys()].join(", ")}]
	(outgoing ->)[${[...i.outgoing.keys()].join(",")}]
`);return e.join(`
`)}findCycleSlow(){for(const[e,t]of this._nodes){const i=new Set([e]),r=this._findCycle(t,i);if(r)return r}}_findCycle(e,t){for(const[i,r]of e.outgoing){if(t.has(i))return[...t,i].join(" -> ");t.add(i);const s=this._findCycle(r,t);if(s)return s;t.delete(i)}}},BM=!1,gD=class extends Error{constructor(e){super("cyclic dependency between services"),this.message=e.findCycleSlow()??`UNABLE to detect cycle, dumping graph: 
${e.toString()}`}},VM=class SS{constructor(t=new m1,i=!1,r,s=BM){this._services=t,this._strict=i,this._parent=r,this._enableTracing=s,this._isDisposed=!1,this._servicesToMaybeDispose=new Set,this._children=new Set,this._activeInstantiations=new Set,this._services.set(Ic,this),this._globalGraph=s?r?._globalGraph??new pD(n=>n):void 0}dispose(){if(!this._isDisposed){this._isDisposed=!0,Cr(this._children),this._children.clear();for(const t of this._servicesToMaybeDispose)px(t)&&t.dispose();this._servicesToMaybeDispose.clear()}}_throwIfDisposed(){if(this._isDisposed)throw new Error("InstantiationService has been disposed")}createChild(t,i){this._throwIfDisposed();const r=this,s=new class extends SS{dispose(){r._children.delete(s),super.dispose()}}(t,this._strict,this,this._enableTracing);return this._children.add(s),i?.add(s),s}invokeFunction(t,...i){this._throwIfDisposed();const r=v1.traceInvocation(this._enableTracing,t);let s=!1;try{return t({get:o=>{if(s)throw dv("service accessor is only valid during the invocation of its target method");const a=this._getOrCreateServiceInstance(o,r);if(!a)throw new Error(`[invokeFunction] unknown service '${o}'`);return a}},...i)}finally{s=!0,r.stop()}}createInstance(t,...i){this._throwIfDisposed();let r,s;return t instanceof ts?(r=v1.traceCreation(this._enableTracing,t.ctor),s=this._createInstance(t.ctor,t.staticArguments.concat(i),r)):(r=v1.traceCreation(this._enableTracing,t),s=this._createInstance(t,i,r)),r.stop(),s}_createInstance(t,i=[],r){const s=Rr.getServiceDependencies(t).sort((a,l)=>a.index-l.index),n=[];for(const a of s){const l=this._getOrCreateServiceInstance(a.id,r);l||this._throwIfStrict(`[createInstance] ${t.name} depends on UNKNOWN service ${a.id}.`,!1),n.push(l)}const o=s.length>0?s[0].index:i.length;if(i.length!==o){console.trace(`[createInstance] First service dependency of ${t.name} at position ${o+1} conflicts with ${i.length} static arguments`);const a=o-i.length;a>0?i=i.concat(new Array(a)):i=i.slice(0,o)}return Reflect.construct(t,i.concat(n))}_setCreatedServiceInstance(t,i){if(this._services.get(t)instanceof ts)this._services.set(t,i);else if(this._parent)this._parent._setCreatedServiceInstance(t,i);else throw new Error("illegalState - setting UNKNOWN service instance")}_getServiceInstanceOrDescriptor(t){const i=this._services.get(t);return!i&&this._parent?this._parent._getServiceInstanceOrDescriptor(t):i}_getOrCreateServiceInstance(t,i){this._globalGraph&&this._globalGraphImplicitDependency&&this._globalGraph.insertEdge(this._globalGraphImplicitDependency,String(t));const r=this._getServiceInstanceOrDescriptor(t);return r instanceof ts?this._safeCreateAndCacheServiceInstance(t,r,i.branch(t,!0)):(i.branch(t,!1),r)}_safeCreateAndCacheServiceInstance(t,i,r){if(this._activeInstantiations.has(t))throw new Error(`illegal state - RECURSIVELY instantiating service '${t}'`);this._activeInstantiations.add(t);try{return this._createAndCacheServiceInstance(t,i,r)}finally{this._activeInstantiations.delete(t)}}_createAndCacheServiceInstance(t,i,r){const s=new pD(l=>l.id.toString());let n=0;const o=[{id:t,desc:i,_trace:r}],a=new Set;for(;o.length;){const l=o.pop();if(!a.has(String(l.id))){if(a.add(String(l.id)),s.lookupOrInsertNode(l),n++>1e3)throw new gD(s);for(const c of Rr.getServiceDependencies(l.desc.ctor)){const u=this._getServiceInstanceOrDescriptor(c.id);if(u||this._throwIfStrict(`[createInstance] ${t} depends on ${c.id} which is NOT registered.`,!0),this._globalGraph?.insertEdge(String(l.id),String(c.id)),u instanceof ts){const d={id:c.id,desc:u,_trace:l._trace.branch(c.id,!0)};s.insertEdge(l,d),o.push(d)}}}}for(;;){const l=s.roots();if(l.length===0){if(!s.isEmpty())throw new gD(s);break}for(const{data:c}of l){if(this._getServiceInstanceOrDescriptor(c.id)instanceof ts){const d=this._createServiceInstanceWithOwner(c.id,c.desc.ctor,c.desc.staticArguments,c.desc.supportsDelayedInstantiation,c._trace);this._setCreatedServiceInstance(c.id,d)}s.removeNode(c)}}return this._getServiceInstanceOrDescriptor(t)}_createServiceInstanceWithOwner(t,i,r=[],s,n){if(this._services.get(t)instanceof ts)return this._createServiceInstance(t,i,r,s,n,this._servicesToMaybeDispose);if(this._parent)return this._parent._createServiceInstanceWithOwner(t,i,r,s,n);throw new Error(`illegalState - creating UNKNOWN service instance ${i.name}`)}_createServiceInstance(t,i,r=[],s,n,o){if(s){const a=new SS(void 0,this._strict,this,this._enableTracing);a._globalGraphImplicitDependency=String(t);const l=new Map,c=new Q3(()=>{const u=a._createInstance(i,r,n);for(const[d,f]of l){const p=u[d];if(typeof p=="function")for(const g of f)g.disposable=p.apply(u,g.listener)}return l.clear(),o.add(u),u});return new Proxy(Object.create(null),{get(u,d){if(!c.isInitialized&&typeof d=="string"&&(d.startsWith("onDid")||d.startsWith("onWill"))){let g=l.get(d);return g||(g=new hn,l.set(d,g)),(y,S,x)=>{if(c.isInitialized)return c.value[d](y,S,x);{const P={listener:[y,S,x],disposable:void 0},$=g.push(P);return ie(()=>{$(),P.disposable?.dispose()})}}}if(d in u)return u[d];const f=c.value;let p=f[d];return typeof p!="function"||(p=p.bind(f),u[d]=p),p},set(u,d,f){return c.value[d]=f,!0},getPrototypeOf(u){return i.prototype}})}else{const a=this._createInstance(i,r,n);return o.add(a),a}}_throwIfStrict(t,i){if(i&&console.warn(t),this._strict)throw new Error(t)}},mD;(function(e){e[e.None=0]="None",e[e.Creation=1]="Creation",e[e.Invocation=2]="Invocation",e[e.Branch=3]="Branch"})(mD||(mD={}));var v1=class ms{static{this.all=new Set}static{this._None=new class extends ms{constructor(){super(0,null)}stop(){}branch(){return this}}}static traceInvocation(t,i){return t?new ms(2,i.name||new Error().stack.split(`
`).slice(3,4).join(`
`)):ms._None}static traceCreation(t,i){return t?new ms(1,i.name):ms._None}static{this._totals=0}constructor(t,i){this.type=t,this.name=i,this._start=Date.now(),this._dep=[]}branch(t,i){const r=new ms(3,t.toString());return this._dep.push([t,i,r]),r}stop(){const t=Date.now()-this._start;ms._totals+=t;let i=!1;function r(n,o){const a=[],l=new Array(n+1).join("	");for(const[c,u,d]of o._dep)if(u&&d){i=!0,a.push(`${l}CREATES -> ${c}`);const f=r(n+1,d);f&&a.push(f)}else a.push(`${l}uses -> ${c}`);return a.join(`
`)}const s=[`${this.type===1?"CREATE":"CALL"} ${this.name}`,`${r(1,this)}`,`DONE, took ${t.toFixed(2)}ms (grand total ${ms._totals.toFixed(2)}ms)`];(t>2||i)&&ms.all.add(s.join(`
`))}},Pe=q("IExtHostRpcService"),zM=class{constructor(e){this.getProxy=e.getProxy.bind(e),this.set=e.set.bind(e),this.dispose=e.dispose.bind(e),this.assertRegistered=e.assertRegistered.bind(e),this.drain=e.drain.bind(e)}},Nc=q("IURITransformerService"),qM=class{constructor(e){e?(this.transformIncoming=e.transformIncoming.bind(e),this.transformOutgoing=e.transformOutgoing.bind(e),this.transformOutgoingURI=e.transformOutgoingURI.bind(e),this.transformOutgoingScheme=e.transformOutgoingScheme.bind(e)):(this.transformIncoming=t=>t,this.transformOutgoing=t=>t,this.transformOutgoingURI=t=>t,this.transformOutgoingScheme=t=>t)}},jM=class{constructor(){this._value="",this._pos=0}reset(e){return this._value=e,this._pos=0,this}next(){return this._pos+=1,this}hasNext(){return this._pos<this._value.length-1}cmp(e){const t=e.charCodeAt(0),i=this._value.charCodeAt(this._pos);return t-i}value(){return this._value[this._pos]}},GM=class{constructor(e=!0){this._caseSensitive=e}reset(e){return this._value=e,this._from=0,this._to=0,this.next()}hasNext(){return this._to<this._value.length}next(){this._from=this._to;let e=!0;for(;this._to<this._value.length;this._to++)if(this._value.charCodeAt(this._to)===46)if(e)this._from++;else break;else e=!1;return this}cmp(e){return this._caseSensitive?kv(e,this._value,0,e.length,this._from,this._to):wc(e,this._value,0,e.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}},vD=class{constructor(e=!0,t=!0){this._splitOnBackslash=e,this._caseSensitive=t}reset(e){this._from=0,this._to=0,this._value=e,this._valueLen=e.length;for(let t=e.length-1;t>=0;t--,this._valueLen--){const i=this._value.charCodeAt(t);if(!(i===47||this._splitOnBackslash&&i===92))break}return this.next()}hasNext(){return this._to<this._valueLen}next(){this._from=this._to;let e=!0;for(;this._to<this._valueLen;this._to++){const t=this._value.charCodeAt(this._to);if(t===47||this._splitOnBackslash&&t===92)if(e)this._from++;else break;else e=!1}return this}cmp(e){return this._caseSensitive?kv(e,this._value,0,e.length,this._from,this._to):wc(e,this._value,0,e.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}},_D;(function(e){e[e.Scheme=1]="Scheme",e[e.Authority=2]="Authority",e[e.Path=3]="Path",e[e.Query=4]="Query",e[e.Fragment=5]="Fragment"})(_D||(_D={}));var wD=class{constructor(e,t){this._ignorePathCasing=e,this._ignoreQueryAndFragment=t,this._states=[],this._stateIdx=0}reset(e){return this._value=e,this._states=[],this._value.scheme&&this._states.push(1),this._value.authority&&this._states.push(2),this._value.path&&(this._pathIterator=new vD(!1,!this._ignorePathCasing(e)),this._pathIterator.reset(e.path),this._pathIterator.value()&&this._states.push(3)),this._ignoreQueryAndFragment(e)||(this._value.query&&this._states.push(4),this._value.fragment&&this._states.push(5)),this._stateIdx=0,this}next(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()?this._pathIterator.next():this._stateIdx+=1,this}hasNext(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()||this._stateIdx<this._states.length-1}cmp(e){if(this._states[this._stateIdx]===1)return Iv(e,this._value.scheme);if(this._states[this._stateIdx]===2)return Iv(e,this._value.authority);if(this._states[this._stateIdx]===3)return this._pathIterator.cmp(e);if(this._states[this._stateIdx]===4)return oo(e,this._value.query);if(this._states[this._stateIdx]===5)return oo(e,this._value.fragment);throw new Error}value(){if(this._states[this._stateIdx]===1)return this._value.scheme;if(this._states[this._stateIdx]===2)return this._value.authority;if(this._states[this._stateIdx]===3)return this._pathIterator.value();if(this._states[this._stateIdx]===4)return this._value.query;if(this._states[this._stateIdx]===5)return this._value.fragment;throw new Error}},_o=class xS{static{this.Val=Symbol("undefined_placeholder")}static wrap(t){return t===void 0?xS.Val:t}static unwrap(t){return t===xS.Val?void 0:t}},Hh=class{constructor(){this.height=1,this.value=void 0,this.key=void 0,this.left=void 0,this.mid=void 0,this.right=void 0}isEmpty(){return!this.left&&!this.mid&&!this.right&&this.value===void 0}rotateLeft(){const e=this.right;return this.right=e.left,e.left=this,this.updateHeight(),e.updateHeight(),e}rotateRight(){const e=this.left;return this.left=e.right,e.right=this,this.updateHeight(),e.updateHeight(),e}updateHeight(){this.height=1+Math.max(this.heightLeft,this.heightRight)}balanceFactor(){return this.heightRight-this.heightLeft}get heightLeft(){return this.left?.height??0}get heightRight(){return this.right?.height??0}},yD;(function(e){e[e.Left=-1]="Left",e[e.Mid=0]="Mid",e[e.Right=1]="Right"})(yD||(yD={}));var xn=class Bd{static forUris(t=()=>!1,i=()=>!1){return new Bd(new wD(t,i))}static forPaths(t=!1){return new Bd(new vD(void 0,!t))}static forStrings(){return new Bd(new jM)}static forConfigKeys(){return new Bd(new GM)}constructor(t){this._iter=t}clear(){this._root=void 0}fill(t,i){if(i){const r=i.slice(0);ix(r);for(const s of r)this.set(s,t)}else{const r=t.slice(0);ix(r);for(const s of r)this.set(s[0],s[1])}}set(t,i){const r=this._iter.reset(t);let s;this._root||(this._root=new Hh,this._root.segment=r.value());const n=[];for(s=this._root;;){const a=r.cmp(s.segment);if(a>0)s.left||(s.left=new Hh,s.left.segment=r.value()),n.push([-1,s]),s=s.left;else if(a<0)s.right||(s.right=new Hh,s.right.segment=r.value()),n.push([1,s]),s=s.right;else if(r.hasNext())r.next(),s.mid||(s.mid=new Hh,s.mid.segment=r.value()),n.push([0,s]),s=s.mid;else break}const o=_o.unwrap(s.value);s.value=_o.wrap(i),s.key=t;for(let a=n.length-1;a>=0;a--){const l=n[a][1];l.updateHeight();const c=l.balanceFactor();if(c<-1||c>1){const u=n[a][0],d=n[a+1][0];if(u===1&&d===1)n[a][1]=l.rotateLeft();else if(u===-1&&d===-1)n[a][1]=l.rotateRight();else if(u===1&&d===-1)l.right=n[a+1][1]=n[a+1][1].rotateRight(),n[a][1]=l.rotateLeft();else if(u===-1&&d===1)l.left=n[a+1][1]=n[a+1][1].rotateLeft(),n[a][1]=l.rotateRight();else throw new Error;if(a>0)switch(n[a-1][0]){case-1:n[a-1][1].left=n[a][1];break;case 1:n[a-1][1].right=n[a][1];break;case 0:n[a-1][1].mid=n[a][1];break}else this._root=n[0][1]}}return o}get(t){return _o.unwrap(this._getNode(t)?.value)}_getNode(t){const i=this._iter.reset(t);let r=this._root;for(;r;){const s=i.cmp(r.segment);if(s>0)r=r.left;else if(s<0)r=r.right;else if(i.hasNext())i.next(),r=r.mid;else break}return r}has(t){const i=this._getNode(t);return!(i?.value===void 0&&i?.mid===void 0)}delete(t){return this._delete(t,!1)}deleteSuperstr(t){return this._delete(t,!0)}_delete(t,i){const r=this._iter.reset(t),s=[];let n=this._root;for(;n;){const o=r.cmp(n.segment);if(o>0)s.push([-1,n]),n=n.left;else if(o<0)s.push([1,n]),n=n.right;else if(r.hasNext())r.next(),s.push([0,n]),n=n.mid;else break}if(n){if(i?(n.left=void 0,n.mid=void 0,n.right=void 0,n.height=1):(n.key=void 0,n.value=void 0),!n.mid&&!n.value)if(n.left&&n.right){const o=[[1,n]],a=this._min(n.right,o);if(a.key){n.key=a.key,n.value=a.value,n.segment=a.segment;const l=a.right;if(o.length>1){const[u,d]=o[o.length-1];switch(u){case-1:d.left=l;break;case 0:mv(!1);case 1:mv(!1)}}else n.right=l;const c=this._balanceByStack(o);if(s.length>0){const[u,d]=s[s.length-1];switch(u){case-1:d.left=c;break;case 0:d.mid=c;break;case 1:d.right=c;break}}else this._root=c}}else{const o=n.left??n.right;if(s.length>0){const[a,l]=s[s.length-1];switch(a){case-1:l.left=o;break;case 0:l.mid=o;break;case 1:l.right=o;break}}else this._root=o}this._root=this._balanceByStack(s)??this._root}}_min(t,i){for(;t.left;)i.push([-1,t]),t=t.left;return t}_balanceByStack(t){for(let i=t.length-1;i>=0;i--){const r=t[i][1];r.updateHeight();const s=r.balanceFactor();if(s>1?(r.right.balanceFactor()>=0||(r.right=r.right.rotateRight()),t[i][1]=r.rotateLeft()):s<-1&&(r.left.balanceFactor()<=0||(r.left=r.left.rotateLeft()),t[i][1]=r.rotateRight()),i>0)switch(t[i-1][0]){case-1:t[i-1][1].left=t[i][1];break;case 1:t[i-1][1].right=t[i][1];break;case 0:t[i-1][1].mid=t[i][1];break}else return t[0][1]}}findSubstr(t){const i=this._iter.reset(t);let r=this._root,s;for(;r;){const n=i.cmp(r.segment);if(n>0)r=r.left;else if(n<0)r=r.right;else if(i.hasNext())i.next(),s=_o.unwrap(r.value)||s,r=r.mid;else break}return r&&_o.unwrap(r.value)||s}findSuperstr(t){return this._findSuperstrOrElement(t,!1)}_findSuperstrOrElement(t,i){const r=this._iter.reset(t);let s=this._root;for(;s;){const n=r.cmp(s.segment);if(n>0)s=s.left;else if(n<0)s=s.right;else if(r.hasNext())r.next(),s=s.mid;else return s.mid?this._entries(s.mid):i?_o.unwrap(s.value):void 0}}hasElementOrSubtree(t){return this._findSuperstrOrElement(t,!0)!==void 0}forEach(t){for(const[i,r]of this)t(r,i)}*[Symbol.iterator](){yield*this._entries(this._root)}_entries(t){const i=[];return this._dfsEntries(t,i),i[Symbol.iterator]()}_dfsEntries(t,i){t&&(t.left&&this._dfsEntries(t.left,i),t.value!==void 0&&i.push([t.key,_o.unwrap(t.value)]),t.mid&&this._dfsEntries(t.mid,i),t.right&&this._dfsEntries(t.right,i))}_isBalanced(){const t=i=>{if(!i)return!0;const r=i.balanceFactor();return r<-1||r>1?!1:t(i.left)&&t(i.right)};return t(this._root)}};function QM(e,t,i){return Math.min(Math.max(e,t),i)}var JM=class{constructor(){this._next=0}getNext(){return this._next++}},KM=class{constructor(){this._n=1,this._val=0}update(e){return this._val=this._val+(e-this._val)/this._n,this._n+=1,this._val}get value(){return this._val}},Mc;(function(e){e[e.Ignore=0]="Ignore",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error"})(Mc||(Mc={})),function(e){const t="error",i="warning",r="warn",s="info",n="ignore";function o(l){return l?kr(t,l)?e.Error:kr(i,l)||kr(r,l)?e.Warning:kr(s,l)?e.Info:e.Ignore:e.Ignore}e.fromValue=o;function a(l){switch(l){case e.Error:return t;case e.Warning:return i;case e.Info:return s;default:return n}}e.toString=a}(Mc||(Mc={}));var Ft=Mc,XM=Ft,qK=q("notificationService"),bD;(function(e){e[e.DEFAULT=0]="DEFAULT",e[e.OPTIONAL=1]="OPTIONAL",e[e.SILENT=2]="SILENT",e[e.URGENT=3]="URGENT"})(bD||(bD={}));var SD;(function(e){e[e.WORKSPACE=0]="WORKSPACE",e[e.PROFILE=1]="PROFILE",e[e.APPLICATION=2]="APPLICATION"})(SD||(SD={}));var xD;(function(e){e[e.OFF=0]="OFF",e[e.ERROR=1]="ERROR"})(xD||(xD={}));var Uh=q("contextService");function YM(e){const t=e;return typeof t?.id=="string"&&b.isUri(t.uri)}function ZM(e){const t=e;return typeof t?.id=="string"&&b.isUri(t.configPath)}var ED;(function(e){e[e.EMPTY=1]="EMPTY",e[e.FOLDER=2]="FOLDER",e[e.WORKSPACE=3]="WORKSPACE"})(ED||(ED={}));var eO=class{get folders(){return this._folders}set folders(e){this._folders=e,this.updateFoldersMap()}constructor(e,t,i,r,s){this._id=e,this._transient=i,this._configuration=r,this.ignorePathCasing=s,this.foldersMap=xn.forUris(this.ignorePathCasing,()=>!0),this.folders=t}update(e){this._id=e.id,this._configuration=e.configuration,this._transient=e.transient,this.ignorePathCasing=e.ignorePathCasing,this.folders=e.folders}get id(){return this._id}get transient(){return this._transient}get configuration(){return this._configuration}set configuration(e){this._configuration=e}getFolder(e){return e&&this.foldersMap.findSubstr(e)||null}updateFoldersMap(){this.foldersMap=xn.forUris(this.ignorePathCasing,()=>!0);for(const e of this.folders)this.foldersMap.set(e.uri,e)}toJSON(){return{id:this.id,folders:this.folders,transient:this.transient,configuration:this.configuration}}},_1=class{constructor(e,t){this.raw=t,this.uri=e.uri,this.index=e.index,this.name=e.name}toResource(e){return Dt(this.uri,e)}toJSON(){return{uri:this.uri,name:this.name,index:this.index}}};function w1(e){return new _1({uri:e,index:0,name:Fv(e)},{uri:e.toString()})}var CD="code-workspace",tO=`.${CD}`,jK=[{name:h(2684,null),extensions:[CD]}];function iO(e){return(typeof e=="string"?uh(e):dE(e))===tO}var rO=class{constructor(){this._systemSchemes=new Set(Object.keys(V)),this._providerInfo=new Map,this.extUri=new yc(e=>{const t=this._providerInfo.get(e.scheme);return!(t===void 0||t&1024)})}$acceptProviderInfos(e,t){t===null?this._providerInfo.delete(e.scheme):this._providerInfo.set(e.scheme,t)}isFreeScheme(e){return!this._providerInfo.has(e)&&!this._systemSchemes.has(e)}getCapabilities(e){return this._providerInfo.get(e)}},Ma=q("IExtHostFileSystemInfo"),y1=Object.freeze({create:e=>ba(e.map(t=>t.toString())).join(`\r
`),split:e=>e.split(`\r
`),parse:e=>y1.split(e).filter(t=>!t.startsWith("#"))}),GK=new Uint32Array(10),DD;(function(e){e[e.InitialConsonant=4352]="InitialConsonant",e[e.Vowel=4449]="Vowel",e[e.FinalConsonant=4520]="FinalConsonant",e[e.CompatibilityJamo=12593]="CompatibilityJamo"})(DD||(DD={}));var kD;(function(e){e[e.NUL=0]="NUL",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z"})(kD||(kD={}));var ID;(function(e){e[e.fa=24934]="fa",e[e.fg=26470]="fg",e[e.fq=29030]="fq",e[e.fr=29286]="fr",e[e.ft=29798]="ft",e[e.fv=30310]="fv",e[e.fx=30822]="fx",e[e.hk=27496]="hk",e[e.hl=27752]="hl",e[e.ho=28520]="ho",e[e.ml=27757]="ml",e[e.nj=27246]="nj",e[e.nl=27758]="nl",e[e.np=28782]="np",e[e.qt=29809]="qt",e[e.rt=29810]="rt",e[e.sg=26483]="sg",e[e.sw=30579]="sw"})(ID||(ID={}));var QK=new Uint8Array([114,82,115,101,69,102,97,113,81,116,84,100,119,87,99,122,120,118,103]),JK=new Uint16Array([107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]),KK=new Uint16Array([114,82,29810,115,30579,26483,101,102,29286,24934,29030,29798,30822,30310,26470,97,113,29809,116,84,100,119,99,122,120,118,103]),XK=new Uint16Array([114,82,29810,115,30579,26483,101,69,102,29286,24934,29030,29798,30822,30310,26470,97,113,81,29809,116,84,100,119,87,99,122,120,118,103,107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]);function PD(...e){return function(t,i){for(let r=0,s=e.length;r<s;r++){const n=e[r](t,i);if(n)return n}return null}}var YK=TD.bind(void 0,!1),b1=TD.bind(void 0,!0);function TD(e,t,i){if(!i||i.length<t.length)return null;let r;return e?r=hh(i,t):r=i.indexOf(t)===0,r?t.length>0?[{start:0,end:t.length}]:[]:null}function sO(e,t){const i=t.toLowerCase().indexOf(e.toLowerCase());return i===-1?null:[{start:i,end:i+e.length}]}function nO(e,t){return S1(e.toLowerCase(),t.toLowerCase(),0,0)}function S1(e,t,i,r){if(i===e.length)return[];if(r===t.length)return null;if(e[i]===t[r]){let s=null;return(s=S1(e,t,i+1,r+1))?RD({start:r,end:r+1},s):null}return S1(e,t,i,r+1)}function x1(e){return 97<=e&&e<=122}function Oc(e){return 65<=e&&e<=90}function E1(e){return 48<=e&&e<=57}function oO(e){return e===32||e===9||e===10||e===13}var aO=new Set;"()[]{}<>`'\"-/;:,.?!".split("").forEach(e=>aO.add(e.charCodeAt(0)));function AD(e){return x1(e)||Oc(e)||E1(e)}function RD(e,t){return t.length===0?t=[e]:e.end===t[0].start?t[0].start=e.start:t.unshift(e),t}function LD(e,t){for(let i=t;i<e.length;i++){const r=e.charCodeAt(i);if(Oc(r)||E1(r)||i>0&&!AD(e.charCodeAt(i-1)))return i}return e.length}function C1(e,t,i,r){if(i===e.length)return[];if(r===t.length)return null;if(e[i]!==t[r].toLowerCase())return null;{let s=null,n=r+1;for(s=C1(e,t,i+1,r+1);!s&&(n=LD(t,n))<t.length;)s=C1(e,t,i+1,n),n++;return s===null?null:RD({start:r,end:r+1},s)}}function lO(e){let t=0,i=0,r=0,s=0,n=0;for(let u=0;u<e.length;u++)n=e.charCodeAt(u),Oc(n)&&t++,x1(n)&&i++,AD(n)&&r++,E1(n)&&s++;const o=t/e.length,a=i/e.length,l=r/e.length,c=s/e.length;return{upperPercent:o,lowerPercent:a,alphaPercent:l,numericPercent:c}}function cO(e){const{upperPercent:t,lowerPercent:i}=e;return i===0&&t>.6}function uO(e){const{upperPercent:t,lowerPercent:i,alphaPercent:r,numericPercent:s}=e;return i>.2&&t<.8&&r>.6&&s<.2}function dO(e){let t=0,i=0,r=0,s=0;for(let n=0;n<e.length;n++)r=e.charCodeAt(n),Oc(r)&&t++,x1(r)&&i++,oO(r)&&s++;return(t===0||i===0)&&s===0?e.length<=30:t<=5}function ND(e,t){if(!t||(t=t.trim(),t.length===0)||!dO(e))return null;t.length>60&&(t=t.substring(0,60));const i=lO(t);if(!uO(i)){if(!cO(i))return null;t=t.toLowerCase()}let r=null,s=0;for(e=e.toLowerCase();s<t.length&&(r=C1(e,t,0,s))===null;)s=LD(t,s+1);return r}var ZK=PD(b1,ND,sO),eX=PD(b1,ND,nO),tX=new uc(1e4),Wh=128;function D1(){const e=[],t=[];for(let i=0;i<=Wh;i++)t[i]=0;for(let i=0;i<=Wh;i++)e.push(t.slice(0));return e}function MD(e){const t=[];for(let i=0;i<=e;i++)t[i]=0;return t}var iX=MD(2*Wh),rX=MD(2*Wh),sX=D1(),nX=D1(),oX=D1(),OD;(function(e){e[e.Diag=1]="Diag",e[e.Left=2]="Left",e[e.LeftLeft=3]="LeftLeft"})(OD||(OD={}));var FD;(function(e){e.Default=[-100,0];function t(i){return!i||i.length===2&&i[0]===-100&&i[1]===0}e.isDefault=t})(FD||(FD={}));var aX=class{static{this.default={boostFullMatch:!0,firstMatchCanBeWeak:!1}}constructor(e,t){this.firstMatchCanBeWeak=e,this.boostFullMatch=t}},k1=Object.create(null);function m(e,t){if(Oe(t)){const i=k1[t];if(i===void 0)throw new Error(`${e} references an unknown codicon: ${t}`);t=i}return k1[e]=t,{id:e}}function hO(){return k1}var fO={add:m("add",6e4),plus:m("plus",6e4),gistNew:m("gist-new",6e4),repoCreate:m("repo-create",6e4),lightbulb:m("lightbulb",60001),lightBulb:m("light-bulb",60001),repo:m("repo",60002),repoDelete:m("repo-delete",60002),gistFork:m("gist-fork",60003),repoForked:m("repo-forked",60003),gitPullRequest:m("git-pull-request",60004),gitPullRequestAbandoned:m("git-pull-request-abandoned",60004),recordKeys:m("record-keys",60005),keyboard:m("keyboard",60005),tag:m("tag",60006),gitPullRequestLabel:m("git-pull-request-label",60006),tagAdd:m("tag-add",60006),tagRemove:m("tag-remove",60006),person:m("person",60007),personFollow:m("person-follow",60007),personOutline:m("person-outline",60007),personFilled:m("person-filled",60007),gitBranch:m("git-branch",60008),gitBranchCreate:m("git-branch-create",60008),gitBranchDelete:m("git-branch-delete",60008),sourceControl:m("source-control",60008),mirror:m("mirror",60009),mirrorPublic:m("mirror-public",60009),star:m("star",60010),starAdd:m("star-add",60010),starDelete:m("star-delete",60010),starEmpty:m("star-empty",60010),comment:m("comment",60011),commentAdd:m("comment-add",60011),alert:m("alert",60012),warning:m("warning",60012),search:m("search",60013),searchSave:m("search-save",60013),logOut:m("log-out",60014),signOut:m("sign-out",60014),logIn:m("log-in",60015),signIn:m("sign-in",60015),eye:m("eye",60016),eyeUnwatch:m("eye-unwatch",60016),eyeWatch:m("eye-watch",60016),circleFilled:m("circle-filled",60017),primitiveDot:m("primitive-dot",60017),closeDirty:m("close-dirty",60017),debugBreakpoint:m("debug-breakpoint",60017),debugBreakpointDisabled:m("debug-breakpoint-disabled",60017),debugHint:m("debug-hint",60017),terminalDecorationSuccess:m("terminal-decoration-success",60017),primitiveSquare:m("primitive-square",60018),edit:m("edit",60019),pencil:m("pencil",60019),info:m("info",60020),issueOpened:m("issue-opened",60020),gistPrivate:m("gist-private",60021),gitForkPrivate:m("git-fork-private",60021),lock:m("lock",60021),mirrorPrivate:m("mirror-private",60021),close:m("close",60022),removeClose:m("remove-close",60022),x:m("x",60022),repoSync:m("repo-sync",60023),sync:m("sync",60023),clone:m("clone",60024),desktopDownload:m("desktop-download",60024),beaker:m("beaker",60025),microscope:m("microscope",60025),vm:m("vm",60026),deviceDesktop:m("device-desktop",60026),file:m("file",60027),fileText:m("file-text",60027),more:m("more",60028),ellipsis:m("ellipsis",60028),kebabHorizontal:m("kebab-horizontal",60028),mailReply:m("mail-reply",60029),reply:m("reply",60029),organization:m("organization",60030),organizationFilled:m("organization-filled",60030),organizationOutline:m("organization-outline",60030),newFile:m("new-file",60031),fileAdd:m("file-add",60031),newFolder:m("new-folder",60032),fileDirectoryCreate:m("file-directory-create",60032),trash:m("trash",60033),trashcan:m("trashcan",60033),history:m("history",60034),clock:m("clock",60034),folder:m("folder",60035),fileDirectory:m("file-directory",60035),symbolFolder:m("symbol-folder",60035),logoGithub:m("logo-github",60036),markGithub:m("mark-github",60036),github:m("github",60036),terminal:m("terminal",60037),console:m("console",60037),repl:m("repl",60037),zap:m("zap",60038),symbolEvent:m("symbol-event",60038),error:m("error",60039),stop:m("stop",60039),variable:m("variable",60040),symbolVariable:m("symbol-variable",60040),array:m("array",60042),symbolArray:m("symbol-array",60042),symbolModule:m("symbol-module",60043),symbolPackage:m("symbol-package",60043),symbolNamespace:m("symbol-namespace",60043),symbolObject:m("symbol-object",60043),symbolMethod:m("symbol-method",60044),symbolFunction:m("symbol-function",60044),symbolConstructor:m("symbol-constructor",60044),symbolBoolean:m("symbol-boolean",60047),symbolNull:m("symbol-null",60047),symbolNumeric:m("symbol-numeric",60048),symbolNumber:m("symbol-number",60048),symbolStructure:m("symbol-structure",60049),symbolStruct:m("symbol-struct",60049),symbolParameter:m("symbol-parameter",60050),symbolTypeParameter:m("symbol-type-parameter",60050),symbolKey:m("symbol-key",60051),symbolText:m("symbol-text",60051),symbolReference:m("symbol-reference",60052),goToFile:m("go-to-file",60052),symbolEnum:m("symbol-enum",60053),symbolValue:m("symbol-value",60053),symbolRuler:m("symbol-ruler",60054),symbolUnit:m("symbol-unit",60054),activateBreakpoints:m("activate-breakpoints",60055),archive:m("archive",60056),arrowBoth:m("arrow-both",60057),arrowDown:m("arrow-down",60058),arrowLeft:m("arrow-left",60059),arrowRight:m("arrow-right",60060),arrowSmallDown:m("arrow-small-down",60061),arrowSmallLeft:m("arrow-small-left",60062),arrowSmallRight:m("arrow-small-right",60063),arrowSmallUp:m("arrow-small-up",60064),arrowUp:m("arrow-up",60065),bell:m("bell",60066),bold:m("bold",60067),book:m("book",60068),bookmark:m("bookmark",60069),debugBreakpointConditionalUnverified:m("debug-breakpoint-conditional-unverified",60070),debugBreakpointConditional:m("debug-breakpoint-conditional",60071),debugBreakpointConditionalDisabled:m("debug-breakpoint-conditional-disabled",60071),debugBreakpointDataUnverified:m("debug-breakpoint-data-unverified",60072),debugBreakpointData:m("debug-breakpoint-data",60073),debugBreakpointDataDisabled:m("debug-breakpoint-data-disabled",60073),debugBreakpointLogUnverified:m("debug-breakpoint-log-unverified",60074),debugBreakpointLog:m("debug-breakpoint-log",60075),debugBreakpointLogDisabled:m("debug-breakpoint-log-disabled",60075),briefcase:m("briefcase",60076),broadcast:m("broadcast",60077),browser:m("browser",60078),bug:m("bug",60079),calendar:m("calendar",60080),caseSensitive:m("case-sensitive",60081),check:m("check",60082),checklist:m("checklist",60083),chevronDown:m("chevron-down",60084),chevronLeft:m("chevron-left",60085),chevronRight:m("chevron-right",60086),chevronUp:m("chevron-up",60087),chromeClose:m("chrome-close",60088),chromeMaximize:m("chrome-maximize",60089),chromeMinimize:m("chrome-minimize",60090),chromeRestore:m("chrome-restore",60091),circleOutline:m("circle-outline",60092),circle:m("circle",60092),debugBreakpointUnverified:m("debug-breakpoint-unverified",60092),terminalDecorationIncomplete:m("terminal-decoration-incomplete",60092),circleSlash:m("circle-slash",60093),circuitBoard:m("circuit-board",60094),clearAll:m("clear-all",60095),clippy:m("clippy",60096),closeAll:m("close-all",60097),cloudDownload:m("cloud-download",60098),cloudUpload:m("cloud-upload",60099),code:m("code",60100),collapseAll:m("collapse-all",60101),colorMode:m("color-mode",60102),commentDiscussion:m("comment-discussion",60103),creditCard:m("credit-card",60105),dash:m("dash",60108),dashboard:m("dashboard",60109),database:m("database",60110),debugContinue:m("debug-continue",60111),debugDisconnect:m("debug-disconnect",60112),debugPause:m("debug-pause",60113),debugRestart:m("debug-restart",60114),debugStart:m("debug-start",60115),debugStepInto:m("debug-step-into",60116),debugStepOut:m("debug-step-out",60117),debugStepOver:m("debug-step-over",60118),debugStop:m("debug-stop",60119),debug:m("debug",60120),deviceCameraVideo:m("device-camera-video",60121),deviceCamera:m("device-camera",60122),deviceMobile:m("device-mobile",60123),diffAdded:m("diff-added",60124),diffIgnored:m("diff-ignored",60125),diffModified:m("diff-modified",60126),diffRemoved:m("diff-removed",60127),diffRenamed:m("diff-renamed",60128),diff:m("diff",60129),diffSidebyside:m("diff-sidebyside",60129),discard:m("discard",60130),editorLayout:m("editor-layout",60131),emptyWindow:m("empty-window",60132),exclude:m("exclude",60133),extensions:m("extensions",60134),eyeClosed:m("eye-closed",60135),fileBinary:m("file-binary",60136),fileCode:m("file-code",60137),fileMedia:m("file-media",60138),filePdf:m("file-pdf",60139),fileSubmodule:m("file-submodule",60140),fileSymlinkDirectory:m("file-symlink-directory",60141),fileSymlinkFile:m("file-symlink-file",60142),fileZip:m("file-zip",60143),files:m("files",60144),filter:m("filter",60145),flame:m("flame",60146),foldDown:m("fold-down",60147),foldUp:m("fold-up",60148),fold:m("fold",60149),folderActive:m("folder-active",60150),folderOpened:m("folder-opened",60151),gear:m("gear",60152),gift:m("gift",60153),gistSecret:m("gist-secret",60154),gist:m("gist",60155),gitCommit:m("git-commit",60156),gitCompare:m("git-compare",60157),compareChanges:m("compare-changes",60157),gitMerge:m("git-merge",60158),githubAction:m("github-action",60159),githubAlt:m("github-alt",60160),globe:m("globe",60161),grabber:m("grabber",60162),graph:m("graph",60163),gripper:m("gripper",60164),heart:m("heart",60165),home:m("home",60166),horizontalRule:m("horizontal-rule",60167),hubot:m("hubot",60168),inbox:m("inbox",60169),issueReopened:m("issue-reopened",60171),issues:m("issues",60172),italic:m("italic",60173),jersey:m("jersey",60174),json:m("json",60175),kebabVertical:m("kebab-vertical",60176),key:m("key",60177),law:m("law",60178),lightbulbAutofix:m("lightbulb-autofix",60179),linkExternal:m("link-external",60180),link:m("link",60181),listOrdered:m("list-ordered",60182),listUnordered:m("list-unordered",60183),liveShare:m("live-share",60184),loading:m("loading",60185),location:m("location",60186),mailRead:m("mail-read",60187),mail:m("mail",60188),markdown:m("markdown",60189),megaphone:m("megaphone",60190),mention:m("mention",60191),milestone:m("milestone",60192),gitPullRequestMilestone:m("git-pull-request-milestone",60192),mortarBoard:m("mortar-board",60193),move:m("move",60194),multipleWindows:m("multiple-windows",60195),mute:m("mute",60196),noNewline:m("no-newline",60197),note:m("note",60198),octoface:m("octoface",60199),openPreview:m("open-preview",60200),package:m("package",60201),paintcan:m("paintcan",60202),pin:m("pin",60203),play:m("play",60204),run:m("run",60204),plug:m("plug",60205),preserveCase:m("preserve-case",60206),preview:m("preview",60207),project:m("project",60208),pulse:m("pulse",60209),question:m("question",60210),quote:m("quote",60211),radioTower:m("radio-tower",60212),reactions:m("reactions",60213),references:m("references",60214),refresh:m("refresh",60215),regex:m("regex",60216),remoteExplorer:m("remote-explorer",60217),remote:m("remote",60218),remove:m("remove",60219),replaceAll:m("replace-all",60220),replace:m("replace",60221),repoClone:m("repo-clone",60222),repoForcePush:m("repo-force-push",60223),repoPull:m("repo-pull",60224),repoPush:m("repo-push",60225),report:m("report",60226),requestChanges:m("request-changes",60227),rocket:m("rocket",60228),rootFolderOpened:m("root-folder-opened",60229),rootFolder:m("root-folder",60230),rss:m("rss",60231),ruby:m("ruby",60232),saveAll:m("save-all",60233),saveAs:m("save-as",60234),save:m("save",60235),screenFull:m("screen-full",60236),screenNormal:m("screen-normal",60237),searchStop:m("search-stop",60238),server:m("server",60240),settingsGear:m("settings-gear",60241),settings:m("settings",60242),shield:m("shield",60243),smiley:m("smiley",60244),sortPrecedence:m("sort-precedence",60245),splitHorizontal:m("split-horizontal",60246),splitVertical:m("split-vertical",60247),squirrel:m("squirrel",60248),starFull:m("star-full",60249),starHalf:m("star-half",60250),symbolClass:m("symbol-class",60251),symbolColor:m("symbol-color",60252),symbolConstant:m("symbol-constant",60253),symbolEnumMember:m("symbol-enum-member",60254),symbolField:m("symbol-field",60255),symbolFile:m("symbol-file",60256),symbolInterface:m("symbol-interface",60257),symbolKeyword:m("symbol-keyword",60258),symbolMisc:m("symbol-misc",60259),symbolOperator:m("symbol-operator",60260),symbolProperty:m("symbol-property",60261),wrench:m("wrench",60261),wrenchSubaction:m("wrench-subaction",60261),symbolSnippet:m("symbol-snippet",60262),tasklist:m("tasklist",60263),telescope:m("telescope",60264),textSize:m("text-size",60265),threeBars:m("three-bars",60266),thumbsdown:m("thumbsdown",60267),thumbsup:m("thumbsup",60268),tools:m("tools",60269),triangleDown:m("triangle-down",60270),triangleLeft:m("triangle-left",60271),triangleRight:m("triangle-right",60272),triangleUp:m("triangle-up",60273),twitter:m("twitter",60274),unfold:m("unfold",60275),unlock:m("unlock",60276),unmute:m("unmute",60277),unverified:m("unverified",60278),verified:m("verified",60279),versions:m("versions",60280),vmActive:m("vm-active",60281),vmOutline:m("vm-outline",60282),vmRunning:m("vm-running",60283),watch:m("watch",60284),whitespace:m("whitespace",60285),wholeWord:m("whole-word",60286),window:m("window",60287),wordWrap:m("word-wrap",60288),zoomIn:m("zoom-in",60289),zoomOut:m("zoom-out",60290),listFilter:m("list-filter",60291),listFlat:m("list-flat",60292),listSelection:m("list-selection",60293),selection:m("selection",60293),listTree:m("list-tree",60294),debugBreakpointFunctionUnverified:m("debug-breakpoint-function-unverified",60295),debugBreakpointFunction:m("debug-breakpoint-function",60296),debugBreakpointFunctionDisabled:m("debug-breakpoint-function-disabled",60296),debugStackframeActive:m("debug-stackframe-active",60297),circleSmallFilled:m("circle-small-filled",60298),debugStackframeDot:m("debug-stackframe-dot",60298),terminalDecorationMark:m("terminal-decoration-mark",60298),debugStackframe:m("debug-stackframe",60299),debugStackframeFocused:m("debug-stackframe-focused",60299),debugBreakpointUnsupported:m("debug-breakpoint-unsupported",60300),symbolString:m("symbol-string",60301),debugReverseContinue:m("debug-reverse-continue",60302),debugStepBack:m("debug-step-back",60303),debugRestartFrame:m("debug-restart-frame",60304),debugAlt:m("debug-alt",60305),callIncoming:m("call-incoming",60306),callOutgoing:m("call-outgoing",60307),menu:m("menu",60308),expandAll:m("expand-all",60309),feedback:m("feedback",60310),gitPullRequestReviewer:m("git-pull-request-reviewer",60310),groupByRefType:m("group-by-ref-type",60311),ungroupByRefType:m("ungroup-by-ref-type",60312),account:m("account",60313),gitPullRequestAssignee:m("git-pull-request-assignee",60313),bellDot:m("bell-dot",60314),debugConsole:m("debug-console",60315),library:m("library",60316),output:m("output",60317),runAll:m("run-all",60318),syncIgnored:m("sync-ignored",60319),pinned:m("pinned",60320),githubInverted:m("github-inverted",60321),serverProcess:m("server-process",60322),serverEnvironment:m("server-environment",60323),pass:m("pass",60324),issueClosed:m("issue-closed",60324),stopCircle:m("stop-circle",60325),playCircle:m("play-circle",60326),record:m("record",60327),debugAltSmall:m("debug-alt-small",60328),vmConnect:m("vm-connect",60329),cloud:m("cloud",60330),merge:m("merge",60331),export:m("export",60332),graphLeft:m("graph-left",60333),magnet:m("magnet",60334),notebook:m("notebook",60335),redo:m("redo",60336),checkAll:m("check-all",60337),pinnedDirty:m("pinned-dirty",60338),passFilled:m("pass-filled",60339),circleLargeFilled:m("circle-large-filled",60340),circleLarge:m("circle-large",60341),circleLargeOutline:m("circle-large-outline",60341),combine:m("combine",60342),gather:m("gather",60342),table:m("table",60343),variableGroup:m("variable-group",60344),typeHierarchy:m("type-hierarchy",60345),typeHierarchySub:m("type-hierarchy-sub",60346),typeHierarchySuper:m("type-hierarchy-super",60347),gitPullRequestCreate:m("git-pull-request-create",60348),runAbove:m("run-above",60349),runBelow:m("run-below",60350),notebookTemplate:m("notebook-template",60351),debugRerun:m("debug-rerun",60352),workspaceTrusted:m("workspace-trusted",60353),workspaceUntrusted:m("workspace-untrusted",60354),workspaceUnknown:m("workspace-unknown",60355),terminalCmd:m("terminal-cmd",60356),terminalDebian:m("terminal-debian",60357),terminalLinux:m("terminal-linux",60358),terminalPowershell:m("terminal-powershell",60359),terminalTmux:m("terminal-tmux",60360),terminalUbuntu:m("terminal-ubuntu",60361),terminalBash:m("terminal-bash",60362),arrowSwap:m("arrow-swap",60363),copy:m("copy",60364),personAdd:m("person-add",60365),filterFilled:m("filter-filled",60366),wand:m("wand",60367),debugLineByLine:m("debug-line-by-line",60368),inspect:m("inspect",60369),layers:m("layers",60370),layersDot:m("layers-dot",60371),layersActive:m("layers-active",60372),compass:m("compass",60373),compassDot:m("compass-dot",60374),compassActive:m("compass-active",60375),azure:m("azure",60376),issueDraft:m("issue-draft",60377),gitPullRequestClosed:m("git-pull-request-closed",60378),gitPullRequestDraft:m("git-pull-request-draft",60379),debugAll:m("debug-all",60380),debugCoverage:m("debug-coverage",60381),runErrors:m("run-errors",60382),folderLibrary:m("folder-library",60383),debugContinueSmall:m("debug-continue-small",60384),beakerStop:m("beaker-stop",60385),graphLine:m("graph-line",60386),graphScatter:m("graph-scatter",60387),pieChart:m("pie-chart",60388),bracket:m("bracket",60175),bracketDot:m("bracket-dot",60389),bracketError:m("bracket-error",60390),lockSmall:m("lock-small",60391),azureDevops:m("azure-devops",60392),verifiedFilled:m("verified-filled",60393),newline:m("newline",60394),layout:m("layout",60395),layoutActivitybarLeft:m("layout-activitybar-left",60396),layoutActivitybarRight:m("layout-activitybar-right",60397),layoutPanelLeft:m("layout-panel-left",60398),layoutPanelCenter:m("layout-panel-center",60399),layoutPanelJustify:m("layout-panel-justify",60400),layoutPanelRight:m("layout-panel-right",60401),layoutPanel:m("layout-panel",60402),layoutSidebarLeft:m("layout-sidebar-left",60403),layoutSidebarRight:m("layout-sidebar-right",60404),layoutStatusbar:m("layout-statusbar",60405),layoutMenubar:m("layout-menubar",60406),layoutCentered:m("layout-centered",60407),target:m("target",60408),indent:m("indent",60409),recordSmall:m("record-small",60410),errorSmall:m("error-small",60411),terminalDecorationError:m("terminal-decoration-error",60411),arrowCircleDown:m("arrow-circle-down",60412),arrowCircleLeft:m("arrow-circle-left",60413),arrowCircleRight:m("arrow-circle-right",60414),arrowCircleUp:m("arrow-circle-up",60415),layoutSidebarRightOff:m("layout-sidebar-right-off",60416),layoutPanelOff:m("layout-panel-off",60417),layoutSidebarLeftOff:m("layout-sidebar-left-off",60418),blank:m("blank",60419),heartFilled:m("heart-filled",60420),map:m("map",60421),mapHorizontal:m("map-horizontal",60421),foldHorizontal:m("fold-horizontal",60421),mapFilled:m("map-filled",60422),mapHorizontalFilled:m("map-horizontal-filled",60422),foldHorizontalFilled:m("fold-horizontal-filled",60422),circleSmall:m("circle-small",60423),bellSlash:m("bell-slash",60424),bellSlashDot:m("bell-slash-dot",60425),commentUnresolved:m("comment-unresolved",60426),gitPullRequestGoToChanges:m("git-pull-request-go-to-changes",60427),gitPullRequestNewChanges:m("git-pull-request-new-changes",60428),searchFuzzy:m("search-fuzzy",60429),commentDraft:m("comment-draft",60430),send:m("send",60431),sparkle:m("sparkle",60432),insert:m("insert",60433),mic:m("mic",60434),thumbsdownFilled:m("thumbsdown-filled",60435),thumbsupFilled:m("thumbsup-filled",60436),coffee:m("coffee",60437),snake:m("snake",60438),game:m("game",60439),vr:m("vr",60440),chip:m("chip",60441),piano:m("piano",60442),music:m("music",60443),micFilled:m("mic-filled",60444),repoFetch:m("repo-fetch",60445),copilot:m("copilot",60446),lightbulbSparkle:m("lightbulb-sparkle",60447),robot:m("robot",60448),sparkleFilled:m("sparkle-filled",60449),diffSingle:m("diff-single",60450),diffMultiple:m("diff-multiple",60451),surroundWith:m("surround-with",60452),share:m("share",60453),gitStash:m("git-stash",60454),gitStashApply:m("git-stash-apply",60455),gitStashPop:m("git-stash-pop",60456),vscode:m("vscode",60457),vscodeInsiders:m("vscode-insiders",60458),codeOss:m("code-oss",60459),runCoverage:m("run-coverage",60460),runAllCoverage:m("run-all-coverage",60461),coverage:m("coverage",60462),githubProject:m("github-project",60463),mapVertical:m("map-vertical",60464),foldVertical:m("fold-vertical",60464),mapVerticalFilled:m("map-vertical-filled",60465),foldVerticalFilled:m("fold-vertical-filled",60465),goToSearch:m("go-to-search",60466),percentage:m("percentage",60467),sortPercentage:m("sort-percentage",60467),attach:m("attach",60468),goToEditingSession:m("go-to-editing-session",60469),editSession:m("edit-session",60470),codeReview:m("code-review",60471),copilotWarning:m("copilot-warning",60472),python:m("python",60473),copilotLarge:m("copilot-large",60474),copilotWarningLarge:m("copilot-warning-large",60475),keyboardTab:m("keyboard-tab",60476),copilotBlocked:m("copilot-blocked",60477),copilotNotConnected:m("copilot-not-connected",60478),flag:m("flag",60479),lightbulbEmpty:m("lightbulb-empty",60480),symbolMethodArrow:m("symbol-method-arrow",60481),copilotUnavailable:m("copilot-unavailable",60482),repoPinned:m("repo-pinned",60483),keyboardTabAbove:m("keyboard-tab-above",60484),keyboardTabBelow:m("keyboard-tab-below",60485),gitPullRequestDone:m("git-pull-request-done",60486),mcp:m("mcp",60487),extensionsLarge:m("extensions-large",60488),genieChevronLeft:m("genie-chevron-left",70001),genieChevronRight:m("genie-chevron-right",70002)},pO={dialogError:m("dialog-error","error"),dialogWarning:m("dialog-warning","warning"),dialogInfo:m("dialog-info","info"),dialogClose:m("dialog-close","close"),treeItemExpanded:m("tree-item-expanded","chevron-down"),treeFilterOnTypeOn:m("tree-filter-on-type-on","list-filter"),treeFilterOnTypeOff:m("tree-filter-on-type-off","list-selection"),treeFilterClear:m("tree-filter-clear","close"),treeItemLoading:m("tree-item-loading","loading"),menuSelection:m("menu-selection","check"),menuSubmenu:m("menu-submenu","chevron-right"),menuBarMore:m("menubar-more","more"),scrollbarButtonLeft:m("scrollbar-button-left","triangle-left"),scrollbarButtonRight:m("scrollbar-button-right","triangle-right"),scrollbarButtonUp:m("scrollbar-button-up","triangle-up"),scrollbarButtonDown:m("scrollbar-button-down","triangle-down"),toolBarMore:m("toolbar-more","more"),quickInputBack:m("quick-input-back","arrow-left"),dropDownButton:m("drop-down-button",60084),symbolCustomColor:m("symbol-customcolor",60252),exportIcon:m("export",60332),workspaceUnspecified:m("workspace-unspecified",60355),newLine:m("newline",60394),thumbsDownFilled:m("thumbsdown-filled",60435),thumbsUpFilled:m("thumbsup-filled",60436),gitFetch:m("git-fetch",60445),lightbulbSparkleAutofix:m("lightbulb-sparkle-autofix",60447),debugBreakpointPending:m("debug-breakpoint-pending",60377)},ue={...fO,...pO},Oa;(function(e){function t(i){return i&&typeof i=="object"&&typeof i.id=="string"}e.isThemeColor=t})(Oa||(Oa={}));var Wt;(function(e){e.iconNameSegment="[A-Za-z0-9]+",e.iconNameExpression="[A-Za-z0-9-]+",e.iconModifierExpression="~[A-Za-z]+",e.iconNameCharacter="[A-Za-z0-9~-]";const t=new RegExp(`^(${e.iconNameExpression})(${e.iconModifierExpression})?$`);function i(f){const p=t.exec(f.id);if(!p)return i(ue.error);const[,g,v]=p,y=["codicon","codicon-"+g];return v&&y.push("codicon-modifier-"+v.substring(1)),y}e.asClassNameArray=i;function r(f){return i(f).join(" ")}e.asClassName=r;function s(f){return"."+i(f).join(".")}e.asCSSSelector=s;function n(f){return f&&typeof f=="object"&&typeof f.id=="string"&&(typeof f.color>"u"||Oa.isThemeColor(f.color))}e.isThemeIcon=n;const o=new RegExp(`^\\$\\((${e.iconNameExpression}(?:${e.iconModifierExpression})?)\\)$`);function a(f){const p=o.exec(f);if(!p)return;const[,g]=p;return{id:g}}e.fromString=a;function l(f){return{id:f}}e.fromId=l;function c(f,p){let g=f.id;const v=g.lastIndexOf("~");return v!==-1&&(g=g.substring(0,v)),p&&(g=`${g}~${p}`),{id:g}}e.modify=c;function u(f){const p=f.id.lastIndexOf("~");if(p!==-1)return f.id.substring(p+1)}e.getModifier=u;function d(f,p){return f.id===p.id&&f.color?.id===p.color?.id}e.isEqual=d})(Wt||(Wt={}));var I1=new RegExp(`\\$\\(${Wt.iconNameExpression}(?:${Wt.iconModifierExpression})?\\)`,"g"),gO=new RegExp(`(\\\\)?${I1.source}`,"g");function mO(e){return e.replace(gO,(t,i)=>i?t:`\\${t}`)}var lX=new RegExp(`\\\\${I1.source}`,"g"),cX=new RegExp(`(\\s)?(\\\\)?${I1.source}(\\s)?`,"g"),uX=new RegExp(`\\$\\(${Wt.iconNameCharacter}+\\)`,"g"),$D;(function(e){e[e.Paragraph=0]="Paragraph",e[e.Break=1]="Break"})($D||($D={}));var Fa=class Y9{static lift(t){const i=new Y9(t.value,t);return i.uris=t.uris,i.baseUri=t.baseUri?b.revive(t.baseUri):void 0,i}constructor(t="",i=!1){if(this.value=t,typeof this.value!="string")throw De("value");typeof i=="boolean"?(this.isTrusted=i,this.supportThemeIcons=!1,this.supportHtml=!1):(this.isTrusted=i.isTrusted??void 0,this.supportThemeIcons=i.supportThemeIcons??!1,this.supportHtml=i.supportHtml??!1)}appendText(t,i=0){return this.value+=vO(this.supportThemeIcons?mO(t):t).replace(/([ \t]+)/g,(r,s)=>"&nbsp;".repeat(s.length)).replace(/\>/gm,"\\>").replace(/\n/g,i===1?`\\
`:`

`),this}appendMarkdown(t){return this.value+=t,this}appendCodeblock(t,i){return this.value+=`
${_O(i,t)}
`,this}appendLink(t,i,r){return this.value+="[",this.value+=this._escape(i,"]"),this.value+="](",this.value+=this._escape(String(t),")"),r&&(this.value+=` "${this._escape(this._escape(r,'"'),")")}"`),this.value+=")",this}_escape(t,i){const r=new RegExp(mn(i),"g");return t.replace(r,(s,n)=>t.charAt(n-1)!=="\\"?`\\${s}`:s)}};function Ns(e){return e instanceof Fa?!0:e&&typeof e=="object"?typeof e.value=="string"&&(typeof e.isTrusted=="boolean"||typeof e.isTrusted=="object"||e.isTrusted===void 0)&&(typeof e.supportThemeIcons=="boolean"||e.supportThemeIcons===void 0):!1}function vO(e){return e.replace(/[\\`*_{}[\]()#+\-!~]/g,"\\$&")}function _O(e,t){const i=e.match(/^`+/gm)?.reduce((s,n)=>s.length>n.length?s:n).length??0,r=i>=3?i+1:3;return[`${"`".repeat(r)}${t}`,e,`${"`".repeat(r)}`].join(`
`)}function wO(e){const t=[],i=e.split("|").map(s=>s.trim());e=i[0];const r=i[1];if(r){const s=/height=(\d+)/.exec(r),n=/width=(\d+)/.exec(r),o=s?s[1]:"",a=n?n[1]:"",l=isFinite(parseInt(a)),c=isFinite(parseInt(o));l&&t.push(`width="${a}"`),c&&t.push(`height="${o}"`)}return{href:e,dimensions:t}}function P1(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var wo=P1();function HD(e){wo=e}var UD=/[&<>"']/,yO=new RegExp(UD.source,"g"),WD=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,bO=new RegExp(WD.source,"g"),SO={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},BD=e=>SO[e];function rr(e,t){if(t){if(UD.test(e))return e.replace(yO,BD)}else if(WD.test(e))return e.replace(bO,BD);return e}var xO=/(^|[^\[])\^/g;function vt(e,t){let i=typeof e=="string"?e:e.source;t=t||"";const r={replace:(s,n)=>{let o=typeof n=="string"?n:n.source;return o=o.replace(xO,"$1"),i=i.replace(s,o),r},getRegex:()=>new RegExp(i,t)};return r}function VD(e){try{e=encodeURI(e).replace(/%25/g,"%")}catch{return null}return e}var Fc={exec:()=>null};function zD(e,t){const i=e.replace(/\|/g,(n,o,a)=>{let l=!1,c=o;for(;--c>=0&&a[c]==="\\";)l=!l;return l?"|":" |"}),r=i.split(/ \|/);let s=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),t)if(r.length>t)r.splice(t);else for(;r.length<t;)r.push("");for(;s<r.length;s++)r[s]=r[s].trim().replace(/\\\|/g,"|");return r}function $c(e,t,i){const r=e.length;if(r===0)return"";let s=0;for(;s<r;){const n=e.charAt(r-s-1);if(n===t&&!i)s++;else if(n!==t&&i)s++;else break}return e.slice(0,r-s)}function EO(e,t){if(e.indexOf(t[1])===-1)return-1;let i=0;for(let r=0;r<e.length;r++)if(e[r]==="\\")r++;else if(e[r]===t[0])i++;else if(e[r]===t[1]&&(i--,i<0))return r;return-1}function qD(e,t,i,r){const s=t.href,n=t.title?rr(t.title):null,o=e[1].replace(/\\([\[\]])/g,"$1");if(e[0].charAt(0)!=="!"){r.state.inLink=!0;const a={type:"link",raw:i,href:s,title:n,text:o,tokens:r.inlineTokens(o)};return r.state.inLink=!1,a}return{type:"image",raw:i,href:s,title:n,text:rr(o)}}function CO(e,t){const i=e.match(/^(\s+)(?:```)/);if(i===null)return t;const r=i[1];return t.split(`
`).map(s=>{const n=s.match(/^\s+/);if(n===null)return s;const[o]=n;return o.length>=r.length?s.slice(r.length):s}).join(`
`)}var Bh=class{options;rules;lexer;constructor(e){this.options=e||wo}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const i=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?i:$c(i,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const i=t[0],r=CO(i,t[3]||"");return{type:"code",raw:i,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let i=t[2].trim();if(/#$/.test(i)){const r=$c(i,"#");(this.options.pedantic||!r||/ $/.test(r))&&(i=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:i,tokens:this.lexer.inline(i)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:$c(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let i=$c(t[0],`
`).split(`
`),r="",s="";const n=[];for(;i.length>0;){let o=!1;const a=[];let l;for(l=0;l<i.length;l++)if(/^ {0,3}>/.test(i[l]))a.push(i[l]),o=!0;else if(!o)a.push(i[l]);else break;i=i.slice(l);const c=a.join(`
`),u=c.replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`).replace(/^ {0,3}>[ \t]?/gm,"");r=r?`${r}
${c}`:c,s=s?`${s}
${u}`:u;const d=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,n,!0),this.lexer.state.top=d,i.length===0)break;const f=n[n.length-1];if(f?.type==="code")break;if(f?.type==="blockquote"){const p=f,g=p.raw+`
`+i.join(`
`),v=this.blockquote(g);n[n.length-1]=v,r=r.substring(0,r.length-p.raw.length)+v.raw,s=s.substring(0,s.length-p.text.length)+v.text;break}else if(f?.type==="list"){const p=f,g=p.raw+`
`+i.join(`
`),v=this.list(g);n[n.length-1]=v,r=r.substring(0,r.length-f.raw.length)+v.raw,s=s.substring(0,s.length-p.raw.length)+v.raw,i=g.substring(n[n.length-1].raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:n,text:s}}}list(e){let t=this.rules.block.list.exec(e);if(t){let i=t[1].trim();const r=i.length>1,s={type:"list",raw:"",ordered:r,start:r?+i.slice(0,-1):"",loose:!1,items:[]};i=r?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=r?i:"[*+-]");const n=new RegExp(`^( {0,3}${i})((?:[	 ][^\\n]*)?(?:\\n|$))`);let o=!1;for(;e;){let a=!1,l="",c="";if(!(t=n.exec(e))||this.rules.block.hr.test(e))break;l=t[0],e=e.substring(l.length);let u=t[2].split(`
`,1)[0].replace(/^\t+/,y=>" ".repeat(3*y.length)),d=e.split(`
`,1)[0],f=!u.trim(),p=0;if(this.options.pedantic?(p=2,c=u.trimStart()):f?p=t[1].length+1:(p=t[2].search(/[^ ]/),p=p>4?1:p,c=u.slice(p),p+=t[1].length),f&&/^ *$/.test(d)&&(l+=d+`
`,e=e.substring(d.length+1),a=!0),!a){const y=new RegExp(`^ {0,${Math.min(3,p-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),S=new RegExp(`^ {0,${Math.min(3,p-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),x=new RegExp(`^ {0,${Math.min(3,p-1)}}(?:\`\`\`|~~~)`),P=new RegExp(`^ {0,${Math.min(3,p-1)}}#`);for(;e;){const $=e.split(`
`,1)[0];if(d=$,this.options.pedantic&&(d=d.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),x.test(d)||P.test(d)||y.test(d)||S.test(e))break;if(d.search(/[^ ]/)>=p||!d.trim())c+=`
`+d.slice(p);else{if(f||u.search(/[^ ]/)>=4||x.test(u)||P.test(u)||S.test(u))break;c+=`
`+d}!f&&!d.trim()&&(f=!0),l+=$+`
`,e=e.substring($.length+1),u=d.slice(p)}}s.loose||(o?s.loose=!0:/\n *\n *$/.test(l)&&(o=!0));let g=null,v;this.options.gfm&&(g=/^\[[ xX]\] /.exec(c),g&&(v=g[0]!=="[ ] ",c=c.replace(/^\[[ xX]\] +/,""))),s.items.push({type:"list_item",raw:l,task:!!g,checked:v,loose:!1,text:c,tokens:[]}),s.raw+=l}s.items[s.items.length-1].raw=s.items[s.items.length-1].raw.trimEnd(),s.items[s.items.length-1].text=s.items[s.items.length-1].text.trimEnd(),s.raw=s.raw.trimEnd();for(let a=0;a<s.items.length;a++)if(this.lexer.state.top=!1,s.items[a].tokens=this.lexer.blockTokens(s.items[a].text,[]),!s.loose){const l=s.items[a].tokens.filter(u=>u.type==="space"),c=l.length>0&&l.some(u=>/\n.*\n/.test(u.raw));s.loose=c}if(s.loose)for(let a=0;a<s.items.length;a++)s.items[a].loose=!0;return s}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const i=t[1].toLowerCase().replace(/\s+/g," "),r=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:i,raw:t[0],href:r,title:s}}}table(e){const t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;const i=zD(t[1]),r=t[2].replace(/^\||\| *$/g,"").split("|"),s=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[],n={type:"table",raw:t[0],header:[],align:[],rows:[]};if(i.length===r.length){for(const o of r)/^ *-+: *$/.test(o)?n.align.push("right"):/^ *:-+: *$/.test(o)?n.align.push("center"):/^ *:-+ *$/.test(o)?n.align.push("left"):n.align.push(null);for(let o=0;o<i.length;o++)n.header.push({text:i[o],tokens:this.lexer.inline(i[o]),header:!0,align:n.align[o]});for(const o of s)n.rows.push(zD(o,n.header.length).map((a,l)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:n.align[l]})));return n}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const i=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:i,tokens:this.lexer.inline(i)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:rr(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const i=t[2].trim();if(!this.options.pedantic&&/^</.test(i)){if(!/>$/.test(i))return;const n=$c(i.slice(0,-1),"\\");if((i.length-n.length)%2===0)return}else{const n=EO(t[2],"()");if(n>-1){const a=(t[0].indexOf("!")===0?5:4)+t[1].length+n;t[2]=t[2].substring(0,n),t[0]=t[0].substring(0,a).trim(),t[3]=""}}let r=t[2],s="";if(this.options.pedantic){const n=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(r);n&&(r=n[1],s=n[3])}else s=t[3]?t[3].slice(1,-1):"";return r=r.trim(),/^</.test(r)&&(this.options.pedantic&&!/>$/.test(i)?r=r.slice(1):r=r.slice(1,-1)),qD(t,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}reflink(e,t){let i;if((i=this.rules.inline.reflink.exec(e))||(i=this.rules.inline.nolink.exec(e))){const r=(i[2]||i[1]).replace(/\s+/g," "),s=t[r.toLowerCase()];if(!s){const n=i[0].charAt(0);return{type:"text",raw:n,text:n}}return qD(i,s,i[0],this.lexer)}}emStrong(e,t,i=""){let r=this.rules.inline.emStrongLDelim.exec(e);if(!r||r[3]&&i.match(/[\p{L}\p{N}]/u))return;if(!(r[1]||r[2]||"")||!i||this.rules.inline.punctuation.exec(i)){const n=[...r[0]].length-1;let o,a,l=n,c=0;const u=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(u.lastIndex=0,t=t.slice(-1*e.length+n);(r=u.exec(t))!=null;){if(o=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!o)continue;if(a=[...o].length,r[3]||r[4]){l+=a;continue}else if((r[5]||r[6])&&n%3&&!((n+a)%3)){c+=a;continue}if(l-=a,l>0)continue;a=Math.min(a,a+l+c);const d=[...r[0]][0].length,f=e.slice(0,n+r.index+d+a);if(Math.min(n,a)%2){const g=f.slice(1,-1);return{type:"em",raw:f,text:g,tokens:this.lexer.inlineTokens(g)}}const p=f.slice(2,-2);return{type:"strong",raw:f,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let i=t[2].replace(/\n/g," ");const r=/[^ ]/.test(i),s=/^ /.test(i)&&/ $/.test(i);return r&&s&&(i=i.substring(1,i.length-1)),i=rr(i,!0),{type:"codespan",raw:t[0],text:i}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let i,r;return t[2]==="@"?(i=rr(t[1]),r="mailto:"+i):(i=rr(t[1]),r=i),{type:"link",raw:t[0],text:i,href:r,tokens:[{type:"text",raw:i,text:i}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let i,r;if(t[2]==="@")i=rr(t[0]),r="mailto:"+i;else{let s;do s=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(s!==t[0]);i=rr(t[0]),t[1]==="www."?r="http://"+t[0]:r=t[0]}return{type:"link",raw:t[0],text:i,href:r,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let i;return this.lexer.state.inRawBlock?i=t[0]:i=rr(t[0]),{type:"text",raw:t[0],text:i}}}},DO=/^(?: *(?:\n|$))+/,kO=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,IO=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Hc=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,PO=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,jD=/(?:[*+-]|\d{1,9}[.)])/,GD=vt(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,jD).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),T1=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,TO=/^[^\n]+/,A1=/(?!\s*\])(?:\\.|[^\[\]\\])+/,AO=vt(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",A1).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),RO=vt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,jD).getRegex(),Vh="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",R1=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,LO=vt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",R1).replace("tag",Vh).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),QD=vt(T1).replace("hr",Hc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Vh).getRegex(),NO=vt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",QD).getRegex(),L1={blockquote:NO,code:kO,def:AO,fences:IO,heading:PO,hr:Hc,html:LO,lheading:GD,list:RO,newline:DO,paragraph:QD,table:Fc,text:TO},JD=vt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Hc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Vh).getRegex(),MO={...L1,table:JD,paragraph:vt(T1).replace("hr",Hc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",JD).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Vh).getRegex()},OO={...L1,html:vt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",R1).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Fc,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:vt(T1).replace("hr",Hc).replace("heading",` *#{1,6} *[^
]`).replace("lheading",GD).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},KD=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,FO=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,XD=/^( {2,}|\\)\n(?!\s*$)/,$O=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Uc="\\p{P}\\p{S}",HO=vt(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,Uc).getRegex(),UO=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,WO=vt(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,Uc).getRegex(),BO=vt("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,Uc).getRegex(),VO=vt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,Uc).getRegex(),zO=vt(/\\([punct])/,"gu").replace(/punct/g,Uc).getRegex(),qO=vt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),jO=vt(R1).replace("(?:-->|$)","-->").getRegex(),GO=vt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",jO).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),zh=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,QO=vt(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",zh).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),YD=vt(/^!?\[(label)\]\[(ref)\]/).replace("label",zh).replace("ref",A1).getRegex(),ZD=vt(/^!?\[(ref)\](?:\[\])?/).replace("ref",A1).getRegex(),JO=vt("reflink|nolink(?!\\()","g").replace("reflink",YD).replace("nolink",ZD).getRegex(),N1={_backpedal:Fc,anyPunctuation:zO,autolink:qO,blockSkip:UO,br:XD,code:FO,del:Fc,emStrongLDelim:WO,emStrongRDelimAst:BO,emStrongRDelimUnd:VO,escape:KD,link:QO,nolink:ZD,punctuation:HO,reflink:YD,reflinkSearch:JO,tag:GO,text:$O,url:Fc},KO={...N1,link:vt(/^!?\[(label)\]\((.*?)\)/).replace("label",zh).getRegex(),reflink:vt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",zh).getRegex()},M1={...N1,escape:vt(KD).replace("])","~|])").getRegex(),url:vt(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},XO={...M1,br:vt(XD).replace("{2,}","*").getRegex(),text:vt(M1.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},qh={normal:L1,gfm:MO,pedantic:OO},Wc={normal:N1,gfm:M1,breaks:XO,pedantic:KO},yo=class ES{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||wo,this.options.tokenizer=this.options.tokenizer||new Bh,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const i={block:qh.normal,inline:Wc.normal};this.options.pedantic?(i.block=qh.pedantic,i.inline=Wc.pedantic):this.options.gfm&&(i.block=qh.gfm,this.options.breaks?i.inline=Wc.breaks:i.inline=Wc.gfm),this.tokenizer.rules=i}static get rules(){return{block:qh,inline:Wc}}static lex(t,i){return new ES(i).lex(t)}static lexInline(t,i){return new ES(i).inlineTokens(t)}lex(t){t=t.replace(/\r\n|\r/g,`
`),this.blockTokens(t,this.tokens);for(let i=0;i<this.inlineQueue.length;i++){const r=this.inlineQueue[i];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,i=[],r=!1){this.options.pedantic?t=t.replace(/\t/g,"    ").replace(/^ +$/gm,""):t=t.replace(/^( *)(\t+)/gm,(a,l,c)=>l+"    ".repeat(c.length));let s,n,o;for(;t;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(s=a.call({lexer:this},t,i))?(t=t.substring(s.raw.length),i.push(s),!0):!1))){if(s=this.tokenizer.space(t)){t=t.substring(s.raw.length),s.raw.length===1&&i.length>0?i[i.length-1].raw+=`
`:i.push(s);continue}if(s=this.tokenizer.code(t)){t=t.substring(s.raw.length),n=i[i.length-1],n&&(n.type==="paragraph"||n.type==="text")?(n.raw+=`
`+s.raw,n.text+=`
`+s.text,this.inlineQueue[this.inlineQueue.length-1].src=n.text):i.push(s);continue}if(s=this.tokenizer.fences(t)){t=t.substring(s.raw.length),i.push(s);continue}if(s=this.tokenizer.heading(t)){t=t.substring(s.raw.length),i.push(s);continue}if(s=this.tokenizer.hr(t)){t=t.substring(s.raw.length),i.push(s);continue}if(s=this.tokenizer.blockquote(t)){t=t.substring(s.raw.length),i.push(s);continue}if(s=this.tokenizer.list(t)){t=t.substring(s.raw.length),i.push(s);continue}if(s=this.tokenizer.html(t)){t=t.substring(s.raw.length),i.push(s);continue}if(s=this.tokenizer.def(t)){t=t.substring(s.raw.length),n=i[i.length-1],n&&(n.type==="paragraph"||n.type==="text")?(n.raw+=`
`+s.raw,n.text+=`
`+s.raw,this.inlineQueue[this.inlineQueue.length-1].src=n.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title});continue}if(s=this.tokenizer.table(t)){t=t.substring(s.raw.length),i.push(s);continue}if(s=this.tokenizer.lheading(t)){t=t.substring(s.raw.length),i.push(s);continue}if(o=t,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const l=t.slice(1);let c;this.options.extensions.startBlock.forEach(u=>{c=u.call({lexer:this},l),typeof c=="number"&&c>=0&&(a=Math.min(a,c))}),a<1/0&&a>=0&&(o=t.substring(0,a+1))}if(this.state.top&&(s=this.tokenizer.paragraph(o))){n=i[i.length-1],r&&n?.type==="paragraph"?(n.raw+=`
`+s.raw,n.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=n.text):i.push(s),r=o.length!==t.length,t=t.substring(s.raw.length);continue}if(s=this.tokenizer.text(t)){t=t.substring(s.raw.length),n=i[i.length-1],n&&n.type==="text"?(n.raw+=`
`+s.raw,n.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=n.text):i.push(s);continue}if(t){const a="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,i}inline(t,i=[]){return this.inlineQueue.push({src:t,tokens:i}),i}inlineTokens(t,i=[]){let r,s,n,o=t,a,l,c;if(this.tokens.links){const u=Object.keys(this.tokens.links);if(u.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)u.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,a.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;t;)if(l||(c=""),l=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(u=>(r=u.call({lexer:this},t,i))?(t=t.substring(r.raw.length),i.push(r),!0):!1))){if(r=this.tokenizer.escape(t)){t=t.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.tag(t)){t=t.substring(r.raw.length),s=i[i.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):i.push(r);continue}if(r=this.tokenizer.link(t)){t=t.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(r.raw.length),s=i[i.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):i.push(r);continue}if(r=this.tokenizer.emStrong(t,o,c)){t=t.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.codespan(t)){t=t.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.br(t)){t=t.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.del(t)){t=t.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.autolink(t)){t=t.substring(r.raw.length),i.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(t))){t=t.substring(r.raw.length),i.push(r);continue}if(n=t,this.options.extensions&&this.options.extensions.startInline){let u=1/0;const d=t.slice(1);let f;this.options.extensions.startInline.forEach(p=>{f=p.call({lexer:this},d),typeof f=="number"&&f>=0&&(u=Math.min(u,f))}),u<1/0&&u>=0&&(n=t.substring(0,u+1))}if(r=this.tokenizer.inlineText(n)){t=t.substring(r.raw.length),r.raw.slice(-1)!=="_"&&(c=r.raw.slice(-1)),l=!0,s=i[i.length-1],s&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):i.push(r);continue}if(t){const u="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return i}},jh=class{options;parser;constructor(e){this.options=e||wo}space(e){return""}code({text:e,lang:t,escaped:i}){const r=(t||"").match(/^\S*/)?.[0],s=e.replace(/\n$/,"")+`
`;return r?'<pre><code class="language-'+rr(r)+'">'+(i?s:rr(s,!0))+`</code></pre>
`:"<pre><code>"+(i?s:rr(s,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,i=e.start;let r="";for(let o=0;o<e.items.length;o++){const a=e.items[o];r+=this.listitem(a)}const s=t?"ol":"ul",n=t&&i!==1?' start="'+i+'"':"";return"<"+s+n+`>
`+r+"</"+s+`>
`}listitem(e){let t="";if(e.task){const i=this.checkbox({checked:!!e.checked});e.loose?e.tokens.length>0&&e.tokens[0].type==="paragraph"?(e.tokens[0].text=i+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=i+" "+e.tokens[0].tokens[0].text)):e.tokens.unshift({type:"text",raw:i+" ",text:i+" "}):t+=i+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",i="";for(let s=0;s<e.header.length;s++)i+=this.tablecell(e.header[s]);t+=this.tablerow({text:i});let r="";for(let s=0;s<e.rows.length;s++){const n=e.rows[s];i="";for(let o=0;o<n.length;o++)i+=this.tablecell(n[o]);r+=this.tablerow({text:i})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+r+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),i=e.header?"th":"td";return(e.align?`<${i} align="${e.align}">`:`<${i}>`)+t+`</${i}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${e}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:i}){const r=this.parser.parseInline(i),s=VD(e);if(s===null)return r;e=s;let n='<a href="'+e+'"';return t&&(n+=' title="'+t+'"'),n+=">"+r+"</a>",n}image({href:e,title:t,text:i}){const r=VD(e);if(r===null)return i;e=r;let s=`<img src="${e}" alt="${i}"`;return t&&(s+=` title="${t}"`),s+=">",s}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):e.text}},O1=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},bo=class CS{options;renderer;textRenderer;constructor(t){this.options=t||wo,this.options.renderer=this.options.renderer||new jh,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new O1}static parse(t,i){return new CS(i).parse(t)}static parseInline(t,i){return new CS(i).parseInline(t)}parse(t,i=!0){let r="";for(let s=0;s<t.length;s++){const n=t[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]){const a=n,l=this.options.extensions.renderers[a.type].call({parser:this},a);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){r+=l||"";continue}}const o=n;switch(o.type){case"space":{r+=this.renderer.space(o);continue}case"hr":{r+=this.renderer.hr(o);continue}case"heading":{r+=this.renderer.heading(o);continue}case"code":{r+=this.renderer.code(o);continue}case"table":{r+=this.renderer.table(o);continue}case"blockquote":{r+=this.renderer.blockquote(o);continue}case"list":{r+=this.renderer.list(o);continue}case"html":{r+=this.renderer.html(o);continue}case"paragraph":{r+=this.renderer.paragraph(o);continue}case"text":{let a=o,l=this.renderer.text(a);for(;s+1<t.length&&t[s+1].type==="text";)a=t[++s],l+=`
`+this.renderer.text(a);i?r+=this.renderer.paragraph({type:"paragraph",raw:l,text:l,tokens:[{type:"text",raw:l,text:l}]}):r+=l;continue}default:{const a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}parseInline(t,i){i=i||this.renderer;let r="";for(let s=0;s<t.length;s++){const n=t[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]){const a=this.options.extensions.renderers[n.type].call({parser:this},n);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(n.type)){r+=a||"";continue}}const o=n;switch(o.type){case"escape":{r+=i.text(o);break}case"html":{r+=i.html(o);break}case"link":{r+=i.link(o);break}case"image":{r+=i.image(o);break}case"strong":{r+=i.strong(o);break}case"em":{r+=i.em(o);break}case"codespan":{r+=i.codespan(o);break}case"br":{r+=i.br(o);break}case"del":{r+=i.del(o);break}case"text":{r+=i.text(o);break}default:{const a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}},Gh=class{options;constructor(e){this.options=e||wo}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}},YO=class{defaults=P1();options=this.setOptions;parse=this.parseMarkdown(yo.lex,bo.parse);parseInline=this.parseMarkdown(yo.lexInline,bo.parseInline);Parser=bo;Renderer=jh;TextRenderer=O1;Lexer=yo;Tokenizer=Bh;Hooks=Gh;constructor(...e){this.use(...e)}walkTokens(e,t){let i=[];for(const r of e)switch(i=i.concat(t.call(this,r)),r.type){case"table":{const s=r;for(const n of s.header)i=i.concat(this.walkTokens(n.tokens,t));for(const n of s.rows)for(const o of n)i=i.concat(this.walkTokens(o.tokens,t));break}case"list":{const s=r;i=i.concat(this.walkTokens(s.items,t));break}default:{const s=r;this.defaults.extensions?.childTokens?.[s.type]?this.defaults.extensions.childTokens[s.type].forEach(n=>{const o=s[n].flat(1/0);i=i.concat(this.walkTokens(o,t))}):s.tokens&&(i=i.concat(this.walkTokens(s.tokens,t)))}}return i}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(i=>{const r={...i};if(r.async=this.defaults.async||r.async||!1,i.extensions&&(i.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){const n=t.renderers[s.name];n?t.renderers[s.name]=function(...o){let a=s.renderer.apply(this,o);return a===!1&&(a=n.apply(this,o)),a}:t.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const n=t[s.level];n?n.unshift(s.tokenizer):t[s.level]=[s.tokenizer],s.start&&(s.level==="block"?t.startBlock?t.startBlock.push(s.start):t.startBlock=[s.start]:s.level==="inline"&&(t.startInline?t.startInline.push(s.start):t.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(t.childTokens[s.name]=s.childTokens)}),r.extensions=t),i.renderer){const s=this.defaults.renderer||new jh(this.defaults);for(const n in i.renderer){if(!(n in s))throw new Error(`renderer '${n}' does not exist`);if(["options","parser"].includes(n))continue;const o=n,a=i.renderer[o],l=s[o];s[o]=(...c)=>{let u=a.apply(s,c);return u===!1&&(u=l.apply(s,c)),u||""}}r.renderer=s}if(i.tokenizer){const s=this.defaults.tokenizer||new Bh(this.defaults);for(const n in i.tokenizer){if(!(n in s))throw new Error(`tokenizer '${n}' does not exist`);if(["options","rules","lexer"].includes(n))continue;const o=n,a=i.tokenizer[o],l=s[o];s[o]=(...c)=>{let u=a.apply(s,c);return u===!1&&(u=l.apply(s,c)),u}}r.tokenizer=s}if(i.hooks){const s=this.defaults.hooks||new Gh;for(const n in i.hooks){if(!(n in s))throw new Error(`hook '${n}' does not exist`);if(n==="options")continue;const o=n,a=i.hooks[o],l=s[o];Gh.passThroughHooks.has(n)?s[o]=c=>{if(this.defaults.async)return Promise.resolve(a.call(s,c)).then(d=>l.call(s,d));const u=a.call(s,c);return l.call(s,u)}:s[o]=(...c)=>{let u=a.apply(s,c);return u===!1&&(u=l.apply(s,c)),u}}r.hooks=s}if(i.walkTokens){const s=this.defaults.walkTokens,n=i.walkTokens;r.walkTokens=function(o){let a=[];return a.push(n.call(this,o)),s&&(a=a.concat(s.call(this,o))),a}}this.defaults={...this.defaults,...r}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return yo.lex(e,t??this.defaults)}parser(e,t){return bo.parse(e,t??this.defaults)}parseMarkdown(e,t){return(r,s)=>{const n={...s},o={...this.defaults,...n},a=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&n.async===!1)return a(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof r>"u"||r===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof r!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(r)+", string expected"));if(o.hooks&&(o.hooks.options=o),o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(r):r).then(l=>e(l,o)).then(l=>o.hooks?o.hooks.processAllTokens(l):l).then(l=>o.walkTokens?Promise.all(this.walkTokens(l,o.walkTokens)).then(()=>l):l).then(l=>t(l,o)).then(l=>o.hooks?o.hooks.postprocess(l):l).catch(a);try{o.hooks&&(r=o.hooks.preprocess(r));let l=e(r,o);o.hooks&&(l=o.hooks.processAllTokens(l)),o.walkTokens&&this.walkTokens(l,o.walkTokens);let c=t(l,o);return o.hooks&&(c=o.hooks.postprocess(c)),c}catch(l){return a(l)}}}onError(e,t){return i=>{if(i.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const r="<p>An error occurred:</p><pre>"+rr(i.message+"",!0)+"</pre>";return t?Promise.resolve(r):r}if(t)return Promise.reject(i);throw i}}},So=new YO;function ht(e,t){return So.parse(e,t)}ht.options=ht.setOptions=function(e){return So.setOptions(e),ht.defaults=So.defaults,HD(ht.defaults),ht},ht.getDefaults=P1,ht.defaults=wo,ht.use=function(...e){return So.use(...e),ht.defaults=So.defaults,HD(ht.defaults),ht},ht.walkTokens=function(e,t){return So.walkTokens(e,t)},ht.parseInline=So.parseInline,ht.Parser=bo,ht.parser=bo.parse,ht.Renderer=jh,ht.TextRenderer=O1,ht.Lexer=yo,ht.lexer=yo.lex,ht.Tokenizer=Bh,ht.Hooks=Gh,ht.parse=ht;var dX=ht.options,hX=ht.setOptions,fX=ht.use,pX=ht.walkTokens,gX=ht.parseInline,mX=bo.parse,vX=yo.lex,Ms=Object.freeze({text:"text/plain",binary:"application/octet-stream",unknown:"application/unknown",markdown:"text/markdown",latex:"text/latex",uriList:"text/uri-list",html:"text/html"}),ZO=/^(.+)\/(.+?)(;.+)?$/;function ek(e,t){const i=ZO.exec(e);return i?`${i[1].toLowerCase()}/${i[2].toLowerCase()}${i[3]??""}`:t?void 0:e}var yi=Symbol("unset"),eF=class{constructor(){this.root=new F1,this._size=0}get size(){return this._size}get nodes(){return this.root.children?.values()||ai.empty()}get entries(){return this.root.children?.entries()||ai.empty()}insert(e,t,i){this.opNode(e,r=>r._value=t,i)}mutate(e,t){this.opNode(e,i=>i._value=t(i._value===yi?void 0:i._value))}mutatePath(e,t){this.opNode(e,()=>{},i=>t(i))}delete(e){const t=this.getPathToKey(e);if(!t)return;let i=t.length-1;const r=t[i].node._value;if(r!==yi){for(this._size--,t[i].node._value=yi;i>0;i--){const{node:s,part:n}=t[i];if(s.children?.size||s._value!==yi)break;t[i-1].node.children.delete(n)}return r}}*deleteRecursive(e){const t=this.getPathToKey(e);if(!t)return;const i=t[t.length-1].node;for(let r=t.length-1;r>0;r--){const s=t[r-1];if(s.node.children.delete(t[r].part),s.node.children.size>0||s.node._value!==yi)break}for(const r of tk(i))r._value!==yi&&(this._size--,yield r._value);i===this.root&&(this.root._value=yi,this.root.children=void 0)}find(e){let t=this.root;for(const i of e){const r=t.children?.get(i);if(!r)return;t=r}return t._value===yi?void 0:t._value}hasKeyOrParent(e){let t=this.root;for(const i of e){const r=t.children?.get(i);if(!r)return!1;if(r._value!==yi)return!0;t=r}return!1}hasKeyOrChildren(e){let t=this.root;for(const i of e){const r=t.children?.get(i);if(!r)return!1;t=r}return!0}hasKey(e){let t=this.root;for(const i of e){const r=t.children?.get(i);if(!r)return!1;t=r}return t._value!==yi}getPathToKey(e){const t=[{part:"",node:this.root}];let i=0;for(const r of e){const s=t[i].node.children?.get(r);if(!s)return;t.push({part:r,node:s}),i++}return t}opNode(e,t,i){let r=this.root;for(const o of e){if(r.children)if(r.children.has(o))r=r.children.get(o);else{const a=new F1;r.children.set(o,a),r=a}else{const a=new F1;r.children=new Map([[o,a]]),r=a}i?.(r)}const s=r._value===yi?0:1;t(r);const n=r._value===yi?0:1;this._size+=n-s}*values(){for(const{_value:e}of tk(this.root))e!==yi&&(yield e)}};function*tk(e){const t=[e];for(;t.length>0;){const i=t.pop();if(yield i,i.children)for(const r of i.children.values())t.push(r)}}var F1=class{constructor(){this._value=yi}get value(){return this._value===yi?void 0:this._value}set value(e){this._value=e===void 0?yi:e}},sr=class da{constructor(t,i){this.lineNumber=t,this.column=i}with(t=this.lineNumber,i=this.column){return t===this.lineNumber&&i===this.column?this:new da(t,i)}delta(t=0,i=0){return this.with(Math.max(1,this.lineNumber+t),Math.max(1,this.column+i))}equals(t){return da.equals(this,t)}static equals(t,i){return!t&&!i?!0:!!t&&!!i&&t.lineNumber===i.lineNumber&&t.column===i.column}isBefore(t){return da.isBefore(this,t)}static isBefore(t,i){return t.lineNumber<i.lineNumber?!0:i.lineNumber<t.lineNumber?!1:t.column<i.column}isBeforeOrEqual(t){return da.isBeforeOrEqual(this,t)}static isBeforeOrEqual(t,i){return t.lineNumber<i.lineNumber?!0:i.lineNumber<t.lineNumber?!1:t.column<=i.column}static compare(t,i){const r=t.lineNumber|0,s=i.lineNumber|0;if(r===s){const n=t.column|0,o=i.column|0;return n-o}return r-s}clone(){return new da(this.lineNumber,this.column)}toString(){return"("+this.lineNumber+","+this.column+")"}static lift(t){return new da(t.lineNumber,t.column)}static isIPosition(t){return t&&typeof t.lineNumber=="number"&&typeof t.column=="number"}toJSON(){return{lineNumber:this.lineNumber,column:this.column}}},je=class Qt{constructor(t,i,r,s){t>r||t===r&&i>s?(this.startLineNumber=r,this.startColumn=s,this.endLineNumber=t,this.endColumn=i):(this.startLineNumber=t,this.startColumn=i,this.endLineNumber=r,this.endColumn=s)}isEmpty(){return Qt.isEmpty(this)}static isEmpty(t){return t.startLineNumber===t.endLineNumber&&t.startColumn===t.endColumn}containsPosition(t){return Qt.containsPosition(this,t)}static containsPosition(t,i){return!(i.lineNumber<t.startLineNumber||i.lineNumber>t.endLineNumber||i.lineNumber===t.startLineNumber&&i.column<t.startColumn||i.lineNumber===t.endLineNumber&&i.column>t.endColumn)}static strictContainsPosition(t,i){return!(i.lineNumber<t.startLineNumber||i.lineNumber>t.endLineNumber||i.lineNumber===t.startLineNumber&&i.column<=t.startColumn||i.lineNumber===t.endLineNumber&&i.column>=t.endColumn)}containsRange(t){return Qt.containsRange(this,t)}static containsRange(t,i){return!(i.startLineNumber<t.startLineNumber||i.endLineNumber<t.startLineNumber||i.startLineNumber>t.endLineNumber||i.endLineNumber>t.endLineNumber||i.startLineNumber===t.startLineNumber&&i.startColumn<t.startColumn||i.endLineNumber===t.endLineNumber&&i.endColumn>t.endColumn)}strictContainsRange(t){return Qt.strictContainsRange(this,t)}static strictContainsRange(t,i){return!(i.startLineNumber<t.startLineNumber||i.endLineNumber<t.startLineNumber||i.startLineNumber>t.endLineNumber||i.endLineNumber>t.endLineNumber||i.startLineNumber===t.startLineNumber&&i.startColumn<=t.startColumn||i.endLineNumber===t.endLineNumber&&i.endColumn>=t.endColumn)}plusRange(t){return Qt.plusRange(this,t)}static plusRange(t,i){let r,s,n,o;return i.startLineNumber<t.startLineNumber?(r=i.startLineNumber,s=i.startColumn):i.startLineNumber===t.startLineNumber?(r=i.startLineNumber,s=Math.min(i.startColumn,t.startColumn)):(r=t.startLineNumber,s=t.startColumn),i.endLineNumber>t.endLineNumber?(n=i.endLineNumber,o=i.endColumn):i.endLineNumber===t.endLineNumber?(n=i.endLineNumber,o=Math.max(i.endColumn,t.endColumn)):(n=t.endLineNumber,o=t.endColumn),new Qt(r,s,n,o)}intersectRanges(t){return Qt.intersectRanges(this,t)}static intersectRanges(t,i){let r=t.startLineNumber,s=t.startColumn,n=t.endLineNumber,o=t.endColumn;const a=i.startLineNumber,l=i.startColumn,c=i.endLineNumber,u=i.endColumn;return r<a?(r=a,s=l):r===a&&(s=Math.max(s,l)),n>c?(n=c,o=u):n===c&&(o=Math.min(o,u)),r>n||r===n&&s>o?null:new Qt(r,s,n,o)}equalsRange(t){return Qt.equalsRange(this,t)}static equalsRange(t,i){return!t&&!i?!0:!!t&&!!i&&t.startLineNumber===i.startLineNumber&&t.startColumn===i.startColumn&&t.endLineNumber===i.endLineNumber&&t.endColumn===i.endColumn}getEndPosition(){return Qt.getEndPosition(this)}static getEndPosition(t){return new sr(t.endLineNumber,t.endColumn)}getStartPosition(){return Qt.getStartPosition(this)}static getStartPosition(t){return new sr(t.startLineNumber,t.startColumn)}toString(){return"["+this.startLineNumber+","+this.startColumn+" -> "+this.endLineNumber+","+this.endColumn+"]"}setEndPosition(t,i){return new Qt(this.startLineNumber,this.startColumn,t,i)}setStartPosition(t,i){return new Qt(t,i,this.endLineNumber,this.endColumn)}collapseToStart(){return Qt.collapseToStart(this)}static collapseToStart(t){return new Qt(t.startLineNumber,t.startColumn,t.startLineNumber,t.startColumn)}collapseToEnd(){return Qt.collapseToEnd(this)}static collapseToEnd(t){return new Qt(t.endLineNumber,t.endColumn,t.endLineNumber,t.endColumn)}delta(t){return new Qt(this.startLineNumber+t,this.startColumn,this.endLineNumber+t,this.endColumn)}isSingleLine(){return this.startLineNumber===this.endLineNumber}static fromPositions(t,i=t){return new Qt(t.lineNumber,t.column,i.lineNumber,i.column)}static lift(t){return t?new Qt(t.startLineNumber,t.startColumn,t.endLineNumber,t.endColumn):null}static isIRange(t){return t&&typeof t.startLineNumber=="number"&&typeof t.startColumn=="number"&&typeof t.endLineNumber=="number"&&typeof t.endColumn=="number"}static areIntersectingOrTouching(t,i){return!(t.endLineNumber<i.startLineNumber||t.endLineNumber===i.startLineNumber&&t.endColumn<i.startColumn||i.endLineNumber<t.startLineNumber||i.endLineNumber===t.startLineNumber&&i.endColumn<t.startColumn)}static areIntersecting(t,i){return!(t.endLineNumber<i.startLineNumber||t.endLineNumber===i.startLineNumber&&t.endColumn<=i.startColumn||i.endLineNumber<t.startLineNumber||i.endLineNumber===t.startLineNumber&&i.endColumn<=t.startColumn)}static areOnlyIntersecting(t,i){return!(t.endLineNumber<i.startLineNumber-1||t.endLineNumber===i.startLineNumber&&t.endColumn<i.startColumn-1||i.endLineNumber<t.startLineNumber-1||i.endLineNumber===t.startLineNumber&&i.endColumn<t.startColumn-1)}static compareRangesUsingStarts(t,i){if(t&&i){const n=t.startLineNumber|0,o=i.startLineNumber|0;if(n===o){const a=t.startColumn|0,l=i.startColumn|0;if(a===l){const c=t.endLineNumber|0,u=i.endLineNumber|0;if(c===u){const d=t.endColumn|0,f=i.endColumn|0;return d-f}return c-u}return a-l}return n-o}return(t?1:0)-(i?1:0)}static compareRangesUsingEnds(t,i){return t.endLineNumber===i.endLineNumber?t.endColumn===i.endColumn?t.startLineNumber===i.startLineNumber?t.startColumn-i.startColumn:t.startLineNumber-i.startLineNumber:t.endColumn-i.endColumn:t.endLineNumber-i.endLineNumber}static spansMultipleLines(t){return t.endLineNumber>t.startLineNumber}toJSON(){return this}},tF=class{static insert(e,t){return{range:new je(e.lineNumber,e.column,e.lineNumber,e.column),text:t,forceMoveMarkers:!0}}static delete(e){return{range:e,text:null}}static replace(e,t){return{range:e,text:t}}static replaceMove(e,t){return{range:e,text:t,forceMoveMarkers:!0}}},ik=class{constructor(){this._tokenizationSupports=new Map,this._factories=new Map,this._onDidChange=new D,this.onDidChange=this._onDidChange.event,this._colorMap=null}handleChange(e){this._onDidChange.fire({changedLanguages:e,changedColorMap:!1})}register(e,t){return this._tokenizationSupports.set(e,t),this.handleChange([e]),ie(()=>{this._tokenizationSupports.get(e)===t&&(this._tokenizationSupports.delete(e),this.handleChange([e]))})}get(e){return this._tokenizationSupports.get(e)||null}registerFactory(e,t){this._factories.get(e)?.dispose();const i=new iF(this,e,t);return this._factories.set(e,i),ie(()=>{const r=this._factories.get(e);!r||r!==i||(this._factories.delete(e),r.dispose())})}async getOrCreate(e){const t=this.get(e);if(t)return t;const i=this._factories.get(e);return!i||i.isResolved?null:(await i.resolve(),this.get(e))}isResolved(e){if(this.get(e))return!0;const i=this._factories.get(e);return!!(!i||i.isResolved)}setColorMap(e){this._colorMap=e,this._onDidChange.fire({changedLanguages:Array.from(this._tokenizationSupports.keys()),changedColorMap:!0})}getColorMap(){return this._colorMap}getDefaultBackground(){return this._colorMap&&this._colorMap.length>2?this._colorMap[2]:null}},iF=class extends X{get isResolved(){return this._isResolved}constructor(e,t,i){super(),this._registry=e,this._languageId=t,this._factory=i,this._isDisposed=!1,this._resolvePromise=null,this._isResolved=!1}dispose(){this._isDisposed=!0,super.dispose()}async resolve(){return this._resolvePromise||(this._resolvePromise=this._create()),this._resolvePromise}async _create(){const e=await this._factory.tokenizationSupport;this._isResolved=!0,e&&!this._isDisposed&&this._register(this._registry.register(this._languageId,e))}},rk;(function(e){e[e.Increase=0]="Increase",e[e.Decrease=1]="Decrease"})(rk||(rk={}));var sk;(function(e){e[e.Method=0]="Method",e[e.Function=1]="Function",e[e.Constructor=2]="Constructor",e[e.Field=3]="Field",e[e.Variable=4]="Variable",e[e.Class=5]="Class",e[e.Struct=6]="Struct",e[e.Interface=7]="Interface",e[e.Module=8]="Module",e[e.Property=9]="Property",e[e.Event=10]="Event",e[e.Operator=11]="Operator",e[e.Unit=12]="Unit",e[e.Value=13]="Value",e[e.Constant=14]="Constant",e[e.Enum=15]="Enum",e[e.EnumMember=16]="EnumMember",e[e.Keyword=17]="Keyword",e[e.Text=18]="Text",e[e.Color=19]="Color",e[e.File=20]="File",e[e.Reference=21]="Reference",e[e.Customcolor=22]="Customcolor",e[e.Folder=23]="Folder",e[e.TypeParameter=24]="TypeParameter",e[e.User=25]="User",e[e.Issue=26]="Issue",e[e.Snippet=27]="Snippet"})(sk||(sk={}));var nk;(function(e){const t=new Map;t.set(0,ue.symbolMethod),t.set(1,ue.symbolFunction),t.set(2,ue.symbolConstructor),t.set(3,ue.symbolField),t.set(4,ue.symbolVariable),t.set(5,ue.symbolClass),t.set(6,ue.symbolStruct),t.set(7,ue.symbolInterface),t.set(8,ue.symbolModule),t.set(9,ue.symbolProperty),t.set(10,ue.symbolEvent),t.set(11,ue.symbolOperator),t.set(12,ue.symbolUnit),t.set(13,ue.symbolValue),t.set(15,ue.symbolEnum),t.set(14,ue.symbolConstant),t.set(15,ue.symbolEnum),t.set(16,ue.symbolEnumMember),t.set(17,ue.symbolKeyword),t.set(27,ue.symbolSnippet),t.set(18,ue.symbolText),t.set(19,ue.symbolColor),t.set(20,ue.symbolFile),t.set(21,ue.symbolReference),t.set(22,ue.symbolCustomColor),t.set(23,ue.symbolFolder),t.set(24,ue.symbolTypeParameter),t.set(25,ue.account),t.set(26,ue.issues);function i(o){let a=t.get(o);return a||(console.info("No codicon found for CompletionItemKind "+o),a=ue.symbolProperty),a}e.toIcon=i;function r(o){switch(o){case 0:return h(822,null);case 1:return h(823,null);case 2:return h(824,null);case 3:return h(825,null);case 4:return h(826,null);case 5:return h(827,null);case 6:return h(828,null);case 7:return h(829,null);case 8:return h(830,null);case 9:return h(831,null);case 10:return h(832,null);case 11:return h(833,null);case 12:return h(834,null);case 13:return h(835,null);case 14:return h(836,null);case 15:return h(837,null);case 16:return h(838,null);case 17:return h(839,null);case 18:return h(840,null);case 19:return h(841,null);case 20:return h(842,null);case 21:return h(843,null);case 22:return h(844,null);case 23:return h(845,null);case 24:return h(846,null);case 25:return h(847,null);case 26:return h(848,null);case 27:return h(849,null);default:return""}}e.toLabel=r;const s=new Map;s.set("method",0),s.set("function",1),s.set("constructor",2),s.set("field",3),s.set("variable",4),s.set("class",5),s.set("struct",6),s.set("interface",7),s.set("module",8),s.set("property",9),s.set("event",10),s.set("operator",11),s.set("unit",12),s.set("value",13),s.set("constant",14),s.set("enum",15),s.set("enum-member",16),s.set("enumMember",16),s.set("keyword",17),s.set("snippet",27),s.set("text",18),s.set("color",19),s.set("file",20),s.set("reference",21),s.set("customcolor",22),s.set("folder",23),s.set("type-parameter",24),s.set("typeParameter",24),s.set("account",25),s.set("issue",26);function n(o,a){let l=s.get(o);return typeof l>"u"&&!a&&(l=9),l}e.fromString=n})(nk||(nk={}));var ok;(function(e){e[e.Deprecated=1]="Deprecated"})(ok||(ok={}));var ak;(function(e){e[e.None=0]="None",e[e.KeepWhitespace=1]="KeepWhitespace",e[e.InsertAsSnippet=4]="InsertAsSnippet"})(ak||(ak={}));var lk;(function(e){e[e.Word=0]="Word",e[e.Line=1]="Line",e[e.Suggest=2]="Suggest"})(lk||(lk={}));var ck;(function(e){e[e.Invoke=0]="Invoke",e[e.TriggerCharacter=1]="TriggerCharacter",e[e.TriggerForIncompleteCompletions=2]="TriggerForIncompleteCompletions"})(ck||(ck={}));var Qh;(function(e){e[e.Automatic=0]="Automatic",e[e.Explicit=1]="Explicit"})(Qh||(Qh={}));var Jh;(function(e){e[e.Accepted=0]="Accepted",e[e.Rejected=1]="Rejected",e[e.Ignored=2]="Ignored"})(Jh||(Jh={}));var uk;(function(e){e[e.Invoke=1]="Invoke",e[e.Auto=2]="Auto"})(uk||(uk={}));var dk;(function(e){e[e.Automatic=0]="Automatic",e[e.PasteAs=1]="PasteAs"})(dk||(dk={}));var hk;(function(e){e[e.Invoke=1]="Invoke",e[e.TriggerCharacter=2]="TriggerCharacter",e[e.ContentChange=3]="ContentChange"})(hk||(hk={}));var fk;(function(e){e[e.Text=0]="Text",e[e.Read=1]="Read",e[e.Write=2]="Write"})(fk||(fk={}));function rF(e){return e&&b.isUri(e.uri)&&je.isIRange(e.range)&&(je.isIRange(e.originSelectionRange)||je.isIRange(e.targetSelectionRange))}var pk;(function(e){e[e.File=0]="File",e[e.Module=1]="Module",e[e.Namespace=2]="Namespace",e[e.Package=3]="Package",e[e.Class=4]="Class",e[e.Method=5]="Method",e[e.Property=6]="Property",e[e.Field=7]="Field",e[e.Constructor=8]="Constructor",e[e.Enum=9]="Enum",e[e.Interface=10]="Interface",e[e.Function=11]="Function",e[e.Variable=12]="Variable",e[e.Constant=13]="Constant",e[e.String=14]="String",e[e.Number=15]="Number",e[e.Boolean=16]="Boolean",e[e.Array=17]="Array",e[e.Object=18]="Object",e[e.Key=19]="Key",e[e.Null=20]="Null",e[e.EnumMember=21]="EnumMember",e[e.Struct=22]="Struct",e[e.Event=23]="Event",e[e.Operator=24]="Operator",e[e.TypeParameter=25]="TypeParameter"})(pk||(pk={}));var _X={17:h(850,null),16:h(851,null),4:h(852,null),13:h(853,null),8:h(854,null),9:h(855,null),21:h(856,null),23:h(857,null),7:h(858,null),0:h(859,null),11:h(860,null),10:h(861,null),19:h(862,null),5:h(863,null),1:h(864,null),2:h(865,null),20:h(866,null),15:h(867,null),18:h(868,null),24:h(869,null),3:h(870,null),6:h(871,null),14:h(872,null),22:h(873,null),25:h(874,null),12:h(875,null)},gk;(function(e){e[e.Deprecated=1]="Deprecated"})(gk||(gk={}));var mk;(function(e){const t=new Map;t.set(0,ue.symbolFile),t.set(1,ue.symbolModule),t.set(2,ue.symbolNamespace),t.set(3,ue.symbolPackage),t.set(4,ue.symbolClass),t.set(5,ue.symbolMethod),t.set(6,ue.symbolProperty),t.set(7,ue.symbolField),t.set(8,ue.symbolConstructor),t.set(9,ue.symbolEnum),t.set(10,ue.symbolInterface),t.set(11,ue.symbolFunction),t.set(12,ue.symbolVariable),t.set(13,ue.symbolConstant),t.set(14,ue.symbolString),t.set(15,ue.symbolNumber),t.set(16,ue.symbolBoolean),t.set(17,ue.symbolArray),t.set(18,ue.symbolObject),t.set(19,ue.symbolKey),t.set(20,ue.symbolNull),t.set(21,ue.symbolEnumMember),t.set(22,ue.symbolStruct),t.set(23,ue.symbolEvent),t.set(24,ue.symbolOperator),t.set(25,ue.symbolTypeParameter);function i(n){let o=t.get(n);return o||(console.info("No codicon found for SymbolKind "+n),o=ue.symbolProperty),o}e.toIcon=i;const r=new Map;r.set(0,20),r.set(1,8),r.set(2,8),r.set(3,8),r.set(4,5),r.set(5,0),r.set(6,9),r.set(7,3),r.set(8,2),r.set(9,15),r.set(10,7),r.set(11,1),r.set(12,4),r.set(13,14),r.set(14,18),r.set(15,13),r.set(16,13),r.set(17,13),r.set(18,13),r.set(19,17),r.set(20,13),r.set(21,16),r.set(22,6),r.set(23,10),r.set(24,11),r.set(25,24);function s(n){let o=r.get(n);return o===void 0&&(console.info("No completion kind found for SymbolKind "+n),o=20),o}e.toCompletionKind=s})(mk||(mk={}));var sF=class{static asEditOperation(e){return tF.replace(je.lift(e.range),e.text)}static isTextEdit(e){const t=e;return typeof t.text=="string"&&je.isIRange(t.range)}},$a=class Jn{static{this.Comment=new Jn("comment")}static{this.Imports=new Jn("imports")}static{this.Region=new Jn("region")}static fromValue(t){switch(t){case"comment":return Jn.Comment;case"imports":return Jn.Imports;case"region":return Jn.Region}return new Jn(t)}constructor(t){this.value=t}},vk;(function(e){e[e.AIGenerated=1]="AIGenerated"})(vk||(vk={}));var Kh;(function(e){e[e.Invoke=0]="Invoke",e[e.Automatic=1]="Automatic"})(Kh||(Kh={}));var $1;(function(e){function t(i){return!i||typeof i!="object"?!1:typeof i.id=="string"&&typeof i.title=="string"}e.is=t})($1||($1={}));var Ha;(function(e){e[e.Collapsed=0]="Collapsed",e[e.Expanded=1]="Expanded"})(Ha||(Ha={}));var Bc;(function(e){e[e.Unresolved=0]="Unresolved",e[e.Resolved=1]="Resolved"})(Bc||(Bc={}));var Vc;(function(e){e[e.Current=0]="Current",e[e.Outdated=1]="Outdated"})(Vc||(Vc={}));var _k;(function(e){e[e.Editing=0]="Editing",e[e.Preview=1]="Preview"})(_k||(_k={}));var wk;(function(e){e[e.Published=0]="Published",e[e.Draft=1]="Draft"})(wk||(wk={}));var yk;(function(e){e[e.Type=1]="Type",e[e.Parameter=2]="Parameter"})(yk||(yk={}));var wX=new ik,yX=new ik,bk;(function(e){e[e.None=0]="None",e[e.Option=1]="Option",e[e.Default=2]="Default",e[e.Preferred=3]="Preferred"})(bk||(bk={}));var Xh;(function(e){e[e.Invoke=0]="Invoke",e[e.Automatic=1]="Automatic"})(Xh||(Xh={}));var Sk;(function(e){e[e.Unnecessary=1]="Unnecessary",e[e.Deprecated=2]="Deprecated"})(Sk||(Sk={}));var ki;(function(e){e[e.Hint=1]="Hint",e[e.Info=2]="Info",e[e.Warning=4]="Warning",e[e.Error=8]="Error"})(ki||(ki={})),function(e){function t(l,c){return c-l}e.compare=t;const i=Object.create(null);i[e.Error]=h(2131,null),i[e.Warning]=h(2132,null),i[e.Info]=h(2133,null);function r(l){return i[l]||""}e.toString=r;const s=Object.create(null);s[e.Error]=h(2134,null),s[e.Warning]=h(2135,null),s[e.Info]=h(2136,null);function n(l){return s[l]||""}e.toStringPlural=n;function o(l){switch(l){case Ft.Error:return e.Error;case Ft.Warning:return e.Warning;case Ft.Info:return e.Info;case Ft.Ignore:return e.Hint}}e.fromSeverity=o;function a(l){switch(l){case e.Error:return Ft.Error;case e.Warning:return Ft.Warning;case e.Info:return Ft.Info;case e.Hint:return Ft.Ignore}}e.toSeverity=a}(ki||(ki={}));var xk;(function(e){const t="";function i(s){return r(s,!0)}e.makeKey=i;function r(s,n){const o=[t];return s.source?o.push(s.source.replace("\xA6","\\\xA6")):o.push(t),s.code?typeof s.code=="string"?o.push(s.code.replace("\xA6","\\\xA6")):o.push(s.code.value.replace("\xA6","\\\xA6")):o.push(t),s.severity!==void 0&&s.severity!==null?o.push(ki.toString(s.severity)):o.push(t),s.message&&n?o.push(s.message.replace("\xA6","\\\xA6")):o.push(t),s.startLineNumber!==void 0&&s.startLineNumber!==null?o.push(s.startLineNumber.toString()):o.push(t),s.startColumn!==void 0&&s.startColumn!==null?o.push(s.startColumn.toString()):o.push(t),s.endLineNumber!==void 0&&s.endLineNumber!==null?o.push(s.endLineNumber.toString()):o.push(t),s.endColumn!==void 0&&s.endColumn!==null?o.push(s.endColumn.toString()):o.push(t),o.push(t),o.join("\xA6")}e.makeKeyOptionalMessage=r})(xk||(xk={}));var bX=q("markerService"),nF=class{constructor(){this.data=new Map}add(e,t){vi(Oe(e)),vi(It(t)),vi(!this.data.has(e),"There is already an extension with this id"),this.data.set(e,t)}knows(e){return this.data.has(e)}as(e){return this.data.get(e)||null}dispose(){this.data.forEach(e=>{hx(e.dispose)&&e.dispose()}),this.data.clear()}},Xt=new nF,Ek=q("fileService");function Ua(e){return e.create===!0}var qi;(function(e){e[e.Unknown=0]="Unknown",e[e.File=1]="File",e[e.Directory=2]="Directory",e[e.SymbolicLink=64]="SymbolicLink"})(qi||(qi={}));var En;(function(e){e[e.Readonly=1]="Readonly",e[e.Locked=2]="Locked"})(En||(En={}));var Ck;(function(e){e[e.UPDATED=2]="UPDATED",e[e.ADDED=4]="ADDED",e[e.DELETED=8]="DELETED"})(Ck||(Ck={}));var Dk;(function(e){e[e.None=0]="None",e[e.FileReadWrite=2]="FileReadWrite",e[e.FileOpenReadWriteClose=4]="FileOpenReadWriteClose",e[e.FileReadStream=16]="FileReadStream",e[e.FileFolderCopy=8]="FileFolderCopy",e[e.PathCaseSensitive=1024]="PathCaseSensitive",e[e.Readonly=2048]="Readonly",e[e.Trash=4096]="Trash",e[e.FileWriteUnlock=8192]="FileWriteUnlock",e[e.FileAtomicRead=16384]="FileAtomicRead",e[e.FileAtomicWrite=32768]="FileAtomicWrite",e[e.FileAtomicDelete=65536]="FileAtomicDelete",e[e.FileClone=131072]="FileClone"})(Dk||(Dk={}));var de;(function(e){e.FileExists="EntryExists",e.FileNotFound="EntryNotFound",e.FileNotADirectory="EntryNotADirectory",e.FileIsADirectory="EntryIsADirectory",e.FileExceedsStorageQuota="EntryExceedsStorageQuota",e.FileTooLarge="EntryTooLarge",e.FileWriteLocked="EntryWriteLocked",e.NoPermissions="NoPermissions",e.Unavailable="Unavailable",e.Unknown="Unknown"})(de||(de={}));var Yh=class Z9 extends Error{static create(t,i){const r=new Z9(t.toString(),i);return kk(r,i),r}constructor(t,i){super(t),this.code=i}};function Os(e,t){return Yh.create(e,t)}function oF(e){return e||Os(h(2043,null),de.Unknown)}function kk(e,t){return e.name=t?`${t} (FileSystemError)`:"FileSystemError",e}function Zh(e){if(!e)return de.Unknown;if(e instanceof Yh)return e.code;const t=/^(.+) \(FileSystemError\)$/.exec(e.name);if(!t)return de.Unknown;switch(t[1]){case de.FileExists:return de.FileExists;case de.FileIsADirectory:return de.FileIsADirectory;case de.FileNotADirectory:return de.FileNotADirectory;case de.FileNotFound:return de.FileNotFound;case de.FileTooLarge:return de.FileTooLarge;case de.FileWriteLocked:return de.FileWriteLocked;case de.NoPermissions:return de.NoPermissions;case de.Unavailable:return de.Unavailable}return de.Unknown}function aF(e){if(e instanceof H1)return e.fileOperationResult;switch(Zh(e)){case de.FileNotFound:return 1;case de.FileIsADirectory:return 0;case de.FileNotADirectory:return 9;case de.FileWriteLocked:return 5;case de.NoPermissions:return 6;case de.FileExists:return 4;case de.FileTooLarge:return 7;default:return 10}}var Ik;(function(e){e[e.CREATE=0]="CREATE",e[e.DELETE=1]="DELETE",e[e.MOVE=2]="MOVE",e[e.COPY=3]="COPY",e[e.WRITE=4]="WRITE"})(Ik||(Ik={}));var Pk;(function(e){e[e.UPDATED=0]="UPDATED",e[e.ADDED=1]="ADDED",e[e.DELETED=2]="DELETED"})(Pk||(Pk={}));var SX=class jm{static{this.MIXED_CORRELATION=null}constructor(t,i){this.ignorePathCasing=i,this.correlationId=void 0,this.added=new Si(()=>{const r=xn.forUris(()=>this.ignorePathCasing);return r.fill(this.rawAdded.map(s=>[s,!0])),r}),this.updated=new Si(()=>{const r=xn.forUris(()=>this.ignorePathCasing);return r.fill(this.rawUpdated.map(s=>[s,!0])),r}),this.deleted=new Si(()=>{const r=xn.forUris(()=>this.ignorePathCasing);return r.fill(this.rawDeleted.map(s=>[s,!0])),r}),this.rawAdded=[],this.rawUpdated=[],this.rawDeleted=[];for(const r of t){switch(r.type){case 1:this.rawAdded.push(r.resource);break;case 0:this.rawUpdated.push(r.resource);break;case 2:this.rawDeleted.push(r.resource);break}this.correlationId!==jm.MIXED_CORRELATION&&(typeof r.cId=="number"?this.correlationId===void 0?this.correlationId=r.cId:this.correlationId!==r.cId&&(this.correlationId=jm.MIXED_CORRELATION):this.correlationId!==void 0&&(this.correlationId=jm.MIXED_CORRELATION))}}contains(t,...i){return this.doContains(t,{includeChildren:!1},...i)}affects(t,...i){return this.doContains(t,{includeChildren:!0},...i)}doContains(t,i,...r){if(!t)return!1;const s=r.length>0;return!!((!s||r.includes(1))&&(this.added.value.get(t)||i.includeChildren&&this.added.value.findSuperstr(t))||(!s||r.includes(0))&&(this.updated.value.get(t)||i.includeChildren&&this.updated.value.findSuperstr(t))||(!s||r.includes(2))&&(this.deleted.value.findSubstr(t)||i.includeChildren&&this.deleted.value.findSuperstr(t)))}gotAdded(){return this.rawAdded.length>0}gotDeleted(){return this.rawDeleted.length>0}gotUpdated(){return this.rawUpdated.length>0}correlates(t){return this.correlationId===t}hasCorrelation(){return typeof this.correlationId=="number"}};function lF(e,t,i){return!e||!t||e===t||t.length>e.length?!1:(t.charAt(t.length-1)!==St&&(t+=St),i?hh(e,t):e.indexOf(t)===0)}var H1=class extends Error{constructor(e,t,i){super(e),this.fileOperationResult=t,this.options=i}},Tk;(function(e){e[e.FILE_IS_DIRECTORY=0]="FILE_IS_DIRECTORY",e[e.FILE_NOT_FOUND=1]="FILE_NOT_FOUND",e[e.FILE_NOT_MODIFIED_SINCE=2]="FILE_NOT_MODIFIED_SINCE",e[e.FILE_MODIFIED_SINCE=3]="FILE_MODIFIED_SINCE",e[e.FILE_MOVE_CONFLICT=4]="FILE_MOVE_CONFLICT",e[e.FILE_WRITE_LOCKED=5]="FILE_WRITE_LOCKED",e[e.FILE_PERMISSION_DENIED=6]="FILE_PERMISSION_DENIED",e[e.FILE_TOO_LARGE=7]="FILE_TOO_LARGE",e[e.FILE_INVALID_PATH=8]="FILE_INVALID_PATH",e[e.FILE_NOT_DIRECTORY=9]="FILE_NOT_DIRECTORY",e[e.FILE_OTHER_ERROR=10]="FILE_OTHER_ERROR"})(Tk||(Tk={}));var Ak;(function(e){e[e.FILE=0]="FILE",e[e.FOLDER=1]="FOLDER",e[e.ROOT_FOLDER=2]="ROOT_FOLDER"})(Ak||(Ak={}));var cF="";function Rk(e){if(!(typeof e.size!="number"||typeof e.mtime!="number"))return e.mtime.toString(29)+e.size.toString(31)}var Lk=class Mi{static{this.KB=1024}static{this.MB=Mi.KB*Mi.KB}static{this.GB=Mi.MB*Mi.KB}static{this.TB=Mi.GB*Mi.KB}static formatSize(t){return cr(t)||(t=0),t<Mi.KB?h(2044,null,t.toFixed(0)):t<Mi.MB?h(2045,null,(t/Mi.KB).toFixed(2)):t<Mi.GB?h(2046,null,(t/Mi.MB).toFixed(2)):t<Mi.TB?h(2047,null,(t/Mi.GB).toFixed(2)):h(2048,null,(t/Mi.TB).toFixed(2))}},uF=class extends X{constructor(e,t="",i="",r=!0,s){super(),this._onDidChange=this._register(new D),this.onDidChange=this._onDidChange.event,this._enabled=!0,this._id=e,this._label=t,this._cssClass=i,this._enabled=r,this._actionCallback=s}get id(){return this._id}get label(){return this._label}set label(e){this._setLabel(e)}_setLabel(e){this._label!==e&&(this._label=e,this._onDidChange.fire({label:e}))}get tooltip(){return this._tooltip||""}set tooltip(e){this._setTooltip(e)}_setTooltip(e){this._tooltip!==e&&(this._tooltip=e,this._onDidChange.fire({tooltip:e}))}get class(){return this._cssClass}set class(e){this._setClass(e)}_setClass(e){this._cssClass!==e&&(this._cssClass=e,this._onDidChange.fire({class:e}))}get enabled(){return this._enabled}set enabled(e){this._setEnabled(e)}_setEnabled(e){this._enabled!==e&&(this._enabled=e,this._onDidChange.fire({enabled:e}))}get checked(){return this._checked}set checked(e){this._setChecked(e)}_setChecked(e){this._checked!==e&&(this._checked=e,this._onDidChange.fire({checked:e}))}async run(e,t){this._actionCallback&&await this._actionCallback(e)}},xX=class DS{constructor(){this.id=DS.ID,this.label="",this.tooltip="",this.class="separator",this.enabled=!1,this.checked=!1}static join(...t){let i=[];for(const r of t)r.length&&(i.length?i=[...i,new DS,...r]:i=r);return i}static{this.ID="vs.actions.separator"}async run(){}},EX=class e8 extends uF{static{this.ID="vs.actions.empty"}constructor(){super(e8.ID,h(46,null),void 0,!1)}},dF={EditorPane:"workbench.contributions.editors",EditorFactory:"workbench.contributions.editor.inputFactories"},hF={id:"default",displayName:h(4328,null),providerDisplayName:h(4329,null)},Nk;(function(e){e[e.PROGRAMMATIC=1]="PROGRAMMATIC",e[e.USER=2]="USER",e[e.EDIT=3]="EDIT",e[e.NAVIGATION=4]="NAVIGATION",e[e.JUMP=5]="JUMP"})(Nk||(Nk={}));var Mk;(function(e){e[e.IDENTICAL=1]="IDENTICAL",e[e.SIMILAR=2]="SIMILAR",e[e.DIFFERENT=3]="DIFFERENT"})(Mk||(Mk={}));function ef(e){if(Cn(e))return!1;const t=e;return t?.original!==void 0&&t.modified!==void 0}function Ok(e){if(Cn(e))return!1;const t=e;return!t||t.resources&&!Array.isArray(t.resources)?!1:!!t.resources||!!t.multiDiffSource}function U1(e){if(Cn(e)||ef(e))return!1;const t=e;return t?.primary!==void 0&&t.secondary!==void 0}function tf(e){if(Cn(e))return!1;const t=e;return b.isUri(t?.base?.resource)&&b.isUri(t?.input1?.resource)&&b.isUri(t?.input2?.resource)&&b.isUri(t?.result?.resource)}var Fk;(function(e){e[e.SHORT=0]="SHORT",e[e.MEDIUM=1]="MEDIUM",e[e.LONG=2]="LONG"})(Fk||(Fk={}));var $k;(function(e){e[e.EXPLICIT=1]="EXPLICIT",e[e.AUTO=2]="AUTO",e[e.FOCUS_CHANGE=3]="FOCUS_CHANGE",e[e.WINDOW_CHANGE=4]="WINDOW_CHANGE"})($k||($k={}));var fF=class{constructor(){this.mapIdToSaveSource=new Map}registerSource(e,t){let i=this.mapIdToSaveSource.get(e);return i||(i={source:e,label:t},this.mapIdToSaveSource.set(e,i)),i.source}getSourceLabel(e){return this.mapIdToSaveSource.get(e)?.label??e}},CX=new fF,Hk;(function(e){e[e.None=0]="None",e[e.Readonly=2]="Readonly",e[e.Untitled=4]="Untitled",e[e.Singleton=8]="Singleton",e[e.RequiresTrust=16]="RequiresTrust",e[e.CanSplitInGroup=32]="CanSplitInGroup",e[e.ForceDescription=64]="ForceDescription",e[e.CanDropIntoEditor=128]="CanDropIntoEditor",e[e.MultipleEditors=256]="MultipleEditors",e[e.Scratchpad=512]="Scratchpad"})(Hk||(Hk={}));var pF=class extends X{};function Cn(e){return e instanceof pF}function gF(e){const t=e;return b.isUri(t?.preferredResource)}function mF(e){const t=e;return Cn(t?.primary)&&Cn(t?.secondary)}function vF(e){const t=e;return Cn(t?.modified)&&Cn(t?.original)}var Uk;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.REPLACE=1]="REPLACE",e[e.MOVE=2]="MOVE",e[e.UNPIN=3]="UNPIN"})(Uk||(Uk={}));var Wk;(function(e){e[e.GROUP_ACTIVE=0]="GROUP_ACTIVE",e[e.GROUP_INDEX=1]="GROUP_INDEX",e[e.GROUP_LABEL=2]="GROUP_LABEL",e[e.GROUP_LOCKED=3]="GROUP_LOCKED",e[e.EDITORS_SELECTION=4]="EDITORS_SELECTION",e[e.EDITOR_OPEN=5]="EDITOR_OPEN",e[e.EDITOR_CLOSE=6]="EDITOR_CLOSE",e[e.EDITOR_MOVE=7]="EDITOR_MOVE",e[e.EDITOR_ACTIVE=8]="EDITOR_ACTIVE",e[e.EDITOR_LABEL=9]="EDITOR_LABEL",e[e.EDITOR_CAPABILITIES=10]="EDITOR_CAPABILITIES",e[e.EDITOR_PIN=11]="EDITOR_PIN",e[e.EDITOR_TRANSIENT=12]="EDITOR_TRANSIENT",e[e.EDITOR_STICKY=13]="EDITOR_STICKY",e[e.EDITOR_DIRTY=14]="EDITOR_DIRTY",e[e.EDITOR_WILL_DISPOSE=15]="EDITOR_WILL_DISPOSE"})(Wk||(Wk={}));var Dn;(function(e){e[e.PRIMARY=1]="PRIMARY",e[e.SECONDARY=2]="SECONDARY",e[e.BOTH=3]="BOTH",e[e.ANY=4]="ANY"})(Dn||(Dn={}));var _F=class{getOriginalUri(e,t){if(!e)return;if(tf(e))return Vk.getOriginalUri(e.result,t);if(t?.supportSideBySide){const{primary:r,secondary:s}=this.getSideEditors(e);if(r&&s){if(t?.supportSideBySide===Dn.BOTH)return{primary:this.getOriginalUri(r,{filterByScheme:t.filterByScheme}),secondary:this.getOriginalUri(s,{filterByScheme:t.filterByScheme})};if(t?.supportSideBySide===Dn.ANY)return this.getOriginalUri(r,{filterByScheme:t.filterByScheme})??this.getOriginalUri(s,{filterByScheme:t.filterByScheme});e=t.supportSideBySide===Dn.PRIMARY?r:s}}if(ef(e)||Ok(e)||U1(e)||tf(e))return;const i=gF(e)?e.preferredResource:e.resource;return!i||!t||!t.filterByScheme?i:this.filterUri(i,t.filterByScheme)}getSideEditors(e){return mF(e)||U1(e)?{primary:e.primary,secondary:e.secondary}:vF(e)||ef(e)?{primary:e.modified,secondary:e.original}:{primary:void 0,secondary:void 0}}getCanonicalUri(e,t){if(!e)return;if(tf(e))return Vk.getCanonicalUri(e.result,t);if(t?.supportSideBySide){const{primary:r,secondary:s}=this.getSideEditors(e);if(r&&s){if(t?.supportSideBySide===Dn.BOTH)return{primary:this.getCanonicalUri(r,{filterByScheme:t.filterByScheme}),secondary:this.getCanonicalUri(s,{filterByScheme:t.filterByScheme})};if(t?.supportSideBySide===Dn.ANY)return this.getCanonicalUri(r,{filterByScheme:t.filterByScheme})??this.getCanonicalUri(s,{filterByScheme:t.filterByScheme});e=t.supportSideBySide===Dn.PRIMARY?r:s}}if(ef(e)||Ok(e)||U1(e)||tf(e))return;const i=e.resource;return!i||!t||!t.filterByScheme?i:this.filterUri(i,t.filterByScheme)}filterUri(e,t){if(Array.isArray(t)){if(t.some(i=>e.scheme===i))return e}else if(t===e.scheme)return e}},Bk;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.KEYBOARD=1]="KEYBOARD",e[e.MOUSE=2]="MOUSE"})(Bk||(Bk={}));var Vk=new _F,zk;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"})(zk||(zk={}));var wF=class{constructor(){this.editorSerializerConstructors=new Map,this.editorSerializerInstances=new Map}start(e){const t=this.instantiationService=e.get(Ic);for(const[i,r]of this.editorSerializerConstructors)this.createEditorSerializer(i,r,t);this.editorSerializerConstructors.clear()}createEditorSerializer(e,t,i){const r=i.createInstance(t);this.editorSerializerInstances.set(e,r)}registerFileEditorFactory(e){if(this.fileEditorFactory)throw new Error("Can only register one file editor factory.");this.fileEditorFactory=e}getFileEditorFactory(){return Sa(this.fileEditorFactory)}registerEditorSerializer(e,t){if(this.editorSerializerConstructors.has(e)||this.editorSerializerInstances.has(e))throw new Error(`A editor serializer with type ID '${e}' was already registered.`);return this.instantiationService?this.createEditorSerializer(e,t,this.instantiationService):this.editorSerializerConstructors.set(e,t),ie(()=>{this.editorSerializerConstructors.delete(e),this.editorSerializerInstances.delete(e)})}getEditorSerializer(e){return this.editorSerializerInstances.get(typeof e=="string"?e:e.typeId)}};Xt.add(dF.EditorFactory,new wF);var qk;(function(e){e[e.MOST_RECENTLY_ACTIVE=0]="MOST_RECENTLY_ACTIVE",e[e.SEQUENTIAL=1]="SEQUENTIAL"})(qk||(qk={}));var zc=class{constructor(e,t,i){this.owner=e,this.debugNameSource=t,this.referenceFn=i}getDebugName(e){return yF(e,this)}},jk=new Map,W1=new WeakMap;function yF(e,t){const i=W1.get(e);if(i)return i;const r=bF(e,t);if(r){let s=jk.get(r)??0;s++,jk.set(r,s);const n=s===1?r:`${r}#${s}`;return W1.set(e,n),n}}function bF(e,t){const i=W1.get(e);if(i)return i;const r=t.owner?xF(t.owner)+".":"";let s;const n=t.debugNameSource;if(n!==void 0)if(typeof n=="function"){if(s=n(),s!==void 0)return r+s}else return r+n;const o=t.referenceFn;if(o!==void 0&&(s=B1(o),s!==void 0))return r+s;if(t.owner!==void 0){const a=SF(t.owner,e);if(a!==void 0)return r+a}}function SF(e,t){for(const i in e)if(e[i]===t)return i}var Gk=new Map,Qk=new WeakMap;function xF(e){const t=Qk.get(e);if(t)return t;const i=Jk(e)??"Object";let r=Gk.get(i)??0;r++,Gk.set(i,r);const s=r===1?i:`${i}#${r}`;return Qk.set(e,s),s}function Jk(e){const t=e.constructor;if(t)return t.name==="Object"?void 0:t.name}function B1(e){const t=e.toString(),r=/\/\*\*\s*@description\s*([^*]*)\*\//.exec(t);return(r?r[1]:void 0)?.trim()}var V1=(e,t)=>e===t;function z1(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!z1(e[i],t[i]))return!1;return!0}if(e&&typeof e=="object"&&t&&typeof t=="object"&&Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype){const i=e,r=t,s=Object.keys(i),n=Object.keys(r),o=new Set(n);if(s.length!==n.length)return!1;for(const a of s)if(!o.has(a)||!z1(i[a],r[a]))return!1;return!0}return!1}var xo;function q1(e){xo?xo instanceof Kk?xo.loggers.push(e):xo=new Kk([xo,e]):xo=e}function ri(){return xo}var j1=void 0;function EF(e){j1=e}function CF(e){j1&&j1(e)}var Kk=class{constructor(e){this.loggers=e}handleObservableCreated(e){for(const t of this.loggers)t.handleObservableCreated(e)}handleOnListenerCountChanged(e,t){for(const i of this.loggers)i.handleOnListenerCountChanged(e,t)}handleObservableUpdated(e,t){for(const i of this.loggers)i.handleObservableUpdated(e,t)}handleAutorunCreated(e){for(const t of this.loggers)t.handleAutorunCreated(e)}handleAutorunDisposed(e){for(const t of this.loggers)t.handleAutorunDisposed(e)}handleAutorunDependencyChanged(e,t,i){for(const r of this.loggers)r.handleAutorunDependencyChanged(e,t,i)}handleAutorunStarted(e){for(const t of this.loggers)t.handleAutorunStarted(e)}handleAutorunFinished(e){for(const t of this.loggers)t.handleAutorunFinished(e)}handleDerivedDependencyChanged(e,t,i){for(const r of this.loggers)r.handleDerivedDependencyChanged(e,t,i)}handleDerivedCleared(e){for(const t of this.loggers)t.handleDerivedCleared(e)}handleBeginTransaction(e){for(const t of this.loggers)t.handleBeginTransaction(e)}handleEndTransaction(e){for(const t of this.loggers)t.handleEndTransaction(e)}},Xk;function DF(e){Xk=e}var Yk;function kF(e){Yk=e}var G1;function IF(e){G1=e}var PF=class{get TChange(){return null}reportChanges(){this.get()}read(e){return e?e.readObservable(this):this.get()}map(e,t){const i=t===void 0?void 0:e,r=t===void 0?e:t;return G1({owner:i,debugName:()=>{const s=B1(r);if(s!==void 0)return s;const o=/^\s*\(?\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*\)?\s*=>\s*\1(?:\??)\.([a-zA-Z_$][a-zA-Z_$0-9]*)\s*$/.exec(r.toString());if(o)return`${this.debugName}.${o[2]}`;if(!i)return`${this.debugName} (mapped)`},debugReferenceFn:r},s=>r(this.read(s),s))}flatten(){return G1({owner:void 0,debugName:()=>`${this.debugName} (flattened)`},e=>this.read(e).read(e))}recomputeInitiallyAndOnChange(e,t){return e.add(Xk(this,t)),this}keepObserved(e){return e.add(Yk(this)),this}get debugValue(){return this.get()}},Q1=class extends PF{constructor(){super(),this._observers=new Set,ri()?.handleObservableCreated(this)}addObserver(e){const t=this._observers.size;this._observers.add(e),t===0&&this.onFirstObserverAdded(),t!==this._observers.size&&ri()?.handleOnListenerCountChanged(this,this._observers.size)}removeObserver(e){const t=this._observers.delete(e);t&&this._observers.size===0&&this.onLastObserverRemoved(),t&&ri()?.handleOnListenerCountChanged(this,this._observers.size)}onFirstObserverAdded(){}onLastObserverRemoved(){}log(){const e=!!ri();return CF(this),e||ri()?.handleObservableCreated(this),this}debugGetObservers(){return this._observers}};function rf(e,t){const i=new Zk(e,t);try{e(i)}finally{i.finish()}}function TF(e,t,i){e?t(e):rf(t,i)}var Zk=class{constructor(e,t){this._fn=e,this._getDebugName=t,this._updatingObservers=[],ri()?.handleBeginTransaction(this)}getDebugName(){return this._getDebugName?this._getDebugName():B1(this._fn)}updateObserver(e,t){if(!this._updatingObservers){eI("Transaction already finished!"),rf(i=>{i.updateObserver(e,t)});return}this._updatingObservers.push({observer:e,observable:t}),e.beginUpdate(t)}finish(){const e=this._updatingObservers;if(!e){eI("transaction.finish() has already been called!");return}for(let t=0;t<e.length;t++){const{observer:i,observable:r}=e[t];i.endUpdate(r)}this._updatingObservers=null,ri()?.handleEndTransaction(this)}debugGetUpdatingObservers(){return this._updatingObservers}};function eI(e){const t=new Error("BugIndicatingErrorRecovery: "+e);pt(t),console.error("recovered from an error that indicates a bug",t)}function J1(e,t){let i;return typeof e=="string"?i=new zc(void 0,e,void 0):i=new zc(e,void 0,void 0),new K1(i,t,V1)}var K1=class extends Q1{get debugName(){return this._debugNameData.getDebugName(this)??"ObservableValue"}constructor(e,t,i){super(),this._debugNameData=e,this._equalityComparator=i,this._value=t,ri()?.handleObservableUpdated(this,{hadValue:!1,newValue:t,change:void 0,didChange:!0,oldValue:void 0})}get(){return this._value}set(e,t,i){if(i===void 0&&this._equalityComparator(this._value,e))return;let r;t||(t=r=new Zk(()=>{},()=>`Setting ${this.debugName}`));try{const s=this._value;this._setValue(e),ri()?.handleObservableUpdated(this,{oldValue:s,newValue:e,change:i,didChange:!0,hadValue:!0});for(const n of this._observers)t.updateObserver(n,this),n.handleChange(this,i)}finally{r&&r.finish()}}toString(){return`${this.debugName}: ${this._value}`}_setValue(e){this._value=e}debugGetState(){return{value:this._value}}debugSetValue(e){this._value=e}};function X1(e){return new Y1(new zc(void 0,void 0,e),e,void 0)}var tI;(function(e){e[e.dependenciesMightHaveChanged=1]="dependenciesMightHaveChanged",e[e.stale=2]="stale",e[e.upToDate=3]="upToDate"})(tI||(tI={}));var Y1=class{get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}constructor(e,t,i){this._debugNameData=e,this._runFn=t,this._changeTracker=i,this._state=2,this._updateCount=0,this._disposed=!1,this._dependencies=new Set,this._dependenciesToBeRemoved=new Set,this._isRunning=!1,this._changeSummary=this._changeTracker?.createChangeSummary(void 0),ri()?.handleAutorunCreated(this),this._run(),xa(this)}dispose(){if(!this._disposed){this._disposed=!0;for(const e of this._dependencies)e.removeObserver(this);this._dependencies.clear(),ri()?.handleAutorunDisposed(this),Ea(this)}}_run(){const e=this._dependenciesToBeRemoved;this._dependenciesToBeRemoved=this._dependencies,this._dependencies=e,this._state=3;try{if(!this._disposed){ri()?.handleAutorunStarted(this);const t=this._changeSummary;try{this._isRunning=!0,this._changeTracker&&(this._changeTracker.beforeUpdate?.(this,t),this._changeSummary=this._changeTracker.createChangeSummary(t)),this._runFn(this,t)}catch(i){Yd(i)}finally{this._isRunning=!1}}}finally{this._disposed||ri()?.handleAutorunFinished(this);for(const t of this._dependenciesToBeRemoved)t.removeObserver(this);this._dependenciesToBeRemoved.clear()}}toString(){return`Autorun<${this.debugName}>`}beginUpdate(e){this._state===3&&(this._state=1),this._updateCount++}endUpdate(e){try{if(this._updateCount===1)do{if(this._state===1){this._state=3;for(const t of this._dependencies)if(t.reportChanges(),this._state===2)break}this._state!==3&&this._run()}while(this._state!==3)}finally{this._updateCount--}cx(()=>this._updateCount>=0)}handlePossibleChange(e){this._state===3&&this._isDependency(e)&&(this._state=1)}handleChange(e,t){if(this._isDependency(e)){ri()?.handleAutorunDependencyChanged(this,e,t);try{(this._changeTracker?this._changeTracker.handleChange({changedObservable:e,change:t,didChange:r=>r===e},this._changeSummary):!0)&&(this._state=2)}catch(i){Yd(i)}}}_isDependency(e){return this._dependencies.has(e)&&!this._dependenciesToBeRemoved.has(e)}readObservable(e){if(!this._isRunning)throw new Zi("The reader object cannot be used outside its compute function!");if(this._disposed)return e.get();e.addObserver(this);const t=e.get();return this._dependencies.add(e),this._dependenciesToBeRemoved.delete(e),t}debugGetState(){return{isRunning:this._isRunning,updateCount:this._updateCount,dependencies:this._dependencies,state:this._state}}debugRerun(){this._isRunning?this._state=2:this._run()}};(function(e){e.Observer=Y1})(X1||(X1={}));function AF(e,t){return new Fs(new zc(e.owner,e.debugName,e.debugReferenceFn),t,void 0,e.onLastObserverRemoved,e.equalsFn??V1)}IF(AF);var iI;(function(e){e[e.initial=0]="initial",e[e.dependenciesMightHaveChanged=1]="dependenciesMightHaveChanged",e[e.stale=2]="stale",e[e.upToDate=3]="upToDate"})(iI||(iI={}));var Fs=class extends Q1{get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}constructor(e,t,i,r=void 0,s){super(),this._debugNameData=e,this._computeFn=t,this._changeTracker=i,this._handleLastObserverRemoved=r,this._equalityComparator=s,this._state=0,this._value=void 0,this._updateCount=0,this._dependencies=new Set,this._dependenciesToBeRemoved=new Set,this._changeSummary=void 0,this._isUpdating=!1,this._isComputing=!1,this._didReportChange=!1,this._removedObserverToCallEndUpdateOn=null,this._isReaderValid=!1,this._changeSummary=this._changeTracker?.createChangeSummary(void 0)}onLastObserverRemoved(){this._state=0,this._value=void 0,ri()?.handleDerivedCleared(this);for(const e of this._dependencies)e.removeObserver(this);this._dependencies.clear(),this._handleLastObserverRemoved?.()}get(){if(this._isComputing,this._observers.size===0){let t;try{this._isReaderValid=!0;let i;this._changeTracker&&(i=this._changeTracker.createChangeSummary(void 0),this._changeTracker.beforeUpdate?.(this,i)),t=this._computeFn(this,i)}finally{this._isReaderValid=!1}return this.onLastObserverRemoved(),t}else{do{if(this._state===1){for(const t of this._dependencies)if(t.reportChanges(),this._state===2)break}this._state===1&&(this._state=3),this._state!==3&&this._recompute()}while(this._state!==3);return this._value}}_recompute(){const e=this._dependenciesToBeRemoved;this._dependenciesToBeRemoved=this._dependencies,this._dependencies=e;const t=this._state!==0,i=this._value;this._state=3;let r=!1;this._isComputing=!0,this._didReportChange=!1;try{const s=this._changeSummary;try{this._isReaderValid=!0,this._changeTracker&&(this._changeTracker.beforeUpdate?.(this,s),this._changeSummary=this._changeTracker?.createChangeSummary(s)),this._value=this._computeFn(this,s)}finally{this._isReaderValid=!1;for(const n of this._dependenciesToBeRemoved)n.removeObserver(this);this._dependenciesToBeRemoved.clear()}r=this._didReportChange||t&&!this._equalityComparator(i,this._value),ri()?.handleObservableUpdated(this,{oldValue:i,newValue:this._value,change:void 0,didChange:r,hadValue:t})}catch(s){Yd(s)}if(this._isComputing=!1,!this._didReportChange&&r)for(const s of this._observers)s.handleChange(this,void 0);else this._didReportChange=!1}toString(){return`LazyDerived<${this.debugName}>`}beginUpdate(e){if(this._isUpdating)throw new Zi("Cyclic deriveds are not supported yet!");this._updateCount++,this._isUpdating=!0;try{const t=this._updateCount===1;if(this._state===3&&(this._state=1,!t))for(const i of this._observers)i.handlePossibleChange(this);if(t)for(const i of this._observers)i.beginUpdate(this)}finally{this._isUpdating=!1}}endUpdate(e){if(this._updateCount--,this._updateCount===0){const t=[...this._observers];for(const i of t)i.endUpdate(this);if(this._removedObserverToCallEndUpdateOn){const i=[...this._removedObserverToCallEndUpdateOn];this._removedObserverToCallEndUpdateOn=null;for(const r of i)r.endUpdate(this)}}cx(()=>this._updateCount>=0)}handlePossibleChange(e){if(this._state===3&&this._dependencies.has(e)&&!this._dependenciesToBeRemoved.has(e)){this._state=1;for(const t of this._observers)t.handlePossibleChange(this)}}handleChange(e,t){if(this._dependencies.has(e)&&!this._dependenciesToBeRemoved.has(e)){ri()?.handleDerivedDependencyChanged(this,e,t);let i=!1;try{i=this._changeTracker?this._changeTracker.handleChange({changedObservable:e,change:t,didChange:s=>s===e},this._changeSummary):!0}catch(s){Yd(s)}const r=this._state===3;if(i&&(this._state===1||r)&&(this._state=2,r))for(const s of this._observers)s.handlePossibleChange(this)}}readObservable(e){if(!this._isReaderValid)throw new Zi("The reader object cannot be used outside its compute function!");e.addObserver(this);const t=e.get();return this._dependencies.add(e),this._dependenciesToBeRemoved.delete(e),t}reportChange(e){if(!this._isReaderValid)throw new Zi("The reader object cannot be used outside its compute function!");this._didReportChange=!0;for(const t of this._observers)t.handleChange(this,e)}addObserver(e){const t=!this._observers.has(e)&&this._updateCount>0;super.addObserver(e),t&&(this._removedObserverToCallEndUpdateOn&&this._removedObserverToCallEndUpdateOn.has(e)?this._removedObserverToCallEndUpdateOn.delete(e):e.beginUpdate(this))}removeObserver(e){this._observers.has(e)&&this._updateCount>0&&(this._removedObserverToCallEndUpdateOn||(this._removedObserverToCallEndUpdateOn=new Set),this._removedObserverToCallEndUpdateOn.add(e)),super.removeObserver(e)}debugGetState(){return{state:this._state,updateCount:this._updateCount,isComputing:this._isComputing,dependencies:this._dependencies,value:this._value}}debugSetValue(e){this._value=e}setValue(e,t,i){this._value=e;const r=this._observers;t.updateObserver(this,this);for(const s of r)s.handleChange(this,i)}},RF=class t8{static fromFn(t){return new t8(t())}constructor(t){this._value=J1(this,void 0),this.promiseResult=this._value,this.promise=t.then(i=>(rf(r=>{this._value.set(new rI(i,void 0),r)}),i),i=>{throw rf(r=>{this._value.set(new rI(void 0,i),r)}),i})}},rI=class{constructor(e,t){this.data=e,this.error=t}getDataOrThrow(){if(this.error)throw this.error;return this.data}};function sI(...e){let t,i,r;return e.length===3?[t,i,r]=e:[i,r]=e,new Eo(new zc(t,void 0,r),i,r,()=>Eo.globalTransaction,V1)}var Eo=class extends Q1{constructor(e,t,i,r,s){super(),this._debugNameData=e,this.event=t,this._getValue=i,this._getTransaction=r,this._equalityComparator=s,this._hasValue=!1,this.handleEvent=n=>{const o=this._getValue(n),a=this._value,l=!this._hasValue||!this._equalityComparator(a,o);let c=!1;l&&(this._value=o,this._hasValue&&(c=!0,TF(this._getTransaction(),u=>{ri()?.handleObservableUpdated(this,{oldValue:a,newValue:o,change:void 0,didChange:l,hadValue:this._hasValue});for(const d of this._observers)u.updateObserver(d,this),d.handleChange(this,void 0)},()=>{const u=this.getDebugName();return"Event fired"+(u?`: ${u}`:"")})),this._hasValue=!0),c||ri()?.handleObservableUpdated(this,{oldValue:a,newValue:o,change:void 0,didChange:l,hadValue:this._hasValue})}}getDebugName(){return this._debugNameData.getDebugName(this)}get debugName(){const e=this.getDebugName();return"From Event"+(e?`: ${e}`:"")}onFirstObserverAdded(){this._subscription=this.event(this.handleEvent)}onLastObserverRemoved(){this._subscription.dispose(),this._subscription=void 0,this._hasValue=!1,this._value=void 0}get(){return this._subscription?(this._hasValue||this.handleEvent(void 0),this._value):this._getValue(void 0)}debugSetValue(e){this._value=e}};(function(e){e.Observer=Eo;function t(i,r){let s=!1;Eo.globalTransaction===void 0&&(Eo.globalTransaction=i,s=!0);try{r()}finally{s&&(Eo.globalTransaction=void 0)}}e.batchEventsGlobally=t})(sI||(sI={}));function LF(e){const t=new nI(!1,void 0);return e.addObserver(t),ie(()=>{e.removeObserver(t)})}kF(LF);function NF(e,t){const i=new nI(!0,t);e.addObserver(i);try{i.beginUpdate(e)}finally{i.endUpdate(e)}return ie(()=>{e.removeObserver(i)})}DF(NF);var nI=class{constructor(e,t){this._forceRecompute=e,this._handleValue=t,this._counter=0}beginUpdate(e){this._counter++}endUpdate(e){this._counter===1&&this._forceRecompute&&(this._handleValue?this._handleValue(e.get()):e.reportChanges()),this._counter--}handlePossibleChange(e){}handleChange(e,t){}},sf;function MF(e){sf||(sf=new oI,q1(sf)),sf.addFilteredObj(e)}var oI=class{constructor(){this.indentation=0,this.changedObservablesSets=new WeakMap}addFilteredObj(e){this._filteredObjects||(this._filteredObjects=new Set),this._filteredObjects.add(e)}_isIncluded(e){return this._filteredObjects?.has(e)??!0}textToConsoleArgs(e){return OF([Wa(HF("|  ",this.indentation)),e])}formatInfo(e){return e.hadValue?e.didChange?[Wa(" "),pr($s(e.oldValue,70),{color:"red",strikeThrough:!0}),Wa(" "),pr($s(e.newValue,60),{color:"green"})]:[Wa(" (unchanged)")]:[Wa(" "),pr($s(e.newValue,60),{color:"green"}),Wa(" (initial)")]}handleObservableCreated(e){if(e instanceof Fs){const t=e;if(this.changedObservablesSets.set(t,new Set),!1){const r=[];t.__debugUpdating=r;const s=t.beginUpdate;t.beginUpdate=o=>(r.push(o),s.apply(t,[o]));const n=t.endUpdate;t.endUpdate=o=>{const a=r.indexOf(o);return a===-1&&console.error("endUpdate called without beginUpdate",t.debugName,o.debugName),r.splice(a,1),n.apply(t,[o])}}}}handleOnListenerCountChanged(e,t){}handleObservableUpdated(e,t){if(this._isIncluded(e)){if(e instanceof Fs){this._handleDerivedRecomputed(e,t);return}console.log(...this.textToConsoleArgs([Ba("observable value changed"),pr(e.debugName,{color:"BlueViolet"}),...this.formatInfo(t)]))}}formatChanges(e){if(e.size!==0)return pr(" (changed deps: "+[...e].map(t=>t.debugName).join(", ")+")",{color:"gray"})}handleDerivedDependencyChanged(e,t,i){this._isIncluded(e)&&this.changedObservablesSets.get(e)?.add(t)}_handleDerivedRecomputed(e,t){if(!this._isIncluded(e))return;const i=this.changedObservablesSets.get(e);i&&(console.log(...this.textToConsoleArgs([Ba("derived recomputed"),pr(e.debugName,{color:"BlueViolet"}),...this.formatInfo(t),this.formatChanges(i),{data:[{fn:e._debugNameData.referenceFn??e._computeFn}]}])),i.clear())}handleDerivedCleared(e){this._isIncluded(e)&&console.log(...this.textToConsoleArgs([Ba("derived cleared"),pr(e.debugName,{color:"BlueViolet"})]))}handleFromEventObservableTriggered(e,t){this._isIncluded(e)&&console.log(...this.textToConsoleArgs([Ba("observable from event triggered"),pr(e.debugName,{color:"BlueViolet"}),...this.formatInfo(t),{data:[{fn:e._getValue}]}]))}handleAutorunCreated(e){this._isIncluded(e)&&this.changedObservablesSets.set(e,new Set)}handleAutorunDisposed(e){}handleAutorunDependencyChanged(e,t,i){this._isIncluded(e)&&this.changedObservablesSets.get(e).add(t)}handleAutorunStarted(e){const t=this.changedObservablesSets.get(e);t&&(this._isIncluded(e)&&console.log(...this.textToConsoleArgs([Ba("autorun"),pr(e.debugName,{color:"BlueViolet"}),this.formatChanges(t),{data:[{fn:e._debugNameData.referenceFn??e._runFn}]}])),t.clear(),this.indentation++)}handleAutorunFinished(e){this.indentation--}handleBeginTransaction(e){let t=e.getDebugName();t===void 0&&(t=""),this._isIncluded(e)&&console.log(...this.textToConsoleArgs([Ba("transaction"),pr(t,{color:"BlueViolet"}),{data:[{fn:e._fn}]}])),this.indentation++}handleEndTransaction(){this.indentation--}};function OF(e){const t=new Array,i=[];let r="";function s(o){if("length"in o)for(const a of o)a&&s(a);else"text"in o?(r+=`%c${o.text}`,t.push(o.style),o.data&&i.push(...o.data)):"data"in o&&i.push(...o.data)}s(e);const n=[r,...t];return n.push(...i),n}function Wa(e){return pr(e,{color:"black"})}function Ba(e){return pr(UF(`${e}: `,10),{color:"black",bold:!0})}function pr(e,t={color:"black"}){function i(s){return Object.entries(s).reduce((n,[o,a])=>`${n}${o}:${a};`,"")}const r={color:t.color};return t.strikeThrough&&(r["text-decoration"]="line-through"),t.bold&&(r["font-weight"]="bold"),{text:e,style:i(r)}}function $s(e,t){switch(typeof e){case"number":return""+e;case"string":return e.length+2<=t?`"${e}"`:`"${e.substr(0,t-7)}"+...`;case"boolean":return e?"true":"false";case"undefined":return"undefined";case"object":return e===null?"null":Array.isArray(e)?FF(e,t):$F(e,t);case"symbol":return e.toString();case"function":return`[[Function${e.name?" "+e.name:""}]]`;default:return""+e}}function FF(e,t){let i="[ ",r=!0;for(const s of e){if(r||(i+=", "),i.length-5>t){i+="...";break}r=!1,i+=`${$s(s,t-i.length)}`}return i+=" ]",i}function $F(e,t){if(typeof e.toString=="function"&&e.toString!==Object.prototype.toString){const n=e.toString();return n.length<=t?n:n.substring(0,t-3)+"..."}const i=Jk(e);let r=i?i+"(":"{ ",s=!0;for(const[n,o]of Object.entries(e)){if(s||(r+=", "),r.length-5>t){r+="...";break}s=!1,r+=`${n}: ${$s(o,t-r.length)}`}return r+=i?")":" }",r}function HF(e,t){let i="";for(let r=1;r<=t;r++)i+=e;return i}function UF(e,t){for(;e.length<t;)e+=" ";return e}var WF=class kS{static createHost(t,i){return new kS(t,i)}static createClient(t,i){return new kS(t,i)}constructor(t,i){this._channelFactory=t,this._getHandler=i,this._channel=this._channelFactory({handleNotification:n=>{const o=n,a=this._getHandler().notifications[o[0]];if(!a)throw new Error(`Unknown notification "${o[0]}"!`);a(...o[1])},handleRequest:n=>{const o=n;try{return{type:"result",value:this._getHandler().requests[o[0]](...o[1])}}catch(a){return{type:"error",value:a}}}});const r=new Proxy({},{get:(n,o)=>async(...a)=>{const l=await this._channel.sendRequest([o,a]);if(l.type==="error")throw l.value;return l.value}}),s=new Proxy({},{get:(n,o)=>(...a)=>{this._channel.sendNotification([o,a])}});this.api={notifications:s,requests:r}}};function BF(e,t){const i=globalThis;let r=[],s;const{channel:n,handler:o}=VF({sendNotification:l=>{s?s.sendNotification(l):r.push(l)}});let a;return(i.$$debugValueEditor_debugChannels??(i.$$debugValueEditor_debugChannels={}))[e]=l=>{a=t(),s=l;for(const c of r)l.sendNotification(c);return r=[],o},WF.createClient(n,()=>{if(!a)throw new Error("Not supported");return a})}function VF(e){let t;return{channel:r=>(t=r,{sendNotification:s=>{e.sendNotification(s)},sendRequest:s=>{throw new Error("not supported")}}),handler:{handleRequest:r=>r.type==="notification"?t?.handleNotification(r.data):t?.handleRequest(r.data)}}}function aI(e,t){const i=e.split(`
`);let r=-1;for(const s of i.slice(1)){if(r++,t&&t.test(s))continue;const n=zF(s);if(n)return n}}function zF(e){const t=e.match(/\((.*):(\d+):(\d+)\)/);if(t)return{fileName:t[1],line:parseInt(t[2]),column:parseInt(t[3]),id:e};const i=e.match(/at ([^\(\)]*):(\d+):(\d+)/);if(i)return{fileName:i[1],line:parseInt(i[2]),column:parseInt(i[3]),id:e}}var qF=class{constructor(){this._timeout=void 0}throttle(e,t){this._timeout===void 0&&(this._timeout=setTimeout(()=>{this._timeout=void 0,e()},t))}dispose(){this._timeout!==void 0&&clearTimeout(this._timeout)}};function lI(e,t){for(const i in t)e[i]&&typeof e[i]=="object"&&t[i]&&typeof t[i]=="object"?lI(e[i],t[i]):e[i]=t[i]}function cI(e,t){for(const i in t)t[i]===null?delete e[i]:e[i]&&typeof e[i]=="object"&&t[i]&&typeof t[i]=="object"?cI(e[i],t[i]):e[i]=t[i]}var jF=class Vd{static{this._instance=void 0}static getInstance(){return Vd._instance===void 0&&(Vd._instance=new Vd),Vd._instance}getTransactionState(){const t=[],i=[...this._activeTransactions];if(i.length===0)return;const r=i.flatMap(n=>n.debugGetUpdatingObservers()??[]).map(n=>n.observer),s=new Set;for(;r.length>0;){const n=r.shift();if(s.has(n))continue;s.add(n);const o=this._getInfo(n,a=>{s.has(a)||r.push(a)});o&&t.push(o)}return{names:i.map(n=>n.getDebugName()??"tx"),affected:t}}_getObservableInfo(t){const i=this._instanceInfos.get(t);if(!i){pt(new Zi("No info found"));return}return i}_getAutorunInfo(t){const i=this._instanceInfos.get(t);if(!i){pt(new Zi("No info found"));return}return i}_getInfo(t,i){if(t instanceof Fs){const r=[...t.debugGetObservers()];for(const l of r)i(l);const s=this._getObservableInfo(t);if(!s)return;const n=t.debugGetState(),o={name:t.debugName,instanceId:s.instanceId,updateCount:n.updateCount},a=[...s.changedObservables].map(l=>this._instanceInfos.get(l)?.instanceId).filter(ur);if(n.isComputing)return{...o,type:"observable/derived",state:"updating",changedDependencies:a,initialComputation:!1};switch(n.state){case 0:return{...o,type:"observable/derived",state:"noValue"};case 3:return{...o,type:"observable/derived",state:"upToDate"};case 2:return{...o,type:"observable/derived",state:"stale",changedDependencies:a};case 1:return{...o,type:"observable/derived",state:"possiblyStale"}}}else if(t instanceof Y1){const r=this._getAutorunInfo(t);if(!r)return;const s={name:t.debugName,instanceId:r.instanceId,updateCount:r.updateCount},n=[...r.changedObservables].map(o=>this._instanceInfos.get(o).instanceId);if(t.debugGetState().isRunning)return{...s,type:"autorun",state:"updating",changedDependencies:n};switch(t.debugGetState().state){case 3:return{...s,type:"autorun",state:"upToDate"};case 2:return{...s,type:"autorun",state:"stale",changedDependencies:n};case 1:return{...s,type:"autorun",state:"possiblyStale"}}}}_formatObservable(t){const i=this._getObservableInfo(t);if(i)return{name:t.debugName,instanceId:i.instanceId}}_formatObserver(t){if(t instanceof Fs)return{name:t.toString(),instanceId:this._getObservableInfo(t)?.instanceId};const i=this._getAutorunInfo(t);if(i)return{name:t.toString(),instanceId:i.instanceId}}constructor(){this._declarationId=0,this._instanceId=0,this._declarations=new Map,this._instanceInfos=new WeakMap,this._aliveInstances=new Map,this._activeTransactions=new Set,this._channel=BF("observableDevTools",()=>({notifications:{setDeclarationIdFilter:t=>{},logObservableValue:t=>{console.log("logObservableValue",t)},flushUpdates:()=>{this._flushUpdates()},resetUpdates:()=>{this._pendingChanges=null,this._channel.api.notifications.handleChange(this._fullState,!0)}},requests:{getDeclarations:()=>{const t={};for(const i of this._declarations.values())t[i.id]=i;return{decls:t}},getSummarizedInstances:()=>null,getObservableValueInfo:t=>({observers:[...this._aliveInstances.get(t).debugGetObservers()].map(r=>this._formatObserver(r)).filter(ur)}),getDerivedInfo:t=>{const i=this._aliveInstances.get(t);return{dependencies:[...i.debugGetState().dependencies].map(r=>this._formatObservable(r)).filter(ur),observers:[...i.debugGetObservers()].map(r=>this._formatObserver(r)).filter(ur)}},getAutorunInfo:t=>({dependencies:[...this._aliveInstances.get(t).debugGetState().dependencies].map(r=>this._formatObservable(r)).filter(ur)}),getTransactionState:()=>this.getTransactionState(),setValue:(t,i)=>{const r=this._aliveInstances.get(t);if(r instanceof Fs)r.debugSetValue(i);else if(r instanceof K1)r.debugSetValue(i);else if(r instanceof Eo)r.debugSetValue(i);else throw new Zi("Observable is not supported");const s=[...r.debugGetObservers()];for(const n of s)n.beginUpdate(r);for(const n of s)n.handleChange(r,void 0);for(const n of s)n.endUpdate(r)},getValue:t=>{const i=this._aliveInstances.get(t);if(i instanceof Fs)return $s(i.debugGetState().value,200);if(i instanceof K1)return $s(i.debugGetState().value,200)}}})),this._pendingChanges=null,this._changeThrottler=new qF,this._fullState={},this._flushUpdates=()=>{this._pendingChanges!==null&&(this._channel.api.notifications.handleChange(this._pendingChanges,!1),this._pendingChanges=null)}}_handleChange(t){cI(this._fullState,t),this._pendingChanges===null?this._pendingChanges=t:lI(this._pendingChanges,t),this._changeThrottler.throttle(this._flushUpdates,10)}_getDeclarationId(t){let i=!0,r;const s=Error;for(;;){const o=s.stackTraceLimit;s.stackTraceLimit=i?6:20;const a=new Error().stack;s.stackTraceLimit=o;let l=aI(a,/[/\\]observableInternal[/\\]|\.observe|[/\\]util(s)?\./);if(!i&&!l&&(l=aI(a,/[/\\]observableInternal[/\\]|\.observe/)),l){r=l;break}if(!i){console.error("Could not find location for declaration",new Error().stack),r={fileName:"unknown",line:0,column:0,id:"unknown"};break}i=!1}let n=this._declarations.get(r.id);return n===void 0&&(n={id:this._declarationId++,type:t,url:r.fileName,line:r.line,column:r.column},this._declarations.set(r.id,n),this._handleChange({decls:{[n.id]:n}})),n.id}handleObservableCreated(t){const r={declarationId:this._getDeclarationId("observable/value"),instanceId:this._instanceId++,listenerCount:0,lastValue:void 0,updateCount:0,changedObservables:new Set};this._instanceInfos.set(t,r)}handleOnListenerCountChanged(t,i){const r=this._getObservableInfo(t);if(r){if(r.listenerCount===0&&i>0){const s=t instanceof Fs?"observable/derived":"observable/value";this._aliveInstances.set(r.instanceId,t),this._handleChange({instances:{[r.instanceId]:{instanceId:r.instanceId,declarationId:r.declarationId,formattedValue:r.lastValue,type:s,name:t.debugName}}})}else r.listenerCount>0&&i===0&&(this._handleChange({instances:{[r.instanceId]:null}}),this._aliveInstances.delete(r.instanceId));r.listenerCount=i}}handleObservableUpdated(t,i){if(t instanceof Fs){this._handleDerivedRecomputed(t,i);return}const r=this._getObservableInfo(t);r&&i.didChange&&(r.lastValue=$s(i.newValue,30),r.listenerCount>0&&this._handleChange({instances:{[r.instanceId]:{formattedValue:r.lastValue}}}))}handleAutorunCreated(t){const r={declarationId:this._getDeclarationId("autorun"),instanceId:this._instanceId++,updateCount:0,changedObservables:new Set};this._instanceInfos.set(t,r),this._aliveInstances.set(r.instanceId,t),r&&this._handleChange({instances:{[r.instanceId]:{instanceId:r.instanceId,declarationId:r.declarationId,runCount:0,type:"autorun",name:t.debugName}}})}handleAutorunDisposed(t){const i=this._getAutorunInfo(t);i&&(this._handleChange({instances:{[i.instanceId]:null}}),this._instanceInfos.delete(t),this._aliveInstances.delete(i.instanceId))}handleAutorunDependencyChanged(t,i,r){const s=this._getAutorunInfo(t);s&&s.changedObservables.add(i)}handleAutorunStarted(t){}handleAutorunFinished(t){const i=this._getAutorunInfo(t);i&&(i.changedObservables.clear(),i.updateCount++,this._handleChange({instances:{[i.instanceId]:{runCount:i.updateCount}}}))}handleDerivedDependencyChanged(t,i,r){const s=this._getObservableInfo(t);s&&s.changedObservables.add(i)}_handleDerivedRecomputed(t,i){const r=this._getObservableInfo(t);if(!r)return;const s=$s(i.newValue,30);r.updateCount++,r.changedObservables.clear(),r.lastValue=s,r.listenerCount>0&&this._handleChange({instances:{[r.instanceId]:{formattedValue:s,recomputationCount:r.updateCount}}})}handleDerivedCleared(t){const i=this._getObservableInfo(t);i&&(i.lastValue=void 0,i.changedObservables.clear(),i.listenerCount>0&&this._handleChange({instances:{[i.instanceId]:{formattedValue:void 0}}}))}handleBeginTransaction(t){this._activeTransactions.add(t)}handleEndTransaction(t){this._activeTransactions.delete(t)}};EF(MF);var GF=!1;GF&&q1(new oI),gn&&gn.VSCODE_DEV_DEBUG&&q1(jF.getInstance());var Hs=class yr{static fromTo(t,i){return new yr(t,i)}static addRange(t,i){let r=0;for(;r<i.length&&i[r].endExclusive<t.start;)r++;let s=r;for(;s<i.length&&i[s].start<=t.endExclusive;)s++;if(r===s)i.splice(r,0,t);else{const n=Math.min(t.start,i[r].start),o=Math.max(t.endExclusive,i[s-1].endExclusive);i.splice(r,s-r,new yr(n,o))}}static tryCreate(t,i){if(!(t>i))return new yr(t,i)}static ofLength(t){return new yr(0,t)}static ofStartAndLength(t,i){return new yr(t,t+i)}static emptyAt(t){return new yr(t,t)}constructor(t,i){if(this.start=t,this.endExclusive=i,t>i)throw new Zi(`Invalid range: ${this.toString()}`)}get isEmpty(){return this.start===this.endExclusive}delta(t){return new yr(this.start+t,this.endExclusive+t)}deltaStart(t){return new yr(this.start+t,this.endExclusive)}deltaEnd(t){return new yr(this.start,this.endExclusive+t)}get length(){return this.endExclusive-this.start}toString(){return`[${this.start}, ${this.endExclusive})`}equals(t){return this.start===t.start&&this.endExclusive===t.endExclusive}containsRange(t){return this.start<=t.start&&t.endExclusive<=this.endExclusive}contains(t){return this.start<=t&&t<this.endExclusive}join(t){return new yr(Math.min(this.start,t.start),Math.max(this.endExclusive,t.endExclusive))}intersect(t){const i=Math.max(this.start,t.start),r=Math.min(this.endExclusive,t.endExclusive);if(i<=r)return new yr(i,r)}intersectionLength(t){const i=Math.max(this.start,t.start),r=Math.min(this.endExclusive,t.endExclusive);return Math.max(0,r-i)}intersects(t){const i=Math.max(this.start,t.start),r=Math.min(this.endExclusive,t.endExclusive);return i<r}intersectsOrTouches(t){const i=Math.max(this.start,t.start),r=Math.min(this.endExclusive,t.endExclusive);return i<=r}isBefore(t){return this.endExclusive<=t.start}isAfter(t){return this.start>=t.endExclusive}slice(t){return t.slice(this.start,this.endExclusive)}substring(t){return t.substring(this.start,this.endExclusive)}clip(t){if(this.isEmpty)throw new Zi(`Invalid clipping range: ${this.toString()}`);return Math.max(this.start,Math.min(this.endExclusive-1,t))}clipCyclic(t){if(this.isEmpty)throw new Zi(`Invalid clipping range: ${this.toString()}`);return t<this.start?this.endExclusive-(this.start-t)%this.length:t>=this.endExclusive?this.start+(t-this.start)%this.length:t}map(t){const i=[];for(let r=this.start;r<this.endExclusive;r++)i.push(t(r));return i}forEach(t){for(let i=this.start;i<this.endExclusive;i++)t(i)}};function uI(){return Object.create(null)}var Co="**",Z1="/",nf="[/\\\\]",of="[^/\\\\]",QF=/\//g;function dI(e,t){switch(e){case 0:return"";case 1:return`${of}*?`;default:return`(?:${nf}|${of}+${nf}${t?`|${nf}${of}+`:""})*?`}}function qc(e,t){if(!e)return[];const i=[];let r=!1,s=!1,n="";for(const o of e){switch(o){case t:if(!r&&!s){i.push(n),n="";continue}break;case"{":r=!0;break;case"}":r=!1;break;case"[":s=!0;break;case"]":s=!1;break}n+=o}return n&&i.push(n),i}function hI(e){if(!e)return"";let t="";const i=qc(e,Z1);if(i.every(r=>r===Co))t=".*";else{let r=!1;i.forEach((s,n)=>{if(s===Co){if(r)return;t+=dI(2,n===i.length-1)}else{let o=!1,a="",l=!1,c="";for(const u of s){if(u!=="}"&&o){a+=u;continue}if(l&&(u!=="]"||!c)){let d;u==="-"?d=u:(u==="^"||u==="!")&&!c?d="^":u===Z1?d="":d=mn(u),c+=d;continue}switch(u){case"{":o=!0;continue;case"[":l=!0;continue;case"}":{const f=`(?:${qc(a,",").map(p=>hI(p)).join("|")})`;t+=f,o=!1,a="";break}case"]":{t+="["+c+"]",l=!1,c="";break}case"?":t+=of;continue;case"*":t+=dI(1);continue;default:t+=mn(u)}}n<i.length-1&&(i[n+1]!==Co||n+2<i.length)&&(t+=nf)}r=s===Co})}return t}var JF=/^\*\*\/\*\.[\w\.-]+$/,KF=/^\*\*\/([\w\.-]+)\/?$/,XF=/^{\*\*\/\*?[\w\.-]+\/?(,\*\*\/\*?[\w\.-]+\/?)*}$/,YF=/^{\*\*\/\*?[\w\.-]+(\/(\*\*)?)?(,\*\*\/\*?[\w\.-]+(\/(\*\*)?)?)*}$/,ZF=/^\*\*((\/[\w\.-]+)+)\/?$/,e$=/^([\w\.-]+(\/[\w\.-]+)*)\/?$/,fI=new uc(1e4),pI=function(){return!1},is=function(){return null};function e_(e,t){if(!e)return is;let i;typeof e!="string"?i=e.pattern:i=e,i=i.trim();const r=`${i}_${!!t.trimForExclusions}`;let s=fI.get(r);if(s)return gI(s,e);let n;return JF.test(i)?s=t$(i.substr(4),i):(n=KF.exec(t_(i,t)))?s=i$(n[1],i):(t.trimForExclusions?YF:XF).test(i)?s=r$(i,t):(n=ZF.exec(t_(i,t)))?s=mI(n[1].substr(1),i,!0):(n=e$.exec(t_(i,t)))?s=mI(n[1],i,!1):s=s$(i),fI.set(r,s),gI(s,e)}function gI(e,t){if(typeof t=="string")return e;const i=function(r,s){return ao(r,t.base,!Ct)?e(jL(r.substr(t.base.length),St),s):null};return i.allBasenames=e.allBasenames,i.allPaths=e.allPaths,i.basenames=e.basenames,i.patterns=e.patterns,i}function t_(e,t){return t.trimForExclusions&&e.endsWith("/**")?e.substr(0,e.length-2):e}function t$(e,t){return function(i,r){return typeof i=="string"&&i.endsWith(e)?t:null}}function i$(e,t){const i=`/${e}`,r=`\\${e}`,s=function(o,a){return typeof o!="string"?null:a?a===e?t:null:o===e||o.endsWith(i)||o.endsWith(r)?t:null},n=[e];return s.basenames=n,s.patterns=[t],s.allBasenames=n,s}function r$(e,t){const i=wI(e.slice(1,-1).split(",").map(a=>e_(a,t)).filter(a=>a!==is),e),r=i.length;if(!r)return is;if(r===1)return i[0];const s=function(a,l){for(let c=0,u=i.length;c<u;c++)if(i[c](a,l))return e;return null},n=i.find(a=>!!a.allBasenames);n&&(s.allBasenames=n.allBasenames);const o=i.reduce((a,l)=>l.allPaths?a.concat(l.allPaths):a,[]);return o.length&&(s.allPaths=o),s}function mI(e,t,i){const r=St===$e.sep,s=r?e:e.replace(QF,St),n=St+s,o=$e.sep+e;let a;return i?a=function(l,c){return typeof l=="string"&&(l===s||l.endsWith(n)||!r&&(l===e||l.endsWith(o)))?t:null}:a=function(l,c){return typeof l=="string"&&(l===s||!r&&l===e)?t:null},a.allPaths=[(i?"*/":"./")+e],a}function s$(e){try{const t=new RegExp(`^${hI(e)}$`);return function(i){return t.lastIndex=0,typeof i=="string"&&t.test(i)?e:null}}catch{return is}}function Va(e,t,i){return!e||typeof t!="string"?!1:Lr(e)(t,void 0,i)}function Lr(e,t={}){if(!e)return pI;if(typeof e=="string"||n$(e)){const i=e_(e,t);if(i===is)return pI;const r=function(s,n){return!!i(s,n)};return i.allBasenames&&(r.allBasenames=i.allBasenames),i.allPaths&&(r.allPaths=i.allPaths),r}return o$(e,t)}function n$(e){const t=e;return t?typeof t.base=="string"&&typeof t.pattern=="string":!1}function vI(e){return e.allBasenames||[]}function _I(e){return e.allPaths||[]}function o$(e,t){const i=wI(Object.getOwnPropertyNames(e).map(a=>a$(a,e[a],t)).filter(a=>a!==is)),r=i.length;if(!r)return is;if(!i.some(a=>!!a.requiresSiblings)){if(r===1)return i[0];const a=function(u,d){let f;for(let p=0,g=i.length;p<g;p++){const v=i[p](u,d);if(typeof v=="string")return v;wn(v)&&(f||(f=[]),f.push(v))}return f?(async()=>{for(const p of f){const g=await p;if(typeof g=="string")return g}return null})():null},l=i.find(u=>!!u.allBasenames);l&&(a.allBasenames=l.allBasenames);const c=i.reduce((u,d)=>d.allPaths?u.concat(d.allPaths):u,[]);return c.length&&(a.allPaths=c),a}const s=function(a,l,c){let u,d;for(let f=0,p=i.length;f<p;f++){const g=i[f];g.requiresSiblings&&c&&(l||(l=bt(a)),u||(u=l.substr(0,l.length-uh(a).length)));const v=g(a,l,u,c);if(typeof v=="string")return v;wn(v)&&(d||(d=[]),d.push(v))}return d?(async()=>{for(const f of d){const p=await f;if(typeof p=="string")return p}return null})():null},n=i.find(a=>!!a.allBasenames);n&&(s.allBasenames=n.allBasenames);const o=i.reduce((a,l)=>l.allPaths?a.concat(l.allPaths):a,[]);return o.length&&(s.allPaths=o),s}function a$(e,t,i){if(t===!1)return is;const r=e_(e,i);if(r===is)return is;if(typeof t=="boolean")return r;if(t){const s=t.when;if(typeof s=="string"){const n=(o,a,l,c)=>{if(!c||!r(o,a))return null;const u=s.replace("$(basename)",()=>l),d=c(u);return wn(d)?d.then(f=>f?e:null):d?e:null};return n.requiresSiblings=!0,n}}return r}function wI(e,t){const i=e.filter(a=>!!a.basenames);if(i.length<2)return e;const r=i.reduce((a,l)=>{const c=l.basenames;return c?a.concat(c):a},[]);let s;if(t){s=[];for(let a=0,l=r.length;a<l;a++)s.push(t)}else s=i.reduce((a,l)=>{const c=l.patterns;return c?a.concat(c):a},[]);const n=function(a,l){if(typeof a!="string")return null;if(!l){let u;for(u=a.length;u>0;u--){const d=a.charCodeAt(u-1);if(d===47||d===92)break}l=a.substr(u)}const c=r.indexOf(l);return c!==-1?s[c]:null};n.basenames=r,n.patterns=s,n.allBasenames=r;const o=e.filter(a=>!a.basenames);return o.push(n),o}function yI(e,t){return Er(e,t,(i,r)=>typeof i=="string"&&typeof r=="string"?i===r:typeof i!="string"&&typeof r!="string"?i.base===r.base&&i.pattern===r.pattern:!1)}var l$=q("notebookDocumentService"),i_=["W","X","Y","Z","a","b","c","d","e","f"],c$=new RegExp(`^[${i_.join("")}]+`),bI=7;function r_(e){if(e.scheme!==V.vscodeNotebookCell)return;const t=e.fragment.indexOf("s");if(t<0)return;const i=parseInt(e.fragment.substring(0,t).replace(c$,""),bI),r=Dh(e.fragment.substring(t+1)).toString();if(!isNaN(i))return{handle:i,notebook:e.with({scheme:r,fragment:null})}}function u$(e,t){const i=t.toString(bI),s=`${i.length<i_.length?i_[i.length-1]:"z"}${i}s${kh(z.fromString(e.scheme),!0,!0)}`;return e.with({scheme:V.vscodeNotebookCell,fragment:s})}function d$(e){if(e.scheme!==V.vscodeNotebookMetadata)return;const t=Dh(e.fragment).toString();return e.with({scheme:t,fragment:null})}function h$(e){const t=`${kh(z.fromString(e.scheme),!0,!0)}`;return e.with({scheme:V.vscodeNotebookMetadata,fragment:t})}function SI(e){if(e.scheme!==V.vscodeNotebookCellOutput)return;const t=new URLSearchParams(e.query),i=t.get("openIn");if(!i)return;const r=t.get("outputId")??void 0,s=r_(e.with({scheme:V.vscodeNotebookCell,query:null})),n=t.get("outputIndex")?parseInt(t.get("outputIndex")||"",10):void 0,o=s?s.notebook:e.with({scheme:t.get("notebookScheme")||V.file,fragment:null,query:null}),a=t.get("cellIndex")?parseInt(t.get("cellIndex")||"",10):void 0;return{notebook:o,openIn:i,outputId:r,outputIndex:n,cellHandle:s?.handle,cellFragment:e.fragment,cellIndex:a}}var f$=class{constructor(){this._documents=new Vt}getNotebook(e){if(e.scheme===V.vscodeNotebookCell){const t=r_(e);if(t){const i=this._documents.get(t.notebook);if(i)return i}}if(e.scheme===V.vscodeNotebookCellOutput){const t=SI(e);if(t){const i=this._documents.get(t.notebook);if(i)return i}}return this._documents.get(e)}addNotebookDocument(e){this._documents.set(e.uri,e)}removeNotebookDocument(e){this._documents.delete(e.uri)}};Ne(l$,f$,1);var za;(function(e){e[e.Markup=1]="Markup",e[e.Code=2]="Code"})(za||(za={}));var DX=["application/json","application/javascript","text/html","image/svg+xml",Ms.latex,Ms.markdown,"image/png","image/jpeg",Ms.text],kX=[Ms.latex,Ms.markdown,"application/json","text/html","image/svg+xml","image/png","image/jpeg",Ms.text],xI;(function(e){e[e.Running=1]="Running",e[e.Idle=2]="Idle"})(xI||(xI={}));var jc;(function(e){e[e.Unconfirmed=1]="Unconfirmed",e[e.Pending=2]="Pending",e[e.Executing=3]="Executing"})(jc||(jc={}));var EI;(function(e){e[e.Unconfirmed=1]="Unconfirmed",e[e.Pending=2]="Pending",e[e.Executing=3]="Executing"})(EI||(EI={}));var CI;(function(e){e[e.WithHardKernelDependency=0]="WithHardKernelDependency",e[e.WithOptionalKernelDependency=1]="WithOptionalKernelDependency",e[e.Pure=2]="Pure",e[e.Never=3]="Never"})(CI||(CI={}));var DI;(function(e){e.Always="always",e.Never="never",e.Optional="optional"})(DI||(DI={}));var Nr;(function(e){e[e.ModelChange=1]="ModelChange",e[e.Move=2]="Move",e[e.ChangeCellLanguage=5]="ChangeCellLanguage",e[e.Initialize=6]="Initialize",e[e.ChangeCellMetadata=7]="ChangeCellMetadata",e[e.Output=8]="Output",e[e.OutputItem=9]="OutputItem",e[e.ChangeCellContent=10]="ChangeCellContent",e[e.ChangeDocumentMetadata=11]="ChangeDocumentMetadata",e[e.ChangeCellInternalMetadata=12]="ChangeCellInternalMetadata",e[e.ChangeCellMime=13]="ChangeCellMime",e[e.Unknown=100]="Unknown"})(Nr||(Nr={}));var kI;(function(e){e[e.Handle=0]="Handle",e[e.Index=1]="Index"})(kI||(kI={}));var II;(function(e){e[e.Replace=1]="Replace",e[e.Output=2]="Output",e[e.Metadata=3]="Metadata",e[e.CellLanguage=4]="CellLanguage",e[e.DocumentMetadata=5]="DocumentMetadata",e[e.Move=6]="Move",e[e.OutputItems=7]="OutputItems",e[e.PartialMetadata=8]="PartialMetadata",e[e.PartialInternalMetadata=9]="PartialInternalMetadata"})(II||(II={}));var PI;(function(e){e.scheme=V.vscodeNotebookMetadata;function t(r){return h$(r)}e.generate=t;function i(r){return d$(r)}e.parse=i})(PI||(PI={}));var af;(function(e){e.scheme=V.vscodeNotebookCell;function t(c,u){return u$(c,u)}e.generate=t;function i(c){return r_(c)}e.parse=i;function r(c,u){return c.with({scheme:V.vscodeNotebookCellOutput,query:new URLSearchParams({openIn:"editor",outputId:u??"",notebookScheme:c.scheme!==V.file?c.scheme:""}).toString()})}e.generateCellOutputUriWithId=r;function s(c,u,d){return c.with({scheme:V.vscodeNotebookCellOutput,fragment:u.fragment,query:new URLSearchParams({openIn:"notebook",outputIndex:String(d)}).toString()})}e.generateCellOutputUriWithIndex=s;function n(c,u,d,f,p){return c.with({scheme:V.vscodeNotebookCellOutput,query:new URLSearchParams({openIn:"notebookOutputEditor",notebook:c.toString(),cellIndex:String(d),outputId:f,outputIndex:String(p)}).toString()})}e.generateOutputEditorUri=n;function o(c){return SI(c)}e.parseCellOutputUri=o;function a(c,u,d){return e.generate(c,u).with({scheme:d})}e.generateCellPropertyUri=a;function l(c,u){if(c.scheme===u)return e.parse(c.with({scheme:e.scheme}))}e.parseCellPropertyUri=l})(af||(af={}));var IX=new I("notebookEditorCursorAtBoundary","none"),PX=new I("notebookEditorCursorAtLineBoundary","none"),TI;(function(e){e.default="default",e.option="option"})(TI||(TI={}));var AI;(function(e){e.Cells="cells",e.Text="text",e.None="none"})(AI||(AI={}));var RI;(function(e){e[e.Left=1]="Left",e[e.Right=2]="Right"})(RI||(RI={}));var TX=class Gm{static{this._prefix="notebook/"}static create(t,i){return`${Gm._prefix}${t}/${i??t}`}static parse(t){if(t.startsWith(Gm._prefix)){const i=t.substring(Gm._prefix.length).split("/");if(i.length===2)return{notebookType:i[0],viewType:i[1]}}}};function LI(e){return["application/vnd.code.notebook.stdout","application/vnd.code.notebook.stderr"].includes(e)}var p$=new TextDecoder;function g$(e){const t=[];let i=!1;for(const o of e)(t.length===0||i)&&(t.push(o),i=!0);let r=v$(t);const s=z.concat(t.map(o=>z.wrap(o))),n=S$(s);return r=r||n.byteLength!==s.byteLength,{data:n,didCompression:r}}var lf="\x1B[A",s_=lf.split("").map(e=>e.charCodeAt(0)),m$=10;function v$(e){let t=!1;return e.forEach((i,r)=>{if(r===0||i.length<lf.length)return;const s=e[r-1],n=i.subarray(0,lf.length);if(n[0]===s_[0]&&n[1]===s_[1]&&n[2]===s_[2]){const o=s.lastIndexOf(m$);if(o===-1)return;t=!0,e[r-1]=s.subarray(0,o),e[r]=i.subarray(lf.length)}}),t}function _$(e){let t=e;do e=t,t=e.replace(/[^\n]\x08/gm,"");while(t.length<e.length);return e}function w$(e){for(e=e.replace(/\r+\n/gm,`
`);e.search(/\r[^$]/g)>-1;){const t=e.match(/^(.*)\r+/m)[1];let i=e.match(/\r+(.*)$/m)[1];i=i+t.slice(i.length,t.length),e=e.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,i)}return e}var y$=8,b$=13;function S$(e){return!e.buffer.includes(y$)&&!e.buffer.includes(b$)?e:z.fromString(w$(_$(p$.decode(e.buffer))))}var cf=q("productService"),x$="vscode://schemas/vscode-product",Us=q("configurationService"),NI;(function(e){e[e.APPLICATION=1]="APPLICATION",e[e.USER=2]="USER",e[e.USER_LOCAL=3]="USER_LOCAL",e[e.USER_REMOTE=4]="USER_REMOTE",e[e.WORKSPACE=5]="WORKSPACE",e[e.WORKSPACE_FOLDER=6]="WORKSPACE_FOLDER",e[e.DEFAULT=7]="DEFAULT",e[e.MEMORY=8]="MEMORY"})(NI||(NI={}));function n_(e,t){const i=Object.create(null);for(const r in e)MI(i,r,e[r],t);return i}function MI(e,t,i,r){const s=t.split("."),n=s.pop();let o=e;for(let a=0;a<s.length;a++){const l=s[a];let c=o[l];switch(typeof c){case"undefined":c=o[l]=Object.create(null);break;case"object":if(c===null){r(`Ignoring ${t} as ${s.slice(0,a+1).join(".")} is null`);return}break;default:r(`Ignoring ${t} as ${s.slice(0,a+1).join(".")} is ${JSON.stringify(c)}`);return}o=c}if(typeof o=="object"&&o!==null)try{o[n]=i}catch{r(`Ignoring ${t} as ${s.join(".")} is ${JSON.stringify(o)}`)}else r(`Ignoring ${t} as ${s.join(".")} is ${JSON.stringify(o)}`)}function E$(e,t){const i=t.split(".");OI(e,i)}function OI(e,t){if(!e)return;const i=t.shift();if(t.length===0){delete e[i];return}if(Object.keys(e).indexOf(i)!==-1){const r=e[i];typeof r=="object"&&!Array.isArray(r)&&(OI(r,t),Object.keys(r).length===0&&delete e[i])}}function uf(e,t,i){function r(o,a){let l=o;for(const c of a){if(typeof l!="object"||l===null)return;l=l[c]}return l}const s=t.split("."),n=r(e,s);return typeof n>"u"?i:n}function C$(e){return e.replace(/[\[\]]/g,"")}function D$(e){let t=!1;const i=new Map,r=new Map;if(k$(e,u=>{if(e===u)return!0;const d=JSON.stringify(u);if(d.length<30)return!0;const f=i.get(d);if(!f){const p={schemas:[u]};return i.set(d,p),r.set(u,p),!0}return f.schemas.push(u),r.set(u,f),t=!0,!1}),i.clear(),!t)return JSON.stringify(e);let n="$defs";for(;e.hasOwnProperty(n);)n+="_";const o=[];function a(u){return JSON.stringify(u,(d,f)=>{if(f!==u){const p=r.get(f);if(p&&p.schemas.length>1)return p.id||(p.id=`_${o.length}`,o.push(p.schemas[0])),{$ref:`#/${n}/${p.id}`}}return f})}const l=a(e),c=[];for(let u=0;u<o.length;u++)c.push(`"_${u}":${a(o[u])}`);return c.length?`${l.substring(0,l.length-1)},"${n}":{${c.join(",")}}}`:l}function qa(e){return typeof e=="object"&&e!==null}function k$(e,t){if(!e||typeof e!="object")return;const i=(...l)=>{for(const c of l)qa(c)&&o.push(c)},r=(...l)=>{for(const c of l)if(qa(c))for(const u in c){const d=c[u];qa(d)&&o.push(d)}},s=(...l)=>{for(const c of l)if(Array.isArray(c))for(const u of c)qa(u)&&o.push(u)},n=l=>{if(Array.isArray(l))for(const c of l)qa(c)&&o.push(c);else qa(l)&&o.push(l)},o=[e];let a=o.pop();for(;a;)t(a)&&(i(a.additionalItems,a.additionalProperties,a.not,a.contains,a.propertyNames,a.if,a.then,a.else,a.unevaluatedItems,a.unevaluatedProperties),r(a.definitions,a.$defs,a.properties,a.patternProperties,a.dependencies,a.dependentSchemas),s(a.anyOf,a.allOf,a.oneOf,a.prefixItems),n(a.items)),a=o.pop()}var df={JSONContribution:"base.contributions.json"};function FI(e){return e.length>0&&e.charAt(e.length-1)==="#"?e.substring(0,e.length-1):e}var I$=class extends X{constructor(){super(...arguments),this.schemasById={},this.schemaAssociations={},this._onDidChangeSchema=this._register(new D),this.onDidChangeSchema=this._onDidChangeSchema.event,this._onDidChangeSchemaAssociations=this._register(new D),this.onDidChangeSchemaAssociations=this._onDidChangeSchemaAssociations.event}registerSchema(e,t,i){const r=FI(e);this.schemasById[r]=t,this._onDidChangeSchema.fire(e),i&&i.add(ie(()=>{delete this.schemasById[r],this._onDidChangeSchema.fire(e)}))}registerSchemaAssociation(e,t){const i=FI(e);return this.schemaAssociations[i]||(this.schemaAssociations[i]=[]),this.schemaAssociations[i].includes(t)||(this.schemaAssociations[i].push(t),this._onDidChangeSchemaAssociations.fire()),ie(()=>{const r=this.schemaAssociations[i];if(r){const s=r.indexOf(t);s!==-1&&(r.splice(s,1),r.length===0&&delete this.schemaAssociations[i],this._onDidChangeSchemaAssociations.fire())}})}notifySchemaChanged(e){this._onDidChangeSchema.fire(e)}getSchemaContributions(){return{schemas:this.schemasById}}getSchemaContent(e){const t=this.schemasById[e];return t?D$(t):void 0}hasSchemaContent(e){return!!this.schemasById[e]}getSchemaAssociations(){return this.schemaAssociations}},P$=new I$;Xt.add(df.JSONContribution,P$);var $I;(function(e){e.Multiline="multilineText",e.Singleline="singlelineText"})($I||($I={}));var Do={Configuration:"base.contributions.configuration"},HI;(function(e){e[e.APPLICATION=1]="APPLICATION",e[e.MACHINE=2]="MACHINE",e[e.APPLICATION_MACHINE=3]="APPLICATION_MACHINE",e[e.WINDOW=4]="WINDOW",e[e.RESOURCE=5]="RESOURCE",e[e.LANGUAGE_OVERRIDABLE=6]="LANGUAGE_OVERRIDABLE",e[e.MACHINE_OVERRIDABLE=7]="MACHINE_OVERRIDABLE"})(HI||(HI={}));var hf={properties:{},patternProperties:{}},ff={properties:{},patternProperties:{}},pf={properties:{},patternProperties:{}},gf={properties:{},patternProperties:{}},mf={properties:{},patternProperties:{}},vf={properties:{},patternProperties:{}},Gc={properties:{},patternProperties:{}},ko="vscode://schemas/settings/resourceLanguage",_f=Xt.as(df.JSONContribution),T$=class extends X{constructor(){super(),this.registeredConfigurationDefaults=[],this.overrideIdentifiers=new Set,this._onDidSchemaChange=this._register(new D),this.onDidSchemaChange=this._onDidSchemaChange.event,this._onDidUpdateConfiguration=this._register(new D),this.onDidUpdateConfiguration=this._onDidUpdateConfiguration.event,this.configurationDefaultsOverrides=new Map,this.defaultLanguageConfigurationOverridesNode={id:"defaultOverrides",title:h(1803,null),properties:{}},this.configurationContributors=[this.defaultLanguageConfigurationOverridesNode],this.resourceLanguageSettingsSchema={properties:{},patternProperties:{},additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},this.configurationProperties={},this.policyConfigurations=new Map,this.excludedConfigurationProperties={},_f.registerSchema(ko,this.resourceLanguageSettingsSchema),this.registerOverridePropertyPatternKey()}registerConfiguration(e,t=!0){return this.registerConfigurations([e],t),e}registerConfigurations(e,t=!0){const i=new Set;this.doRegisterConfigurations(e,t,i),_f.registerSchema(ko,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:i})}deregisterConfigurations(e){const t=new Set;this.doDeregisterConfigurations(e,t),_f.registerSchema(ko,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:t})}updateConfigurations({add:e,remove:t}){const i=new Set;this.doDeregisterConfigurations(t,i),this.doRegisterConfigurations(e,!1,i),_f.registerSchema(ko,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:i})}registerDefaultConfigurations(e){const t=new Set;this.doRegisterDefaultConfigurations(e,t),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:t,defaultsOverrides:!0})}doRegisterDefaultConfigurations(e,t){this.registeredConfigurationDefaults.push(...e);const i=[];for(const{overrides:r,source:s}of e)for(const n in r){t.add(n);const o=this.configurationDefaultsOverrides.get(n)??this.configurationDefaultsOverrides.set(n,{configurationDefaultOverrides:[]}).get(n),a=r[n];if(o.configurationDefaultOverrides.push({value:a,source:s}),rs.test(n)){const l=this.mergeDefaultConfigurationsForOverrideIdentifier(n,a,s,o.configurationDefaultOverrideValue);if(!l)continue;o.configurationDefaultOverrideValue=l,this.updateDefaultOverrideProperty(n,l,s),i.push(...Qc(n))}else{const l=this.mergeDefaultConfigurationsForConfigurationProperty(n,a,s,o.configurationDefaultOverrideValue);if(!l)continue;o.configurationDefaultOverrideValue=l;const c=this.configurationProperties[n];c&&(this.updatePropertyDefaultValue(n,c),this.updateSchema(n,c))}}this.doRegisterOverrideIdentifiers(i)}deregisterDefaultConfigurations(e){const t=new Set;this.doDeregisterDefaultConfigurations(e,t),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:t,defaultsOverrides:!0})}doDeregisterDefaultConfigurations(e,t){for(const i of e){const r=this.registeredConfigurationDefaults.indexOf(i);r!==-1&&this.registeredConfigurationDefaults.splice(r,1)}for(const{overrides:i,source:r}of e)for(const s in i){const n=this.configurationDefaultsOverrides.get(s);if(!n)continue;const o=n.configurationDefaultOverrides.findIndex(a=>r?a.source?.id===r.id:a.value===i[s]);if(o!==-1){if(n.configurationDefaultOverrides.splice(o,1),n.configurationDefaultOverrides.length===0&&this.configurationDefaultsOverrides.delete(s),rs.test(s)){let a;for(const l of n.configurationDefaultOverrides)a=this.mergeDefaultConfigurationsForOverrideIdentifier(s,l.value,l.source,a);a&&!dx(a.value)?(n.configurationDefaultOverrideValue=a,this.updateDefaultOverrideProperty(s,a,r)):(this.configurationDefaultsOverrides.delete(s),delete this.configurationProperties[s],delete this.defaultLanguageConfigurationOverridesNode.properties[s])}else{let a;for(const c of n.configurationDefaultOverrides)a=this.mergeDefaultConfigurationsForConfigurationProperty(s,c.value,c.source,a);n.configurationDefaultOverrideValue=a;const l=this.configurationProperties[s];l&&(this.updatePropertyDefaultValue(s,l),this.updateSchema(s,l))}t.add(s)}}this.updateOverridePropertyPatternKey()}updateDefaultOverrideProperty(e,t,i){const r={type:"object",default:t.value,description:h(1804,null,C$(e)),$ref:ko,defaultDefaultValue:t.value,source:i,defaultValueSource:i};this.configurationProperties[e]=r,this.defaultLanguageConfigurationOverridesNode.properties[e]=r}mergeDefaultConfigurationsForOverrideIdentifier(e,t,i,r){const s=r?.value||{},n=r?.source??new Map;if(!(n instanceof Map)){console.error("objectConfigurationSources is not a Map");return}for(const o of Object.keys(t)){const a=t[o];if(It(a)&&(dc(s[o])||It(s[o]))){if(s[o]={...s[o]??{},...a},i)for(const c in a)n.set(`${o}.${c}`,i)}else s[o]=a,i?n.set(o,i):n.delete(o)}return{value:s,source:n}}mergeDefaultConfigurationsForConfigurationProperty(e,t,i,r){const s=this.configurationProperties[e],n=r?.value??s?.defaultDefaultValue;let o=i;if(It(t)&&(s!==void 0&&s.type==="object"||s===void 0&&(dc(n)||It(n)))){if(o=r?.source??new Map,!(o instanceof Map)){console.error("defaultValueSource is not a Map");return}for(const l in t)i&&o.set(`${e}.${l}`,i);t={...It(n)?n:{},...t}}return{value:t,source:o}}deltaConfiguration(e){let t=!1;const i=new Set;e.removedDefaults&&(this.doDeregisterDefaultConfigurations(e.removedDefaults,i),t=!0),e.addedDefaults&&(this.doRegisterDefaultConfigurations(e.addedDefaults,i),t=!0),e.removedConfigurations&&this.doDeregisterConfigurations(e.removedConfigurations,i),e.addedConfigurations&&this.doRegisterConfigurations(e.addedConfigurations,!1,i),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:i,defaultsOverrides:t})}notifyConfigurationSchemaUpdated(...e){this._onDidSchemaChange.fire()}registerOverrideIdentifiers(e){this.doRegisterOverrideIdentifiers(e),this._onDidSchemaChange.fire()}doRegisterOverrideIdentifiers(e){for(const t of e)this.overrideIdentifiers.add(t);this.updateOverridePropertyPatternKey()}doRegisterConfigurations(e,t,i){e.forEach(r=>{this.validateAndRegisterProperties(r,t,r.extensionInfo,r.restrictedProperties,void 0,i),this.configurationContributors.push(r),this.registerJSONConfiguration(r)})}doDeregisterConfigurations(e,t){const i=r=>{if(r.properties)for(const s in r.properties){t.add(s);const n=this.configurationProperties[s];n?.policy?.name&&this.policyConfigurations.delete(n.policy.name),delete this.configurationProperties[s],this.removeFromSchema(s,r.properties[s])}r.allOf?.forEach(s=>i(s))};for(const r of e){i(r);const s=this.configurationContributors.indexOf(r);s!==-1&&this.configurationContributors.splice(s,1)}}validateAndRegisterProperties(e,t=!0,i,r,s=4,n){s=Lt(e.scope)?s:e.scope;const o=e.properties;if(o)for(const l in o){const c=o[l];if(t&&R$(l,c)){delete o[l];continue}c.source=i,c.defaultDefaultValue=o[l].default,this.updatePropertyDefaultValue(l,c),rs.test(l)?c.scope=void 0:(c.scope=Lt(c.scope)?s:c.scope,c.restricted=Lt(c.restricted)?!!r?.includes(l):c.restricted);const u=o[l].hasOwnProperty("included")&&!o[l].included,d=o[l].policy?.name;u?(this.excludedConfigurationProperties[l]=o[l],d&&(this.policyConfigurations.set(d,l),n.add(l)),delete o[l]):(n.add(l),d&&this.policyConfigurations.set(d,l),this.configurationProperties[l]=o[l],!o[l].deprecationMessage&&o[l].markdownDeprecationMessage&&(o[l].deprecationMessage=o[l].markdownDeprecationMessage))}const a=e.allOf;if(a)for(const l of a)this.validateAndRegisterProperties(l,t,i,r,s,n)}getConfigurations(){return this.configurationContributors}getConfigurationProperties(){return this.configurationProperties}getPolicyConfigurations(){return this.policyConfigurations}getExcludedConfigurationProperties(){return this.excludedConfigurationProperties}getRegisteredDefaultConfigurations(){return[...this.registeredConfigurationDefaults]}getConfigurationDefaultsOverrides(){const e=new Map;for(const[t,i]of this.configurationDefaultsOverrides)i.configurationDefaultOverrideValue&&e.set(t,i.configurationDefaultOverrideValue);return e}registerJSONConfiguration(e){const t=i=>{const r=i.properties;if(r)for(const n in r)this.updateSchema(n,r[n]);i.allOf?.forEach(t)};t(e)}updateSchema(e,t){switch(hf.properties[e]=t,t.scope){case 1:ff.properties[e]=t;break;case 2:gf.properties[e]=t;break;case 3:pf.properties[e]=t;break;case 7:mf.properties[e]=t;break;case 4:vf.properties[e]=t;break;case 5:Gc.properties[e]=t;break;case 6:Gc.properties[e]=t,this.resourceLanguageSettingsSchema.properties[e]=t;break}}removeFromSchema(e,t){switch(delete hf.properties[e],t.scope){case 1:delete ff.properties[e];break;case 2:delete gf.properties[e];break;case 3:delete pf.properties[e];break;case 7:delete mf.properties[e];break;case 4:delete vf.properties[e];break;case 5:case 6:delete Gc.properties[e],delete this.resourceLanguageSettingsSchema.properties[e];break}}updateOverridePropertyPatternKey(){for(const e of this.overrideIdentifiers.values()){const t=`[${e}]`,i={type:"object",description:h(1805,null),errorMessage:h(1806,null),$ref:ko};this.updatePropertyDefaultValue(t,i),hf.properties[t]=i,ff.properties[t]=i,pf.properties[t]=i,gf.properties[t]=i,mf.properties[t]=i,vf.properties[t]=i,Gc.properties[t]=i}}registerOverridePropertyPatternKey(){const e={type:"object",description:h(1807,null),errorMessage:h(1808,null),$ref:ko};hf.patternProperties[kn]=e,ff.patternProperties[kn]=e,pf.patternProperties[kn]=e,gf.patternProperties[kn]=e,mf.patternProperties[kn]=e,vf.patternProperties[kn]=e,Gc.patternProperties[kn]=e,this._onDidSchemaChange.fire()}updatePropertyDefaultValue(e,t){const i=this.configurationDefaultsOverrides.get(e)?.configurationDefaultOverrideValue;let r,s;i&&(!t.disallowConfigurationDefault||!i.source)&&(r=i.value,s=i.source),dc(r)&&(r=t.defaultDefaultValue,s=void 0),dc(r)&&(r=A$(t.type)),t.default=r,t.defaultValueSource=s}},UI="\\[([^\\]]+)\\]",WI=new RegExp(UI,"g"),kn=`^(${UI})+$`,rs=new RegExp(kn);function Qc(e){const t=[];if(rs.test(e)){let i=WI.exec(e);for(;i?.length;){const r=i[1].trim();r&&t.push(r),i=WI.exec(e)}}return ba(t)}function A$(e){switch(Array.isArray(e)?e[0]:e){case"boolean":return!1;case"integer":case"number":return 0;case"string":return"";case"array":return[];case"object":return{};default:return null}}var wf=new T$;Xt.add(Do.Configuration,wf);function R$(e,t){return e.trim()?rs.test(e)?h(1810,null,e):wf.getConfigurationProperties()[e]!==void 0?h(1811,null,e):t.policy?.name&&wf.getPolicyConfigurations().get(t.policy?.name)!==void 0?h(1812,null,e,t.policy?.name,wf.getPolicyConfigurations().get(t.policy?.name)):null:h(1809,null)}var L$=q("requestService"),N$=class{constructor(e){this.original=e}toJSON(){if(!this.headers){const e=Object.create(null);for(const t in this.original)t.toLowerCase()==="authorization"||t.toLowerCase()==="proxy-authorization"?e[t]="*****":e[t]=this.original[t];this.headers=e}return this.headers}},M$=class extends X{constructor(e){super(),this.logService=e,this.counter=0}async logAndRequest(e,t){const i=`#${++this.counter}: ${e.url}`;this.logService.trace(`${i} - begin`,e.type,new N$(e.headers??{}));try{const r=await t();return this.logService.trace(`${i} - end`,e.type,r.res.statusCode,r.res.headers),r}catch(r){throw this.logService.error(`${i} - error`,e.type,ZS(r)),r}}};function O$(e){return e.res.statusCode&&e.res.statusCode>=200&&e.res.statusCode<300||e.res.statusCode===1223}function F$(e){return e.res.statusCode===204}async function $$(e){if(!O$(e))throw new Error("Server returned "+e.res.statusCode);if(F$(e))return null;const i=(await lN(e.stream)).toString();try{return JSON.parse(i)}catch(r){throw r.message+=`:
`+i,r}}var o_=[],BI=void 0,VI=void 0;function H$(e=!0,t=!0){if(BI===e&&VI===t)return;BI=e,VI=t;const i=Xt.as(Do.Configuration),r=o_;o_=[{id:"http",order:15,title:h(2228,null),type:"object",scope:2,properties:{"http.useLocalProxyConfiguration":{type:"boolean",default:t,markdownDescription:h(2229,null),restricted:!0}}},{id:"http",order:15,title:h(2230,null),type:"object",scope:1,properties:{"http.electronFetch":{type:"boolean",default:!1,description:h(2231,null),restricted:!0}}},{id:"http",order:15,title:h(2232,null),type:"object",scope:e?1:2,properties:{"http.proxy":{type:"string",pattern:"^(https?|socks|socks4a?|socks5h?)://([^:]*(:[^@]*)?@)?([^:]+|\\[[:0-9a-fA-F]+\\])(:\\d+)?/?$|^$",markdownDescription:h(2233,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxyStrictSSL":{type:"boolean",default:!0,markdownDescription:h(2234,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxyKerberosServicePrincipal":{type:"string",markdownDescription:h(2235,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.noProxy":{type:"array",items:{type:"string"},markdownDescription:h(2236,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxyAuthorization":{type:["null","string"],default:null,markdownDescription:h(2237,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxySupport":{type:"string",enum:["off","on","fallback","override"],enumDescriptions:[h(2238,null),h(2239,null),h(2240,null),h(2241,null)],default:"override",markdownDescription:h(2242,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.systemCertificates":{type:"boolean",default:!0,markdownDescription:h(2243,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.experimental.systemCertificatesV2":{type:"boolean",tags:["experimental"],default:!1,markdownDescription:h(2244,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.fetchAdditionalSupport":{type:"boolean",default:!0,markdownDescription:h(2245,null,"`#http.useLocalProxyConfiguration#`","`#http.proxySupport#`","`#http.systemCertificates#`"),restricted:!0}}}],i.updateConfigurations({add:o_,remove:r})}H$();var Jc;(function(e){e[e.STORAGE_DOES_NOT_EXIST=0]="STORAGE_DOES_NOT_EXIST",e[e.STORAGE_IN_MEMORY=1]="STORAGE_IN_MEMORY"})(Jc||(Jc={}));var Mr;(function(e){e[e.None=0]="None",e[e.Initialized=1]="Initialized",e[e.Closed=2]="Closed"})(Mr||(Mr={}));var AX=class i8 extends X{static{this.DEFAULT_FLUSH_DELAY=100}constructor(t,i=Object.create(null)){super(),this.database=t,this.options=i,this._onDidChangeStorage=this._register(new gc),this.onDidChangeStorage=this._onDidChangeStorage.event,this.state=Mr.None,this.cache=new Map,this.flushDelayer=this._register(new yh(i8.DEFAULT_FLUSH_DELAY)),this.pendingDeletes=new Set,this.pendingInserts=new Map,this.pendingClose=void 0,this.whenFlushedCallbacks=[],this.registerListeners()}registerListeners(){this._register(this.database.onDidChangeItemsExternal(t=>this.onDidChangeItemsExternal(t)))}onDidChangeItemsExternal(t){this._onDidChangeStorage.pause();try{t.changed?.forEach((i,r)=>this.acceptExternal(r,i)),t.deleted?.forEach(i=>this.acceptExternal(i,void 0))}finally{this._onDidChangeStorage.resume()}}acceptExternal(t,i){if(this.state===Mr.Closed)return;let r=!1;Lt(i)?r=this.cache.delete(t):this.cache.get(t)!==i&&(this.cache.set(t,i),r=!0),r&&this._onDidChangeStorage.fire({key:t,external:!0})}get items(){return this.cache}get size(){return this.cache.size}async init(){this.state===Mr.None&&(this.state=Mr.Initialized,this.options.hint!==Jc.STORAGE_DOES_NOT_EXIST&&(this.cache=await this.database.getItems()))}get(t,i){const r=this.cache.get(t);return Lt(r)?i:r}getBoolean(t,i){const r=this.get(t);return Lt(r)?i:r==="true"}getNumber(t,i){const r=this.get(t);return Lt(r)?i:parseInt(r,10)}getObject(t,i){const r=this.get(t);return Lt(r)?i:BE(r)}async set(t,i,r=!1){if(this.state===Mr.Closed)return;if(Lt(i))return this.delete(t,r);const s=It(i)||Array.isArray(i)?ON(i):String(i);if(this.cache.get(t)!==s)return this.cache.set(t,s),this.pendingInserts.set(t,s),this.pendingDeletes.delete(t),this._onDidChangeStorage.fire({key:t,external:r}),this.doFlush()}async delete(t,i=!1){if(!(this.state===Mr.Closed||!this.cache.delete(t)))return this.pendingDeletes.has(t)||this.pendingDeletes.add(t),this.pendingInserts.delete(t),this._onDidChangeStorage.fire({key:t,external:i}),this.doFlush()}async optimize(){if(this.state!==Mr.Closed)return await this.flush(0),this.database.optimize()}async close(){return this.pendingClose||(this.pendingClose=this.doClose()),this.pendingClose}async doClose(){this.state=Mr.Closed;try{await this.doFlush(0)}catch{}await this.database.close(()=>this.cache)}get hasPending(){return this.pendingInserts.size>0||this.pendingDeletes.size>0}async flushPending(){if(!this.hasPending)return;const t={insert:this.pendingInserts,delete:this.pendingDeletes};return this.pendingDeletes=new Set,this.pendingInserts=new Map,this.database.updateItems(t).finally(()=>{if(!this.hasPending)for(;this.whenFlushedCallbacks.length;)this.whenFlushedCallbacks.pop()?.()})}async flush(t){if(!(this.state===Mr.Closed||this.pendingClose))return this.doFlush(t)}async doFlush(t){return this.options.hint===Jc.STORAGE_IN_MEMORY?this.flushPending():this.flushDelayer.trigger(()=>this.flushPending(),t)}async whenFlushed(){if(this.hasPending)return new Promise(t=>this.whenFlushedCallbacks.push(t))}isInMemory(){return this.options.hint===Jc.STORAGE_IN_MEMORY}},a_=q("environmentService"),U$=a_,zI=q("IUriIdentityService"),qI;(function(e){e.Settings="settings",e.Keybindings="keybindings",e.Snippets="snippets",e.Prompts="prompts",e.Tasks="tasks",e.Extensions="extensions",e.GlobalState="globalState"})(qI||(qI={}));function W$(e){const t=e;return!!(t&&typeof t=="object"&&typeof t.id=="string"&&typeof t.isDefault=="boolean"&&typeof t.name=="string"&&b.isUri(t.location)&&b.isUri(t.globalStorageHome)&&b.isUri(t.settingsResource)&&b.isUri(t.keybindingsResource)&&b.isUri(t.tasksResource)&&b.isUri(t.snippetsHome)&&b.isUri(t.promptsHome)&&b.isUri(t.extensionsResource))}var B$=q("IUserDataProfilesService");function yf(e,t,i,r,s,n){return{id:e,name:t,location:i,isDefault:!1,icon:s?.icon,globalStorageHome:n&&s?.useDefaultFlags?.globalState?n.globalStorageHome:Dt(i,"globalStorage"),settingsResource:n&&s?.useDefaultFlags?.settings?n.settingsResource:Dt(i,"settings.json"),keybindingsResource:n&&s?.useDefaultFlags?.keybindings?n.keybindingsResource:Dt(i,"keybindings.json"),tasksResource:n&&s?.useDefaultFlags?.tasks?n.tasksResource:Dt(i,"tasks.json"),snippetsHome:n&&s?.useDefaultFlags?.snippets?n.snippetsHome:Dt(i,"snippets"),promptsHome:n&&s?.useDefaultFlags?.prompts?n.promptsHome:Dt(i,"prompts"),extensionsResource:n&&s?.useDefaultFlags?.extensions?n.extensionsResource:Dt(i,"extensions.json"),cacheHome:Dt(r,e),useDefaultFlags:s?.useDefaultFlags,isTransient:s?.transient,workspaces:s?.workspaces}}var jI=class extends X{static{this.PROFILES_KEY="userDataProfiles"}static{this.PROFILE_ASSOCIATIONS_KEY="profileAssociations"}get defaultProfile(){return this.profiles[0]}get profiles(){return[...this.profilesObject.profiles,...this.transientProfilesObject.profiles]}constructor(t,i,r,s){super(),this.environmentService=t,this.fileService=i,this.uriIdentityService=r,this.logService=s,this._onDidChangeProfiles=this._register(new D),this.onDidChangeProfiles=this._onDidChangeProfiles.event,this._onWillCreateProfile=this._register(new D),this.onWillCreateProfile=this._onWillCreateProfile.event,this._onWillRemoveProfile=this._register(new D),this.onWillRemoveProfile=this._onWillRemoveProfile.event,this._onDidResetWorkspaces=this._register(new D),this.onDidResetWorkspaces=this._onDidResetWorkspaces.event,this.profileCreationPromises=new Map,this.transientProfilesObject={profiles:[],emptyWindows:new Map},this.profilesHome=Dt(this.environmentService.userRoamingDataHome,"profiles"),this.profilesCacheHome=Dt(this.environmentService.cacheHome,"CachedProfilesData")}init(){this._profilesObject=void 0}get profilesObject(){if(!this._profilesObject){const t=this.createDefaultProfile(),i=[t];try{for(const s of this.getStoredProfiles()){if(!s.name||!Oe(s.name)||!s.location){this.logService.warn("Skipping the invalid stored profile",s.location||s.name);continue}i.push(yf(ir(s.location),s.name,s.location,this.profilesCacheHome,{icon:s.icon,useDefaultFlags:s.useDefaultFlags},t))}}catch(s){this.logService.error(s)}const r=new Map;if(i.length)try{const s=this.getStoredProfileAssociations();if(s.workspaces)for(const[n,o]of Object.entries(s.workspaces)){const a=b.parse(n),l=i.find(c=>c.id===o);if(l){const c=l.workspaces?l.workspaces.slice(0):[];c.push(a),l.workspaces=c}}if(s.emptyWindows)for(const[n,o]of Object.entries(s.emptyWindows)){const a=i.find(l=>l.id===o);a&&r.set(n,a)}}catch(s){this.logService.error(s)}this._profilesObject={profiles:i,emptyWindows:r}}return this._profilesObject}createDefaultProfile(){const t=yf("__default__profile__",h(2637,null),this.environmentService.userRoamingDataHome,this.profilesCacheHome);return{...t,extensionsResource:this.getDefaultProfileExtensionsLocation()??t.extensionsResource,isDefault:!0}}async createTransientProfile(t){const i="Temp",r=new RegExp(`${mn(i)}\\s(\\d+)`);let s=0;for(const o of this.profiles){const a=r.exec(o.name),l=a?parseInt(a[1]):0;s=l>s?l:s}const n=`${i} ${s+1}`;return this.createProfile(Rs(mt()).toString(16),n,{transient:!0},t)}async createNamedProfile(t,i,r){return this.createProfile(Rs(mt()).toString(16),t,i,r)}async createProfile(t,i,r,s){return await this.doCreateProfile(t,i,r,s)}async doCreateProfile(t,i,r,s){if(!Oe(i)||!i)throw new Error("Name of the profile is mandatory and must be of type `string`");let n=this.profileCreationPromises.get(i);return n||(n=(async()=>{try{if(this.profiles.find(u=>u.id===t||!u.isTransient&&!r?.transient&&u.name===i))throw new Error(`Profile with ${i} name already exists`);const a=s?this.getWorkspace(s):void 0;b.isUri(a)&&(r={...r,workspaces:[a]});const l=yf(t,i,Dt(this.profilesHome,t),this.profilesCacheHome,r,this.defaultProfile);await this.fileService.createFolder(l.location);const c=[];return this._onWillCreateProfile.fire({profile:l,join(u){c.push(u)}}),await yn.settled(c),a&&!b.isUri(a)&&this.updateEmptyWindowAssociation(a,l,!!l.isTransient),this.updateProfiles([l],[],[]),l}finally{this.profileCreationPromises.delete(i)}})(),this.profileCreationPromises.set(i,n)),n}async updateProfile(t,i){const r=[];for(const n of this.profiles){let o;if(t.id===n.id)n.isDefault?i.workspaces&&(o=n,o.workspaces=i.workspaces):o=yf(n.id,i.name??n.name,n.location,this.profilesCacheHome,{icon:i.icon===null?void 0:i.icon??n.icon,transient:i.transient??n.isTransient,useDefaultFlags:i.useDefaultFlags??n.useDefaultFlags,workspaces:i.workspaces??n.workspaces},this.defaultProfile);else if(i.workspaces){const a=n.workspaces?.filter(l=>!i.workspaces?.some(c=>this.uriIdentityService.extUri.isEqual(l,c)));n.workspaces?.length!==a?.length&&(o=n,o.workspaces=a)}o&&r.push(o)}if(!r.length)throw t.isDefault?new Error("Cannot update default profile"):new Error(`Profile '${t.name}' does not exist`);this.updateProfiles([],[],r);const s=this.profiles.find(n=>n.id===t.id);if(!s)throw new Error(`Profile '${t.name}' was not updated`);return s}async removeProfile(t){if(t.isDefault)throw new Error("Cannot remove default profile");const i=this.profiles.find(s=>s.id===t.id);if(!i)throw new Error(`Profile '${t.name}' does not exist`);const r=[];this._onWillRemoveProfile.fire({profile:i,join(s){r.push(s)}});try{await Promise.allSettled(r)}catch(s){this.logService.error(s)}this.updateProfiles([],[i],[]);try{await this.fileService.del(i.cacheHome,{recursive:!0})}catch(s){aF(s)!==1&&this.logService.error(s)}}async setProfileForWorkspace(t,i){const r=this.profiles.find(n=>n.id===i.id);if(!r)throw new Error(`Profile '${i.name}' does not exist`);const s=this.getWorkspace(t);if(b.isUri(s)){const n=r.workspaces?[...r.workspaces]:[];n.some(o=>this.uriIdentityService.extUri.isEqual(o,s))||(n.push(s),await this.updateProfile(r,{workspaces:n}))}else this.updateEmptyWindowAssociation(s,r,!1),this.updateStoredProfiles(this.profiles)}unsetWorkspace(t,i=!1){const r=this.getWorkspace(t);if(b.isUri(r)){const s=this.getProfileForWorkspace(t);s&&this.updateProfile(s,{workspaces:s.workspaces?.filter(n=>!this.uriIdentityService.extUri.isEqual(n,r))})}else this.updateEmptyWindowAssociation(r,void 0,i),this.updateStoredProfiles(this.profiles)}async resetWorkspaces(){this.transientProfilesObject.emptyWindows.clear(),this.profilesObject.emptyWindows.clear();for(const t of this.profiles)t.workspaces=void 0;this.updateProfiles([],[],this.profiles),this._onDidResetWorkspaces.fire()}async cleanUp(){if(await this.fileService.exists(this.profilesHome)){const t=await this.fileService.resolve(this.profilesHome);await Promise.all((t.children||[]).filter(i=>i.isDirectory&&this.profiles.every(r=>!this.uriIdentityService.extUri.isEqual(r.location,i.resource))).map(i=>this.fileService.del(i.resource,{recursive:!0})))}}async cleanUpTransientProfiles(){const t=this.transientProfilesObject.profiles.filter(i=>!this.isProfileAssociatedToWorkspace(i));await Promise.allSettled(t.map(i=>this.removeProfile(i)))}getProfileForWorkspace(t){const i=this.getWorkspace(t);return b.isUri(i)?this.profiles.find(r=>r.workspaces?.some(s=>this.uriIdentityService.extUri.isEqual(s,i))):this.profilesObject.emptyWindows.get(i)??this.transientProfilesObject.emptyWindows.get(i)}getWorkspace(t){return YM(t)?t.uri:ZM(t)?t.configPath:t.id}isProfileAssociatedToWorkspace(t){return!!(t.workspaces?.length||[...this.profilesObject.emptyWindows.values()].some(i=>this.uriIdentityService.extUri.isEqual(i.location,t.location))||[...this.transientProfilesObject.emptyWindows.values()].some(i=>this.uriIdentityService.extUri.isEqual(i.location,t.location)))}updateProfiles(t,i,r){const s=[...this.profiles,...t],n=this.transientProfilesObject.profiles;this.transientProfilesObject.profiles=[];const o=[];for(let a of s){if(i.some(l=>a.id===l.id)){for(const l of[...this.profilesObject.emptyWindows.keys()])a.id===this.profilesObject.emptyWindows.get(l)?.id&&this.profilesObject.emptyWindows.delete(l);continue}if(!a.isDefault){a=r.find(c=>a.id===c.id)??a;const l=n.find(c=>a.id===c.id);if(a.isTransient)this.transientProfilesObject.profiles.push(a);else if(l){for(const[c,u]of this.transientProfilesObject.emptyWindows.entries())if(a.id===u.id){this.transientProfilesObject.emptyWindows.delete(c),this.profilesObject.emptyWindows.set(c,a);break}}}a.workspaces?.length===0&&(a.workspaces=void 0),o.push(a)}this.updateStoredProfiles(o),this.triggerProfilesChanges(t,i,r)}triggerProfilesChanges(t,i,r){this._onDidChangeProfiles.fire({added:t,removed:i,updated:r,all:this.profiles})}updateEmptyWindowAssociation(t,i,r){r=i?.isTransient?!0:r,r?i?this.transientProfilesObject.emptyWindows.set(t,i):this.transientProfilesObject.emptyWindows.delete(t):(this.transientProfilesObject.emptyWindows.delete(t),i?this.profilesObject.emptyWindows.set(t,i):this.profilesObject.emptyWindows.delete(t))}updateStoredProfiles(t){const i=[],r={},s={};for(const n of t)if(!n.isTransient&&(n.isDefault||i.push({location:n.location,name:n.name,icon:n.icon,useDefaultFlags:n.useDefaultFlags}),n.workspaces))for(const o of n.workspaces)r[o.toString()]=n.id;for(const[n,o]of this.profilesObject.emptyWindows.entries())s[n.toString()]=o.id;this.saveStoredProfileAssociations({workspaces:r,emptyWindows:s}),this.saveStoredProfiles(i),this._profilesObject=void 0}getStoredProfiles(){return[]}saveStoredProfiles(t){throw new Error("not implemented")}getStoredProfileAssociations(){return{}}saveStoredProfileAssociations(t){throw new Error("not implemented")}getDefaultProfileExtensionsLocation(){}};jI=__decorate([__param(0,a_),__param(1,Ek),__param(2,zI),__param(3,ke)],jI);var V$="__$__isNewStorageMarker",bf="__$__targetStorageMarker",GI=q("storageService"),ja;(function(e){e[e.NONE=0]="NONE",e[e.SHUTDOWN=1]="SHUTDOWN"})(ja||(ja={}));var QI;(function(e){e[e.APPLICATION=-1]="APPLICATION",e[e.PROFILE=0]="PROFILE",e[e.WORKSPACE=1]="WORKSPACE"})(QI||(QI={}));var JI;(function(e){e[e.USER=0]="USER",e[e.MACHINE=1]="MACHINE"})(JI||(JI={}));function z$(e){const t=e.get(bf);if(t)try{return JSON.parse(t)}catch{}return Object.create(null)}var LX=class r8 extends X{static{this.DEFAULT_FLUSH_INTERVAL=60*1e3}constructor(t={flushInterval:r8.DEFAULT_FLUSH_INTERVAL}){super(),this._onDidChangeValue=this._register(new gc),this._onDidChangeTarget=this._register(new gc),this.onDidChangeTarget=this._onDidChangeTarget.event,this._onWillSaveState=this._register(new D),this.onWillSaveState=this._onWillSaveState.event,this.runFlushWhenIdle=this._register(new Kr),this._workspaceKeyTargets=void 0,this._profileKeyTargets=void 0,this._applicationKeyTargets=void 0,this.flushWhenIdleScheduler=this._register(new ks(()=>this.doFlushWhenIdle(),t.flushInterval))}onDidChangeValue(t,i,r){return Fe.filter(this._onDidChangeValue.event,s=>s.scope===t&&(i===void 0||s.key===i),r)}doFlushWhenIdle(){this.runFlushWhenIdle.value=xE(()=>{this.shouldFlushWhenIdle()&&this.flush(),this.flushWhenIdleScheduler.schedule()})}shouldFlushWhenIdle(){return!0}stopFlushWhenIdle(){Cr([this.runFlushWhenIdle,this.flushWhenIdleScheduler])}initialize(){return this.initializationPromise||(this.initializationPromise=(async()=>{Pt("code/willInitStorage");try{await this.doInitialize()}finally{Pt("code/didInitStorage")}this.flushWhenIdleScheduler.schedule()})()),this.initializationPromise}emitDidChangeValue(t,i){const{key:r,external:s}=i;if(r===bf){switch(t){case-1:this._applicationKeyTargets=void 0;break;case 0:this._profileKeyTargets=void 0;break;case 1:this._workspaceKeyTargets=void 0;break}this._onDidChangeTarget.fire({scope:t})}else this._onDidChangeValue.fire({scope:t,key:r,target:this.getKeyTargets(t)[r],external:s})}emitWillSaveState(t){this._onWillSaveState.fire({reason:t})}get(t,i,r){return this.getStorage(i)?.get(t,r)}getBoolean(t,i,r){return this.getStorage(i)?.getBoolean(t,r)}getNumber(t,i,r){return this.getStorage(i)?.getNumber(t,r)}getObject(t,i,r){return this.getStorage(i)?.getObject(t,r)}storeAll(t,i){this.withPausedEmitters(()=>{for(const r of t)this.store(r.key,r.value,r.scope,r.target,i)})}store(t,i,r,s,n=!1){if(Lt(i)){this.remove(t,r,n);return}this.withPausedEmitters(()=>{this.updateKeyTarget(t,r,s),this.getStorage(r)?.set(t,i,n)})}remove(t,i,r=!1){this.withPausedEmitters(()=>{this.updateKeyTarget(t,i,void 0),this.getStorage(i)?.delete(t,r)})}withPausedEmitters(t){this._onDidChangeValue.pause(),this._onDidChangeTarget.pause();try{t()}finally{this._onDidChangeValue.resume(),this._onDidChangeTarget.resume()}}keys(t,i){const r=[],s=this.getKeyTargets(t);for(const n of Object.keys(s))s[n]===i&&r.push(n);return r}updateKeyTarget(t,i,r,s=!1){const n=this.getKeyTargets(i);typeof r=="number"?n[t]!==r&&(n[t]=r,this.getStorage(i)?.set(bf,JSON.stringify(n),s)):typeof n[t]=="number"&&(delete n[t],this.getStorage(i)?.set(bf,JSON.stringify(n),s))}get workspaceKeyTargets(){return this._workspaceKeyTargets||(this._workspaceKeyTargets=this.loadKeyTargets(1)),this._workspaceKeyTargets}get profileKeyTargets(){return this._profileKeyTargets||(this._profileKeyTargets=this.loadKeyTargets(0)),this._profileKeyTargets}get applicationKeyTargets(){return this._applicationKeyTargets||(this._applicationKeyTargets=this.loadKeyTargets(-1)),this._applicationKeyTargets}getKeyTargets(t){switch(t){case-1:return this.applicationKeyTargets;case 0:return this.profileKeyTargets;default:return this.workspaceKeyTargets}}loadKeyTargets(t){const i=this.getStorage(t);return i?z$(i):Object.create(null)}isNew(t){return this.getBoolean(V$,t)===!0}async flush(t=ja.NONE){this._onWillSaveState.fire({reason:t});const i=this.getStorage(-1),r=this.getStorage(0),s=this.getStorage(1);switch(t){case ja.NONE:await yn.settled([i?.whenFlushed()??Promise.resolve(),r?.whenFlushed()??Promise.resolve(),s?.whenFlushed()??Promise.resolve()]);break;case ja.SHUTDOWN:await yn.settled([i?.flush(0)??Promise.resolve(),r?.flush(0)??Promise.resolve(),s?.flush(0)??Promise.resolve()]);break}}async log(){const t=this.getStorage(-1)?.items??new Map,i=this.getStorage(0)?.items??new Map,r=this.getStorage(1)?.items??new Map;return q$(t,i,r,this.getLogDetails(-1)??"",this.getLogDetails(0)??"",this.getLogDetails(1)??"")}async optimize(t){return await this.flush(),this.getStorage(t)?.optimize()}async switch(t,i){return this.emitWillSaveState(ja.NONE),W$(t)?this.switchToProfile(t,i):this.switchToWorkspace(t,i)}canSwitchProfile(t,i){return!(t.id===i.id||KI(i)&&KI(t))}switchData(t,i,r){this.withPausedEmitters(()=>{const s=new Set;for(const[n,o]of t)s.add(n),i.get(n)!==o&&this.emitDidChangeValue(r,{key:n,external:!0});for(const[n]of i.items)s.has(n)||this.emitDidChangeValue(r,{key:n,external:!0})})}};function KI(e){return e.isDefault||!!e.useDefaultFlags?.globalState}async function q$(e,t,i,r,s,n){const o=v=>{try{return JSON.parse(v)}catch{return v}},a=new Map,l=new Map;e.forEach((v,y)=>{a.set(y,v),l.set(y,o(v))});const c=new Map,u=new Map;t.forEach((v,y)=>{c.set(y,v),u.set(y,o(v))});const d=new Map,f=new Map;i.forEach((v,y)=>{d.set(y,v),f.set(y,o(v))}),console.group(r!==s?`Storage: Application (path: ${r})`:`Storage: Application & Profile (path: ${r}, default profile)`);const p=[];if(a.forEach((v,y)=>{p.push({key:y,value:v})}),console.table(p),console.groupEnd(),console.log(l),r!==s){console.group(`Storage: Profile (path: ${s}, profile specific)`);const v=[];c.forEach((y,S)=>{v.push({key:S,value:y})}),console.table(v),console.groupEnd(),console.log(u)}console.group(`Storage: Workspace (path: ${n})`);const g=[];d.forEach((v,y)=>{g.push({key:y,value:v})}),console.table(g),console.groupEnd(),console.log(f)}var NX=new I("isMac",Mt,h(1825,null)),MX=new I("isLinux",Ct,h(1826,null)),OX=new I("isWindows",Ve,h(1827,null)),j$=new I("isWeb",Ca,h(1828,null)),FX=new I("isMacNative",Mt&&!Ca,h(1829,null)),$X=new I("isIOS",DL,h(1830,null)),HX=new I("isMobile",kL,h(1831,null)),UX=new I("isDevelopment",!1,!0),WX=new I("productQualityType","",h(1832,null)),G$="inputFocus",BX=new I(G$,!1,h(1833,null)),Q$=q("languageService"),J$=q("modelService"),Or,VX=new I("workbenchState",void 0,{type:"string",description:h(4255,null)}),zX=new I("workspaceFolderCount",0,h(4256,null)),qX=new I("openFolderWorkspaceSupport",!0,!0),jX=new I("enterMultiRootWorkspaceSupport",!0,!0),GX=new I("emptyWorkspaceSupport",!0,!0),QX=new I("dirtyWorkingCopies",!1,h(4257,null)),K$=new I("remoteName","",h(4258,null)),JX=new I("virtualWorkspace","",h(4259,null)),KX=new I("temporaryWorkspace",!1,h(4260,null)),XX=new I("isFullscreen",!1,h(4261,null)),YX=new I("isAuxiliaryWindowFocusedContext",!1,h(4262,null)),ZX=new I("isWindowAlwaysOnTop",!1,h(4263,null)),eY=new I("hasWebFileSystemAccess",!1,!0),tY=new I("embedderIdentifier",void 0,h(4264,null)),iY=new I("activeEditorIsDirty",!1,h(4265,null)),rY=new I("activeEditorIsNotPreview",!1,h(4266,null)),sY=new I("activeEditorIsFirstInGroup",!1,h(4267,null)),nY=new I("activeEditorIsLastInGroup",!1,h(4268,null)),oY=new I("activeEditorIsPinned",!1,h(4269,null)),aY=new I("activeEditorIsReadonly",!1,h(4270,null)),lY=new I("activeCompareEditorCanSwap",!1,h(4271,null)),cY=new I("activeEditorCanToggleReadonly",!0,h(4272,null)),uY=new I("activeEditorCanRevert",!1,h(4273,null)),dY=new I("activeEditorCanSplitInGroup",!0),hY=new I("activeEditor",null,{type:"string",description:h(4274,null)}),fY=new I("activeEditorAvailableEditorIds","",h(4275,null)),pY=new I("textCompareEditorVisible",!1,h(4276,null)),gY=new I("textCompareEditorActive",!1,h(4277,null)),mY=new I("sideBySideEditorActive",!1,h(4278,null)),vY=new I("groupEditorsCount",0,h(4279,null)),_Y=new I("activeEditorGroupEmpty",!1,h(4280,null)),wY=new I("activeEditorGroupIndex",0,h(4281,null)),yY=new I("activeEditorGroupLast",!1,h(4282,null)),bY=new I("activeEditorGroupLocked",!1,h(4283,null)),X$=new I("multipleEditorGroups",!1,h(4284,null)),SY=X$.toNegated(),xY=new I("multipleEditorsSelectedInGroup",!1,h(4285,null)),EY=new I("twoEditorsSelectedInGroup",!1,h(4286,null)),CY=new I("SelectedEditorsInGroupFileOrUntitledResourceContextKey",!0,h(4287,null)),Y$=new I("editorPartMultipleEditorGroups",!1,h(4288,null)),DY=Y$.toNegated(),kY=new I("editorPartMaximizedEditorGroup",!1,h(4289,null)),IY=new I("isAuxiliaryEditorPart",!1,h(4290,null)),PY=new I("editorIsOpen",!1,h(4291,null)),TY=new I("inZenMode",!1,h(4292,null)),AY=new I("isCenteredLayout",!1,h(4293,null)),RY=new I("splitEditorsVertically",!1,h(4294,null)),LY=new I("mainEditorAreaVisible",!0,h(4295,null)),NY=new I("editorTabsVisible",!0,h(4296,null)),MY=new I("sideBarVisible",!1,h(4297,null)),OY=new I("sideBarFocus",!1,h(4298,null)),FY=new I("activeViewlet","",h(4299,null)),$Y=new I("statusBarFocused",!1,h(4300,null)),HY=new I("titleBarStyle","custom",h(4301,null)),UY=new I("titleBarVisible",!1,h(4302,null)),WY=new I("isAuxiliaryTitleBar",!1,h(4303,null)),BY=new I("isCompactTitleBar",!1,h(4304,null)),VY=new I("bannerFocused",!1,h(4305,null)),zY=new I("notificationFocus",!0,h(4306,null)),qY=new I("notificationCenterVisible",!1,h(4307,null)),jY=new I("notificationToastsVisible",!1,h(4308,null)),GY=new I("activeAuxiliary","",h(4309,null)),QY=new I("auxiliaryBarFocus",!1,h(4310,null)),JY=new I("auxiliaryBarVisible",!1,h(4311,null)),KY=new I("activePanel","",h(4312,null)),XY=new I("panelFocus",!1,h(4313,null)),YY=new I("panelPosition","bottom",h(4314,null)),ZY=new I("panelAlignment","center",h(4315,null)),eZ=new I("panelVisible",!1,h(4316,null)),tZ=new I("panelMaximized",!1,h(4317,null)),iZ=new I("focusedView","",h(4318,null)),XI=class{static{Or=this}static{this.Scheme=new I("resourceScheme",void 0,{type:"string",description:h(4319,null)})}static{this.Filename=new I("resourceFilename",void 0,{type:"string",description:h(4320,null)})}static{this.Dirname=new I("resourceDirname",void 0,{type:"string",description:h(4321,null)})}static{this.Path=new I("resourcePath",void 0,{type:"string",description:h(4322,null)})}static{this.LangId=new I("resourceLangId",void 0,{type:"string",description:h(4323,null)})}static{this.Resource=new I("resource",void 0,{type:"URI",description:h(4324,null)})}static{this.Extension=new I("resourceExtname",void 0,{type:"string",description:h(4325,null)})}static{this.HasResource=new I("resourceSet",void 0,{type:"boolean",description:h(4326,null)})}static{this.IsFileSystemResource=new I("isFileSystemResource",void 0,{type:"boolean",description:h(4327,null)})}constructor(t,i,r,s){this._contextKeyService=t,this._fileService=i,this._languageService=r,this._modelService=s,this._disposables=new oe,this._schemeKey=Or.Scheme.bindTo(this._contextKeyService),this._filenameKey=Or.Filename.bindTo(this._contextKeyService),this._dirnameKey=Or.Dirname.bindTo(this._contextKeyService),this._pathKey=Or.Path.bindTo(this._contextKeyService),this._langIdKey=Or.LangId.bindTo(this._contextKeyService),this._resourceKey=Or.Resource.bindTo(this._contextKeyService),this._extensionKey=Or.Extension.bindTo(this._contextKeyService),this._hasResource=Or.HasResource.bindTo(this._contextKeyService),this._isFileSystemResource=Or.IsFileSystemResource.bindTo(this._contextKeyService),this._disposables.add(i.onDidChangeFileSystemProviderRegistrations(()=>{const n=this.get();this._isFileSystemResource.set(!!(n&&i.hasProvider(n)))})),this._disposables.add(s.onModelAdded(n=>{lo(n.uri,this.get())&&this._setLangId()})),this._disposables.add(s.onModelLanguageChanged(n=>{lo(n.model.uri,this.get())&&this._setLangId()}))}dispose(){this._disposables.dispose()}_setLangId(){const t=this.get();if(!t){this._langIdKey.set(null);return}const i=this._modelService.getModel(t)?.getLanguageId()??this._languageService.guessLanguageIdByFilepathOrFirstLine(t);this._langIdKey.set(i)}set(t){t=t??void 0,!lo(this._value,t)&&(this._value=t,this._contextKeyService.bufferChangeEvents(()=>{this._resourceKey.set(t?t.toString():null),this._schemeKey.set(t?t.scheme:null),this._filenameKey.set(t?ir(t):null),this._dirnameKey.set(t?this.uriToPath(bc(t)):null),this._pathKey.set(t?this.uriToPath(t):null),this._setLangId(),this._extensionKey.set(t?dE(t):null),this._hasResource.set(!!t),this._isFileSystemResource.set(t?this._fileService.hasProvider(t):!1)}))}uriToPath(t){return t.scheme===V.file?t.fsPath:t.path}reset(){this._value=void 0,this._contextKeyService.bufferChangeEvents(()=>{this._resourceKey.reset(),this._schemeKey.reset(),this._filenameKey.reset(),this._dirnameKey.reset(),this._pathKey.reset(),this._langIdKey.reset(),this._extensionKey.reset(),this._hasResource.reset(),this._isFileSystemResource.reset()})}get(){return this._value}};XI=Or=__decorate([__param(0,$h),__param(1,Ek),__param(2,Q$),__param(3,J$)],XI);var YI;(function(e){e.UseFileStorage="chat.useFileStorage",e.AgentEnabled="chat.agent.enabled",e.Edits2Enabled="chat.edits2.enabled",e.ExtensionToolsEnabled="chat.extensionTools.enabled"})(YI||(YI={}));var ss;(function(e){e.Ask="ask",e.Edit="edit",e.Agent="agent"})(ss||(ss={}));var fi;(function(e){e.Panel="panel",e.Terminal="terminal",e.Notebook="notebook",e.Editor="editor"})(fi||(fi={})),function(e){function t(i){switch(i){case"panel":return e.Panel;case"terminal":return e.Terminal;case"notebook":return e.Notebook;case"editor":return e.Editor}return e.Panel}e.fromRaw=t}(fi||(fi={}));var In;(function(e){e.responseVote=new I("chatSessionResponseVote","",{type:"string",description:h(5546,null)}),e.responseDetectedAgentCommand=new I("chatSessionResponseDetectedAgentOrCommand",!1,{type:"boolean",description:h(5547,null)}),e.responseSupportsIssueReporting=new I("chatResponseSupportsIssueReporting",!1,{type:"boolean",description:h(5548,null)}),e.responseIsFiltered=new I("chatSessionResponseFiltered",!1,{type:"boolean",description:h(5549,null)}),e.responseHasError=new I("chatSessionResponseError",!1,{type:"boolean",description:h(5550,null)}),e.requestInProgress=new I("chatSessionRequestInProgress",!1,{type:"boolean",description:h(5551,null)}),e.isRequestPaused=new I("chatRequestIsPaused",!1,{type:"boolean",description:h(5552,null)}),e.canRequestBePaused=new I("chatCanRequestBePaused",!1,{type:"boolean",description:h(5553,null)}),e.isResponse=new I("chatResponse",!1,{type:"boolean",description:h(5554,null)}),e.isRequest=new I("chatRequest",!1,{type:"boolean",description:h(5555,null)}),e.itemId=new I("chatItemId","",{type:"string",description:h(5556,null)}),e.lastItemId=new I("chatLastItemId",[],{type:"string",description:h(5557,null)}),e.editApplied=new I("chatEditApplied",!1,{type:"boolean",description:h(5558,null)}),e.inputHasText=new I("chatInputHasText",!1,{type:"boolean",description:h(5559,null)}),e.inputHasFocus=new I("chatInputHasFocus",!1,{type:"boolean",description:h(5560,null)}),e.inChatInput=new I("inChatInput",!1,{type:"boolean",description:h(5561,null)}),e.inChatSession=new I("inChat",!1,{type:"boolean",description:h(5562,null)}),e.hasPromptFile=new I("chatPromptFileAttached",!1,{type:"boolean",description:h(5563,null)}),e.chatMode=new I("chatMode",ss.Ask,{type:"string",description:h(5564,null)}),e.supported=Ut.or(j$.negate(),K$.notEqualsTo("")),e.enabled=new I("chatIsEnabled",!1,{type:"boolean",description:h(5565,null)}),e.extensionParticipantRegistered=new I("chatPanelExtensionParticipantRegistered",!1,{type:"boolean",description:h(5566,null)}),e.panelParticipantRegistered=new I("chatPanelParticipantRegistered",!1,{type:"boolean",description:h(5567,null)}),e.editingParticipantRegistered=new I("chatEditingParticipantRegistered",!1,{type:"boolean",description:h(5568,null)}),e.chatEditingCanUndo=new I("chatEditingCanUndo",!1,{type:"boolean",description:h(5569,null)}),e.chatEditingCanRedo=new I("chatEditingCanRedo",!1,{type:"boolean",description:h(5570,null)}),e.extensionInvalid=new I("chatExtensionInvalid",!1,{type:"boolean",description:h(5571,null)}),e.inputCursorAtTop=new I("chatCursorAtTop",!1),e.inputHasAgent=new I("chatInputHasAgent",!1),e.location=new I("chatLocation",void 0),e.inQuickChat=new I("quickChatHasFocus",!1,{type:"boolean",description:h(5572,null)}),e.hasFileAttachments=new I("chatHasFileAttachments",!1,{type:"boolean",description:h(5573,null)}),e.languageModelsAreUserSelectable=new I("chatModelsAreUserSelectable",!1,{type:"boolean",description:h(5574,null)}),e.Setup={hidden:new I("chatSetupHidden",!1,!0),installed:new I("chatSetupInstalled",!1,!0),disabled:new I("chatSetupDisabled",!1,!0)},e.Entitlement={signedOut:new I("chatSetupSignedOut",!1,!0),canSignUp:new I("chatPlanCanSignUp",!1,!0),limited:new I("chatPlanLimited",!1,!0),pro:new I("chatPlanPro",!1,!0),proPlus:new I("chatPlanProPlus",!1,!0),business:new I("chatPlanBusiness",!1,!0),enterprise:new I("chatPlanEnterprise",!1,!0)},e.chatQuotaExceeded=new I("chatQuotaExceeded",!1,!0),e.completionsQuotaExceeded=new I("completionsQuotaExceeded",!1,!0),e.Editing={agentModeDisallowed:new I("chatAgentModeDisallowed",void 0,{type:"boolean",description:h(5575,null)}),hasToolConfirmation:new I("chatHasToolConfirmation",!1,{type:"boolean",description:h(5576,null)})},e.Tools={toolsCount:new I("toolsCount",0,{type:"number",description:h(5577,null)})}})(In||(In={}));var ZI;(function(e){e.inEditingMode=Ut.or(In.chatMode.isEqualTo(ss.Edit),In.chatMode.isEqualTo(ss.Agent))})(ZI||(ZI={}));var Kc,Z$=q("chatAgentService"),eP=class extends X{static{this.AGENT_LEADER="@"}constructor(t){super(),this.contextKeyService=t,this._agents=new Map,this._onDidChangeAgents=new D,this.onDidChangeAgents=this._onDidChangeAgents.event,this._agentsContextKeys=new Set,this._hasToolsAgent=!1,this._chatParticipantDetectionProviders=new Map,this._agentCompletionProviders=new Map,this._hasDefaultAgent=In.enabled.bindTo(this.contextKeyService),this._extensionAgentRegistered=In.extensionParticipantRegistered.bindTo(this.contextKeyService),this._defaultAgentRegistered=In.panelParticipantRegistered.bindTo(this.contextKeyService),this._editingAgentRegistered=In.editingParticipantRegistered.bindTo(this.contextKeyService),this._register(t.onDidChangeContext(i=>{i.affectsSome(this._agentsContextKeys)&&this._updateContextKeys()}))}registerAgent(t,i){if(this.getAgent(t))throw new Error(`Agent already registered: ${JSON.stringify(t)}`);const s=this,n=i.slashCommands;i={...i,get slashCommands(){return n.filter(a=>!a.when||s.contextKeyService.contextMatchesRules(Ut.deserialize(a.when)))}};const o={data:i};return this._agents.set(t,o),this._updateAgentsContextKeys(),this._updateContextKeys(),this._onDidChangeAgents.fire(void 0),ie(()=>{this._agents.delete(t),this._updateAgentsContextKeys(),this._updateContextKeys(),this._onDidChangeAgents.fire(void 0)})}_updateAgentsContextKeys(){this._agentsContextKeys.clear();for(const t of this._agents.values())if(t.data.when){const i=Ut.deserialize(t.data.when);for(const r of i?.keys()||[])this._agentsContextKeys.add(r)}}_updateContextKeys(){let t=!1,i=!1,r=!1,s=!1;for(const n of this.getAgents())n.isDefault&&(n.isCore||(i=!0),n.modes.includes(ss.Agent)?s=!0:n.modes.includes(ss.Edit)?t=!0:r=!0);this._editingAgentRegistered.set(t),this._defaultAgentRegistered.set(r),this._extensionAgentRegistered.set(i),s!==this._hasToolsAgent&&(this._hasToolsAgent=s,this._onDidChangeAgents.fire(this.getDefaultAgent(fi.Panel,ss.Agent)))}registerAgentImplementation(t,i){const r=this._agents.get(t);if(!r)throw new Error(`Unknown agent: ${JSON.stringify(t)}`);if(r.impl)throw new Error(`Agent already has implementation: ${JSON.stringify(t)}`);return r.data.isDefault&&this._hasDefaultAgent.set(!0),r.impl=i,this._onDidChangeAgents.fire(new Sf(r.data,i)),ie(()=>{r.impl=void 0,this._onDidChangeAgents.fire(void 0),r.data.isDefault&&this._hasDefaultAgent.set(!1)})}registerDynamicAgent(t,i){t.isDynamic=!0;const r={data:t,impl:i};return this._agents.set(t.id,r),this._onDidChangeAgents.fire(new Sf(t,i)),ie(()=>{this._agents.delete(t.id),this._onDidChangeAgents.fire(void 0)})}registerAgentCompletionProvider(t,i){return this._agentCompletionProviders.set(t,i),{dispose:()=>{this._agentCompletionProviders.delete(t)}}}async getAgentCompletionItems(t,i,r){return await this._agentCompletionProviders.get(t)?.(i,r)??[]}updateAgent(t,i){const r=this._agents.get(t);if(!r?.impl)throw new Error(`No activated agent with id ${JSON.stringify(t)} registered`);r.data.metadata={...r.data.metadata,...i},this._onDidChangeAgents.fire(new Sf(r.data,r.impl))}getDefaultAgent(t,i=ss.Ask){return this._preferExtensionAgent(this.getActivatedAgents().filter(r=>i&&!r.modes.includes(i)?!1:!!r.isDefault&&r.locations.includes(t)))}get hasToolsAgent(){return!!this._hasToolsAgent}getContributedDefaultAgent(t){return this._preferExtensionAgent(this.getAgents().filter(i=>!!i.isDefault&&i.locations.includes(t)))}_preferExtensionAgent(t){return LR(t,i=>!i.isCore)??t.at(-1)}getAgent(t,i=!1){if(!(!this._agentIsEnabled(t)&&!i))return this._agents.get(t)?.data}_agentIsEnabled(t){const i=typeof t=="string"?this._agents.get(t):t;return!i?.data.when||this.contextKeyService.contextMatchesRules(Ut.deserialize(i.data.when))}getAgentByFullyQualifiedId(t){const i=ai.find(this._agents.values(),r=>eH(r.data)===t)?.data;if(!(i&&!this._agentIsEnabled(i.id)))return i}getAgents(){return Array.from(this._agents.values()).map(t=>t.data).filter(t=>this._agentIsEnabled(t.id))}getActivatedAgents(){return Array.from(this._agents.values()).filter(t=>!!t.impl).filter(t=>this._agentIsEnabled(t.data.id)).map(t=>new Sf(t.data,t.impl))}getAgentsByName(t){return this._preferExtensionAgents(this.getAgents().filter(i=>i.name===t))}_preferExtensionAgents(t){const i=t.filter(r=>!r.isCore);return i.length>0?i:t}agentHasDupeName(t){const i=this.getAgent(t);return i?this.getAgentsByName(i.name).filter(r=>r.extensionId.value!==i.extensionId.value).length>0:!1}async invokeAgent(t,i,r,s,n){const o=this._agents.get(t);if(!o?.impl)throw new Error(`No activated agent with id "${t}"`);return await o.impl.invoke(i,r,s,n)}setRequestPaused(t,i,r){const s=this._agents.get(t);if(!s?.impl)throw new Error(`No activated agent with id "${t}"`);s.impl.setRequestPaused?.(i,r)}async getFollowups(t,i,r,s,n){const o=this._agents.get(t);return o?.impl?.provideFollowups?o.impl.provideFollowups(i,r,s,n):[]}async getChatTitle(t,i,r){const s=this._agents.get(t);if(!s?.impl)throw new Error(`No activated agent with id "${t}"`);if(s.impl?.provideChatTitle)return s.impl.provideChatTitle(i,r)}registerChatParticipantDetectionProvider(t,i){return this._chatParticipantDetectionProviders.set(t,i),ie(()=>{this._chatParticipantDetectionProviders.delete(t)})}hasChatParticipantDetectionProviders(){return this._chatParticipantDetectionProviders.size>0}async detectAgentOrCommand(t,i,r,s){const n=ai.first(this._chatParticipantDetectionProviders.values());if(!n)return;const o=this.getAgents().reduce((u,d)=>{if(d.locations.includes(r.location)){u.push({participant:d.id,disambiguation:d.disambiguation??[]});for(const f of d.slashCommands)u.push({participant:d.id,command:f.name,disambiguation:f.disambiguation??[]})}return u},[]),a=await n.provideParticipantDetection(t,i,{...r,participants:o},s);if(!a)return;const l=this.getAgent(a.participant);if(!l)return;if(!a.command)return{agent:l};const c=l?.slashCommands.find(u=>u.name===a.command);if(c)return{agent:l,command:c}}};eP=__decorate([__param(0,$h)],eP);var Sf=class{constructor(e,t){this.data=e,this.impl=t}get id(){return this.data.id}get name(){return this.data.name??""}get fullName(){return this.data.fullName??""}get description(){return this.data.description??""}get extensionId(){return this.data.extensionId}get extensionPublisherId(){return this.data.extensionPublisherId}get extensionPublisherDisplayName(){return this.data.publisherDisplayName}get extensionDisplayName(){return this.data.extensionDisplayName}get isDefault(){return this.data.isDefault}get isCore(){return this.data.isCore}get metadata(){return this.data.metadata}get slashCommands(){return this.data.slashCommands}get locations(){return this.data.locations}get modes(){return this.data.modes}get disambiguation(){return this.data.disambiguation}async invoke(e,t,i,r){return this.impl.invoke(e,t,i,r)}setRequestPaused(e,t){this.impl.setRequestPaused&&this.impl.setRequestPaused(e,t)}async provideFollowups(e,t,i,r){return this.impl.provideFollowups?this.impl.provideFollowups(e,t,i,r):[]}provideSampleQuestions(e,t){if(this.impl.provideSampleQuestions)return this.impl.provideSampleQuestions(e,t)}toJSON(){return this.data}},nZ=q("chatAgentNameService"),tP=class{static{Kc=this}static{this.StorageKey="chat.participantNameRegistry"}constructor(t,i,r,s){if(this.requestService=i,this.logService=r,this.storageService=s,this.registry=J1(this,Object.create(null)),this.disposed=!1,!t.chatParticipantRegistry)return;this.url=t.chatParticipantRegistry;const n=s.get(Kc.StorageKey,-1);try{this.registry.set(JSON.parse(n??"{}"),void 0)}catch{s.remove(Kc.StorageKey,-1)}this.refresh()}refresh(){this.disposed||this.update().catch(t=>this.logService.warn("Failed to fetch chat participant registry",t)).then(()=>ui(5*60*1e3)).then(()=>this.refresh())}async update(){const t=await this.requestService.request({type:"GET",url:this.url},Be.None);if(t.res.statusCode!==200)throw new Error("Could not get extensions report.");const i=await $$(t);if(!i||i.version!==1)throw new Error("Unexpected chat participant registry response.");const r=i.restrictedChatParticipants;this.registry.set(r,void 0),this.storageService.store(Kc.StorageKey,JSON.stringify(r),-1,1)}getAgentNameRestriction(t){if(t.isCore)return!0;const i=this.checkAgentNameRestriction(t.name,t).get(),r=!t.fullName||this.checkAgentNameRestriction(t.fullName.replace(/\s/g,""),t).get();return i&&r}checkAgentNameRestriction(t,i){return this.registry.map(s=>s[t.toLowerCase()]).map(s=>s?s.some(n=>kr(n,n.includes(".")?i.extensionId.value:i.extensionPublisherId)):!0)}dispose(){this.disposed=!0}};tP=Kc=__decorate([__param(0,cf),__param(1,L$),__param(2,ke),__param(3,GI)],tP);function eH(e){return`${e.extensionId.value}.${e.id}`}function iP(e){const t="name"in e?e:{...e,name:e.id};return"extensionPublisherId"in t||(t.extensionPublisherId=t.extensionPublisher??""),"extensionDisplayName"in t||(t.extensionDisplayName=""),"extensionId"in t||(t.extensionId=new qe("")),kt(t)}var tH=q("chatEditingService"),rP;(function(e){e[e.Modified=0]="Modified",e[e.Accepted=1]="Accepted",e[e.Rejected=2]="Rejected"})(rP||(rP={}));var sP;(function(e){e[e.Initial=0]="Initial",e[e.StreamingEdits=1]="StreamingEdits",e[e.Idle=2]="Idle",e[e.Disposed=3]="Disposed"})(sP||(sP={}));var aZ=new I("chatEditingWidgetFileState",void 0,h(5578,null)),lZ=new I("chatEditingAgentSupportsReadonlyReferences",void 0,h(5579,null)),cZ=new I("decidedChatEditingResource",[]),uZ=new I("chatEditingResource",void 0),dZ=new I("inChatEditingSession",void 0),hZ=new I("hasUndecidedChatEditingResource",!1),fZ=new I("hasAppliedChatEdits",!1),pZ=new I("applyingChatEditsFailed",!1),nP;(function(e){e[e.Created=0]="Created",e[e.Modified=1]="Modified"})(nP||(nP={}));var l_=class s8{static{this.Kind="text"}constructor(t,i,r){this.range=t,this.editorRange=i,this.text=r,this.kind=s8.Kind}get promptText(){return this.text}},c_="#",iH="@",Xc="/",oP=class n8{static{this.Kind="var"}constructor(t,i,r,s,n){this.range=t,this.editorRange=i,this.variableName=r,this.variableArg=s,this.variableId=n,this.kind=n8.Kind}get text(){const t=this.variableArg?`:${this.variableArg}`:"";return`${c_}${this.variableName}${t}`}get promptText(){return this.text}},aP=class o8{static{this.Kind="tool"}constructor(t,i,r,s,n,o){this.range=t,this.editorRange=i,this.toolName=r,this.toolId=s,this.displayName=n,this.icon=o,this.kind=o8.Kind}get text(){return`${c_}${this.toolName}`}get promptText(){return this.text}toVariableEntry(){return{kind:"tool",id:this.toolId,name:this.toolName,range:this.range,value:void 0,icon:Wt.isThemeIcon(this.icon)?this.icon:void 0,fullName:this.displayName}}},lP=class a8{static{this.Kind="agent"}constructor(t,i,r){this.range=t,this.editorRange=i,this.agent=r,this.kind=a8.Kind}get text(){return`${iH}${this.agent.name}`}get promptText(){return""}},cP=class l8{static{this.Kind="subcommand"}constructor(t,i,r){this.range=t,this.editorRange=i,this.command=r,this.kind=l8.Kind}get text(){return`${Xc}${this.command.name}`}get promptText(){return""}},uP=class c8{static{this.Kind="slash"}constructor(t,i,r){this.range=t,this.editorRange=i,this.slashCommand=r,this.kind=c8.Kind}get text(){return`${Xc}${this.slashCommand.command}`}get promptText(){return`${Xc}${this.slashCommand.command}`}},dP=class u8{static{this.Kind="prompt"}constructor(t,i,r){this.range=t,this.editorRange=i,this.slashPromptCommand=r,this.kind=u8.Kind}get text(){return`${Xc}${this.slashPromptCommand.command}`}get promptText(){return`${Xc}${this.slashPromptCommand.command}`}},hP=class d8{static{this.Kind="dynamic"}constructor(t,i,r,s,n,o,a,l,c,u){this.range=t,this.editorRange=i,this.text=r,this.id=s,this.modelDescription=n,this.data=o,this.fullName=a,this.icon=l,this.isFile=c,this.isDirectory=u,this.kind=d8.Kind}get referenceText(){return this.text.replace(c_,"")}get promptText(){return this.text}toVariableEntry(){return this.id==="vscode.problems"?d_.toEntry(this.data.filter):{kind:this.isDirectory?"directory":this.isFile?"file":"generic",id:this.id,name:this.referenceText,range:this.range,value:this.data,fullName:this.fullName,icon:this.icon}}};function rH(e){return{text:e.text,parts:e.parts.map(t=>{if(t.kind===l_.Kind)return new l_(new Hs(t.range.start,t.range.endExclusive),t.editorRange,t.text);if(t.kind===oP.Kind)return new oP(new Hs(t.range.start,t.range.endExclusive),t.editorRange,t.variableName,t.variableArg,t.variableId||"");if(t.kind===aP.Kind)return new aP(new Hs(t.range.start,t.range.endExclusive),t.editorRange,t.toolName,t.toolId,t.displayName,t.icon);if(t.kind===lP.Kind){let i=t.agent;return i=iP(i),new lP(new Hs(t.range.start,t.range.endExclusive),t.editorRange,i)}else{if(t.kind===cP.Kind)return new cP(new Hs(t.range.start,t.range.endExclusive),t.editorRange,t.command);if(t.kind===uP.Kind)return new uP(new Hs(t.range.start,t.range.endExclusive),t.editorRange,t.slashCommand);if(t.kind===dP.Kind)return new dP(new Hs(t.range.start,t.range.endExclusive),t.editorRange,t.slashPromptCommand);if(t.kind===hP.Kind)return new hP(new Hs(t.range.start,t.range.endExclusive),t.editorRange,t.text,t.id,t.modelDescription,kt(t.data),t.fullName,t.icon,t.isFile,t.isDirectory);throw new Error(`Unknown chat request part: ${t.kind}`)}})}}var fP;(function(e){e[e.Info=0]="Info",e[e.Warning=1]="Warning",e[e.Error=2]="Error"})(fP||(fP={}));function sH(e){return!!e&&typeof e=="object"&&"uri"in e&&e.uri instanceof b&&"version"in e&&typeof e.version=="number"&&"ranges"in e&&Array.isArray(e.ranges)&&e.ranges.every(je.isIRange)}function nH(e){return!!e&&typeof e=="object"&&"documents"in e&&Array.isArray(e.documents)&&e.documents.every(sH)}var pP;(function(e){e[e.Complete=1]="Complete",e[e.Partial=2]="Partial",e[e.Omitted=3]="Omitted"})(pP||(pP={}));var xf;(function(e){e[e.Down=0]="Down",e[e.Up=1]="Up"})(xf||(xf={}));var gP;(function(e){e.IncorrectCode="incorrectCode",e.DidNotFollowInstructions="didNotFollowInstructions",e.IncompleteCode="incompleteCode",e.MissingContext="missingContext",e.PoorlyWrittenOrFormatted="poorlyWrittenOrFormatted",e.RefusedAValidRequest="refusedAValidRequest",e.OffensiveOrUnsafe="offensiveOrUnsafe",e.Other="other",e.WillReportIssue="willReportIssue"})(gP||(gP={}));var mP;(function(e){e[e.Action=1]="Action",e[e.Toolbar=2]="Toolbar"})(mP||(mP={}));var oH=q("IChatService"),u_,vP;(function(e){e[e.NotOmitted=0]="NotOmitted",e[e.Partial=1]="Partial",e[e.Full=2]="Full"})(vP||(vP={}));var d_;(function(e){e.icon=ue.error;function t(n){return{filterUri:n.resource,owner:n.owner,problemMessage:n.message,filterRange:{startLineNumber:n.startLineNumber,endLineNumber:n.endLineNumber,startColumn:n.startColumn,endColumn:n.endColumn}}}e.fromMarker=t;function i(n){return{id:r(n),name:s(n),icon:e.icon,value:n,kind:"diagnostic",...n}}e.toEntry=i;function r(n){return[n.filterUri,n.owner,n.filterSeverity,n.filterRange?.startLineNumber].join(":")}e.id=r;function s(n){let o;if(function(l){l[l.MaxChars=30]="MaxChars",l[l.MaxSpaceLookback=10]="MaxSpaceLookback"}(o||(o={})),n.problemMessage){if(n.problemMessage.length<30)return n.problemMessage;const l=n.problemMessage.lastIndexOf(" ",30);return l===-1||l+10<30?n.problemMessage.substring(0,30)+"\u2026":n.problemMessage.substring(0,l)+"\u2026"}let a=h(5589,null);return n.filterUri&&(a=h(5590,null,ir(n.filterUri))),a}e.label=s})(d_||(d_={}));function aH(e){return e.kind==="image"}var ji={reason:"other"},_P=class{get session(){return this._session}get username(){return this.session.requesterUsername}get avatarIconUri(){return this.session.requesterAvatarIconUri}get attempt(){return this._attempt}get variableData(){return this._variableData}set variableData(e){this._variableData=e}get confirmation(){return this._confirmation}get locationData(){return this._locationData}get attachedContext(){return this._attachedContext}get editedFileEvents(){return this._editedFileEvents}constructor(e){this._session=e.session,this.message=e.message,this._variableData=e.variableData,this.timestamp=e.timestamp,this._attempt=e.attempt??0,this._confirmation=e.confirmation,this._locationData=e.locationData,this._attachedContext=e.attachedContext,this.isCompleteAddedRequest=e.isCompleteAddedRequest??!1,this.modelId=e.modelId,this.id=e.restoredId??"request_"+mt(),this._editedFileEvents=e.editedFileEvents}adoptTo(e){this._session=e}},wP=class{get value(){return this._responseParts}constructor(e){this._responseRepr="",this._markdownContent="",this._responseParts=e,this._updateRepr()}toString(){return this._responseRepr}getMarkdown(){return this._markdownContent}_updateRepr(){this._responseRepr=this.partsToRepr(this._responseParts),this._markdownContent=this._responseParts.map(e=>e.kind==="inlineReference"?this.inlineRefToRepr(e):e.kind==="markdownContent"||e.kind==="markdownVuln"?e.content.value:"").filter(e=>e.length>0).join("")}partsToRepr(e){const t=[];let i=[];for(const r of e){let s;switch(r.kind){case"treeData":case"progressMessage":case"codeblockUri":case"toolInvocation":case"toolInvocationSerialized":case"extensions":case"undoStop":continue;case"inlineReference":s={text:this.inlineRefToRepr(r)};break;case"command":s={text:r.command.title,isBlock:!0};break;case"textEditGroup":case"notebookEditGroup":s={text:h(5591,null),isBlock:!0};break;case"confirmation":s={text:`${r.title}
${r.message}`,isBlock:!0};break;default:s={text:r.content.value};break}s.isBlock?(i.length&&(t.push(i.join("")),i=[]),t.push(s.text)):i.push(s.text)}return i.length&&t.push(i.join("")),t.join(`

`)}inlineRefToRepr(e){return"uri"in e.inlineReference?this.uriToRepr(e.inlineReference.uri):"name"in e.inlineReference?"`"+e.inlineReference.name+"`":this.uriToRepr(e.inlineReference)}uriToRepr(e){return e.scheme===V.http||e.scheme===V.https?e.toString(!1):ir(e)}},lH=class extends wP{constructor(e,t){const i=e.value.findIndex(r=>r.kind==="undoStop"&&r.id===t);super(i===-1?e.value.slice():e.value.slice(0,i)),this.undoStop=t}},cH=class extends wP{get onDidChangeValue(){return this._onDidChangeValue.event}constructor(e){super(er(e).map(t=>Ns(t)?{content:t,kind:"markdownContent"}:"kind"in t?t:{kind:"treeData",treeData:t})),this._onDidChangeValue=new D,this._citations=[]}dispose(){this._onDidChangeValue.dispose()}clear(){this._responseParts=[],this._updateRepr(!0)}updateContent(e,t){if(e.kind==="markdownContent"){const i=this._responseParts.filter(r=>r.kind!=="textEditGroup").at(-1);if(!i||i.kind!=="markdownContent"||!hH(i.content,e.content))this._responseParts.push(e);else{const r=this._responseParts.indexOf(i);this._responseParts[r]={...i,content:fH(i.content,e.content)}}this._updateRepr(t)}else if(e.kind==="textEdit"||e.kind==="notebookEdit"){const r=e.uri.scheme===V.vscodeNotebookCell&&!this._responseParts.find(l=>l.kind==="notebookEditGroup")?void 0:af.parse(e.uri)?.notebook,s=r??e.uri;let n=!1;const o=e.kind==="textEdit"&&!r?"textEditGroup":"notebookEditGroup",a=o==="textEditGroup"?e.edits:e.edits.map(l=>sF.isTextEdit(l)?{uri:e.uri,edit:l}:l);for(let l=0;!n&&l<this._responseParts.length;l++){const c=this._responseParts[l];c.kind===o&&!c.done&&lo(c.uri,s)&&(c.edits.push(a),c.done=e.done,n=!0)}n||this._responseParts.push({kind:o,uri:s,edits:o==="textEditGroup"?[a]:a,done:e.done}),this._updateRepr(t)}else if(e.kind==="progressTask"){const i=this._responseParts.push(e)-1;this._updateRepr(t);const r=e.onDidAddProgress(()=>{this._updateRepr(!1)});e.task?.().then(s=>{r.dispose(),typeof s=="string"&&(this._responseParts[i].content=new Fa(s)),this._updateRepr(!1)})}else e.kind==="toolInvocation"?(e.confirmationMessages&&e.confirmed.p.then(()=>{this._updateRepr(!1)}),e.isCompletePromise.then(()=>{this._updateRepr(!1)}),this._responseParts.push(e),this._updateRepr(t)):(this._responseParts.push(e),this._updateRepr(t))}addCitation(e){this._citations.push(e),this._updateRepr()}_updateRepr(e){super._updateRepr(),this._onDidChangeValue&&(this._responseRepr+=this._citations.length?`

`+pH(this._citations):"",e||this._onDidChangeValue.fire())}},Ef=class extends X{get session(){return this._session}get shouldBeRemovedOnSend(){return this._shouldBeRemovedOnSend}get isComplete(){return this._isComplete}set shouldBeRemovedOnSend(e){this._shouldBeRemovedOnSend=e,this._onDidChange.fire(ji)}get isCanceled(){return this._isCanceled}get vote(){return this._vote}get voteDownReason(){return this._voteDownReason}get followups(){return this._followups}get entireResponse(){return this._finalizedResponse||this._response}get result(){return this._result}get username(){return this.session.responderUsername}get avatarIcon(){return this.session.responderAvatarIcon}get agent(){return this._agent}get slashCommand(){return this._slashCommand}get agentOrSlashCommandDetected(){return this._agentOrSlashCommandDetected??!1}get usedContext(){return this._usedContext}get contentReferences(){return Array.from(this._contentReferences)}get codeCitations(){return this._codeCitations}get progressMessages(){return this._progressMessages}get isStale(){return this._isStale}get isPaused(){return this._isPaused}get isPendingConfirmation(){return this._response.value.some(e=>e.kind==="toolInvocation"&&e.isConfirmed===void 0||e.kind==="confirmation"&&e.isUsed===!1)}get response(){const e=this._shouldBeRemovedOnSend?.afterUndoStop;return e?(this._responseView?.undoStop!==e&&(this._responseView=new lH(this._response,e)),this._responseView):this._finalizedResponse||this._response}constructor(e){super(),this._onDidChange=this._register(new D),this.onDidChange=this._onDidChange.event,this._contentReferences=[],this._codeCitations=[],this._progressMessages=[],this._isStale=!1,this._isPaused=J1("isPaused",!1),this._session=e.session,this._agent=e.agent,this._slashCommand=e.slashCommand,this.requestId=e.requestId,this._isComplete=e.isComplete??!1,this._isCanceled=e.isCanceled??!1,this._vote=e.vote,this._voteDownReason=e.voteDownReason,this._result=e.result,this._followups=e.followups?[...e.followups]:void 0,this.isCompleteAddedRequest=e.isCompleteAddedRequest??!1,this._shouldBeRemovedOnSend=e.shouldBeRemovedOnSend,this._isStale=Array.isArray(e.responseContent)&&(e.responseContent.length!==0||Ns(e.responseContent)&&e.responseContent.value.length!==0),this._response=this._register(new cH(e.responseContent)),this._register(this._response.onDidChangeValue(()=>this._onDidChange.fire(ji))),this.id=e.restoredId??"response_"+mt()}updateContent(e,t){this.bufferWhenPaused(()=>this._response.updateContent(e,t))}addUndoStop(e){this.bufferWhenPaused(()=>{this._onDidChange.fire({reason:"undoStop",id:e.id}),this._response.updateContent(e,!0)})}applyReference(e){e.kind==="usedContext"?this._usedContext=e:e.kind==="reference"&&(this._contentReferences.push(e),this._onDidChange.fire(ji))}applyCodeCitation(e){this._codeCitations.push(e),this._response.addCitation(e),this._onDidChange.fire(ji)}setAgent(e,t){this._agent=e,this._slashCommand=t,this._agentOrSlashCommandDetected=!e.isDefault||!!t,this._onDidChange.fire(ji)}setResult(e){this._result=e,this._onDidChange.fire(ji)}complete(){this._result?.errorDetails?.responseIsRedacted&&this._response.clear(),this._isComplete=!0,this._onDidChange.fire(ji)}cancel(){this._isComplete=!0,this._isCanceled=!0,this._onDidChange.fire(ji)}setFollowups(e){this._followups=e,this._onDidChange.fire(ji)}setVote(e){this._vote=e,this._onDidChange.fire(ji)}setVoteDownReason(e){this._voteDownReason=e,this._onDidChange.fire(ji)}setEditApplied(e,t){return!this.response.value.includes(e)||!e.state?!1:(e.state.applied=t,this._onDidChange.fire(ji),!0)}adoptTo(e){this._session=e,this._onDidChange.fire(ji)}setPaused(e,t){this._isPaused.set(e,t),this._onDidChange.fire(ji),this.bufferedPauseContent?.forEach(i=>i()),this.bufferedPauseContent=void 0}finalizeUndoState(){this._finalizedResponse=this.response,this._responseView=void 0,this._shouldBeRemovedOnSend=void 0}bufferWhenPaused(e){this._isPaused.get()?(this.bufferedPauseContent??=[],this.bufferedPauseContent.push(e)):e()}},yP;(function(e){e[e.NotPausable=0]="NotPausable",e[e.Paused=1]="Paused",e[e.Unpaused=2]="Unpaused"})(yP||(yP={}));function uH(e){const t=e;return typeof t=="object"&&typeof t.requesterUsername=="string"}function dH(e){const t=e;return uH(e)&&typeof t.creationDate=="number"&&typeof t.sessionId=="string"&&e.requests.every(i=>!i.usedContext||nH(i.usedContext))}var bP;(function(e){e[e.Removal=0]="Removal",e[e.Resend=1]="Resend",e[e.Adoption=2]="Adoption"})(bP||(bP={}));var gr;(function(e){e[e.Created=0]="Created",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(gr||(gr={}));var SP=u_=class extends X{static getDefaultTitle(t){const i=t.at(0)?.message??"";return(typeof i=="string"?i:i.text).split(`
`)[0].substring(0,50)}get sampleQuestions(){return this._sampleQuestions}get sessionId(){return this._sessionId}get requestInProgress(){const t=this.lastRequest;return!t?.response||t.response.isPendingConfirmation?!1:!t.response.isComplete}get requestPausibility(){const t=this.lastRequest;return!t?.response?.agent||t.response.isComplete||t.response.isPendingConfirmation?0:t.response.isPaused.get()?1:2}get hasRequests(){return this._requests.length>0}get lastRequest(){return this._requests.at(-1)}get creationDate(){return this._creationDate}get lastMessageDate(){return this._lastMessageDate}get _defaultAgent(){return this.chatAgentService.getDefaultAgent(fi.Panel,ss.Ask)}get requesterUsername(){return this._defaultAgent?.metadata.requester?.name??this.initialData?.requesterUsername??""}get responderUsername(){return this._defaultAgent?.fullName??this.initialData?.responderUsername??""}get requesterAvatarIconUri(){return this._defaultAgent?.metadata.requester?.icon??this._initialRequesterAvatarIconUri}get responderAvatarIcon(){return this._defaultAgent?.metadata.themeIcon??this._initialResponderAvatarIconUri}get initState(){return this._initState}get isImported(){return this._isImported}get customTitle(){return this._customTitle}get title(){return this._customTitle||u_.getDefaultTitle(this._requests)}get initialLocation(){return this._initialLocation}get editingSessionObs(){return this._editingSession}get editingSession(){return this._editingSession?.promiseResult.get()?.data}constructor(t,i,r,s,n){super(),this.initialData=t,this._initialLocation=i,this.logService=r,this.chatAgentService=s,this.chatEditingService=n,this._onDidDispose=this._register(new D),this.onDidDispose=this._onDidDispose.event,this._onDidChange=this._register(new D),this.onDidChange=this._onDidChange.event,this._initState=gr.Created,this._isInitializedDeferred=new hr,this._isImported=!1,this.currentEditedFileEvents=new Vt,this._checkpoint=void 0;const o=dH(t);t&&!o&&this.logService.warn(`ChatModel#constructor: Loaded malformed session data: ${JSON.stringify(t)}`),this._isImported=!!t&&!o||(t?.isImported??!1),this._sessionId=o&&t.sessionId||mt(),this._requests=t?this._deserialize(t):[],this._creationDate=o&&t.creationDate||Date.now(),this._lastMessageDate=o&&t.lastMessageDate||this._creationDate,this._customTitle=o?t.customTitle:void 0,this._initialRequesterAvatarIconUri=t?.requesterAvatarIconUri&&b.revive(t.requesterAvatarIconUri),this._initialResponderAvatarIconUri=mh(t?.responderAvatarIconUri)?b.revive(t.responderAvatarIconUri):t?.responderAvatarIconUri}startEditingSession(t){const i=t?this.chatEditingService.startOrContinueGlobalEditingSession(this):this.chatEditingService.createEditingSession(this);this._editingSession=new RF(i),this._editingSession.promise.then(r=>{this._store.isDisposed?r.dispose():this._register(r)})}notifyEditingAction(t){const i=t.outcome==="accepted"?Ga.Keep:t.outcome==="rejected"?Ga.Undo:t.outcome==="userModified"?Ga.UserModification:null;i!==null&&(!this.currentEditedFileEvents.has(t.uri)||this.currentEditedFileEvents.get(t.uri)?.eventKind===Ga.Keep)&&this.currentEditedFileEvents.set(t.uri,{eventKind:i,uri:t.uri})}_deserialize(t){const i=t.requests;if(!Array.isArray(i))return this.logService.error(`Ignoring malformed session data: ${JSON.stringify(t)}`),[];try{return i.map(r=>{const s=typeof r.message=="string"?this.getParsedRequestFromString(r.message):rH(r.message),n=this.reviveVariableData(r.variableData),o=new _P({session:this,message:s,variableData:n,timestamp:r.timestamp??-1,restoredId:r.requestId,confirmation:r.confirmation,editedFileEvents:r.editedFileEvents});if(o.shouldBeRemovedOnSend=r.isHidden?{requestId:r.requestId}:r.shouldBeRemovedOnSend,r.response||r.result||r.responseErrorDetails){const a=r.agent&&"metadata"in r.agent?iP(r.agent):void 0,l="responseErrorDetails"in r?{errorDetails:r.responseErrorDetails}:r.result;o.response=new Ef({responseContent:r.response??[new Fa(r.response)],session:this,agent:a,slashCommand:r.slashCommand,requestId:o.id,isComplete:!0,isCanceled:r.isCanceled,vote:r.vote,voteDownReason:r.voteDownReason,result:l,followups:r.followups,restoredId:r.responseId}),o.response.shouldBeRemovedOnSend=r.isHidden?{requestId:r.requestId}:r.shouldBeRemovedOnSend,r.usedContext&&o.response.applyReference(kt(r.usedContext)),r.contentReferences?.forEach(c=>o.response.applyReference(kt(c))),r.codeCitations?.forEach(c=>o.response.applyCodeCitation(kt(c)))}return o})}catch(r){return this.logService.error("Failed to parse chat data",r),[]}}reviveVariableData(t){const i=t&&Array.isArray(t.variables)?t:{variables:[]};return i.variables=i.variables.map(r=>r&&"values"in r&&Array.isArray(r.values)?{kind:"generic",id:r.id??"",name:r.name,value:r.values[0]?.value,range:r.range,modelDescription:r.modelDescription,references:r.references}:r),i}getParsedRequestFromString(t){const i=[new l_(new Hs(0,t.length),{startColumn:1,startLineNumber:1,endColumn:1,endLineNumber:1},t)];return{text:t,parts:i}}toggleLastRequestPaused(t){if(this.requestPausibility!==0&&this.lastRequest?.response?.agent){const i=t??!this.lastRequest.response.isPaused.get();this.lastRequest.response.setPaused(i),this.chatAgentService.setRequestPaused(this.lastRequest.response.agent.id,this.lastRequest.id,i),this._onDidChange.fire({kind:"changedRequest",request:this.lastRequest})}}startInitialize(){if(this.initState!==gr.Created)throw new Error(`ChatModel is in the wrong state for startInitialize: ${gr[this.initState]}`);this._initState=gr.Initializing}deinitialize(){this._initState=gr.Created,this._isInitializedDeferred=new hr}initialize(t){if(this.initState!==gr.Initializing)throw new Error(`ChatModel is in the wrong state for initialize: ${gr[this.initState]}`);this._initState=gr.Initialized,this._sampleQuestions=t,this._isInitializedDeferred.complete(),this._onDidChange.fire({kind:"initialize"})}setInitializationError(t){if(this.initState!==gr.Initializing)throw new Error(`ChatModel is in the wrong state for setInitializationError: ${gr[this.initState]}`);this._isInitializedDeferred.isSettled||this._isInitializedDeferred.error(t)}waitForInitialization(){return this._isInitializedDeferred.p}getRequests(){return this._requests}get checkpoint(){return this._checkpoint}setDisabledRequests(t){this._requests.forEach(i=>{const r=t.find(s=>s.requestId===i.id);i.shouldBeRemovedOnSend=r,i.response&&(i.response.shouldBeRemovedOnSend=r)}),this._onDidChange.fire({kind:"setHidden",hiddenRequestIds:t})}addRequest(t,i,r,s,n,o,a,l,c,u){const d=[...this.currentEditedFileEvents.values()];this.currentEditedFileEvents.clear();const f=new _P({session:this,message:t,variableData:i,timestamp:Date.now(),attempt:r,confirmation:o,locationData:a,attachedContext:l,isCompleteAddedRequest:c,modelId:u,editedFileEvents:d.length?d:void 0});return f.response=new Ef({responseContent:[],session:this,agent:s,slashCommand:n,requestId:f.id,isCompleteAddedRequest:c}),this._requests.push(f),this._lastMessageDate=Date.now(),this._onDidChange.fire({kind:"addRequest",request:f}),f}setCustomTitle(t){this._customTitle=t}updateRequest(t,i){t.variableData=i,this._onDidChange.fire({kind:"changedRequest",request:t})}adoptRequest(t){const i=t.session,r=i._requests.findIndex(s=>s.id===t.id);r!==-1&&(i._requests.splice(r,1),t.adoptTo(this),t.response?.adoptTo(this),this._requests.push(t),i._onDidChange.fire({kind:"removeRequest",requestId:t.id,responseId:t.response?.id,reason:2}),this._onDidChange.fire({kind:"addRequest",request:t}))}acceptResponseProgress(t,i,r){if(t.response||(t.response=new Ef({responseContent:[],session:this,requestId:t.id})),t.response.isComplete)throw new Error("acceptResponseProgress: Adding progress to a completed response");i.kind==="markdownContent"||i.kind==="treeData"||i.kind==="inlineReference"||i.kind==="codeblockUri"||i.kind==="markdownVuln"||i.kind==="progressMessage"||i.kind==="command"||i.kind==="textEdit"||i.kind==="notebookEdit"||i.kind==="warning"||i.kind==="progressTask"||i.kind==="confirmation"||i.kind==="extensions"||i.kind==="toolInvocation"?t.response.updateContent(i,r):i.kind==="usedContext"||i.kind==="reference"?t.response.applyReference(i):i.kind==="codeCitation"?t.response.applyCodeCitation(i):i.kind==="move"?this._onDidChange.fire({kind:"move",target:i.uri,range:i.range}):i.kind==="undoStop"?t.response.addUndoStop(i):this.logService.error(`Couldn't handle progress: ${JSON.stringify(i)}`)}removeRequest(t,i=0){const r=this._requests.findIndex(n=>n.id===t),s=this._requests[r];r!==-1&&(this._onDidChange.fire({kind:"removeRequest",requestId:s.id,responseId:s.response?.id,reason:i}),this._requests.splice(r,1),s.response?.dispose())}cancelRequest(t){t.response&&t.response.cancel()}setResponse(t,i){t.response||(t.response=new Ef({responseContent:[],session:this,requestId:t.id})),t.response.setResult(i)}completeResponse(t){if(!t.response)throw new Error("Call setResponse before completeResponse");t.response.complete(),this._onDidChange.fire({kind:"completedRequest",request:t})}setFollowups(t,i){t.response&&t.response.setFollowups(i)}setResponseModel(t,i){t.response=i,this._onDidChange.fire({kind:"addResponse",response:i})}toExport(){return{requesterUsername:this.requesterUsername,requesterAvatarIconUri:this.requesterAvatarIconUri,responderUsername:this.responderUsername,responderAvatarIconUri:this.responderAvatarIcon,initialLocation:this.initialLocation,requests:this._requests.map(t=>{const i={...t.message,parts:t.message.parts.map(n=>n&&"toJSON"in n?n.toJSON():n)},r=t.response?.agent,s=r&&"toJSON"in r?r.toJSON():r?{...r}:void 0;return{requestId:t.id,message:i,variableData:t.variableData,response:t.response?t.response.entireResponse.value.map(n=>n.kind==="treeData"?n.treeData:n.kind==="markdownContent"?n.content:n):void 0,responseId:t.response?.id,shouldBeRemovedOnSend:t.shouldBeRemovedOnSend,result:t.response?.result,followups:t.response?.followups,isCanceled:t.response?.isCanceled,vote:t.response?.vote,voteDownReason:t.response?.voteDownReason,agent:s,slashCommand:t.response?.slashCommand,usedContext:t.response?.usedContext,contentReferences:t.response?.contentReferences,codeCitations:t.response?.codeCitations,timestamp:t.timestamp,confirmation:t.confirmation,editedFileEvents:t.editedFileEvents}})}}toJSON(){return{version:3,...this.toExport(),sessionId:this.sessionId,creationDate:this._creationDate,isImported:this._isImported,lastMessageDate:this._lastMessageDate,customTitle:this._customTitle}}dispose(){this._requests.forEach(t=>t.response?.dispose()),this._onDidDispose.fire(),super.dispose()}};SP=u_=__decorate([__param(2,ke),__param(3,Z$),__param(4,tH)],SP);function hH(e,t){if(e.baseUri&&t.baseUri){if(!(e.baseUri.scheme===t.baseUri.scheme&&e.baseUri.authority===t.baseUri.authority&&e.baseUri.path===t.baseUri.path&&e.baseUri.query===t.baseUri.query&&e.baseUri.fragment===t.baseUri.fragment))return!1}else if(e.baseUri||t.baseUri)return!1;return Ei(e.isTrusted,t.isTrusted)&&e.supportHtml===t.supportHtml&&e.supportThemeIcons===t.supportThemeIcons}function fH(e,t){const i=typeof t=="string"?t:t.value;return{value:e.value+i,isTrusted:e.isTrusted,supportThemeIcons:e.supportThemeIcons,supportHtml:e.supportHtml,baseUri:e.baseUri}}function pH(e){if(e.length===0)return"";const t=e.reduce((r,s)=>r.add(s.license),new Set);return t.size===1?h(5592,null,t.size):h(5593,null,t.size)}var Ga;(function(e){e[e.Keep=1]="Keep",e[e.Undo=2]="Undo",e[e.UserModification=3]="UserModification"})(Ga||(Ga={}));var xP;(function(e){e.Delimiter="\0"})(xP||(xP={}));var EP;(function(e){e[e.IsSame=0]="IsSame",e[e.Disconnected=1]="Disconnected",e[e.IsChild=2]="IsChild",e[e.IsParent=3]="IsParent"})(EP||(EP={}));var He=class br{static fromExtHostTestItem(t,i,r=t.parent){if(t._isRoot)return new br([i]);const s=[t.id];for(let n=r;n&&n.id!==i;n=n.parent)s.push(n.id);return s.push(i),new br(s.reverse())}static isRoot(t){return!t.includes("\0")}static root(t){const i=t.indexOf("\0");return i===-1?t:t.slice(0,i)}static fromString(t){return new br(t.split("\0"))}static join(t,i){return new br([...t.path,i])}static split(t){return t.split("\0")}static joinToString(t,i){return t.toString()+"\0"+i}static parentId(t){const i=t.lastIndexOf("\0");return i===-1?void 0:t.slice(0,i)}static localId(t){const i=t.lastIndexOf("\0");return i===-1?t:t.slice(i+1)}static isChild(t,i){return i[t.length]==="\0"&&i.startsWith(t)}static compare(t,i){return t===i?0:br.isChild(t,i)?2:br.isChild(i,t)?3:1}static getLengthOfCommonPrefix(t,i){if(t===0)return 0;let r=0;for(;r<t-1;){for(let s=1;s<t;s++){const n=i(s-1),o=i(s);if(n.path[r]!==o.path[r])return r}r++}return r}constructor(t,i=t.length){if(this.path=t,this.viewEnd=i,t.length===0||i<1)throw new Error("cannot create test with empty path")}get rootId(){return new br(this.path,1)}get parentId(){return this.viewEnd>1?new br(this.path,this.viewEnd-1):void 0}get localId(){return this.path[this.viewEnd-1]}get controllerId(){return this.path[0]}get isRoot(){return this.viewEnd===1}*idsFromRoot(){for(let t=1;t<=this.viewEnd;t++)yield new br(this.path,t)}*idsToRoot(){for(let t=this.viewEnd;t>0;t--)yield new br(this.path,t)}compare(t){if(typeof t=="string")return br.compare(this.toString(),t);for(let i=0;i<t.viewEnd&&i<this.viewEnd;i++)if(t.path[i]!==this.path[i])return 1;return t.viewEnd>this.viewEnd?2:t.viewEnd<this.viewEnd?3:0}toJSON(){return this.toString()}toString(){if(!this.stringifed){this.stringifed=this.path[0];for(let t=1;t<this.viewEnd;t++)this.stringifed+="\0",this.stringifed+=this.path[t]}return this.stringifed}},CP;(function(e){e[e.Unset=0]="Unset",e[e.Queued=1]="Queued",e[e.Running=2]="Running",e[e.Passed=3]="Passed",e[e.Failed=4]="Failed",e[e.Skipped=5]="Skipped",e[e.Errored=6]="Errored"})(CP||(CP={}));var DP;(function(e){e[e.Run=1]="Run",e[e.Debug=2]="Debug",e[e.Coverage=3]="Coverage"})(DP||(DP={}));var kP;(function(e){e[e.Refresh=2]="Refresh",e[e.CodeRelatedToTest=4]="CodeRelatedToTest",e[e.TestRelatedToCode=8]="TestRelatedToCode"})(kP||(kP={}));var IP;(function(e){e[e.Run=2]="Run",e[e.Debug=4]="Debug",e[e.Coverage=8]="Coverage",e[e.HasNonDefaultProfile=16]="HasNonDefaultProfile",e[e.HasConfigurable=32]="HasConfigurable",e[e.SupportsContinuousRun=64]="SupportsContinuousRun"})(IP||(IP={}));var mZ={2:h(12568,null),4:h(12569,null),8:h(12570,null)},gH=e=>"runId"in e,Qa;(function(e){e.serialize=t=>({range:t.range.toJSON(),uri:t.uri.toJSON()}),e.deserialize=(t,i)=>({range:je.lift(i.range),uri:t.asCanonicalUri(b.revive(i.uri))})})(Qa||(Qa={}));var PP;(function(e){e[e.Error=0]="Error",e[e.Output=1]="Output"})(PP||(PP={}));var Cf;(function(e){e.serialize=t=>({label:t.label,uri:t.uri?.toJSON(),position:t.position?.toJSON()}),e.deserialize=(t,i)=>({label:i.label,uri:i.uri?t.asCanonicalUri(b.revive(i.uri)):void 0,position:i.position?sr.lift(i.position):void 0})})(Cf||(Cf={}));var Df;(function(e){e.serialize=t=>({message:t.message,type:0,expected:t.expected,actual:t.actual,contextValue:t.contextValue,location:t.location&&Qa.serialize(t.location),stackTrace:t.stackTrace?.map(Cf.serialize)}),e.deserialize=(t,i)=>({message:i.message,type:0,expected:i.expected,actual:i.actual,contextValue:i.contextValue,location:i.location&&Qa.deserialize(t,i.location),stackTrace:i.stackTrace&&i.stackTrace.map(r=>Cf.deserialize(t,r))})})(Df||(Df={}));var kf;(function(e){e.serialize=t=>({message:t.message,type:1,offset:t.offset,length:t.length,location:t.location&&Qa.serialize(t.location)}),e.deserialize=(t,i)=>({message:i.message,type:1,offset:i.offset,length:i.length,location:i.location&&Qa.deserialize(t,i.location)})})(kf||(kf={}));var If;(function(e){e.serialize=t=>t.type===0?Df.serialize(t):kf.serialize(t),e.deserialize=(t,i)=>i.type===0?Df.deserialize(t,i):kf.deserialize(t,i),e.isDiffable=t=>t.type===0&&t.actual!==void 0&&t.expected!==void 0})(If||(If={}));var Yc;(function(e){e.serializeWithoutMessages=t=>({state:t.state,duration:t.duration,messages:[]}),e.serialize=t=>({state:t.state,duration:t.duration,messages:t.messages.map(If.serialize)}),e.deserialize=(t,i)=>({state:i.state,duration:i.duration,messages:i.messages.map(r=>If.deserialize(t,r))})})(Yc||(Yc={}));var TP="\0",Pf=(e,t)=>e+TP+t,AP=e=>{const t=e.indexOf(TP);return{ctrlId:e.slice(0,t),tagId:e.slice(t+1)}},Tf;(function(e){e.serialize=t=>({extId:t.extId,label:t.label,tags:t.tags,busy:t.busy,children:void 0,uri:t.uri?.toJSON(),range:t.range?.toJSON()||null,description:t.description,error:t.error,sortText:t.sortText}),e.deserialize=(t,i)=>({extId:i.extId,label:i.label,tags:i.tags,busy:i.busy,children:void 0,uri:i.uri?t.asCanonicalUri(b.revive(i.uri)):void 0,range:i.range?je.lift(i.range):null,description:i.description,error:i.error,sortText:i.sortText})})(Tf||(Tf={}));var RP;(function(e){e[e.NotExpandable=0]="NotExpandable",e[e.Expandable=1]="Expandable",e[e.BusyExpanding=2]="BusyExpanding",e[e.Expanded=3]="Expanded"})(RP||(RP={}));var Pn;(function(e){e.serialize=t=>({expand:t.expand,item:Tf.serialize(t.item)}),e.deserialize=(t,i)=>({controllerId:He.root(i.item.extId),expand:i.expand,item:Tf.deserialize(t,i.item)})})(Pn||(Pn={}));var Zc;(function(e){e.serialize=t=>{let i;return t.item&&(i={},t.item.label!==void 0&&(i.label=t.item.label),t.item.tags!==void 0&&(i.tags=t.item.tags),t.item.busy!==void 0&&(i.busy=t.item.busy),t.item.uri!==void 0&&(i.uri=t.item.uri?.toJSON()),t.item.range!==void 0&&(i.range=t.item.range?.toJSON()),t.item.description!==void 0&&(i.description=t.item.description),t.item.error!==void 0&&(i.error=t.item.error),t.item.sortText!==void 0&&(i.sortText=t.item.sortText)),{extId:t.extId,expand:t.expand,item:i}},e.deserialize=t=>{let i;return t.item&&(i={},t.item.label!==void 0&&(i.label=t.item.label),t.item.tags!==void 0&&(i.tags=t.item.tags),t.item.busy!==void 0&&(i.busy=t.item.busy),t.item.range!==void 0&&(i.range=t.item.range?je.lift(t.item.range):null),t.item.description!==void 0&&(i.description=t.item.description),t.item.error!==void 0&&(i.error=t.item.error),t.item.sortText!==void 0&&(i.sortText=t.item.sortText)),{extId:t.extId,expand:t.expand,item:i}}})(Zc||(Zc={}));var h_=(e,t)=>{t.expand!==void 0&&(e.expand=t.expand),t.item!==void 0&&(e.item=e.item?Object.assign(e.item,t.item):t.item)},LP;(function(e){e.serializeWithoutMessages=t=>({...Pn.serialize(t),ownComputedState:t.ownComputedState,computedState:t.computedState,tasks:t.tasks.map(Yc.serializeWithoutMessages)}),e.serialize=t=>({...Pn.serialize(t),ownComputedState:t.ownComputedState,computedState:t.computedState,tasks:t.tasks.map(Yc.serialize)}),e.deserialize=(t,i)=>({...Pn.deserialize(t,i),ownComputedState:i.ownComputedState,computedState:i.computedState,tasks:i.tasks.map(r=>Yc.deserialize(t,r)),retired:!0})})(LP||(LP={}));var f_;(function(e){e.empty=()=>({covered:0,total:0}),e.sum=(t,i)=>{t.covered+=i.covered,t.total+=i.total}})(f_||(f_={}));var NP;(function(e){e.serialize=t=>({id:t.id,statement:t.statement,branch:t.branch,declaration:t.declaration,testIds:t.testIds,uri:t.uri.toJSON()}),e.deserialize=(t,i)=>({id:i.id,statement:i.statement,branch:i.branch,declaration:i.declaration,testIds:i.testIds,uri:t.asCanonicalUri(b.revive(i.uri))}),e.empty=(t,i)=>({id:t,uri:i,statement:f_.empty()})})(NP||(NP={}));function p_(e){return{...e,location:e.location?.toJSON()}}function g_(e){return e.location=e.location?sr.isIPosition(e.location)?sr.lift(e.location):je.lift(e.location):void 0,e}var MP;(function(e){e[e.Declaration=0]="Declaration",e[e.Statement=1]="Statement",e[e.Branch=2]="Branch"})(MP||(MP={}));var OP;(function(e){e.serialize=t=>t.type===0?Rf.serialize(t):Lf.serialize(t),e.deserialize=t=>t.type===0?Rf.deserialize(t):Lf.deserialize(t)})(OP||(OP={}));var Af;(function(e){e.serialize=p_,e.deserialize=g_})(Af||(Af={}));var Rf;(function(e){e.serialize=p_,e.deserialize=g_})(Rf||(Rf={}));var Lf;(function(e){e.serialize=t=>({...p_(t),branches:t.branches?.map(Af.serialize)}),e.deserialize=t=>({...g_(t),branches:t.branches?.map(Af.deserialize)})})(Lf||(Lf={}));var FP;(function(e){e[e.Add=0]="Add",e[e.Update=1]="Update",e[e.DocumentSynced=2]="DocumentSynced",e[e.Remove=3]="Remove",e[e.IncrementPendingExtHosts=4]="IncrementPendingExtHosts",e[e.Retire=5]="Retire",e[e.AddTag=6]="AddTag",e[e.RemoveTag=7]="RemoveTag"})(FP||(FP={}));var Nf;(function(e){e.deserialize=(t,i)=>i.op===0?{op:i.op,item:Pn.deserialize(t,i.item)}:i.op===1?{op:i.op,item:Zc.deserialize(i.item)}:i.op===2?{op:i.op,uri:t.asCanonicalUri(b.revive(i.uri)),docv:i.docv}:i,e.serialize=t=>t.op===0?{op:t.op,item:Pn.serialize(t.item)}:t.op===1?{op:t.op,item:Zc.serialize(t.item)}:t})(Nf||(Nf={}));var mH=class{constructor(e){this.uriIdentity=e,this._tags=new Map,this.items=new Map,this.roots=new Set,this.busyControllerCount=0,this.pendingRootCount=0,this.tags=this._tags}apply(e){const t=this.createChangeCollector();for(const i of e)switch(i.op){case 0:this.add(Pn.deserialize(this.uriIdentity,i.item),t);break;case 1:this.update(Zc.deserialize(i.item),t);break;case 3:this.remove(i.itemId,t);break;case 5:this.retireTest(i.itemId);break;case 4:this.updatePendingRoots(i.amount);break;case 6:this._tags.set(i.tag.id,i.tag);break;case 7:this._tags.delete(i.id);break}t.complete?.()}add(e,t){const i=He.parentId(e.item.extId)?.toString();let r;if(!i)r=this.createItem(e),this.roots.add(r),this.items.set(e.item.extId,r);else if(this.items.has(i)){const s=this.items.get(i);s.children.add(e.item.extId),r=this.createItem(e,s),this.items.set(e.item.extId,r)}else{console.error(`Test with unknown parent ID: ${JSON.stringify(e)}`);return}return t.add?.(r),e.expand===2&&this.busyControllerCount++,r}update(e,t){const i=this.items.get(e.extId);if(i)return e.expand!==void 0&&(i.expand===2&&this.busyControllerCount--,e.expand===2&&this.busyControllerCount++),h_(i,e),t.update?.(i),i}remove(e,t){const i=this.items.get(e);if(!i)return;const r=He.parentId(i.item.extId)?.toString();r?this.items.get(r).children.delete(i.item.extId):this.roots.delete(i);const s=[[e]];for(;s.length;)for(const n of s.pop()){const o=this.items.get(n);o&&(s.push(o.children),this.items.delete(n),t.remove?.(o,o!==i),o.expand===2&&this.busyControllerCount--)}}retireTest(e){}updatePendingRoots(e){this.pendingRootCount+=e}createChangeCollector(){return{}}},vH=q("editorGroupsService"),$P;(function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"})($P||($P={}));var HP;(function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL"})(HP||(HP={}));var UP;(function(e){e[e.FIRST=0]="FIRST",e[e.LAST=1]="LAST",e[e.NEXT=2]="NEXT",e[e.PREVIOUS=3]="PREVIOUS"})(UP||(UP={}));var WP;(function(e){e[e.MAXIMIZE=0]="MAXIMIZE",e[e.EXPAND=1]="EXPAND",e[e.EVEN=2]="EVEN"})(WP||(WP={}));var BP;(function(e){e[e.COPY_EDITORS=0]="COPY_EDITORS",e[e.MOVE_EDITORS=1]="MOVE_EDITORS"})(BP||(BP={}));var VP;(function(e){e[e.CREATION_TIME=0]="CREATION_TIME",e[e.MOST_RECENTLY_ACTIVE=1]="MOST_RECENTLY_ACTIVE",e[e.GRID_APPEARANCE=2]="GRID_APPEARANCE"})(VP||(VP={}));var zP;(function(e){e[e.NEW_EDITOR=1]="NEW_EDITOR",e[e.MOVE_EDITOR=2]="MOVE_EDITOR",e[e.COPY_EDITOR=3]="COPY_EDITOR"})(zP||(zP={}));var vZ=q("editorService"),_H=-1,wH=-2,m_="^([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$",_Z=new RegExp(m_),qP;(function(e){e.COMMAND="command",e.SETTINGS_SYNC="settingsSync"})(qP||(qP={}));var jP;(function(e){e.NoneOrRelevance="NoneOrRelevance",e.LastUpdatedDate="LastUpdatedDate",e.Title="Title",e.PublisherName="PublisherName",e.InstallCount="InstallCount",e.PublishedDate="PublishedDate",e.AverageRating="AverageRating",e.WeightedRating="WeightedRating"})(jP||(jP={}));var GP;(function(e){e[e.Default=0]="Default",e[e.Ascending=1]="Ascending",e[e.Descending=2]="Descending"})(GP||(GP={}));var QP;(function(e){e.Category="Category",e.ExtensionId="ExtensionId",e.ExtensionName="ExtensionName",e.ExcludeWithFlags="ExcludeWithFlags",e.Featured="Featured",e.SearchText="SearchText",e.Tag="Tag",e.Target="Target"})(QP||(QP={}));var JP;(function(e){e.Install="install",e.Uninstall="uninstall"})(JP||(JP={}));var KP;(function(e){e[e.None=1]="None",e[e.Install=2]="Install",e[e.Update=3]="Update",e[e.Migrate=4]="Migrate"})(KP||(KP={}));var wZ=q("extensionGalleryService"),XP;(function(e){e.Timeout="Timeout",e.Cancelled="Cancelled",e.Failed="Failed",e.DownloadFailedWriting="DownloadFailedWriting",e.Offline="Offline"})(XP||(XP={}));var YP;(function(e){e.NotFound="NotFound",e.Unsupported="Unsupported",e.Deprecated="Deprecated",e.Malicious="Malicious",e.Incompatible="Incompatible",e.IncompatibleApi="IncompatibleApi",e.IncompatibleTargetPlatform="IncompatibleTargetPlatform",e.ReleaseVersionNotFound="ReleaseVersionNotFound",e.Invalid="Invalid",e.Download="Download",e.DownloadSignature="DownloadSignature",e.DownloadFailedWriting="DownloadFailedWriting",e.UpdateMetadata="UpdateMetadata",e.Extract="Extract",e.Scanning="Scanning",e.ScanningExtension="ScanningExtension",e.ReadRemoved="ReadRemoved",e.UnsetRemoved="UnsetRemoved",e.Delete="Delete",e.Rename="Rename",e.IntializeDefaultProfile="IntializeDefaultProfile",e.AddToProfile="AddToProfile",e.InstalledExtensionNotFound="InstalledExtensionNotFound",e.PostInstall="PostInstall",e.CorruptZip="CorruptZip",e.IncompleteZip="IncompleteZip",e.PackageNotSigned="PackageNotSigned",e.SignatureVerificationInternal="SignatureVerificationInternal",e.SignatureVerificationFailed="SignatureVerificationFailed",e.NotAllowed="NotAllowed",e.Gallery="Gallery",e.Cancelled="Cancelled",e.Unknown="Unknown",e.Internal="Internal"})(YP||(YP={}));var ZP;(function(e){e.NotSigned="NotSigned",e.Success="Success",e.RequiredArgumentMissing="RequiredArgumentMissing",e.InvalidArgument="InvalidArgument",e.PackageIsUnreadable="PackageIsUnreadable",e.UnhandledException="UnhandledException",e.SignatureManifestIsMissing="SignatureManifestIsMissing",e.SignatureManifestIsUnreadable="SignatureManifestIsUnreadable",e.SignatureIsMissing="SignatureIsMissing",e.SignatureIsUnreadable="SignatureIsUnreadable",e.CertificateIsUnreadable="CertificateIsUnreadable",e.SignatureArchiveIsUnreadable="SignatureArchiveIsUnreadable",e.FileAlreadyExists="FileAlreadyExists",e.SignatureArchiveIsInvalidZip="SignatureArchiveIsInvalidZip",e.SignatureArchiveHasSameSignatureFile="SignatureArchiveHasSameSignatureFile",e.PackageIntegrityCheckFailed="PackageIntegrityCheckFailed",e.SignatureIsInvalid="SignatureIsInvalid",e.SignatureManifestIsInvalid="SignatureManifestIsInvalid",e.SignatureIntegrityCheckFailed="SignatureIntegrityCheckFailed",e.EntryIsMissing="EntryIsMissing",e.EntryIsTampered="EntryIsTampered",e.Untrusted="Untrusted",e.CertificateRevoked="CertificateRevoked",e.SignatureIsNotValid="SignatureIsNotValid",e.UnknownError="UnknownError",e.PackageIsInvalidZip="PackageIsInvalidZip",e.SignatureArchiveHasTooManyEntries="SignatureArchiveHasTooManyEntries"})(ZP||(ZP={}));var yZ=q("extensionManagementService"),bZ=q("IGlobalExtensionEnablementService"),SZ=q("IExtensionTipsService"),xZ=q("IAllowedExtensionsService"),EZ=nh(1953,"Extensions"),CZ=nh(1954,"Preferences"),yH="extensions.allowed",bH="extensions.gallery.url";Xt.as(Do.Configuration).registerConfiguration({id:"extensions",order:30,title:h(1935,null),type:"object",properties:{[bH]:{type:"string",markdownDescription:h(1936,null),scope:1,default:null},[yH]:{type:"object",markdownDescription:h(1937,null),default:"*",defaultSnippets:[{body:{},description:h(1938,null)},{body:{"*":!0},description:h(1939,null)}],scope:1,policy:{name:"AllowedExtensions",minimumVersion:"1.96",description:h(1940,null)},additionalProperties:!1,patternProperties:{"([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$":{anyOf:[{type:["boolean","string"],enum:[!0,!1,"stable"],description:h(1941,null),enumDescriptions:[h(1942,null),h(1943,null),h(1944,null)]},{type:"array",items:{type:"string"},description:h(1945,null)}]},"([a-z0-9A-Z][a-z0-9-A-Z]*)$":{type:["boolean","string"],enum:[!0,!1,"stable"],description:h(1946,null),enumDescriptions:[h(1947,null),h(1948,null),h(1949,null)]},"\\*":{type:"boolean",enum:[!0,!1],description:h(1950,null),enumDescriptions:[h(1951,null),h(1952,null)]}}}}});var DZ=q("telemetryService"),kZ=q("customEndpointTelemetryService"),e4;(function(e){e[e.NONE=0]="NONE",e[e.CRASH=1]="CRASH",e[e.ERROR=2]="ERROR",e[e.USAGE=3]="USAGE"})(e4||(e4={}));var t4;(function(e){e.OFF="off",e.CRASH="crash",e.ERROR="error",e.ON="all"})(t4||(t4={}));var v_=class{constructor(e){this.value=e,this.isTrustedTelemetryValue=!0}},SH=class{constructor(){this.telemetryLevel=0,this.sessionId="someValue.sessionId",this.machineId="someValue.machineId",this.sqmId="someValue.sqmId",this.devDeviceId="someValue.devDeviceId",this.firstSessionDate="someValue.firstSessionDate",this.sendErrorTelemetry=!1}publicLog(){}publicLog2(){}publicLogError(){}publicLogError2(){}setExperimentProperty(){}},IZ=new SH,xH="telemetry",EH={id:xH,name:h(2269,null)},CH=new Set(["ssh-remote","dev-container","attached-container","wsl","tunnel","codespaces","amlext"]);function DH(e){if(!e)return"none";const t=r1(e);return CH.has(t)?t:"other"}function kH(e,t){if(!e||!e.includes("/")&&!e.includes("\\"))return e;let i=e;const r=[];for(const a of t)for(;;){const l=a.exec(e);if(!l)break;r.push([l.index,a.lastIndex])}const s=/^[\\\/]?(node_modules|node_modules\.asar)[\\\/]/,n=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-\._]+(\\\\|\\|\/))+[\w-\._]*/g;let o=0;for(i="";;){const a=n.exec(e);if(!a)break;const l=r.some(([c,u])=>a.index<u&&c<n.lastIndex);!s.test(a[0])&&!l&&(i+=e.substring(o,a.index)+"<REDACTED: user-file-path>",o=n.lastIndex)}return o<e.length&&(i+=e.substr(o)),i}function IH(e){if(!e)return e;const t=[{label:"Google API Key",regex:/AIza[A-Za-z0-9_\\\-]{35}/},{label:"Slack Token",regex:/xox[pbar]\-[A-Za-z0-9]/},{label:"GitHub Token",regex:/(gh[psuro]_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59})/},{label:"Generic Secret",regex:/(key|token|sig|secret|signature|password|passwd|pwd|android:value)[^a-zA-Z0-9]/i},{label:"CLI Credentials",regex:/((login|psexec|(certutil|psexec)\.exe).{1,50}(\s-u(ser(name)?)?\s+.{3,100})?\s-(admin|user|vm|root)?p(ass(word)?)?\s+["']?[^$\-\/\s]|(^|[\s\r\n\\])net(\.exe)?.{1,5}(user\s+|share\s+\/user:| user -? secrets ? set) \s + [^ $\s \/])/},{label:"Microsoft Entra ID",regex:/eyJ(?:0eXAiOiJKV1Qi|hbGci|[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+\.)/},{label:"Email",regex:/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/}];for(const i of t)if(i.regex.test(e))return`<REDACTED: ${i.label}>`;return e}function i4(e,t){return Ta(e,i=>{if(i instanceof v_||Object.hasOwnProperty.call(i,"isTrustedTelemetryValue"))return i.value;if(typeof i=="string"){let r=i.replaceAll("%20"," ");r=kH(r,t);for(const s of t)r=r.replace(s,"");return r=IH(r),r}})}function PH(e,t){return e.uuid&&t.uuid?e.uuid===t.uuid:e.id===t.id?!0:Iv(e.id,t.id)===0}var PZ=new qe("pprice.better-merge"),TH=class{constructor(){this._generators=new Map,this._cache=new WeakMap}register(e,t){this._generators.set(e,t)}readActivationEvents(e){return this._cache.has(e)||this._cache.set(e,this._readActivationEvents(e)),this._cache.get(e)}createActivationEventsMap(e){const t=Object.create(null);for(const i of e){const r=this.readActivationEvents(i);r.length>0&&(t[qe.toKey(i.identifier)]=r)}return t}_readActivationEvents(e){if(typeof e.main>"u"&&typeof e.browser>"u")return[];const t=Array.isArray(e.activationEvents)?e.activationEvents.slice(0):[];for(let i=0;i<t.length;i++)t[i]==="onUri"&&(t[i]=`onUri:${qe.toKey(e.identifier)}`);if(!e.contributes)return t;for(const i in e.contributes){const r=this._generators.get(i);if(!r)continue;const s=e.contributes[i],n=Array.isArray(s)?s:[s];try{r(n,t)}catch(o){pt(o)}}return t}},AH=new TH,RH=Object.freeze({identifier:new qe("nullExtensionDescription"),name:"Null Extension Description",version:"0.0.0",publisher:"vscode",engines:{vscode:""},extensionLocation:b.parse("void:location"),isBuiltin:!1,targetPlatform:"undefined",isUserBuiltin:!1,isUnderDevelopment:!1,preRelease:!1}),LH=q("extensionService"),r4=class{constructor(e){this.dependency=e}},s4;(function(e){e[e.EagerAutoStart=1]="EagerAutoStart",e[e.EagerManualStart=2]="EagerManualStart",e[e.Lazy=3]="Lazy"})(s4||(s4={}));function nt(e,t){return e.enabledApiProposals?e.enabledApiProposals.includes(t):!1}function M(e,t){if(!(e.identifier.value==="CodeBuddy.codebuddy-remote-ssh"||e.identifier.value==="CodeBuddy.codebuddy-open-wsl")&&!nt(e,t))throw new Error(`Extension '${e.identifier.value}' CANNOT use API proposal: ${t}.
Its package.json#enabledApiProposals-property declares: ${e.enabledApiProposals?.join(", ")??"[]"} but NOT ${t}.
 The missing proposal MUST be added and you must start in extension development mode or use the following command line switch: --enable-proposed-api ${e.identifier.value}`)}var n4;(function(e){e[e.Normal=0]="Normal",e[e.Immediate=1]="Immediate"})(n4||(n4={}));var o4;(function(e){e[e.Upsert=0]="Upsert",e[e.SetTags=1]="SetTags",e[e.UpdateCanResolveChildren=2]="UpdateCanResolveChildren",e[e.RemoveChild=3]="RemoveChild",e[e.SetProp=4]="SetProp",e[e.Bulk=5]="Bulk",e[e.DocumentSynced=6]="DocumentSynced"})(o4||(o4={}));var eu=(e,t)=>e===t,NH={range:(e,t)=>e===t?!0:!e||!t?!1:e.equalsRange(t),busy:eu,label:eu,description:eu,error:eu,sortText:eu,tags:(e,t)=>!(e.length!==t.length||e.some(i=>!t.includes(i)))},MH=Object.entries(NH),OH=(e,t)=>{let i;for(const[r,s]of MH)s(e[r],t[r])||(i?i[r]=t[r]:i={[r]:t[r]});return i},FH=class extends X{get root(){return this.options.root}constructor(e){super(),this.options=e,this.debounceSendDiff=this._register(new ks(()=>this.flushDiff(),200)),this.diffOpEmitter=this._register(new D),this.tree=new Map,this.tags=new Map,this.diff=[],this.onDidGenerateDiff=this.diffOpEmitter.event,this.root.canResolveChildren=!0,this.upsertItem(this.root,void 0)}set resolveHandler(e){this._resolveHandler=e;for(const t of this.tree.values())this.updateExpandability(t)}get resolveHandler(){return this._resolveHandler}collectDiff(){const e=this.diff;return this.diff=[],e}pushDiff(e){switch(e.op){case 2:{for(const t of this.diff)if(t.op===2&&t.uri===e.uri){t.docv=e.docv;return}break}case 1:{const t=this.diff[this.diff.length-1];if(t){if(t.op===1&&t.item.extId===e.item.extId){h_(t.item,e.item);return}if(t.op===0&&t.item.item.extId===e.item.extId){h_(t.item,e.item);return}}break}}this.diff.push(e),this.debounceSendDiff.isScheduled()||this.debounceSendDiff.schedule()}expand(e,t){const i=this.tree.get(e);if(i){if((i.expandLevels===void 0||t>i.expandLevels)&&(i.expandLevels=t),i.expand===1){const r=this.resolveChildren(i);return r.isOpen()?this.expandChildren(i,t-1):r.wait().then(()=>this.expandChildren(i,t-1))}else if(i.expand===3)return i.resolveBarrier?.isOpen()===!1?i.resolveBarrier.wait().then(()=>this.expandChildren(i,t-1)):this.expandChildren(i,t-1)}}dispose(){for(const e of this.tree.values())this.options.getApiFor(e.actual).listener=void 0;this.tree.clear(),this.diff=[],super.dispose()}onTestItemEvent(e,t){switch(t.op){case 3:this.removeItem(He.joinToString(e.fullId,t.id));break;case 0:this.upsertItem(t.item,e);break;case 5:for(const i of t.ops)this.onTestItemEvent(e,i);break;case 1:this.diffTagRefs(t.new,t.old,e.fullId.toString());break;case 2:this.updateExpandability(e);break;case 4:this.pushDiff({op:1,item:{extId:e.fullId.toString(),item:t.update}});break;case 6:this.documentSynced(e.actual.uri);break;default:gv(t)}}documentSynced(e){e&&this.pushDiff({op:2,uri:e,docv:this.options.getDocumentVersion(e)})}upsertItem(e,t){const i=He.fromExtHostTestItem(e,this.root.id,t?.actual),r=this.options.getApiFor(e);r.parent&&r.parent!==t?.actual&&this.options.getChildren(r.parent).delete(e.id);let s=this.tree.get(i.toString());if(!s){s={fullId:i,actual:e,expandLevels:t?.expandLevels?t.expandLevels-1:void 0,expand:0},e.tags.forEach(this.incrementTagRefs,this),this.tree.set(s.fullId.toString(),s),this.setItemParent(e,t),this.pushDiff({op:0,item:{controllerId:this.options.controllerId,expand:s.expand,item:this.options.toITestItem(e)}}),this.connectItemAndChildren(e,s,t);return}if(s.actual===e){this.connectItem(e,s,t);return}if(s.actual.uri?.toString()!==e.uri?.toString())return this.removeItem(i.toString()),this.upsertItem(e,t);const n=this.options.getChildren(s.actual),o=s.actual,a=OH(this.options.toITestItem(o),this.options.toITestItem(e));this.options.getApiFor(o).listener=void 0,s.actual=e,s.resolveBarrier=void 0,s.expand=0,a&&(a.hasOwnProperty("tags")&&(this.diffTagRefs(e.tags,o.tags,i.toString()),delete a.tags),this.onTestItemEvent(s,{op:4,update:a})),this.connectItemAndChildren(e,s,t);for(const[c,u]of n)this.options.getChildren(e).get(u.id)||this.removeItem(He.joinToString(i,u.id));const l=s.expandLevels;l!==void 0&&queueMicrotask(()=>{s.expand===1&&(s.expandLevels=void 0,this.expand(i.toString(),l))}),this.documentSynced(s.actual.uri)}diffTagRefs(e,t,i){const r=new Set(t.map(s=>s.id));for(const s of e)r.delete(s.id)||this.incrementTagRefs(s);this.pushDiff({op:1,item:{extId:i,item:{tags:e.map(s=>Pf(this.options.controllerId,s.id))}}}),r.forEach(this.decrementTagRefs,this)}incrementTagRefs(e){const t=this.tags.get(e.id);t?t.refCount++:(this.tags.set(e.id,{refCount:1}),this.pushDiff({op:6,tag:{id:Pf(this.options.controllerId,e.id)}}))}decrementTagRefs(e){const t=this.tags.get(e);t&&!--t.refCount&&(this.tags.delete(e),this.pushDiff({op:7,id:Pf(this.options.controllerId,e)}))}setItemParent(e,t){this.options.getApiFor(e).parent=t&&t.actual!==this.root?t.actual:void 0}connectItem(e,t,i){this.setItemParent(e,i);const r=this.options.getApiFor(e);r.parent=i?.actual,r.listener=s=>this.onTestItemEvent(t,s),this.updateExpandability(t)}connectItemAndChildren(e,t,i){this.connectItem(e,t,i);for(const[r,s]of this.options.getChildren(e))this.upsertItem(s,t)}updateExpandability(e){let t;this._resolveHandler?e.resolveBarrier?t=e.resolveBarrier.isOpen()?3:2:t=e.actual.canResolveChildren?1:0:t=0,t!==e.expand&&(e.expand=t,this.pushDiff({op:1,item:{extId:e.fullId.toString(),expand:t}}),t===1&&e.expandLevels!==void 0&&this.resolveChildren(e))}expandChildren(e,t){if(t<0)return;const i=[];for(const[r,s]of this.options.getChildren(e.actual)){const n=this.expand(He.joinToString(e.fullId,s.id),t);wn(n)&&i.push(n)}if(i.length)return Promise.all(i).then(()=>{})}resolveChildren(e){if(e.resolveBarrier)return e.resolveBarrier;if(!this._resolveHandler){const s=new dr;return s.open(),s}e.expand=2,this.pushExpandStateUpdate(e);const t=e.resolveBarrier=new dr,i=s=>{console.error(`Unhandled error in resolveHandler of test controller "${this.options.controllerId}"`,s)};let r;try{r=this._resolveHandler(e.actual===this.root?void 0:e.actual)}catch(s){i(s)}return wn(r)?r.catch(i).then(()=>{t.open(),this.updateExpandability(e)}):(t.open(),this.updateExpandability(e)),e.resolveBarrier}pushExpandStateUpdate(e){this.pushDiff({op:1,item:{extId:e.fullId.toString(),expand:e.expand}})}removeItem(e){const t=this.tree.get(e);if(!t)throw new Error("attempting to remove non-existent child");this.pushDiff({op:3,itemId:e});const i=[t];for(;i.length;){const r=i.pop();if(r){this.options.getApiFor(r.actual).listener=void 0;for(const s of r.actual.tags)this.decrementTagRefs(s.id);this.tree.delete(r.fullId.toString());for(const[s,n]of this.options.getChildren(r.actual))i.push(this.tree.get(He.joinToString(r.fullId,n.id)))}}}flushDiff(){const e=this.collectDiff();e.length&&this.diffOpEmitter.fire(e)}},$H=class extends Error{constructor(e){super(`Attempted to insert a duplicate test item ID ${e}`)}},Mf=class extends Error{constructor(e){super(`TestItem with ID "${e}" is invalid. Make sure to create it from the createTestItem method.`)}},HH=class extends Error{constructor(e,t,i){super(`TestItem with ID "${e}" is from controller "${t}" and cannot be added as a child of an item from controller "${i}".`)}},UH=(e,t,i)=>{let r=new Map;return{get size(){return r.size},forEach(s,n){for(const o of r.values())s.call(n,o,this)},[Symbol.iterator](){return r.entries()},replace(s){const n=new Map,o=new Set(r.keys()),a={op:5,ops:[]};for(const l of s){if(!(l instanceof i))throw new Mf(l.id);const c=t(l).controllerId;if(c!==e.controllerId)throw new HH(l.id,c,e.controllerId);if(n.has(l.id))throw new $H(l.id);n.set(l.id,l),o.delete(l.id),a.ops.push({op:0,item:l})}for(const l of o.keys())a.ops.push({op:3,id:l});e.listener?.(a),r=n},add(s){if(!(s instanceof i))throw new Mf(s.id);r.set(s.id,s),e.listener?.({op:0,item:s})},delete(s){r.delete(s)&&e.listener?.({op:3,id:s})},get(s){return r.get(s)},toJSON(){return Array.from(r.values())}}},a4=new WeakMap,WH=(e,t)=>{const i={controllerId:t};return a4.set(e,i),i},Of=e=>{const t=a4.get(e);if(!t)throw new Mf(e?.id||"<unknown>");return t},BH=q("remoteAuthorityResolverService"),l4;(function(e){e[e.WebSocket=0]="WebSocket",e[e.Managed=1]="Managed"})(l4||(l4={}));var c4=class{constructor(e){this.id=e,this.type=1}toString(){return`Managed(${this.id})`}},VH=class{constructor(e,t){this.host=e,this.port=t,this.type=0}toString(){return`WebSocket(${this.host}:${this.port})`}},Ii;(function(e){e.Unknown="Unknown",e.NotAvailable="NotAvailable",e.TemporarilyNotAvailable="TemporarilyNotAvailable",e.NoResolverFound="NoResolverFound",e.InvalidAuthority="InvalidAuthority"})(Ii||(Ii={}));var __=class ha extends xr{static isNotAvailable(t){return t instanceof ha&&t._code===Ii.NotAvailable}static isTemporarilyNotAvailable(t){return t instanceof ha&&t._code===Ii.TemporarilyNotAvailable}static isNoResolverFound(t){return t instanceof ha&&t._code===Ii.NoResolverFound}static isInvalidAuthority(t){return t instanceof ha&&t._code===Ii.InvalidAuthority}static isHandled(t){return t instanceof ha&&t.isHandled}constructor(t,i=Ii.Unknown,r){super(t),this._message=t,this._code=i,this._detail=r,this.isHandled=i===Ii.NotAvailable&&r===!0,Object.setPrototypeOf(this,ha.prototype)}};function u4(e){const t=e.indexOf("+");return t===-1?e:e.substring(0,t)}var w_,Io,Ws,y_,Po,Tn,To,b_,S_,Ff,tu,x_,ns,os,E_,Pi,C_;function ce(e){return Object.assign(e,{apply:function(...i){if(i.length===0)return Reflect.construct(e,[]);{const r=i.length===1?[]:i[1];return Reflect.construct(e,r,i[0].constructor)}},call:function(...i){if(i.length===0)return Reflect.construct(e,[]);{const[r,...s]=i;return Reflect.construct(e,s,r.constructor)}}})}var D_;(function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom"})(D_||(D_={}));var d4;(function(e){e[e.TerminalCommand=0]="TerminalCommand",e[e.Opener=1]="Opener",e[e.Command=3]="Command"})(d4||(d4={}));var Ie=w_=class{static from(...t){let i=t;return new w_(function(){if(i){for(const r of i)r&&typeof r.dispose=="function"&&r.dispose();i=void 0}})}#e;constructor(t){this.#e=t}dispose(){typeof this.#e=="function"&&(this.#e(),this.#e=void 0)}};Ie=w_=__decorate([ce],Ie);var Te=Io=class{static Min(...t){if(t.length===0)throw new TypeError;let i=t[0];for(let r=1;r<t.length;r++){const s=t[r];s.isBefore(i)&&(i=s)}return i}static Max(...t){if(t.length===0)throw new TypeError;let i=t[0];for(let r=1;r<t.length;r++){const s=t[r];s.isAfter(i)&&(i=s)}return i}static isPosition(t){if(!t)return!1;if(t instanceof Io)return!0;const{line:i,character:r}=t;return typeof i=="number"&&typeof r=="number"}static of(t){if(t instanceof Io)return t;if(this.isPosition(t))return new Io(t.line,t.character);throw new Error("Invalid argument, is NOT a position-like object")}get line(){return this._line}get character(){return this._character}constructor(t,i){if(t<0)throw De("line must be non-negative");if(i<0)throw De("character must be non-negative");this._line=t,this._character=i}isBefore(t){return this._line<t._line?!0:t._line<this._line?!1:this._character<t._character}isBeforeOrEqual(t){return this._line<t._line?!0:t._line<this._line?!1:this._character<=t._character}isAfter(t){return!this.isBeforeOrEqual(t)}isAfterOrEqual(t){return!this.isBefore(t)}isEqual(t){return this._line===t._line&&this._character===t._character}compareTo(t){return this._line<t._line?-1:this._line>t.line?1:this._character<t._character?-1:this._character>t._character?1:0}translate(t,i=0){if(t===null||i===null)throw De();let r;return typeof t>"u"?r=0:typeof t=="number"?r=t:(r=typeof t.lineDelta=="number"?t.lineDelta:0,i=typeof t.characterDelta=="number"?t.characterDelta:0),r===0&&i===0?this:new Io(this.line+r,this.character+i)}with(t,i=this.character){if(t===null||i===null)throw De();let r;return typeof t>"u"?r=this.line:typeof t=="number"?r=t:(r=typeof t.line=="number"?t.line:this.line,i=typeof t.character=="number"?t.character:this.character),r===this.line&&i===this.character?this:new Io(r,i)}toJSON(){return{line:this.line,character:this.character}}[Symbol.for("debug.description")](){return`(${this.line}:${this.character})`}};Te=Io=__decorate([ce],Te);var Se=Ws=class{static isRange(t){return t instanceof Ws?!0:t?Te.isPosition(t.start)&&Te.isPosition(t.end):!1}static of(t){if(t instanceof Ws)return t;if(this.isRange(t))return new Ws(t.start,t.end);throw new Error("Invalid argument, is NOT a range-like object")}get start(){return this._start}get end(){return this._end}constructor(t,i,r,s){let n,o;if(typeof t=="number"&&typeof i=="number"&&typeof r=="number"&&typeof s=="number"?(n=new Te(t,i),o=new Te(r,s)):Te.isPosition(t)&&Te.isPosition(i)&&(n=Te.of(t),o=Te.of(i)),!n||!o)throw new Error("Invalid arguments");n.isBefore(o)?(this._start=n,this._end=o):(this._start=o,this._end=n)}contains(t){return Ws.isRange(t)?this.contains(t.start)&&this.contains(t.end):Te.isPosition(t)?!(Te.of(t).isBefore(this._start)||this._end.isBefore(t)):!1}isEqual(t){return this._start.isEqual(t._start)&&this._end.isEqual(t._end)}intersection(t){const i=Te.Max(t.start,this._start),r=Te.Min(t.end,this._end);if(!i.isAfter(r))return new Ws(i,r)}union(t){if(this.contains(t))return this;if(t.contains(this))return t;const i=Te.Min(t.start,this._start),r=Te.Max(t.end,this.end);return new Ws(i,r)}get isEmpty(){return this._start.isEqual(this._end)}get isSingleLine(){return this._start.line===this._end.line}with(t,i=this.end){if(t===null||i===null)throw De();let r;return t?Te.isPosition(t)?r=t:(r=t.start||this.start,i=t.end||this.end):r=this.start,r.isEqual(this._start)&&i.isEqual(this.end)?this:new Ws(r,i)}toJSON(){return[this.start,this.end]}[Symbol.for("debug.description")](){return h4(this)}};Se=Ws=__decorate([ce],Se);var Bs=y_=class extends Se{static isSelection(t){return t instanceof y_?!0:t?Se.isRange(t)&&Te.isPosition(t.anchor)&&Te.isPosition(t.active)&&typeof t.isReversed=="boolean":!1}get anchor(){return this._anchor}get active(){return this._active}constructor(t,i,r,s){let n,o;if(typeof t=="number"&&typeof i=="number"&&typeof r=="number"&&typeof s=="number"?(n=new Te(t,i),o=new Te(r,s)):Te.isPosition(t)&&Te.isPosition(i)&&(n=Te.of(t),o=Te.of(i)),!n||!o)throw new Error("Invalid arguments");super(n,o),this._anchor=n,this._active=o}get isReversed(){return this._anchor===this._end}toJSON(){return{start:this.start,end:this.end,active:this.active,anchor:this.anchor}}[Symbol.for("debug.description")](){return zH(this)}};Bs=y_=__decorate([ce],Bs);function h4(e){return e.isEmpty?`[${e.start.line}:${e.start.character})`:`[${e.start.line}:${e.start.character} -> ${e.end.line}:${e.end.character})`}function zH(e){let t=h4(e);return e.isEmpty||(e.active.isEqual(e.start)?t=`|${t}`:t=`${t}|`),t}var f4=e=>{if(typeof e!="string"||e.length===0||!/^[0-9A-Za-z_\-]+$/.test(e))throw De("connectionToken")},qH=class{static isResolvedAuthority(e){return e&&typeof e=="object"&&typeof e.host=="string"&&typeof e.port=="number"&&(e.connectionToken===void 0||typeof e.connectionToken=="string")}constructor(e,t,i){if(typeof e!="string"||e.length===0)throw De("host");if(typeof t!="number"||t===0||Math.round(t)!==t)throw De("port");typeof i<"u"&&f4(i),this.host=e,this.port=Math.round(t),this.connectionToken=i}},$f=class{static isManagedResolvedAuthority(e){return e&&typeof e=="object"&&typeof e.makeConnection=="function"&&(e.connectionToken===void 0||typeof e.connectionToken=="string")}constructor(e,t){this.makeConnection=e,this.connectionToken=t,typeof t<"u"&&f4(t)}},Ja=class Qm extends Error{static NotAvailable(t,i){return new Qm(t,Ii.NotAvailable,i)}static TemporarilyNotAvailable(t){return new Qm(t,Ii.TemporarilyNotAvailable)}constructor(t,i=Ii.Unknown,r){super(t),this._message=t,this._code=i,this._detail=r,Object.setPrototypeOf(this,Qm.prototype)}},Fr;(function(e){e[e.LF=1]="LF",e[e.CRLF=2]="CRLF"})(Fr||(Fr={}));var Ka;(function(e){e[e.Replace=1]="Replace",e[e.Append=2]="Append",e[e.Prepend=3]="Prepend"})(Ka||(Ka={}));var An=Po=class{static isTextEdit(t){return t instanceof Po?!0:t?Se.isRange(t)&&typeof t.newText=="string":!1}static replace(t,i){return new Po(t,i)}static insert(t,i){return Po.replace(new Se(t,t),i)}static delete(t){return Po.replace(t,"")}static setEndOfLine(t){const i=new Po(new Se(new Te(0,0),new Te(0,0)),"");return i.newEol=t,i}get range(){return this._range}set range(t){if(t&&!Se.isRange(t))throw De("range");this._range=t}get newText(){return this._newText||""}set newText(t){if(t&&typeof t!="string")throw De("newText");this._newText=t}get newEol(){return this._newEol}set newEol(t){if(t&&typeof t!="number")throw De("newEol");this._newEol=t}constructor(t,i){this._range=t,this._newText=i}toJSON(){return{range:this.range,newText:this.newText,newEol:this._newEol}}};An=Po=__decorate([ce],An);var Hf=Tn=class{static isNotebookCellEdit(t){return t instanceof Tn?!0:t?zs.isNotebookRange(t)&&Array.isArray(t.newCells):!1}static replaceCells(t,i){return new Tn(t,i)}static insertCells(t,i){return new Tn(new zs(t,t),i)}static deleteCells(t){return new Tn(t,[])}static updateCellMetadata(t,i){const r=new Tn(new zs(t,t),[]);return r.newCellMetadata=i,r}static updateNotebookMetadata(t){const i=new Tn(new zs(0,0),[]);return i.newNotebookMetadata=t,i}constructor(t,i){this.range=t,this.newCells=i}};Hf=Tn=__decorate([ce],Hf);var k_=class Jm{static isSnippetTextEdit(t){return t instanceof Jm?!0:t?Se.isRange(t.range)&&Ro.isSnippetString(t.snippet):!1}static replace(t,i){return new Jm(t,i)}static insert(t,i){return Jm.replace(new Se(t,t),i)}constructor(t,i){this.range=t,this.snippet=i}},p4;(function(e){e[e.File=1]="File",e[e.Text=2]="Text",e[e.Cell=3]="Cell",e[e.CellReplace=5]="CellReplace",e[e.Snippet=6]="Snippet"})(p4||(p4={}));var Ao=class{constructor(){this._edits=[]}_allEntries(){return this._edits}renameFile(t,i,r,s){this._edits.push({_type:1,from:t,to:i,options:r,metadata:s})}createFile(t,i,r){this._edits.push({_type:1,from:void 0,to:t,options:i,metadata:r})}deleteFile(t,i,r){this._edits.push({_type:1,from:t,to:void 0,options:i,metadata:r})}replaceNotebookMetadata(t,i,r){this._edits.push({_type:3,metadata:r,uri:t,edit:{editType:5,metadata:i}})}replaceNotebookCells(t,i,r,s){const n=i.start,o=i.end;(n!==o||r.length>0)&&this._edits.push({_type:5,uri:t,index:n,count:o-n,cells:r,metadata:s})}replaceNotebookCellMetadata(t,i,r,s){this._edits.push({_type:3,metadata:s,uri:t,edit:{editType:3,index:i,metadata:r}})}replace(t,i,r,s){this._edits.push({_type:2,uri:t,edit:new An(i,r),metadata:s})}insert(t,i,r,s){this.replace(t,new Se(i,i),r,s)}delete(t,i,r){this.replace(t,i,"",r)}has(t){return this._edits.some(i=>i._type===2&&i.uri.toString()===t.toString())}set(t,i){if(i)for(const r of i){if(!r)continue;let s,n;Array.isArray(r)?(s=r[0],n=r[1]):s=r,Hf.isNotebookCellEdit(s)?s.newCellMetadata?this.replaceNotebookCellMetadata(t,s.range.start,s.newCellMetadata,n):s.newNotebookMetadata?this.replaceNotebookMetadata(t,s.newNotebookMetadata,n):this.replaceNotebookCells(t,s.range,s.newCells,n):k_.isSnippetTextEdit(s)?this._edits.push({_type:6,uri:t,range:s.range,edit:s.snippet,metadata:n,keepWhitespace:s.keepWhitespace}):this._edits.push({_type:2,uri:t,edit:s,metadata:n})}else{for(let r=0;r<this._edits.length;r++){const s=this._edits[r];switch(s._type){case 2:case 6:case 3:case 5:s.uri.toString()===t.toString()&&(this._edits[r]=void 0);break}}WR(this._edits)}}get(t){const i=[];for(const r of this._edits)r._type===2&&r.uri.toString()===t.toString()&&i.push(r.edit);return i}entries(){const t=new Vt;for(const i of this._edits)if(i._type===2){let r=t.get(i.uri);r||(r=[i.uri,[]],t.set(i.uri,r)),r[1].push(i.edit)}return[...t.values()]}get size(){return this.entries().length}toJSON(){return this.entries()}};Ao=__decorate([ce],Ao);var Ro=To=class{static isSnippetString(t){return t instanceof To?!0:t?typeof t.value=="string":!1}static _escape(t){return t.replace(/\$|}|\\/g,"\\$&")}constructor(t){this._tabstop=1,this.value=t||""}appendText(t){return this.value+=To._escape(t),this}appendTabstop(t=this._tabstop++){return this.value+="$",this.value+=t,this}appendPlaceholder(t,i=this._tabstop++){if(typeof t=="function"){const r=new To;r._tabstop=this._tabstop,t(r),this._tabstop=r._tabstop,t=r.value}else t=To._escape(t);return this.value+="${",this.value+=i,this.value+=":",this.value+=t,this.value+="}",this}appendChoice(t,i=this._tabstop++){const r=t.map(s=>s.replaceAll(/[|\\,]/g,"\\$&")).join(",");return this.value+="${",this.value+=i,this.value+="|",this.value+=r,this.value+="|}",this}appendVariable(t,i){if(typeof i=="function"){const r=new To;r._tabstop=this._tabstop,i(r),this._tabstop=r._tabstop,i=r.value}else typeof i=="string"&&(i=i.replace(/\$|}/g,"\\$&"));return this.value+="${",this.value+=t,i&&(this.value+=":",this.value+=i),this.value+="}",this}};Ro=To=__decorate([ce],Ro);var Lo;(function(e){e[e.Unnecessary=1]="Unnecessary",e[e.Deprecated=2]="Deprecated"})(Lo||(Lo={}));var di;(function(e){e[e.Hint=3]="Hint",e[e.Information=2]="Information",e[e.Warning=1]="Warning",e[e.Error=0]="Error"})(di||(di={}));var nr=b_=class{static isLocation(t){return t instanceof b_?!0:t?Se.isRange(t.range)&&b.isUri(t.uri):!1}constructor(t,i){if(this.uri=t,i)if(Se.isRange(i))this.range=Se.of(i);else if(Te.isPosition(i))this.range=new Se(i,i);else throw new Error("Illegal argument")}toJSON(){return{uri:this.uri,range:this.range}}};nr=b_=__decorate([ce],nr);var iu=class{static is(t){return t?typeof t.message=="string"&&t.location&&Se.isRange(t.location.range)&&b.isUri(t.location.uri):!1}constructor(t,i){this.location=t,this.message=i}static isEqual(t,i){return t===i?!0:!t||!i?!1:t.message===i.message&&t.location.range.isEqual(i.location.range)&&t.location.uri.toString()===i.location.uri.toString()}};iu=__decorate([ce],iu);var Uf=class{constructor(t,i,r=di.Error){if(!Se.isRange(t))throw new TypeError("range must be set");if(!i)throw new TypeError("message must be set");this.range=t,this.message=i,this.severity=r}toJSON(){return{severity:di[this.severity],message:this.message,range:this.range,source:this.source,code:this.code}}static isEqual(t,i){return t===i?!0:!t||!i?!1:t.message===i.message&&t.severity===i.severity&&t.code===i.code&&t.severity===i.severity&&t.source===i.source&&t.range.isEqual(i.range)&&Er(t.tags,i.tags)&&Er(t.relatedInformation,i.relatedInformation,iu.isEqual)}};Uf=__decorate([ce],Uf);var Wf=class{constructor(t,i){if(!t)throw new Error("Illegal argument, contents must be defined");Array.isArray(t)?this.contents=t:this.contents=[t],this.range=i}};Wf=__decorate([ce],Wf);var Bf=class extends Wf{constructor(t,i,r,s){super(t,i),this.canIncreaseVerbosity=r,this.canDecreaseVerbosity=s}};Bf=__decorate([ce],Bf);var I_;(function(e){e[e.Increase=0]="Increase",e[e.Decrease=1]="Decrease"})(I_||(I_={}));var ru;(function(e){e[e.Text=0]="Text",e[e.Read=1]="Read",e[e.Write=2]="Write"})(ru||(ru={}));var Vf=class{constructor(t,i=ru.Text){this.range=t,this.kind=i}toJSON(){return{range:this.range,kind:ru[this.kind]}}};Vf=__decorate([ce],Vf);var zf=class{constructor(t,i){this.uri=t,this.highlights=i}toJSON(){return{uri:this.uri,highlights:this.highlights.map(t=>t.toJSON())}}};zf=__decorate([ce],zf);var at;(function(e){e[e.File=0]="File",e[e.Module=1]="Module",e[e.Namespace=2]="Namespace",e[e.Package=3]="Package",e[e.Class=4]="Class",e[e.Method=5]="Method",e[e.Property=6]="Property",e[e.Field=7]="Field",e[e.Constructor=8]="Constructor",e[e.Enum=9]="Enum",e[e.Interface=10]="Interface",e[e.Function=11]="Function",e[e.Variable=12]="Variable",e[e.Constant=13]="Constant",e[e.String=14]="String",e[e.Number=15]="Number",e[e.Boolean=16]="Boolean",e[e.Array=17]="Array",e[e.Object=18]="Object",e[e.Key=19]="Key",e[e.Null=20]="Null",e[e.EnumMember=21]="EnumMember",e[e.Struct=22]="Struct",e[e.Event=23]="Event",e[e.Operator=24]="Operator",e[e.TypeParameter=25]="TypeParameter"})(at||(at={}));var su;(function(e){e[e.Deprecated=1]="Deprecated"})(su||(su={}));var nu=S_=class{static validate(t){if(!t.name)throw new Error("name must not be falsy")}constructor(t,i,r,s,n){this.name=t,this.kind=i,this.containerName=n,typeof r=="string"&&(this.containerName=r),s instanceof nr?this.location=s:r instanceof Se&&(this.location=new nr(s,r)),S_.validate(this)}toJSON(){return{name:this.name,kind:at[this.kind],location:this.location,containerName:this.containerName}}};nu=S_=__decorate([ce],nu);var ou=Ff=class{static validate(t){if(!t.name)throw new Error("name must not be falsy");if(!t.range.contains(t.selectionRange))throw new Error("selectionRange must be contained in fullRange");t.children?.forEach(Ff.validate)}constructor(t,i,r,s,n){this.name=t,this.detail=i,this.kind=r,this.range=s,this.selectionRange=n,this.children=[],Ff.validate(this)}};ou=Ff=__decorate([ce],ou);var au;(function(e){e[e.Invoke=1]="Invoke",e[e.Automatic=2]="Automatic"})(au||(au={}));var lu=class{constructor(t,i){this.title=t,this.kind=i}};lu=__decorate([ce],lu);var wt=class{static{tu=this}static{this.sep="."}constructor(t){this.value=t}append(t){return new tu(this.value?this.value+tu.sep+t:t)}intersects(t){return this.contains(t)||t.contains(this)}contains(t){return this.value===t.value||t.value.startsWith(this.value+tu.sep)}};wt=tu=__decorate([ce],wt),wt.Empty=new wt(""),wt.QuickFix=wt.Empty.append("quickfix"),wt.Refactor=wt.Empty.append("refactor"),wt.RefactorExtract=wt.Refactor.append("extract"),wt.RefactorInline=wt.Refactor.append("inline"),wt.RefactorMove=wt.Refactor.append("move"),wt.RefactorRewrite=wt.Refactor.append("rewrite"),wt.Source=wt.Empty.append("source"),wt.SourceOrganizeImports=wt.Source.append("organizeImports"),wt.SourceFixAll=wt.Source.append("fixAll"),wt.Notebook=wt.Empty.append("notebook");var cu=class{constructor(t,i){if(this.range=t,this.parent=i,i&&!i.range.contains(this.range))throw new Error("Invalid argument: parent must contain this range")}};cu=__decorate([ce],cu);var P_=class{constructor(e,t,i,r,s,n){this.kind=e,this.name=t,this.detail=i,this.uri=r,this.range=s,this.selectionRange=n}},g4=class{constructor(e,t){this.fromRanges=t,this.from=e}},m4=class{constructor(e,t){this.fromRanges=t,this.to=e}},Xa;(function(e){e[e.Information=0]="Information",e[e.Warning=1]="Warning",e[e.Error=2]="Error"})(Xa||(Xa={}));var qf=class{constructor(t,i){this.range=t,this.command=i}get isResolved(){return!!this.command}};qf=__decorate([ce],qf);var Ti=x_=class{#e;static isMarkdownString(t){return t instanceof x_?!0:t&&t.appendCodeblock&&t.appendMarkdown&&t.appendText&&t.value!==void 0}constructor(t,i=!1){this.#e=new Fa(t,{supportThemeIcons:i})}get value(){return this.#e.value}set value(t){this.#e.value=t}get isTrusted(){return this.#e.isTrusted}set isTrusted(t){this.#e.isTrusted=t}get supportThemeIcons(){return this.#e.supportThemeIcons}set supportThemeIcons(t){this.#e.supportThemeIcons=t}get supportHtml(){return this.#e.supportHtml}set supportHtml(t){this.#e.supportHtml=t}get baseUri(){return this.#e.baseUri}set baseUri(t){this.#e.baseUri=t}appendText(t){return this.#e.appendText(t),this}appendMarkdown(t){return this.#e.appendMarkdown(t),this}appendCodeblock(t,i){return this.#e.appendCodeblock(i??"",t),this}};Ti=x_=__decorate([ce],Ti);var T_=class{constructor(t,i){this.label=t,this.documentation=i}};T_=__decorate([ce],T_);var A_=class{constructor(t,i){this.label=t,this.documentation=i,this.parameters=[]}};A_=__decorate([ce],A_);var R_=class{constructor(){this.activeSignature=0,this.activeParameter=0,this.signatures=[]}};R_=__decorate([ce],R_);var L_;(function(e){e[e.Invoke=1]="Invoke",e[e.TriggerCharacter=2]="TriggerCharacter",e[e.ContentChange=3]="ContentChange"})(L_||(L_={}));var N_;(function(e){e[e.Type=1]="Type",e[e.Parameter=2]="Parameter"})(N_||(N_={}));var jf=class{constructor(t){this.value=t}};jf=__decorate([ce],jf);var Gf=class{constructor(t,i,r){this.position=t,this.label=i,this.kind=r}};Gf=__decorate([ce],Gf);var Ya;(function(e){e[e.Invoke=0]="Invoke",e[e.TriggerCharacter=1]="TriggerCharacter",e[e.TriggerForIncompleteCompletions=2]="TriggerForIncompleteCompletions"})(Ya||(Ya={}));var fe;(function(e){e[e.Text=0]="Text",e[e.Method=1]="Method",e[e.Function=2]="Function",e[e.Constructor=3]="Constructor",e[e.Field=4]="Field",e[e.Variable=5]="Variable",e[e.Class=6]="Class",e[e.Interface=7]="Interface",e[e.Module=8]="Module",e[e.Property=9]="Property",e[e.Unit=10]="Unit",e[e.Value=11]="Value",e[e.Enum=12]="Enum",e[e.Keyword=13]="Keyword",e[e.Snippet=14]="Snippet",e[e.Color=15]="Color",e[e.File=16]="File",e[e.Reference=17]="Reference",e[e.Folder=18]="Folder",e[e.EnumMember=19]="EnumMember",e[e.Constant=20]="Constant",e[e.Struct=21]="Struct",e[e.Event=22]="Event",e[e.Operator=23]="Operator",e[e.TypeParameter=24]="TypeParameter",e[e.User=25]="User",e[e.Issue=26]="Issue"})(fe||(fe={}));var uu;(function(e){e[e.Deprecated=1]="Deprecated"})(uu||(uu={}));var Qf=class{constructor(t,i){this.label=t,this.kind=i}toJSON(){return{label:this.label,kind:this.kind&&fe[this.kind],detail:this.detail,documentation:this.documentation,sortText:this.sortText,filterText:this.filterText,preselect:this.preselect,insertText:this.insertText,textEdit:this.textEdit}}};Qf=__decorate([ce],Qf);var Za=class{constructor(t=[],i=!1){this.items=t,this.isIncomplete=i}};Za=__decorate([ce],Za);var M_=class{constructor(t,i,r){this.insertText=t,this.range=i,this.command=r}};M_=__decorate([ce],M_);var O_=class{constructor(t){this.commands=void 0,this.suppressSuggestions=void 0,this.items=t}};O_=__decorate([ce],O_);var No;(function(e){e[e.Unknown=0]="Unknown",e[e.Word=1]="Word",e[e.Line=2]="Line",e[e.Suggest=3]="Suggest"})(No||(No={}));var el;(function(e){e[e.Accepted=0]="Accepted",e[e.Rejected=1]="Rejected",e[e.Ignored=2]="Ignored"})(el||(el={}));var du;(function(e){e[e.Active=-1]="Active",e[e.Beside=-2]="Beside",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five",e[e.Six=6]="Six",e[e.Seven=7]="Seven",e[e.Eight=8]="Eight",e[e.Nine=9]="Nine"})(du||(du={}));var Rn;(function(e){e[e.Left=1]="Left",e[e.Right=2]="Right"})(Rn||(Rn={}));function jH(e,t){return`${qe.toKey(e)}.${t}`}var $r;(function(e){e[e.Off=0]="Off",e[e.On=1]="On",e[e.Relative=2]="Relative",e[e.Interval=3]="Interval"})($r||($r={}));var tl;(function(e){e[e.Manual=1]="Manual",e[e.AfterDelay=2]="AfterDelay",e[e.FocusOut=3]="FocusOut"})(tl||(tl={}));var Jf;(function(e){e[e.Default=0]="Default",e[e.InCenter=1]="InCenter",e[e.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",e[e.AtTop=3]="AtTop"})(Jf||(Jf={}));var il;(function(e){e[e.Keyboard=1]="Keyboard",e[e.Mouse=2]="Mouse",e[e.Command=3]="Command"})(il||(il={}));var rl;(function(e){e[e.Addition=1]="Addition",e[e.Deletion=2]="Deletion",e[e.Modification=3]="Modification"})(rl||(rl={}));var hu;(function(e){e[e.Undo=1]="Undo",e[e.Redo=2]="Redo"})(hu||(hu={}));var Mo;(function(e){e[e.OpenOpen=0]="OpenOpen",e[e.ClosedClosed=1]="ClosedClosed",e[e.OpenClosed=2]="OpenClosed",e[e.ClosedOpen=3]="ClosedOpen"})(Mo||(Mo={})),function(e){function t(i){switch(i){case"keyboard":return e.Keyboard;case"mouse":return e.Mouse;case"api":case"code.jump":case"code.navigation":return e.Command}}e.fromValue=t}(il||(il={}));var sl;(function(e){e[e.Other=0]="Other",e[e.Comment=1]="Comment",e[e.String=2]="String",e[e.RegEx=3]="RegEx"})(sl||(sl={})),function(e){function t(i){switch(i){case e.Other:return"other";case e.Comment:return"comment";case e.String:return"string";case e.RegEx:return"regex"}return"other"}e.toString=t}(sl||(sl={}));var Kf=class{constructor(t,i){if(i&&!b.isUri(i))throw De("target");if(!Se.isRange(t)||t.isEmpty)throw De("range");this.range=t,this.target=i}};Kf=__decorate([ce],Kf);var nl=class{constructor(t,i,r,s){this.red=t,this.green=i,this.blue=r,this.alpha=s}};nl=__decorate([ce],nl);var Xf=class{constructor(t,i){if(i&&!(i instanceof nl))throw De("color");if(!Se.isRange(t)||t.isEmpty)throw De("range");this.range=t,this.color=i}};Xf=__decorate([ce],Xf);var Yf=class{constructor(t){if(!t||typeof t!="string")throw De("label");this.label=t}};Yf=__decorate([ce],Yf);var v4;(function(e){e[e.RGB=0]="RGB",e[e.HEX=1]="HEX",e[e.HSL=2]="HSL"})(v4||(v4={}));var F_;(function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Information=2]="Information"})(F_||(F_={}));var $_;(function(e){e[e.Unknown=0]="Unknown",e[e.Shutdown=1]="Shutdown",e[e.Process=2]="Process",e[e.User=3]="User",e[e.Extension=4]="Extension"})($_||($_={}));var fu;(function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"})(fu||(fu={}));var H_;(function(e){e[e.Sh=1]="Sh",e[e.Bash=2]="Bash",e[e.Fish=3]="Fish",e[e.Csh=4]="Csh",e[e.Ksh=5]="Ksh",e[e.Zsh=6]="Zsh",e[e.CommandPrompt=7]="CommandPrompt",e[e.GitBash=8]="GitBash",e[e.PowerShell=9]="PowerShell",e[e.Python=10]="Python",e[e.Julia=11]="Julia",e[e.NuShell=12]="NuShell",e[e.Node=13]="Node"})(H_||(H_={}));var GH=class{constructor(e,t,i){if(this.startIndex=e,this.length=t,this.tooltip=i,typeof e!="number"||e<0)throw De("startIndex");if(typeof t!="number"||t<1)throw De("length");if(i!==void 0&&typeof i!="string")throw De("tooltip")}},QH=class{constructor(e){this.uri=e}},JH=class{constructor(e){this.terminalCommand=e}},U_;(function(e){e[e.Panel=1]="Panel",e[e.Editor=2]="Editor"})(U_||(U_={}));var KH=class{constructor(e){if(this.options=e,typeof e!="object")throw De("options")}},W_;(function(e){e[e.File=0]="File",e[e.Folder=1]="Folder",e[e.Method=2]="Method",e[e.Alias=3]="Alias",e[e.Argument=4]="Argument",e[e.Option=5]="Option",e[e.OptionValue=6]="OptionValue",e[e.Flag=7]="Flag"})(W_||(W_={}));var XH=class{constructor(e,t,i,r,s,n,o,a,l){this.label=e,this.icon=t,this.detail=i,this.documentation=r,this.isFile=s,this.isDirectory=n,this.isKeyword=o,this.replacementIndex=a??0,this.replacementLength=l??0}},YH=class{constructor(e,t){this.items=e??[],this.resourceRequestConfig=t}},B_;(function(e){e[e.Always=1]="Always",e[e.Silent=2]="Silent",e[e.Never=3]="Never"})(B_||(B_={}));var V_;(function(e){e.Changed="changed",e.ProcessStarted="processStarted",e.ProcessEnded="processEnded",e.Terminated="terminated",e.Start="start",e.AcquiredInput="acquiredInput",e.DependsOnStarted="dependsOnStarted",e.Active="active",e.Inactive="inactive",e.End="end",e.ProblemMatcherStarted="problemMatcherStarted",e.ProblemMatcherEnded="problemMatcherEnded",e.ProblemMatcherFoundErrors="problemMatcherFoundErrors"})(V_||(V_={}));var z_;(function(e){e[e.Shared=1]="Shared",e[e.Dedicated=2]="Dedicated",e[e.New=3]="New"})(z_||(z_={}));var pu=class{static{ns=this}static{this.Clean=new ns("clean","Clean")}static{this.Build=new ns("build","Build")}static{this.Rebuild=new ns("rebuild","Rebuild")}static{this.Test=new ns("test","Test")}static from(t){switch(t){case"clean":return ns.Clean;case"build":return ns.Build;case"rebuild":return ns.Rebuild;case"test":return ns.Test;default:return}}constructor(t,i){if(this.label=i,typeof t!="string"||typeof i!="string")throw De("name");this._id=t}get id(){return this._id}};pu=ns=__decorate([ce],pu);function _4(e){let t="";for(let i=0;i<e.length;i++)t+=e[i].replace(/,/g,",,")+",";return t}var ol=class{constructor(t,i,r){if(typeof t!="string")throw De("process");this._args=[],this._process=t,i!==void 0&&(Array.isArray(i)?(this._args=i,this._options=r):this._options=i)}get process(){return this._process}set process(t){if(typeof t!="string")throw De("process");this._process=t}get args(){return this._args}set args(t){Array.isArray(t)||(t=[]),this._args=t}get options(){return this._options}set options(t){this._options=t}computeId(){const t=[];if(t.push("process"),this._process!==void 0&&t.push(this._process),this._args&&this._args.length>0)for(const i of this._args)t.push(i);return _4(t)}};ol=__decorate([ce],ol);var Oo=class{constructor(t,i,r){if(this._args=[],Array.isArray(i)){if(!t)throw De("command can't be undefined or null");if(typeof t!="string"&&typeof t.value!="string")throw De("command");this._command=t,i&&(this._args=i),this._options=r}else{if(typeof t!="string")throw De("commandLine");this._commandLine=t,this._options=i}}get commandLine(){return this._commandLine}set commandLine(t){if(typeof t!="string")throw De("commandLine");this._commandLine=t}get command(){return this._command?this._command:""}set command(t){if(typeof t!="string"&&typeof t.value!="string")throw De("command");this._command=t}get args(){return this._args}set args(t){this._args=t||[]}get options(){return this._options}set options(t){this._options=t}computeId(){const t=[];if(t.push("shell"),this._commandLine!==void 0&&t.push(this._commandLine),this._command!==void 0&&t.push(typeof this._command=="string"?this._command:this._command.value),this._args&&this._args.length>0)for(const i of this._args)t.push(typeof i=="string"?i:i.value);return _4(t)}};Oo=__decorate([ce],Oo);var q_;(function(e){e[e.Escape=1]="Escape",e[e.Strong=2]="Strong",e[e.Weak=3]="Weak"})(q_||(q_={}));var Ln;(function(e){e[e.Global=1]="Global",e[e.Workspace=2]="Workspace"})(Ln||(Ln={}));var j_=class{constructor(e){this._callback=e}computeId(){return"customExecution"+mt()}set callback(e){this._callback=e}get callback(){return this._callback}},Zf=class{static{os=this}static{this.ExtensionCallbackType="customExecution"}static{this.ProcessType="process"}static{this.ShellType="shell"}static{this.EmptyType="$empty"}constructor(t,i,r,s,n,o){this.__deprecated=!1,this._definition=this.definition=t;let a;typeof i=="string"?(this._name=this.name=i,this._source=this.source=r,this.execution=s,a=n,this.__deprecated=!0):i===Ln.Global||i===Ln.Workspace?(this.target=i,this._name=this.name=r,this._source=this.source=s,this.execution=n,a=o):(this.target=i,this._name=this.name=r,this._source=this.source=s,this.execution=n,a=o),typeof a=="string"?(this._problemMatchers=[a],this._hasDefinedMatchers=!0):Array.isArray(a)?(this._problemMatchers=a,this._hasDefinedMatchers=!0):(this._problemMatchers=[],this._hasDefinedMatchers=!1),this._isBackground=!1,this._presentationOptions=Object.create(null),this._runOptions=Object.create(null)}get _id(){return this.__id}set _id(t){this.__id=t}get _deprecated(){return this.__deprecated}clear(){this.__id!==void 0&&(this.__id=void 0,this._scope=void 0,this.computeDefinitionBasedOnExecution())}computeDefinitionBasedOnExecution(){this._execution instanceof ol?this._definition={type:os.ProcessType,id:this._execution.computeId()}:this._execution instanceof Oo?this._definition={type:os.ShellType,id:this._execution.computeId()}:this._execution instanceof j_?this._definition={type:os.ExtensionCallbackType,id:this._execution.computeId()}:this._definition={type:os.EmptyType,id:mt()}}get definition(){return this._definition}set definition(t){if(t==null)throw De("Kind can't be undefined or null");this.clear(),this._definition=t}get scope(){return this._scope}set target(t){this.clear(),this._scope=t}get name(){return this._name}set name(t){if(typeof t!="string")throw De("name");this.clear(),this._name=t}get execution(){return this._execution}set execution(t){t===null&&(t=void 0),this.clear(),this._execution=t;const i=this._definition.type;(os.EmptyType===i||os.ProcessType===i||os.ShellType===i||os.ExtensionCallbackType===i)&&this.computeDefinitionBasedOnExecution()}get problemMatchers(){return this._problemMatchers}set problemMatchers(t){if(Array.isArray(t))this.clear(),this._problemMatchers=t,this._hasDefinedMatchers=!0;else{this.clear(),this._problemMatchers=[],this._hasDefinedMatchers=!1;return}}get hasDefinedMatchers(){return this._hasDefinedMatchers}get isBackground(){return this._isBackground}set isBackground(t){t!==!0&&t!==!1&&(t=!1),this.clear(),this._isBackground=t}get source(){return this._source}set source(t){if(typeof t!="string"||t.length===0)throw De("source must be a string of length > 0");this.clear(),this._source=t}get group(){return this._group}set group(t){t===null&&(t=void 0),this.clear(),this._group=t}get detail(){return this._detail}set detail(t){t===null&&(t=void 0),this._detail=t}get presentationOptions(){return this._presentationOptions}set presentationOptions(t){t==null&&(t=Object.create(null)),this.clear(),this._presentationOptions=t}get runOptions(){return this._runOptions}set runOptions(t){t==null&&(t=Object.create(null)),this.clear(),this._runOptions=t}};Zf=os=__decorate([ce],Zf);var Fo;(function(e){e[e.SourceControl=1]="SourceControl",e[e.Window=10]="Window",e[e.Notification=15]="Notification"})(Fo||(Fo={}));var G_;(function(e){function t(i){const r=i;return cr(r.value)?r.tooltip&&!Oe(r.tooltip)?(console.log("INVALID view badge, invalid tooltip",r.tooltip),!1):!0:(console.log("INVALID view badge, invalid value",r.value),!1)}e.isViewBadge=t})(G_||(G_={}));var ep=E_=class{static isTreeItem(t,i){const r=t;if(r.checkboxState!==void 0){const s=cr(r.checkboxState)?r.checkboxState:It(r.checkboxState)&&cr(r.checkboxState.state)?r.checkboxState.state:void 0,n=!cr(r.checkboxState)&&It(r.checkboxState)?r.checkboxState.tooltip:void 0;if(s===void 0||s!==as.Checked&&s!==as.Unchecked||n!==void 0&&!Oe(n))return console.log("INVALID tree item, invalid checkboxState",r.checkboxState),!1}if(t instanceof E_)return!0;if(r.label!==void 0&&!Oe(r.label)&&!r.label?.label)return console.log("INVALID tree item, invalid label",r.label),!1;if(r.id!==void 0&&!Oe(r.id))return console.log("INVALID tree item, invalid id",r.id),!1;if(r.iconPath!==void 0&&!Oe(r.iconPath)&&!b.isUri(r.iconPath)&&(!r.iconPath||!Oe(r.iconPath.id))){const s=r.iconPath;if(!s||!Oe(s.light)&&!b.isUri(s.light)&&!Oe(s.dark)&&!b.isUri(s.dark))return console.log("INVALID tree item, invalid iconPath",r.iconPath),!1}return r.description!==void 0&&!Oe(r.description)&&typeof r.description!="boolean"?(console.log("INVALID tree item, invalid description",r.description),!1):r.resourceUri!==void 0&&!b.isUri(r.resourceUri)?(console.log("INVALID tree item, invalid resourceUri",r.resourceUri),!1):r.tooltip!==void 0&&!Oe(r.tooltip)&&!(r.tooltip instanceof Ti)?(console.log("INVALID tree item, invalid tooltip",r.tooltip),!1):r.command!==void 0&&!r.command.command?(console.log("INVALID tree item, invalid command",r.command),!1):r.collapsibleState!==void 0&&r.collapsibleState<$o.None&&r.collapsibleState>$o.Expanded?(console.log("INVALID tree item, invalid collapsibleState",r.collapsibleState),!1):r.contextValue!==void 0&&!Oe(r.contextValue)?(console.log("INVALID tree item, invalid contextValue",r.contextValue),!1):r.accessibilityInformation!==void 0&&!r.accessibilityInformation?.label?(console.log("INVALID tree item, invalid accessibilityInformation",r.accessibilityInformation),!1):!0}constructor(t,i=$o.None){this.collapsibleState=i,b.isUri(t)?this.resourceUri=t:this.label=t}};ep=E_=__decorate([ce],ep);var $o;(function(e){e[e.None=0]="None",e[e.Collapsed=1]="Collapsed",e[e.Expanded=2]="Expanded"})($o||($o={}));var as;(function(e){e[e.Unchecked=0]="Unchecked",e[e.Checked=1]="Checked"})(as||(as={}));var tp=class{async asString(){return typeof this.value=="string"?this.value:JSON.stringify(this.value)}asFile(){}constructor(t){this.value=t}};tp=__decorate([ce],tp);var ip=class extends tp{},ZH=class extends ip{#e;constructor(e){super(""),this.#e=e}asFile(){return this.#e}},eU=class{constructor(e,t,i,r){this.name=e,this.uri=t,this._itemId=i,this._getData=r}data(){return this._getData()}},al=class{#e=new Map;constructor(t){for(const[i,r]of t??[]){const s=this.#e.get(this.#t(i));s?s.push(r):this.#e.set(this.#t(i),[r])}}get(t){return this.#e.get(this.#t(t))?.[0]}set(t,i){this.#e.set(this.#t(t),[i])}forEach(t,i){for(const[r,s]of this.#e)for(const n of s)t.call(i,n,r,this)}*[Symbol.iterator](){for(const[t,i]of this.#e)for(const r of i)yield[t,r]}#t(t){return t.toLowerCase()}};al=__decorate([ce],al);var Q_=class{constructor(t,i,r){this.insertText=t,this.title=i,this.kind=r}};Q_=__decorate([ce],Q_);var J_;(function(e){e[e.Automatic=0]="Automatic",e[e.PasteAs=1]="PasteAs"})(J_||(J_={}));var Nn=class Km{static{this.sep="."}constructor(t){this.value=t}append(...t){return new Km((this.value?[this.value,...t]:t).join(Km.sep))}intersects(t){return this.contains(t)||t.contains(this)}contains(t){return this.value===t.value||t.value.startsWith(this.value+Km.sep)}};Nn.Empty=new Nn(""),Nn.Text=new Nn("text"),Nn.TextUpdateImports=Nn.Text.append("updateImports");var tU=class{constructor(e,t,i){this.title=t,this.insertText=e,this.kind=i}},pi=class{constructor(t,i){this.id=t,this.color=i}static isThemeIcon(t){return typeof t.id!="string"?(console.log("INVALID ThemeIcon, invalid id",t.id),!1):!0}};pi=__decorate([ce],pi),pi.File=new pi("file"),pi.Folder=new pi("folder");var gu=class{constructor(t){this.id=t}};gu=__decorate([ce],gu);var ll;(function(e){e[e.Global=1]="Global",e[e.Workspace=2]="Workspace",e[e.WorkspaceFolder=3]="WorkspaceFolder"})(ll||(ll={}));var cl=class{get base(){return this._base}set base(t){this._base=t,this._baseUri=b.file(t)}get baseUri(){return this._baseUri}set baseUri(t){this._baseUri=t,this._base=t.fsPath}constructor(t,i){if(typeof t!="string"&&(!t||!b.isUri(t)&&!b.isUri(t.uri)))throw De("base");if(typeof i!="string")throw De("pattern");typeof t=="string"?this.baseUri=b.file(t):b.isUri(t)?this.baseUri=t:this.baseUri=t.uri,this.pattern=i}toJSON(){return{pattern:this.pattern,base:this.base,baseUri:this.baseUri.toJSON()}}};cl=__decorate([ce],cl);var w4=new WeakMap;function iU(e,t){w4.set(e,t)}var ul=class{constructor(t,i,r,s,n){this.enabled=typeof t=="boolean"?t:!0,typeof i=="string"&&(this.condition=i),typeof r=="string"&&(this.hitCondition=r),typeof s=="string"&&(this.logMessage=s),typeof n=="string"&&(this.mode=n)}get id(){return this._id||(this._id=w4.get(this)??mt()),this._id}};ul=__decorate([ce],ul);var Ho=class extends ul{constructor(t,i,r,s,n,o){if(super(i,r,s,n,o),t===null)throw De("location");this.location=t}};Ho=__decorate([ce],Ho);var Uo=class extends ul{constructor(t,i,r,s,n,o){super(i,r,s,n,o),this.functionName=t}};Uo=__decorate([ce],Uo);var rp=class extends ul{constructor(t,i,r,s,n,o,a,l){if(super(s,n,o,a,l),!i)throw De("dataId");this.label=t,this.dataId=i,this.canPersist=r}};rp=__decorate([ce],rp);var dl=class{constructor(t,i,r){this.command=t,this.args=i||[],this.options=r}};dl=__decorate([ce],dl);var hl=class{constructor(t,i){this.port=t,this.host=i}};hl=__decorate([ce],hl);var mu=class{constructor(t){this.path=t}};mu=__decorate([ce],mu);var vu=class{constructor(t){this.implementation=t}};vu=__decorate([ce],vu);var y4=class{constructor(e,t,i){this.session=e,this.threadId=t,this.frameId=i}},b4=class{constructor(e,t){this.session=e,this.threadId=t}},sp=class{constructor(t,i){this.range=t,this.expression=i}};sp=__decorate([ce],sp);var _u;(function(e){e[e.Invoke=0]="Invoke",e[e.Automatic=1]="Automatic"})(_u||(_u={}));var np=class{constructor(t,i){this.range=t,this.text=i}};np=__decorate([ce],np);var op=class{constructor(t,i,r=!0){this.range=t,this.variableName=i,this.caseSensitiveLookup=r}};op=__decorate([ce],op);var ap=class{constructor(t,i){this.range=t,this.expression=i}};ap=__decorate([ce],ap);var K_=class{constructor(t,i){this.frameId=t,this.stoppedLocation=i}};K_=__decorate([ce],K_);var X_;(function(e){e[e.AIGenerated=1]="AIGenerated"})(X_||(X_={}));var wu;(function(e){e[e.Invoke=0]="Invoke",e[e.Automatic=1]="Automatic"})(wu||(wu={}));var rU=class{constructor(e,t){this.newSymbolName=e,this.tags=t}},fl;(function(e){e[e.Changed=1]="Changed",e[e.Created=2]="Created",e[e.Deleted=3]="Deleted"})(fl||(fl={}));var qt=Pi=class extends Error{static FileExists(t){return new Pi(t,de.FileExists,Pi.FileExists)}static FileNotFound(t){return new Pi(t,de.FileNotFound,Pi.FileNotFound)}static FileNotADirectory(t){return new Pi(t,de.FileNotADirectory,Pi.FileNotADirectory)}static FileIsADirectory(t){return new Pi(t,de.FileIsADirectory,Pi.FileIsADirectory)}static NoPermissions(t){return new Pi(t,de.NoPermissions,Pi.NoPermissions)}static Unavailable(t){return new Pi(t,de.Unavailable,Pi.Unavailable)}constructor(t,i=de.Unknown,r){super(b.isUri(t)?t.toString(!0):t),this.code=r?.name??"Unknown",kk(this,i),Object.setPrototypeOf(this,Pi.prototype),typeof Error.captureStackTrace=="function"&&typeof r=="function"&&Error.captureStackTrace(this,r)}};qt=Pi=__decorate([ce],qt);var Y_=class{constructor(t,i,r){this.start=t,this.end=i,this.kind=r}};Y_=__decorate([ce],Y_);var Vs;(function(e){e[e.Comment=1]="Comment",e[e.Imports=2]="Imports",e[e.Region=3]="Region"})(Vs||(Vs={}));var yu;(function(e){e[e.Collapsed=0]="Collapsed",e[e.Expanded=1]="Expanded"})(yu||(yu={}));var Z_;(function(e){e[e.Editing=0]="Editing",e[e.Preview=1]="Preview"})(Z_||(Z_={}));var e0;(function(e){e[e.Published=0]="Published",e[e.Draft=1]="Draft"})(e0||(e0={}));var bu;(function(e){e[e.Unresolved=0]="Unresolved",e[e.Resolved=1]="Resolved"})(bu||(bu={}));var Su;(function(e){e[e.Current=0]="Current",e[e.Outdated=1]="Outdated"})(Su||(Su={}));var xu;(function(e){e[e.Reply=1]="Reply",e[e.Comment=2]="Comment"})(xu||(xu={}));var t0=class{constructor(e,t=[]){this.tokenTypes=e,this.tokenModifiers=t}};function sU(e){return typeof e>"u"||XR(e)}var nU=class h8{constructor(t){if(this._prevLine=0,this._prevChar=0,this._dataIsSortedAndDeltaEncoded=!0,this._data=[],this._dataLen=0,this._tokenTypeStrToInt=new Map,this._tokenModifierStrToInt=new Map,this._hasLegend=!1,t){this._hasLegend=!0;for(let i=0,r=t.tokenTypes.length;i<r;i++)this._tokenTypeStrToInt.set(t.tokenTypes[i],i);for(let i=0,r=t.tokenModifiers.length;i<r;i++)this._tokenModifierStrToInt.set(t.tokenModifiers[i],i)}}push(t,i,r,s,n){if(typeof t=="number"&&typeof i=="number"&&typeof r=="number"&&typeof s=="number"&&(typeof n=="number"||typeof n>"u"))return typeof n>"u"&&(n=0),this._pushEncoded(t,i,r,s,n);if(Se.isRange(t)&&typeof i=="string"&&sU(r))return this._push(t,i,r);throw De()}_push(t,i,r){if(!this._hasLegend)throw new Error("Legend must be provided in constructor");if(t.start.line!==t.end.line)throw new Error("`range` cannot span multiple lines");if(!this._tokenTypeStrToInt.has(i))throw new Error("`tokenType` is not in the provided legend");const s=t.start.line,n=t.start.character,o=t.end.character-t.start.character,a=this._tokenTypeStrToInt.get(i);let l=0;if(r)for(const c of r){if(!this._tokenModifierStrToInt.has(c))throw new Error("`tokenModifier` is not in the provided legend");const u=this._tokenModifierStrToInt.get(c);l|=1<<u>>>0}this._pushEncoded(s,n,o,a,l)}_pushEncoded(t,i,r,s,n){if(this._dataIsSortedAndDeltaEncoded&&(t<this._prevLine||t===this._prevLine&&i<this._prevChar)){this._dataIsSortedAndDeltaEncoded=!1;const l=this._data.length/5|0;let c=0,u=0;for(let d=0;d<l;d++){let f=this._data[5*d],p=this._data[5*d+1];f===0?(f=c,p+=u):f+=c,this._data[5*d]=f,this._data[5*d+1]=p,c=f,u=p}}let o=t,a=i;this._dataIsSortedAndDeltaEncoded&&this._dataLen>0&&(o-=this._prevLine,o===0&&(a-=this._prevChar)),this._data[this._dataLen++]=o,this._data[this._dataLen++]=a,this._data[this._dataLen++]=r,this._data[this._dataLen++]=s,this._data[this._dataLen++]=n,this._prevLine=t,this._prevChar=i}static _sortAndDeltaEncode(t){const i=[],r=t.length/5|0;for(let a=0;a<r;a++)i[a]=a;i.sort((a,l)=>{const c=t[5*a],u=t[5*l];if(c===u){const d=t[5*a+1],f=t[5*l+1];return d-f}return c-u});const s=new Uint32Array(t.length);let n=0,o=0;for(let a=0;a<r;a++){const l=5*i[a],c=t[l+0],u=t[l+1],d=t[l+2],f=t[l+3],p=t[l+4],g=c-n,v=g===0?u-o:u,y=5*a;s[y+0]=g,s[y+1]=v,s[y+2]=d,s[y+3]=f,s[y+4]=p,n=c,o=u}return s}build(t){return this._dataIsSortedAndDeltaEncoded?new pl(new Uint32Array(this._data),t):new pl(h8._sortAndDeltaEncode(this._data),t)}},pl=class{constructor(e,t){this.resultId=t,this.data=e}},S4=class{constructor(e,t,i){this.start=e,this.deleteCount=t,this.data=i}},lp=class{constructor(e,t){this.resultId=t,this.edits=e}},cp;(function(e){e[e.Separate=0]="Separate",e[e.MergeWithParent=1]="MergeWithParent"})(cp||(cp={}));var oU=class{constructor(e){this.name=e}},i0;(function(e){e[e.Title=1]="Title",e[e.Inline=2]="Inline"})(i0||(i0={}));var Eu=class{static{this.Back={iconPath:new pi("arrow-left")}}constructor(){}};Eu=__decorate([ce],Eu);var Cu;(function(e){e[e.Separator=-1]="Separator",e[e.Default=0]="Default"})(Cu||(Cu={}));var gl;(function(e){e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error"})(gl||(gl={}));var Wo;(function(e){e[e.UI=1]="UI",e[e.Workspace=2]="Workspace"})(Wo||(Wo={}));var r0=class{static validate(e){if(typeof e.badge=="string"){let t=qx(e.badge,0);if(t<e.badge.length&&(t+=qx(e.badge,t)),e.badge.length>t)throw new Error("The 'badge'-property must be undefined or a short character")}else if(e.badge&&!pi.isThemeIcon(e.badge))throw new Error("The 'badge'-property is not a valid ThemeIcon");if(!e.color&&!e.badge&&!e.tooltip)throw new Error("The decoration is empty");return!0}constructor(e,t,i){this.badge=e,this.tooltip=t,this.color=i}},up=class{constructor(t){this.kind=t}};up=__decorate([ce],up);var Mn;(function(e){e[e.Light=1]="Light",e[e.Dark=2]="Dark",e[e.HighContrast=3]="HighContrast",e[e.HighContrastLight=4]="HighContrastLight"})(Mn||(Mn={}));var zs=class IS{static isNotebookRange(t){return t instanceof IS?!0:t?typeof t.start=="number"&&typeof t.end=="number":!1}get start(){return this._start}get end(){return this._end}get isEmpty(){return this._start===this._end}constructor(t,i){if(t<0)throw De("start must be positive");if(i<0)throw De("end must be positive");t<=i?(this._start=t,this._end=i):(this._start=i,this._end=t)}with(t){let i=this._start,r=this._end;return t.start!==void 0&&(i=t.start),t.end!==void 0&&(r=t.end),i===this._start&&r===this._end?this:new IS(i,r)}},dp=class PS{static validate(t){if(typeof t.kind!="number")throw new Error("NotebookCellData MUST have 'kind' property");if(typeof t.value!="string")throw new Error("NotebookCellData MUST have 'value' property");if(typeof t.languageId!="string")throw new Error("NotebookCellData MUST have 'languageId' property")}static isNotebookCellDataArray(t){return Array.isArray(t)&&t.every(i=>PS.isNotebookCellData(i))}static isNotebookCellData(t){return!0}constructor(t,i,r,s,n,o,a){this.kind=t,this.value=i,this.languageId=r,this.mime=s,this.outputs=n??[],this.metadata=o,this.executionSummary=a,PS.validate(this)}},x4=class{constructor(e){this.cells=e}},E4=class an{static isNotebookCellOutputItem(t){return t instanceof an?!0:t?typeof t.mime=="string"&&t.data instanceof Uint8Array:!1}static error(t){const i={name:t.name,message:t.message,stack:t.stack};return an.json(i,"application/vnd.code.notebook.error")}static stdout(t){return an.text(t,"application/vnd.code.notebook.stdout")}static stderr(t){return an.text(t,"application/vnd.code.notebook.stderr")}static bytes(t,i="application/octet-stream"){return new an(t,i)}static#e=new TextEncoder;static text(t,i=Ms.text){const r=an.#e.encode(String(t));return new an(r,i)}static json(t,i="text/x-json"){const r=JSON.stringify(t,void 0,"	");return an.text(r,i)}constructor(t,i){this.data=t,this.mime=i;const r=ek(i,!0);if(!r)throw new Error(`INVALID mime type: ${i}. Must be in the format "type/subtype[;optionalparameter]"`);this.mime=r}},hp=class TS{static isNotebookCellOutput(t){return t instanceof TS?!0:!t||typeof t!="object"?!1:typeof t.id=="string"&&Array.isArray(t.items)}static ensureUniqueMimeTypes(t,i=!1){const r=new Set,s=new Set;for(let n=0;n<t.length;n++){const o=t[n],a=ek(o.mime);if(!r.has(a)||LI(a)){r.add(a);continue}s.add(n),i&&console.warn(`DUPLICATED mime type '${o.mime}' will be dropped`)}return s.size===0?t:t.filter((n,o)=>!s.has(o))}constructor(t,i,r){this.items=TS.ensureUniqueMimeTypes(t,!0),typeof i=="string"?(this.id=i,this.metadata=r):(this.id=mt(),this.metadata=i??r)}},aU=class{constructor(e,t,i){this.label=e,this.uri=t,this.position=i}},Bo;(function(e){e[e.Markup=1]="Markup",e[e.Code=2]="Code"})(Bo||(Bo={}));var ml;(function(e){e[e.Idle=1]="Idle",e[e.Pending=2]="Pending",e[e.Executing=3]="Executing"})(ml||(ml={}));var fp;(function(e){e[e.Left=1]="Left",e[e.Right=2]="Right"})(fp||(fp={}));var pp;(function(e){e[e.Default=0]="Default",e[e.InCenter=1]="InCenter",e[e.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",e[e.AtTop=3]="AtTop"})(pp||(pp={}));var lU=class{constructor(e,t){this.text=e,this.alignment=t}},s0;(function(e){e[e.Default=1]="Default",e[e.Preferred=2]="Preferred"})(s0||(s0={}));var gp;(function(e){e[e.Default=1]="Default",e[e.Preferred=2]="Preferred",e[e.Hidden=-1]="Hidden"})(gp||(gp={}));var C4=class{constructor(e,t=[]){this.uri=e,this.provides=er(t)}},cU=class{constructor(e){this.label=e}},Du;(function(e){e[e.Named=1]="Named",e[e.Indexed=2]="Indexed"})(Du||(Du={}));var n0=class{constructor(t,i){this.label=t,this.timestamp=i}};n0=__decorate([ce],n0);var vl;(function(e){e[e.Production=1]="Production",e[e.Development=2]="Development",e[e.Test=3]="Test"})(vl||(vl={}));var mp;(function(e){e[e.Node=1]="Node",e[e.Webworker=2]="Webworker"})(mp||(mp={}));var On;(function(e){e[e.Other=0]="Other",e[e.Comment=1]="Comment",e[e.String=2]="String",e[e.RegEx=3]="RegEx"})(On||(On={}));var uU=class{constructor(e,t){this.ranges=e,this.wordPattern=t}},dU=class{constructor(e){this._autoForwardAction=e}get autoForwardAction(){return this._autoForwardAction}},o0;(function(e){e[e.Queued=1]="Queued",e[e.Running=2]="Running",e[e.Passed=3]="Passed",e[e.Failed=4]="Failed",e[e.Skipped=5]="Skipped",e[e.Errored=6]="Errored"})(o0||(o0={}));var _l;(function(e){e[e.Run=1]="Run",e[e.Debug=2]="Debug",e[e.Coverage=3]="Coverage"})(_l||(_l={}));var D4=class{constructor(e,t,i){this.controllerId=e,this.profileId=t,this.kind=i}},vp=class{constructor(t=void 0,i=void 0,r=void 0,s=!1,n=!0){this.include=t,this.exclude=i,this.profile=r,this.continuous=s,this.preserveFocus=n}};vp=__decorate([ce],vp);var _p=C_=class{static diff(t,i,r){const s=new C_(t);return s.expectedOutput=i,s.actualOutput=r,s}constructor(t){this.message=t}};_p=C_=__decorate([ce],_p);var ku=class{constructor(t){this.id=t}};ku=__decorate([ce],ku);var hU=class{constructor(e,t,i){this.label=e,this.uri=t,this.position=i}},wp=class{constructor(e,t){this.covered=e,this.total=t,yp(this)}};function yp(e){if(e){if(e.covered>e.total)throw new Error(`The total number of covered items (${e.covered}) cannot be greater than the total (${e.total})`);if(e.total<0)throw new Error(`The number of covered items (${e.total}) cannot be negative`)}}var bp=class f8{static fromDetails(t,i){const r=new wp(0,0),s=new wp(0,0),n=new wp(0,0);for(const a of i)if("branches"in a){r.total+=1,r.covered+=a.executed?1:0;for(const l of a.branches)s.total+=1,s.covered+=l.executed?1:0}else n.total+=1,n.covered+=a.executed?1:0;const o=new f8(t,r,s.total>0?s:void 0,n.total>0?n:void 0);return o.detailedCoverage=i,o}constructor(t,i,r,s,n=[]){this.uri=t,this.statementCoverage=i,this.branchCoverage=r,this.declarationCoverage=s,this.includesTests=n}},k4=class{get executionCount(){return+this.executed}set executionCount(e){this.executed=e}constructor(e,t,i=[]){this.executed=e,this.location=t,this.branches=i}},I4=class{get executionCount(){return+this.executed}set executionCount(e){this.executed=e}constructor(e,t,i){this.executed=e,this.location=t,this.label=i}},P4=class{get executionCount(){return+this.executed}set executionCount(e){this.executed=e}constructor(e,t,i){this.name=e,this.executed=t,this.location=i}},a0;(function(e){e[e.None=0]="None",e[e.Option=1]="Option",e[e.Default=2]="Default",e[e.Preferred=3]="Preferred"})(a0||(a0={}));var l0;(function(e){e[e.Untrusted=0]="Untrusted",e[e.Trusted=1]="Trusted",e[e.Unspecified=2]="Unspecified"})(l0||(l0={}));var c0;(function(e){e[e.Notify=1]="Notify",e[e.OpenBrowser=2]="OpenBrowser",e[e.OpenPreview=3]="OpenPreview",e[e.Silent=4]="Silent",e[e.Ignore=5]="Ignore",e[e.OpenBrowserOnce=6]="OpenBrowserOnce"})(c0||(c0={}));var u0=class{constructor(e,t,i,r,s,n){this.kind=e,this.name=t,this.detail=i,this.uri=r,this.range=s,this.selectionRange=n}},d0=class{constructor(e){this.uri=e}},Sp=class{constructor(e,t){this.original=e,this.modified=t}},T4=class{constructor(e,t,i,r){this.base=e,this.input1=t,this.input2=i,this.result=r}},h0=class{constructor(e,t){this.uri=e,this.viewType=t}},A4=class{constructor(e){this.viewType=e}},f0=class{constructor(e,t){this.uri=e,this.notebookType=t}},p0=class{constructor(e,t,i){this.original=e,this.modified=t,this.notebookType=i}},R4=class{constructor(){}},L4=class{constructor(e,t){this.uri=e,this.inputBoxUri=t}},N4=class{constructor(){}},M4=class{constructor(e){this.textDiffs=e}},g0;(function(e){e[e.Down=0]="Down",e[e.Up=1]="Up"})(g0||(g0={}));var m0;(function(e){e[e.Action=1]="Action",e[e.Toolbar=2]="Toolbar"})(m0||(m0={}));var v0;(function(e){e[e.Short=1]="Short",e[e.Medium=2]="Medium",e[e.Full=3]="Full"})(v0||(v0={}));var fU=class{constructor(e,t,i){this.id=e,this.label=t,this.values=i}},Vo;(function(e){e[e.Accepted=1]="Accepted",e[e.Rejected=2]="Rejected",e[e.Saved=3]="Saved"})(Vo||(Vo={}));var _0;(function(e){e[e.Keep=1]="Keep",e[e.Undo=2]="Undo",e[e.UserModification=3]="UserModification"})(_0||(_0={}));var w0;(function(e){e[e.Unhelpful=0]="Unhelpful",e[e.Helpful=1]="Helpful",e[e.Undone=2]="Undone",e[e.Accepted=3]="Accepted",e[e.Bug=4]="Bug"})(w0||(w0={}));var Iu;(function(e){e[e.Unhelpful=0]="Unhelpful",e[e.Helpful=1]="Helpful"})(Iu||(Iu={}));var xp=class{constructor(e){if(typeof e!="string"&&e.isTrusted===!0)throw new Error("The boolean form of MarkdownString.isTrusted is NOT supported for chat participants.");this.value=typeof e=="string"?new Ti(e):e}},Pu=class{constructor(e,t){if(typeof e!="string"&&e.isTrusted===!0)throw new Error("The boolean form of MarkdownString.isTrusted is NOT supported for chat participants.");this.value=typeof e=="string"?new Ti(e):e,this.vulnerabilities=t}},Ep=class{constructor(e,t,i,r){this.title=e,this.message=t,this.data=i,this.buttons=r}},Cp=class{constructor(e,t){this.value=e,this.baseUri=t}},Tu=class{constructor(e,t){this.value=e,this.value2=e,this.title=t}},y0=class{constructor(e){this.value=e}},Dp=class{constructor(e,t){this.value=e,this.task=t}},Au=class{constructor(e){if(typeof e!="string"&&e.isTrusted===!0)throw new Error("The boolean form of MarkdownString.isTrusted is NOT supported for chat participants.");this.value=typeof e=="string"?new Ti(e):e}},kp=class{constructor(e){this.value=e}},zo=class{constructor(e,t,i){this.value=e,this.iconPath=t,this.options=i}},Ip=class{constructor(e,t){this.value=e,this.isEdit=t}},Pp=class{constructor(e,t,i){this.value=e,this.license=t,this.snippet=i}},Tp=class{constructor(e,t){this.uri=e,this.range=t}},b0=class{constructor(e){this.extensions=e}},Ru=class{constructor(e,t){this.uri=e,t===!0?(this.isDone=!0,this.edits=[]):this.edits=Array.isArray(t)?t:[t]}},Ap=class{constructor(e,t){this.uri=e,t===!0?(this.isDone=!0,this.edits=[]):this.edits=Array.isArray(t)?t:[t]}},S0=class{constructor(e,t,i,r,s,n){this.prompt=e,this.command=t,this.references=i,this.participant=r,this.toolReferences=s,this.editedFileEvents=n}},O4=class{constructor(e,t,i,r){this.response=e,this.result=t,this.participant=i,this.command=r}},Hr;(function(e){e[e.Panel=1]="Panel",e[e.Terminal=2]="Terminal",e[e.Notebook=3]="Notebook",e[e.Editor=4]="Editor"})(Hr||(Hr={}));var x0;(function(e){e[e.Complete=1]="Complete",e[e.Partial=2]="Partial",e[e.Omitted=3]="Omitted"})(x0||(x0={}));var F4=class{constructor(e,t,i){this.document=e,this.selection=t,this.wholeRange=i}},$4=class{constructor(e){this.cell=e}},H4=class{constructor(e,t,i){this.mimeType=e,this.data=t,this.reference=i}},U4=class{constructor(e){this.diagnostics=e}},Gi;(function(e){e[e.User=1]="User",e[e.Assistant=2]="Assistant",e[e.System=3]="System"})(Gi||(Gi={}));var Rp=class{constructor(e,t,i){this.callId=e,this.content=t,this.isError=i??!1}},E0=class{constructor(e,t,i){this.callId=e,this.content=t,this.isError=i??!1}},pU=class{constructor(e,t,i){this.command=e,this.language=t,this.confirmationMessages=i}},C0;(function(e){e[e.Info=0]="Info",e[e.Warning=1]="Warning",e[e.Error=2]="Error"})(C0||(C0={}));var W4=class AS{static User(t,i){return new AS(Gi.User,t,i)}static Assistant(t,i){return new AS(Gi.Assistant,t,i)}set content(t){typeof t=="string"?this._content=[new Tt(t)]:this._content=t}get content(){return this._content}constructor(t,i,r){this._content=[],this.role=t,this.content=i,this.name=r}},B4=class RS{static User(t,i){return new RS(Gi.User,t,i)}static Assistant(t,i){return new RS(Gi.Assistant,t,i)}set content(t){typeof t=="string"?this._content=[new Tt(t)]:this._content=t}get content(){return this._content}set content2(t){t&&(this.content=t.map(i=>typeof i=="string"?new Tt(i):i))}get content2(){return this.content.map(t=>t instanceof Tt?t.value:t)}constructor(t,i,r){this._content=[],this.role=t,this.content=i,this.name=r}},qo=class{constructor(e,t,i){this.callId=e,this.name=t,this.input=i}},Tt=class{constructor(e){this.value=e}toJSON(){return{$mid:21,value:this.value}}},Fn=class Xm{constructor(t,i){this.mimeType=i,this.data=t}static image(t,i){return new Xm(t,i)}static json(t){const i=JSON.stringify(t,void 0,"	");return new Xm(z.fromString(i).buffer,"json")}static text(t){return new Xm(z.fromString(t).buffer,"text/plain")}toJSON(){return{$mid:23,mimeType:this.mimeType,data:this.data}}},Lp;(function(e){e.PNG="image/png",e.JPEG="image/jpeg",e.GIF="image/gif",e.WEBP="image/webp",e.BMP="image/bmp"})(Lp||(Lp={}));var D0=class{constructor(e,t){this.kind=e,this.data=t}toJSON(){return{$mid:24,kind:this.kind,data:this.data}}},ls=class{constructor(e){this.value=e}toJSON(){return{$mid:22,value:this.value}}},qs=class vs extends Error{static#e="LanguageModelError";static NotFound(t){return new vs(t,vs.NotFound.name)}static NoPermissions(t){return new vs(t,vs.NoPermissions.name)}static Blocked(t){return new vs(t,vs.Blocked.name)}static tryDeserialize(t){if(t.name===vs.#e)return new vs(t.message,t.code,t.cause)}constructor(t,i,r){super(t,{cause:r}),this.name=vs.#e,this.code=i??""}},Np=class{constructor(e){this.content=e}toJSON(){return{$mid:20,content:this.content}}},V4=class{constructor(e){this.content=e}toJSON(){return{$mid:20,content:this.content}}},gU=class extends Np{},k0;(function(e){e[e.Auto=1]="Auto",e[e.Required=2]="Required"})(k0||(k0={}));var I0;(function(e){e[e.SymbolInformation=1]="SymbolInformation",e[e.CommandInformation=2]="CommandInformation",e[e.SearchInformation=3]="SearchInformation",e[e.SettingInformation=4]="SettingInformation"})(I0||(I0={}));var P0;(function(e){e[e.EMBEDDED=1]="EMBEDDED",e[e.LLM_RANKED=2]="LLM_RANKED",e[e.CANCELED=3]="CANCELED"})(P0||(P0={}));var T0;(function(e){e[e.Started=1]="Started",e[e.Recognizing=2]="Recognizing",e[e.Recognized=3]="Recognized",e[e.Stopped=4]="Stopped",e[e.Error=5]="Error"})(T0||(T0={}));var A0;(function(e){e[e.Started=1]="Started",e[e.Stopped=2]="Stopped",e[e.Error=3]="Error"})(A0||(A0={}));var R0;(function(e){e[e.Recognized=1]="Recognized",e[e.Stopped=2]="Stopped"})(R0||(R0={}));var mU=class{constructor(e,t){this.text=e,this.range=t}},Lu;(function(e){e[e.Invoke=0]="Invoke",e[e.Automatic=1]="Automatic"})(Lu||(Lu={}));var vU=class{constructor(e,t,i,r={},s){this.label=e,this.command=t,this.args=i,this.env=r,this.version=s}},_U=class{constructor(e,t,i={},r){this.label=e,this.uri=t,this.headers=i,this.version=r}},Vee=q("IAiSettingsSearchService"),$n;(function(e){e[e.EMBEDDED=1]="EMBEDDED",e[e.LLM_RANKED=2]="LLM_RANKED",e[e.CANCELED=3]="CANCELED"})($n||($n={}));function wU(e,t){return qe.toKey(e)+"/"+t}var z4;(function(e){e[e.WorkspaceFolder=0]="WorkspaceFolder",e[e.Workspace=100]="Workspace",e[e.User=200]="User",e[e.Extension=300]="Extension",e[e.Filesystem=400]="Filesystem",e[e.RemoteBoost=-50]="RemoteBoost"})(z4||(z4={}));var q4;(function(e){function t(i,r){return i.id===r.id&&i.remoteAuthority===r.remoteAuthority&&i.label===r.label&&i.isTrustedByDefault===r.isTrustedByDefault}e.equals=t})(q4||(q4={}));var j4;(function(e){function t(s){return s}e.toSerialized=t;function i(s){return{id:s.id,label:s.label,cacheNonce:s.cacheNonce,launch:Nu.fromSerialized(s.launch),variableReplacement:s.variableReplacement?L0.fromSerialized(s.variableReplacement):void 0}}e.fromSerialized=i;function r(s,n){return s.id===n.id&&s.label===n.label&&Er(s.roots,n.roots,(o,a)=>o.toString()===a.toString())&&Ei(s.launch,n.launch)&&Ei(s.presentation,n.presentation)&&Ei(s.variableReplacement,n.variableReplacement)}e.equals=r})(j4||(j4={}));var L0;(function(e){function t(r){return r}e.toSerialized=t;function i(r){return{section:r.section,folder:r.folder?{...r.folder,uri:b.revive(r.folder.uri)}:void 0,target:r.target}}e.fromSerialized=i})(L0||(L0={}));var G4;(function(e){e[e.HasUnknown=0]="HasUnknown",e[e.LoadingUnknown=1]="LoadingUnknown",e[e.AllKnown=2]="AllKnown"})(G4||(G4={}));var zee=q("IMcpService"),Q4;(function(e){e[e.Unknown=0]="Unknown",e[e.Cached=1]="Cached",e[e.Outdated=2]="Outdated",e[e.RefreshingFromUnknown=3]="RefreshingFromUnknown",e[e.RefreshingFromCached=4]="RefreshingFromCached",e[e.Live=5]="Live"})(Q4||(Q4={}));var J4;(function(e){e[e.Stdio=1]="Stdio",e[e.HTTP=2]="HTTP"})(J4||(J4={}));var Nu;(function(e){function t(r){return r}e.toSerialized=t;function i(r){switch(r.type){case 2:return{type:r.type,uri:b.revive(r.uri),headers:r.headers};case 1:return{type:r.type,cwd:r.cwd?b.revive(r.cwd):void 0,command:r.command,args:r.args,env:r.env,envFile:r.envFile}}}e.fromSerialized=i})(Nu||(Nu={}));var K4;(function(e){let t;(function(i){i[i.Stopped=0]="Stopped",i[i.Starting=1]="Starting",i[i.Running=2]="Running",i[i.Error=3]="Error"})(t=e.Kind||(e.Kind={})),e.toString=i=>{switch(i.state){case 0:return h(8965,null);case 1:return h(8966,null);case 2:return h(8967,null);case 3:return h(8968,null,i.message);default:gv(i)}},e.toKindString=i=>{switch(i){case 0:return"stopped";case 1:return"starting";case 2:return"running";case 3:return"error";default:gv(i)}},e.canBeStarted=i=>i===3||i===0,e.isRunning=i=>!e.canBeStarted(i.state)})(K4||(K4={}));var Ur;(function(e){function t(r){const{selectionStartLineNumber:s,selectionStartColumn:n,positionLineNumber:o,positionColumn:a}=r,l=new Te(s-1,n-1),c=new Te(o-1,a-1);return new Bs(l,c)}e.to=t;function i(r){const{anchor:s,active:n}=r;return{selectionStartLineNumber:s.line+1,selectionStartColumn:s.character+1,positionLineNumber:n.line+1,positionColumn:n.character+1}}e.from=i})(Ur||(Ur={}));var F;(function(e){function t(r){if(!r)return;const{start:s,end:n}=r;return{startLineNumber:s.line+1,startColumn:s.character+1,endLineNumber:n.line+1,endColumn:n.character+1}}e.from=t;function i(r){if(!r)return;const{startLineNumber:s,startColumn:n,endLineNumber:o,endColumn:a}=r;return new Se(s-1,n-1,o-1,a-1)}e.to=i})(F||(F={}));var cs;(function(e){function t(r){return{uri:r.uri,range:F.from(r.range)}}e.from=t;function i(r){return new nr(b.revive(r.uri),F.to(r.range))}e.to=i})(cs||(cs={}));var N0;(function(e){function t(i){switch(i){case 1:return On.Comment;case 0:return On.Other;case 3:return On.RegEx;case 2:return On.String}}e.to=t})(N0||(N0={}));var Qe;(function(e){function t(r){return new Te(r.lineNumber-1,r.column-1)}e.to=t;function i(r){return{lineNumber:r.line+1,column:r.character+1}}e.from=i})(Qe||(Qe={}));var wl;(function(e){function t(s,n,o){return Et(er(s).map(a=>i(a,n,o)))}e.from=t;function i(s,n,o){if(typeof s=="string")return{$serialized:!0,language:s,isBuiltin:o?.isBuiltin};if(s)return{$serialized:!0,language:s.language,scheme:r(s.scheme,n),pattern:Ji.from(s.pattern)??void 0,exclusive:s.exclusive,notebookType:s.notebookType,isBuiltin:o?.isBuiltin}}function r(s,n){return n&&typeof s=="string"?n.transformOutgoingScheme(s):s}})(wl||(wl={}));var Mp;(function(e){function t(r){switch(r){case Lo.Unnecessary:return 1;case Lo.Deprecated:return 2}}e.from=t;function i(r){switch(r){case 1:return Lo.Unnecessary;case 2:return Lo.Deprecated;default:return}}e.to=i})(Mp||(Mp={}));var yl;(function(e){function t(r){let s;return r.code&&(Oe(r.code)||cr(r.code)?s=String(r.code):s={value:String(r.code.value),target:r.code.target}),{...F.from(r.range),message:r.message,source:r.source,code:s,severity:Mu.from(r.severity),relatedInformation:r.relatedInformation&&r.relatedInformation.map(Op.from),tags:Array.isArray(r.tags)?Et(r.tags.map(Mp.from)):void 0}}e.from=t;function i(r){const s=new Uf(F.to(r),r.message,Mu.to(r.severity));return s.source=r.source,s.code=Oe(r.code)?r.code:r.code?.value,s.relatedInformation=r.relatedInformation&&r.relatedInformation.map(Op.to),s.tags=r.tags&&Et(r.tags.map(Mp.to)),s}e.to=i})(yl||(yl={}));var Op;(function(e){function t(r){return{...F.from(r.location.range),message:r.message,resource:r.location.uri}}e.from=t;function i(r){return new iu(new nr(r.resource,F.to(r)),r.message)}e.to=i})(Op||(Op={}));var Mu;(function(e){function t(r){switch(r){case di.Error:return ki.Error;case di.Warning:return ki.Warning;case di.Information:return ki.Info;case di.Hint:return ki.Hint}return ki.Error}e.from=t;function i(r){switch(r){case ki.Info:return di.Information;case ki.Warning:return di.Warning;case ki.Error:return di.Error;case ki.Hint:return di.Hint;default:return di.Error}}e.to=i})(Mu||(Mu={}));var jt;(function(e){function t(r){return typeof r=="number"&&r>=du.One?r-1:r===du.Beside?wH:_H}e.from=t;function i(r){if(typeof r=="number"&&r>=0)return r+1;throw new Error("invalid 'EditorGroupColumn'")}e.to=i})(jt||(jt={}));function yU(e){return typeof e.range<"u"}function X4(e){return e.length===0?!0:!!yU(e[0])}var ve;(function(e){function t(a){return a.map(e.from)}e.fromMany=t;function i(a){return a&&typeof a=="object"&&typeof a.language=="string"&&typeof a.value=="string"}function r(a){let l;if(i(a)){const{language:d,value:f}=a;l={value:"```"+d+`
`+f+"\n```\n"}}else Ti.isMarkdownString(a)?l={value:a.value,isTrusted:a.isTrusted,supportThemeIcons:a.supportThemeIcons,supportHtml:a.supportHtml,baseUri:a.baseUri}:typeof a=="string"?l={value:a}:l={value:""};const c=Object.create(null);l.uris=c;const u=({href:d})=>{try{let f=b.parse(d,!0);f=f.with({query:s(f.query,c)}),c[d]=f}catch{}return""};return ht.walkTokens(ht.lexer(l.value),d=>{d.type==="link"?u({href:d.href}):d.type==="image"&&typeof d.href=="string"&&u(wO(d.href))}),l}e.from=r;function s(a,l){if(!a)return a;let c;try{c=BE(a)}catch{}if(!c)return a;let u=!1;return c=Ta(c,d=>{if(b.isUri(d)){const f=`__uri_${Math.random().toString(16).slice(2,8)}`;return l[f]=d,u=!0,f}else return}),u?JSON.stringify(c):a}function n(a){const l=new Ti(a.value,a.supportThemeIcons);return l.isTrusted=a.isTrusted,l.supportHtml=a.supportHtml,l.baseUri=a.baseUri?b.from(a.baseUri):void 0,l}e.to=n;function o(a){if(a)return typeof a=="string"?a:e.from(a)}e.fromStrict=o})(ve||(ve={}));function bU(e){return X4(e)?e.map(t=>({range:F.from(t.range),hoverMessage:Array.isArray(t.hoverMessage)?ve.fromMany(t.hoverMessage):t.hoverMessage?ve.from(t.hoverMessage):void 0,renderOptions:t.renderOptions})):e.map(t=>({range:F.from(t)}))}function Fp(e){return typeof e>"u"?e:typeof e=="string"?b.file(e):e}var bl;(function(e){function t(i){return typeof i>"u"?i:{contentText:i.contentText,contentIconPath:i.contentIconPath?Fp(i.contentIconPath):void 0,border:i.border,borderColor:i.borderColor,fontStyle:i.fontStyle,fontWeight:i.fontWeight,textDecoration:i.textDecoration,color:i.color,backgroundColor:i.backgroundColor,margin:i.margin,width:i.width,height:i.height}}e.from=t})(bl||(bl={}));var $p;(function(e){function t(i){return typeof i>"u"?i:{backgroundColor:i.backgroundColor,outline:i.outline,outlineColor:i.outlineColor,outlineStyle:i.outlineStyle,outlineWidth:i.outlineWidth,border:i.border,borderColor:i.borderColor,borderRadius:i.borderRadius,borderSpacing:i.borderSpacing,borderStyle:i.borderStyle,borderWidth:i.borderWidth,fontStyle:i.fontStyle,fontWeight:i.fontWeight,textDecoration:i.textDecoration,cursor:i.cursor,color:i.color,opacity:i.opacity,letterSpacing:i.letterSpacing,gutterIconPath:i.gutterIconPath?Fp(i.gutterIconPath):void 0,gutterIconSize:i.gutterIconSize,overviewRulerColor:i.overviewRulerColor,before:i.before?bl.from(i.before):void 0,after:i.after?bl.from(i.after):void 0}}e.from=t})($p||($p={}));var M0;(function(e){function t(i){if(typeof i>"u")return i;switch(i){case Mo.OpenOpen:return 0;case Mo.ClosedClosed:return 1;case Mo.OpenClosed:return 2;case Mo.ClosedOpen:return 3}}e.from=t})(M0||(M0={}));var O0;(function(e){function t(i){return{isWholeLine:i.isWholeLine,rangeBehavior:i.rangeBehavior?M0.from(i.rangeBehavior):void 0,overviewRulerLane:i.overviewRulerLane,light:i.light?$p.from(i.light):void 0,dark:i.dark?$p.from(i.dark):void 0,backgroundColor:i.backgroundColor,outline:i.outline,outlineColor:i.outlineColor,outlineStyle:i.outlineStyle,outlineWidth:i.outlineWidth,border:i.border,borderColor:i.borderColor,borderRadius:i.borderRadius,borderSpacing:i.borderSpacing,borderStyle:i.borderStyle,borderWidth:i.borderWidth,fontStyle:i.fontStyle,fontWeight:i.fontWeight,textDecoration:i.textDecoration,cursor:i.cursor,color:i.color,opacity:i.opacity,letterSpacing:i.letterSpacing,gutterIconPath:i.gutterIconPath?Fp(i.gutterIconPath):void 0,gutterIconSize:i.gutterIconSize,overviewRulerColor:i.overviewRulerColor,before:i.before?bl.from(i.before):void 0,after:i.after?bl.from(i.after):void 0}}e.from=t})(O0||(O0={}));var Gt;(function(e){function t(r){return{text:r.newText,eol:r.newEol&&Cl.from(r.newEol),range:F.from(r.range)}}e.from=t;function i(r){const s=new An(F.to(r.range),r.text);return s.newEol=typeof r.eol>"u"?void 0:Cl.to(r.eol),s}e.to=i})(Gt||(Gt={}));var Qi;(function(e){function t(r,s){const n={edits:[]};if(r instanceof Ao){const o=new ox;for(const a of r._allEntries())a._type===1&&b.isUri(a.to)&&a.from===void 0&&o.add(a.to);for(const a of r._allEntries())if(a._type===1){let l;a.options?.contents&&(ArrayBuffer.isView(a.options.contents)?l={type:"base64",value:kh(z.wrap(a.options.contents))}:l={type:"dataTransferItem",id:a.options.contents._itemId}),n.edits.push({oldResource:a.from,newResource:a.to,options:{...a.options,contents:l},metadata:a.metadata})}else a._type===2?n.edits.push({resource:a.uri,textEdit:Gt.from(a.edit),versionId:o.has(a.uri)?void 0:s?.getTextDocumentVersion(a.uri),metadata:a.metadata}):a._type===6?n.edits.push({resource:a.uri,textEdit:{range:F.from(a.range),text:a.edit.value,insertAsSnippet:!0,keepWhitespace:a.keepWhitespace},versionId:o.has(a.uri)?void 0:s?.getTextDocumentVersion(a.uri),metadata:a.metadata}):a._type===3?n.edits.push({metadata:a.metadata,resource:a.uri,cellEdit:a.edit,notebookVersionId:s?.getNotebookDocumentVersion(a.uri)}):a._type===5&&n.edits.push({metadata:a.metadata,resource:a.uri,notebookVersionId:s?.getNotebookDocumentVersion(a.uri),cellEdit:{editType:1,index:a.index,count:a.count,cells:a.cells.map(kl.from)}})}return n}e.from=t;function i(r){const s=new Ao,n=new Vt;for(const o of r.edits)if(o.textEdit){const a=o,l=b.revive(a.resource),c=F.to(a.textEdit.range),u=a.textEdit.text,d=a.textEdit.insertAsSnippet;let f;d?f=k_.replace(c,new Ro(u)):f=An.replace(c,u);const p=n.get(l);p?p.push(f):n.set(l,[f])}else s.renameFile(b.revive(o.oldResource),b.revive(o.newResource),o.options);for(const[o,a]of n)s.set(o,a);return s}e.to=i})(Qi||(Qi={}));var mr;(function(e){const t=Object.create(null);t[at.File]=0,t[at.Module]=1,t[at.Namespace]=2,t[at.Package]=3,t[at.Class]=4,t[at.Method]=5,t[at.Property]=6,t[at.Field]=7,t[at.Constructor]=8,t[at.Enum]=9,t[at.Interface]=10,t[at.Function]=11,t[at.Variable]=12,t[at.Constant]=13,t[at.String]=14,t[at.Number]=15,t[at.Boolean]=16,t[at.Array]=17,t[at.Object]=18,t[at.Key]=19,t[at.Null]=20,t[at.EnumMember]=21,t[at.Struct]=22,t[at.Event]=23,t[at.Operator]=24,t[at.TypeParameter]=25;function i(s){return typeof t[s]=="number"?t[s]:6}e.from=i;function r(s){for(const n in t)if(t[n]===s)return Number(n);return at.Property}e.to=r})(mr||(mr={}));var js;(function(e){function t(r){switch(r){case su.Deprecated:return 1}}e.from=t;function i(r){switch(r){case 1:return su.Deprecated}}e.to=i})(js||(js={}));var jo;(function(e){function t(r){return{name:r.name,kind:mr.from(r.kind),tags:r.tags&&r.tags.map(js.from),containerName:r.containerName,location:Ai.from(r.location)}}e.from=t;function i(r){const s=new nu(r.name,mr.to(r.kind),r.containerName,Ai.to(r.location));return s.tags=r.tags&&r.tags.map(js.to),s}e.to=i})(jo||(jo={}));var F0;(function(e){function t(r){const s={name:r.name||"!!MISSING: name!!",detail:r.detail,range:F.from(r.range),selectionRange:F.from(r.selectionRange),kind:mr.from(r.kind),tags:r.tags?.map(js.from)??[]};return r.children&&(s.children=r.children.map(t)),s}e.from=t;function i(r){const s=new ou(r.name,r.detail,mr.to(r.kind),F.to(r.range),F.to(r.selectionRange));return ya(r.tags)&&(s.tags=r.tags.map(js.to)),r.children&&(s.children=r.children.map(i)),s}e.to=i})(F0||(F0={}));var Go;(function(e){function t(r){const s=new P_(mr.to(r.kind),r.name,r.detail||"",b.revive(r.uri),F.to(r.range),F.to(r.selectionRange));return s._sessionId=r._sessionId,s._itemId=r._itemId,s}e.to=t;function i(r,s,n){if(s=s??r._sessionId,n=n??r._itemId,s===void 0||n===void 0)throw new Error("invalid item");return{_sessionId:s,_itemId:n,name:r.name,detail:r.detail,kind:mr.from(r.kind),uri:r.uri,range:F.from(r.range),selectionRange:F.from(r.selectionRange),tags:r.tags?.map(js.from)}}e.from=i})(Go||(Go={}));var $0;(function(e){function t(i){return new g4(Go.to(i.from),i.fromRanges.map(r=>F.to(r)))}e.to=t})($0||($0={}));var H0;(function(e){function t(i){return new m4(Go.to(i.to),i.fromRanges.map(r=>F.to(r)))}e.to=t})(H0||(H0={}));var Ai;(function(e){function t(r){return{range:r.range&&F.from(r.range),uri:r.uri}}e.from=t;function i(r){return new nr(b.revive(r.uri),F.to(r.range))}e.to=i})(Ai||(Ai={}));var Ou;(function(e){function t(r){const s=r,n=r;return{originSelectionRange:s.originSelectionRange?F.from(s.originSelectionRange):void 0,uri:s.targetUri?s.targetUri:n.uri,range:F.from(s.targetRange?s.targetRange:n.range),targetSelectionRange:s.targetSelectionRange?F.from(s.targetSelectionRange):void 0}}e.from=t;function i(r){return{targetUri:b.revive(r.uri),targetRange:F.to(r.range),targetSelectionRange:r.targetSelectionRange?F.to(r.targetSelectionRange):void 0,originSelectionRange:r.originSelectionRange?F.to(r.originSelectionRange):void 0}}e.to=i})(Ou||(Ou={}));var Fu;(function(e){function t(r){return{range:F.from(r.range),contents:ve.fromMany(r.contents),canIncreaseVerbosity:r.canIncreaseVerbosity,canDecreaseVerbosity:r.canDecreaseVerbosity}}e.from=t;function i(r){const s=r.contents.map(ve.to),n=F.to(r.range),o=r.canIncreaseVerbosity,a=r.canDecreaseVerbosity;return new Bf(s,n,o,a)}e.to=i})(Fu||(Fu={}));var U0;(function(e){function t(r){return{range:F.from(r.range),expression:r.expression}}e.from=t;function i(r){return new sp(F.to(r.range),r.expression)}e.to=i})(U0||(U0={}));var Hp;(function(e){function t(r){if(r instanceof np)return{type:"text",range:F.from(r.range),text:r.text};if(r instanceof op)return{type:"variable",range:F.from(r.range),variableName:r.variableName,caseSensitiveLookup:r.caseSensitiveLookup};if(r instanceof ap)return{type:"expression",range:F.from(r.range),expression:r.expression};throw new Error("Unknown 'InlineValue' type")}e.from=t;function i(r){switch(r.type){case"text":return{range:F.to(r.range),text:r.text};case"variable":return{range:F.to(r.range),variableName:r.variableName,caseSensitiveLookup:r.caseSensitiveLookup};case"expression":return{range:F.to(r.range),expression:r.expression}}}e.to=i})(Hp||(Hp={}));var Up;(function(e){function t(r){return{frameId:r.frameId,stoppedLocation:F.from(r.stoppedLocation)}}e.from=t;function i(r){return new K_(r.frameId,F.to(r.stoppedLocation))}e.to=i})(Up||(Up={}));var Sl;(function(e){function t(r){return{range:F.from(r.range),kind:r.kind}}e.from=t;function i(r){return new Vf(F.to(r.range),r.kind)}e.to=i})(Sl||(Sl={}));var W0;(function(e){function t(r){return{uri:r.uri,highlights:r.highlights.map(Sl.from)}}e.from=t;function i(r){return new zf(b.revive(r.uri),r.highlights.map(Sl.to))}e.to=i})(W0||(W0={}));var B0;(function(e){function t(i){switch(i){case 1:return Ya.TriggerCharacter;case 2:return Ya.TriggerForIncompleteCompletions;case 0:default:return Ya.Invoke}}e.to=t})(B0||(B0={}));var V0;(function(e){function t(i){return{triggerKind:B0.to(i.triggerKind),triggerCharacter:i.triggerCharacter}}e.to=t})(V0||(V0={}));var Wp;(function(e){function t(r){switch(r){case uu.Deprecated:return 1}}e.from=t;function i(r){switch(r){case 1:return uu.Deprecated}}e.to=i})(Wp||(Wp={}));var Bp;(function(e){const t=new Map([[fe.Method,0],[fe.Function,1],[fe.Constructor,2],[fe.Field,3],[fe.Variable,4],[fe.Class,5],[fe.Interface,7],[fe.Struct,6],[fe.Module,8],[fe.Property,9],[fe.Unit,12],[fe.Value,13],[fe.Constant,14],[fe.Enum,15],[fe.EnumMember,16],[fe.Keyword,17],[fe.Snippet,27],[fe.Text,18],[fe.Color,19],[fe.File,20],[fe.Reference,21],[fe.Folder,23],[fe.Event,10],[fe.Operator,11],[fe.TypeParameter,24],[fe.Issue,26],[fe.User,25]]);function i(n){return t.get(n)??9}e.from=i;const r=new Map([[0,fe.Method],[1,fe.Function],[2,fe.Constructor],[3,fe.Field],[4,fe.Variable],[5,fe.Class],[7,fe.Interface],[6,fe.Struct],[8,fe.Module],[9,fe.Property],[12,fe.Unit],[13,fe.Value],[14,fe.Constant],[15,fe.Enum],[16,fe.EnumMember],[17,fe.Keyword],[27,fe.Snippet],[18,fe.Text],[19,fe.Color],[20,fe.File],[21,fe.Reference],[23,fe.Folder],[10,fe.Event],[11,fe.Operator],[24,fe.TypeParameter],[25,fe.User],[26,fe.Issue]]);function s(n){return r.get(n)??fe.Property}e.to=s})(Bp||(Bp={}));var z0;(function(e){function t(i,r){const s=new Qf(i.label);return s.insertText=i.insertText,s.kind=Bp.to(i.kind),s.tags=i.tags?.map(Wp.to),s.detail=i.detail,s.documentation=Ns(i.documentation)?ve.to(i.documentation):i.documentation,s.sortText=i.sortText,s.filterText=i.filterText,s.preselect=i.preselect,s.commitCharacters=i.commitCharacters,je.isIRange(i.range)?s.range=F.to(i.range):typeof i.range=="object"&&(s.range={inserting:F.to(i.range.insert),replacing:F.to(i.range.replace)}),s.keepWhitespace=typeof i.insertTextRules>"u"?!1:!!(i.insertTextRules&1),typeof i.insertTextRules<"u"&&i.insertTextRules&4?s.insertText=new Ro(i.insertText):(s.insertText=i.insertText,s.textEdit=s.range instanceof Se?new An(s.range,s.insertText):void 0),i.additionalTextEdits&&i.additionalTextEdits.length>0&&(s.additionalTextEdits=i.additionalTextEdits.map(n=>Gt.to(n))),s.command=r&&i.command?r.fromInternal(i.command):void 0,s}e.to=t})(z0||(z0={}));var Vp;(function(e){function t(r){if(typeof r.label!="string"&&!Array.isArray(r.label))throw new TypeError("Invalid label");return{label:r.label,documentation:ve.fromStrict(r.documentation)}}e.from=t;function i(r){return{label:r.label,documentation:Ns(r.documentation)?ve.to(r.documentation):r.documentation}}e.to=i})(Vp||(Vp={}));var zp;(function(e){function t(r){return{label:r.label,documentation:ve.fromStrict(r.documentation),parameters:Array.isArray(r.parameters)?r.parameters.map(Vp.from):[],activeParameter:r.activeParameter}}e.from=t;function i(r){return{label:r.label,documentation:Ns(r.documentation)?ve.to(r.documentation):r.documentation,parameters:Array.isArray(r.parameters)?r.parameters.map(Vp.to):[],activeParameter:r.activeParameter}}e.to=i})(zp||(zp={}));var $u;(function(e){function t(r){return{activeSignature:r.activeSignature,activeParameter:r.activeParameter,signatures:Array.isArray(r.signatures)?r.signatures.map(zp.from):[]}}e.from=t;function i(r){return{activeSignature:r.activeSignature,activeParameter:r.activeParameter,signatures:Array.isArray(r.signatures)?r.signatures.map(zp.to):[]}}e.to=i})($u||($u={}));var q0;(function(e){function t(i,r){const s=new Gf(Qe.to(r.position),typeof r.label=="string"?r.label:r.label.map(j0.to.bind(void 0,i)),r.kind&&qp.to(r.kind));return s.textEdits=r.textEdits&&r.textEdits.map(Gt.to),s.tooltip=Ns(r.tooltip)?ve.to(r.tooltip):r.tooltip,s.paddingLeft=r.paddingLeft,s.paddingRight=r.paddingRight,s}e.to=t})(q0||(q0={}));var j0;(function(e){function t(i,r){const s=new jf(r.label);return s.tooltip=Ns(r.tooltip)?ve.to(r.tooltip):r.tooltip,$1.is(r.command)&&(s.command=i.fromInternal(r.command)),r.location&&(s.location=Ai.to(r.location)),s}e.to=t})(j0||(j0={}));var qp;(function(e){function t(r){return r}e.from=t;function i(r){return r}e.to=i})(qp||(qp={}));var Qo;(function(e){function t(r){return{range:F.from(r.range),url:r.target,tooltip:r.tooltip}}e.from=t;function i(r){let s;if(r.url)try{s=typeof r.url=="string"?b.parse(r.url,!0):b.revive(r.url)}catch{}const n=new Kf(F.to(r.range),s);return n.tooltip=r.tooltip,n}e.to=i})(Qo||(Qo={}));var jp;(function(e){function t(r){const s=new Yf(r.label);return r.textEdit&&(s.textEdit=Gt.to(r.textEdit)),r.additionalTextEdits&&(s.additionalTextEdits=r.additionalTextEdits.map(n=>Gt.to(n))),s}e.to=t;function i(r){return{label:r.label,textEdit:r.textEdit?Gt.from(r.textEdit):void 0,additionalTextEdits:r.additionalTextEdits?r.additionalTextEdits.map(s=>Gt.from(s)):void 0}}e.from=i})(jp||(jp={}));var xl;(function(e){function t(r){return new nl(r[0],r[1],r[2],r[3])}e.to=t;function i(r){return[r.red,r.green,r.blue,r.alpha]}e.from=i})(xl||(xl={}));var G0;(function(e){function t(r){return{range:F.from(r.range)}}e.from=t;function i(r){return new cu(F.to(r.range))}e.to=i})(G0||(G0={}));var Gp;(function(e){function t(i){switch(i){case 2:return tl.AfterDelay;case 1:return tl.Manual;case 3:case 4:return tl.FocusOut}}e.to=t})(Gp||(Gp={}));var El;(function(e){function t(r){switch(r){case $r.Off:return 0;case $r.Relative:return 2;case $r.Interval:return 3;case $r.On:default:return 1}}e.from=t;function i(r){switch(r){case 0:return $r.Off;case 2:return $r.Relative;case 3:return $r.Interval;case 1:default:return $r.On}}e.to=i})(El||(El={}));var Cl;(function(e){function t(r){if(r===Fr.CRLF)return 1;if(r===Fr.LF)return 0}e.from=t;function i(r){if(r===1)return Fr.CRLF;if(r===0)return Fr.LF}e.to=i})(Cl||(Cl={}));var Q0;(function(e){function t(i){if(typeof i=="object")return i.viewId;switch(i){case Fo.SourceControl:return 3;case Fo.Window:return 10;case Fo.Notification:return 15}throw new Error("Unknown 'ProgressLocation'")}e.from=t})(Q0||(Q0={}));var Qp;(function(e){function t(r){const s={start:r.start+1,end:r.end+1};return r.kind&&(s.kind=Jp.from(r.kind)),s}e.from=t;function i(r){const s={start:r.start-1,end:r.end-1};return r.kind&&(s.kind=Jp.to(r.kind)),s}e.to=i})(Qp||(Qp={}));var Jp;(function(e){function t(r){if(r)switch(r){case Vs.Comment:return $a.Comment;case Vs.Imports:return $a.Imports;case Vs.Region:return $a.Region}}e.from=t;function i(r){if(r)switch(r.value){case $a.Comment.value:return Vs.Comment;case $a.Imports.value:return Vs.Imports;case $a.Region.value:return Vs.Region}}e.to=i})(Jp||(Jp={}));var Hu;(function(e){function t(i){if(i)return{pinned:typeof i.preview=="boolean"?!i.preview:void 0,inactive:i.background,preserveFocus:i.preserveFocus,selection:typeof i.selection=="object"?F.from(i.selection):void 0,override:typeof i.override=="boolean"?hF.id:void 0}}e.from=t})(Hu||(Hu={}));var Ji;(function(e){function t(n){return n instanceof cl?n.toJSON():typeof n=="string"?n:i(n)||r(n)?new cl(n.baseUri??n.base,n.pattern).toJSON():n}e.from=t;function i(n){const o=n;return o?b.isUri(o.baseUri)&&typeof o.pattern=="string":!1}function r(n){const o=n;return o?typeof o.base=="string"&&typeof o.pattern=="string":!1}function s(n){return typeof n=="string"?n:new cl(b.revive(n.baseUri),n.pattern)}e.to=s})(Ji||(Ji={}));var J0;(function(e){function t(i){if(i){if(Array.isArray(i))return i.map(t);if(typeof i=="string")return i;{const r=i;return{language:r.language,scheme:r.scheme,pattern:Ji.from(r.pattern)??void 0,exclusive:r.exclusive,notebookType:r.notebookType}}}else return}e.from=t})(J0||(J0={}));var us;(function(e){function t(r){return{start:r.start,end:r.end}}e.from=t;function i(r){return new zs(r.start,r.end)}e.to=i})(us||(us={}));var Dl;(function(e){function t(r){return{timing:typeof r.runStartTime=="number"&&typeof r.runEndTime=="number"?{startTime:r.runStartTime,endTime:r.runEndTime}:void 0,executionOrder:r.executionOrder,success:r.lastRunSuccess}}e.to=t;function i(r){return{lastRunSuccess:r.success,runStartTime:r.timing?.startTime,runEndTime:r.timing?.endTime,executionOrder:r.executionOrder}}e.from=i})(Dl||(Dl={}));var K0;(function(e){function t(i){if(i===jc.Unconfirmed)return ml.Pending;if(i===jc.Pending)return;if(i===jc.Executing)return ml.Executing;throw new Error(`Unknown state: ${i}`)}e.to=t})(K0||(K0={}));var Uu;(function(e){function t(r){switch(r){case Bo.Markup:return za.Markup;case Bo.Code:default:return za.Code}}e.from=t;function i(r){switch(r){case za.Markup:return Bo.Markup;case za.Code:default:return Bo.Code}}e.to=i})(Uu||(Uu={}));var Hn;(function(e){function t(r){const s={metadata:r.metadata??Object.create(null),cells:[]};for(const n of r.cells)dp.validate(n),s.cells.push(kl.from(n));return s}e.from=t;function i(r){const s=new x4(r.cells.map(kl.to));return dx(r.metadata)||(s.metadata=r.metadata),s}e.to=i})(Hn||(Hn={}));var kl;(function(e){function t(r){return{cellKind:Uu.from(r.kind),language:r.languageId,mime:r.mime,source:r.value,metadata:r.metadata,internalMetadata:Dl.from(r.executionSummary??{}),outputs:r.outputs?r.outputs.map(Un.from):[]}}e.from=t;function i(r){return new dp(Uu.to(r.cellKind),r.source,r.language,r.mime,r.outputs?r.outputs.map(Un.to):void 0,r.metadata,r.internalMetadata?Dl.to(r.internalMetadata):void 0)}e.to=i})(kl||(kl={}));var Il;(function(e){function t(r){return{mime:r.mime,valueBytes:z.wrap(r.data)}}e.from=t;function i(r){return new E4(r.valueBytes.buffer,r.mime)}e.to=i})(Il||(Il={}));var Un;(function(e){function t(r){return{outputId:r.id,items:r.items.map(Il.from),metadata:r.metadata}}e.from=t;function i(r){const s=r.items.map(Il.to);return new hp(s,r.outputId,r.metadata)}e.to=i})(Un||(Un={}));var Kp;(function(e){function t(s){return r(s)?{include:Ji.from(s.include)??void 0,exclude:Ji.from(s.exclude)??void 0}:Ji.from(s)??void 0}e.from=t;function i(s){return r(s)?{include:Ji.to(s.include),exclude:Ji.to(s.exclude)}:Ji.to(s)}e.to=i;function r(s){const n=s;return n?!Lt(n.include)&&!Lt(n.exclude):!1}})(Kp||(Kp={}));var X0;(function(e){function t(i,r,s){const n=typeof i.command=="string"?{title:"",command:i.command}:i.command;return{alignment:i.alignment===fp.Left?1:2,command:r.toInternal(n,s),text:i.text,tooltip:i.tooltip,accessibilityInformation:i.accessibilityInformation,priority:i.priority}}e.from=t})(X0||(X0={}));var Y0;(function(e){function t(i,r,s){const n=typeof i.command=="string"?{title:"",command:i.command}:i.command;return{command:r.toInternal(n,s),label:i.label,description:i.description,detail:i.detail,documentation:i.documentation}}e.from=t})(Y0||(Y0={}));var Z0;(function(e){function t(i){return{transientOutputs:i?.transientOutputs??!1,transientCellMetadata:i?.transientCellMetadata??{},transientDocumentMetadata:i?.transientDocumentMetadata??{},cellContentMetadata:i?.cellContentMetadata??{}}}e.from=t})(Z0||(Z0={}));var Xp;(function(e){function t(r){return{uri:r.uri,provides:r.provides}}e.from=t;function i(r){return new C4(b.revive(r.uri),r.provides)}e.to=i})(Xp||(Xp={}));var Pl;(function(e){function t(r){return{message:ve.fromStrict(r.message)||"",type:0,expected:r.expectedOutput,actual:r.actualOutput,contextValue:r.contextValue,location:r.location&&{range:F.from(r.location.range),uri:r.location.uri},stackTrace:r.stackTrace?.map(s=>({label:s.label,position:s.position&&Qe.from(s.position),uri:s.uri&&b.revive(s.uri).toJSON()}))}}e.from=t;function i(r){const s=new _p(typeof r.message=="string"?r.message:ve.to(r.message));return s.actualOutput=r.actual,s.expectedOutput=r.expected,s.contextValue=r.contextValue,s.location=r.location?Ai.to(r.location):void 0,s}e.to=i})(Pl||(Pl={}));var Wr;(function(e){e.namespace=Pf,e.denamespace=AP})(Wr||(Wr={}));var ew;(function(e){function t(i){return{controllerId:i.controllerId,profileId:i.profileId,group:Tl.from(i.kind)}}e.from=t})(ew||(ew={}));var Tl;(function(e){const t={[_l.Coverage]:8,[_l.Debug]:4,[_l.Run]:2};function i(r){return t.hasOwnProperty(r)?t[r]:2}e.from=i})(Tl||(Tl={}));var Wn;(function(e){function t(r){const s=Of(r).controllerId;return{extId:He.fromExtHostTestItem(r,s).toString(),label:r.label,uri:b.revive(r.uri),busy:r.busy,tags:r.tags.map(n=>Wr.namespace(s,n.id)),range:je.lift(F.from(r.range)),description:r.description||null,sortText:r.sortText||null,error:r.error&&ve.fromStrict(r.error)||null}}e.from=t;function i(r){return{parent:void 0,error:void 0,id:He.fromString(r.extId).localId,label:r.label,uri:b.revive(r.uri),tags:(r.tags||[]).map(s=>{const{tagId:n}=Wr.denamespace(s);return new ku(n)}),children:{add:()=>{},delete:()=>{},forEach:()=>{},*[Symbol.iterator](){},get:()=>{},replace:()=>{},size:0},range:F.to(r.range||void 0),canResolveChildren:!1,busy:r.busy,description:r.description||void 0,sortText:r.sortText||void 0}}e.toPlain=i})(Wn||(Wn={})),function(e){function t(r){return{id:r.id}}e.from=t;function i(r){return new ku(r.id)}e.to=i}(Wr||(Wr={}));var tw;(function(e){const t=(r,s)=>{const n=r.value;if(!n)return;const o={...Wn.toPlain(n.item),parent:s,taskStates:n.tasks.map(a=>({state:a.state,duration:a.duration,messages:a.messages.filter(l=>l.type===0).map(Pl.to)})),children:[]};if(r.children)for(const a of r.children.values()){const l=t(a,o);l&&o.children.push(l)}return o};function i(r){const s=new eF;for(const a of r.items)s.insert(He.fromString(a.item.extId).path,a);const n=[s.nodes],o=[];for(;n.length;)for(const a of n.pop())a.value?o.push(a):a.children&&n.push(a.children.values());return{completedAt:r.completedAt,results:o.map(a=>t(a)).filter(ur)}}e.to=i})(tw||(tw={}));var Wu;(function(e){function t(a){return{covered:a.covered,total:a.total}}function i(a){return"line"in a?Qe.from(a):F.from(a)}function r(a){if(a)return"endLineNumber"in a?F.to(a):Qe.to(a)}function s(a){if(a.type===1){const l=[];if(a.branches)for(const c of a.branches)l.push({executed:c.count,location:r(c.location),label:c.label});return new k4(a.count,r(a.location),a.branches?.map(c=>new I4(c.count,r(c.location),c.label)))}else return new P4(a.name,a.count,r(a.location))}e.to=s;function n(a){if(typeof a.executed=="number"&&a.executed<0)throw new Error(`Invalid coverage count ${a.executed}`);return"branches"in a?{count:a.executed,location:i(a.location),type:1,branches:a.branches.length?a.branches.map(l=>({count:l.executed,location:l.location&&i(l.location),label:l.label})):void 0}:{type:0,name:a.name,count:a.executed,location:i(a.location)}}e.fromDetails=n;function o(a,l,c){return yp(c.statementCoverage),yp(c.branchCoverage),yp(c.declarationCoverage),{id:l,uri:c.uri,statement:t(c.statementCoverage),branch:c.branchCoverage&&t(c.branchCoverage),declaration:c.declarationCoverage&&t(c.declarationCoverage),testIds:c instanceof bp&&c.includesTests.length?c.includesTests.map(u=>He.fromExtHostTestItem(u,a).toString()):void 0}}e.fromFile=o})(Wu||(Wu={}));var iw;(function(e){function t(i){switch(i){case 1:return au.Invoke;case 2:return au.Automatic}}e.to=t})(iw||(iw={}));var Jo;(function(e){function t(r){const s=new u0(mr.to(r.kind),r.name,r.detail||"",b.revive(r.uri),F.to(r.range),F.to(r.selectionRange));return s._sessionId=r._sessionId,s._itemId=r._itemId,s}e.to=t;function i(r,s,n){if(s=s??r._sessionId,n=n??r._itemId,s===void 0||n===void 0)throw new Error("invalid item");return{_sessionId:s,_itemId:n,kind:mr.from(r.kind),name:r.name,detail:r.detail??"",uri:r.uri,range:F.from(r.range),selectionRange:F.from(r.selectionRange),tags:r.tags?.map(js.from)}}e.from=i})(Jo||(Jo={}));var Yp;(function(e){function t(i){if(i)return{value:i.value,tooltip:i.tooltip}}e.from=t})(Yp||(Yp={}));var Ko;(function(e){function t(n,o,a){const l=o.fileData;return l?new ZH(new eU(l.name,b.revive(l.uri),l.id,eh(()=>a(l.id)))):n===Ms.uriList&&o.uriListData?new ip(s(o.uriListData)):new ip(o.asString)}e.to=t;async function i(n,o,a=mt()){const l=await o.asString();if(n===Ms.uriList)return{id:a,asString:l,fileData:void 0,uriListData:r(l)};const c=o.asFile();return{id:a,asString:l,fileData:c?{name:c.name,uri:c.uri,id:c._itemId??c.id}:void 0}}e.from=i;function r(n){return y1.split(n).map(o=>{if(o.startsWith("#"))return o;try{return b.parse(o)}catch{}return o})}function s(n){return y1.create(n.map(o=>typeof o=="string"?o:b.revive(o)))}})(Ko||(Ko={}));var Al;(function(e){function t(s,n){const o=s.items.map(([a,l])=>[a,Ko.to(a,l,n)]);return new al(o)}e.toDataTransfer=t;async function i(s){return{items:await Promise.all(Array.from(s,async([o,a])=>[o,await Ko.from(o,a)]))}}e.from=i;async function r(s){return{items:await Promise.all(Array.from(s,async([o,a])=>[o,await Ko.from(o,a,a.id)]))}}e.fromList=r})(Al||(Al={}));var Bu;(function(e){function t(r,s){return{kind:"reply",agentId:r.participant??s?.agentId??"",subCommand:r.command??s?.command,message:r.prompt,title:r.label}}e.from=t;function i(r){return{prompt:r.message,label:r.title,participant:r.agentId,command:r.subCommand}}e.to=i})(Bu||(Bu={}));var Rl;(function(e){function t(r){switch(r){case 0:return Gi.System;case 1:return Gi.User;case 2:return Gi.Assistant}}e.to=t;function i(r){switch(r){case Gi.System:return 0;case Gi.User:return 1;case Gi.Assistant:return 2}return 1}e.from=i})(Rl||(Rl={}));var Y4;(function(e){function t(r){const s=r.content.map(a=>{if(a.type==="text")return new Tt(a.value);if(a.type==="tool_result"){const l=a.value.map(c=>c.type==="text"?new Tt(c.value):new ls(c.value));return new Rp(a.toolCallId,l,a.isError)}else return a.type==="image_url"||a.type==="extra_data"?void 0:new qo(a.toolCallId,a.name,a.parameters)}).filter(a=>a!==void 0),n=Rl.to(r.role);return new W4(n,s,r.name)}e.to=t;function i(r){const s=Rl.from(r.role),n=r.name;let o=r.content;typeof o=="string"&&(o=[new Tt(o)]);const a=o.map(l=>{if(l instanceof Rp)return{type:"tool_result",toolCallId:l.callId,value:Et(l.content.map(c=>c instanceof Tt?{type:"text",value:c.value}:c instanceof ls?{type:"prompt_tsx",value:c.value}:void 0)),isError:l.isError};if(l instanceof qo)return{type:"tool_use",toolCallId:l.callId,name:l.name,parameters:l.input};if(l instanceof Tt)return{type:"text",value:l.value};if(typeof l!="string")throw new Error("Unexpected chat message content type");return{type:"text",value:l}});return{role:s,name:n,content:a}}e.from=i})(Y4||(Y4={}));var Vu;(function(e){function t(r){const s=r.content.map(a=>{if(a.type==="text")return new Tt(a.value);if(a.type==="tool_result"){const l=a.value.map(c=>c.type==="text"?new Tt(c.value):c.type==="data"?new Fn(c.value.data.buffer,c.value.mimeType):new ls(c.value));return new E0(a.toolCallId,l,a.isError)}else return a.type==="image_url"?new Fn(a.value.data.buffer,a.value.mimeType):a.type==="extra_data"?new D0(a.kind,a.data):new qo(a.toolCallId,a.name,a.parameters)}),n=Rl.to(r.role);return new B4(n,s,r.name)}e.to=t;function i(r){const s=Rl.from(r.role),n=r.name;let o=r.content;typeof o=="string"&&(o=[new Tt(o)]);const a=o.map(l=>{if(l instanceof E0||l instanceof Rp)return{type:"tool_result",toolCallId:l.callId,value:Et(l.content.map(c=>c instanceof Tt?{type:"text",value:c.value}:c instanceof ls?{type:"prompt_tsx",value:c.value}:c instanceof Fn?{type:"data",value:{mimeType:c.mimeType,data:z.wrap(c.data)}}:void 0)),isError:l.isError};if(l instanceof Fn)return{type:"image_url",value:{mimeType:l.mimeType,data:z.wrap(l.data)}};if(l instanceof qo)return{type:"tool_use",toolCallId:l.callId,name:l.name,parameters:l.input};if(l instanceof Tt)return{type:"text",value:l.value};if(l instanceof D0)return{type:"extra_data",kind:l.kind,data:l.data};if(typeof l!="string")throw new Error("Unexpected chat message content type llm 2");return{type:"text",value:l}});return{role:s,name:n,content:a}}e.from=i})(Vu||(Vu={}));var zu;(function(e){function t(r){return{kind:"markdownContent",content:ve.from(r.value)}}e.from=t;function i(r){return new xp(ve.to(r.content))}e.to=i})(zu||(zu={}));var Zp;(function(e){function t(r){return{kind:"codeblockUri",uri:r.value,isEdit:r.isEdit}}e.from=t;function i(r){return new Ip(b.revive(r.uri),r.isEdit)}e.to=i})(Zp||(Zp={}));var eg;(function(e){function t(r){return{kind:"markdownVuln",content:ve.from(r.value),vulnerabilities:r.vulnerabilities}}e.from=t;function i(r){return new Pu(ve.to(r.content),r.vulnerabilities)}e.to=i})(eg||(eg={}));var tg;(function(e){function t(i){return{kind:"confirmation",title:i.title,message:i.message,data:i.data,buttons:i.buttons}}e.from=t})(tg||(tg={}));var qu;(function(e){function t(r){const{value:s,baseUri:n}=r;function o(a,l){return a.map(c=>{const u=b.joinPath(l,c.name);return{label:c.name,uri:u,children:c.children&&o(c.children,u)}})}return{kind:"treeData",treeData:{label:ir(n),uri:n,children:o(s,n)}}}e.from=t;function i(r){const s=kt(r.treeData);function n(l){return l.map(c=>({name:c.label,children:c.children&&n(c.children)}))}const o=s.uri,a=s.children?n(s.children):[];return new Cp(a,o)}e.to=i})(qu||(qu={}));var Ll;(function(e){function t(r){const s=o=>b.isUri(o),n=o=>"name"in o;return{kind:"inlineReference",name:r.title,inlineReference:s(r.value)?r.value:n(r.value)?jo.from(r.value):cs.from(r.value)}}e.from=t;function i(r){const s=kt(r);return new Tu(b.isUri(s.inlineReference)?s.inlineReference:"location"in s.inlineReference?jo.to(s.inlineReference):cs.to(s.inlineReference),r.name)}e.to=i})(Ll||(Ll={}));var ju;(function(e){function t(r){return{kind:"progressMessage",content:ve.from(r.value)}}e.from=t;function i(r){return new y0(r.content.value)}e.to=i})(ju||(ju={}));var Gu;(function(e){function t(r){return{kind:"warning",content:ve.from(r.value)}}e.from=t;function i(r){return new Au(r.content.value)}e.to=i})(Gu||(Gu={}));var rw;(function(e){function t(i){return{kind:"extensions",extensions:i.extensions}}e.from=t})(rw||(rw={}));var sw;(function(e){function t(r){return{kind:"move",uri:r.uri,range:F.from(r.range)}}e.from=t;function i(r){return new Tp(b.revive(r.uri),F.to(r.range))}e.to=i})(sw||(sw={}));var ig;(function(e){function t(i){return{kind:"progressTask",content:ve.from(i.value)}}e.from=t})(ig||(ig={}));var nw;(function(e){function t(i){return{kind:"progressTaskResult",content:typeof i=="string"?ve.from(i):void 0}}e.from=t})(nw||(nw={}));var Qu;(function(e){function t(r,s,n){return{kind:"command",command:s.toInternal(r.value,n)??{command:r.value.command,title:r.value.title}}}e.from=t;function i(r,s){return new kp(s.fromInternal(r.command)??{command:r.command.id,title:r.command.title})}e.to=i})(Qu||(Qu={}));var rg;(function(e){function t(r){return{kind:"textEdit",uri:r.uri,edits:r.edits.map(s=>Gt.from(s)),done:r.isDone}}e.from=t;function i(r){const s=new Ru(b.revive(r.uri),r.edits.map(n=>Gt.to(n)));return s.isDone=r.done,s}e.to=i})(rg||(rg={}));var sg;(function(e){function t(i){return i.newCellMetadata?{editType:3,index:i.range.start,metadata:i.newCellMetadata}:i.newNotebookMetadata?{editType:5,metadata:i.newNotebookMetadata}:{editType:1,index:i.range.start,count:i.range.end-i.range.start,cells:i.newCells.map(kl.from)}}e.from=t})(sg||(sg={}));var ng;(function(e){function t(i){return{kind:"notebookEdit",uri:i.uri,edits:i.edits.map(sg.from),done:i.isDone}}e.from=t})(ng||(ng={}));var Xo;(function(e){function t(r){const s=Wt.isThemeIcon(r.iconPath)?r.iconPath:b.isUri(r.iconPath)?{light:b.revive(r.iconPath)}:r.iconPath&&"light"in r.iconPath&&"dark"in r.iconPath&&b.isUri(r.iconPath.light)&&b.isUri(r.iconPath.dark)?{light:b.revive(r.iconPath.light),dark:b.revive(r.iconPath.dark)}:void 0;return typeof r.value=="object"&&"variableName"in r.value?{kind:"reference",reference:{variableName:r.value.variableName,value:b.isUri(r.value.value)||!r.value.value?r.value.value:cs.from(r.value.value)},iconPath:s,options:r.options}:{kind:"reference",reference:b.isUri(r.value)||typeof r.value=="string"?r.value:cs.from(r.value),iconPath:s,options:r.options}}e.from=t;function i(r){const s=kt(r),n=o=>b.isUri(o)?o:cs.to(o);return new zo(typeof s.reference=="string"?s.reference:"variableName"in s.reference?{variableName:s.reference.variableName,value:s.reference.value&&n(s.reference.value)}:n(s.reference))}e.to=i})(Xo||(Xo={}));var og;(function(e){function t(i){return{kind:"codeCitation",value:i.value,license:i.license,snippet:i.snippet}}e.from=t})(og||(og={}));var ag;(function(e){function t(s,n,o){return s instanceof xp?zu.from(s):s instanceof Tu?Ll.from(s):s instanceof zo?Xo.from(s):s instanceof y0?ju.from(s):s instanceof Cp?qu.from(s):s instanceof kp?Qu.from(s,n,o):s instanceof Ru?rg.from(s):s instanceof Ap?ng.from(s):s instanceof Pu?eg.from(s):s instanceof Ip?Zp.from(s):s instanceof Au?Gu.from(s):s instanceof Ep?tg.from(s):s instanceof Pp?og.from(s):s instanceof Tp?sw.from(s):s instanceof b0?rw.from(s):{kind:"markdownContent",content:ve.from("")}}e.from=t;function i(s,n){switch(s.kind){case"reference":return Xo.to(s);case"markdownContent":case"inlineReference":case"progressMessage":case"treeData":case"command":return r(s,n)}}e.to=i;function r(s,n){switch(s.kind){case"markdownContent":return zu.to(s);case"inlineReference":return Ll.to(s);case"progressMessage":return;case"treeData":return qu.to(s);case"command":return Qu.to(s,n)}}e.toContent=r})(ag||(ag={}));var lg;(function(e){function t(i,r,s,n,o,a,l){const c=i.variables.variables.filter(f=>f.kind==="tool"),u=i.variables.variables.filter(f=>f.kind!=="tool"),d={id:i.requestId,prompt:i.message,command:i.command,attempt:i.attempt??0,enableCommandDetection:i.enableCommandDetection??!0,isParticipantDetected:i.isParticipantDetected??!1,references:u.map(f=>cg.to(f,n)),toolReferences:c.map(ug.to),location:Ju.to(i.location),acceptedConfirmationData:i.acceptedConfirmationData,rejectedConfirmationData:i.rejectedConfirmationData,location2:r,toolInvocationToken:Object.freeze({sessionId:i.sessionId}),toolSelection:o,tools:a,model:s,editedFileEvents:i.editedFileEvents};return nt(l,"chatParticipantPrivate")||(delete d.id,delete d.attempt,delete d.enableCommandDetection,delete d.isParticipantDetected,delete d.location,delete d.location2,delete d.editedFileEvents),nt(l,"chatParticipantAdditions")||(delete d.acceptedConfirmationData,delete d.rejectedConfirmationData,delete d.tools),d}e.to=t})(lg||(lg={}));var ow;(function(e){function t(i){return{prompt:i.prompt,files:i.files.map(r=>b.revive(r))}}e.to=t})(ow||(ow={}));var Ju;(function(e){function t(r){switch(r){case fi.Notebook:return Hr.Notebook;case fi.Terminal:return Hr.Terminal;case fi.Panel:return Hr.Panel;case fi.Editor:return Hr.Editor}}e.to=t;function i(r){switch(r){case Hr.Notebook:return fi.Notebook;case Hr.Terminal:return fi.Terminal;case Hr.Panel:return fi.Panel;case Hr.Editor:return fi.Editor}}e.from=i})(Ju||(Ju={}));var cg;(function(e){function t(i,r){let s=i.value;if(!s)throw new Error("Invalid value reference");if(mh(s))s=b.revive(s);else if(s&&typeof s=="object"&&"uri"in s&&"range"in s&&mh(s.uri))s=cs.to(kt(s));else if(aH(i)){const n=i.references?.[0]?.reference;s=new H4(i.mimeType??"image/png",()=>Promise.resolve(new Uint8Array(Object.values(i.value))),n&&b.isUri(n)?n:void 0)}else if(i.kind==="diagnostic"){const n=i.filterSeverity&&Mu.to(i.filterSeverity),o=i.filterUri&&b.revive(i.filterUri).toString();s=new U4(r.map(([a,l])=>i.filterUri&&a.toString()!==o?[a,[]]:[a,l.filter(c=>!(n&&c.severity>n||i.filterRange&&!je.areIntersectingOrTouching(i.filterRange,F.from(c.range))))]).filter(([,a])=>a.length>0))}return{id:i.id,name:i.name,range:i.range&&[i.range.start,i.range.endExclusive],value:s,modelDescription:i.modelDescription}}e.to=t})(cg||(cg={}));var ug;(function(e){function t(i){if(i.value)throw new Error("Invalid tool reference");return{name:i.id,range:i.range&&[i.range.start,i.range.endExclusive]}}e.to=t})(ug||(ug={}));var aw;(function(e){function t(i,r,s){return{id:i.id,label:i.label,fullName:i.fullName,icon:i.icon?.id,value:i.values[0].value,insertText:i.insertText,detail:i.detail,documentation:i.documentation,command:r.toInternal(i.command,s)}}e.from=t})(aw||(aw={}));var Nl;(function(e){function t(s){return{errorDetails:s.errorDetails,metadata:r(s.metadata),nextQuestion:s.nextQuestion}}e.to=t;function i(s){return{errorDetails:s.errorDetails,metadata:s.metadata,nextQuestion:s.nextQuestion}}e.from=i;function r(s){return Ta(s,n=>{if(n.$mid===20)return new Np(Ta(n.content,r));if(n.$mid===21)return new Tt(n.value);if(n.$mid===22)return new ls(n.value)})}})(Nl||(Nl={}));var lw;(function(e){function t(i,r,s){if(r.action.kind==="vote")return;const n=Nl.to(i);if(r.action.kind==="command"){const o=r.action.commandButton.command;return{action:{kind:"command",commandButton:{command:s.fromInternal(o)??{command:o.id,title:o.title}}},result:n}}else return r.action.kind==="followUp"?{action:{kind:"followUp",followup:Bu.to(r.action.followup)},result:n}:r.action.kind==="inlineChat"?{action:{kind:"editor",accepted:r.action.action==="accepted"},result:n}:r.action.kind==="chatEditingSessionAction"?{action:{kind:"chatEditingSessionAction",outcome:new Map([["accepted",Vo.Accepted],["rejected",Vo.Rejected],["saved",Vo.Saved]]).get(r.action.outcome)??Vo.Rejected,uri:b.revive(r.action.uri),hasRemainingEdits:r.action.hasRemainingEdits},result:n}:{action:r.action,result:n}}e.to=t})(lw||(lw={}));var dg;(function(e){function t(i,r,s){return"terminalCommand"in i?{terminalCommand:i.terminalCommand,shouldExecute:i.shouldExecute}:"uri"in i?{uri:i.uri}:r.toInternal(i,s)}e.from=t})(dg||(dg={}));var hg;(function(e){function t(i){return{...i,documentation:ve.fromStrict(i.documentation)}}e.from=t})(hg||(hg={}));var cw;(function(e){function t(i){return Array.isArray(i)?{items:i.map(r=>hg.from(r))}:{items:i.items.map(r=>hg.from(r)),resourceRequestConfig:i.resourceRequestConfig?uw.from(i.resourceRequestConfig):void 0}}e.from=t})(cw||(cw={}));var uw;(function(e){function t(i){return{...i,pathSeparator:Ve?"\\":"/",cwd:i.cwd?b.revive(i.cwd):void 0}}e.from=t})(uw||(uw={}));var dw;(function(e){function t(i){return{kind:hw.to(i.kind),acceptedLength:i.acceptedLength}}e.to=t})(dw||(dw={}));var hw;(function(e){function t(i){switch(i){case 0:return No.Word;case 1:return No.Line;case 2:return No.Suggest;default:return No.Unknown}}e.to=t})(hw||(hw={}));var fw;(function(e){function t(i,r){if(i.kind===Jh.Ignored){const s=i.supersededBy?r(i.supersededBy):void 0;return{kind:el.Ignored,supersededBy:s,userTypingDisagreed:i.userTypingDisagreed}}else if(i.kind===Jh.Accepted)return{kind:el.Accepted};return{kind:el.Rejected}}e.to=t})(fw||(fw={}));var pw;(function(e){function t(i,r){return{id:r,label:i.label,description:i.description,canEdit:i.canEdit,collapsibleState:i.collapsibleState||0,contextValue:i.contextValue}}e.from=t})(pw||(pw={}));var Z4;(function(e){function t(i){return{name:i.id,description:i.modelDescription,inputSchema:i.inputSchema,tags:i.tags??[]}}e.to=t})(Z4||(Z4={}));var e5;(function(e){function t(r){return new Np(r.content.map(s=>s.kind==="text"?new Tt(s.value):new ls(s.value)))}e.to=t;function i(r,s){return r.toolResultMessage&&M(s,"chatParticipantPrivate"),{content:r.content.map(n=>{if(n instanceof Tt)return{kind:"text",value:n.value};if(n instanceof ls)return{kind:"promptTsx",value:n.value};throw new Error("Unknown LanguageModelToolResult part type")}),toolResultMessage:ve.fromStrict(r.toolResultMessage),toolResultDetails:r.toolResultDetails?.map(n=>b.isUri(n)?n:cs.from(n))}}e.from=i})(e5||(e5={}));var fg;(function(e){function t(r){return new V4(r.content.map(s=>{if(s.kind==="text")return new Tt(s.value);if(s.kind==="data"){const n=Object.values(Lp).includes(s.value.mimeType)?s.value.mimeType:void 0;if(!n)throw new Error("Invalid MIME type");return new Fn(s.value.data.buffer,n)}else return new ls(s.value)}))}e.to=t;function i(r,s){r.toolResultMessage&&M(s,"chatParticipantPrivate");let n=!1;const o={content:r.content.map(a=>{if(a instanceof Tt)return{kind:"text",value:a.value};if(a instanceof ls)return{kind:"promptTsx",value:a.value};if(a instanceof Fn)return n=!0,{kind:"data",value:{mimeType:a.mimeType,data:z.wrap(a.data)}};throw new Error("Unknown LanguageModelToolResult part type")}),toolResultMessage:ve.fromStrict(r.toolResultMessage),toolResultDetails:r.toolResultDetails?.map(a=>b.isUri(a)?a:cs.from(a))};return n?new wi(o):o}e.from=i})(fg||(fg={}));var gw;(function(e){function t(i){return i}e.fromThemeIcon=t})(gw||(gw={}));var mw;(function(e){function t(r){return{query:r.query,kind:i(r.kind),settings:r.settings}}e.fromSettingsSearchResult=t;function i(r){switch(r){case $n.EMBEDDED:return $n.EMBEDDED;case $n.LLM_RANKED:return $n.LLM_RANKED;case $n.CANCELED:return $n.CANCELED;default:throw new Error("Unknown AiSettingsSearchResultKind")}}})(mw||(mw={}));var Ku;(function(e){function t(r){return!!r.uri}function i(r){return Nu.toSerialized(t(r)?{type:2,uri:r.uri,headers:Object.entries(r.headers)}:{type:1,cwd:r.cwd,args:r.args,command:r.command,env:r.env,envFile:void 0})}e.from=i})(Ku||(Ku={}));var t5=class LS{constructor(t,i){this.line=t,this.character=i}isBefore(t){return!1}isBeforeOrEqual(t){return!1}isAfter(t){return!1}isAfterOrEqual(t){return!1}isEqual(t){return!1}compareTo(t){return 0}translate(t,i){return new LS(0,0)}with(t){return new LS(0,0)}},i5=class NS{constructor(t,i,r,s){this.isEmpty=!1,this.isSingleLine=!1,this.start=new t5(t,i),this.end=new t5(r,s)}contains(t){return!1}isEqual(t){return!1}intersection(t){}union(t){return new NS(0,0,0,0)}with(t){return new NS(0,0,0,0)}},Gs=class{constructor(e,t,i){this.uri=e,this.ranges=t,this.previewText=i}},pg=class{constructor(e,t,i){this.uri=e,this.text=t,this.lineNumber=i}},vw=class{constructor(e){this.keyword=e}},Qs;(function(e){e[e.None=1]="None",e[e.FilesExclude=2]="FilesExclude",e[e.SearchAndFilesExclude=3]="SearchAndFilesExclude"})(Qs||(Qs={}));var gg;(function(e){e[e.Information=1]="Information",e[e.Warning=2]="Warning"})(gg||(gg={}));var mg=2e4,r5="\u27EA ",s5=" characters skipped \u27EB",SU=(r5.length+s5.length+5)*2,qee=q("searchService"),n5;(function(e){e[e.file=0]="file",e[e.text=1]="text",e[e.aiText=2]="aiText"})(n5||(n5={}));var o5;(function(e){e[e.File=1]="File",e[e.Text=2]="Text",e[e.aiText=3]="aiText"})(o5||(o5={}));function _w(e){return!!e.rangeLocations&&!!e.previewText}var a5;(function(e){e[e.Normal=0]="Normal",e[e.NewSearchStarted=1]="NewSearchStarted"})(a5||(a5={}));var l5=class{constructor(e,t,i,r){this.rangeLocations=[],this.webviewIndex=r;const s=Array.isArray(t)?t:[t];if(i&&i.matchLines===1&&xU(s)){e=u3(e,i.matchLines);let n="",o=0,a=0;const l=Math.floor(i.charsPerLine/5);for(const c of s){const u=Math.max(c.startColumn-l,0),d=c.startColumn+i.charsPerLine;if(u>a+l+SU){const f=r5+(u-a)+s5;n+=f+e.slice(u,d),o+=u-(a+f.length)}else n+=e.slice(a,d);a=d,this.rangeLocations.push({source:c,preview:new EU(0,c.startColumn-o,c.endColumn-o)})}this.previewText=n}else{const n=Array.isArray(t)?t[0].startLineNumber:t.startLineNumber,o=th(t,a=>({preview:new ww(a.startLineNumber-n,a.startColumn,a.endLineNumber-n,a.endColumn),source:a}));this.rangeLocations=Array.isArray(o)?o:[o],this.previewText=e}}};function xU(e){const t=e[0].startLineNumber;for(const i of e)if(i.startLineNumber!==t||i.endLineNumber!==t)return!1;return!0}var ww=class{constructor(e,t,i,r){this.startLineNumber=e,this.startColumn=t,this.endLineNumber=i,this.endColumn=r}},EU=class extends ww{constructor(e,t,i){super(e,t,e,i)}},c5;(function(e){e.List="list",e.Tree="tree"})(c5||(c5={}));var u5;(function(e){e.Default="default",e.FileNames="fileNames",e.Type="type",e.Modified="modified",e.CountDescending="countDescending",e.CountAscending="countAscending"})(u5||(u5={}));function CU(e,t=!0){const i=e&&e.files&&e.files.exclude,r=t&&e&&e.search&&e.search.exclude;if(!i&&!r)return;if(!i||!r)return i||r||void 0;let s=Object.create(null);return s=Is(s,Ye(i)),s=Is(s,Ye(r),!0),s}function d5(e,t){return e.excludePattern&&Va(e.excludePattern,t)?!1:e.includePattern||e.usingSearchPaths?e.includePattern&&Va(e.includePattern,t)?!0:e.usingSearchPaths?!!e.folderQueries&&e.folderQueries.some(i=>{const r=i.folder.fsPath;if(ao(t,r)){const s=Da(r,t);return!i.includePattern||!!Va(i.includePattern,s)}else return!1}):!1:!0}var Bn;(function(e){e[e.unknownEncoding=1]="unknownEncoding",e[e.regexParseError=2]="regexParseError",e[e.globParseError=3]="globParseError",e[e.invalidLiteral=4]="invalidLiteral",e[e.rgProcessError=5]="rgProcessError",e[e.other=6]="other",e[e.canceled=7]="canceled"})(Bn||(Bn={}));var Yo=class extends Error{constructor(e,t){super(e),this.code=t}};function h5(e){const t={message:e.message,code:e.code};return new Error(JSON.stringify(t))}function DU(e){return!!e.path}function yw(e,t,i=!0){const r=e.searchPath?e.searchPath:e.relativePath;return i?l3(r,t):Va(t,r)}function Ml(e,t){const i={...e||{},...t||{}};return Object.keys(i).filter(r=>{const s=i[r];return typeof s=="boolean"&&s})}var f5=class{constructor(e,t){this._parsedIncludeExpression=null,this._excludeExpression=t.excludePattern?.map(r=>({...e.excludePattern||{},...r.pattern||{}}))??[],this._excludeExpression.length===0&&(this._excludeExpression=[e.excludePattern||{}]),this._parsedExcludeExpression=this._excludeExpression.map(r=>Lr(r));let i=e.includePattern;t.includePattern&&(i?i={...i,...t.includePattern}:i=t.includePattern),i&&(this._parsedIncludeExpression=Lr(i))}_evalParsedExcludeExpression(e,t,i){let r=null;for(const s of this._parsedExcludeExpression){const n=s(e,t,i);if(typeof n=="string"){r=n;break}}return r}matchesExcludesSync(e,t,i){return!!(this._parsedExcludeExpression&&this._evalParsedExcludeExpression(e,t,i))}includedInQuerySync(e,t,i){return!(this._parsedExcludeExpression&&this._evalParsedExcludeExpression(e,t,i)||this._parsedIncludeExpression&&!this._parsedIncludeExpression(e,t,i))}includedInQuery(e,t,i){const r=()=>this._parsedIncludeExpression?!!this._parsedIncludeExpression(e,t,i):!0;return Promise.all(this._parsedExcludeExpression.map(s=>{const n=s(e,t,i);return wn(n)?n.then(o=>o?!1:r()):r()})).then(s=>s.some(n=>!!n))}hasSiblingExcludeClauses(){return this._excludeExpression.reduce((e,t)=>kU(t)||e,!1)}};function kU(e){for(const t in e)if(typeof e[t]!="boolean")return!0;return!1}function IU(e){if(!e)return;let t;return i=>(t||(t=(e()||Promise.resolve([])).then(r=>r?p5(r):{})),t.then(r=>!!r[i]))}function bw(e){if(!e)return;let t;return i=>{if(!t){const r=e();t=r?p5(r):{}}return!!t[i]}}function p5(e){const t={};for(const i of e)t[i]=!0;return t}function g5(e){return e.flatMap(t=>t.patterns.map(i=>t.baseUri?{baseUri:t.baseUri,pattern:i}:i))}var Sw={matchLines:100,charsPerLine:1e4},PU=!1,TU=class{constructor(e,t,i){this.id=e,this.dependencies=t,this.callback=i}},Zo;(function(e){e[e.Uninitialized=1]="Uninitialized",e[e.InitializedInternal=2]="InitializedInternal",e[e.InitializedExternal=3]="InitializedExternal"})(Zo||(Zo={}));var AU=class p8{static{this.INSTANCE=new p8}constructor(){this._isWebWorker=typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope",this._isRenderer=typeof document=="object",this._defineCalls=[],this._state=Zo.Uninitialized}_initialize(){if(this._state===Zo.Uninitialized){if(globalThis.define){this._state=Zo.InitializedExternal;return}}else return;this._state=Zo.InitializedInternal,globalThis.define=(t,i,r)=>{typeof t!="string"&&(r=i,i=t,t=null),(typeof i!="object"||!Array.isArray(i))&&(r=i,i=null),this._defineCalls.push(new TU(t,i,r))},globalThis.define.amd=!0,this._isRenderer?this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??window.trustedTypes?.createPolicy("amdLoader",{createScriptURL(t){if(t.startsWith(window.location.origin)||t.startsWith(`${V.vscodeFileResource}://${cE}`))return t;throw new Error(`[trusted_script_src] Invalid script url: ${t}`)}}):this._isWebWorker&&(this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??globalThis.trustedTypes?.createPolicy("amdLoader",{createScriptURL(t){return t}}))}async load(t){if(this._initialize(),this._state===Zo.InitializedExternal)return new Promise(o=>{const a=mt();globalThis.define(a,[t],function(l){o(l)})});const i=await(this._isWebWorker?this._workerLoadScript(t):this._isRenderer?this._rendererLoadScript(t):this._nodeJSLoadScript(t));if(!i){console.warn(`Did not receive a define call from script ${t}`);return}const r={},s=[],n=[];if(Array.isArray(i.dependencies))for(const o of i.dependencies)o==="exports"?s.push(r):n.push(o);if(n.length>0)throw new Error(`Cannot resolve dependencies for script ${t}. The dependencies are: ${n.join(", ")}`);return typeof i.callback=="function"?i.callback(...s)??r:i.callback}_rendererLoadScript(t){return new Promise((i,r)=>{const s=document.createElement("script");s.setAttribute("async","async"),s.setAttribute("type","text/javascript");const n=()=>{s.removeEventListener("load",o),s.removeEventListener("error",a)},o=l=>{n(),i(this._defineCalls.pop())},a=l=>{n(),r(l)};s.addEventListener("load",o),s.addEventListener("error",a),this._amdPolicy&&(t=this._amdPolicy.createScriptURL(t)),s.setAttribute("src",t),window.document.getElementsByTagName("head")[0].appendChild(s)})}async _workerLoadScript(t){return this._amdPolicy&&(t=this._amdPolicy.createScriptURL(t)),await import(t),this._defineCalls.pop()}async _nodeJSLoadScript(t){try{const i=(await import("fs")).default,r=(await import("vm")).default,s=(await import("module")).default,n=b.parse(t).fsPath,o=i.readFileSync(n).toString(),a=s.wrap(o.replace(/^#!.*/,""));return new r.Script(a).runInThisContext().apply(),this._defineCalls.pop()}catch(i){throw i}}},xw=new Map;async function Ew(e,t,i){i===void 0&&(i=!!(globalThis._VSCODE_PRODUCT_JSON??globalThis.vscode?.context?.configuration()?.product)?.commit);const r=t?`${e}/${t}`:e;if(xw.has(r))return xw.get(r);let s;if(/^\w[\w\d+.-]*:\/\//.test(r))s=r;else{const l=`${PU&&i&&!Ca?N3:L3}/${r}`;s=Mv.asBrowserUri(l).toString(!0)}const n=AU.INSTANCE.load(s);return xw.set(r,n),n}var vg="utf8",Cw="utf8bom",_g="utf16be",wg="utf16le",yg=[254,255],Dw=[255,254],Xu=[239,187,191],RU=512,LU=512,NU=512*8,MU=512*128,m5;(function(e){e[e.STREAM_IS_BINARY=1]="STREAM_IS_BINARY"})(m5||(m5={}));var OU=class extends Error{constructor(e,t){super(e),this.decodeStreamErrorKind=t}},FU=class g8{static async create(t){let i;if(t!==vg)i=(await Ew("@vscode/iconv-lite-umd","lib/iconv-lite-umd.js")).getDecoder(v5(t));else{const r=new TextDecoder;i={write(s){return r.decode(s,{stream:!0})},end(){return r.decode()}}}return new g8(i)}constructor(t){this.iconvLiteDecoder=t}write(t){return this.iconvLiteDecoder.write(t)}end(){return this.iconvLiteDecoder.end()}};function $U(e,t){const i=t.minBytesRequiredForDetection??t.guessEncoding?NU:LU;return new Promise((r,s)=>{const n=Sh(d=>d.join("")),o=[];let a=0,l;const c=new rt,u=async()=>{try{const d=await QU({buffer:z.concat(o),bytesRead:a},t.guessEncoding,t.candidateGuessEncodings);if(d.seemsBinary&&t.acceptTextOnly)throw new OU("Stream is binary but only text is accepted for decoding",1);d.encoding=await t.overwriteEncoding(d.encoding),l=await FU.create(d.encoding);const f=l.write(z.concat(o).buffer);n.write(f),o.length=0,a=0,r({stream:n,detected:d})}catch(d){c.cancel(),n.destroy(),s(d)}};Uv(e,{onData:async d=>{l?n.write(l.write(d.buffer)):(o.push(d),a+=d.byteLength,a>=i&&(e.pause(),await u(),setTimeout(()=>e.resume())))},onError:d=>n.error(d),onEnd:async()=>{l||await u(),n.end(l?.end())}},c.token)})}async function HU(e,t,i){const s=(await Ew("@vscode/iconv-lite-umd","lib/iconv-lite-umd.js")).getEncoder(v5(t),i);let n=!1,o=!1;return{read(){if(o)return null;const a=e.read();if(typeof a!="string"){if(o=!0,!n&&i?.addBOM)switch(t){case vg:case Cw:return z.wrap(Uint8Array.from(Xu));case _g:return z.wrap(Uint8Array.from(yg));case wg:return z.wrap(Uint8Array.from(Dw))}const l=s.end();return l&&l.length>0?(n=!0,z.wrap(l)):null}return n=!0,z.wrap(s.write(a))}}}function v5(e){return e===Cw||e===null?vg:e}function UU(e,t){if(!e||t<yg.length)return null;const i=e.readUInt8(0),r=e.readUInt8(1);if(i===yg[0]&&r===yg[1])return _g;if(i===Dw[0]&&r===Dw[1])return wg;if(t<Xu.length)return null;const s=e.readUInt8(2);return i===Xu[0]&&r===Xu[1]&&s===Xu[2]?Cw:null}var WU=["ascii","utf-16","utf-32"];async function BU(e,t){const i=await Ew("jschardet","dist/jschardet.min.js"),r=e.slice(0,MU),s=jU(r.buffer);t&&(t=Et(t.map(a=>qU(a))),t.length===0&&(t=void 0));let n;try{n=i.detect(s,t?{detectEncodings:t}:void 0)}catch{return null}if(!n||!n.encoding)return null;const o=n.encoding.toLowerCase();return 0<=WU.indexOf(o)?null:zU(n.encoding)}var VU={ibm866:"cp866",big5:"cp950"};function _5(e){return e.replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}function zU(e){const t=_5(e);return VU[t]||t}function qU(e){const t=_5(e),i=JU[t];return i?i.guessableName:void 0}function jU(e){let t="";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t}function GU(e){switch(e){case"shiftjis":return"shift-jis";case"utf16le":return"utf-16le";case"utf16be":return"utf-16be";case"big5hkscs":return"big5-hkscs";case"eucjp":return"euc-jp";case"euckr":return"euc-kr";case"koi8r":return"koi8-r";case"koi8u":return"koi8-u";case"macroman":return"x-mac-roman";case"utf8bom":return"utf8";default:{const t=e.match(/windows(\d+)/);return t?"windows-"+t[1]:e}}}function QU({buffer:e,bytesRead:t},i,r){let s=UU(e,t),n=!1;if(s!==_g&&s!==wg&&e){let o=!0,a=!0,l=!1;for(let c=0;c<t&&c<RU;c++){const u=c%2===1,d=e.readUInt8(c)===0;if(d&&(l=!0),o&&(u&&!d||!u&&d)&&(o=!1),a&&(u&&d||!u&&!d)&&(a=!1),d&&!o&&!a)break}l&&(o?s=wg:a?s=_g:n=!0)}return i&&!n&&!s&&e?BU(e.slice(0,t),r).then(o=>({seemsBinary:!1,encoding:o})):{seemsBinary:n,encoding:s}}var kw={utf8:{labelLong:"UTF-8",labelShort:"UTF-8",order:1,alias:"utf8bom",guessableName:"UTF-8"},utf8bom:{labelLong:"UTF-8 with BOM",labelShort:"UTF-8 with BOM",encodeOnly:!0,order:2,alias:"utf8"},utf16le:{labelLong:"UTF-16 LE",labelShort:"UTF-16 LE",order:3,guessableName:"UTF-16LE"},utf16be:{labelLong:"UTF-16 BE",labelShort:"UTF-16 BE",order:4,guessableName:"UTF-16BE"},windows1252:{labelLong:"Western (Windows 1252)",labelShort:"Windows 1252",order:5,guessableName:"windows-1252"},iso88591:{labelLong:"Western (ISO 8859-1)",labelShort:"ISO 8859-1",order:6},iso88593:{labelLong:"Western (ISO 8859-3)",labelShort:"ISO 8859-3",order:7},iso885915:{labelLong:"Western (ISO 8859-15)",labelShort:"ISO 8859-15",order:8},macroman:{labelLong:"Western (Mac Roman)",labelShort:"Mac Roman",order:9},cp437:{labelLong:"DOS (CP 437)",labelShort:"CP437",order:10},windows1256:{labelLong:"Arabic (Windows 1256)",labelShort:"Windows 1256",order:11},iso88596:{labelLong:"Arabic (ISO 8859-6)",labelShort:"ISO 8859-6",order:12},windows1257:{labelLong:"Baltic (Windows 1257)",labelShort:"Windows 1257",order:13},iso88594:{labelLong:"Baltic (ISO 8859-4)",labelShort:"ISO 8859-4",order:14},iso885914:{labelLong:"Celtic (ISO 8859-14)",labelShort:"ISO 8859-14",order:15},windows1250:{labelLong:"Central European (Windows 1250)",labelShort:"Windows 1250",order:16,guessableName:"windows-1250"},iso88592:{labelLong:"Central European (ISO 8859-2)",labelShort:"ISO 8859-2",order:17,guessableName:"ISO-8859-2"},cp852:{labelLong:"Central European (CP 852)",labelShort:"CP 852",order:18},windows1251:{labelLong:"Cyrillic (Windows 1251)",labelShort:"Windows 1251",order:19,guessableName:"windows-1251"},cp866:{labelLong:"Cyrillic (CP 866)",labelShort:"CP 866",order:20,guessableName:"IBM866"},cp1125:{labelLong:"Cyrillic (CP 1125)",labelShort:"CP 1125",order:21,guessableName:"IBM1125"},iso88595:{labelLong:"Cyrillic (ISO 8859-5)",labelShort:"ISO 8859-5",order:22,guessableName:"ISO-8859-5"},koi8r:{labelLong:"Cyrillic (KOI8-R)",labelShort:"KOI8-R",order:23,guessableName:"KOI8-R"},koi8u:{labelLong:"Cyrillic (KOI8-U)",labelShort:"KOI8-U",order:24},iso885913:{labelLong:"Estonian (ISO 8859-13)",labelShort:"ISO 8859-13",order:25},windows1253:{labelLong:"Greek (Windows 1253)",labelShort:"Windows 1253",order:26,guessableName:"windows-1253"},iso88597:{labelLong:"Greek (ISO 8859-7)",labelShort:"ISO 8859-7",order:27,guessableName:"ISO-8859-7"},windows1255:{labelLong:"Hebrew (Windows 1255)",labelShort:"Windows 1255",order:28,guessableName:"windows-1255"},iso88598:{labelLong:"Hebrew (ISO 8859-8)",labelShort:"ISO 8859-8",order:29,guessableName:"ISO-8859-8"},iso885910:{labelLong:"Nordic (ISO 8859-10)",labelShort:"ISO 8859-10",order:30},iso885916:{labelLong:"Romanian (ISO 8859-16)",labelShort:"ISO 8859-16",order:31},windows1254:{labelLong:"Turkish (Windows 1254)",labelShort:"Windows 1254",order:32},iso88599:{labelLong:"Turkish (ISO 8859-9)",labelShort:"ISO 8859-9",order:33},windows1258:{labelLong:"Vietnamese (Windows 1258)",labelShort:"Windows 1258",order:34},gbk:{labelLong:"Simplified Chinese (GBK)",labelShort:"GBK",order:35},gb18030:{labelLong:"Simplified Chinese (GB18030)",labelShort:"GB18030",order:36},cp950:{labelLong:"Traditional Chinese (Big5)",labelShort:"Big5",order:37,guessableName:"Big5"},big5hkscs:{labelLong:"Traditional Chinese (Big5-HKSCS)",labelShort:"Big5-HKSCS",order:38},shiftjis:{labelLong:"Japanese (Shift JIS)",labelShort:"Shift JIS",order:39,guessableName:"SHIFT_JIS"},eucjp:{labelLong:"Japanese (EUC-JP)",labelShort:"EUC-JP",order:40,guessableName:"EUC-JP"},euckr:{labelLong:"Korean (EUC-KR)",labelShort:"EUC-KR",order:41,guessableName:"EUC-KR"},windows874:{labelLong:"Thai (Windows 874)",labelShort:"Windows 874",order:42},iso885911:{labelLong:"Latin/Thai (ISO 8859-11)",labelShort:"ISO 8859-11",order:43},koi8ru:{labelLong:"Cyrillic (KOI8-RU)",labelShort:"KOI8-RU",order:44},koi8t:{labelLong:"Tajik (KOI8-T)",labelShort:"KOI8-T",order:45},gb2312:{labelLong:"Simplified Chinese (GB 2312)",labelShort:"GB 2312",order:46,guessableName:"GB2312"},cp865:{labelLong:"Nordic DOS (CP 865)",labelShort:"CP 865",order:47},cp850:{labelLong:"Western European DOS (CP 850)",labelShort:"CP 850",order:48}},JU=(()=>{const e={};for(const t in kw)kw[t].guessableName&&(e[t]=kw[t]);return e})(),jee=q("textFileService"),w5;(function(e){e[e.FILE_IS_BINARY=0]="FILE_IS_BINARY"})(w5||(w5={}));var y5;(function(e){e[e.SAVED=0]="SAVED",e[e.DIRTY=1]="DIRTY",e[e.PENDING_SAVE=2]="PENDING_SAVE",e[e.CONFLICT=3]="CONFLICT",e[e.ORPHAN=4]="ORPHAN",e[e.ERROR=5]="ERROR"})(y5||(y5={}));var b5;(function(e){e[e.EDITOR=1]="EDITOR",e[e.REFERENCE=2]="REFERENCE",e[e.OTHER=3]="OTHER"})(b5||(b5={}));var S5;(function(e){e[e.Encode=0]="Encode",e[e.Decode=1]="Decode"})(S5||(S5={}));function KU(e){let t=!1;return{read(){return t?null:(t=!0,e)}}}function Yu(e,t,i){return new yc(r=>Iw(r,i)).isEqual(e,t)}function XU(e,t,i){return Yu(e.uri,t.uri,i)?0:oo(e.uri.toString(),t.uri.toString())}function YU(e,t,i){return e.index!==t.index?e.index<t.index?-1:1:Yu(e.uri,t.uri,i)?oo(e.name,t.name):oo(e.uri.toString(),t.uri.toString())}function x5(e,t,i,r){const s=e.slice(0).sort((o,a)=>i(o,a,r)),n=t.slice(0).sort((o,a)=>i(o,a,r));return $R(s,n,(o,a)=>i(o,a,r))}function Iw(e,t){const i=t.getCapabilities(e.scheme);return!(i&&i&1024)}var Pw=class MS extends eO{static toExtHostWorkspace(t,i,r,s){if(!t)return{workspace:null,added:[],removed:[]};const{id:n,name:o,folders:a,configuration:l,transient:c,isUntitled:u}=t,d=[],f=i;i?a.forEach((y,S)=>{const x=b.revive(y.uri),P=MS._findFolder(r||i,x,s);P?(P.name=y.name,P.index=y.index,d.push(P)):d.push({uri:x,name:y.name,index:S})}):d.push(...a.map(({uri:y,name:S,index:x})=>({uri:b.revive(y),name:S,index:x}))),d.sort((y,S)=>y.index<S.index?-1:1);const p=new MS(n,o,d,!!c,l?b.revive(l):null,!!u,y=>Iw(y,s)),{added:g,removed:v}=x5(f?f.workspaceFolders:[],p.workspaceFolders,XU,s);return{workspace:p,added:g,removed:v}}static _findFolder(t,i,r){for(let s=0;s<t.folders.length;s++){const n=t.workspaceFolders[s];if(Yu(n.uri,i,r))return n}}constructor(t,i,r,s,n,o,a){super(t,r.map(l=>new _1(l)),s,n,a),this._name=i,this._isUntitled=o,this._workspaceFolders=[],this._structure=xn.forUris(a,()=>!0),r.forEach(l=>{this._workspaceFolders.push(l),this._structure.set(l.uri,l)})}get name(){return this._name}get isUntitled(){return this._isUntitled}get workspaceFolders(){return this._workspaceFolders.slice(0)}getWorkspaceFolder(t,i){return i&&this._structure.get(t)&&(t=bc(t)),this._structure.findSubstr(t)}resolveWorkspaceFolder(t){return this._structure.get(t)}},Tw=class{constructor(t,i,r,s,n){this._onDidChangeWorkspace=new D,this.onDidChangeWorkspace=this._onDidChangeWorkspace.event,this._onDidGrantWorkspaceTrust=new D,this.onDidGrantWorkspaceTrust=this._onDidGrantWorkspaceTrust.event,this._activeSearchCallbacks=[],this._trusted=!1,this._editSessionIdentityProviders=new Map,this._providerHandlePool=0,this._onWillCreateEditSessionIdentityEvent=new pc,this._canonicalUriProviders=new Map,this._logService=s,this._extHostFileSystemInfo=r,this._uriTransformerService=n,this._requestIdProvider=new JM,this._barrier=new dr,this._proxy=t.getProxy(Q.MainThreadWorkspace),this._messageService=t.getProxy(Q.MainThreadMessageService);const o=i.workspace;this._confirmedWorkspace=o?new Pw(o.id,o.name,[],!!o.transient,o.configuration?b.revive(o.configuration):null,!!o.isUntitled,a=>Iw(a,r)):void 0}$initializeWorkspace(t,i){this._trusted=i,this.$acceptWorkspaceData(t),this._barrier.open()}waitForInitializeCall(){return this._barrier.wait()}get workspace(){return this._actualWorkspace}get name(){return this._actualWorkspace?this._actualWorkspace.name:void 0}get workspaceFile(){if(this._actualWorkspace&&this._actualWorkspace.configuration)return this._actualWorkspace.isUntitled?b.from({scheme:V.untitled,path:ir(bc(this._actualWorkspace.configuration))}):this._actualWorkspace.configuration}get _actualWorkspace(){return this._unconfirmedWorkspace||this._confirmedWorkspace}getWorkspaceFolders(){if(this._actualWorkspace)return this._actualWorkspace.workspaceFolders.slice(0)}async getWorkspaceFolders2(){if(await this._barrier.wait(),!!this._actualWorkspace)return this._actualWorkspace.workspaceFolders.slice(0)}updateWorkspaceFolders(t,i,r,...s){const n=[];if(Array.isArray(s)&&s.forEach(u=>{b.isUri(u.uri)&&!n.some(d=>Yu(d.uri,u.uri,this._extHostFileSystemInfo))&&n.push({uri:u.uri,name:u.name||Fv(u.uri)})}),this._unconfirmedWorkspace||[i,r].some(u=>typeof u!="number"||u<0)||r===0&&n.length===0)return!1;const o=this._actualWorkspace?this._actualWorkspace.workspaceFolders:[];if(i+r>o.length)return!1;const a=o.slice(0);a.splice(i,r,...n.map(u=>({uri:u.uri,name:u.name||Fv(u.uri),index:void 0})));for(let u=0;u<a.length;u++){const d=a[u];if(a.some((f,p)=>p!==u&&Yu(d.uri,f.uri,this._extHostFileSystemInfo)))return!1}a.forEach((u,d)=>u.index=d);const{added:l,removed:c}=x5(o,a,YU,this._extHostFileSystemInfo);if(l.length===0&&c.length===0)return!1;if(this._proxy){const u=t.displayName||t.name;this._proxy.$updateWorkspaceFolders(u,i,r,n).then(void 0,d=>{this._unconfirmedWorkspace=void 0;const f={source:{identifier:t.identifier,label:t.displayName||t.name}};this._messageService.$showMessage(XM.Error,h(2942,null,u,d.toString()),f,[])})}return this.trySetWorkspaceFolders(a),!0}getWorkspaceFolder(t,i){if(this._actualWorkspace)return this._actualWorkspace.getWorkspaceFolder(t,i)}async getWorkspaceFolder2(t,i){if(await this._barrier.wait(),!!this._actualWorkspace)return this._actualWorkspace.getWorkspaceFolder(t,i)}async resolveWorkspaceFolder(t){if(await this._barrier.wait(),!!this._actualWorkspace)return this._actualWorkspace.resolveWorkspaceFolder(t)}getPath(){if(!this._actualWorkspace)return;const{folders:t}=this._actualWorkspace;if(t.length!==0)return t[0].uri.fsPath}getRelativePath(t,i){let r,s="";if(typeof t=="string"?(r=b.file(t),s=t):typeof t<"u"&&(r=t,s=t.fsPath),!r)return s;const n=this.getWorkspaceFolder(r,!0);if(!n)return s;typeof i>"u"&&this._actualWorkspace&&(i=this._actualWorkspace.folders.length>1);let o=hE(n.uri,r);return i&&n.name&&(o=`${n.name}/${o}`),o}trySetWorkspaceFolders(t){this._actualWorkspace&&(this._unconfirmedWorkspace=Pw.toExtHostWorkspace({id:this._actualWorkspace.id,name:this._actualWorkspace.name,configuration:this._actualWorkspace.configuration,folders:t,isUntitled:this._actualWorkspace.isUntitled},this._actualWorkspace,void 0,this._extHostFileSystemInfo).workspace||void 0)}$acceptWorkspaceData(t){const{workspace:i,added:r,removed:s}=Pw.toExtHostWorkspace(t,this._confirmedWorkspace,this._unconfirmedWorkspace,this._extHostFileSystemInfo);this._confirmedWorkspace=i||void 0,this._unconfirmedWorkspace=void 0,this._onDidChangeWorkspace.fire(Object.freeze({added:r,removed:s}))}findFiles(t,i,r,s,n=Be.None){this._logService.trace(`extHostWorkspace#findFiles: fileSearch, extension: ${s.value}, entryPoint: findFiles`);let o="",a=!0;return i===null?a=!1:i!==void 0&&(typeof i=="string"?o=i:o=i.pattern),this._findFilesImpl({type:"include",value:t},{exclude:[o],maxResults:r,useExcludeSettings:a?Qs.FilesExclude:Qs.None,useIgnoreFiles:{local:!1}},n)}findFiles2(t,i={},r,s=Be.None){return this._logService.trace(`extHostWorkspace#findFiles2New: fileSearch, extension: ${r.value}, entryPoint: findFiles2New`),this._findFilesImpl({type:"filePatterns",value:t},i,s)}async _findFilesImpl(t,i,r){if(r.isCancellationRequested)return Promise.resolve([]);const s=t.type==="include"?[t.value]:t.value??[];if(!Array.isArray(s))throw console.error("Invalid file pattern provided",s),new Error(`Invalid file pattern provided ${JSON.stringify(s)}`);const n=s.map(o=>{const a=E5(i.exclude),l={ignoreSymlinks:typeof i.followSymlinks=="boolean"?!i.followSymlinks:void 0,disregardIgnoreFiles:typeof i.useIgnoreFiles?.local=="boolean"?!i.useIgnoreFiles.local:void 0,disregardGlobalIgnoreFiles:typeof i.useIgnoreFiles?.global=="boolean"?!i.useIgnoreFiles.global:void 0,disregardParentIgnoreFiles:typeof i.useIgnoreFiles?.parent=="boolean"?!i.useIgnoreFiles.parent:void 0,disregardExcludeSettings:i.useExcludeSettings!==void 0&&i.useExcludeSettings===Qs.None,disregardSearchExcludeSettings:i.useExcludeSettings!==void 0&&i.useExcludeSettings!==Qs.SearchAndFilesExclude,maxResults:i.maxResults,excludePattern:a.length>0?a:void 0,_reason:"startFileSearch",shouldGlobSearch:t.type==="include"?void 0:!0},c=bg(Ji.from(o)),u=c?.folder;return t.type==="include"?l.includePattern=c?.pattern:l.filePattern=c?.pattern,{folder:u,options:l}});return this._findFilesBase(n,r)}async _findFilesBase(t,i){return(await Promise.all(t?.map(s=>this._proxy.$startFileSearch(s.folder??null,s.options,i).then(n=>Array.isArray(n)?n.map(o=>b.revive(o)):[]))??[])).flat()}findTextInFiles2(t,i,r,s=Be.None){this._logService.trace(`extHostWorkspace#findTextInFiles2: textSearch, extension: ${r.value}, entryPoint: findTextInFiles2`);const n=f=>{if(!i)return{folder:void 0,options:{}};const p=f?bg(Ji.from(f)):void 0,g=i.exclude?E5(i.exclude):void 0;return{options:{ignoreSymlinks:typeof i.followSymlinks=="boolean"?!i.followSymlinks:void 0,disregardIgnoreFiles:typeof i.useIgnoreFiles=="boolean"?!i.useIgnoreFiles:void 0,disregardGlobalIgnoreFiles:typeof i.useIgnoreFiles?.global=="boolean"?!i.useIgnoreFiles?.global:void 0,disregardParentIgnoreFiles:typeof i.useIgnoreFiles?.parent=="boolean"?!i.useIgnoreFiles?.parent:void 0,disregardExcludeSettings:i.useExcludeSettings!==void 0&&i.useExcludeSettings===Qs.None,disregardSearchExcludeSettings:i.useExcludeSettings!==void 0&&i.useExcludeSettings!==Qs.SearchAndFilesExclude,fileEncoding:i.encoding,maxResults:i.maxResults,previewOptions:i.previewOptions?{matchLines:i.previewOptions?.numMatchLines??100,charsPerLine:i.previewOptions?.charsPerLine??1e4}:void 0,surroundingContext:i.surroundingContext,includePattern:p?.pattern,excludePattern:g},folder:p?.folder}},a=(i?.include?.map(f=>n(f))??[n(void 0)]).filter(f=>!!f),l=new oe,c=l.add(new D),u=this.findTextInFilesBase(t,a,(f,p)=>c.fire({result:f,uri:p}),s);return{results:new Sc(async f=>{l.add(c.event(p=>{const g=p.result,v=p.uri;_w(g)?f.emitOne(new Gs(v,g.rangeLocations.map(y=>({previewRange:new Se(y.preview.startLineNumber,y.preview.startColumn,y.preview.endLineNumber,y.preview.endColumn),sourceRange:new Se(y.source.startLineNumber,y.source.startColumn,y.source.endLineNumber,y.source.endColumn)})),g.previewText)):f.emitOne(new pg(v,g.text,g.lineNumber))})),await u}),complete:u.then(f=>(l.dispose(),{limitHit:f?.limitHit??!1}))}}async findTextInFilesBase(t,i,r,s=Be.None){const n=this._requestIdProvider.getNext();let o=!1;if(s.onCancellationRequested(a=>{o=!0}),this._activeSearchCallbacks[n]=a=>{if(o)return;const l=b.revive(a.resource);a.results.forEach(c=>{const u=kt(c);r(u,l)})},s.isCancellationRequested)return{};try{const a=await Promise.all(i?.map(l=>this._proxy.$startTextSearch(t,l.folder??null,l.options,n,s)||{})??[]);return delete this._activeSearchCallbacks[n],a.reduce((l,c)=>({limitHit:l?.limitHit||(c?.limitHit??!1),message:[l?.message??[],c?.message??[]].flat()}),{})??{limitHit:!1}}catch(a){throw delete this._activeSearchCallbacks[n],a}}async findTextInFiles(t,i,r,s,n=Be.None){this._logService.trace(`extHostWorkspace#findTextInFiles: textSearch, extension: ${s.value}, entryPoint: findTextInFiles`);const o=typeof i.previewOptions>"u"?{matchLines:100,charsPerLine:1e4}:i.previewOptions,a=bg(Ji.from(i.include)),l=typeof i.exclude=="string"?i.exclude:i.exclude?i.exclude.pattern:void 0,c={ignoreSymlinks:typeof i.followSymlinks=="boolean"?!i.followSymlinks:void 0,disregardIgnoreFiles:typeof i.useIgnoreFiles=="boolean"?!i.useIgnoreFiles:void 0,disregardGlobalIgnoreFiles:typeof i.useGlobalIgnoreFiles=="boolean"?!i.useGlobalIgnoreFiles:void 0,disregardParentIgnoreFiles:typeof i.useParentIgnoreFiles=="boolean"?!i.useParentIgnoreFiles:void 0,disregardExcludeSettings:typeof i.useDefaultExcludes=="boolean"?!i.useDefaultExcludes:!0,disregardSearchExcludeSettings:typeof i.useSearchExclude=="boolean"?!i.useSearchExclude:!0,fileEncoding:i.encoding,maxResults:i.maxResults,previewOptions:o,surroundingContext:i.afterContext,includePattern:a?.pattern,excludePattern:l?[{pattern:l}]:void 0},u=(d,f)=>{_w(d)?r({uri:f,preview:{text:d.previewText,matches:th(d.rangeLocations,p=>new Se(p.preview.startLineNumber,p.preview.startColumn,p.preview.endLineNumber,p.preview.endColumn))},ranges:th(d.rangeLocations,p=>new Se(p.source.startLineNumber,p.source.startColumn,p.source.endLineNumber,p.source.endColumn))}):r({uri:f,text:d.text,lineNumber:d.lineNumber})};return this.findTextInFilesBase(t,[{options:c,folder:a?.folder}],u,n)}$handleTextSearchResult(t,i){this._activeSearchCallbacks[i]?.(t)}async save(t){const i=await this._proxy.$save(t,{saveAs:!1});return b.revive(i)}async saveAs(t){const i=await this._proxy.$save(t,{saveAs:!0});return b.revive(i)}saveAll(t){return this._proxy.$saveAll(t)}resolveProxy(t){return this._proxy.$resolveProxy(t)}lookupAuthorization(t){return this._proxy.$lookupAuthorization(t)}lookupKerberosAuthorization(t){return this._proxy.$lookupKerberosAuthorization(t)}loadCertificates(){return this._proxy.$loadCertificates()}get trusted(){return this._trusted}requestWorkspaceTrust(t){return this._proxy.$requestWorkspaceTrust(t)}$onDidGrantWorkspaceTrust(){this._trusted||(this._trusted=!0,this._onDidGrantWorkspaceTrust.fire())}registerEditSessionIdentityProvider(t,i){if(this._editSessionIdentityProviders.has(t))throw new Error(`A provider has already been registered for scheme ${t}`);this._editSessionIdentityProviders.set(t,i);const r=this._uriTransformerService.transformOutgoingScheme(t),s=this._providerHandlePool++;return this._proxy.$registerEditSessionIdentityProvider(s,r),ie(()=>{this._editSessionIdentityProviders.delete(t),this._proxy.$unregisterEditSessionIdentityProvider(s)})}async $getEditSessionIdentifier(t,i){this._logService.info("Getting edit session identifier for workspaceFolder",t);const r=await this.resolveWorkspaceFolder(b.revive(t));if(!r){this._logService.warn("Unable to resolve workspace folder");return}this._logService.info("Invoking #provideEditSessionIdentity for workspaceFolder",r);const s=this._editSessionIdentityProviders.get(r.uri.scheme);if(this._logService.info(`Provider for scheme ${r.uri.scheme} is defined: `,!!s),!s)return;const n=await s.provideEditSessionIdentity(r,i);if(this._logService.info("Provider returned edit session identifier: ",n),!!n)return n}async $provideEditSessionIdentityMatch(t,i,r,s){this._logService.info("Getting edit session identifier for workspaceFolder",t);const n=await this.resolveWorkspaceFolder(b.revive(t));if(!n){this._logService.warn("Unable to resolve workspace folder");return}this._logService.info("Invoking #provideEditSessionIdentity for workspaceFolder",n);const o=this._editSessionIdentityProviders.get(n.uri.scheme);if(this._logService.info(`Provider for scheme ${n.uri.scheme} is defined: `,!!o),!o)return;const a=await o.provideEditSessionIdentityMatch?.(i,r,s);if(this._logService.info("Provider returned edit session identifier match result: ",a),!!a)return a}getOnWillCreateEditSessionIdentityEvent(t){return(i,r,s)=>{const n=function(a){i.call(r,a)};return n.extension=t,this._onWillCreateEditSessionIdentityEvent.event(n,void 0,s)}}async $onWillCreateEditSessionIdentity(t,i,r){const s=await this.resolveWorkspaceFolder(b.revive(t));if(s===void 0)throw new Error("Unable to resolve workspace folder");await this._onWillCreateEditSessionIdentityEvent.fireAsync({workspaceFolder:s},i,async(n,o)=>{const a=Date.now();await Promise.resolve(n),Date.now()-a>r&&this._logService.warn("SLOW edit session create-participant",o.extension.identifier)}),i.isCancellationRequested}registerCanonicalUriProvider(t,i){if(this._canonicalUriProviders.has(t))throw new Error(`A provider has already been registered for scheme ${t}`);this._canonicalUriProviders.set(t,i);const r=this._uriTransformerService.transformOutgoingScheme(t),s=this._providerHandlePool++;return this._proxy.$registerCanonicalUriProvider(s,r),ie(()=>{this._canonicalUriProviders.delete(t),this._proxy.$unregisterCanonicalUriProvider(s)})}async provideCanonicalUri(t,i,r){const s=this._canonicalUriProviders.get(t.scheme);if(!s)return;const n=await s.provideCanonicalUri?.(b.revive(t),i,r);if(n)return n}async $provideCanonicalUri(t,i,r){return this.provideCanonicalUri(b.revive(t),{targetScheme:i},r)}async decode(t,i){const[r,s]=this.toEncodeDecodeParameters(i),n=await this._proxy.$resolveDecoding(r,s),o=(await $U(cN(z.wrap(t)),{...n,acceptTextOnly:!0,overwriteEncoding:a=>a===null||a===n.preferredEncoding?Promise.resolve(n.preferredEncoding):this._proxy.$validateDetectedEncoding(r,a,s)})).stream;return DE(o,a=>a.join(""))}async encode(t,i){const[r,s]=this.toEncodeDecodeParameters(i),{encoding:n,addBOM:o}=await this._proxy.$resolveEncoding(r,s);if(n===vg&&!o)return z.fromString(t).buffer;const a=await HU(KU(t),n,{addBOM:o});return aN(a).buffer}toEncodeDecodeParameters(t){const i=mh(t?.uri)?t.uri:void 0,r=typeof t?.encoding=="string"?t.encoding:void 0;return[i,r?{encoding:r}:void 0]}};Tw=__decorate([__param(0,Pe),__param(1,zt),__param(2,Ma),__param(3,ke),__param(4,Nc)],Tw);var Br=q("IExtHostWorkspace");function bg(e){let t,i;if(e)return typeof e=="string"?t=e:(t=e.pattern,i=b.revive(e.baseUri)),{pattern:t,folder:i}}function E5(e){return(e?.map(t=>{if(typeof t=="string")return t===""?void 0:{pattern:t,uri:void 0};{const i=bg(t);return i?{pattern:i.pattern,uri:i.folder}:void 0}})??[]).filter(t=>!!t)}var C5;(function(e){e[e.None=0]="None",e[e.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",e[e.UnexpectedEndOfString=2]="UnexpectedEndOfString",e[e.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",e[e.InvalidUnicode=4]="InvalidUnicode",e[e.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",e[e.InvalidCharacter=6]="InvalidCharacter"})(C5||(C5={}));var D5;(function(e){e[e.OpenBraceToken=1]="OpenBraceToken",e[e.CloseBraceToken=2]="CloseBraceToken",e[e.OpenBracketToken=3]="OpenBracketToken",e[e.CloseBracketToken=4]="CloseBracketToken",e[e.CommaToken=5]="CommaToken",e[e.ColonToken=6]="ColonToken",e[e.NullKeyword=7]="NullKeyword",e[e.TrueKeyword=8]="TrueKeyword",e[e.FalseKeyword=9]="FalseKeyword",e[e.StringLiteral=10]="StringLiteral",e[e.NumericLiteral=11]="NumericLiteral",e[e.LineCommentTrivia=12]="LineCommentTrivia",e[e.BlockCommentTrivia=13]="BlockCommentTrivia",e[e.LineBreakTrivia=14]="LineBreakTrivia",e[e.Trivia=15]="Trivia",e[e.Unknown=16]="Unknown",e[e.EOF=17]="EOF"})(D5||(D5={}));var k5;(function(e){e[e.InvalidSymbol=1]="InvalidSymbol",e[e.InvalidNumberFormat=2]="InvalidNumberFormat",e[e.PropertyNameExpected=3]="PropertyNameExpected",e[e.ValueExpected=4]="ValueExpected",e[e.ColonExpected=5]="ColonExpected",e[e.CommaExpected=6]="CommaExpected",e[e.CloseBraceExpected=7]="CloseBraceExpected",e[e.CloseBracketExpected=8]="CloseBracketExpected",e[e.EndOfFileExpected=9]="EndOfFileExpected",e[e.InvalidCommentToken=10]="InvalidCommentToken",e[e.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",e[e.UnexpectedEndOfString=12]="UnexpectedEndOfString",e[e.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",e[e.InvalidUnicode=14]="InvalidUnicode",e[e.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",e[e.InvalidCharacter=16]="InvalidCharacter"})(k5||(k5={}));var Aw;(function(e){e.DEFAULT={allowTrailingComma:!0}})(Aw||(Aw={}));function ZU(e,t=!1){let i=0;const r=e.length;let s="",n=0,o=16,a=0;function l(v){let y=0,S=0;for(;y<v;){const x=e.charCodeAt(i);if(x>=48&&x<=57)S=S*16+x-48;else if(x>=65&&x<=70)S=S*16+x-65+10;else if(x>=97&&x<=102)S=S*16+x-97+10;else break;i++,y++}return y<v&&(S=-1),S}function c(v){i=v,s="",n=0,o=16,a=0}function u(){const v=i;if(e.charCodeAt(i)===48)i++;else for(i++;i<e.length&&Ol(e.charCodeAt(i));)i++;if(i<e.length&&e.charCodeAt(i)===46)if(i++,i<e.length&&Ol(e.charCodeAt(i)))for(i++;i<e.length&&Ol(e.charCodeAt(i));)i++;else return a=3,e.substring(v,i);let y=i;if(i<e.length&&(e.charCodeAt(i)===69||e.charCodeAt(i)===101))if(i++,(i<e.length&&e.charCodeAt(i)===43||e.charCodeAt(i)===45)&&i++,i<e.length&&Ol(e.charCodeAt(i))){for(i++;i<e.length&&Ol(e.charCodeAt(i));)i++;y=i}else a=3;return e.substring(v,y)}function d(){let v="",y=i;for(;;){if(i>=r){v+=e.substring(y,i),a=2;break}const S=e.charCodeAt(i);if(S===34){v+=e.substring(y,i),i++;break}if(S===92){if(v+=e.substring(y,i),i++,i>=r){a=2;break}switch(e.charCodeAt(i++)){case 34:v+='"';break;case 92:v+="\\";break;case 47:v+="/";break;case 98:v+="\b";break;case 102:v+="\f";break;case 110:v+=`
`;break;case 114:v+="\r";break;case 116:v+="	";break;case 117:{const P=l(4);P>=0?v+=String.fromCharCode(P):a=4;break}default:a=5}y=i;continue}if(S>=0&&S<=31)if(Sg(S)){v+=e.substring(y,i),a=2;break}else a=6;i++}return v}function f(){if(s="",a=0,n=i,i>=r)return n=r,o=17;let v=e.charCodeAt(i);if(Rw(v)){do i++,s+=String.fromCharCode(v),v=e.charCodeAt(i);while(Rw(v));return o=15}if(Sg(v))return i++,s+=String.fromCharCode(v),v===13&&e.charCodeAt(i)===10&&(i++,s+=`
`),o=14;switch(v){case 123:return i++,o=1;case 125:return i++,o=2;case 91:return i++,o=3;case 93:return i++,o=4;case 58:return i++,o=6;case 44:return i++,o=5;case 34:return i++,s=d(),o=10;case 47:{const y=i-1;if(e.charCodeAt(i+1)===47){for(i+=2;i<r&&!Sg(e.charCodeAt(i));)i++;return s=e.substring(y,i),o=12}if(e.charCodeAt(i+1)===42){i+=2;const S=r-1;let x=!1;for(;i<S;){if(e.charCodeAt(i)===42&&e.charCodeAt(i+1)===47){i+=2,x=!0;break}i++}return x||(i++,a=1),s=e.substring(y,i),o=13}return s+=String.fromCharCode(v),i++,o=16}case 45:if(s+=String.fromCharCode(v),i++,i===r||!Ol(e.charCodeAt(i)))return o=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return s+=u(),o=11;default:for(;i<r&&p(v);)i++,v=e.charCodeAt(i);if(n!==i){switch(s=e.substring(n,i),s){case"true":return o=8;case"false":return o=9;case"null":return o=7}return o=16}return s+=String.fromCharCode(v),i++,o=16}}function p(v){if(Rw(v)||Sg(v))return!1;switch(v){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function g(){let v;do v=f();while(v>=12&&v<=15);return v}return{setPosition:c,getPosition:()=>i,scan:t?g:f,getToken:()=>o,getTokenValue:()=>s,getTokenOffset:()=>n,getTokenLength:()=>i-n,getTokenError:()=>a}}function Rw(e){return e===32||e===9||e===11||e===12||e===160||e===5760||e>=8192&&e<=8203||e===8239||e===8287||e===12288||e===65279}function Sg(e){return e===10||e===13||e===8232||e===8233}function Ol(e){return e>=48&&e<=57}var I5;(function(e){e[e.nullCharacter=0]="nullCharacter",e[e.maxAsciiCharacter=127]="maxAsciiCharacter",e[e.lineFeed=10]="lineFeed",e[e.carriageReturn=13]="carriageReturn",e[e.lineSeparator=8232]="lineSeparator",e[e.paragraphSeparator=8233]="paragraphSeparator",e[e.nextLine=133]="nextLine",e[e.space=32]="space",e[e.nonBreakingSpace=160]="nonBreakingSpace",e[e.enQuad=8192]="enQuad",e[e.emQuad=8193]="emQuad",e[e.enSpace=8194]="enSpace",e[e.emSpace=8195]="emSpace",e[e.threePerEmSpace=8196]="threePerEmSpace",e[e.fourPerEmSpace=8197]="fourPerEmSpace",e[e.sixPerEmSpace=8198]="sixPerEmSpace",e[e.figureSpace=8199]="figureSpace",e[e.punctuationSpace=8200]="punctuationSpace",e[e.thinSpace=8201]="thinSpace",e[e.hairSpace=8202]="hairSpace",e[e.zeroWidthSpace=8203]="zeroWidthSpace",e[e.narrowNoBreakSpace=8239]="narrowNoBreakSpace",e[e.ideographicSpace=12288]="ideographicSpace",e[e.mathematicalSpace=8287]="mathematicalSpace",e[e.ogham=5760]="ogham",e[e._=95]="_",e[e.$=36]="$",e[e._0=48]="_0",e[e._1=49]="_1",e[e._2=50]="_2",e[e._3=51]="_3",e[e._4=52]="_4",e[e._5=53]="_5",e[e._6=54]="_6",e[e._7=55]="_7",e[e._8=56]="_8",e[e._9=57]="_9",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.ampersand=38]="ampersand",e[e.asterisk=42]="asterisk",e[e.at=64]="at",e[e.backslash=92]="backslash",e[e.bar=124]="bar",e[e.caret=94]="caret",e[e.closeBrace=125]="closeBrace",e[e.closeBracket=93]="closeBracket",e[e.closeParen=41]="closeParen",e[e.colon=58]="colon",e[e.comma=44]="comma",e[e.dot=46]="dot",e[e.doubleQuote=34]="doubleQuote",e[e.equals=61]="equals",e[e.exclamation=33]="exclamation",e[e.greaterThan=62]="greaterThan",e[e.lessThan=60]="lessThan",e[e.minus=45]="minus",e[e.openBrace=123]="openBrace",e[e.openBracket=91]="openBracket",e[e.openParen=40]="openParen",e[e.percent=37]="percent",e[e.plus=43]="plus",e[e.question=63]="question",e[e.semicolon=59]="semicolon",e[e.singleQuote=39]="singleQuote",e[e.slash=47]="slash",e[e.tilde=126]="tilde",e[e.backspace=8]="backspace",e[e.formFeed=12]="formFeed",e[e.byteOrderMark=65279]="byteOrderMark",e[e.tab=9]="tab",e[e.verticalTab=11]="verticalTab"})(I5||(I5={}));function eW(e,t,i=Aw.DEFAULT){const r=ZU(e,!1);function s(H){return H?()=>H(r.getTokenOffset(),r.getTokenLength()):()=>!0}function n(H){return H?K=>H(K,r.getTokenOffset(),r.getTokenLength()):()=>!0}const o=s(t.onObjectBegin),a=n(t.onObjectProperty),l=s(t.onObjectEnd),c=s(t.onArrayBegin),u=s(t.onArrayEnd),d=n(t.onLiteralValue),f=n(t.onSeparator),p=s(t.onComment),g=n(t.onError),v=i&&i.disallowComments,y=i&&i.allowTrailingComma;function S(){for(;;){const H=r.scan();switch(r.getTokenError()){case 4:x(14);break;case 5:x(15);break;case 3:x(13);break;case 1:v||x(11);break;case 2:x(12);break;case 6:x(16);break}switch(H){case 12:case 13:v?x(10):p();break;case 16:x(1);break;case 15:case 14:break;default:return H}}}function x(H,K=[],Ee=[]){if(g(H),K.length+Ee.length>0){let ne=r.getToken();for(;ne!==17;){if(K.indexOf(ne)!==-1){S();break}else if(Ee.indexOf(ne)!==-1)break;ne=S()}}}function P(H){const K=r.getTokenValue();return H?d(K):a(K),S(),!0}function $(){switch(r.getToken()){case 11:{let H=0;try{H=JSON.parse(r.getTokenValue()),typeof H!="number"&&(x(2),H=0)}catch{x(2)}d(H);break}case 7:d(null);break;case 8:d(!0);break;case 9:d(!1);break;default:return!1}return S(),!0}function A(){return r.getToken()!==10?(x(3,[],[2,5]),!1):(P(!1),r.getToken()===6?(f(":"),S(),J()||x(4,[],[2,5])):x(5,[],[2,5]),!0)}function W(){o(),S();let H=!1;for(;r.getToken()!==2&&r.getToken()!==17;){if(r.getToken()===5){if(H||x(4,[],[]),f(","),S(),r.getToken()===2&&y)break}else H&&x(6,[],[]);A()||x(4,[],[2,5]),H=!0}return l(),r.getToken()!==2?x(7,[2],[]):S(),!0}function G(){c(),S();let H=!1;for(;r.getToken()!==4&&r.getToken()!==17;){if(r.getToken()===5){if(H||x(4,[],[]),f(","),S(),r.getToken()===4&&y)break}else H&&x(6,[],[]);J()||x(4,[],[4,5]),H=!0}return u(),r.getToken()!==4?x(8,[4],[]):S(),!0}function J(){switch(r.getToken()){case 3:return G();case 1:return W();case 10:return P(!0);default:return $()}}return S(),r.getToken()===17?i.allowEmptyContent?!0:(x(4,[],[]),!1):J()?(r.getToken()!==17&&x(9,[],[]),!0):(x(4,[],[]),!1)}function Zu(e){return Object.isFrozen(e)?e:oC(e)}var Fl=class fa{static createEmptyModel(t){return new fa({},[],[],void 0,t)}constructor(t,i,r,s,n){this._contents=t,this._keys=i,this._overrides=r,this.raw=s,this.logService=n,this.overrideConfigurations=new Map}get rawConfiguration(){if(!this._rawConfiguration)if(this.raw){const t=(Array.isArray(this.raw)?this.raw:[this.raw]).map(i=>{if(i instanceof fa)return i;const r=new tW("",this.logService);return r.parseRaw(i),r.configurationModel});this._rawConfiguration=t.reduce((i,r)=>r===i?r:i.merge(r),t[0])}else this._rawConfiguration=this;return this._rawConfiguration}get contents(){return this._contents}get overrides(){return this._overrides}get keys(){return this._keys}isEmpty(){return this._keys.length===0&&Object.keys(this._contents).length===0&&this._overrides.length===0}getValue(t){return t?uf(this.contents,t):this.contents}inspect(t,i){const r=this;return{get value(){return Zu(r.rawConfiguration.getValue(t))},get override(){return i?Zu(r.rawConfiguration.getOverrideValue(t,i)):void 0},get merged(){return Zu(i?r.rawConfiguration.override(i).getValue(t):r.rawConfiguration.getValue(t))},get overrides(){const s=[];for(const{contents:n,identifiers:o,keys:a}of r.rawConfiguration.overrides){const l=new fa(n,a,[],void 0,r.logService).getValue(t);l!==void 0&&s.push({identifiers:o,value:l})}return s.length?Zu(s):void 0}}}getOverrideValue(t,i){const r=this.getContentsForOverrideIdentifer(i);return r?t?uf(r,t):r:void 0}getKeysForOverrideIdentifier(t){const i=[];for(const r of this.overrides)r.identifiers.includes(t)&&i.push(...r.keys);return ba(i)}getAllOverrideIdentifiers(){const t=[];for(const i of this.overrides)t.push(...i.identifiers);return ba(t)}override(t){let i=this.overrideConfigurations.get(t);return i||(i=this.createOverrideConfigurationModel(t),this.overrideConfigurations.set(t,i)),i}merge(...t){const i=Ye(this.contents),r=Ye(this.overrides),s=[...this.keys],n=this.raw?Array.isArray(this.raw)?[...this.raw]:[this.raw]:[this];for(const o of t)if(n.push(...o.raw?Array.isArray(o.raw)?o.raw:[o.raw]:[o]),!o.isEmpty()){this.mergeContents(i,o.contents);for(const a of o.overrides){const[l]=r.filter(c=>Er(c.identifiers,a.identifiers));l?(this.mergeContents(l.contents,a.contents),l.keys.push(...a.keys),l.keys=ba(l.keys)):r.push(Ye(a))}for(const a of o.keys)s.indexOf(a)===-1&&s.push(a)}return new fa(i,s,r,!n.length||n.every(o=>o instanceof fa)?void 0:n,this.logService)}createOverrideConfigurationModel(t){const i=this.getContentsForOverrideIdentifer(t);if(!i||typeof i!="object"||!Object.keys(i).length)return this;const r={};for(const s of ba([...Object.keys(this.contents),...Object.keys(i)])){let n=this.contents[s];const o=i[s];o&&(typeof n=="object"&&typeof o=="object"?(n=Ye(n),this.mergeContents(n,o)):n=o),r[s]=n}return new fa(r,this.keys,this.overrides,void 0,this.logService)}mergeContents(t,i){for(const r of Object.keys(i)){if(r in t&&It(t[r])&&It(i[r])){this.mergeContents(t[r],i[r]);continue}t[r]=Ye(i[r])}}getContentsForOverrideIdentifer(t){let i=null,r=null;const s=n=>{n&&(r?this.mergeContents(r,n):r=Ye(n))};for(const n of this.overrides)n.identifiers.length===1&&n.identifiers[0]===t?i=n.contents:n.identifiers.includes(t)&&s(n.contents);return s(i),r}toJSON(){return{contents:this.contents,overrides:this.overrides,keys:this.keys}}addValue(t,i){this.updateValue(t,i,!0)}setValue(t,i){this.updateValue(t,i,!1)}removeValue(t){const i=this.keys.indexOf(t);i!==-1&&(this.keys.splice(i,1),E$(this.contents,t),rs.test(t)&&this.overrides.splice(this.overrides.findIndex(r=>Er(r.identifiers,Qc(t))),1))}updateValue(t,i,r){if(MI(this.contents,t,i,s=>this.logService.error(s)),r=r||this.keys.indexOf(t)===-1,r&&this.keys.push(t),rs.test(t)){const s=Qc(t),n={identifiers:s,keys:Object.keys(this.contents[t]),contents:n_(this.contents[t],a=>this.logService.error(a))},o=this.overrides.findIndex(a=>Er(a.identifiers,s));o!==-1?this.overrides[o]=n:this.overrides.push(n)}}},tW=class{constructor(e,t){this._name=e,this.logService=t,this._raw=null,this._configurationModel=null,this._restrictedConfigurations=[],this._parseErrors=[]}get configurationModel(){return this._configurationModel||Fl.createEmptyModel(this.logService)}get restrictedConfigurations(){return this._restrictedConfigurations}get errors(){return this._parseErrors}parse(e,t){if(!Lt(e)){const i=this.doParseContent(e);this.parseRaw(i,t)}}reparse(e){this._raw&&this.parseRaw(this._raw,e)}parseRaw(e,t){this._raw=e;const{contents:i,keys:r,overrides:s,restricted:n,hasExcludedProperties:o}=this.doParseRaw(e,t);this._configurationModel=new Fl(i,r,s,o?[e]:void 0,this.logService),this._restrictedConfigurations=n||[]}doParseContent(e){let t={},i=null,r=[];const s=[],n=[];function o(l){Array.isArray(r)?r.push(l):i!==null&&(r[i]=l)}const a={onObjectBegin:()=>{const l={};o(l),s.push(r),r=l,i=null},onObjectProperty:l=>{i=l},onObjectEnd:()=>{r=s.pop()},onArrayBegin:()=>{const l=[];o(l),s.push(r),r=l,i=null},onArrayEnd:()=>{r=s.pop()},onLiteralValue:o,onError:(l,c,u)=>{n.push({error:l,offset:c,length:u})}};if(e)try{eW(e,a),t=r[0]||{}}catch(l){this.logService.error(`Error while parsing settings file ${this._name}: ${l}`),this._parseErrors=[l]}return t}doParseRaw(e,t){const i=Xt.as(Do.Configuration).getConfigurationProperties(),r=this.filter(e,i,!0,t);e=r.raw;const s=n_(e,a=>this.logService.error(`Conflict in settings file ${this._name}: ${a}`)),n=Object.keys(e),o=this.toOverrides(e,a=>this.logService.error(`Conflict in settings file ${this._name}: ${a}`));return{contents:s,keys:n,overrides:o,restricted:r.restricted,hasExcludedProperties:r.hasExcludedProperties}}filter(e,t,i,r){let s=!1;if(!r?.scopes&&!r?.skipRestricted&&!r?.exclude?.length)return{raw:e,restricted:[],hasExcludedProperties:s};const n={},o=[];for(const a in e)if(rs.test(a)&&i){const l=this.filter(e[a],t,!1,r);n[a]=l.raw,s=s||l.hasExcludedProperties,o.push(...l.restricted)}else{const l=t[a];l?.restricted&&o.push(a),this.shouldInclude(a,l,r)?n[a]=e[a]:s=!0}return{raw:n,restricted:o,hasExcludedProperties:s}}shouldInclude(e,t,i){if(i.exclude?.includes(e))return!1;if(i.include?.includes(e))return!0;if(i.skipRestricted&&t?.restricted||i.skipUnregistered&&!t)return!1;const r=t?typeof t.scope<"u"?t.scope:4:void 0;return r===void 0||i.scopes===void 0?!0:i.scopes.includes(r)}toOverrides(e,t){const i=[];for(const r of Object.keys(e))if(rs.test(r)){const s={};for(const n in e[r])s[n]=e[r][n];i.push({identifiers:Qc(r),keys:Object.keys(s),contents:n_(s,t)})}return i}},iW=class{constructor(e,t,i,r,s,n,o,a,l,c,u,d,f){this.key=e,this.overrides=t,this._value=i,this.overrideIdentifiers=r,this.defaultConfiguration=s,this.policyConfiguration=n,this.applicationConfiguration=o,this.userConfiguration=a,this.localUserConfiguration=l,this.remoteUserConfiguration=c,this.workspaceConfiguration=u,this.folderConfigurationModel=d,this.memoryConfigurationModel=f}get value(){return Zu(this._value)}toInspectValue(e){return e?.value!==void 0||e?.override!==void 0||e?.overrides!==void 0?e:void 0}get defaultInspectValue(){return this._defaultInspectValue||(this._defaultInspectValue=this.defaultConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._defaultInspectValue}get defaultValue(){return this.defaultInspectValue.merged}get default(){return this.toInspectValue(this.defaultInspectValue)}get policyInspectValue(){return this._policyInspectValue===void 0&&(this._policyInspectValue=this.policyConfiguration?this.policyConfiguration.inspect(this.key):null),this._policyInspectValue}get policyValue(){return this.policyInspectValue?.merged}get policy(){return this.policyInspectValue?.value!==void 0?{value:this.policyInspectValue.value}:void 0}get applicationInspectValue(){return this._applicationInspectValue===void 0&&(this._applicationInspectValue=this.applicationConfiguration?this.applicationConfiguration.inspect(this.key):null),this._applicationInspectValue}get applicationValue(){return this.applicationInspectValue?.merged}get application(){return this.toInspectValue(this.applicationInspectValue)}get userInspectValue(){return this._userInspectValue||(this._userInspectValue=this.userConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userInspectValue}get userValue(){return this.userInspectValue.merged}get user(){return this.toInspectValue(this.userInspectValue)}get userLocalInspectValue(){return this._userLocalInspectValue||(this._userLocalInspectValue=this.localUserConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userLocalInspectValue}get userLocalValue(){return this.userLocalInspectValue.merged}get userLocal(){return this.toInspectValue(this.userLocalInspectValue)}get userRemoteInspectValue(){return this._userRemoteInspectValue||(this._userRemoteInspectValue=this.remoteUserConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userRemoteInspectValue}get userRemoteValue(){return this.userRemoteInspectValue.merged}get userRemote(){return this.toInspectValue(this.userRemoteInspectValue)}get workspaceInspectValue(){return this._workspaceInspectValue===void 0&&(this._workspaceInspectValue=this.workspaceConfiguration?this.workspaceConfiguration.inspect(this.key,this.overrides.overrideIdentifier):null),this._workspaceInspectValue}get workspaceValue(){return this.workspaceInspectValue?.merged}get workspace(){return this.toInspectValue(this.workspaceInspectValue)}get workspaceFolderInspectValue(){return this._workspaceFolderInspectValue===void 0&&(this._workspaceFolderInspectValue=this.folderConfigurationModel?this.folderConfigurationModel.inspect(this.key,this.overrides.overrideIdentifier):null),this._workspaceFolderInspectValue}get workspaceFolderValue(){return this.workspaceFolderInspectValue?.merged}get workspaceFolder(){return this.toInspectValue(this.workspaceFolderInspectValue)}get memoryInspectValue(){return this._memoryInspectValue===void 0&&(this._memoryInspectValue=this.memoryConfigurationModel.inspect(this.key,this.overrides.overrideIdentifier)),this._memoryInspectValue}get memoryValue(){return this.memoryInspectValue.merged}get memory(){return this.toInspectValue(this.memoryInspectValue)}},Lw=class m8{constructor(t,i,r,s,n,o,a,l,c,u){this._defaultConfiguration=t,this._policyConfiguration=i,this._applicationConfiguration=r,this._localUserConfiguration=s,this._remoteUserConfiguration=n,this._workspaceConfiguration=o,this._folderConfigurations=a,this._memoryConfiguration=l,this._memoryConfigurationByResource=c,this.logService=u,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations=new Vt,this._userConfiguration=null}getValue(t,i,r){return this.getConsolidatedConfigurationModel(t,i,r).getValue(t)}updateValue(t,i,r={}){let s;r.resource?(s=this._memoryConfigurationByResource.get(r.resource),s||(s=Fl.createEmptyModel(this.logService),this._memoryConfigurationByResource.set(r.resource,s))):s=this._memoryConfiguration,i===void 0?s.removeValue(t):s.setValue(t,i),r.resource||(this._workspaceConsolidatedConfiguration=null)}inspect(t,i,r){const s=this.getConsolidatedConfigurationModel(t,i,r),n=this.getFolderConfigurationModelForResource(i.resource,r),o=i.resource?this._memoryConfigurationByResource.get(i.resource)||this._memoryConfiguration:this._memoryConfiguration,a=new Set;for(const l of s.overrides)for(const c of l.identifiers)s.getOverrideValue(t,c)!==void 0&&a.add(c);return new iW(t,i,s.getValue(t),a.size?[...a]:void 0,this._defaultConfiguration,this._policyConfiguration.isEmpty()?void 0:this._policyConfiguration,this.applicationConfiguration.isEmpty()?void 0:this.applicationConfiguration,this.userConfiguration,this.localUserConfiguration,this.remoteUserConfiguration,r?this._workspaceConfiguration:void 0,n||void 0,o)}keys(t){const i=this.getFolderConfigurationModelForResource(void 0,t);return{default:this._defaultConfiguration.keys.slice(0),user:this.userConfiguration.keys.slice(0),workspace:this._workspaceConfiguration.keys.slice(0),workspaceFolder:i?i.keys.slice(0):[]}}updateDefaultConfiguration(t){this._defaultConfiguration=t,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updatePolicyConfiguration(t){this._policyConfiguration=t}updateApplicationConfiguration(t){this._applicationConfiguration=t,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateLocalUserConfiguration(t){this._localUserConfiguration=t,this._userConfiguration=null,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateRemoteUserConfiguration(t){this._remoteUserConfiguration=t,this._userConfiguration=null,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateWorkspaceConfiguration(t){this._workspaceConfiguration=t,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateFolderConfiguration(t,i){this._folderConfigurations.set(t,i),this._foldersConsolidatedConfigurations.delete(t)}deleteFolderConfiguration(t){this.folderConfigurations.delete(t),this._foldersConsolidatedConfigurations.delete(t)}compareAndUpdateDefaultConfiguration(t,i){const r=[];if(!i){const{added:s,updated:n,removed:o}=Vn(this._defaultConfiguration,t);i=[...s,...n,...o]}for(const s of i)for(const n of Qc(s)){const o=this._defaultConfiguration.getKeysForOverrideIdentifier(n),a=t.getKeysForOverrideIdentifier(n),l=[...a.filter(c=>o.indexOf(c)===-1),...o.filter(c=>a.indexOf(c)===-1),...o.filter(c=>!Ei(this._defaultConfiguration.override(n).getValue(c),t.override(n).getValue(c)))];r.push([n,l])}return this.updateDefaultConfiguration(t),{keys:i,overrides:r}}compareAndUpdatePolicyConfiguration(t){const{added:i,updated:r,removed:s}=Vn(this._policyConfiguration,t),n=[...i,...r,...s];return n.length&&this.updatePolicyConfiguration(t),{keys:n,overrides:[]}}compareAndUpdateApplicationConfiguration(t){const{added:i,updated:r,removed:s,overrides:n}=Vn(this.applicationConfiguration,t),o=[...i,...r,...s];return o.length&&this.updateApplicationConfiguration(t),{keys:o,overrides:n}}compareAndUpdateLocalUserConfiguration(t){const{added:i,updated:r,removed:s,overrides:n}=Vn(this.localUserConfiguration,t),o=[...i,...r,...s];return o.length&&this.updateLocalUserConfiguration(t),{keys:o,overrides:n}}compareAndUpdateRemoteUserConfiguration(t){const{added:i,updated:r,removed:s,overrides:n}=Vn(this.remoteUserConfiguration,t),o=[...i,...r,...s];return o.length&&this.updateRemoteUserConfiguration(t),{keys:o,overrides:n}}compareAndUpdateWorkspaceConfiguration(t){const{added:i,updated:r,removed:s,overrides:n}=Vn(this.workspaceConfiguration,t),o=[...i,...r,...s];return o.length&&this.updateWorkspaceConfiguration(t),{keys:o,overrides:n}}compareAndUpdateFolderConfiguration(t,i){const r=this.folderConfigurations.get(t),{added:s,updated:n,removed:o,overrides:a}=Vn(r,i),l=[...s,...n,...o];return(l.length||!r)&&this.updateFolderConfiguration(t,i),{keys:l,overrides:a}}compareAndDeleteFolderConfiguration(t){const i=this.folderConfigurations.get(t);if(!i)throw new Error("Unknown folder");this.deleteFolderConfiguration(t);const{added:r,updated:s,removed:n,overrides:o}=Vn(i,void 0);return{keys:[...r,...s,...n],overrides:o}}get defaults(){return this._defaultConfiguration}get applicationConfiguration(){return this._applicationConfiguration}get userConfiguration(){if(!this._userConfiguration)if(this._remoteUserConfiguration.isEmpty())this._userConfiguration=this._localUserConfiguration;else{const t=this._localUserConfiguration.merge(this._remoteUserConfiguration);this._userConfiguration=new Fl(t.contents,t.keys,t.overrides,void 0,this.logService)}return this._userConfiguration}get localUserConfiguration(){return this._localUserConfiguration}get remoteUserConfiguration(){return this._remoteUserConfiguration}get workspaceConfiguration(){return this._workspaceConfiguration}get folderConfigurations(){return this._folderConfigurations}getConsolidatedConfigurationModel(t,i,r){let s=this.getConsolidatedConfigurationModelForResource(i,r);if(i.overrideIdentifier&&(s=s.override(i.overrideIdentifier)),!this._policyConfiguration.isEmpty()&&this._policyConfiguration.getValue(t)!==void 0){s=s.merge();for(const n of this._policyConfiguration.keys)s.setValue(n,this._policyConfiguration.getValue(n))}return s}getConsolidatedConfigurationModelForResource({resource:t},i){let r=this.getWorkspaceConsolidatedConfiguration();if(i&&t){const s=i.getFolder(t);s&&(r=this.getFolderConsolidatedConfiguration(s.uri)||r);const n=this._memoryConfigurationByResource.get(t);n&&(r=r.merge(n))}return r}getWorkspaceConsolidatedConfiguration(){return this._workspaceConsolidatedConfiguration||(this._workspaceConsolidatedConfiguration=this._defaultConfiguration.merge(this.applicationConfiguration,this.userConfiguration,this._workspaceConfiguration,this._memoryConfiguration)),this._workspaceConsolidatedConfiguration}getFolderConsolidatedConfiguration(t){let i=this._foldersConsolidatedConfigurations.get(t);if(!i){const r=this.getWorkspaceConsolidatedConfiguration(),s=this._folderConfigurations.get(t);s?(i=r.merge(s),this._foldersConsolidatedConfigurations.set(t,i)):i=r}return i}getFolderConfigurationModelForResource(t,i){if(i&&t){const r=i.getFolder(t);if(r)return this._folderConfigurations.get(r.uri)}}toData(){return{defaults:{contents:this._defaultConfiguration.contents,overrides:this._defaultConfiguration.overrides,keys:this._defaultConfiguration.keys},policy:{contents:this._policyConfiguration.contents,overrides:this._policyConfiguration.overrides,keys:this._policyConfiguration.keys},application:{contents:this.applicationConfiguration.contents,overrides:this.applicationConfiguration.overrides,keys:this.applicationConfiguration.keys,raw:Array.isArray(this.applicationConfiguration.raw)?void 0:this.applicationConfiguration.raw},userLocal:{contents:this.localUserConfiguration.contents,overrides:this.localUserConfiguration.overrides,keys:this.localUserConfiguration.keys,raw:Array.isArray(this.localUserConfiguration.raw)?void 0:this.localUserConfiguration.raw},userRemote:{contents:this.remoteUserConfiguration.contents,overrides:this.remoteUserConfiguration.overrides,keys:this.remoteUserConfiguration.keys,raw:Array.isArray(this.remoteUserConfiguration.raw)?void 0:this.remoteUserConfiguration.raw},workspace:{contents:this._workspaceConfiguration.contents,overrides:this._workspaceConfiguration.overrides,keys:this._workspaceConfiguration.keys},folders:[...this._folderConfigurations.keys()].reduce((t,i)=>{const{contents:r,overrides:s,keys:n}=this._folderConfigurations.get(i);return t.push([i,{contents:r,overrides:s,keys:n}]),t},[])}}allKeys(){const t=new Set;return this._defaultConfiguration.keys.forEach(i=>t.add(i)),this.userConfiguration.keys.forEach(i=>t.add(i)),this._workspaceConfiguration.keys.forEach(i=>t.add(i)),this._folderConfigurations.forEach(i=>i.keys.forEach(r=>t.add(r))),[...t.values()]}allOverrideIdentifiers(){const t=new Set;return this._defaultConfiguration.getAllOverrideIdentifiers().forEach(i=>t.add(i)),this.userConfiguration.getAllOverrideIdentifiers().forEach(i=>t.add(i)),this._workspaceConfiguration.getAllOverrideIdentifiers().forEach(i=>t.add(i)),this._folderConfigurations.forEach(i=>i.getAllOverrideIdentifiers().forEach(r=>t.add(r))),[...t.values()]}getAllKeysForOverrideIdentifier(t){const i=new Set;return this._defaultConfiguration.getKeysForOverrideIdentifier(t).forEach(r=>i.add(r)),this.userConfiguration.getKeysForOverrideIdentifier(t).forEach(r=>i.add(r)),this._workspaceConfiguration.getKeysForOverrideIdentifier(t).forEach(r=>i.add(r)),this._folderConfigurations.forEach(r=>r.getKeysForOverrideIdentifier(t).forEach(s=>i.add(s))),[...i.values()]}static parse(t,i){const r=this.parseConfigurationModel(t.defaults,i),s=this.parseConfigurationModel(t.policy,i),n=this.parseConfigurationModel(t.application,i),o=this.parseConfigurationModel(t.userLocal,i),a=this.parseConfigurationModel(t.userRemote,i),l=this.parseConfigurationModel(t.workspace,i),c=t.folders.reduce((u,d)=>(u.set(b.revive(d[0]),this.parseConfigurationModel(d[1],i)),u),new Vt);return new m8(r,s,n,o,a,l,c,Fl.createEmptyModel(i),new Vt,i)}static parseConfigurationModel(t,i){return new Fl(t.contents,t.keys,t.overrides,t.raw,i)}},rW=class{constructor(e,t,i,r,s){this.change=e,this.previous=t,this.currentConfiguraiton=i,this.currentWorkspace=r,this.logService=s,this._marker=`
`,this._markerCode1=this._marker.charCodeAt(0),this._markerCode2=46,this.affectedKeys=new Set,this._previousConfiguration=void 0;for(const n of e.keys)this.affectedKeys.add(n);for(const[,n]of e.overrides)for(const o of n)this.affectedKeys.add(o);this._affectsConfigStr=this._marker;for(const n of this.affectedKeys)this._affectsConfigStr+=n+this._marker}get previousConfiguration(){return!this._previousConfiguration&&this.previous&&(this._previousConfiguration=Lw.parse(this.previous.data,this.logService)),this._previousConfiguration}affectsConfiguration(e,t){const i=this._marker+e,r=this._affectsConfigStr.indexOf(i);if(r<0)return!1;const s=r+i.length;if(s>=this._affectsConfigStr.length)return!1;const n=this._affectsConfigStr.charCodeAt(s);if(n!==this._markerCode1&&n!==this._markerCode2)return!1;if(t){const o=this.previousConfiguration?this.previousConfiguration.getValue(e,t,this.previous?.workspace):void 0,a=this.currentConfiguraiton.getValue(e,t,this.currentWorkspace);return!Ei(o,a)}return!0}};function Vn(e,t){const{added:i,removed:r,updated:s}=P5(t?.rawConfiguration,e?.rawConfiguration),n=[],o=e?.getAllOverrideIdentifiers()||[],a=t?.getAllOverrideIdentifiers()||[];if(t){const l=a.filter(c=>!o.includes(c));for(const c of l)n.push([c,t.getKeysForOverrideIdentifier(c)])}if(e){const l=o.filter(c=>!a.includes(c));for(const c of l)n.push([c,e.getKeysForOverrideIdentifier(c)])}if(t&&e){for(const l of o)if(a.includes(l)){const c=P5({contents:e.getOverrideValue(void 0,l)||{},keys:e.getKeysForOverrideIdentifier(l)},{contents:t.getOverrideValue(void 0,l)||{},keys:t.getKeysForOverrideIdentifier(l)});n.push([l,[...c.added,...c.removed,...c.updated]])}}return{added:i,removed:r,updated:s,overrides:n}}function P5(e,t){const i=e?t?e.keys.filter(n=>t.keys.indexOf(n)===-1):[...e.keys]:[],r=t?e?t.keys.filter(n=>e.keys.indexOf(n)===-1):[...t.keys]:[],s=[];if(e&&t){for(const n of t.keys)if(e.keys.indexOf(n)!==-1){const o=uf(t.contents,n),a=uf(e.contents,n);Ei(o,a)||s.push(n)}}return{added:i,removed:r,updated:s}}function xg(e,t){if(t){const i=t.split(".");let r=e;for(let s=0;r&&s<i.length;s++)r=r[i[s]];return r}}function sW(e){return e instanceof b}function nW(e){return e&&e.uri instanceof b&&e.languageId&&typeof e.languageId=="string"}function oW(e){return e&&!e.uri&&e.languageId&&typeof e.languageId=="string"}function aW(e){return e&&e.uri instanceof b&&(!e.name||typeof e.name=="string")&&(!e.index||typeof e.index=="number")}function T5(e){if(sW(e))return{resource:e};if(nW(e))return{resource:e.uri,overrideIdentifier:e.languageId};if(oW(e))return{overrideIdentifier:e.languageId};if(aW(e))return{resource:e.uri};if(e===null)return{resource:null}}var Nw=class{constructor(t,i,r){this._proxy=t.getProxy(Q.MainThreadConfiguration),this._extHostWorkspace=i,this._logService=r,this._barrier=new dr,this._actual=null}getConfigProvider(){return this._barrier.wait().then(t=>this._actual)}$initializeConfiguration(t){this._actual=new lW(this._proxy,this._extHostWorkspace,t,this._logService),this._barrier.open()}$acceptConfigurationChanged(t,i){this.getConfigProvider().then(r=>r.$acceptConfigurationChanged(t,i))}};Nw=__decorate([__param(0,Pe),__param(1,Br),__param(2,ke)],Nw);var lW=class{constructor(e,t,i,r){this._onDidChangeConfiguration=new D,this._proxy=e,this._logService=r,this._extHostWorkspace=t,this._configuration=Lw.parse(i,r),this._configurationScopes=this._toMap(i.configurationScopes)}get onDidChangeConfiguration(){return this._onDidChangeConfiguration&&this._onDidChangeConfiguration.event}$acceptConfigurationChanged(e,t){const i={data:this._configuration.toData(),workspace:this._extHostWorkspace.workspace};this._configuration=Lw.parse(e,this._logService),this._configurationScopes=this._toMap(e.configurationScopes),this._onDidChangeConfiguration.fire(this._toConfigurationChangeEvent(t,i))}getConfiguration(e,t,i){const r=T5(t)||{},s=this._toReadonlyValue(this._configuration.getValue(e,r,this._extHostWorkspace.workspace));e&&this._validateConfigurationAccess(e,r,i?.identifier);function n(a){if(a==null)return null;if(typeof a=="boolean")return a?2:5;switch(a){case ll.Global:return 2;case ll.Workspace:return 5;case ll.WorkspaceFolder:return 6}}const o={has(a){return typeof xg(s,a)<"u"},get:(a,l)=>{this._validateConfigurationAccess(e?`${e}.${a}`:a,r,i?.identifier);let c=xg(s,a);if(typeof c>"u")c=l;else{let u;const d=(f,p)=>{if(It(f)){let g;const v=()=>{u=u||Ye(s),g=g||xg(u,p)};return new Proxy(f,{get:(y,S)=>{if(typeof S=="string"&&S.toLowerCase()==="tojson")return v(),()=>g;if(u)return g=g||xg(u,p),g[S];const x=y[S];return typeof S=="string"?d(x,`${p}.${S}`):x},set:(y,S,x)=>(v(),g&&(g[S]=x),!0),deleteProperty:(y,S)=>(v(),g&&delete g[S],!0),defineProperty:(y,S,x)=>(v(),g&&Object.defineProperty(g,S,x),!0)})}return Array.isArray(f)?Ye(f):f};c=d(c,a)}return c},update:(a,l,c,u)=>{a=e?`${e}.${a}`:a;const d=n(c);return l!==void 0?this._proxy.$updateConfigurationOption(d,a,l,r,u):this._proxy.$removeConfigurationOption(d,a,r,u)},inspect:a=>{a=e?`${e}.${a}`:a;const l=this._configuration.inspect(a,r,this._extHostWorkspace.workspace);if(l)return{key:a,defaultValue:Ye(l.policy?.value??l.default?.value),globalLocalValue:Ye(l.userLocal?.value),globalRemoteValue:Ye(l.userRemote?.value),globalValue:Ye(l.user?.value??l.application?.value),workspaceValue:Ye(l.workspace?.value),workspaceFolderValue:Ye(l.workspaceFolder?.value),defaultLanguageValue:Ye(l.default?.override),globalLocalLanguageValue:Ye(l.userLocal?.override),globalRemoteLanguageValue:Ye(l.userRemote?.override),globalLanguageValue:Ye(l.user?.override??l.application?.override),workspaceLanguageValue:Ye(l.workspace?.override),workspaceFolderLanguageValue:Ye(l.workspaceFolder?.override),languageIds:Ye(l.overrideIdentifiers)}}};return typeof s=="object"&&Is(o,s,!1),Object.freeze(o)}_toReadonlyValue(e){const t=i=>It(i)?new Proxy(i,{get:(r,s)=>t(r[s]),set:(r,s,n)=>{throw new Error(`TypeError: Cannot assign to read only property '${String(s)}' of object`)},deleteProperty:(r,s)=>{throw new Error(`TypeError: Cannot delete read only property '${String(s)}' of object`)},defineProperty:(r,s)=>{throw new Error(`TypeError: Cannot define property '${String(s)}' for a readonly object`)},setPrototypeOf:r=>{throw new Error("TypeError: Cannot set prototype for a readonly object")},isExtensible:()=>!1,preventExtensions:()=>!0}):i;return t(e)}_validateConfigurationAccess(e,t,i){const r=rs.test(e)?5:this._configurationScopes.get(e),s=i?`[${i.value}] `:"";if(r===5){typeof t?.resource>"u"&&this._logService.warn(`${s}Accessing a resource scoped configuration without providing a resource is not expected. To get the effective value for '${e}', provide the URI of a resource or 'null' for any resource.`);return}if(r===4){t?.resource&&this._logService.warn(`${s}Accessing a window scoped configuration for a resource is not expected. To associate '${e}' to a resource, define its scope to 'resource' in configuration contributions in 'package.json'.`);return}}_toConfigurationChangeEvent(e,t){const i=new rW(e,t,this._configuration,this._extHostWorkspace.workspace,this._logService);return Object.freeze({affectsConfiguration:(r,s)=>i.affectsConfiguration(r,T5(s))})}_toMap(e){return e.reduce((t,i)=>(t.set(i[0],i[1]),t),new Map)}},vr=q("IExtHostConfiguration"),cW=class{constructor(e,t){this.versionId=e,this.removedDueToLooping=t}},ed=class v8 extends X{static isHostExtension(t,i,r){if(i.getExtensionDescription(t))return!1;const s=r.getExtensionDescription(t);return s?!!((s.main||s.browser)&&s.api==="none"):!1}constructor(t,i){super(),this._activationEventsReader=t,this._onDidChange=this._register(new D),this.onDidChange=this._onDidChange.event,this._versionId=0,this._extensionDescriptions=i,this._initialize()}_initialize(){this._extensionDescriptions.sort(dW),this._extensionsMap=new As,this._extensionsArr=[],this._activationMap=new Map;for(const t of this._extensionDescriptions){if(this._extensionsMap.has(t.identifier)){console.error("Extension `"+t.identifier.value+"` is already registered");continue}this._extensionsMap.set(t.identifier,t),this._extensionsArr.push(t);const i=this._activationEventsReader.readActivationEvents(t);for(const r of i)this._activationMap.has(r)||this._activationMap.set(r,[]),this._activationMap.get(r).push(t)}}set(t){return this._extensionDescriptions=t,this._initialize(),this._versionId++,this._onDidChange.fire(void 0),{versionId:this._versionId}}deltaExtensions(t,i){this._extensionDescriptions=R5(this._extensionDescriptions,i),this._extensionDescriptions=this._extensionDescriptions.concat(t);const r=v8._findLoopingExtensions(this._extensionDescriptions);return this._extensionDescriptions=R5(this._extensionDescriptions,r.map(s=>s.identifier)),this._initialize(),this._versionId++,this._onDidChange.fire(void 0),new cW(this._versionId,r)}static _findLoopingExtensions(t){const i=new class{constructor(){this._arcs=new Map,this._nodesSet=new Set,this._nodesArr=[]}addNode(a){this._nodesSet.has(a)||(this._nodesSet.add(a),this._nodesArr.push(a))}addArc(a,l){this.addNode(a),this.addNode(l),this._arcs.has(a)?this._arcs.get(a).push(l):this._arcs.set(a,[l])}getArcs(a){return this._arcs.has(a)?this._arcs.get(a):[]}hasOnlyGoodArcs(a,l){const c=i.getArcs(a);for(let u=0;u<c.length;u++)if(!l.has(c[u]))return!1;return!0}getNodes(){return this._nodesArr}},r=new As;for(const a of t)if(r.set(a.identifier,a),a.extensionDependencies)for(const l of a.extensionDependencies)i.addArc(qe.toKey(a.identifier),qe.toKey(l));const s=new Set;i.getNodes().filter(a=>i.getArcs(a).length===0).forEach(a=>s.add(a));const n=i.getNodes().filter(a=>!s.has(a));let o;do{o=!1;for(let a=0;a<n.length;a++){const l=n[a];i.hasOnlyGoodArcs(l,s)&&(n.splice(a,1),a--,s.add(l),o=!0)}}while(o);return n.map(a=>r.get(a))}containsActivationEvent(t){return this._activationMap.has(t)}containsExtension(t){return this._extensionsMap.has(t)}getExtensionDescriptionsForActivationEvent(t){const i=this._activationMap.get(t);return i?i.slice(0):[]}getAllExtensionDescriptions(){return this._extensionsArr.slice(0)}getSnapshot(){return new uW(this._versionId,this.getAllExtensionDescriptions())}getExtensionDescription(t){const i=this._extensionsMap.get(t);return i||void 0}getExtensionDescriptionByUUID(t){for(const i of this._extensionsArr)if(i.uuid===t)return i}getExtensionDescriptionByIdOrUUID(t,i){return this.getExtensionDescription(t)??(i?this.getExtensionDescriptionByUUID(i):void 0)}},uW=class{constructor(e,t){this.versionId=e,this.extensions=t}},A5;(function(e){e[e.Builtin=0]="Builtin",e[e.User=1]="User",e[e.Dev=2]="Dev"})(A5||(A5={}));function dW(e,t){const i=e.isBuiltin?0:e.isUnderDevelopment?2:1,r=t.isBuiltin?0:t.isUnderDevelopment?2:1;if(i!==r)return i-r;const s=$e.basename(e.extensionLocation.path),n=$e.basename(t.extensionLocation.path);return s<n?-1:s>n?1:0}function R5(e,t){const i=new mo(t);return e.filter(r=>!i.has(r.identifier))}var Eg=class _8{static{this.NONE=new _8(!1,-1,-1,-1)}constructor(t,i,r,s){this.startup=t,this.codeLoadingTime=i,this.activateCallTime=r,this.activateResolvedTime=s}},Mw=class{constructor(e){this._startup=e,this._codeLoadingStart=-1,this._codeLoadingStop=-1,this._activateCallStart=-1,this._activateCallStop=-1,this._activateResolveStart=-1,this._activateResolveStop=-1}_delta(e,t){return e===-1||t===-1?-1:t-e}build(){return new Eg(this._startup,this._delta(this._codeLoadingStart,this._codeLoadingStop),this._delta(this._activateCallStart,this._activateCallStop),this._delta(this._activateResolveStart,this._activateResolveStop))}codeLoadingStart(){this._codeLoadingStart=Date.now()}codeLoadingStop(){this._codeLoadingStop=Date.now()}activateCallStart(){this._activateCallStart=Date.now()}activateCallStop(){this._activateCallStop=Date.now()}activateResolveStart(){this._activateResolveStart=Date.now()}activateResolveStop(){this._activateResolveStop=Date.now()}},Cg=class{constructor(e,t,i,r,s,n){this.activationFailed=e,this.activationFailedError=t,this.activationTimes=i,this.module=r,this.exports=s,this.disposable=n}},hW=class extends Cg{constructor(e){super(!1,null,e,{activate:void 0,deactivate:void 0},void 0,X.None)}},fW=class extends Cg{constructor(){super(!1,null,Eg.NONE,{activate:void 0,deactivate:void 0},void 0,X.None)}},Dg=class extends Cg{constructor(e){super(!0,e,Eg.NONE,{activate:void 0,deactivate:void 0},void 0,X.None)}},Ow=class{constructor(t,i,r,s){this._logService=s,this._registry=t,this._globalRegistry=i,this._host=r,this._operations=new As,this._alreadyActivatedEvents=Object.create(null)}dispose(){for(const[t,i]of this._operations)i.dispose()}async waitForActivatingExtensions(){const t=[];for(const[i,r]of this._operations)t.push(r.wait());await Promise.all(t)}isActivated(t){const i=this._operations.get(t);return!!(i&&i.value)}getActivatedExtension(t){const i=this._operations.get(t);if(!i||!i.value)throw new Error(`Extension '${t.value}' is not known or not activated`);return i.value}async activateByEvent(t,i){if(this._alreadyActivatedEvents[t])return;const r=this._registry.getExtensionDescriptionsForActivationEvent(t);await this._activateExtensions(r.map(s=>({id:s.identifier,reason:{startup:i,extensionId:s.identifier,activationEvent:t}}))),this._alreadyActivatedEvents[t]=!0}activateById(t,i){const r=this._registry.getExtensionDescription(t);if(!r)throw new Error(`Extension '${t.value}' is not known`);return this._activateExtensions([{id:r.identifier,reason:i}])}async _activateExtensions(t){const i=t.filter(r=>!this.isActivated(r.id)).map(r=>this._handleActivationRequest(r));await Promise.all(i.map(r=>r.wait()))}_handleActivationRequest(t){if(this._operations.has(t.id))return this._operations.get(t.id);if(this._isHostExtension(t.id))return this._createAndSaveOperation(t,null,[],null);const i=this._registry.getExtensionDescription(t.id);if(!i){const n=new Error(`Cannot activate unknown extension '${t.id.value}'`),o=this._createAndSaveOperation(t,null,[],new Dg(n));return this._host.onExtensionActivationError(t.id,n,new r4(t.id.value)),o}const r=[],s=typeof i.extensionDependencies>"u"?[]:i.extensionDependencies;for(const n of s){if(this._isResolvedExtension(n))continue;const o=this._operations.get(n);if(o){r.push(o);continue}if(this._isHostExtension(n)){r.push(this._handleActivationRequest({id:this._globalRegistry.getExtensionDescription(n).identifier,reason:t.reason}));continue}const a=this._registry.getExtensionDescription(n);if(a){if(!a.main&&!a.browser)continue;r.push(this._handleActivationRequest({id:a.identifier,reason:t.reason}));continue}const l=i.displayName||i.identifier.value,c=new Error(`Cannot activate the '${l}' extension because it depends on unknown extension '${n}'`),u=this._createAndSaveOperation(t,i.displayName,[],new Dg(c));return this._host.onExtensionActivationError(i.identifier,c,new r4(n)),u}return this._createAndSaveOperation(t,i.displayName,r,null)}_createAndSaveOperation(t,i,r,s){const n=new Fw(t.id,i,t.reason,r,s,this._host,this._logService);return this._operations.set(t.id,n),n}_isHostExtension(t){return ed.isHostExtension(t,this._registry,this._globalRegistry)}_isResolvedExtension(t){const i=this._globalRegistry.getExtensionDescription(t);return i?!i.main&&!i.browser:!1}};Ow=__decorate([__param(3,ke)],Ow);var Fw=class{get value(){return this._value}get friendlyName(){return this._displayName||this._id.value}constructor(t,i,r,s,n,o,a){this._id=t,this._displayName=i,this._reason=r,this._deps=s,this._value=n,this._host=o,this._logService=a,this._barrier=new dr,this._isDisposed=!1,this._initialize()}dispose(){this._isDisposed=!0}wait(){return this._barrier.wait()}async _initialize(){await this._waitForDepsThenActivate(),this._barrier.open()}async _waitForDepsThenActivate(){if(!this._value){for(;this._deps.length>0;){for(let t=0;t<this._deps.length;t++){const i=this._deps[t];if(i.value&&!i.value.activationFailed){this._deps.splice(t,1),t--;continue}if(i.value&&i.value.activationFailed){const r=new Error(`Cannot activate the '${this.friendlyName}' extension because its dependency '${i.friendlyName}' failed to activate`);r.detail=i.value.activationFailedError,this._value=new Dg(r),this._host.onExtensionActivationError(this._id,r,null);return}}this._deps.length>0&&await Promise.race(this._deps.map(t=>t.wait()))}await this._activate()}}async _activate(){try{this._value=await this._host.actualActivateExtension(this._id,this._reason)}catch(t){const i=new Error;if(t&&t.name&&(i.name=t.name),t&&t.message?i.message=`Activating extension '${this._id.value}' failed: ${t.message}.`:i.message=`Activating extension '${this._id.value}' failed: ${t}.`,t&&t.stack&&(i.stack=t.stack),this._value=new Dg(i),this._isDisposed&&Yi(t))return;this._host.onExtensionActivationError(this._id,i,null),this._logService.error(`Activating extension ${this._id.value} failed due to an error:`),this._logService.error(t)}}};Fw=__decorate([__param(6,ke)],Fw);var L5=class{constructor(e,t){this._logService=t,this._onDidChangeStorage=new D,this.onDidChangeStorage=this._onDidChangeStorage.event,this._proxy=e.getProxy(Q.MainThreadStorage)}registerExtensionStorageKeysToSync(e,t){this._proxy.$registerExtensionStorageKeysToSync(e,t)}async initializeExtensionStorage(e,t,i){const r=await this._proxy.$initializeExtensionStorage(e,t);let s;return r&&(s=this.safeParseValue(e,t,r)),s||i}setValue(e,t,i){return this._proxy.$setValue(e,t,i)}$acceptValue(e,t,i){const r=this.safeParseValue(e,t,i);r&&this._onDidChangeStorage.fire({shared:e,key:t,value:r})}safeParseValue(e,t,i){try{return JSON.parse(i)}catch(r){this._logService.error(`[extHostStorage] unexpected error parsing storage contents (extensionId: ${t}, global: ${e}): ${r}`)}}},$w=q("IExtHostStorage"),N5=class{constructor(e,t,i){this._deferredPromises=new Map,this._id=e,this._shared=t,this._storage=i,this._init=this._storage.initializeExtensionStorage(this._shared,this._id,Object.create(null)).then(r=>(this._value=r,this)),this._storageListener=this._storage.onDidChangeStorage(r=>{r.shared===this._shared&&r.key===this._id&&(this._value=r.value)}),this._scheduler=new ks(()=>{const r=this._deferredPromises;this._deferredPromises=new Map,(async()=>{try{await this._storage.setValue(this._shared,this._id,this._value);for(const s of r.values())s.complete()}catch(s){for(const n of r.values())n.error(s)}})()},0)}keys(){return Object.entries(this._value??{}).filter(([,e])=>e!==void 0).map(([e])=>e)}get whenReady(){return this._init}get(e,t){let i=this._value[e];return typeof i>"u"&&(i=t),i}update(e,t){t!==null&&typeof t=="object"?this._value[e]=JSON.parse(JSON.stringify(t)):this._value[e]=t;const i=this._deferredPromises.get(e);if(i!==void 0)return i.p;const r=new hr;return this._deferredPromises.set(e,r),this._scheduler.isScheduled()||this._scheduler.schedule(),r.p}dispose(){this._storageListener.dispose()}},pW=class extends N5{setKeysForSync(e){this._storage.registerExtensionStorageKeysToSync({id:this._id,version:this._extension.version},e)}constructor(e,t){super(e.identifier.value,!0,t),this._extension=e}},ds,Hw=ds=class{constructor(t,i){this._fileSystemProvider=new Map,this._writeQueue=new wE,this._proxy=t.getProxy(Q.MainThreadFileSystem);const r=this;this.value=Object.freeze({async stat(s){try{let n;const o=r._fileSystemProvider.get(s.scheme);return o?(await r._proxy.$ensureActivation(s.scheme),n=await o.impl.stat(s)):n=await r._proxy.$stat(s),{type:n.type,ctime:n.ctime,mtime:n.mtime,size:n.size,permissions:n.permissions===En.Readonly?1:void 0}}catch(n){ds._handleError(n)}},async readDirectory(s){try{const n=r._fileSystemProvider.get(s.scheme);return n?(await r._proxy.$ensureActivation(s.scheme),(await n.impl.readDirectory(s)).slice()):await r._proxy.$readdir(s)}catch(n){return ds._handleError(n)}},async createDirectory(s){try{const n=r._fileSystemProvider.get(s.scheme);return n&&!n.isReadonly?(await r._proxy.$ensureActivation(s.scheme),await r.mkdirp(n.impl,n.extUri,s)):await r._proxy.$mkdir(s)}catch(n){return ds._handleError(n)}},async readFile(s){try{const n=r._fileSystemProvider.get(s.scheme);return n?(await r._proxy.$ensureActivation(s.scheme),(await n.impl.readFile(s)).slice()):(await r._proxy.$readFile(s)).buffer}catch(n){return ds._handleError(n)}},async writeFile(s,n){try{const o=r._fileSystemProvider.get(s.scheme);return o&&!o.isReadonly?(await r._proxy.$ensureActivation(s.scheme),await r.mkdirp(o.impl,o.extUri,o.extUri.dirname(s)),await r._writeQueue.queueFor(s,()=>Promise.resolve(o.impl.writeFile(s,n,{create:!0,overwrite:!0})))):await r._proxy.$writeFile(s,z.wrap(n))}catch(o){return ds._handleError(o)}},async delete(s,n){try{const o=r._fileSystemProvider.get(s.scheme);return o&&!o.isReadonly&&!n?.useTrash?(await r._proxy.$ensureActivation(s.scheme),await o.impl.delete(s,{recursive:!1,...n})):await r._proxy.$delete(s,{recursive:!1,useTrash:!1,atomic:!1,...n})}catch(o){return ds._handleError(o)}},async rename(s,n,o){try{return await r._proxy.$rename(s,n,{overwrite:!1,...o})}catch(a){return ds._handleError(a)}},async copy(s,n,o){try{return await r._proxy.$copy(s,n,{overwrite:!1,...o})}catch(a){return ds._handleError(a)}},isWritableFileSystem(s){const n=i.getCapabilities(s);if(typeof n=="number")return!(n&2048)}})}async mkdirp(t,i,r){const s=[];for(;!i.isEqual(r,i.dirname(r));)try{if(((await t.stat(r)).type&qi.Directory)===0)throw qt.FileExists(`Unable to create folder '${r.scheme===V.file?r.fsPath:r.toString(!0)}' that already exists but is not a directory`);break}catch(n){if(Zh(n)!==de.FileNotFound)throw n;s.push(i.basename(r)),r=i.dirname(r)}for(let n=s.length-1;n>=0;n--){r=i.joinPath(r,s[n]);try{await t.createDirectory(r)}catch(o){if(Zh(o)!==de.FileExists)throw o}}}static _handleError(t){if(t instanceof qt)throw t;if(t instanceof Yh)switch(t.code){case de.FileExists:throw qt.FileExists(t.message);case de.FileNotFound:throw qt.FileNotFound(t.message);case de.FileNotADirectory:throw qt.FileNotADirectory(t.message);case de.FileIsADirectory:throw qt.FileIsADirectory(t.message);case de.NoPermissions:throw qt.NoPermissions(t.message);case de.Unavailable:throw qt.Unavailable(t.message);default:throw new qt(t.message,t.name)}if(!(t instanceof Error))throw new qt(String(t));if(t.name==="ENOPRO"||t.message.includes("ENOPRO"))throw qt.Unavailable(t.message);switch(t.name){case de.FileExists:throw qt.FileExists(t.message);case de.FileNotFound:throw qt.FileNotFound(t.message);case de.FileNotADirectory:throw qt.FileNotADirectory(t.message);case de.FileIsADirectory:throw qt.FileIsADirectory(t.message);case de.NoPermissions:throw qt.NoPermissions(t.message);case de.Unavailable:throw qt.Unavailable(t.message);default:throw new qt(t.message,t.name)}}addFileSystemProvider(t,i,r){return this._fileSystemProvider.set(t,{impl:i,extUri:r?.isCaseSensitive?Ge:O3,isReadonly:!!r?.isReadonly}),ie(()=>this._fileSystemProvider.delete(t))}getFileSystemProviderExtUri(t){return this._fileSystemProvider.get(t)?.extUri??Ge}};Hw=ds=__decorate([__param(0,Pe),__param(1,Ma)],Hw);var td=q("IExtHostConsumerFileSystem"),Uw=q("IExtensionStoragePaths"),Ww=class{constructor(t,i,r){this._logService=i,this._extHostFileSystem=r,this._workspace=t.workspace??void 0,this._environment=t.environment,this.whenReady=this._getOrCreateWorkspaceStoragePath().then(s=>this._value=s)}async _getWorkspaceStorageURI(t){return b.joinPath(this._environment.workspaceStorageHome,t)}async _getOrCreateWorkspaceStoragePath(){if(!this._workspace)return Promise.resolve(void 0);const t=this._workspace.id,i=await this._getWorkspaceStorageURI(t);try{return await this._extHostFileSystem.value.stat(i),this._logService.trace("[ExtHostStorage] storage dir already exists",i),i}catch{}try{return this._logService.trace("[ExtHostStorage] creating dir and metadata-file",i),await this._extHostFileSystem.value.createDirectory(i),await this._extHostFileSystem.value.writeFile(b.joinPath(i,"meta.json"),new TextEncoder().encode(JSON.stringify({id:this._workspace.id,configuration:b.revive(this._workspace.configuration)?.toString(),name:this._workspace.name},void 0,2))),i}catch(r){this._logService.error("[ExtHostStorage]",r);return}}workspaceValue(t){if(this._value)return b.joinPath(this._value,t.identifier.value)}globalValue(t){return b.joinPath(this._environment.globalStorageHome,t.identifier.value.toLowerCase())}onWillDeactivateAll(){}};Ww=__decorate([__param(0,zt),__param(1,ke),__param(2,td)],Ww);var gW=q("tunnelService"),Zee=q("sharedTunnelsService"),_r;(function(e){e.Http="http",e.Https="https"})(_r||(_r={}));var hs;(function(e){e.ConstantPrivate="constantPrivate",e.Private="private",e.Public="public"})(hs||(hs={}));function mW(e){return!!e.forwardPort}var zn;(function(e){e[e.Notify=1]="Notify",e[e.OpenBrowser=2]="OpenBrowser",e[e.OpenPreview=3]="OpenPreview",e[e.Silent=4]="Silent",e[e.Ignore=5]="Ignore",e[e.OpenBrowserOnce=6]="OpenBrowserOnce"})(zn||(zn={}));function vW(e){if(e.scheme!=="http"&&e.scheme!=="https")return;const t=/^(localhost|127\.0\.0\.1|0\.0\.0\.0):(\d+)$/.exec(e.authority);if(t)return{address:t[1],port:+t[2]}}var id=["localhost","127.0.0.1","0:0:0:0:0:0:0:1","::1"];function ea(e){return id.indexOf(e)>=0}var kg=["0.0.0.0","0:0:0:0:0:0:0:0","::"];function Js(e){return kg.indexOf(e)>=0}function _W(e,t,i,r){if(i===1)return!1;if(i===2&&Js(t)){const s=/(\d+)\.(\d+)\.(\d+)/g.exec(r);if(s?.length===4&&parseInt(s[1])>=18)return!1}return e<1024}var wW=class{constructor(e,t,i){this.remoteAddress=e,this.localAddress=t,this._dispose=i,this._onDispose=new D,this.onDidDispose=this._onDispose.event}dispose(){return this._onDispose.fire(),this._dispose()}},Bw=class extends X{constructor(t,i){super(),this.logService=t,this.configurationService=i,this._onTunnelOpened=new D,this.onTunnelOpened=this._onTunnelOpened.event,this._onTunnelClosed=new D,this.onTunnelClosed=this._onTunnelClosed.event,this._onAddedTunnelProvider=new D,this.onAddedTunnelProvider=this._onAddedTunnelProvider.event,this._tunnels=new Map,this._canElevate=!1,this._canChangeProtocol=!0,this._privacyOptions=[],this._factoryInProgress=new Set}get hasTunnelProvider(){return!!this._tunnelProvider}get defaultTunnelHost(){const t=this.configurationService.getValue("remote.localPortHost");return!t||t==="localhost"?"127.0.0.1":"0.0.0.0"}setTunnelProvider(t){return this._tunnelProvider=t,t?(this._onAddedTunnelProvider.fire(),{dispose:()=>{this._tunnelProvider=void 0,this._canElevate=!1,this._privacyOptions=[]}}):(this._canElevate=!1,this._privacyOptions=[],this._onAddedTunnelProvider.fire(),{dispose:()=>{}})}setTunnelFeatures(t){this._canElevate=t.elevation,this._privacyOptions=t.privacyOptions,this._canChangeProtocol=t.protocol}get canChangeProtocol(){return this._canChangeProtocol}get canElevate(){return this._canElevate}get canChangePrivacy(){return this._privacyOptions.length>0}get privacyOptions(){return this._privacyOptions}get tunnels(){return this.getTunnels()}async getTunnels(){const t=[],i=Array.from(this._tunnels.values());for(const r of i){const s=Array.from(r.values());for(const n of s){const o=await n.value;o&&typeof o!="string"&&t.push(o)}}return t}async dispose(){super.dispose();for(const t of this._tunnels.values()){for(const{value:i}of t.values())await i.then(r=>typeof r!="string"?r?.dispose():void 0);t.clear()}this._tunnels.clear()}setEnvironmentTunnel(t,i,r,s,n){this.addTunnelToMap(t,i,Promise.resolve({tunnelRemoteHost:t,tunnelRemotePort:i,localAddress:r,privacy:s,protocol:n,dispose:()=>Promise.resolve()}))}async getExistingTunnel(t,i){(Js(t)||ea(t))&&(t=id[0]);const r=this.getTunnelFromMap(t,i);if(r)return++r.refcount,r.value}openTunnel(t,i,r,s,n,o=!1,a,l){this.logService.trace(`ForwardedPorts: (TunnelService) openTunnel request for ${i}:${r} on local port ${n}.`);const c=this._tunnelProvider??t;if(!c)return;if(i||(i="localhost"),s||(s=this.defaultTunnelHost),this._tunnelProvider&&this._factoryInProgress.has(r)){this.logService.debug("ForwardedPorts: (TunnelService) Another call to create a tunnel with the same address has occurred before the last one completed. This call will be ignored.");return}const u=this.retainOrCreateTunnel(c,i,r,s,n,o,a,l);return u?u.then(d=>{if(d){if(typeof d=="string")return this.logService.trace("ForwardedPorts: (TunnelService) The tunnel provider returned an error when creating the tunnel."),this.removeEmptyOrErrorTunnelFromMap(i,r),d}else{this.logService.trace("ForwardedPorts: (TunnelService) New tunnel is undefined."),this.removeEmptyOrErrorTunnelFromMap(i,r);return}this.logService.trace("ForwardedPorts: (TunnelService) New tunnel established.");const f=this.makeTunnel(d);return(d.tunnelRemoteHost!==i||d.tunnelRemotePort!==r)&&this.logService.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Host or port mismatch."),a&&d.privacy!==a&&this.logService.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Privacy mismatch."),this._onTunnelOpened.fire(f),f}):(this.logService.trace("ForwardedPorts: (TunnelService) Tunnel was not created."),u)}makeTunnel(t){return{tunnelRemotePort:t.tunnelRemotePort,tunnelRemoteHost:t.tunnelRemoteHost,tunnelLocalPort:t.tunnelLocalPort,localAddress:t.localAddress,privacy:t.privacy,protocol:t.protocol,dispose:async()=>{this.logService.trace(`ForwardedPorts: (TunnelService) dispose request for ${t.tunnelRemoteHost}:${t.tunnelRemotePort} `);const i=this._tunnels.get(t.tunnelRemoteHost);if(i){const r=i.get(t.tunnelRemotePort);r&&(r.refcount--,await this.tryDisposeTunnel(t.tunnelRemoteHost,t.tunnelRemotePort,r))}}}}async tryDisposeTunnel(t,i,r){if(r.refcount<=0){this.logService.trace(`ForwardedPorts: (TunnelService) Tunnel is being disposed ${t}:${i}.`);const s=r.value.then(async n=>{n&&typeof n!="string"&&(await n.dispose(!0),this._onTunnelClosed.fire({host:n.tunnelRemoteHost,port:n.tunnelRemotePort}))});return this._tunnels.has(t)&&this._tunnels.get(t).delete(i),s}}async closeTunnel(t,i){this.logService.trace(`ForwardedPorts: (TunnelService) close request for ${t}:${i} `);const r=this._tunnels.get(t);if(r&&r.has(i)){const s=r.get(i);s.refcount=0,await this.tryDisposeTunnel(t,i,s)}}addTunnelToMap(t,i,r){this._tunnels.has(t)||this._tunnels.set(t,new Map),this._tunnels.get(t).set(i,{refcount:1,value:r})}async removeEmptyOrErrorTunnelFromMap(t,i){const r=this._tunnels.get(t);if(r){const s=r.get(i),n=s?await s.value:void 0;(!n||typeof n=="string")&&r.delete(i),r.size===0&&this._tunnels.delete(t)}}getTunnelFromMap(t,i){const r=[t];ea(t)?(r.push(...id),r.push(...kg)):Js(t)&&r.push(...kg);const s=r.map(n=>this._tunnels.get(n));for(const n of s){const o=n?.get(i);if(o)return o}}canTunnel(t){return!!vW(t)}createWithProvider(t,i,r,s,n,o,a){this.logService.trace(`ForwardedPorts: (TunnelService) Creating tunnel with provider ${i}:${r} on local port ${s}.`);const l=r;this._factoryInProgress.add(l);const c=s===void 0?r:s,u={elevationRequired:n?this.isPortPrivileged(c):!1},d={remoteAddress:{host:i,port:r},localAddressPort:s,privacy:o,public:o?o!==hs.Private:void 0,protocol:a},f=t.forwardPort(d,u);return f?(this.addTunnelToMap(i,r,f),f.finally(()=>{this.logService.trace("ForwardedPorts: (TunnelService) Tunnel created by provider."),this._factoryInProgress.delete(l)})):this._factoryInProgress.delete(l),f}};Bw=__decorate([__param(0,ke),__param(1,Us)],Bw);var yW=class extends wW{},Vw;(function(e){function t(r){return{remoteAddress:r.remoteAddress,localAddress:r.localAddress,public:!!r.public,privacy:r.privacy??(r.public?hs.Public:hs.Private),protocol:r.protocol}}e.fromApiTunnel=t;function i(r){return{remoteAddress:{host:r.tunnelRemoteHost,port:r.tunnelRemotePort},localAddress:r.localAddress,public:r.privacy!==hs.ConstantPrivate&&r.privacy!==hs.ConstantPrivate,privacy:r.privacy,protocol:r.protocol}}e.fromServiceTunnel=i})(Vw||(Vw={}));var Ig=q("IExtHostTunnelService"),Pg=class extends X{constructor(t,i,r){super(),this.logService=r,this._showCandidatePort=()=>Promise.resolve(!0),this._extensionTunnels=new Map,this._onDidChangeTunnels=new D,this.onDidChangeTunnels=this._onDidChangeTunnels.event,this._providerHandleCounter=0,this._portAttributesProviders=new Map,this._proxy=t.getProxy(Q.MainThreadTunnelService)}async openTunnel(t,i){this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) ${t.identifier.value} called openTunnel API for ${i.remoteAddress.host}:${i.remoteAddress.port}.`);const r=await this._proxy.$openTunnel(i,t.displayName);if(r){const s=new yW(r.remoteAddress,r.localAddress,()=>this._proxy.$closeTunnel(r.remoteAddress));return this._register(s),s}}async getTunnels(){return this._proxy.$getTunnels()}nextPortAttributesProviderHandle(){return this._providerHandleCounter++}registerPortsAttributesProvider(t,i){t.portRange===void 0&&t.commandPattern===void 0&&this.logService.error("PortAttributesProvider must specify either a portRange or a commandPattern");const r=this.nextPortAttributesProviderHandle();return this._portAttributesProviders.set(r,{selector:t,provider:i}),this._proxy.$registerPortsAttributesProvider(t,r),new Ie(()=>{this._portAttributesProviders.delete(r),this._proxy.$unregisterPortsAttributesProvider(r)})}async $providePortAttributes(t,i,r,s,n){const o=[];for(const l of t){const c=this._portAttributesProviders.get(l);if(!c)return[];o.push(...await Promise.all(i.map(async u=>{let d;try{d=await c.provider.providePortAttributes({port:u,pid:r,commandLine:s},n)}catch{d=await c.provider.providePortAttributes(u,r,s,n)}return{providedAttributes:d,port:u}})))}const a=o.filter(l=>!!l.providedAttributes);return a.length>0?a.map(l=>({autoForwardAction:l.providedAttributes.autoForwardAction,port:l.port})):[]}async $registerCandidateFinder(t){}registerTunnelProvider(t,i){if(this._forwardPortProvider)throw new Error("A tunnel provider has already been registered. Only the first tunnel provider to be registered will be used.");this._forwardPortProvider=async(s,n)=>await t.provideTunnel(s,n,Be.None)??void 0;const r=i.tunnelFeatures?{elevation:!!i.tunnelFeatures?.elevation,privacyOptions:i.tunnelFeatures?.privacyOptions,protocol:i.tunnelFeatures.protocol===void 0?!0:i.tunnelFeatures.protocol}:void 0;return this._proxy.$setTunnelProvider(r,!0),Promise.resolve(ie(()=>{this._forwardPortProvider=void 0,this._proxy.$setTunnelProvider(void 0,!1)}))}async setTunnelFactory(t,i){if(t){t.candidatePortSource!==void 0&&this._proxy.$setCandidatePortSource(t.candidatePortSource),t.showCandidatePort&&(this._showCandidatePort=t.showCandidatePort,this._proxy.$setCandidateFilter());const r=t.tunnelFactory??(i?this.makeManagedTunnelFactory(i):void 0);if(r){this._forwardPortProvider=r;let s=t.tunnelFeatures?.privacyOptions??[];t.tunnelFeatures?.public&&s.length===0&&(s=[{id:"private",label:h(2940,null),themeIcon:"lock"},{id:"public",label:h(2941,null),themeIcon:"eye"}]);const n=t.tunnelFeatures?{elevation:!!t.tunnelFeatures?.elevation,public:!!t.tunnelFeatures?.public,privacyOptions:s,protocol:!0}:void 0;this._proxy.$setTunnelProvider(n,!!t.tunnelFactory)}}else this._forwardPortProvider=void 0;return ie(()=>{this._forwardPortProvider=void 0})}makeManagedTunnelFactory(t){}async $closeTunnel(t,i){if(this._extensionTunnels.has(t.host)){const r=this._extensionTunnels.get(t.host);r.has(t.port)&&(i&&r.get(t.port).disposeListener.dispose(),await r.get(t.port).tunnel.dispose(),r.delete(t.port))}}async $onDidTunnelsChange(){this._onDidChangeTunnels.fire()}async $forwardPort(t,i){if(this._forwardPortProvider)try{this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Getting tunnel from provider.");const r=this._forwardPortProvider(t,i);if(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Got tunnel promise from provider."),r!==void 0){const s=await r;if(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Successfully awaited tunnel from provider."),s===void 0){this.logService.error("ForwardedPorts: (ExtHostTunnelService) Resolved tunnel is undefined");return}this._extensionTunnels.has(t.remoteAddress.host)||this._extensionTunnels.set(t.remoteAddress.host,new Map);const n=this._register(s.onDidDispose(()=>(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Extension fired tunnel's onDidDispose."),this._proxy.$closeTunnel(s.remoteAddress))));return this._extensionTunnels.get(t.remoteAddress.host).set(t.remoteAddress.port,{tunnel:s,disposeListener:n}),Vw.fromApiTunnel(s)}else this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Tunnel is undefined")}catch(r){if(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) tunnel provider error"),r instanceof Error)return r.message}}async $applyCandidateFilter(t){const i=await Promise.all(t.map(s=>this._showCandidatePort(s.host,s.port,s.detail??""))),r=t.filter((s,n)=>i[n]);return this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) filtered from ${t.map(s=>s.port).join(", ")} to ${r.map(s=>s.port).join(", ")}`),r}};Pg=__decorate([__param(0,Pe),__param(1,zt),__param(2,ke)],Pg);function bW(e){return[...e.entries()]}function SW(e){return e?[...e.entries()]:[]}var xW=class{constructor(e){this._callback=e,this._terminalBufferMap=new Map}dispose(){for(const e of this._terminalBufferMap.values())e.dispose()}startBuffering(e,t,i=5){const r=t(s=>{const n=typeof s=="string"?s:s.data;let o=this._terminalBufferMap.get(e);if(o){o.data.push(n);return}const a=setTimeout(()=>this.flushBuffer(e),i);o={data:[n],timeoutId:a,dispose:()=>{clearTimeout(a),this.flushBuffer(e),r.dispose()}},this._terminalBufferMap.set(e,o)});return r}stopBuffering(e){this._terminalBufferMap.get(e)?.dispose()}flushBuffer(e){const t=this._terminalBufferMap.get(e);t&&(this._terminalBufferMap.delete(e),this._callback(e,t.data.join("")))}},ta=(e,t,i,r)=>{let s=t;return{enumerable:!0,configurable:!1,get(){return s},set(n){if(!i(s,n)){const o=s;s=n,e.listener?.(r(n,o))}}}},$l=(e,t)=>e===t,qn={range:(e,t)=>e===t?!0:!e||!t?!1:e.isEqual(t),label:$l,description:$l,sortText:$l,busy:$l,error:$l,canResolveChildren:$l,tags:(e,t)=>!(e.length!==t.length||e.some(i=>!t.find(r=>i.id===r.id)))},Hl=e=>t=>({op:4,update:e(t)}),EW=(e,t)=>({range:(()=>{let i;const r=Hl(s=>({range:je.lift(F.from(s))}));return{enumerable:!0,configurable:!1,get(){return i},set(s){e.listener?.({op:6}),qn.range(i,s)||(i=s,e.listener?.(r(s)))}}})(),label:ta(e,t,qn.label,Hl(i=>({label:i}))),description:ta(e,void 0,qn.description,Hl(i=>({description:i}))),sortText:ta(e,void 0,qn.sortText,Hl(i=>({sortText:i}))),canResolveChildren:ta(e,!1,qn.canResolveChildren,i=>({op:2,state:i})),busy:ta(e,!1,qn.busy,Hl(i=>({busy:i}))),error:ta(e,void 0,qn.error,Hl(i=>({error:ve.fromStrict(i)||null}))),tags:ta(e,[],qn.tags,(i,r)=>({op:1,new:i.map(Wr.from),old:r.map(Wr.from)}))}),CW=e=>{const t=He.fromString(e.extId),i=new rd(t.controllerId,t.localId,e.label,b.revive(e.uri)||void 0);return i.range=F.to(e.range||void 0),i.description=e.description||void 0,i.sortText=e.sortText||void 0,i.tags=e.tags.map(r=>Wr.to({id:AP(r).tagId})),i},M5=e=>{let t;for(const i of e.tests){const r=CW(i.item);Of(r).parent=t,t=r}return t},rd=class w8{constructor(t,i,r,s){if(i.includes("\0"))throw new Error(`Test IDs may not include the ${JSON.stringify(i)} symbol`);const n=WH(this,t);Object.defineProperties(this,{id:{value:i,enumerable:!0,writable:!1},uri:{value:s,enumerable:!0,writable:!1},parent:{enumerable:!1,get(){return n.parent instanceof zw?void 0:n.parent}},children:{value:UH(n,Of,w8),enumerable:!0,writable:!1},...EW(n,r)})}},zw=class extends rd{constructor(e,t){super(e,e,t,void 0),this._isRoot=!0}},DW=class extends FH{constructor(e,t,i){super({controllerId:e,getDocumentVersion:r=>r&&i.getDocument(r)?.version,getApiFor:Of,getChildren:r=>r.children,root:new zw(e,t),toITestItem:Wn.from})}},sd;(function(e){e[e.Desktop=1]="Desktop",e[e.Web=2]="Web"})(sd||(sd={}));var O5;(function(e){e[e.VersionMismatch=55]="VersionMismatch",e[e.UnexpectedError=81]="UnexpectedError"})(O5||(O5={}));var F5;(function(e){e[e.Initialized=0]="Initialized",e[e.Ready=1]="Ready",e[e.Terminate=2]="Terminate"})(F5||(F5={}));function $5(e){const t=z.alloc(1);switch(e){case 0:t.writeUInt8(1,0);break;case 1:t.writeUInt8(2,0);break;case 2:t.writeUInt8(3,0);break}return t}function kW(e,t){if(e.byteLength!==1)return!1;switch(e.readUInt8(0)){case 1:return t===0;case 2:return t===1;case 3:return t===2;default:return!1}}var H5;(function(e){e.Start="START_NATIVE_LOG",e.End="END_NATIVE_LOG"})(H5||(H5={}));var qw=class extends X{constructor(t,i,r){super(),this.initData=i,this._onDidChangeTelemetryEnabled=this._register(new D),this.onDidChangeTelemetryEnabled=this._onDidChangeTelemetryEnabled.event,this._onDidChangeTelemetryConfiguration=this._register(new D),this.onDidChangeTelemetryConfiguration=this._onDidChangeTelemetryConfiguration.event,this._productConfig={usage:!0,error:!0},this._level=0,this._inLoggingOnlyMode=!1,this._telemetryLoggers=new Map,this._inLoggingOnlyMode=this.initData.environment.isExtensionTelemetryLoggingOnly;const s=i.remote.isRemote?"remoteExtHostTelemetry":t?"workerExtHostTelemetry":"extHostTelemetry";this._outputLogger=this._register(r.createLogger(s,{name:h(2937,null,this._inLoggingOnlyMode?" (Not Sent)":""),hidden:!0,group:EH}))}getTelemetryConfiguration(){return this._level===3}getTelemetryDetails(){return{isCrashEnabled:this._level>=1,isErrorsEnabled:this._productConfig.error?this._level>=2:!1,isUsageEnabled:this._productConfig.usage?this._level>=3:!1}}instantiateLogger(t,i,r){const s=this.getTelemetryDetails(),n=new U5(i,r,t,this._outputLogger,this._inLoggingOnlyMode,this.getBuiltInCommonProperties(t),{isUsageEnabled:s.isUsageEnabled,isErrorsEnabled:s.isErrorsEnabled}),o=this._telemetryLoggers.get(t.identifier.value)??[];return this._telemetryLoggers.set(t.identifier.value,[...o,n]),n.apiTelemetryLogger}$initializeTelemetryLevel(t,i,r){this._level=t,this._productConfig=r??{usage:!0,error:!0}}getBuiltInCommonProperties(t){const i=Object.create(null);switch(i["common.extname"]=`${t.publisher}.${t.name}`,i["common.extversion"]=t.version,i["common.vscodemachineid"]=this.initData.telemetryInfo.machineId,i["common.vscodesessionid"]=this.initData.telemetryInfo.sessionId,i["common.vscodecommithash"]=this.initData.commit,i["common.sqmid"]=this.initData.telemetryInfo.sqmId,i["common.devDeviceId"]=this.initData.telemetryInfo.devDeviceId,i["common.vscodeversion"]=this.initData.version,i["common.isnewappinstall"]=W5(this.initData.telemetryInfo.firstSessionDate),i["common.product"]=this.initData.environment.appHost,this.initData.uiKind){case sd.Web:i["common.uikind"]="web";break;case sd.Desktop:i["common.uikind"]="desktop";break;default:i["common.uikind"]="unknown"}return i["common.remotename"]=r1(DH(this.initData.remote.authority)),i}$onDidChangeTelemetryLevel(t){this._oldTelemetryEnablement=this.getTelemetryConfiguration(),this._level=t;const i=this.getTelemetryDetails();this._telemetryLoggers.forEach((r,s)=>{const n=r.filter(o=>!o.isDisposed);n.length===0?this._telemetryLoggers.delete(s):this._telemetryLoggers.set(s,n)}),this._telemetryLoggers.forEach(r=>{for(const s of r)s.updateTelemetryEnablements(i.isUsageEnabled,i.isErrorsEnabled)}),this._oldTelemetryEnablement!==this.getTelemetryConfiguration()&&this._onDidChangeTelemetryEnabled.fire(this.getTelemetryConfiguration()),this._onDidChangeTelemetryConfiguration.fire(this.getTelemetryDetails())}onExtensionError(t,i){const s=this._telemetryLoggers.get(t.value)?.filter(o=>!o.isDisposed);if(!s)return this._telemetryLoggers.delete(t.value),!1;let n=!1;for(const o of s)o.ignoreUnhandledExtHostErrors||(o.logError(i),n=!0);return n}};qw=__decorate([__param(1,zt),__param(2,La)],qw);var U5=class{static validateSender(e){if(typeof e!="object")throw new TypeError("TelemetrySender argument is invalid");if(typeof e.sendEventData!="function")throw new TypeError("TelemetrySender.sendEventData must be a function");if(typeof e.sendErrorData!="function")throw new TypeError("TelemetrySender.sendErrorData must be a function");if(typeof e.flush<"u"&&typeof e.flush!="function")throw new TypeError("TelemetrySender.flush must be a function or undefined")}constructor(e,t,i,r,s,n,o){this._extension=i,this._logger=r,this._inLoggingOnlyMode=s,this._commonProperties=n,this._onDidChangeEnableStates=new D,this.ignoreUnhandledExtHostErrors=t?.ignoreUnhandledErrors??!1,this._ignoreBuiltinCommonProperties=t?.ignoreBuiltInCommonProperties??!1,this._additionalCommonProperties=t?.additionalCommonProperties,this._sender=e,this._telemetryEnablements={isUsageEnabled:o.isUsageEnabled,isErrorsEnabled:o.isErrorsEnabled}}updateTelemetryEnablements(e,t){this._apiObject&&(this._telemetryEnablements={isUsageEnabled:e,isErrorsEnabled:t},this._onDidChangeEnableStates.fire(this._apiObject))}mixInCommonPropsAndCleanData(e){let t="properties"in e?e.properties??{}:e;return t=i4(t,[]),this._additionalCommonProperties&&(t=Is(t,this._additionalCommonProperties)),this._ignoreBuiltinCommonProperties||(t=Is(t,this._commonProperties)),"properties"in e?e.properties=t:e=t,e}logEvent(e,t){this._sender&&(this._extension.publisher==="vscode"?e=this._extension.name+"/"+e:e=this._extension.identifier.value+"/"+e,t=this.mixInCommonPropsAndCleanData(t||{}),this._inLoggingOnlyMode||this._sender?.sendEventData(e,t),this._logger.trace(e,t))}logUsage(e,t){this._telemetryEnablements.isUsageEnabled&&this.logEvent(e,t)}logError(e,t){if(!(!this._telemetryEnablements.isErrorsEnabled||!this._sender))if(typeof e=="string")this.logEvent(e,t);else{const i={name:e.name,message:e.message,stack:e.stack,cause:e.cause},r=i4(i,[]),s=new Error(r.message,{cause:r.cause});s.stack=r.stack,s.name=r.name,t=this.mixInCommonPropsAndCleanData(t||{}),this._inLoggingOnlyMode||this._sender.sendErrorData(s,t),this._logger.trace("exception",t)}}get apiTelemetryLogger(){if(!this._apiObject){const e=this,t={logUsage:e.logUsage.bind(e),get isUsageEnabled(){return e._telemetryEnablements.isUsageEnabled},get isErrorsEnabled(){return e._telemetryEnablements.isErrorsEnabled},logError:e.logError.bind(e),dispose:e.dispose.bind(e),onDidChangeEnableStates:e._onDidChangeEnableStates.event.bind(e)};this._apiObject=Object.freeze(t)}return this._apiObject}get isDisposed(){return!this._sender}dispose(){if(this._sender?.flush){let e=this._sender;this._sender=void 0,Promise.resolve(e.flush()).then(e=void 0),this._apiObject=void 0}else this._sender=void 0}};function W5(e){const t=Date.now()-new Date(e).getTime();return isNaN(t)?!1:t<1e3*60*60*24}var Tg=q("IExtHostTelemetry"),jw=class{#e;#t;#i;constructor(t,i,r){this._commands=new Map,this._apiCommands=new Map,this.#e=t.getProxy(Q.MainThreadCommands),this._logService=i,this.#i=r,this.#t=t.getProxy(Q.MainThreadTelemetry),this.converter=new IW(this,s=>{const n=this._apiCommands.get(s);return n?.result===ge.Void?n:void 0},i),this._argumentProcessors=[{processArgument(s){return kt(s)}},{processArgument(s){return Ta(s,function(n){if(je.isIRange(n))return F.to(n);if(sr.isIPosition(n))return Qe.to(n);if(je.isIRange(n.range)&&b.isUri(n.uri))return Ai.to(n);if(n instanceof z)return n.buffer.buffer;if(!Array.isArray(n))return n})}}]}registerArgumentProcessor(t){this._argumentProcessors.push(t)}registerApiCommand(t){const i=this.registerCommand(!1,t.id,async(...r)=>{const s=t.args.map((o,a)=>{if(!o.validate(r[a]))throw new Error(`Invalid argument '${o.name}' when running '${t.id}', received: ${typeof r[a]=="object"?JSON.stringify(r[a],null,"	"):r[a]} `);return o.convert(r[a])}),n=await this.executeCommand(t.internalId,...s);return t.result.convert(n,r,this.converter)},void 0,{description:t.description,args:t.args,returns:t.result.description});return this._apiCommands.set(t.id,t),new Ie(()=>{i.dispose(),this._apiCommands.delete(t.id)})}registerCommand(t,i,r,s,n,o){if(this._logService.trace("ExtHostCommands#registerCommand",i),!i.trim().length)throw new Error("invalid id");if(this._commands.has(i))throw new Error(`command '${i}' already exists`);return this._commands.set(i,{callback:r,thisArg:s,metadata:n,extension:o}),t&&this.#e.$registerCommand(i),new Ie(()=>{this._commands.delete(i)&&t&&this.#e.$unregisterCommand(i)})}executeCommand(t,...i){return this._logService.trace("ExtHostCommands#executeCommand",t),this._doExecuteCommand(t,i,!0)}async _doExecuteCommand(t,i,r){if(this._commands.has(t))return this.#e.$fireCommandActivationEvent(t),this._executeContributedCommand(t,i,!1);{let s=!1;const n=Ta(i,function(o){if(o instanceof Te)return Qe.from(o);if(o instanceof Se)return F.from(o);if(o instanceof nr)return Ai.from(o);if(zs.isNotebookRange(o))return us.from(o);if(o instanceof ArrayBuffer)return s=!0,z.wrap(new Uint8Array(o));if(o instanceof Uint8Array)return s=!0,z.wrap(o);if(o instanceof z)return s=!0,o;if(!Array.isArray(o))return o});try{const o=await this.#e.$executeCommand(t,s?new wi(n):n,r);return kt(o)}catch(o){if(o instanceof Error&&o.message==="$executeCommand:retry")return this._doExecuteCommand(t,i,!1);throw o}}}async _executeContributedCommand(t,i,r){const s=this._commands.get(t);if(!s)throw new Error("Unknown command");const{callback:n,thisArg:o,metadata:a}=s;if(a?.args)for(let c=0;c<a.args.length;c++)try{fx(i[c],a.args[c].constraint)}catch{throw new Error(`Running the contributed command: '${t}' failed. Illegal argument '${a.args[c].name}' - ${a.args[c].description}`)}const l=Hi.create();try{return await n.apply(o,i)}catch(c){if(t===this.converter.delegatingCommandId){const u=this.converter.getActualCommand(...i);u&&(t=u.command)}if(Yi(c)||this._logService.error(c,t,s.extension?.identifier),!r)throw c;if(s.extension?.identifier){const u=this.#i.onExtensionError(s.extension.identifier,c);this._logService.trace("forwarded error to extension?",u,s.extension?.identifier)}throw new class extends Error{constructor(){super(es(c)),this.id=t,this.source=s.extension?.displayName??s.extension?.name}}}finally{this._reportTelemetry(s,t,l.elapsed())}}_reportTelemetry(t,i,r){t.extension&&this.#t.$publicLog2("Extension:ActionExecuted",{extensionId:t.extension.identifier.value,id:new v_(i),duration:r})}$executeContributedCommand(t,...i){this._logService.trace("ExtHostCommands#$executeContributedCommand",t);const r=this._commands.get(t);return r?(i=i.map(s=>this._argumentProcessors.reduce((n,o)=>o.processArgument(n,r.extension),s)),this._executeContributedCommand(t,i,!0)):Promise.reject(new Error(`Contributed command '${t}' does not exist.`))}getCommands(t=!1){return this._logService.trace("ExtHostCommands#getCommands",t),this.#e.$getCommands().then(i=>(t&&(i=i.filter(r=>r[0]!=="_")),i))}$getContributedCommandMetadata(){const t=Object.create(null);for(const[i,r]of this._commands){const{metadata:s}=r;s&&(t[i]=s)}return Promise.resolve(t)}};jw=__decorate([__param(0,Pe),__param(1,ke),__param(2,Tg)],jw);var Vr=q("IExtHostCommands"),IW=class{constructor(e,t,i){this._commands=e,this._lookupApiCommand=t,this._logService=i,this.delegatingCommandId=`__vsc${mt()}`,this._cache=new Map,this._cachIdPool=0,this._commands.registerCommand(!0,this.delegatingCommandId,this._executeConvertedCommand,this)}toInternal(e,t){if(!e)return;const i={$ident:void 0,id:e.command,title:e.title,tooltip:e.tooltip};if(!e.command)return i;const r=this._lookupApiCommand(e.command);if(r)i.id=r.internalId,i.arguments=r.args.map((s,n)=>s.convert(e.arguments&&e.arguments[n]));else if(ya(e.arguments)){const s=`${e.command} /${++this._cachIdPool}`;this._cache.set(s,e),t.add(ie(()=>{this._cache.delete(s),this._logService.trace("CommandsConverter#DISPOSE",s)})),i.$ident=s,i.id=this.delegatingCommandId,i.arguments=[s],this._logService.trace("CommandsConverter#CREATE",e.command,s)}return i}fromInternal(e){return typeof e.$ident=="string"?this._cache.get(e.$ident):{command:e.id,title:e.title,arguments:e.arguments}}getActualCommand(...e){return this._cache.get(e[0])}_executeConvertedCommand(...e){const t=this.getActualCommand(...e);return this._logService.trace("CommandsConverter#EXECUTE",e[0],t?t.command:"MISSING"),t?this._commands.executeCommand(t.command,...t.arguments||[]):Promise.reject(`Actual command not found, wanted to execute ${e[0]}`)}},U=class Xi{static{this.Uri=new Xi("uri","Uri of a text document",t=>b.isUri(t),t=>t)}static{this.Position=new Xi("position","A position in a text document",t=>Te.isPosition(t),Qe.from)}static{this.Range=new Xi("range","A range in a text document",t=>Se.isRange(t),F.from)}static{this.Selection=new Xi("selection","A selection in a text document",t=>Bs.isSelection(t),Ur.from)}static{this.Number=new Xi("number","",t=>typeof t=="number",t=>t)}static{this.String=new Xi("string","",t=>typeof t=="string",t=>t)}static Arr(t){return new Xi(`${t.name}_array`,`Array of ${t.name}, ${t.description}`,i=>Array.isArray(i)&&i.every(r=>t.validate(r)),i=>i.map(r=>t.convert(r)))}static{this.CallHierarchyItem=new Xi("item","A call hierarchy item",t=>t instanceof P_,Go.from)}static{this.TypeHierarchyItem=new Xi("item","A type hierarchy item",t=>t instanceof u0,Jo.from)}static{this.TestItem=new Xi("testItem","A CodeBuddy TestItem",t=>t instanceof rd,Wn.from)}static{this.TestProfile=new Xi("testProfile","A CodeBuddy test profile",t=>t instanceof D4,ew.from)}constructor(t,i,r,s){this.name=t,this.description=i,this.validate=r,this.convert=s}optional(){return new Xi(this.name,`(optional) ${this.description}`,t=>t==null||this.validate(t),t=>t===void 0?void 0:t===null?null:this.convert(t))}with(t,i){return new Xi(t??this.name,i??this.description,this.validate,this.convert)}},ge=class y8{static{this.Void=new y8("no result",t=>t)}constructor(t,i){this.description=t,this.convert=i}},me=class{constructor(e,t,i,r,s){this.id=e,this.internalId=t,this.description=i,this.args=r,this.result=s}},Ks=q("IExtHostTerminalService"),Gw=class extends X{constructor(e,t,i,r){super(),this._proxy=e,this._id=t,this._creationOptions=i,this._name=r,this._disposed=!1,this._state={isInteractedWith:!1,shell:void 0},this.isOpen=!1,this._onWillDispose=this._register(new D),this.onWillDispose=this._onWillDispose.event,this._creationOptions=Object.freeze(this._creationOptions),this._pidPromise=new Promise(n=>this._pidPromiseComplete=n);const s=this;this.value={get name(){return s._name||""},get processId(){return s._pidPromise},get creationOptions(){return s._creationOptions},get exitStatus(){return s._exitStatus},get state(){return s._state},get selection(){return s._selection},get shellIntegration(){return s.shellIntegration},sendText(n,o=!0){s._checkDisposed(),s._proxy.$sendText(s._id,n,o)},show(n){s._checkDisposed(),s._proxy.$show(s._id,n)},hide(){s._checkDisposed(),s._proxy.$hide(s._id)},dispose(){s._disposed||(s._disposed=!0,s._proxy.$dispose(s._id))},get dimensions(){if(!(s._cols===void 0||s._rows===void 0))return{columns:s._cols,rows:s._rows}}}}dispose(){this._onWillDispose.fire(),super.dispose()}async create(e,t){if(typeof this._id!="string")throw new Error("Terminal has already been created");await this._proxy.$createTerminal(this._id,{name:e.name,shellPath:e.shellPath??void 0,shellArgs:e.shellArgs??void 0,cwd:e.cwd??t?.cwd??void 0,env:e.env??void 0,icon:V5(e.iconPath)??void 0,color:Oa.isThemeColor(e.color)?e.color.id:void 0,initialText:e.message??void 0,strictEnv:e.strictEnv??void 0,hideFromUser:e.hideFromUser??void 0,forceShellIntegration:t?.forceShellIntegration??void 0,isFeatureTerminal:t?.isFeatureTerminal??void 0,isExtensionOwnedTerminal:!0,useShellEnvironment:t?.useShellEnvironment??void 0,location:t?.location||this._serializeParentTerminal(e.location,t?.resolvedExtHostIdentifier),isTransient:e.isTransient??void 0})}async createExtensionTerminal(e,t,i,r,s){if(typeof this._id!="string")throw new Error("Terminal has already been created");if(await this._proxy.$createTerminal(this._id,{name:this._name,isExtensionCustomPtyTerminal:!0,icon:r,color:Oa.isThemeColor(s)?s.id:void 0,location:t?.location||this._serializeParentTerminal(e,i),isTransient:!0}),typeof this._id=="string")throw new Error("Terminal creation failed");return this._id}_serializeParentTerminal(e,t){return typeof e=="object"?"parentTerminal"in e&&e.parentTerminal&&t?{parentTerminal:t}:"viewColumn"in e?{viewColumn:jt.from(e.viewColumn),preserveFocus:e.preserveFocus}:void 0:e}_checkDisposed(){if(this._disposed)throw new Error("Terminal has already been disposed")}set name(e){this._name=e}setExitStatus(e,t){this._exitStatus=Object.freeze({code:e,reason:t})}setDimensions(e,t){return e===this._cols&&t===this._rows||e===0||t===0?!1:(this._cols=e,this._rows=t,!0)}setInteractedWith(){return this._state.isInteractedWith?!1:(this._state={...this._state,isInteractedWith:!0},!0)}setShellType(e){return this._state.shell!==e?(this._state={...this._state,shell:e},!0):!1}setSelection(e){this._selection=e}_setProcessId(e){this._pidPromiseComplete?(this._pidPromiseComplete(e),this._pidPromiseComplete=void 0):this._pidPromise.then(t=>{t!==e&&(this._pidPromise=Promise.resolve(e))})}},Qw=class{get onProcessReady(){return this._onProcessReady.event}constructor(e){this._pty=e,this.id=0,this.shouldPersist=!1,this._onProcessData=new D,this.onProcessData=this._onProcessData.event,this._onProcessReady=new D,this._onDidChangeProperty=new D,this.onDidChangeProperty=this._onDidChangeProperty.event,this._onProcessExit=new D,this.onProcessExit=this._onProcessExit.event}refreshProperty(e){throw new Error(`refreshProperty is not suppported in extension owned terminals. property: ${e}`)}updateProperty(e,t){throw new Error(`updateProperty is not suppported in extension owned terminals. property: ${e}, value: ${t}`)}async start(){}shutdown(){this._pty.close()}input(e){this._pty.handleInput?.(e)}resize(e,t){this._pty.setDimensions?.({columns:e,rows:t})}clearBuffer(){}async processBinary(e){}acknowledgeDataEvent(e){}async setUnicodeVersion(e){}getInitialCwd(){return Promise.resolve("")}getCwd(){return Promise.resolve("")}startSendingEvents(e){this._pty.onDidWrite(t=>this._onProcessData.fire(t)),this._pty.onDidClose?.((t=void 0)=>{this._onProcessExit.fire(t===void 0?void 0:t)}),this._pty.onDidOverrideDimensions?.(t=>{t&&this._onDidChangeProperty.fire({type:"overrideDimensions",value:{cols:t.columns,rows:t.rows}})}),this._pty.onDidChangeName?.(t=>{this._onDidChangeProperty.fire({type:"title",value:t})}),this._pty.open(e||void 0),e&&this._pty.setDimensions?.(e),this._onProcessReady.fire({pid:-1,cwd:"",windowsPty:void 0})}},PW=1,Ag=class extends X{get activeTerminal(){return this._activeTerminal?.value}get terminals(){return this._terminals.map(t=>t.value)}constructor(t,i,r){super(),this._extHostCommands=i,this._terminals=[],this._terminalProcesses=new Map,this._terminalProcessDisposables={},this._extensionTerminalAwaitingStart={},this._getTerminalPromises={},this._environmentVariableCollections=new Map,this._lastQuickFixCommands=this._register(new Kr),this._linkProviders=new Set,this._completionProviders=new Map,this._profileProviders=new Map,this._quickFixProviders=new Map,this._terminalLinkCache=new Map,this._terminalLinkCancellationSource=new Map,this._onDidCloseTerminal=new D,this.onDidCloseTerminal=this._onDidCloseTerminal.event,this._onDidOpenTerminal=new D,this.onDidOpenTerminal=this._onDidOpenTerminal.event,this._onDidChangeActiveTerminal=new D,this.onDidChangeActiveTerminal=this._onDidChangeActiveTerminal.event,this._onDidChangeTerminalDimensions=new D,this.onDidChangeTerminalDimensions=this._onDidChangeTerminalDimensions.event,this._onDidChangeTerminalState=new D,this.onDidChangeTerminalState=this._onDidChangeTerminalState.event,this._onDidChangeShell=new D,this.onDidChangeShell=this._onDidChangeShell.event,this._onDidWriteTerminalData=new D({onWillAddFirstListener:()=>this._proxy.$startSendingDataEvents(),onDidRemoveLastListener:()=>this._proxy.$stopSendingDataEvents()}),this.onDidWriteTerminalData=this._onDidWriteTerminalData.event,this._onDidExecuteCommand=new D({onWillAddFirstListener:()=>this._proxy.$startSendingCommandEvents(),onDidRemoveLastListener:()=>this._proxy.$stopSendingCommandEvents()}),this.onDidExecuteTerminalCommand=this._onDidExecuteCommand.event,this._proxy=r.getProxy(Q.MainThreadTerminalService),this._bufferer=new xW(this._proxy.$sendProcessData),this._proxy.$registerProcessSupport(t),this._extHostCommands.registerArgumentProcessor({processArgument:s=>{const n=o=>{const a=o;return this.getTerminalById(a.instanceId)?.value};switch(s?.$mid){case 15:return n(s);default:{if(Array.isArray(s))for(let o=0;o<s.length&&s[o].$mid===15;o++)s[o]=n(s[o]);return s}}}}),this._register({dispose:()=>{for(const[s,n]of this._terminalProcesses)n.shutdown(!0)}})}getDefaultShell(t){return(t?this._defaultAutomationProfile:this._defaultProfile)?.path||""}getDefaultShellArgs(t){return(t?this._defaultAutomationProfile:this._defaultProfile)?.args||[]}createExtensionTerminal(t,i){const r=new Gw(this._proxy,mt(),t,t.name),s=new Qw(t.pty);return r.createExtensionTerminal(t.location,i,this._serializeParentTerminal(t,i).resolvedExtHostIdentifier,V5(t.iconPath),AW(t.color)).then(n=>{const o=this._setupExtHostProcessListeners(n,s);this._terminalProcessDisposables[n]=o}),this._terminals.push(r),r.value}_serializeParentTerminal(t,i){if(i=i||{},t.location&&typeof t.location=="object"&&"parentTerminal"in t.location){const r=t.location.parentTerminal;if(r){const s=this._terminals.find(n=>n.value===r);s&&(i.resolvedExtHostIdentifier=s._id)}}else t.location&&typeof t.location!="object"?i.location=t.location:i.location&&typeof i.location=="object"&&"splitActiveTerminal"in i.location&&(i.location={splitActiveTerminal:!0});return i}attachPtyToTerminal(t,i){if(!this.getTerminalById(t))throw new Error(`Cannot resolve terminal with id ${t} for virtual process`);const s=new Qw(i),n=this._setupExtHostProcessListeners(t,s);this._terminalProcessDisposables[t]=n}async $acceptActiveTerminalChanged(t){const i=this._activeTerminal;if(t===null){this._activeTerminal=void 0,i!==this._activeTerminal&&this._onDidChangeActiveTerminal.fire(this._activeTerminal);return}const r=this.getTerminalById(t);r&&(this._activeTerminal=r,i!==this._activeTerminal&&this._onDidChangeActiveTerminal.fire(this._activeTerminal.value))}async $acceptTerminalProcessData(t,i){const r=this.getTerminalById(t);r&&this._onDidWriteTerminalData.fire({terminal:r.value,data:i})}async $acceptTerminalDimensions(t,i,r){const s=this.getTerminalById(t);s&&s.setDimensions(i,r)&&this._onDidChangeTerminalDimensions.fire({terminal:s.value,dimensions:s.value.dimensions})}async $acceptDidExecuteCommand(t,i){const r=this.getTerminalById(t);r&&this._onDidExecuteCommand.fire({terminal:r.value,...i})}async $acceptTerminalMaximumDimensions(t,i,r){this._terminalProcesses.get(t)?.resize(i,r)}async $acceptTerminalTitleChange(t,i){const r=this.getTerminalById(t);r&&(r.name=i)}async $acceptTerminalClosed(t,i,r){const s=this._getTerminalObjectIndexById(this._terminals,t);if(s!==null){const n=this._terminals.splice(s,1)[0];n.setExitStatus(i,r),this._onDidCloseTerminal.fire(n.value)}}$acceptTerminalOpened(t,i,r,s){if(i){const a=this._getTerminalObjectIndexById(this._terminals,i);if(a!==null){this._terminals[a]._id=t,this._onDidOpenTerminal.fire(this.terminals[a]),this._terminals[a].isOpen=!0;return}}const n={name:s.name,shellPath:s.executable,shellArgs:s.args,cwd:typeof s.cwd=="string"?s.cwd:b.revive(s.cwd),env:s.env,hideFromUser:s.hideFromUser},o=new Gw(this._proxy,t,n,r);this._terminals.push(o),this._onDidOpenTerminal.fire(o.value),o.isOpen=!0}async $acceptTerminalProcessId(t,i){this.getTerminalById(t)?._setProcessId(i)}async $startExtensionTerminal(t,i){const r=this.getTerminalById(t);if(!r)return{message:h(2938,null,t)};r.isOpen||await new Promise(n=>{const o=this.onDidOpenTerminal(async a=>{a===r.value&&(o.dispose(),n())})});const s=this._terminalProcesses.get(t);s?s.startSendingEvents(i):this._extensionTerminalAwaitingStart[t]={initialDimensions:i}}_setupExtHostProcessListeners(t,i){const r=new oe;r.add(i.onProcessReady(n=>this._proxy.$sendProcessReady(t,n.pid,n.cwd,n.windowsPty))),r.add(i.onDidChangeProperty(n=>this._proxy.$sendProcessProperty(t,n))),this._bufferer.startBuffering(t,i.onProcessData),r.add(i.onProcessExit(n=>this._onProcessExit(t,n))),this._terminalProcesses.set(t,i);const s=this._extensionTerminalAwaitingStart[t];return s&&i instanceof Qw&&(i.startSendingEvents(s.initialDimensions),delete this._extensionTerminalAwaitingStart[t]),r}$acceptProcessAckDataEvent(t,i){this._terminalProcesses.get(t)?.acknowledgeDataEvent(i)}$acceptProcessInput(t,i){this._terminalProcesses.get(t)?.input(i)}$acceptTerminalInteraction(t){const i=this.getTerminalById(t);i?.setInteractedWith()&&this._onDidChangeTerminalState.fire(i.value)}$acceptTerminalSelection(t,i){this.getTerminalById(t)?.setSelection(i)}$acceptProcessResize(t,i,r){try{this._terminalProcesses.get(t)?.resize(i,r)}catch(s){if(s.code!=="EPIPE"&&s.code!=="ERR_IPC_CHANNEL_CLOSED")throw s}}$acceptProcessShutdown(t,i){this._terminalProcesses.get(t)?.shutdown(i)}$acceptProcessRequestInitialCwd(t){this._terminalProcesses.get(t)?.getInitialCwd().then(i=>this._proxy.$sendProcessProperty(t,{type:"initialCwd",value:i}))}$acceptProcessRequestCwd(t){this._terminalProcesses.get(t)?.getCwd().then(i=>this._proxy.$sendProcessProperty(t,{type:"cwd",value:i}))}$acceptProcessRequestLatency(t){return Promise.resolve(t)}registerProfileProvider(t,i,r){if(this._profileProviders.has(i))throw new Error(`Terminal profile provider "${i}" already registered`);return this._profileProviders.set(i,r),this._proxy.$registerProfileProvider(i,t.identifier.value),new Ie(()=>{this._profileProviders.delete(i),this._proxy.$unregisterProfileProvider(i)})}registerTerminalCompletionProvider(t,i,...r){if(this._completionProviders.has(i.id))throw new Error(`Terminal completion provider "${i.id}" already registered`);return this._completionProviders.set(i.id,i),this._proxy.$registerCompletionProvider(i.id,t.identifier.value,...r),new Ie(()=>{this._completionProviders.delete(i.id),this._proxy.$unregisterCompletionProvider(i.id)})}async $provideTerminalCompletions(t,i){const r=new rt().token;if(r.isCancellationRequested||!this.activeTerminal)return;const s=this._completionProviders.get(t);if(!s)return;const n=await s.provideTerminalCompletions(this.activeTerminal,i,r);if(n!=null)return cw.from(n)}$acceptTerminalShellType(t,i){const r=this.getTerminalById(t);r?.setShellType(i)&&this._onDidChangeTerminalState.fire(r.value)}registerTerminalQuickFixProvider(t,i,r){if(this._quickFixProviders.has(t))throw new Error(`Terminal quick fix provider "${t}" is already registered`);return this._quickFixProviders.set(t,r),this._proxy.$registerQuickFixProvider(t,i),new Ie(()=>{this._quickFixProviders.delete(t),this._proxy.$unregisterQuickFixProvider(t)})}async $provideTerminalQuickFixes(t,i){const r=new rt().token;if(r.isCancellationRequested)return;const s=this._quickFixProviders.get(t);if(!s)return;const n=await s.provideTerminalQuickFixes(i,r);if(n===null||Array.isArray(n)&&n.length===0)return;const o=new oe;if(this._lastQuickFixCommands.value=o,!Array.isArray(n))return n?dg.from(n,this._extHostCommands.converter,o):void 0;const a=[];for(const l of n){const c=dg.from(l,this._extHostCommands.converter,o);c&&a.push(c)}return a}async $createContributedProfileTerminal(t,i){const r=new rt().token;let s=await this._profileProviders.get(t)?.provideTerminalProfile(r);if(!r.isCancellationRequested){if(s&&!("options"in s)&&(s={options:s}),!s||!("options"in s))throw new Error(`No terminal profile options provided for id "${t}"`);if("pty"in s.options){this.createExtensionTerminal(s.options,i);return}this.createTerminalFromOptions(s.options,i)}}registerLinkProvider(t){return this._linkProviders.add(t),this._linkProviders.size===1&&this._proxy.$startLinkProvider(),new Ie(()=>{this._linkProviders.delete(t),this._linkProviders.size===0&&this._proxy.$stopLinkProvider()})}async $provideLinks(t,i){const r=this.getTerminalById(t);if(!r)return[];this._terminalLinkCache.delete(t),this._terminalLinkCancellationSource.get(t)?.dispose(!0);const n=new rt;this._terminalLinkCancellationSource.set(t,n);const o=[],a={terminal:r.value,line:i},l=[];for(const d of this._linkProviders)l.push(yn.withAsyncBody(async f=>{n.token.onCancellationRequested(()=>f({provider:d,links:[]}));const p=await d.provideTerminalLinks(a,n.token)||[];n.token.isCancellationRequested||f({provider:d,links:p})}));const c=await Promise.all(l);if(n.token.isCancellationRequested)return[];const u=new Map;for(const d of c)d&&d.links.length>0&&o.push(...d.links.map(f=>{const p={id:PW++,startIndex:f.startIndex,length:f.length,label:f.tooltip};return u.set(p.id,{provider:d.provider,link:f}),p}));return this._terminalLinkCache.set(t,u),o}$activateLink(t,i){const r=this._terminalLinkCache.get(t)?.get(i);r&&r.provider.handleTerminalLink(r.link)}_onProcessExit(t,i){this._bufferer.stopBuffering(t),this._terminalProcesses.delete(t),delete this._extensionTerminalAwaitingStart[t];const r=this._terminalProcessDisposables[t];r&&(r.dispose(),delete this._terminalProcessDisposables[t]),this._proxy.$sendProcessExit(t,i)}getTerminalById(t){return this._getTerminalObjectById(this._terminals,t)}getTerminalIdByApiObject(t){const i=this._terminals.findIndex(r=>r.value===t);return i>=0?i:null}_getTerminalObjectById(t,i){const r=this._getTerminalObjectIndexById(t,i);return r!==null?t[r]:null}_getTerminalObjectIndexById(t,i){const r=t.findIndex(s=>s._id===i);return r>=0?r:null}getEnvironmentVariableCollection(t){let i=this._environmentVariableCollections.get(t.identifier.value);return i||(i=this._register(new B5),this._setEnvironmentVariableCollection(t.identifier.value,i)),i.getScopedEnvironmentVariableCollection(void 0)}_syncEnvironmentVariableCollection(t,i){const r=bW(i.map),s=SW(i.descriptionMap);this._proxy.$setEnvironmentVariableCollection(t,i.persistent,r.length===0?void 0:r,s)}$initEnvironmentVariableCollections(t){t.forEach(i=>{const r=i[0],s=this._register(new B5(i[1]));this._setEnvironmentVariableCollection(r,s)})}$acceptDefaultProfile(t,i){const r=this._defaultProfile;this._defaultProfile=t,this._defaultAutomationProfile=i,r?.path!==t.path&&this._onDidChangeShell.fire(t.path)}_setEnvironmentVariableCollection(t,i){this._environmentVariableCollections.set(t,i),this._register(i.onDidChangeCollection(()=>{this._syncEnvironmentVariableCollection(t,i)}))}};Ag=__decorate([__param(1,Vr),__param(2,Pe)],Ag);var B5=class extends X{get persistent(){return this._persistent}set persistent(e){this._persistent=e,this._onDidChangeCollection.fire()}get onDidChangeCollection(){return this._onDidChangeCollection&&this._onDidChangeCollection.event}constructor(e){super(),this.map=new Map,this.scopedCollections=new Map,this.descriptionMap=new Map,this._persistent=!0,this._onDidChangeCollection=new D,this.map=new Map(e)}getScopedEnvironmentVariableCollection(e){const t=this.getScopeKey(e);let i=this.scopedCollections.get(t);return i||(i=new TW(this,e),this.scopedCollections.set(t,i),this._register(i.onDidChangeCollection(()=>this._onDidChangeCollection.fire()))),i}replace(e,t,i,r){this._setIfDiffers(e,{value:t,type:Ka.Replace,options:i??{applyAtProcessCreation:!0},scope:r})}append(e,t,i,r){this._setIfDiffers(e,{value:t,type:Ka.Append,options:i??{applyAtProcessCreation:!0},scope:r})}prepend(e,t,i,r){this._setIfDiffers(e,{value:t,type:Ka.Prepend,options:i??{applyAtProcessCreation:!0},scope:r})}_setIfDiffers(e,t){if(t.options&&t.options.applyAtProcessCreation===!1&&!t.options.applyAtShellIntegration)throw new Error("EnvironmentVariableMutatorOptions must apply at either process creation or shell integration");const i=this.getKey(e,t.scope),r=this.map.get(i),s=t.options?{applyAtProcessCreation:t.options.applyAtProcessCreation??!1,applyAtShellIntegration:t.options.applyAtShellIntegration??!1}:{applyAtProcessCreation:!0};if(!r||r.value!==t.value||r.type!==t.type||r.options?.applyAtProcessCreation!==s.applyAtProcessCreation||r.options?.applyAtShellIntegration!==s.applyAtShellIntegration||r.scope?.workspaceFolder?.index!==t.scope?.workspaceFolder?.index){const n=this.getKey(e,t.scope),o={variable:e,...t,options:s};this.map.set(n,o),this._onDidChangeCollection.fire()}}get(e,t){const i=this.getKey(e,t),r=this.map.get(i);return r?z5(r):void 0}getKey(e,t){const i=this.getScopeKey(t);return i.length?`${e}:::${i}`:e}getScopeKey(e){return this.getWorkspaceKey(e?.workspaceFolder)??""}getWorkspaceKey(e){return e?e.uri.toString():void 0}getVariableMap(e){const t=new Map;for(const[i,r]of this.map)this.getScopeKey(r.scope)===this.getScopeKey(e)&&t.set(r.variable,z5(r));return t}delete(e,t){const i=this.getKey(e,t);this.map.delete(i),this._onDidChangeCollection.fire()}clear(e){if(e?.workspaceFolder){for(const[t,i]of this.map)i.scope?.workspaceFolder?.index===e.workspaceFolder.index&&this.map.delete(t);this.clearDescription(e)}else this.map.clear(),this.descriptionMap.clear();this._onDidChangeCollection.fire()}setDescription(e,t){const i=this.getScopeKey(t),r=this.descriptionMap.get(i);if(!r||r.description!==e){let s;typeof e=="string"?s=e:s=e?.value.split(`

`)[0];const n={description:s,scope:t};this.descriptionMap.set(i,n),this._onDidChangeCollection.fire()}}getDescription(e){const t=this.getScopeKey(e);return this.descriptionMap.get(t)?.description}clearDescription(e){const t=this.getScopeKey(e);this.descriptionMap.delete(t)}},TW=class{get persistent(){return this.collection.persistent}set persistent(e){this.collection.persistent=e}get onDidChangeCollection(){return this._onDidChangeCollection&&this._onDidChangeCollection.event}constructor(e,t){this.collection=e,this.scope=t,this._onDidChangeCollection=new D}getScoped(e){return this.collection.getScopedEnvironmentVariableCollection(e)}replace(e,t,i){this.collection.replace(e,t,i,this.scope)}append(e,t,i){this.collection.append(e,t,i,this.scope)}prepend(e,t,i){this.collection.prepend(e,t,i,this.scope)}get(e){return this.collection.get(e,this.scope)}forEach(e,t){this.collection.getVariableMap(this.scope).forEach((i,r)=>e.call(t,r,i,this),this.scope)}[Symbol.iterator](){return this.collection.getVariableMap(this.scope).entries()}delete(e){this.collection.delete(e,this.scope),this._onDidChangeCollection.fire(void 0)}clear(){this.collection.clear(this.scope)}set description(e){this.collection.setDescription(e,this.scope)}get description(){return this.collection.getDescription(this.scope)}},Jw=class extends Ag{constructor(t,i){super(!1,t,i)}createTerminal(t,i,r){throw new hv}createTerminalFromOptions(t,i){throw new hv}};Jw=__decorate([__param(0,Vr),__param(1,Pe)],Jw);function V5(e){if(!(!e||typeof e=="string"))return"id"in e?{id:e.id,color:e.color}:e}function AW(e){return Oa.isThemeColor(e)?e:void 0}function z5(e){const t={...e};return delete t.scope,t.options=t.options??void 0,delete t.variable,t}var RW=q("progressService"),q5;(function(e){e[e.Explorer=1]="Explorer",e[e.Scm=3]="Scm",e[e.Extensions=5]="Extensions",e[e.Window=10]="Window",e[e.Notification=15]="Notification",e[e.Dialog=20]="Dialog"})(q5||(q5={}));var ate=Object.freeze({total(){},worked(){},done(){}}),Rg=class{static{this.None=Object.freeze({report(){}})}get value(){return this._value}constructor(e){this.callback=e}report(e){this._value=e,this.callback(this._value)}},j5=class extends X{constructor(t,i){super(),this.deferred=new hr,i.withProgress(t,r=>(this.reporter=r,this.lastStep&&r.report(this.lastStep),this.deferred.p)),this._register(ie(()=>this.deferred.complete()))}report(t){this.reporter?this.reporter.report(t):this.lastStep=t}};j5=__decorate([__param(1,RW)],j5);var cte=q("editorProgressService"),G5="__",ute=q("IAuthenticationService"),dte=q("IAuthenticationExtensionsService"),Kw=q("IExtHostAuthentication"),Xw=class{constructor(t){this._authenticationProviders=new Map,this._onDidChangeSessions=new D,this._getSessionTaskSingler=new LW,this._proxy=t.getProxy(Q.MainThreadAuthentication)}getExtensionScopedSessionsEvent(t){const i=t.toLowerCase();return Fe.chain(this._onDidChangeSessions.event,r=>r.filter(s=>!s.extensionIdFilter||s.extensionIdFilter.includes(i)).map(s=>({provider:s.provider})))}async getSession(t,i,r,s={}){const n=qe.toKey(t.identifier),o=[...r].sort().join(" "),l=Object.keys(s).sort().map(c=>`${c}:${!!s[c]}`).join(", ");return await this._getSessionTaskSingler.getOrCreate(`${n} ${i} ${o} ${l}`,async()=>{await this._proxy.$ensureProvider(i);const c=t.displayName||t.name;return this._proxy.$getSession(i,r,n,c,s)})}async getAccounts(t){return await this._proxy.$ensureProvider(t),await this._proxy.$getAccounts(t)}async removeSession(t,i){const r=this._authenticationProviders.get(t);return r?r.provider.removeSession(i):this._proxy.$removeSession(t,i)}registerAuthenticationProvider(t,i,r,s){if(this._authenticationProviders.get(t))throw new Error(`An authentication provider with id '${t}' is already registered.`);this._authenticationProviders.set(t,{label:i,provider:r,options:s??{supportsMultipleAccounts:!1}});const n=r.onDidChangeSessions(o=>this._proxy.$sendDidChangeSessions(t,o));return this._proxy.$registerAuthenticationProvider(t,i,s?.supportsMultipleAccounts??!1),new Ie(()=>{n.dispose(),this._authenticationProviders.delete(t),this._proxy.$unregisterAuthenticationProvider(t)})}async $createSession(t,i,r){const s=this._authenticationProviders.get(t);if(s)return await s.provider.createSession(i,r);throw new Error(`Unable to find authentication provider with handle: ${t}`)}async $removeSession(t,i){const r=this._authenticationProviders.get(t);if(r)return await r.provider.removeSession(i);throw new Error(`Unable to find authentication provider with handle: ${t}`)}async $getSessions(t,i,r){const s=this._authenticationProviders.get(t);if(s)return await s.provider.getSessions(i,r);throw new Error(`Unable to find authentication provider with handle: ${t}`)}$onDidChangeAuthenticationSessions(t,i,r){return t.startsWith(G5)||this._onDidChangeSessions.fire({provider:{id:t,label:i},extensionIdFilter:r}),Promise.resolve()}};Xw=__decorate([__param(0,Pe)],Xw);var LW=class{constructor(){this._inFlightPromises=new Map}getOrCreate(e,t){const i=this._inFlightPromises.get(e);if(i)return i;const r=t().finally(()=>this._inFlightPromises.delete(e));return this._inFlightPromises.set(e,r),r}},NW={label:h(5609,null),order:Number.MAX_SAFE_INTEGER},Lg,Yw=q("IExtHostLanguageModels"),Q5=class{constructor(e,t){this.option=e,this.stream=new Hv,this.stream=t??new Hv}},MW=class{constructor(){this._responseStreams=new Map,this._defaultStream=new Hv,this._isDone=!1;const e=this;this.apiObject={get stream(){return e._defaultStream.asyncIterable},get text(){return Sc.map(e._defaultStream.asyncIterable,t=>{if(t instanceof Tt)return t.value}).coalesce()}}}*_streams(){if(this._responseStreams.size>0)for(const[,e]of this._responseStreams)yield e.stream;else yield this._defaultStream}handleFragment(e){if(this._isDone)return;let t=this._responseStreams.get(e.index);t||(this._responseStreams.size===0?t=new Q5(e.index,this._defaultStream):t=new Q5(e.index),this._responseStreams.set(e.index,t));let i;e.part.type==="text"?i=new Tt(e.part.value):e.part.type==="data"?i=new Tt(""):i=new qo(e.part.toolCallId,e.part.name,e.part.parameters),t.stream.emitOne(i)}reject(e){this._isDone=!0;for(const t of this._streams())t.reject(e)}resolve(){this._isDone=!0;for(const e of this._streams())e.resolve()}},Zw=class{static{Lg=this}static{this._idPool=1}constructor(t,i,r){this._logService=i,this._extHostAuthentication=r,this._onDidChangeModelAccess=new D,this._onDidChangeProviders=new D,this.onDidChangeProviders=this._onDidChangeProviders.event,this._languageModels=new Map,this._allLanguageModelData=new Map,this._modelAccessList=new As,this._pendingRequest=new Map,this._ignoredFileProviders=new Map,this._languageAccessInformationExtensions=new Set,this._proxy=t.getProxy(Q.MainThreadLanguageModels)}dispose(){this._onDidChangeModelAccess.dispose(),this._onDidChangeProviders.dispose()}registerLanguageModel(t,i,r,s){const n=Lg._idPool++;this._languageModels.set(n,{extension:t.identifier,provider:r,languageModelId:i});let o;s.auth&&(o={providerLabel:t.displayName||t.name,accountLabel:typeof s.auth=="object"?s.auth.label:void 0}),this._proxy.$registerLanguageModelProvider(n,`${qe.toKey(t.identifier)}/${i}`,{extension:t.identifier,id:i,vendor:s.vendor??qe.toKey(t.identifier),name:s.name??"",family:s.family??"",cost:s.cost,description:s.description,version:s.version,maxInputTokens:s.maxInputTokens,maxOutputTokens:s.maxOutputTokens,auth:o,targetExtensions:s.extensions,isDefault:s.isDefault,isUserSelectable:s.isUserSelectable,modelPickerCategory:s.category??NW,capabilities:s.capabilities});const a=r.onDidReceiveLanguageModelResponse2?.(({extensionId:l,participant:c,tokenCount:u})=>{this._proxy.$whenLanguageModelChatRequestMade(i,new qe(l),c,u)});return ie(()=>{this._languageModels.delete(n),this._proxy.$unregisterProvider(n),a?.dispose()})}async $startChatRequest(t,i,r,s,n,o){const a=this._languageModels.get(t);if(!a)throw new Error("Provider not found");const l=new Rg(async u=>{if(o.isCancellationRequested){this._logService.warn(`[CHAT](${a.extension.value}) CANNOT send progress because the REQUEST IS CANCELLED`);return}let d;if(u.part instanceof qo?d={type:"tool_use",name:u.part.name,parameters:u.part.input,toolCallId:u.part.callId}:u.part instanceof Tt?d={type:"text",value:u.part.value}:u.part instanceof Fn&&(d={type:"data",value:{mimeType:u.part.mimeType,data:z.wrap(u.part.data)}}),!d){this._logService.warn(`[CHAT](${a.extension.value}) UNKNOWN part ${JSON.stringify(u)}`);return}this._proxy.$reportResponsePart(i,{index:u.index,part:d})});let c;try{c=a.provider.provideLanguageModelResponse(s.value.map(Vu.to),n,qe.toKey(r),l,o)}catch(u){throw u}Promise.resolve(c).then(()=>{this._proxy.$reportResponseDone(i,void 0)},u=>{this._proxy.$reportResponseDone(i,wa(u))})}$provideTokenLength(t,i,r){const s=this._languageModels.get(t);return s?Promise.resolve(s.provider.provideTokenCount(i,r)):Promise.resolve(0)}$acceptChatModelMetadata(t){if(t.added)for(const{identifier:i,metadata:r}of t.added)this._allLanguageModelData.set(i,{metadata:r,apiObjects:new As});if(t.removed)for(const i of t.removed){this._allLanguageModelData.delete(i);for(const[r,s]of this._pendingRequest)s.languageModelId===i&&(s.res.reject(new oi),this._pendingRequest.delete(r))}t.added?.forEach(i=>this._fakeAuthPopulate(i.metadata)),this._onDidChangeProviders.fire(void 0)}async getDefaultLanguageModel(t){const i=ai.find(this._allLanguageModelData.entries(),([,r])=>!!r.metadata.isDefault)?.[0];if(i)return this.getLanguageModelByIdentifier(t,i)}async getLanguageModelByIdentifier(t,i){const r=this._allLanguageModelData.get(i);if(!r)return;this._isUsingAuth(t.identifier,r.metadata)&&await this._fakeAuthPopulate(r.metadata);let s=r.apiObjects.get(t.identifier);if(!s){const n=this;s={id:r.metadata.id,vendor:r.metadata.vendor,family:r.metadata.family,version:r.metadata.version,name:r.metadata.name,capabilities:{supportsImageToText:r.metadata.capabilities?.vision??!1,supportsToolCalling:r.metadata.capabilities?.toolCalling??!1},maxInputTokens:r.metadata.maxInputTokens,countTokens(o,a){if(!n._allLanguageModelData.has(i))throw qs.NotFound(i);return n._computeTokenLength(i,o,a??Be.None)},sendRequest(o,a,l){if(!n._allLanguageModelData.has(i))throw qs.NotFound(i);return n._sendChatRequest(t,i,o,a??{},l??Be.None)}},Object.freeze(s),r.apiObjects.set(t.identifier,s)}return s}async selectLanguageModels(t,i){const r=await this._proxy.$selectChatModels({...i,extension:t.identifier}),s=[];for(const n of r){const o=await this.getLanguageModelByIdentifier(t,n);o&&s.push(o)}return s}async _sendChatRequest(t,i,r,s,n){const o=this._convertMessages(t,r),a=t.identifier,l=this._allLanguageModelData.get(i)?.metadata;if(!l||!this._allLanguageModelData.has(i))throw qs.NotFound(`Language model '${i}' is unknown.`);if(this._isUsingAuth(a,l)&&(!await this._getAuthAccess(t,{identifier:l.extension,displayName:l.auth.providerLabel},s.justification,!1)||!this._modelAccessList.get(a)?.has(l.extension)))throw qs.NoPermissions(`Language model '${i}' cannot be used by '${a.value}'.`);const c=Math.random()*1e6|0,u=new MW;this._pendingRequest.set(c,{languageModelId:i,res:u});try{await this._proxy.$tryStartChatRequest(a,i,c,new wi(o),s,n)}catch(d){throw this._pendingRequest.delete(c),qs.tryDeserialize(d)??d}return u.apiObject}_convertMessages(t,i){const r=[];for(const s of i)s.role===Gi.System&&M(t,"languageModelSystem"),r.push(Vu.from(s));return r}async $acceptResponsePart(t,i){const r=this._pendingRequest.get(t);r&&r.res.handleFragment(i)}async $acceptResponseDone(t,i){const r=this._pendingRequest.get(t);r&&(this._pendingRequest.delete(t),i?r.res.reject(qs.tryDeserialize(i)??YS(i)):r.res.resolve())}async _getAuthAccess(t,i,r,s){const n=G5+i.identifier.value;if(await this._extHostAuthentication.getSession(t,n,[],{silent:!0}))return this.$updateModelAccesslist([{from:t.identifier,to:i.identifier,enabled:!0}]),!0;if(s)return!1;try{const a=r?h(2929,null,i.displayName,r):void 0;return await this._extHostAuthentication.getSession(t,n,[],{forceNewSession:{detail:a}}),this.$updateModelAccesslist([{from:t.identifier,to:i.identifier,enabled:!0}]),!0}catch{return!1}}_isUsingAuth(t,i){return!!i.auth&&!qe.equals(i.extension,t)}async _fakeAuthPopulate(t){if(t.auth)for(const i of this._languageAccessInformationExtensions)try{await this._getAuthAccess(i,{identifier:t.extension,displayName:""},void 0,!0)}catch(r){this._logService.error("Fake Auth request failed"),this._logService.error(r)}}async _computeTokenLength(t,i,r){if(!this._allLanguageModelData.get(t))throw qs.NotFound(`Language model '${t}' is unknown.`);const n=ai.find(this._languageModels.values(),o=>o.languageModelId===t);return n?n.provider.provideTokenCount(i,r):this._proxy.$countTokens(t,typeof i=="string"?i:Vu.from(i),r)}$updateModelAccesslist(t){const i=new Array;for(const{from:r,to:s,enabled:n}of t){const o=this._modelAccessList.get(r)??new mo;if(o.has(s)!==n){n?o.add(s):o.delete(s),this._modelAccessList.set(r,o);const l={from:r,to:s};i.push(l),this._onDidChangeModelAccess.fire(l)}}}createLanguageModelAccessInformation(t){this._languageAccessInformationExtensions.add(t);const i=this,r=Fe.signal(Fe.filter(this._onDidChangeModelAccess.event,n=>qe.equals(n.from,t.identifier))),s=Fe.signal(this._onDidChangeProviders.event);return{get onDidChange(){return Fe.any(r,s)},canSendRequest(n){let o;e:for(const[l,c]of i._allLanguageModelData)for(const u of c.apiObjects.values())if(u===n){o=c.metadata;break e}if(!o)return;if(!i._isUsingAuth(t.identifier,o))return!0;const a=i._modelAccessList.get(t.identifier);if(a)return a.has(o.extension)}}}fileIsIgnored(t,i,r=Be.None){return M(t,"chatParticipantAdditions"),this._proxy.$fileIsIgnored(i,r)}async $isFileIgnored(t,i,r){const s=this._ignoredFileProviders.get(t);if(!s)throw new Error("Unknown LanguageModelIgnoredFileProvider");return await s.provideFileIgnored(b.revive(i),r)??!1}registerIgnoredFileProvider(t,i){M(t,"chatParticipantPrivate");const r=Lg._idPool++;return this._proxy.$registerFileIgnoreProvider(r),this._ignoredFileProviders.set(r,i),ie(()=>{this._proxy.$unregisterFileIgnoreProvider(r),this._ignoredFileProviders.delete(r)})}};Zw=Lg=__decorate([__param(0,Pe),__param(1,ke),__param(2,Kw)],Zw);function nd(e,t=Ve){return Rv(e,t)?e.charAt(0).toUpperCase()+e.slice(1):e}function ey(e,t){return e.replace(/^~($|\/|\\)/,`${t}$1`)}var J5;(function(e){e[e.TEXT=0]="TEXT",e[e.VARIABLE=1]="VARIABLE",e[e.SEPARATOR=2]="SEPARATOR"})(J5||(J5={}));var OW=60,FW=OW*60,ty=FW*24,pte=ty*7,gte=ty*30,mte=ty*365;function $W(e){return e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0")+"T"+String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0")+":"+String(e.getSeconds()).padStart(2,"0")+"."+(e.getMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}var HW={DateTimeFormat(e,t){try{return new Intl.DateTimeFormat(e,t)}catch{return new Intl.DateTimeFormat(void 0,t)}},Collator(e,t){try{return new Intl.Collator(e,t)}catch{return new Intl.Collator(void 0,t)}},Segmenter(e,t){try{return new Intl.Segmenter(e,t)}catch{return new Intl.Segmenter(void 0,t)}},Locale(e,t){try{return new Intl.Locale(e,t)}catch{return new Intl.Locale(fn,t)}}},K5;(function(e){e[e.MAX_SAFE_SMALL_INTEGER=1073741824]="MAX_SAFE_SMALL_INTEGER",e[e.MIN_SAFE_SMALL_INTEGER=-1073741824]="MIN_SAFE_SMALL_INTEGER",e[e.MAX_UINT_8=255]="MAX_UINT_8",e[e.MAX_UINT_16=65535]="MAX_UINT_16",e[e.MAX_UINT_32=4294967295]="MAX_UINT_32",e[e.UNICODE_SUPPLEMENTARY_PLANE_BEGIN=65536]="UNICODE_SUPPLEMENTARY_PLANE_BEGIN"})(K5||(K5={}));function X5(e){return e<0?0:e>255?255:e|0}function Ul(e){return e<0?0:e>4294967295?4294967295:e|0}var Y5=class b8{constructor(t){const i=X5(t);this._defaultValue=i,this._asciiMap=b8._createAsciiMap(i),this._map=new Map}static _createAsciiMap(t){const i=new Uint8Array(256);return i.fill(t),i}set(t,i){const r=X5(i);t>=0&&t<256?this._asciiMap[t]=r:this._map.set(t,r)}get(t){return t>=0&&t<256?this._asciiMap[t]:this._map.get(t)||this._defaultValue}clear(){this._asciiMap.fill(this._defaultValue),this._map.clear()}},Z5;(function(e){e[e.False=0]="False",e[e.True=1]="True"})(Z5||(Z5={}));var eT;(function(e){e[e.Regular=0]="Regular",e[e.Whitespace=1]="Whitespace",e[e.WordSeparator=2]="WordSeparator"})(eT||(eT={}));var UW=class extends Y5{constructor(e,t){super(0),this._segmenter=null,this._cachedLine=null,this._cachedSegments=[],this.intlSegmenterLocales=t,this.intlSegmenterLocales.length>0?this._segmenter=HW.Segmenter(this.intlSegmenterLocales,{granularity:"word"}):this._segmenter=null;for(let i=0,r=e.length;i<r;i++)this.set(e.charCodeAt(i),2);this.set(32,1),this.set(9,1)}findPrevIntlWordBeforeOrAtOffset(e,t){let i=null;for(const r of this._getIntlSegmenterWordsOnLine(e)){if(r.index>t)break;i=r}return i}findNextIntlWordAtOrAfterOffset(e,t){for(const i of this._getIntlSegmenterWordsOnLine(e))if(!(i.index<t))return i;return null}_getIntlSegmenterWordsOnLine(e){return this._segmenter?this._cachedLine===e?this._cachedSegments:(this._cachedLine=e,this._cachedSegments=this._filterWordSegments(this._segmenter.segment(e)),this._cachedSegments):[]}_filterWordSegments(e){const t=[];for(const i of e)this._isWordLike(i)&&t.push(i);return t}_isWordLike(e){return!!e.isWordLike}},tT=new uc(10);function WW(e,t){const i=`${e}/${t.join(",")}`;let r=tT.get(i);return r||(r=new UW(e,t),tT.set(i,r)),r}var iy;(function(e){e[e.Left=1]="Left",e[e.Center=2]="Center",e[e.Right=4]="Right",e[e.Full=7]="Full"})(iy||(iy={}));var iT;(function(e){e[e.Left=1]="Left",e[e.Center=2]="Center",e[e.Right=3]="Right"})(iT||(iT={}));var rT;(function(e){e[e.Inline=1]="Inline",e[e.Gutter=2]="Gutter"})(rT||(rT={}));var sT;(function(e){e[e.Normal=1]="Normal",e[e.Underlined=2]="Underlined"})(sT||(sT={}));var nT;(function(e){e[e.Both=0]="Both",e[e.Right=1]="Right",e[e.Left=2]="Left",e[e.None=3]="None"})(nT||(nT={}));var oT;(function(e){e[e.TextDefined=0]="TextDefined",e[e.LF=1]="LF",e[e.CRLF=2]="CRLF"})(oT||(oT={}));var aT;(function(e){e[e.LF=1]="LF",e[e.CRLF=2]="CRLF"})(aT||(aT={}));var lT;(function(e){e[e.LF=0]="LF",e[e.CRLF=1]="CRLF"})(lT||(lT={}));var ry=class{constructor(e,t){this._findMatchBrand=void 0,this.range=e,this.matches=t}},cT;(function(e){e[e.AlwaysGrowsWhenTypingAtEdges=0]="AlwaysGrowsWhenTypingAtEdges",e[e.NeverGrowsWhenTypingAtEdges=1]="NeverGrowsWhenTypingAtEdges",e[e.GrowsOnlyWhenTypingBefore=2]="GrowsOnlyWhenTypingBefore",e[e.GrowsOnlyWhenTypingAfter=3]="GrowsOnlyWhenTypingAfter"})(cT||(cT={}));var uT;(function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.None=2]="None",e[e.LeftOfInjectedText=3]="LeftOfInjectedText",e[e.RightOfInjectedText=4]="RightOfInjectedText"})(uT||(uT={}));var dT;(function(e){e[e.FIRST_LINE_DETECTION_LENGTH_LIMIT=1e3]="FIRST_LINE_DETECTION_LENGTH_LIMIT"})(dT||(dT={}));var BW=class{constructor(e,t,i){this.regex=e,this.wordSeparators=t,this.simpleSearch=i}},VW=class{constructor(e,t,i){this.reverseEdits=e,this.changes=t,this.trimAutoWhitespaceLineNumbers=i}},hT=class{constructor(e,t,i,r){this.searchString=e,this.isRegex=t,this.matchCase=i,this.wordSeparators=r}parseSearchRequest(){if(this.searchString==="")return null;let e;this.isRegex?e=fT(this.searchString):e=this.searchString.indexOf(`
`)>=0;let t=null;try{t=Hx(this.searchString,this.isRegex,{matchCase:this.matchCase,wholeWord:!1,multiline:e,global:!0,unicode:!0})}catch{return null}if(!t)return null;let i=!this.isRegex&&!e;return i&&this.searchString.toLowerCase()!==this.searchString.toUpperCase()&&(i=this.matchCase),new BW(t,this.wordSeparators?WW(this.wordSeparators,[]):null,i?this.searchString:null)}};function fT(e){if(!e||e.length===0)return!1;for(let t=0,i=e.length;t<i;t++){const r=e.charCodeAt(t);if(r===10)return!0;if(r===92){if(t++,t>=i)break;const s=e.charCodeAt(t);if(s===110||s===114||s===87)return!0}}return!1}function pT(e,t,i){if(!i)return new ry(e,null);const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s];return new ry(e,r)}function zW(e,t,i,r,s){if(r===0)return!0;const n=t.charCodeAt(r-1);if(e.get(n)!==0||n===13||n===10)return!0;if(s>0){const o=t.charCodeAt(r);if(e.get(o)!==0)return!0}return!1}function qW(e,t,i,r,s){if(r+s===i)return!0;const n=t.charCodeAt(r+s);if(e.get(n)!==0||n===13||n===10)return!0;if(s>0){const o=t.charCodeAt(r+s-1);if(e.get(o)!==0)return!0}return!1}function gT(e,t,i,r,s){return zW(e,t,i,r,s)&&qW(e,t,i,r,s)}var jW=class{constructor(e,t){this._wordSeparators=e,this._searchRegex=t,this._prevMatchStartIndex=-1,this._prevMatchLength=0}reset(e){this._searchRegex.lastIndex=e,this._prevMatchStartIndex=-1,this._prevMatchLength=0}next(e){const t=e.length;let i;do{if(this._prevMatchStartIndex+this._prevMatchLength===t||(i=this._searchRegex.exec(e),!i))return null;const r=i.index,s=i[0].length;if(r===this._prevMatchStartIndex&&s===this._prevMatchLength){if(s===0){zx(e,t,this._searchRegex.lastIndex)>65535?this._searchRegex.lastIndex+=2:this._searchRegex.lastIndex+=1;continue}return null}if(this._prevMatchStartIndex=r,this._prevMatchLength=s,!this._wordSeparators||gT(this._wordSeparators,e,t,r,s))return i}while(i);return null}};function mT(e){return e.scheme!==V.file&&e.scheme!==V.vscodeRemote}function GW(e){if(e.folders.length)return e.folders.every(t=>mT(t.uri))?e.folders[0].uri:void 0;if(e.configuration&&mT(e.configuration))return e.configuration}function QW(e){return GW(e)?.scheme}var vT=a_,_T=q("remoteAgentService"),vte=new class{constructor(){this.maxSampleCount=5,this.sampleDelay=2e3,this.initial=[],this.maxInitialCount=3,this.average=[],this.maxAverageCount=100,this.highLatencyMultiple=2,this.highLatencyMinThreshold=500,this.highLatencyMaxThreshold=1500,this.lastMeasurement=void 0}get latency(){return this.lastMeasurement}async measure(e){let t=1/0;for(let r=0;r<this.maxSampleCount;r++){const s=await e.getRoundTripTime();if(s===void 0)return;t=Math.min(t,s/2),await ui(this.sampleDelay)}this.average.push(t),this.average.length>this.maxAverageCount&&this.average.shift();let i;return this.initial.length<this.maxInitialCount?this.initial.push(t):i=this.initial.reduce((r,s)=>r+s,0)/this.initial.length,this.lastMeasurement={initial:i,current:t,average:this.average.reduce((r,s)=>r+s,0)/this.average.length,high:typeof i>"u"?!1:t>this.highLatencyMaxThreshold||t>this.highLatencyMinThreshold&&t>i*this.highLatencyMultiple},this.lastMeasurement}},sy,JW=q("pathService"),wT=sy=class{constructor(t,i,r,s){this.localUserHome=t,this.remoteAgentService=i,this.environmentService=r,this.contextService=s,this.resolveOS=(async()=>(await this.remoteAgentService.getEnvironment())?.os||io)(),this.resolveUserHome=(async()=>{const n=await this.remoteAgentService.getEnvironment();return this.maybeUnresolvedUserHome=n?.userHome??t})()}hasValidBasename(t,i,r){return typeof i=="string"||typeof i>"u"?this.resolveOS.then(s=>this.doHasValidBasename(t,s,i)):this.doHasValidBasename(t,i,r)}doHasValidBasename(t,i,r){return t.scheme===V.file||t.scheme===V.vscodeRemote?m3(r??ir(t),i===1):!0}get defaultUriScheme(){return sy.findDefaultUriScheme(this.environmentService,this.contextService)}static findDefaultUriScheme(t,i){if(t.remoteAuthority)return V.vscodeRemote;const r=QW(i.getWorkspace());if(r)return r;const s=i.getWorkspace().folders[0];if(s)return s.uri.scheme;const n=i.getWorkspace().configuration;return n?n.scheme:V.file}userHome(t){return t?.preferLocal?this.localUserHome:this.resolveUserHome}get resolvedUserHome(){return this.maybeUnresolvedUserHome}get path(){return this.resolveOS.then(t=>t===1?Ht:$e)}async fileURI(t){let i="";if(await this.resolveOS===1&&(t=t.replace(/\\/g,"/")),t[0]==="/"&&t[1]==="/"){const s=t.indexOf("/",2);s===-1?(i=t.substring(2),t="/"):(i=t.substring(2,s),t=t.substring(s)||"/")}return b.from({scheme:V.file,authority:i,path:t,query:"",fragment:""})}};wT=sy=__decorate([__param(1,_T),__param(2,vT),__param(3,Uh)],wT);function KW(e){return typeof e=="object"&&"uri"in e&&"pattern"in e}var yT=class{constructor(t,i,r,s,n,o){this.configurationService=t,this.workspaceContextService=i,this.editorGroupsService=r,this.logService=s,this.pathService=n,this.uriIdentityService=o}aiText(t,i,r={}){return{...this.commonQuery(i?.map(w1),r),type:3,contentPattern:t}}text(t,i,r={}){t=this.getContentPattern(t,r);const s=this.configurationService.getValue(),n=i&&i.some(a=>!this.configurationService.getValue({resource:a}).search.useRipgrep);return{...this.commonQuery(i?.map(w1),r),type:2,contentPattern:t,previewOptions:r.previewOptions,maxFileSize:r.maxFileSize,usePCRE2:s.search.usePCRE2||n||!1,surroundingContext:r.surroundingContext,userDisabledExcludesAndIgnoreFiles:r.disregardExcludeSettings&&r.disregardIgnoreFiles}}getContentPattern(t,i){const r=this.configurationService.getValue();t.isRegExp&&(t.pattern=t.pattern.replace(/\r?\n/g,"\\n"));const s={...t,wordSeparators:r.editor.wordSeparators};return this.isCaseSensitive(t,i)&&(s.isCaseSensitive=!0),this.isMultiline(t)&&(s.isMultiline=!0),i.notebookSearchConfig?.includeMarkupInput&&(s.notebookInfo||(s.notebookInfo={}),s.notebookInfo.isInNotebookMarkdownInput=i.notebookSearchConfig.includeMarkupInput),i.notebookSearchConfig?.includeMarkupPreview&&(s.notebookInfo||(s.notebookInfo={}),s.notebookInfo.isInNotebookMarkdownPreview=i.notebookSearchConfig.includeMarkupPreview),i.notebookSearchConfig?.includeCodeInput&&(s.notebookInfo||(s.notebookInfo={}),s.notebookInfo.isInNotebookCellInput=i.notebookSearchConfig.includeCodeInput),i.notebookSearchConfig?.includeOutput&&(s.notebookInfo||(s.notebookInfo={}),s.notebookInfo.isInNotebookCellOutput=i.notebookSearchConfig.includeOutput),s}file(t,i={}){return{...this.commonQuery(t,i),type:1,filePattern:i.filePattern?i.filePattern.trim():i.filePattern,exists:i.exists,sortByScore:i.sortByScore,cacheKey:i.cacheKey,shouldGlobMatchFilePattern:i.shouldGlobSearch}}handleIncludeExclude(t,i){if(!t)return{};if(Array.isArray(t)){if(t=t.filter(r=>r.length>0).map(Ng),!t.length)return{}}else t=Ng(t);return i?this.parseSearchPaths(t):{pattern:ny(...Array.isArray(t)?t:[t])}}commonQuery(t=[],i={}){let r=Array.isArray(i.excludePattern)?i.excludePattern.map(u=>u.pattern).flat():i.excludePattern;r=r?.length===1?r[0]:r;const s=this.handleIncludeExclude(i.includePattern,i.expandPatterns),n=this.handleIncludeExclude(r,i.expandPatterns),o=t.length>1,a=(s.searchPaths&&s.searchPaths.length?s.searchPaths.map(u=>this.getFolderQueryForSearchPath(u,i,n)):t.map(u=>this.getFolderQueryForRoot(u,i,n,o))).filter(u=>!!u),l={_reason:i._reason,folderQueries:a,usingSearchPaths:!!(s.searchPaths&&s.searchPaths.length),extraFileResources:i.extraFileResources,excludePattern:n.pattern,includePattern:s.pattern,onlyOpenEditors:i.onlyOpenEditors,maxResults:i.maxResults,onlyFileScheme:i.onlyFileScheme};if(i.onlyOpenEditors){const u=Et(this.editorGroupsService.groups.flatMap(p=>p.editors.map(g=>g.resource)));this.logService.trace("QueryBuilder#commonQuery - openEditor URIs",JSON.stringify(u));const d=u.filter(p=>d5(l,p.fsPath)),f=this.commonQueryFromFileList(d);return this.logService.trace("QueryBuilder#commonQuery - openEditor Query",JSON.stringify(f)),{...l,...f}}const c=i.extraFileResources&&i.extraFileResources.filter(u=>d5(l,u.fsPath));return l.extraFileResources=c&&c.length?c:void 0,l}commonQueryFromFileList(t){const i=[],r=new Vt,s={};let n=!1;return t.forEach(o=>{if(o.scheme===V.walkThrough)return;if(F3(o)){const l=this.workspaceContextService.getWorkspaceFolder(o)?.uri??this.uriIdentityService.extUri.dirname(o);let c=r.get(l);c||(n=!0,c={folder:l,includePattern:{}},i.push(c),r.set(l,c));const u=Da(l.fsPath,o.fsPath);Sa(c.includePattern)[u.replace(/\\/g,"/")]=!0}else o.fsPath&&(n=!0,s[o.fsPath]=!0)}),{folderQueries:i,includePattern:s,usingSearchPaths:!0,excludePattern:n?void 0:{"**/*":!0}}}isCaseSensitive(t,i){if(i.isSmartCase){if(t.isRegExp){if(Qx(t.pattern,!0))return!0}else if(Qx(t.pattern))return!0}return!!t.isCaseSensitive}isMultiline(t){return t.isMultiline||t.isRegExp&&fT(t.pattern)||t.pattern.indexOf(`
`)>=0?!0:!!t.isMultiline}parseSearchPaths(t){const i=d=>Dr(d)||/^\.\.?([\/\\]|$)/.test(d),s=(Array.isArray(t)?t:YW(t)).map(d=>{const f=this.pathService.resolvedUserHome;return f?ey(d,f.scheme===V.file?f.fsPath:f.path):d}),n=cv(s,d=>i(d)?"searchPaths":"exprSegments"),o=(n.exprSegments||[]).map(d=>vn(d,"/")).map(d=>vn(d,"\\")).map(d=>(d[0]==="."&&(d="*"+d),ZW(d))),a={},l=this.expandSearchPathPatterns(n.searchPaths||[]);l&&l.length&&(a.searchPaths=l);const c=o.flat(),u=ny(...c);return u&&(a.pattern=u),a}getExcludesForFolder(t,i){return i.disregardExcludeSettings?void 0:CU(t,!i.disregardSearchExcludeSettings)}expandSearchPathPatterns(t){if(!t||!t.length)return[];const i=t.flatMap(s=>{let{pathPortion:n,globPortion:o}=XW(s);return o&&(o=oy(o)),this.expandOneSearchPath(n).flatMap(l=>this.resolveOneSearchPathPattern(l,o))}),r=new Map;return i.forEach(s=>{const n=s.searchPath.toString(),o=r.get(n);o?s.pattern&&(o.pattern=o.pattern||{},o.pattern[s.pattern]=!0):r.set(n,{searchPath:s.searchPath,pattern:s.pattern?ny(s.pattern):void 0})}),Array.from(r.values())}expandOneSearchPath(t){if(Dr(t)){const i=this.workspaceContextService.getWorkspace().folders;return i[0]&&i[0].uri.scheme!==V.file?[{searchPath:i[0].uri.with({path:t})}]:[{searchPath:b.file(Cs(t))}]}if(this.workspaceContextService.getWorkbenchState()===2){const i=this.workspaceContextService.getWorkspace().folders[0].uri;if(t=Ng(t),t.startsWith("../")||t===".."){const s=$e.resolve(i.path,t);return[{searchPath:i.with({path:s})}]}const r=oy(t);return[{searchPath:i,pattern:r}]}else{if(t==="./"||t===".\\")return[];{const i=t.replace(/^\.[\/\\]/,""),s=this.workspaceContextService.getWorkspace().folders.map(n=>{const o=i.match(new RegExp(`^${mn(n.name)}(?:/(.*)|$)`));return o?{match:o,folder:n}:null}).filter(ur);if(s.length)return s.map(n=>{const o=n.match[1];return{searchPath:n.folder.uri,pattern:o&&oy(o)}});{const n=t.match(/\.[\/\\](.+)[\/\\]?/),o=n?n[1]:t,a=h(14378,null,o);throw new Error(a)}}}}resolveOneSearchPathPattern(t,i){const r=t.pattern&&i?`${t.pattern}/${i}`:t.pattern||i,s=[{searchPath:t.searchPath,pattern:r}];return r&&!r.endsWith("**")&&s.push({searchPath:t.searchPath,pattern:r+"/**"}),s}getFolderQueryForSearchPath(t,i,r){const s=this.getFolderQueryForRoot(w1(t.searchPath),i,r,!1);return s?{...s,includePattern:t.pattern}:null}getFolderQueryForRoot(t,i,r,s){let n;const o=b.isUri(t)?t:t.uri;let a=i.excludePattern?.map(p=>{const g=i.excludePattern&&KW(p)?p.uri:void 0;return!g||!(b.isUri(t)&&this.uriIdentityService.extUri.isEqual(t,g))?g:void 0});if(a?.length||(a=[void 0]),r.searchPaths){const p=r.searchPaths.filter(g=>lo(g.searchPath,o))[0];if(p&&!p.pattern)return null;p&&(n=p.pattern)}const l=this.configurationService.getValue({resource:o}),u={...this.getExcludesForFolder(l,i)||{},...n||{}},d=b.isUri(t)?ir(t):t.name,f=a.map(p=>Object.keys(u).length>0?{folder:p,pattern:u}:void 0).filter(p=>p);return{folder:o,folderName:s?d:void 0,excludePattern:f,fileEncoding:l.files&&l.files.encoding,disregardIgnoreFiles:typeof i.disregardIgnoreFiles=="boolean"?i.disregardIgnoreFiles:!l.search.useIgnoreFiles,disregardGlobalIgnoreFiles:typeof i.disregardGlobalIgnoreFiles=="boolean"?i.disregardGlobalIgnoreFiles:!l.search.useGlobalIgnoreFiles,disregardParentIgnoreFiles:typeof i.disregardParentIgnoreFiles=="boolean"?i.disregardParentIgnoreFiles:!l.search.useParentIgnoreFiles,ignoreSymlinks:typeof i.ignoreSymlinks=="boolean"?i.ignoreSymlinks:!l.search.followSymlinks}}};yT=__decorate([__param(0,Us),__param(1,Uh),__param(2,vH),__param(3,ke),__param(4,JW),__param(5,zI)],yT);function XW(e){const t=e.match(/[\*\{\}\(\)\[\]\?]/);if(t){const i=t.index,r=e.substr(0,i).match(/[/|\\][^/\\]*$/);if(r){let s=e.substr(0,r.index);return s.match(/[/\\]/)||(s+="/"),{pathPortion:s,globPortion:e.substr((r.index||0)+1)}}}return{pathPortion:e}}function ny(...e){return e.length?e.reduce((t,i)=>(t[i]=!0,t),Object.create(null)):void 0}function YW(e){return qc(e,",").map(t=>t.trim()).filter(t=>!!t.length)}function ZW(e){return[`**/${e}/**`,`**/${e}`].map(i=>i.replace(/\*\*\/\*\*/g,"**"))}function Ng(e){return e.replace(/\\/g,"/")}function oy(e){return Ng(e).replace(/^\.\//,"").replace(/\/+$/g,"")}var eB=7e3;function tB(e,t){const i=t.activationEvents;if(!i)return Promise.resolve(void 0);const r=[],s=[];for(const u of i)if(/^workspaceContains:/.test(u)){const d=u.substr(18);d.indexOf("*")>=0||d.indexOf("?")>=0||e.forceUsingSearch?s.push(d):r.push(d)}if(r.length===0&&s.length===0)return Promise.resolve(void 0);const{promise:n,resolve:o}=vE(),a=u=>o({activationEvent:u}),l=Promise.all(r.map(u=>iB(e,u,a))).then(()=>{}),c=rB(e,t.identifier,s,a);return Promise.all([l,c]).then(()=>{o(void 0)}),n}async function iB(e,t,i){for(const r of e.folders)if(await e.exists(Dt(b.revive(r),t))){i(`workspaceContains:${t}`);return}}async function rB(e,t,i,r){if(i.length===0)return Promise.resolve(void 0);const s=new rt,n=e.checkExists(e.folders,i,s.token),o=setTimeout(async()=>{s.cancel(),e.logService.info(`Not activating extension '${t.value}': Timed out while searching for 'workspaceContains' pattern ${i.join(",")}`)},eB);let a=!1;try{a=await n}catch(l){Yi(l)||pt(l)}s.dispose(),clearTimeout(o),a&&r(`workspaceContains:${i.join(",")}`)}var bT=class{constructor(e){this._onDidChangePassword=new D,this.onDidChangePassword=this._onDidChangePassword.event,this._proxy=e.getProxy(Q.MainThreadSecretState)}async $onDidChangePassword(e){this._onDidChangePassword.fire(e)}get(e,t){return this._proxy.$getPassword(e,t)}store(e,t,i){return this._proxy.$setPassword(e,t,i)}delete(e,t){return this._proxy.$deletePassword(e,t)}},ay=q("IExtHostSecretState"),sB=class{#e;constructor(e,t){this.disposables=new oe,this._id=qe.toKey(e.identifier),this.#e=t,this.onDidChange=Fe.map(Fe.filter(this.#e.onDidChangePassword,i=>i.extensionId===this._id),i=>({key:i.key}),this.disposables)}dispose(){this.disposables.dispose()}get(e){return this.#e.get(this._id,e)}store(e,t){return this.#e.store(this._id,e,t)}delete(e){return this.#e.delete(this._id,e)}},ly=class{constructor(t,i,r){this.logService=r,this.bundleCache=new Map,this._proxy=i.getProxy(Q.MainThreadLocalization),this.currentLanguage=t.environment.appLanguage,this.isDefaultLanguage=this.currentLanguage===fn,this.logService.info(`[ExtHostLocalization] Service initialized with language: ${this.currentLanguage}, isDefaultLanguage: ${this.isDefaultLanguage}`)}getMessage(t,i){const{message:r,args:s,comment:n}=i;if(this.isDefaultLanguage)return $x(r,s??{});let o=r;n&&n.length>0&&(o+=`/${Array.isArray(n)?n.join(""):n}`);const a=this.bundleCache.get(t)?.contents[o];return a||this.logService.warn(`[ExtHostLocalization] Using default string since no string found in i18n bundle that has the key: ${o}`),$x(a??r,s??{})}getBundle(t){return this.bundleCache.get(t)?.contents}getBundleUri(t){return this.bundleCache.get(t)?.uri}async initializeLocalizedMessages(t){if(this.logService.info(`[ExtHostLocalization] Initializing localized messages for extension: ${t.identifier.value}, isBuiltin: ${t.isBuiltin}`),this.isDefaultLanguage||!t.l10n&&!t.isBuiltin){this.logService.info(`[ExtHostLocalization] Skipping localization for ${t.identifier.value}: using default language(${this.isDefaultLanguage}) or extension doesn't support localization(l10n: ${!!t.l10n}, isBuiltin: ${t.isBuiltin})`);return}if(this.bundleCache.has(t.identifier.value)){this.logService.info(`[ExtHostLocalization] Bundle already cached for extension: ${t.identifier.value}`);return}let i;this.logService.info(`[ExtHostLocalization] Getting bundle location for extension: ${t.identifier.value}`);const r=await this.getBundleLocation(t);if(!r){this.logService.error(`[ExtHostLocalization] No bundle location found for extension ${t.identifier.value}`);return}this.logService.info(`[ExtHostLocalization] Bundle location for ${t.identifier.value}: ${r.toString()}`);try{this.logService.info(`[ExtHostLocalization] Fetching bundle contents for ${t.identifier.value} from ${r.toString()}`);const s=await this._proxy.$fetchBundleContents(r);this.logService.info(`[ExtHostLocalization] Bundle content received for ${t.identifier.value}, parsing JSON`);const n=JSON.parse(s);t.identifier.value==="Tencent-Cloud.coding-copilot"?(this.logService.info(`[ExtHostLocalization] Using simple format for ${t.identifier.value}`),i=n):i=t.isBuiltin?n.contents?.bundle:n,this.logService.info(`[ExtHostLocalization] Bundle parsed successfully for ${t.identifier.value}, keys count: ${i?Object.keys(i).length:0}`)}catch(s){this.logService.error(`[ExtHostLocalization] Failed to load translations for ${t.identifier.value} from ${r}: ${s.message}`),this.logService.error(`[ExtHostLocalization] Error stack: ${s.stack}`);return}i?(this.logService.info(`[ExtHostLocalization] Caching bundle for ${t.identifier.value}`),this.bundleCache.set(t.identifier.value,{contents:i,uri:r})):this.logService.warn(`[ExtHostLocalization] No contents found in bundle for ${t.identifier.value}`)}async getBundleLocation(t){if(this.logService.info(`[ExtHostLocalization] Getting bundle location for ${t.identifier.value}, isBuiltin: ${t.isBuiltin}`),t.identifier.value==="Tencent-Cloud.coding-copilot"&&t.l10n){const i=b.joinPath(t.extensionLocation,t.l10n,`bundle.l10n.${this.currentLanguage}.json`);return this.logService.info(`[ExtHostLocalization] Using extension's own l10n for ${t.identifier.value}: ${i.toString()}`),i}if(t.isBuiltin){this.logService.info(`[ExtHostLocalization] Fetching built-in bundle URI for ${t.identifier.value}, language: ${this.currentLanguage}`);const i=await this._proxy.$fetchBuiltInBundleUri(t.identifier.value,this.currentLanguage),r=b.revive(i);return this.logService.info(`[ExtHostLocalization] Built-in bundle URI for ${t.identifier.value}: ${r?r.toString():"undefined"}`),r}if(t.l10n){const i=b.joinPath(t.extensionLocation,t.l10n,`bundle.l10n.${this.currentLanguage}.json`);return this.logService.info(`[ExtHostLocalization] Extension bundle path for ${t.identifier.value}: ${i.toString()}`),i}this.logService.info(`[ExtHostLocalization] No l10n property found for extension ${t.identifier.value}`)}};ly=__decorate([__param(0,zt),__param(1,Pe),__param(2,ke)],ly);var cy=q("IExtHostLocalizationService"),uy=q("IExtHostManagedSockets"),dy=class{constructor(t){this._remoteSocketIdCounter=0,this._factory=null,this._managedRemoteSockets=new Map,this._proxy=t.getProxy(Q.MainThreadManagedSockets)}setFactory(t,i){for(const r of this._managedRemoteSockets.values())r.dispose();this._factory&&this._proxy.$unregisterSocketFactory(this._factory.socketFactoryId),this._factory=new nB(t,i),this._proxy.$registerSocketFactory(this._factory.socketFactoryId)}async $openRemoteSocket(t){if(!this._factory||this._factory.socketFactoryId!==t)throw new Error(`No socket factory with id ${t}`);const i=++this._remoteSocketIdCounter,r=await this._factory.makeConnection(),s=new oe;return this._managedRemoteSockets.set(i,new oB(i,r,s)),s.add(ie(()=>this._managedRemoteSockets.delete(i))),s.add(r.onDidEnd(()=>{this._proxy.$onDidManagedSocketEnd(i),s.dispose()})),s.add(r.onDidClose(n=>{this._proxy.$onDidManagedSocketClose(i,n?.stack??n?.message),s.dispose()})),s.add(r.onDidReceiveMessage(n=>this._proxy.$onDidManagedSocketHaveData(i,z.wrap(n)))),i}$remoteSocketWrite(t,i){this._managedRemoteSockets.get(t)?.actual.send(i.buffer)}$remoteSocketEnd(t){const i=this._managedRemoteSockets.get(t);i&&(i.actual.end(),i.dispose())}async $remoteSocketDrain(t){await this._managedRemoteSockets.get(t)?.actual.drain?.()}};dy=__decorate([__param(0,Pe)],dy);var nB=class{constructor(e,t){this.socketFactoryId=e,this.makeConnection=t}},oB=class extends X{constructor(e,t,i){super(),this.socketId=e,this.actual=t,this._register(i)}},hy,ST=q("IHostUtils"),fy=hy=class extends X{constructor(t,i,r,s,n,o,a,l,c,u,d,f,p){super(),this._extHostManagedSockets=f,this._extHostLanguageModels=p,this._onDidChangeRemoteConnectionData=this._register(new D),this.onDidChangeRemoteConnectionData=this._onDidChangeRemoteConnectionData.event,this._realPathCache=new Map,this._isTerminating=!1,this._hostUtils=i,this._extHostContext=r,this._initData=a,this._extHostWorkspace=s,this._extHostConfiguration=n,this._logService=o,this._extHostTunnelService=c,this._extHostTerminalService=u,this._extHostLocalizationService=d,this._mainThreadWorkspaceProxy=this._extHostContext.getProxy(Q.MainThreadWorkspace),this._mainThreadTelemetryProxy=this._extHostContext.getProxy(Q.MainThreadTelemetry),this._mainThreadExtensionsProxy=this._extHostContext.getProxy(Q.MainThreadExtensionService),this._almostReadyToRunExtensions=new dr,this._readyToStartExtensionHost=new dr,this._readyToRunExtensions=new dr,this._eagerExtensionsActivated=new dr,this._activationEventsReader=new lB(this._initData.extensions.activationEvents),this._globalRegistry=new ed(this._activationEventsReader,this._initData.extensions.allExtensions);const g=new mo(this._initData.extensions.myExtensions);this._myRegistry=new ed(this._activationEventsReader,CT(this._globalRegistry,g)),to&&(this._logService.info(`Creating extension host with the following global extensions: ${Wl(this._globalRegistry)}`),this._logService.info(`Creating extension host with the following local extensions: ${Wl(this._myRegistry)}`)),this._storage=new L5(this._extHostContext,this._logService),this._secretState=new bT(this._extHostContext),this._storagePath=l,this._instaService=this._store.add(t.createChild(new m1([$w,this._storage],[ay,this._secretState]))),this._activator=this._register(new Ow(this._myRegistry,this._globalRegistry,{onExtensionActivationError:(v,y,S)=>{this._mainThreadExtensionsProxy.$onExtensionActivationError(v,wa(y),S)},actualActivateExtension:async(v,y)=>{if(ed.isHostExtension(v,this._myRegistry,this._globalRegistry))return await this._mainThreadExtensionsProxy.$activateExtension(v,y),new fW;const S=this._myRegistry.getExtensionDescription(v);return this._activateExtension(S,y)}},this._logService)),this._extensionPathIndex=null,this._resolvers=Object.create(null),this._started=!1,this._remoteConnectionData=this._initData.remote.connectionData}getRemoteConnectionData(){return this._remoteConnectionData}async initialize(){try{await this._beforeAlmostReadyToRunExtensions(),this._almostReadyToRunExtensions.open(),await this._extHostWorkspace.waitForInitializeCall(),Pt("code/extHost/ready"),this._readyToStartExtensionHost.open(),this._initData.autoStart&&this._startExtensionHost()}catch(t){pt(t)}}async _deactivateAll(){this._storagePath.onWillDeactivateAll();let t=[];try{t=this._myRegistry.getAllExtensionDescriptions().map(n=>n.identifier).filter(n=>this.isActivated(n)).map(n=>this._deactivate(n))}catch{}await Promise.all(t)}terminate(t,i=0){if(this._isTerminating)return;this._isTerminating=!0,this._logService.info(`Extension host terminating: ${t}`),this._logService.flush(),this._extHostTerminalService.dispose(),this._activator.dispose(),uv(s=>{this._logService.error(s)}),this._extHostContext.dispose();const r=this._deactivateAll();Promise.race([ui(5e3),r]).finally(()=>{this._hostUtils.pid?this._logService.info(`Extension host with pid ${this._hostUtils.pid} exiting with code ${i}`):this._logService.info(`Extension host exiting with code ${i}`),this._logService.flush(),this._logService.dispose(),this._hostUtils.exit(i)})}isActivated(t){return this._readyToRunExtensions.isOpen()?this._activator.isActivated(t):!1}async getExtension(t){const i=await this._mainThreadExtensionsProxy.$getExtension(t);return i&&{...i,identifier:new qe(i.identifier.value),extensionLocation:b.revive(i.extensionLocation)}}_activateByEvent(t,i){return this._activator.activateByEvent(t,i)}_activateById(t,i){return this._activator.activateById(t,i)}activateByIdWithErrors(t,i){return this._activateById(t,i).then(()=>{const r=this._activator.getActivatedExtension(t);if(r.activationFailed)return Promise.reject(r.activationFailedError)})}getExtensionRegistry(){return this._readyToRunExtensions.wait().then(t=>this._myRegistry)}getExtensionExports(t){if(this._readyToRunExtensions.isOpen())return this._activator.getActivatedExtension(t).exports;try{return this._activator.getActivatedExtension(t).exports}catch{return null}}async _realPathExtensionUri(t){if(t.scheme===V.file&&this._hostUtils.fsRealpath){const i=t.fsPath;this._realPathCache.has(i)||this._realPathCache.set(i,this._hostUtils.fsRealpath(i));const r=await this._realPathCache.get(i);return b.file(r)}return t}async getExtensionPathIndex(){return this._extensionPathIndex||(this._extensionPathIndex=this._createExtensionPathIndex(this._myRegistry.getAllExtensionDescriptions()).then(t=>new aB(t))),this._extensionPathIndex}async _createExtensionPathIndex(t){const i=xn.forUris(r=>Ov.ignorePathCasing(r));return await Promise.all(t.map(async r=>{if(this._getEntryPoint(r)){const s=await this._realPathExtensionUri(r.extensionLocation);i.set(s,r)}})),i}_deactivate(t){let i=Promise.resolve(void 0);if(!this._readyToRunExtensions.isOpen()||!this._activator.isActivated(t))return i;const r=this._activator.getActivatedExtension(t);if(!r)return i;try{typeof r.module.deactivate=="function"&&(i=Promise.resolve(r.module.deactivate()).then(void 0,s=>(this._logService.error(s),Promise.resolve(void 0))))}catch(s){this._logService.error(`An error occurred when deactivating the extension '${t.value}':`),this._logService.error(s)}try{r.disposable.dispose()}catch(s){this._logService.error(`An error occurred when disposing the subscriptions for extension '${t.value}':`),this._logService.error(s)}return i}async _activateExtension(t,i){return this._initData.remote.isRemote?this._mainThreadExtensionsProxy.$onWillActivateExtension(t.identifier):await this._mainThreadExtensionsProxy.$onWillActivateExtension(t.identifier),this._doActivateExtension(t,i).then(r=>{const s=r.activationTimes;return this._mainThreadExtensionsProxy.$onDidActivateExtension(t.identifier,s.codeLoadingTime,s.activateCallTime,s.activateResolvedTime,i),this._logExtensionActivationTimes(t,i,"success",s),r},r=>{throw this._logExtensionActivationTimes(t,i,"failure"),r})}_logExtensionActivationTimes(t,i,r,s){const n=ET(t,i);this._mainThreadTelemetryProxy.$publicLog2("extensionActivationTimes",{...n,...s||{},outcome:r})}_doActivateExtension(t,i){const r=ET(t,i);this._mainThreadTelemetryProxy.$publicLog2("activatePlugin",r);const s=this._getEntryPoint(t);if(!s)return Promise.resolve(new hW(Eg.NONE));this._logService.info(`ExtensionService#_doActivateExtension ${t.identifier.value}, startup: ${i.startup}, activationEvent: '${i.activationEvent}'${t.identifier.value!==i.extensionId.value?`, root cause: ${i.extensionId.value}`:""}`),this._logService.flush();const n=this._isESM(t),o=new oe,a=new Mw(i.startup);return Promise.all([n?this._loadESMModule(t,Dt(t.extensionLocation,s),a):this._loadCommonJSModule(t,Dt(t.extensionLocation,s),a),this._loadExtensionContext(t,o)]).then(l=>(Pt(`code/extHost/willActivateExtension/${t.identifier.value}`),hy._callActivate(this._logService,t.identifier,l[0],l[1],o,a))).then(l=>(Pt(`code/extHost/didActivateExtension/${t.identifier.value}`),l))}_loadExtensionContext(t,i){const r=this._extHostLanguageModels.createLanguageModelAccessInformation(t),s=i.add(new pW(t,this._storage)),n=i.add(new N5(t.identifier.value,!1,this._storage)),o=i.add(new sB(t,this._secretState)),a=t.isUnderDevelopment?this._initData.environment.extensionTestsLocationURI?vl.Test:vl.Development:vl.Production,l=this._initData.remote.isRemote?Wo.Workspace:Wo.UI;return this._logService.trace(`ExtensionService#loadExtensionContext ${t.identifier.value}`),Promise.all([s.whenReady,n.whenReady,this._storagePath.whenReady]).then(()=>{const c=this;let u,d;const f=nt(t,"ipc")?this._initData.messagePorts?.get(qe.toKey(t.identifier)):void 0;return Object.freeze({globalState:s,workspaceState:n,secrets:o,subscriptions:[],get languageModelAccessInformation(){return r},get extensionUri(){return t.extensionLocation},get extensionPath(){return t.extensionLocation.fsPath},asAbsolutePath(p){return Xe(t.extensionLocation.fsPath,p)},get storagePath(){return c._storagePath.workspaceValue(t)?.fsPath},get globalStoragePath(){return c._storagePath.globalValue(t).fsPath},get logPath(){return Xe(c._initData.logsLocation.fsPath,t.identifier.value)},get logUri(){return b.joinPath(c._initData.logsLocation,t.identifier.value)},get storageUri(){return c._storagePath.workspaceValue(t)},get globalStorageUri(){return c._storagePath.globalValue(t)},get extensionMode(){return a},get extension(){return u===void 0&&(u=new od(c,t.identifier,t,l,!1)),u},get extensionRuntime(){return M(t,"extensionRuntime"),c.extensionRuntime},get environmentVariableCollection(){return c._extHostTerminalService.getEnvironmentVariableCollection(t)},get messagePassingProtocol(){if(!d){if(!f)return;const p=Fe.buffer(Fe.fromDOMEventEmitter(f,"message",g=>g.data));f.start(),d={onDidReceiveMessage:p,postMessage:f.postMessage.bind(f)}}return d}})})}static _callActivate(t,i,r,s,n,o){return r=r||{activate:void 0,deactivate:void 0},this._callActivateOptional(t,i,r,s,o).then(a=>new Cg(!1,null,o.build(),r,a,ie(()=>{n.dispose(),Cr(s.subscriptions)})))}static _callActivateOptional(t,i,r,s,n){if(typeof r.activate=="function")try{n.activateCallStart(),t.trace(`ExtensionService#_callActivateOptional ${i.value}`);const o=typeof global=="object"?global:self,a=r.activate.apply(o,[s]);return n.activateCallStop(),n.activateResolveStart(),Promise.resolve(a).then(l=>(n.activateResolveStop(),l))}catch(o){return Promise.reject(o)}else return Promise.resolve(r)}_activateOneStartupFinished(t,i){this._activateById(t.identifier,{startup:!1,extensionId:t.identifier,activationEvent:i}).then(void 0,r=>{this._logService.error(r)})}_activateAllStartupFinishedDeferred(t,i=0){const s=Date.now();Px(()=>{for(let n=i;n<t.length;n+=1){const o=t[n];for(const a of o.activationEvents??[])if(a==="onStartupFinished")if(Date.now()-s>50){this._activateAllStartupFinishedDeferred(t,n);break}else this._activateOneStartupFinished(o,a)}})}_activateAllStartupFinished(){this._mainThreadExtensionsProxy.$setPerformanceMarks(gN()),this._extHostConfiguration.getConfigProvider().then(t=>{const i=t.getConfiguration("extensions.experimental").get("deferredStartupFinishedActivation"),r=this._myRegistry.getAllExtensionDescriptions();if(i)this._activateAllStartupFinishedDeferred(r);else for(const s of r)if(s.activationEvents)for(const n of s.activationEvents)n==="onStartupFinished"&&this._activateOneStartupFinished(s,n)})}_handleEagerExtensions(){const t=this._activateByEvent("*",!0).then(void 0,o=>{this._logService.error(o)});this._register(this._extHostWorkspace.onDidChangeWorkspace(o=>this._handleWorkspaceContainsEagerExtensions(o.added)));const i=this._extHostWorkspace.workspace?this._extHostWorkspace.workspace.folders:[],r=this._handleWorkspaceContainsEagerExtensions(i),s=this._handleRemoteResolverEagerExtensions(),n=Promise.all([s,t,r]).then(()=>{});return Promise.race([n,ui(1e4)]).then(()=>{this._activateAllStartupFinished()}),n}_handleWorkspaceContainsEagerExtensions(t){return t.length===0?Promise.resolve(void 0):Promise.all(this._myRegistry.getAllExtensionDescriptions().map(i=>this._handleWorkspaceContainsEagerExtension(t,i))).then(()=>{})}async _handleWorkspaceContainsEagerExtension(t,i){if(this.isActivated(i.identifier))return;const r=!this._initData.remote.isRemote&&!!this._initData.remote.authority,s={logService:this._logService,folders:t.map(o=>o.uri),forceUsingSearch:r||!this._hostUtils.fsExists,exists:o=>this._hostUtils.fsExists(o.fsPath),checkExists:(o,a,l)=>this._mainThreadWorkspaceProxy.$checkExists(o,a,l)},n=await tB(s,i);if(n)return this._activateById(i.identifier,{startup:!0,extensionId:i.identifier,activationEvent:n.activationEvent}).then(void 0,o=>this._logService.error(o))}async _handleRemoteResolverEagerExtensions(){if(this._initData.remote.authority)return this._activateByEvent(`onResolveRemoteAuthority:${this._initData.remote.authority}`,!1)}async $extensionTestsExecute(){await this._eagerExtensionsActivated.wait();try{return await this._doHandleExtensionTests()}catch(t){throw console.error(t),t}}async _doHandleExtensionTests(){const{extensionDevelopmentLocationURI:t,extensionTestsLocationURI:i}=this._initData.environment;if(!t||!i)throw new Error(h(2925,null));const r=(await this.getExtensionPathIndex()).findSubstr(i),n=await(this._isESM(r,i.path)?this._loadESMModule(null,i,new Mw(!1)):this._loadCommonJSModule(null,i,new Mw(!1)));if(!n||typeof n.run!="function")throw new Error(h(2926,null,i.toString()));return new Promise((o,a)=>{const l=(d,f)=>{d?(to&&this._logService.error("Test runner called back with error",d),a(d)):(to&&(f?this._logService.info(`Test runner called back with ${f} failures.`):this._logService.info("Test runner called back with successful outcome.")),o(typeof f=="number"&&f>0?1:0))},c=Pr(i),u=n.run(c,l);u&&u.then&&u.then(()=>{to&&this._logService.info("Test runner finished successfully."),o(0)}).catch(d=>{to&&this._logService.error("Test runner finished with error",d),a(d instanceof Error&&d.stack?d.stack:String(d))})})}_startExtensionHost(){if(this._started)throw new Error("Extension host is already started!");return this._started=!0,this._readyToStartExtensionHost.wait().then(()=>this._readyToRunExtensions.open()).then(()=>Promise.race([this._activator.waitForActivatingExtensions(),ui(1e3)])).then(()=>this._handleEagerExtensions()).then(()=>{this._eagerExtensionsActivated.open(),this._logService.info("Eager extensions activated")})}registerRemoteAuthorityResolver(t,i){return this._resolvers[t]=i,ie(()=>{delete this._resolvers[t]})}async getRemoteExecServer(t){const{resolver:i}=await this._activateAndGetResolver(t);return i?.resolveExecServer?.(t,{resolveAttempt:0})}async _activateAndGetResolver(t){const i=t.indexOf("+");if(i===-1)throw new Ja("Not an authority that can be resolved!",Ii.InvalidAuthority);const r=t.substr(0,i);return await this._almostReadyToRunExtensions.wait(),await this._activateByEvent(`onResolveRemoteAuthority:${r}`,!1),{authorityPrefix:r,resolver:this._resolvers[r]}}async $resolveAuthority(t,i){const r=Hi.create(!1),s=()=>`[resolveAuthority(${u4(t)},${i})][${r.elapsed()}ms] `,n=x=>this._logService.info(`${s()}${x}`),o=x=>this._logService.warn(`${s()}${x}`),a=(x,P=void 0)=>this._logService.error(`${s()}${x}`,P),l=x=>{if(x instanceof Ja)return{type:"error",error:{code:x._code,message:x._message,detail:x._detail}};throw x},c=async x=>{n(`activating resolver for ${x}...`);const{resolver:P,authorityPrefix:$}=await this._activateAndGetResolver(x);if(!P)throw a(`no resolver for ${$}`),new Ja(`No remote extension installed to resolve ${$}.`,Ii.NoResolverFound);return{resolver:P,authorityPrefix:$,remoteAuthority:x}},u=t.split(/@|%40/g).reverse();n(`activating remote resolvers ${u.join(" -> ")}`);let d;try{d=await Promise.all(u.map(c)).catch(async x=>{if(!(x instanceof Ja)||x._code!==Ii.InvalidAuthority)throw x;return o(`resolving nested authorities failed: ${x.message}`),[await c(t)]})}catch(x){return l(x)}const f=new yE;f.cancelAndSet(()=>n("waiting..."),1e3);let p,g;for(const[x,{authorityPrefix:P,resolver:$,remoteAuthority:A}]of d.entries())try{if(x===d.length-1)n("invoking final resolve()..."),Pt(`code/extHost/willResolveAuthority/${P}`),p=await $.resolve(A,{resolveAttempt:i,execServer:g}),Pt(`code/extHost/didResolveAuthorityOK/${P}`),n("setting tunnel factory..."),this._register(await this._extHostTunnelService.setTunnelFactory($,$f.isManagedResolvedAuthority(p)?p:void 0));else{if(n(`invoking resolveExecServer() for ${A}`),Pt(`code/extHost/willResolveExecServer/${P}`),g=await $.resolveExecServer?.(A,{resolveAttempt:i,execServer:g}),!g)throw new Ja(`Exec server was not available for ${A}`,Ii.NoResolverFound);Pt(`code/extHost/didResolveExecServerOK/${P}`)}}catch(W){return Pt(`code/extHost/didResolveAuthorityError/${P}`),a("returned an error",W),f.dispose(),l(W)}f.dispose();const v={environmentTunnels:p.environmentTunnels,features:p.tunnelFeatures?{elevation:p.tunnelFeatures.elevation,privacyOptions:p.tunnelFeatures.privacyOptions,protocol:p.tunnelFeatures.protocol===void 0?!0:p.tunnelFeatures.protocol}:void 0},y={extensionHostEnv:p.extensionHostEnv,isTrusted:p.isTrusted,authenticationSession:p.authenticationSessionForInitializingExtensions?{id:p.authenticationSessionForInitializingExtensions.id,providerId:p.authenticationSessionForInitializingExtensions.providerId}:void 0};n(`returned ${$f.isManagedResolvedAuthority(p)?"managed authority":`${p.host}:${p.port}`}`);let S;if($f.isManagedResolvedAuthority(p)){const x=i;this._extHostManagedSockets.setFactory(x,p.makeConnection),S={authority:t,connectTo:new c4(x),connectionToken:p.connectionToken}}else S={authority:t,connectTo:new VH(p.host,p.port),connectionToken:p.connectionToken};return{type:"ok",value:{authority:S,options:y,tunnelInformation:v}}}async $getCanonicalURI(t,i){this._logService.info(`$getCanonicalURI invoked for authority (${u4(t)})`);const{resolver:r}=await this._activateAndGetResolver(t);if(!r)return null;const s=b.revive(i);if(typeof r.getCanonicalURI>"u")return s;const n=await ci(()=>r.getCanonicalURI(s));return n||s}async $startExtensionHost(t){t.toAdd.forEach(o=>o.extensionLocation=b.revive(o.extensionLocation));const{globalRegistry:i,myExtensions:r}=xT(this._activationEventsReader,this._globalRegistry,this._myRegistry,t),s=await this._createExtensionPathIndex(r);return(await this.getExtensionPathIndex()).setSearchTree(s),this._globalRegistry.set(i.getAllExtensionDescriptions()),this._myRegistry.set(r),to&&(this._logService.info(`$startExtensionHost: global extensions: ${Wl(this._globalRegistry)}`),this._logService.info(`$startExtensionHost: local extensions: ${Wl(this._myRegistry)}`)),this._startExtensionHost()}$activateByEvent(t,i){return i===1?this._almostReadyToRunExtensions.wait().then(r=>this._activateByEvent(t,!1)):this._readyToRunExtensions.wait().then(r=>this._activateByEvent(t,!1))}async $activate(t,i){return await this._readyToRunExtensions.wait(),this._myRegistry.getExtensionDescription(t)?(await this._activateById(t,i),!0):!1}async $deltaExtensions(t){t.toAdd.forEach(o=>o.extensionLocation=b.revive(o.extensionLocation));const{globalRegistry:i,myExtensions:r}=xT(this._activationEventsReader,this._globalRegistry,this._myRegistry,t),s=await this._createExtensionPathIndex(r);return(await this.getExtensionPathIndex()).setSearchTree(s),this._globalRegistry.set(i.getAllExtensionDescriptions()),this._myRegistry.set(r),to&&(this._logService.info(`$deltaExtensions: global extensions: ${Wl(this._globalRegistry)}`),this._logService.info(`$deltaExtensions: local extensions: ${Wl(this._myRegistry)}`)),Promise.resolve(void 0)}async $test_latency(t){return t}async $test_up(t){return t.byteLength}async $test_down(t){const i=z.alloc(t),r=Math.random()%256;for(let s=0;s<t;s++)i.writeUInt8(r,s);return i}async $updateRemoteConnectionData(t){this._remoteConnectionData=t,this._onDidChangeRemoteConnectionData.fire()}_isESM(t,i){return i??=t?.main,i?.endsWith(".mjs")||t?.type==="module"&&!i?.endsWith(".cjs")}};fy=hy=__decorate([__param(0,Ic),__param(1,ST),__param(2,Pe),__param(3,Br),__param(4,vr),__param(5,ke),__param(6,zt),__param(7,Uw),__param(8,Ig),__param(9,Ks),__param(10,cy),__param(11,uy),__param(12,Yw)],fy);function xT(e,t,i,r){e.addActivationEvents(r.addActivationEvents);const s=new ed(e,t.getAllExtensionDescriptions());s.deltaExtensions(r.toAdd,r.toRemove);const n=new mo(i.getAllExtensionDescriptions().map(a=>a.identifier));for(const a of r.myToRemove)n.delete(a);for(const a of r.myToAdd)n.add(a);const o=CT(s,n);return{globalRegistry:s,myExtensions:o}}function ET(e,t){return{id:e.identifier.value,name:e.name,extensionVersion:e.version,publisherDisplayName:e.publisher,activationEvents:e.activationEvents?e.activationEvents.join(","):null,isBuiltin:e.isBuiltin,reason:t.activationEvent,reasonId:t.extensionId.value}}function Wl(e){return e.getAllExtensionDescriptions().map(t=>t.identifier.value).join(",")}var Xs=q("IExtHostExtensionService"),od=class{#e;#t;#i;constructor(e,t,i,r,s){this.#e=e,this.#t=t,this.#i=i.identifier,this.id=i.identifier.value,this.extensionUri=i.extensionLocation,this.extensionPath=Cs(Pr(i.extensionLocation)),this.packageJSON=i,this.extensionKind=r,this.isFromDifferentExtensionHost=s}get isActive(){return this.#e.isActivated(this.#i)}get exports(){if(!(this.packageJSON.api==="none"||this.isFromDifferentExtensionHost))return this.#e.getExtensionExports(this.#i)}async activate(){if(this.isFromDifferentExtensionHost)throw new Error("Cannot activate foreign extension");return await this.#e.activateByIdWithErrors(this.#i,{startup:!1,extensionId:this.#t,activationEvent:"api"}),this.exports}};function CT(e,t){return e.getAllExtensionDescriptions().filter(i=>t.has(i.identifier))}var aB=class{constructor(e){this._searchTree=e}setSearchTree(e){this._searchTree=e}findSubstr(e){return this._searchTree.findSubstr(e)}forEach(e){return this._searchTree.forEach(e)}},lB=class{constructor(e){this._map=new As,this.addActivationEvents(e)}readActivationEvents(e){return this._map.get(e.identifier)??[]}addActivationEvents(e){for(const t of Object.keys(e))this._map.set(t,e[t])}},DT=class{static async installEarlyHandler(e){Error.stackTraceLimit=100;const t=e.get(ke),r=e.get(Pe).getProxy(Q.MainThreadErrors);uv(s=>{t.error(s);const n=wa(s);r.$onUnexpectedError(n)})}static async installFullHandler(e){const t=e.get(ke),i=e.get(Pe),r=e.get(Xs),s=e.get(Tg),n=i.getProxy(Q.MainThreadExtensionService),o=i.getProxy(Q.MainThreadErrors),a=await r.getExtensionPathIndex(),l=new WeakMap;function c(f,p){if(l.has(f))return l.get(f).stack;let g="",v,y;for(const x of p)g+=`
	at ${x.toString()}`,y=x.getFileName(),!v&&y&&(v=a.findSubstr(b.file(y)));const S=`${f.name||"Error"}: ${f.message||""}${g}`;return l.set(f,{extensionIdentifier:v?.identifier,stack:S}),S}const u=Symbol("prepareStackTrace wrapped");let d=c;Object.defineProperty(Error,"prepareStackTrace",{configurable:!1,get(){return d},set(f){if(f===c||!f||f[u]){d=f||c;return}d=function(p,g){return c(p,g),f.call(Error,p,g)},Object.assign(d,{[u]:!0})}}),uv(f=>{t.error(f);const p=wa(f);let g;if(f instanceof KC?g=f.extension:g=l.get(f)?.extensionIdentifier,g){n.$onExtensionRuntimeError(g,p);const v=s.onExtensionError(g,f);t.trace("forwarded error to extension?",v,g)}}),lc.addListener(f=>{o.$onUnexpectedError(f)})}},cB=class S8{constructor(t,i,r,s,n){this._hostUtils=r,this._rpcProtocol=new pM(t,null,s),i=S8._transform(i,this._rpcProtocol);const o=new m1(...UM());o.set(zt,{_serviceBrand:void 0,...i,messagePorts:n}),o.set(Pe,new zM(this._rpcProtocol)),o.set(Nc,new qM(s)),o.set(ST,r);const a=new VM(o,!0);a.invokeFunction(DT.installEarlyHandler),this._logService=a.invokeFunction(l=>l.get(ke)),Pt("code/extHost/didCreateServices"),this._hostUtils.pid?this._logService.info(`Extension host with pid ${this._hostUtils.pid} started`):this._logService.info("Extension host started"),this._logService.trace("initData",i),this._extensionService=a.invokeFunction(l=>l.get(Xs)),this._extensionService.initialize(),a.invokeFunction(DT.installFullHandler)}async asBrowserUri(t){const i=this._rpcProtocol.getProxy(Q.MainThreadExtensionService);return b.revive(await i.$asBrowserUri(t))}terminate(t){this._extensionService.terminate(t)}static _transform(t,i){t.extensions.allExtensions.forEach(s=>{s.extensionLocation=b.revive(i.transformIncomingURIs(s.extensionLocation))}),t.environment.appRoot=b.revive(i.transformIncomingURIs(t.environment.appRoot));const r=t.environment.extensionDevelopmentLocationURI;return r&&(t.environment.extensionDevelopmentLocationURI=r.map(s=>b.revive(i.transformIncomingURIs(s)))),t.environment.extensionTestsLocationURI=b.revive(i.transformIncomingURIs(t.environment.extensionTestsLocationURI)),t.environment.globalStorageHome=b.revive(i.transformIncomingURIs(t.environment.globalStorageHome)),t.environment.workspaceStorageHome=b.revive(i.transformIncomingURIs(t.environment.workspaceStorageHome)),t.nlsBaseUrl=b.revive(i.transformIncomingURIs(t.nlsBaseUrl)),t.logsLocation=b.revive(i.transformIncomingURIs(t.logsLocation)),t.workspace=i.transformIncomingURIs(t.workspace),t}};function uB(e){return{transformIncoming:t=>t.scheme==="vscode-remote"?{scheme:"file",path:t.path,query:t.query,fragment:t.fragment}:t.scheme==="file"?{scheme:"vscode-local",path:t.path,query:t.query,fragment:t.fragment}:t,transformOutgoing:t=>t.scheme==="file"?{scheme:"vscode-remote",authority:e,path:t.path,query:t.query,fragment:t.fragment}:t.scheme==="vscode-local"?{scheme:"file",path:t.path,query:t.query,fragment:t.fragment}:t,transformOutgoingScheme:t=>t==="file"?"vscode-remote":t==="vscode-local"?"file":t}}function dB(e){return new aM(uB(e))}var kT;(function(e){e[e.IPC=1]="IPC",e[e.Socket=2]="Socket",e[e.MessagePort=3]="MessagePort"})(kT||(kT={}));var Mg=class x8{static{this.ENV_KEY="VSCODE_EXTHOST_IPC_HOOK"}constructor(t){this.pipeName=t,this.type=1}serialize(t){t[x8.ENV_KEY]=this.pipeName}},py=class E8{constructor(){this.type=2}static{this.ENV_KEY="VSCODE_EXTHOST_WILL_SEND_SOCKET"}serialize(t){t[E8.ENV_KEY]="1"}},gy=class C8{constructor(){this.type=3}static{this.ENV_KEY="VSCODE_WILL_SEND_MESSAGE_PORT"}serialize(t){t[C8.ENV_KEY]="1"}};function hB(e){delete e[Mg.ENV_KEY],delete e[py.ENV_KEY],delete e[gy.ENV_KEY]}function fB(e){if(e[Mg.ENV_KEY])return my(e,new Mg(e[Mg.ENV_KEY]));if(e[py.ENV_KEY])return my(e,new py);if(e[gy.ENV_KEY])return my(e,new gy);throw new Error("No connection information defined in environment!")}function my(e,t){return hB(e),t}var xte=new I("inOutput",!1),Ete=new I("activeLogOutput",!1),Cte=new I("activeLogOutput.isLog",!1),Dte=new I("activeLogOutput.levelSettable",!1),kte=new I("activeLogOutput.level",""),Ite=new I("activeLogOutput.levelIsDefault",!1),Pte=new I("outputView.scrollLock",!1),Tte=new I("activeOutputChannel",""),Ate=new I("output.filter.trace",!0),Rte=new I("output.filter.debug",!0),Lte=new I("output.filter.info",!0),Nte=new I("output.filter.warning",!0),Mte=new I("output.filter.error",!0),Ote=new I("outputFilterFocus",!1),Fte=new I("output.filter.categories",""),$te=q("outputService"),ad;(function(e){e[e.Append=1]="Append",e[e.Replace=2]="Replace",e[e.Clear=3]="Clear"})(ad||(ad={}));var pB={OutputChannels:"workbench.contributions.outputChannels"};function gB(e){return Array.isArray(e.source)}var mB=class extends X{constructor(){super(...arguments),this.channels=new Map,this._onDidRegisterChannel=this._register(new D),this.onDidRegisterChannel=this._onDidRegisterChannel.event,this._onDidRemoveChannel=this._register(new D),this.onDidRemoveChannel=this._onDidRemoveChannel.event,this._onDidUpdateChannelFiles=this._register(new D),this.onDidUpdateChannelSources=this._onDidUpdateChannelFiles.event}registerChannel(e){this.channels.has(e.id)||(this.channels.set(e.id,e),this._onDidRegisterChannel.fire(e.id))}getChannels(){const e=[];return this.channels.forEach(t=>e.push(t)),e}getChannel(e){return this.channels.get(e)}updateChannelSources(e,t){const i=this.channels.get(e);i&&gB(i)&&(i.source=t,this._onDidUpdateChannelFiles.fire(i))}removeChannel(e){const t=this.channels.get(e);t&&(this.channels.delete(e),this._onDidRemoveChannel.fire(t))}};Xt.add(pB.OutputChannels,new mB);var IT=class extends g1{constructor(e,t,i,r,s){super(),this.id=e,this.name=t,this.logger=i,this.proxy=r,this.extension=s,this.offset=0,this.visible=!1,this.setLevel(i.getLevel()),this._register(i.onDidChangeLogLevel(n=>this.setLevel(n))),this._register(ie(()=>this.proxy.$dispose(this.id)))}get logLevel(){return this.getLevel()}appendLine(e){this.append(e+`
`)}append(e){this.info(e)}clear(){const e=this.offset;this.logger.flush(),this.proxy.$update(this.id,ad.Clear,e)}replace(e){const t=this.offset;this.info(e),this.proxy.$update(this.id,ad.Replace,t),this.visible&&this.logger.flush()}show(e,t){this.logger.flush(),this.proxy.$reveal(this.id,!!(typeof e=="boolean"?e:t))}hide(){this.proxy.$close(this.id)}log(e,t){this.offset+=z.fromString(t).byteLength,MM(this.logger,e,t),this.visible&&(this.logger.flush(),this.proxy.$update(this.id,ad.Append))}},vB=class extends IT{appendLine(e){this.append(e)}},vy=class{constructor(t,i,r,s,n,o){this.initData=i,this.extHostFileSystem=r,this.extHostFileSystemInfo=s,this.loggerService=n,this.logService=o,this.extensionLogDirectoryPromise=new Map,this.namePool=1,this.channels=new Map,this.visibleChannelId=null,this.proxy=t.getProxy(Q.MainThreadOutputService),this.outputsLocation=this.extHostFileSystemInfo.extUri.joinPath(i.logsLocation,`output_logging_${$W(new Date).replace(/-|:|\.\d+Z$/g,"")}`)}$setVisibleChannel(t){this.visibleChannelId=t;for(const[i,r]of this.channels)r.visible=i===this.visibleChannelId}createOutputChannel(t,i,r){if(t=t.trim(),!t)throw new Error("illegal argument `name`. must not be falsy");const s=typeof i=="object"&&i.log,n=Oe(i)?i:void 0;if(Oe(n)&&!n.trim())throw new Error("illegal argument `languageId`. must not be empty");let o;const a=this.initData.environment.extensionLogLevel?.find(([u])=>qe.equals(r.identifier,u))?.[1];a&&(o=HM(a));const l=new oe,c=s?this.doCreateLogOutputChannel(t,o,r,l):this.doCreateOutputChannel(t,n,r,l);return c.then(u=>{this.channels.set(u.id,u),u.visible=u.id===this.visibleChannelId,l.add(ie(()=>this.channels.delete(u.id)))}),s?this.createExtHostLogOutputChannel(t,o??this.logService.getLevel(),c,l):this.createExtHostOutputChannel(t,c,l)}async doCreateOutputChannel(t,i,r,s){this.outputDirectoryPromise||(this.outputDirectoryPromise=this.extHostFileSystem.value.createDirectory(this.outputsLocation).then(()=>this.outputsLocation));const n=await this.outputDirectoryPromise,o=this.extHostFileSystemInfo.extUri.joinPath(n,`${this.namePool++}-${t.replace(/[\\/:\*\?"<>\|]/g,"")}.log`),a=s.add(this.loggerService.createLogger(o,{logLevel:"always",donotRotate:!0,donotUseFormatters:!0,hidden:!0})),l=await this.proxy.$register(t,o,i,r.identifier.value);return s.add(ie(()=>this.loggerService.deregisterLogger(o))),new IT(l,t,a,this.proxy,r)}async doCreateLogOutputChannel(t,i,r,s){const n=await this.createExtensionLogDirectory(r),o=t.replace(/[\\/:\*\?"<>\|]/g,""),a=this.extHostFileSystemInfo.extUri.joinPath(n,`${o}.log`),l=`${r.identifier.value}.${o}`,c=s.add(this.loggerService.createLogger(a,{id:l,name:t,logLevel:i,extensionId:r.identifier.value}));return s.add(ie(()=>this.loggerService.deregisterLogger(a))),new vB(l,t,c,this.proxy,r)}createExtensionLogDirectory(t){let i=this.extensionLogDirectoryPromise.get(t.identifier.value);if(!i){const r=t.identifier.value.replace(/[\\/:\*\?"<>\|]/g,"_"),s=this.extHostFileSystemInfo.extUri.joinPath(this.initData.logsLocation,r);this.extensionLogDirectoryPromise.set(t.identifier.value,i=(async()=>{try{await this.extHostFileSystem.value.createDirectory(s)}catch(n){if(Zh(n)!==de.FileExists)throw n}return s})())}return i}createExtHostOutputChannel(t,i,r){const s=()=>{if(r.isDisposed)throw new Error("Channel has been closed")};return i.then(n=>r.add(n)),{get name(){return t},append(n){s(),i.then(o=>o.append(n))},appendLine(n){s(),i.then(o=>o.appendLine(n))},clear(){s(),i.then(n=>n.clear())},replace(n){s(),i.then(o=>o.replace(n))},show(n,o){s(),i.then(a=>a.show(n,o))},hide(){s(),i.then(n=>n.hide())},dispose(){r.dispose()}}}createExtHostLogOutputChannel(t,i,r,s){const n=()=>{if(s.isDisposed)throw new Error("Channel has been closed")},o=s.add(new D);function a(l){i=l,o.fire(l)}return r.then(l=>{l.logLevel!==i&&a(l.logLevel),s.add(l.onDidChangeLogLevel(c=>a(c)))}),{...this.createExtHostOutputChannel(t,r,s),get logLevel(){return i},onDidChangeLogLevel:o.event,trace(l,...c){n(),r.then(u=>u.trace(l,...c))},debug(l,...c){n(),r.then(u=>u.debug(l,...c))},info(l,...c){n(),r.then(u=>u.info(l,...c))},warn(l,...c){n(),r.then(u=>u.warn(l,...c))},error(l,...c){n(),r.then(u=>u.error(l,...c))}}}};vy=__decorate([__param(0,Pe),__param(1,zt),__param(2,td),__param(3,Ma),__param(4,La),__param(5,ke)],vy);var PT=q("IExtHostOutputService"),ld,_y=class{static{ld=this}static{this._handlePool=0}static{this._maxEventSize=250}constructor(t,i){this._logService=i,this._provider=new Map,this._proxy=t.getProxy(Q.MainThreadDecorations)}registerFileDecorationProvider(t,i){const r=ld._handlePool++;this._provider.set(r,{provider:t,extensionDescription:i}),this._proxy.$registerDecorationProvider(r,i.identifier.value);const s=t.onDidChangeFileDecorations&&t.onDidChangeFileDecorations(n=>{if(!n){this._proxy.$onDidChange(r,null);return}const o=er(n);if(o.length<=ld._maxEventSize){this._proxy.$onDidChange(r,o);return}this._logService.warn("[Decorations] CAPPING events from decorations provider",i.identifier.value,o.length);const a=o.map(u=>({uri:u,rank:qL(u.path,"/")})),l=FR(a,(u,d)=>u.rank-d.rank||oo(u.uri.path,d.uri.path)),c=[];e:for(const u of l){let d;for(const f of u){const p=Bi(f.uri.path);if(d!==p&&(d=p,c.push(f.uri)>=ld._maxEventSize))break e}}this._proxy.$onDidChange(r,c)});return new Ie(()=>{s?.dispose(),this._proxy.$unregisterDecorationProvider(r),this._provider.delete(r)})}async $provideDecorations(t,i,r){if(!this._provider.has(t))return Object.create(null);const s=Object.create(null),{provider:n,extensionDescription:o}=this._provider.get(t);return await Promise.all(i.map(async a=>{try{const{uri:l,id:c}=a,u=await Promise.resolve(n.provideFileDecoration(b.revive(l),r));if(!u)return;try{r0.validate(u),u.badge&&typeof u.badge!="string"&&M(o,"codiconDecoration"),s[c]=[u.propagate,u.tooltip,u.badge,u.color]}catch(d){this._logService.warn(`INVALID decoration from extension '${o.identifier.value}': ${d}`)}}catch(l){this._logService.error(l)}})),s}};_y=ld=__decorate([__param(0,Pe),__param(1,ke)],_y);var TT=q("IExtHostDecorations"),_B=class{constructor(e){this.values=e,this.prefixSum=new Uint32Array(e.length),this.prefixSumValidIndex=new Int32Array(1),this.prefixSumValidIndex[0]=-1}getCount(){return this.values.length}insertValues(e,t){e=Ul(e);const i=this.values,r=this.prefixSum,s=t.length;return s===0?!1:(this.values=new Uint32Array(i.length+s),this.values.set(i.subarray(0,e),0),this.values.set(i.subarray(e),e+s),this.values.set(t,e),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSum=new Uint32Array(this.values.length),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(r.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}setValue(e,t){return e=Ul(e),t=Ul(t),this.values[e]===t?!1:(this.values[e]=t,e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),!0)}removeValues(e,t){e=Ul(e),t=Ul(t);const i=this.values,r=this.prefixSum;if(e>=i.length)return!1;const s=i.length-e;return t>=s&&(t=s),t===0?!1:(this.values=new Uint32Array(i.length-t),this.values.set(i.subarray(0,e),0),this.values.set(i.subarray(e+t),e),this.prefixSum=new Uint32Array(this.values.length),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(r.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}getTotalSum(){return this.values.length===0?0:this._getPrefixSum(this.values.length-1)}getPrefixSum(e){return e<0?0:(e=Ul(e),this._getPrefixSum(e))}_getPrefixSum(e){if(e<=this.prefixSumValidIndex[0])return this.prefixSum[e];let t=this.prefixSumValidIndex[0]+1;t===0&&(this.prefixSum[0]=this.values[0],t++),e>=this.values.length&&(e=this.values.length-1);for(let i=t;i<=e;i++)this.prefixSum[i]=this.prefixSum[i-1]+this.values[i];return this.prefixSumValidIndex[0]=Math.max(this.prefixSumValidIndex[0],e),this.prefixSum[e]}getIndexOf(e){e=Math.floor(e),this.getTotalSum();let t=0,i=this.values.length-1,r=0,s=0,n=0;for(;t<=i;)if(r=t+(i-t)/2|0,s=this.prefixSum[r],n=s-this.values[r],e<n)i=r-1;else if(e>=s)t=r+1;else break;return new wB(r,e-n)}},wB=class{constructor(e,t){this.index=e,this.remainder=t,this._prefixSumIndexOfResultBrand=void 0,this.index=e,this.remainder=t}},yB=class{constructor(e,t,i,r){this._uri=e,this._lines=t,this._eol=i,this._versionId=r,this._lineStarts=null,this._cachedTextValue=null}dispose(){this._lines.length=0}get version(){return this._versionId}getText(){return this._cachedTextValue===null&&(this._cachedTextValue=this._lines.join(this._eol)),this._cachedTextValue}onEvents(e){e.eol&&e.eol!==this._eol&&(this._eol=e.eol,this._lineStarts=null);const t=e.changes;for(const i of t)this._acceptDeleteRange(i.range),this._acceptInsertText(new sr(i.range.startLineNumber,i.range.startColumn),i.text);this._versionId=e.versionId,this._cachedTextValue=null}_ensureLineStarts(){if(!this._lineStarts){const e=this._eol.length,t=this._lines.length,i=new Uint32Array(t);for(let r=0;r<t;r++)i[r]=this._lines[r].length+e;this._lineStarts=new _B(i)}}_setLineText(e,t){this._lines[e]=t,this._lineStarts&&this._lineStarts.setValue(e,this._lines[e].length+this._eol.length)}_acceptDeleteRange(e){if(e.startLineNumber===e.endLineNumber){if(e.startColumn===e.endColumn)return;this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.startLineNumber-1].substring(e.endColumn-1));return}this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.endLineNumber-1].substring(e.endColumn-1)),this._lines.splice(e.startLineNumber,e.endLineNumber-e.startLineNumber),this._lineStarts&&this._lineStarts.removeValues(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t){if(t.length===0)return;const i=Wx(t);if(i.length===1){this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+i[0]+this._lines[e.lineNumber-1].substring(e.column-1));return}i[i.length-1]+=this._lines[e.lineNumber-1].substring(e.column-1),this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+i[0]);const r=new Uint32Array(i.length-1);for(let s=1;s<i.length;s++)this._lines.splice(e.lineNumber+s-1,0,i[s]),r[s-1]=i[s].length+this._eol.length;this._lineStarts&&this._lineStarts.insertValues(e.lineNumber,r)}},wy=new Map;function bB(e,t){t?wy.set(e,t):wy.delete(e)}function SB(e){return wy.get(e)}var xB=class extends yB{constructor(e,t,i,r,s,n,o,a){super(t,i,r,s),this._proxy=e,this._languageId=n,this._isDirty=o,this._encoding=a,this._isDisposed=!1}dispose(){vi(!this._isDisposed),this._isDisposed=!0,this._isDirty=!1}equalLines(e){return Er(this._lines,e)}get document(){if(!this._document){const e=this;this._document={get uri(){return e._uri},get fileName(){return e._uri.fsPath},get isUntitled(){return e._uri.scheme===V.untitled},get languageId(){return e._languageId},get version(){return e._versionId},get isClosed(){return e._isDisposed},get isDirty(){return e._isDirty},get encoding(){return e._encoding},save(){return e._save()},getText(t){return t?e._getTextInRange(t):e.getText()},get eol(){return e._eol===`
`?Fr.LF:Fr.CRLF},get lineCount(){return e._lines.length},lineAt(t){return e._lineAt(t)},offsetAt(t){return e._offsetAt(t)},positionAt(t){return e._positionAt(t)},validateRange(t){return e._validateRange(t)},validatePosition(t){return e._validatePosition(t)},getWordRangeAtPosition(t,i){return e._getWordRangeAtPosition(t,i)},[Symbol.for("debug.description")](){return`TextDocument(${e._uri.toString()})`}}}return Object.freeze(this._document)}_acceptLanguageId(e){vi(!this._isDisposed),this._languageId=e}_acceptIsDirty(e){vi(!this._isDisposed),this._isDirty=e}_acceptEncoding(e){vi(!this._isDisposed),this._encoding=e}_save(){return this._isDisposed?Promise.reject(new Error("Document has been closed")):this._proxy.$trySaveDocument(this._uri)}_getTextInRange(e){const t=this._validateRange(e);if(t.isEmpty)return"";if(t.isSingleLine)return this._lines[t.start.line].substring(t.start.character,t.end.character);const i=this._eol,r=t.start.line,s=t.end.line,n=[];n.push(this._lines[r].substring(t.start.character));for(let o=r+1;o<s;o++)n.push(this._lines[o]);return n.push(this._lines[s].substring(0,t.end.character)),n.join(i)}_lineAt(e){let t;if(e instanceof Te?t=e.line:typeof e=="number"&&(t=e),typeof t!="number"||t<0||t>=this._lines.length||Math.floor(t)!==t)throw new Error("Illegal value for `line`");return new EB(t,this._lines[t],t===this._lines.length-1)}_offsetAt(e){return e=this._validatePosition(e),this._ensureLineStarts(),this._lineStarts.getPrefixSum(e.line-1)+e.character}_positionAt(e){e=Math.floor(e),e=Math.max(0,e),this._ensureLineStarts();const t=this._lineStarts.getIndexOf(e),i=this._lines[t.index].length;return new Te(t.index,Math.min(t.remainder,i))}_validateRange(e){if(!(e instanceof Se))throw new Error("Invalid argument");const t=this._validatePosition(e.start),i=this._validatePosition(e.end);return t===e.start&&i===e.end?e:new Se(t.line,t.character,i.line,i.character)}_validatePosition(e){if(!(e instanceof Te))throw new Error("Invalid argument");if(this._lines.length===0)return e.with(0,0);let{line:t,character:i}=e,r=!1;if(t<0)t=0,i=0,r=!0;else if(t>=this._lines.length)t=this._lines.length-1,i=this._lines[t].length,r=!0;else{const s=this._lines[t].length;i<0?(i=0,r=!0):i>s&&(i=s,r=!0)}return r?new Te(t,i):e}_getWordRangeAtPosition(e,t){const i=this._validatePosition(e);if(!t)t=SB(this._languageId);else if(Ux(t))throw new Error(`[getWordRangeAtPosition]: ignoring custom regexp '${t.source}' because it matches the empty string.`);const r=pC(i.character+1,hC(t),this._lines[i.line],0);if(r)return new Se(i.line,r.startColumn-1,i.line,r.endColumn-1)}},EB=class{constructor(e,t,i){this._line=e,this._text=t,this._isLastLine=i}get lineNumber(){return this._line}get text(){return this._text}get range(){return new Se(this._line,0,this._line,this._text.length)}get rangeIncludingLineBreak(){return this._isLastLine?this.range:new Se(this._line,0,this._line+1,0)}get firstNonWhitespaceCharacterIndex(){return/^(\s*)/.exec(this._text)[1].length}get isEmptyOrWhitespace(){return this.firstNonWhitespaceCharacterIndex===this._text.length}},Og=class{constructor(e){this._prefix=e,this._lastId=0}nextId(){return this._prefix+ ++this._lastId}},Wte=new Og("id#"),CB=class D8{static{this._Keys=new Og("TextEditorDecorationType")}constructor(t,i,r){const s=D8._Keys.nextId();t.$registerTextEditorDecorationType(i.identifier,s,O0.from(r)),this.value=Object.freeze({key:s,dispose(){t.$removeTextEditorDecorationType(s)}})}},DB=class{constructor(e,t){this._collectedEdits=[],this._setEndOfLine=void 0,this._finalized=!1,this._document=e,this._documentVersionId=e.version,this._undoStopBefore=t.undoStopBefore,this._undoStopAfter=t.undoStopAfter}finalize(){return this._finalized=!0,{documentVersionId:this._documentVersionId,edits:this._collectedEdits,setEndOfLine:this._setEndOfLine,undoStopBefore:this._undoStopBefore,undoStopAfter:this._undoStopAfter}}_throwIfFinalized(){if(this._finalized)throw new Error("Edit is only valid while callback runs")}replace(e,t){this._throwIfFinalized();let i=null;if(e instanceof Te)i=new Se(e,e);else if(e instanceof Se)i=e;else throw new Error("Unrecognized location");this._pushEdit(i,t,!1)}insert(e,t){this._throwIfFinalized(),this._pushEdit(new Se(e,e),t,!0)}delete(e){this._throwIfFinalized();let t=null;if(e instanceof Se)t=e;else throw new Error("Unrecognized location");this._pushEdit(t,null,!0)}_pushEdit(e,t,i){const r=this._document.validateRange(e);this._collectedEdits.push({range:r,text:t,forceMoveMarkers:i})}setEndOfLine(e){if(this._throwIfFinalized(),e!==Fr.LF&&e!==Fr.CRLF)throw De("endOfLine");this._setEndOfLine=e}},kB=class{constructor(e,t,i,r){this._proxy=e,this._id=t,this._accept(i),this._logService=r;const s=this;this.value={get tabSize(){return s._tabSize},set tabSize(n){s._setTabSize(n)},get indentSize(){return s._indentSize},set indentSize(n){s._setIndentSize(n)},get insertSpaces(){return s._insertSpaces},set insertSpaces(n){s._setInsertSpaces(n)},get cursorStyle(){return s._cursorStyle},set cursorStyle(n){s._setCursorStyle(n)},get lineNumbers(){return s._lineNumbers},set lineNumbers(n){s._setLineNumbers(n)}}}_accept(e){this._tabSize=e.tabSize,this._indentSize=e.indentSize,this._originalIndentSize=e.originalIndentSize,this._insertSpaces=e.insertSpaces,this._cursorStyle=e.cursorStyle,this._lineNumbers=El.to(e.lineNumbers)}_validateTabSize(e){if(e==="auto")return"auto";if(typeof e=="number"){const t=Math.floor(e);return t>0?t:null}if(typeof e=="string"){const t=parseInt(e,10);return isNaN(t)?null:t>0?t:null}return null}_setTabSize(e){const t=this._validateTabSize(e);if(t!==null){if(typeof t=="number"){if(this._tabSize===t)return;this._tabSize=t}this._warnOnError("setTabSize",this._proxy.$trySetOptions(this._id,{tabSize:t}))}}_validateIndentSize(e){if(e==="tabSize")return"tabSize";if(typeof e=="number"){const t=Math.floor(e);return t>0?t:null}if(typeof e=="string"){const t=parseInt(e,10);return isNaN(t)?null:t>0?t:null}return null}_setIndentSize(e){const t=this._validateIndentSize(e);if(t!==null){if(typeof t=="number"){if(this._originalIndentSize===t)return;this._indentSize=t,this._originalIndentSize=t}this._warnOnError("setIndentSize",this._proxy.$trySetOptions(this._id,{indentSize:t}))}}_validateInsertSpaces(e){return e==="auto"?"auto":e==="false"?!1:!!e}_setInsertSpaces(e){const t=this._validateInsertSpaces(e);if(typeof t=="boolean"){if(this._insertSpaces===t)return;this._insertSpaces=t}this._warnOnError("setInsertSpaces",this._proxy.$trySetOptions(this._id,{insertSpaces:t}))}_setCursorStyle(e){this._cursorStyle!==e&&(this._cursorStyle=e,this._warnOnError("setCursorStyle",this._proxy.$trySetOptions(this._id,{cursorStyle:e})))}_setLineNumbers(e){this._lineNumbers!==e&&(this._lineNumbers=e,this._warnOnError("setLineNumbers",this._proxy.$trySetOptions(this._id,{lineNumbers:El.from(e)})))}assign(e){const t={};let i=!1;if(typeof e.tabSize<"u"){const r=this._validateTabSize(e.tabSize);r==="auto"?(i=!0,t.tabSize=r):typeof r=="number"&&this._tabSize!==r&&(this._tabSize=r,i=!0,t.tabSize=r)}if(typeof e.indentSize<"u"){const r=this._validateIndentSize(e.indentSize);r==="tabSize"?(i=!0,t.indentSize=r):typeof r=="number"&&this._originalIndentSize!==r&&(this._indentSize=r,this._originalIndentSize=r,i=!0,t.indentSize=r)}if(typeof e.insertSpaces<"u"){const r=this._validateInsertSpaces(e.insertSpaces);r==="auto"?(i=!0,t.insertSpaces=r):this._insertSpaces!==r&&(this._insertSpaces=r,i=!0,t.insertSpaces=r)}typeof e.cursorStyle<"u"&&this._cursorStyle!==e.cursorStyle&&(this._cursorStyle=e.cursorStyle,i=!0,t.cursorStyle=e.cursorStyle),typeof e.lineNumbers<"u"&&this._lineNumbers!==e.lineNumbers&&(this._lineNumbers=e.lineNumbers,i=!0,t.lineNumbers=El.from(e.lineNumbers)),i&&this._warnOnError("setOptions",this._proxy.$trySetOptions(this._id,t))}_warnOnError(e,t){t.catch(i=>{this._logService.warn(`ExtHostTextEditorOptions '${e}' failed:'`),this._logService.warn(i)})}},IB=class{constructor(e,t,i,r,s,n,o,a){this.id=e,this._proxy=t,this._logService=i,this._disposed=!1,this._hasDecorationsForKey=new Set,this._selections=s,this._options=new kB(this._proxy,this.id,n,i),this._visibleRanges=o,this._viewColumn=a;const l=this;this.value=Object.freeze({get document(){return r.value},set document(c){throw new Zn("document")},get selection(){return l._selections&&l._selections[0]},set selection(c){if(!(c instanceof Bs))throw De("selection");l._selections=[c],l._trySetSelection()},get selections(){return l._selections},set selections(c){if(!Array.isArray(c)||c.some(u=>!(u instanceof Bs)))throw De("selections");l._selections=c,l._trySetSelection()},get visibleRanges(){return l._visibleRanges},set visibleRanges(c){throw new Zn("visibleRanges")},get diffInformation(){return l._diffInformation},get options(){return l._options.value},set options(c){l._disposed||l._options.assign(c)},get viewColumn(){return l._viewColumn},set viewColumn(c){throw new Zn("viewColumn")},edit(c,u={undoStopBefore:!0,undoStopAfter:!0}){if(l._disposed)return Promise.reject(new Error("TextEditor#edit not possible on closed editors"));const d=new DB(r.value,u);return c(d),l._applyEdit(d)},insertSnippet(c,u,d={undoStopBefore:!0,undoStopAfter:!0}){if(l._disposed)return Promise.reject(new Error("TextEditor#insertSnippet not possible on closed editors"));let f;if(!u||Array.isArray(u)&&u.length===0)f=l._selections.map(p=>F.from(p));else if(u instanceof Te){const{lineNumber:p,column:g}=Qe.from(u);f=[{startLineNumber:p,startColumn:g,endLineNumber:p,endColumn:g}]}else if(u instanceof Se)f=[F.from(u)];else{f=[];for(const p of u)if(p instanceof Se)f.push(F.from(p));else{const{lineNumber:g,column:v}=Qe.from(p);f.push({startLineNumber:g,startColumn:v,endLineNumber:g,endColumn:v})}}return d.keepWhitespace===void 0&&(d.keepWhitespace=!1),t.$tryInsertSnippet(e,r.value.version,c.value,f,d)},setDecorations(c,u){const d=u.length===0;d&&!l._hasDecorationsForKey.has(c.key)||(d?l._hasDecorationsForKey.delete(c.key):l._hasDecorationsForKey.add(c.key),l._runOnProxy(()=>{if(X4(u))return t.$trySetDecorations(e,c.key,bU(u));{const f=new Array(4*u.length);for(let p=0,g=u.length;p<g;p++){const v=u[p];f[4*p]=v.start.line+1,f[4*p+1]=v.start.character+1,f[4*p+2]=v.end.line+1,f[4*p+3]=v.end.character+1}return t.$trySetDecorationsFast(e,c.key,f)}}))},revealRange(c,u){l._runOnProxy(()=>t.$tryRevealRange(e,F.from(c),u||Jf.Default))},show(c){t.$tryShowEditor(e,jt.from(c))},hide(){t.$tryHideEditor(e)},[Symbol.for("debug.description")](){return`TextEditor(${this.document.uri.toString()})`}})}dispose(){vi(!this._disposed),this._disposed=!0}_acceptOptions(e){vi(!this._disposed),this._options._accept(e)}_acceptVisibleRanges(e){vi(!this._disposed),this._visibleRanges=e}_acceptViewColumn(e){vi(!this._disposed),this._viewColumn=e}_acceptSelections(e){vi(!this._disposed),this._selections=e}_acceptDiffInformation(e){vi(!this._disposed),this._diffInformation=e}async _trySetSelection(){const e=this._selections.map(Ur.from);return await this._runOnProxy(()=>this._proxy.$trySetSelections(this.id,e)),this.value}_applyEdit(e){const t=e.finalize();if(t.edits.length===0&&!t.setEndOfLine)return Promise.resolve(!0);const i=t.edits.map(s=>s.range);i.sort((s,n)=>s.end.line===n.end.line?s.end.character===n.end.character?s.start.line===n.start.line?s.start.character-n.start.character:s.start.line-n.start.line:s.end.character-n.end.character:s.end.line-n.end.line);for(let s=0,n=i.length-1;s<n;s++){const o=i[s].end;if(i[s+1].start.isBefore(o))return Promise.reject(new Error("Overlapping ranges are not allowed!"))}const r=t.edits.map(s=>({range:F.from(s.range),text:s.text,forceMoveMarkers:s.forceMoveMarkers}));return this._proxy.$tryApplyEdits(this.id,t.documentVersionId,r,{setEndOfLine:typeof t.setEndOfLine=="number"?Cl.from(t.setEndOfLine):void 0,undoStopBefore:t.undoStopBefore,undoStopAfter:t.undoStopAfter})}_runOnProxy(e){return this._disposed?(this._logService.warn("TextEditor is closed/disposed"),Promise.resolve(void 0)):e().then(()=>this,t=>(t instanceof Error&&t.name==="DISPOSED"||this._logService.warn(t),null))}},PB=class{constructor(e){this.value=e,this._count=0}ref(){this._count++}unref(){return--this._count===0}},yy=class{constructor(t,i){this._extHostRpc=t,this._logService=i,this._activeEditorId=null,this._editors=new Map,this._documents=new Vt,this._onDidAddDocuments=new D,this._onDidRemoveDocuments=new D,this._onDidChangeVisibleTextEditors=new D,this._onDidChangeActiveTextEditor=new D,this.onDidAddDocuments=this._onDidAddDocuments.event,this.onDidRemoveDocuments=this._onDidRemoveDocuments.event,this.onDidChangeVisibleTextEditors=this._onDidChangeVisibleTextEditors.event,this.onDidChangeActiveTextEditor=this._onDidChangeActiveTextEditor.event}$acceptDocumentsAndEditorsDelta(t){this.acceptDocumentsAndEditorsDelta(t)}acceptDocumentsAndEditorsDelta(t){const i=[],r=[],s=[];if(t.removedDocuments)for(const n of t.removedDocuments){const o=b.revive(n),a=this._documents.get(o);a?.unref()&&(this._documents.delete(o),i.push(a.value))}if(t.addedDocuments)for(const n of t.addedDocuments){const o=b.revive(n.uri);let a=this._documents.get(o);if(a&&o.scheme!==V.vscodeNotebookCell&&o.scheme!==V.vscodeInteractiveInput)throw new Error(`document '${o} already exists!'`);a||(a=new PB(new xB(this._extHostRpc.getProxy(Q.MainThreadDocuments),o,n.lines,n.EOL,n.versionId,n.languageId,n.isDirty,n.encoding)),this._documents.set(o,a),r.push(a.value)),a.ref()}if(t.removedEditors)for(const n of t.removedEditors){const o=this._editors.get(n);this._editors.delete(n),o&&s.push(o)}if(t.addedEditors)for(const n of t.addedEditors){const o=b.revive(n.documentUri);vi(this._documents.has(o),`document '${o}' does not exist`),vi(!this._editors.has(n.id),`editor '${n.id}' already exists!`);const a=this._documents.get(o).value,l=new IB(n.id,this._extHostRpc.getProxy(Q.MainThreadTextEditors),this._logService,new Si(()=>a.document),n.selections.map(Ur.to),n.options,n.visibleRanges.map(c=>F.to(c)),typeof n.editorPosition=="number"?jt.to(n.editorPosition):void 0);this._editors.set(n.id,l)}t.newActiveEditor!==void 0&&(vi(t.newActiveEditor===null||this._editors.has(t.newActiveEditor),`active editor '${t.newActiveEditor}' does not exist`),this._activeEditorId=t.newActiveEditor),Cr(i),Cr(s),t.removedDocuments&&this._onDidRemoveDocuments.fire(i),t.addedDocuments&&this._onDidAddDocuments.fire(r),(t.removedEditors||t.addedEditors)&&this._onDidChangeVisibleTextEditors.fire(this.allEditors().map(n=>n.value)),t.newActiveEditor!==void 0&&this._onDidChangeActiveTextEditor.fire(this.activeEditor())}getDocument(t){return this._documents.get(t)?.value}allDocuments(){return ai.map(this._documents.values(),t=>t.value)}getEditor(t){return this._editors.get(t)}activeEditor(t){if(!this._activeEditorId)return;const i=this._editors.get(this._activeEditorId);return t?i:i?.value}allEditors(){return[...this._editors.values()]}};yy=__decorate([__param(0,Pe),__param(1,ke)],yy);var ia=q("IExtHostDocumentsAndEditors"),cd=q("IExtHostApiDeprecationService"),by=class{constructor(t,i){this._extHostLogService=i,this._reportedUsages=new Set,this._telemetryShape=t.getProxy(Q.MainThreadTelemetry)}report(t,i,r){const s=this.getUsageKey(t,i);this._reportedUsages.has(s)||(this._reportedUsages.add(s),i.isUnderDevelopment&&this._extHostLogService.warn(`[Deprecation Warning] '${t}' is deprecated. ${r}`),this._telemetryShape.$publicLog2("extHostDeprecatedApiUsage",{extensionId:i.identifier.value,apiId:t}))}getUsageKey(t,i){return`${t}-${i.identifier.value}`}};by=__decorate([__param(0,Pe),__param(1,ke)],by);var zte=Object.freeze(new class{report(e,t,i){}}),TB={activeComment:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.activeComment.d.ts"},aiRelatedInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiRelatedInformation.d.ts"},aiSettingsSearch:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts"},aiTextSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiTextSearchProvider.d.ts",version:2},authLearnMore:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authLearnMore.d.ts"},authSession:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authSession.d.ts"},canonicalUriProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.canonicalUriProvider.d.ts"},chatEditing:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatEditing.d.ts"},chatParticipantAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts"},chatParticipantPrivate:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantPrivate.d.ts",version:9},chatProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatProvider.d.ts"},chatReferenceBinaryData:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatReferenceBinaryData.d.ts"},chatReferenceDiagnostic:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatReferenceDiagnostic.d.ts"},chatStatusItem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatStatusItem.d.ts"},chatTab:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatTab.d.ts"},codeActionAI:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionAI.d.ts"},codeActionRanges:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionRanges.d.ts"},codiconDecoration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codiconDecoration.d.ts"},commentReactor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReactor.d.ts"},commentReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReveal.d.ts"},commentThreadApplicability:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentThreadApplicability.d.ts"},commentingRangeHint:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentingRangeHint.d.ts"},commentsDraftState:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentsDraftState.d.ts"},contribAccessibilityHelpContent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribAccessibilityHelpContent.d.ts"},contribCommentEditorActionsMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentEditorActionsMenu.d.ts"},contribCommentPeekContext:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentPeekContext.d.ts"},contribCommentThreadAdditionalMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentThreadAdditionalMenu.d.ts"},contribCommentsViewThreadMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentsViewThreadMenus.d.ts"},contribDebugCreateConfiguration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDebugCreateConfiguration.d.ts"},contribDiffEditorGutterToolBarMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDiffEditorGutterToolBarMenus.d.ts"},contribEditSessions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditSessions.d.ts"},contribEditorContentMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditorContentMenu.d.ts"},contribLabelFormatterWorkspaceTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribLabelFormatterWorkspaceTooltip.d.ts"},contribMenuBarHome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMenuBarHome.d.ts"},contribMergeEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMergeEditorMenus.d.ts"},contribMultiDiffEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMultiDiffEditorMenus.d.ts"},contribNotebookStaticPreloads:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribNotebookStaticPreloads.d.ts"},contribRemoteHelp:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribRemoteHelp.d.ts"},contribShareMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribShareMenu.d.ts"},contribSourceControlHistoryItemMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryItemMenu.d.ts"},contribSourceControlHistoryTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryTitleMenu.d.ts"},contribSourceControlInputBoxMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlInputBoxMenu.d.ts"},contribSourceControlTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlTitleMenu.d.ts"},contribStatusBarItems:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribStatusBarItems.d.ts"},contribViewContainerTitle:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewContainerTitle.d.ts"},contribViewsRemote:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsRemote.d.ts"},contribViewsWelcome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsWelcome.d.ts"},customEditorMove:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.customEditorMove.d.ts"},debugVisualization:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.debugVisualization.d.ts"},defaultChatParticipant:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts",version:4},diffCommand:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffCommand.d.ts"},diffContentOptions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffContentOptions.d.ts"},documentFiltersExclusive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentFiltersExclusive.d.ts"},editCode:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editCode.d.ts"},editSessionIdentityProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editSessionIdentityProvider.d.ts"},editorBottomWidget:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorBottomWidget.d.ts"},editorHoverVerbosityLevel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorHoverVerbosityLevel.d.ts"},editorInsets:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorInsets.d.ts"},embeddings:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.embeddings.d.ts"},extensionRuntime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionRuntime.d.ts"},extensionsAny:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionsAny.d.ts"},externalUriOpener:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.externalUriOpener.d.ts"},fileSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProvider.d.ts"},fileSearchProvider2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProvider2.d.ts"},findFiles2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findFiles2.d.ts",version:2},findTextInFiles:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFiles.d.ts"},findTextInFiles2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFiles2.d.ts"},fsChunks:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fsChunks.d.ts"},idToken:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.idToken.d.ts"},inlineChat:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineChat.d.ts"},inlineCompletionsAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts"},inlineDiffWidget:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineDiffWidget.d.ts"},inlineEdit:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineEdit.d.ts"},interactive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactive.d.ts"},interactiveWindow:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactiveWindow.d.ts"},ipc:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.ipc.d.ts"},languageModelCapabilities:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelCapabilities.d.ts"},languageModelDataPart:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelDataPart.d.ts",version:2},languageModelSystem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelSystem.d.ts"},languageStatusText:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageStatusText.d.ts"},mappedEditsProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.mappedEditsProvider.d.ts"},mcpConfigurationProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.mcpConfigurationProvider.d.ts"},multiDocumentHighlightProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.multiDocumentHighlightProvider.d.ts"},nativeWindowHandle:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.nativeWindowHandle.d.ts"},newSymbolNamesProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.newSymbolNamesProvider.d.ts"},notebookCellExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecution.d.ts"},notebookCellExecutionState:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecutionState.d.ts"},notebookControllerAffinityHidden:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookControllerAffinityHidden.d.ts"},notebookDeprecated:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookDeprecated.d.ts"},notebookExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookExecution.d.ts"},notebookKernelSource:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookKernelSource.d.ts"},notebookLiveShare:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookLiveShare.d.ts"},notebookMessaging:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMessaging.d.ts"},notebookMime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMime.d.ts"},notebookReplDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookReplDocument.d.ts"},notebookVariableProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookVariableProvider.d.ts"},portsAttributes:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.portsAttributes.d.ts"},profileContentHandlers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.profileContentHandlers.d.ts"},quickDiffProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickDiffProvider.d.ts"},quickInputButtonLocation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickInputButtonLocation.d.ts"},quickPickItemTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickItemTooltip.d.ts"},quickPickSortByLabel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickSortByLabel.d.ts"},resolvers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.resolvers.d.ts"},scmActionButton:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmActionButton.d.ts"},scmHistoryProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts"},scmMultiDiffEditor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmMultiDiffEditor.d.ts"},scmSelectedProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmSelectedProvider.d.ts"},scmTextDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmTextDocument.d.ts"},scmValidation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmValidation.d.ts"},selectionAction:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.selectionAction.d.ts"},shareProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.shareProvider.d.ts"},speech:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.speech.d.ts"},statusBarItemTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.statusBarItemTooltip.d.ts"},tabInputMultiDiff:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputMultiDiff.d.ts"},tabInputTextMerge:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputTextMerge.d.ts"},taskPresentationGroup:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskPresentationGroup.d.ts"},taskProblemMatcherStatus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskProblemMatcherStatus.d.ts"},telemetry:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.telemetry.d.ts"},terminalChatProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalChatProvider.d.ts"},terminalCompletionProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalCompletionProvider.d.ts"},terminalDataWriteEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDataWriteEvent.d.ts"},terminalDimensions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDimensions.d.ts"},terminalExecuteCommandEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalExecuteCommandEvent.d.ts"},terminalQuickFixProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalQuickFixProvider.d.ts"},terminalSelection:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalSelection.d.ts"},terminalSelectionAction:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalSelectionAction.d.ts"},terminalShellEnv:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalShellEnv.d.ts"},testObserver:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testObserver.d.ts"},testRelatedCode:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testRelatedCode.d.ts"},textEditorDiffInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textEditorDiffInformation.d.ts"},textSearchComplete2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchComplete2.d.ts"},textSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProvider.d.ts"},textSearchProvider2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProvider2.d.ts"},timeline:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.timeline.d.ts"},tokenInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tokenInformation.d.ts"},toolProgress:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.toolProgress.d.ts"},treeViewActiveItem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewActiveItem.d.ts"},treeViewMarkdownMessage:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewMarkdownMessage.d.ts"},treeViewReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewReveal.d.ts"},tunnelFactory:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnelFactory.d.ts"},tunnels:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnels.d.ts"},valueSelectionInQuickPick:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.valueSelectionInQuickPick.d.ts"},workspaceTrust:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.workspaceTrust.d.ts"}},Fg=Object.freeze(TB),Sy=Xt.as(df.JSONContribution),AB=class Ym{static _toSet(t){const i=new mo;for(let r=0,s=t.length;r<s;r++)i.add(t[r].description.identifier);return i}static compute(t,i){if(!t||!t.length)return new Ym(i,[]);if(!i||!i.length)return new Ym([],t);const r=this._toSet(t),s=this._toSet(i),n=i.filter(a=>!r.has(a.description.identifier)),o=t.filter(a=>!s.has(a.description.identifier));return new Ym(n,o)}constructor(t,i){this.added=t,this.removed=i}},RB=class{constructor(e,t,i){this.name=e,this.defaultExtensionKind=t,this.canHandleResolver=i,this._handler=null,this._users=null,this._delta=null}setHandler(e){if(this._handler!==null)throw new Error("Handler already set!");return this._handler=e,this._handle(),{dispose:()=>{this._handler=null}}}acceptUsers(e){this._delta=AB.compute(this._users,e),this._users=e,this._handle()}_handle(){if(!(this._handler===null||this._users===null||this._delta===null))try{this._handler(this._users,this._delta)}catch(e){pt(e)}}},LB={type:"string",enum:["ui","workspace"],enumDescriptions:[h(14079,null),h(14080,null)]},AT="vscode://schemas/vscode-extensions",xy={properties:{engines:{type:"object",description:h(14081,null),properties:{vscode:{type:"string",description:h(14082,null),default:"^1.22.0"}}},publisher:{description:h(14083,null),type:"string"},displayName:{description:h(14084,null),type:"string"},categories:{description:h(14085,null),type:"array",uniqueItems:!0,items:{oneOf:[{type:"string",enum:GC},{type:"string",const:"Languages",deprecationMessage:h(14086,null)}]}},galleryBanner:{type:"object",description:h(14087,null),properties:{color:{description:h(14088,null),type:"string"},theme:{description:h(14089,null),type:"string",enum:["dark","light"]}}},contributes:{description:h(14090,null),type:"object",properties:{},default:{}},preview:{type:"boolean",description:h(14091,null)},enableProposedApi:{type:"boolean",deprecationMessage:h(14092,null)},enabledApiProposals:{markdownDescription:h(14093,null),type:"array",uniqueItems:!0,items:{type:"string",enum:Object.keys(Fg).map(e=>e),markdownEnumDescriptions:Object.values(Fg).map(e=>e.proposal)}},api:{markdownDescription:h(14094,null),type:"string",enum:["none"],enumDescriptions:[h(14095,null)]},activationEvents:{description:h(14096,null),type:"array",items:{type:"string",defaultSnippets:[{label:"onWebviewPanel",description:h(14097,null),body:"onWebviewPanel:viewType"},{label:"onLanguage",description:h(14098,null),body:"onLanguage:${1:languageId}"},{label:"onCommand",description:h(14099,null),body:"onCommand:${2:commandId}"},{label:"onDebug",description:h(14100,null),body:"onDebug"},{label:"onDebugInitialConfigurations",description:h(14101,null),body:"onDebugInitialConfigurations"},{label:"onDebugDynamicConfigurations",description:h(14102,null),body:"onDebugDynamicConfigurations"},{label:"onDebugResolve",description:h(14103,null),body:"onDebugResolve:${6:type}"},{label:"onDebugAdapterProtocolTracker",description:h(14104,null),body:"onDebugAdapterProtocolTracker:${6:type}"},{label:"workspaceContains",description:h(14105,null),body:"workspaceContains:${4:filePattern}"},{label:"onStartupFinished",description:h(14106,null),body:"onStartupFinished"},{label:"onTaskType",description:h(14107,null),body:"onTaskType:${1:taskType}"},{label:"onFileSystem",description:h(14108,null),body:"onFileSystem:${1:scheme}"},{label:"onEditSession",description:h(14109,null),body:"onEditSession:${1:scheme}"},{label:"onSearch",description:h(14110,null),body:"onSearch:${7:scheme}"},{label:"onView",body:"onView:${5:viewId}",description:h(14111,null)},{label:"onUri",body:"onUri",description:h(14112,null)},{label:"onOpenExternalUri",body:"onOpenExternalUri",description:h(14113,null)},{label:"onCustomEditor",body:"onCustomEditor:${9:viewType}",description:h(14114,null)},{label:"onNotebook",body:"onNotebook:${1:type}",description:h(14115,null)},{label:"onAuthenticationRequest",body:"onAuthenticationRequest:${11:authenticationProviderId}",description:h(14116,null)},{label:"onRenderer",description:h(14117,null),body:"onRenderer:${11:rendererId}"},{label:"onTerminalProfile",body:"onTerminalProfile:${1:terminalId}",description:h(14118,null)},{label:"onTerminalQuickFixRequest",body:"onTerminalQuickFixRequest:${1:quickFixId}",description:h(14119,null)},{label:"onWalkthrough",body:"onWalkthrough:${1:walkthroughID}",description:h(14120,null)},{label:"onIssueReporterOpened",body:"onIssueReporterOpened",description:h(14121,null)},{label:"onChatParticipant",body:"onChatParticipant:${1:participantId}",description:h(14122,null)},{label:"onLanguageModelTool",body:"onLanguageModelTool:${1:toolId}",description:h(14123,null)},{label:"onTerminalCompletionsRequested",body:"onTerminalCompletionsRequested",description:h(14124,null)},{label:"onMcpCollection",description:h(14125,null),body:"onMcpCollection:${2:collectionId}"},{label:"*",description:h(14126,null),body:"*"}]}},badges:{type:"array",description:h(14127,null),items:{type:"object",required:["url","href","description"],properties:{url:{type:"string",description:h(14128,null)},href:{type:"string",description:h(14129,null)},description:{type:"string",description:h(14130,null)}}}},markdown:{type:"string",description:h(14131,null),enum:["github","standard"],default:"github"},qna:{default:"marketplace",description:h(14132,null),anyOf:[{type:["string","boolean"],enum:["marketplace",!1]},{type:"string"}]},extensionDependencies:{description:h(14133,null),type:"array",uniqueItems:!0,items:{type:"string",pattern:m_}},extensionPack:{description:h(14134,null),type:"array",uniqueItems:!0,items:{type:"string",pattern:m_}},extensionKind:{description:h(14135,null),type:"array",items:LB,default:["workspace"],defaultSnippets:[{body:["ui"],description:h(14136,null)},{body:["workspace"],description:h(14137,null)},{body:["ui","workspace"],description:h(14138,null)},{body:["workspace","ui"],description:h(14139,null)},{body:[],description:h(14140,null)}]},capabilities:{description:h(14141,null),type:"object",properties:{virtualWorkspaces:{description:h(14142,null),type:["boolean","object"],defaultSnippets:[{label:"limited",body:{supported:"${1:limited}",description:"${2}"}},{label:"false",body:{supported:!1,description:"${2}"}}],default:(!0).valueOf,properties:{supported:{markdownDescription:h(14143,null),type:["string","boolean"],enum:["limited",!0,!1],enumDescriptions:[h(14144,null),h(14145,null),h(14146,null)]},description:{type:"string",markdownDescription:h(14147,null)}}},untrustedWorkspaces:{description:h(14148,null),type:"object",required:["supported"],defaultSnippets:[{body:{supported:"${1:limited}",description:"${2}"}}],properties:{supported:{markdownDescription:h(14149,null),type:["string","boolean"],enum:["limited",!0,!1],enumDescriptions:[h(14150,null),h(14151,null),h(14152,null)]},restrictedConfigurations:{description:h(14153,null),type:"array",items:{type:"string"}},description:{type:"string",markdownDescription:h(14154,null)}}}}},sponsor:{description:h(14155,null),type:"object",defaultSnippets:[{body:{url:"${1:https:}"}}],properties:{url:{description:h(14156,null),type:"string"}}},scripts:{type:"object",properties:{"vscode:prepublish":{description:h(14157,null),type:"string"},"vscode:uninstall":{description:h(14158,null),type:"string"}}},icon:{type:"string",description:h(14159,null)},l10n:{type:"string",description:h(14160,null)},pricing:{type:"string",markdownDescription:h(14161,null),enum:["Free","Trial"],default:"Free"}}},NB=class{constructor(){this._extensionPoints=new Map}registerExtensionPoint(e){if(this._extensionPoints.has(e.extensionPoint))throw new Error("Duplicate extension point: "+e.extensionPoint);const t=new RB(e.extensionPoint,e.defaultExtensionKind,e.canHandleResolver);return this._extensionPoints.set(e.extensionPoint,t),e.activationEventsGenerator&&AH.register(e.extensionPoint,e.activationEventsGenerator),xy.properties.contributes.properties[e.extensionPoint]=e.jsonSchema,Sy.registerSchema(AT,xy),t}getExtensionPoints(){return Array.from(this._extensionPoints.values())}},RT={ExtensionsRegistry:"ExtensionsRegistry"};Xt.add(RT.ExtensionsRegistry,new NB);var MB=Xt.as(RT.ExtensionsRegistry);Sy.registerSchema(AT,xy),Sy.registerSchema(x$,{properties:{extensionEnabledApiProposals:{description:h(14162,null),type:"object",properties:{},additionalProperties:{anyOf:[{type:"array",uniqueItems:!0,items:{type:"string",enum:Object.keys(Fg),markdownEnumDescriptions:Object.values(Fg).map(e=>e.proposal)}}]}}}});var OB={type:"object",additionalProperties:!1,properties:{type:{type:"string",description:h(11499,null)},required:{type:"array",items:{type:"string"}},properties:{type:"object",description:h(11500,null),additionalProperties:{$ref:"http://json-schema.org/draft-07/schema#"}},when:{type:"string",markdownDescription:h(11501,null),default:""}}},Ey;(function(e){function t(i,r,s){if(!i)return;const n=Oe(i.type)?i.type:void 0;if(!n||n.length===0){s.error(h(11502,null));return}const o=[];if(Array.isArray(i.required))for(const a of i.required)Oe(a)&&o.push(a);return{extensionId:r.value,taskType:n,required:o,properties:i.properties?Ye(i.properties):{},when:i.when?Ut.deserialize(i.when):void 0}}e.from=t})(Ey||(Ey={}));var FB=MB.registerExtensionPoint({extensionPoint:"taskDefinitions",activationEventsGenerator:(e,t)=>{for(const i of e)i.type&&t.push(`onTaskType:${i.type}`)},jsonSchema:{description:h(11503,null),type:"array",items:OB}}),$B=class{constructor(){this._onDefinitionsChanged=new D,this.onDefinitionsChanged=this._onDefinitionsChanged.event,this.taskTypes=Object.create(null),this.readyPromise=new Promise((e,t)=>{FB.setHandler((i,r)=>{this._schema=void 0;try{for(const s of r.removed){const n=s.value;for(const o of n)this.taskTypes&&o.type&&this.taskTypes[o.type]&&delete this.taskTypes[o.type]}for(const s of r.added){const n=s.value;for(const o of n){const a=Ey.from(o,s.description.identifier,s.collector);a&&(this.taskTypes[a.taskType]=a)}}(r.removed.length>0||r.added.length>0)&&this._onDefinitionsChanged.fire()}catch{}e(void 0)})})}onReady(){return this.readyPromise}get(e){return this.taskTypes[e]}all(){return Object.keys(this.taskTypes).map(e=>this.taskTypes[e])}getJsonSchema(){if(this._schema===void 0){const e=[];for(const t of this.all()){const i={type:"object",additionalProperties:!1};t.required.length>0&&(i.required=t.required.slice(0)),t.properties!==void 0?i.properties=Ye(t.properties):i.properties=Object.create(null),i.properties.type={type:"string",enum:[t.taskType]},e.push(i)}this._schema={oneOf:e}}return this._schema}},HB=new $B,UB="settings",qte=new I("taskRunning",!1,h(11504,null)),jte=new I("taskTerminalActive",!1,h(11505,null)),Gte=nh(11507,"Tasks"),$g;(function(e){e[e.Escape=1]="Escape",e[e.Strong=2]="Strong",e[e.Weak=3]="Weak"})($g||($g={})),function(e){function t(i){if(!i)return e.Strong;switch(i.toLowerCase()){case"escape":return e.Escape;case"strong":return e.Strong;case"weak":return e.Weak;default:return e.Strong}}e.from=t}($g||($g={}));var LT;(function(e){e.defaults={cwd:"${workspaceFolder}"}})(LT||(LT={}));var ud;(function(e){e[e.Always=1]="Always",e[e.Silent=2]="Silent",e[e.Never=3]="Never"})(ud||(ud={})),function(e){function t(i){switch(i.toLowerCase()){case"always":return e.Always;case"silent":return e.Silent;case"never":return e.Never;default:return e.Always}}e.fromString=t}(ud||(ud={}));var dd;(function(e){e[e.Never=1]="Never",e[e.OnProblem=2]="OnProblem",e[e.Always=3]="Always"})(dd||(dd={})),function(e){function t(i){switch(i.toLowerCase()){case"always":return e.Always;case"never":return e.Never;case"onproblem":return e.OnProblem;default:return e.OnProblem}}e.fromString=t}(dd||(dd={}));var hd;(function(e){e[e.Shared=1]="Shared",e[e.Dedicated=2]="Dedicated",e[e.New=3]="New"})(hd||(hd={})),function(e){function t(i){switch(i.toLowerCase()){case"shared":return e.Shared;case"dedicated":return e.Dedicated;case"new":return e.New;default:return e.Shared}}e.fromString=t}(hd||(hd={}));var NT;(function(e){e.defaults={echo:!0,reveal:ud.Always,revealProblems:dd.Never,focus:!1,panel:hd.Shared,showReuseMessage:!0,clear:!1}})(NT||(NT={}));var Hg;(function(e){e[e.Shell=1]="Shell",e[e.Process=2]="Process",e[e.CustomExecution=3]="CustomExecution"})(Hg||(Hg={})),function(e){function t(r){switch(r.toLowerCase()){case"shell":return e.Shell;case"process":return e.Process;case"customExecution":return e.CustomExecution;default:return e.Process}}e.fromString=t;function i(r){switch(r){case e.Shell:return"shell";case e.Process:return"process";case e.CustomExecution:return"customExecution";default:return"process"}}e.toString=i}(Hg||(Hg={}));var MT;(function(e){function t(i){return Oe(i)?i:i.value}e.value=t})(MT||(MT={}));var OT;(function(e){e.Clean={_id:"clean",isDefault:!1},e.Build={_id:"build",isDefault:!1},e.Rebuild={_id:"rebuild",isDefault:!1},e.Test={_id:"test",isDefault:!1};function t(r){return r===e.Clean._id||r===e.Build._id||r===e.Rebuild._id||r===e.Test._id}e.is=t;function i(r){if(r!==void 0)return Oe(r)?t(r)?{_id:r,isDefault:!1}:void 0:r}e.from=i})(OT||(OT={}));var FT;(function(e){e[e.Global=1]="Global",e[e.Workspace=2]="Workspace",e[e.Folder=3]="Folder"})(FT||(FT={}));var $T;(function(e){e.Workspace="workspace",e.Extension="extension",e.InMemory="inMemory",e.WorkspaceFile="workspaceFile",e.User="user";function t(i){switch(i){case e.User:return 2;case e.WorkspaceFile:return 5;default:return 6}}e.toConfigurationTarget=t})($T||($T={}));var HT;(function(e){e.parallel="parallel",e.sequence="sequence"})(HT||(HT={}));var Cy;(function(e){e[e.default=1]="default",e[e.folderOpen=2]="folderOpen"})(Cy||(Cy={}));var UT;(function(e){e.defaults={reevaluateOnRerun:!0,runOn:Cy.default,instanceLimit:1}})(UT||(UT={}));var Ug;(function(e){e[e.Process=1]="Process",e[e.Terminal=2]="Terminal"})(Ug||(Ug={})),function(e){e._default=e.Terminal}(Ug||(Ug={}));var WT;(function(e){e[e.V0_1_0=1]="V0_1_0",e[e.V2_0_0=2]="V2_0_0"})(WT||(WT={}));var BT;(function(e){e.SingleRun="singleRun",e.Background="background"})(BT||(BT={}));var ra;(function(e){e.Changed="changed",e.ProcessStarted="processStarted",e.ProcessEnded="processEnded",e.Terminated="terminated",e.Start="start",e.AcquiredInput="acquiredInput",e.DependsOnStarted="dependsOnStarted",e.Active="active",e.Inactive="inactive",e.End="end",e.ProblemMatcherStarted="problemMatcherStarted",e.ProblemMatcherEnded="problemMatcherEnded",e.ProblemMatcherFoundErrors="problemMatcherFoundErrors"})(ra||(ra={}));var VT;(function(e){e[e.System=0]="System",e[e.User=1]="User",e[e.FolderOpen=2]="FolderOpen",e[e.ConfigurationChange=3]="ConfigurationChange",e[e.Reconnect=4]="Reconnect"})(VT||(VT={}));var zT;(function(e){function t(l){return{taskId:l._id,taskName:l.configurationProperties.name,runType:l.configurationProperties.isBackground?"background":"singleRun",group:l.configurationProperties.group,__task:l}}function i(l,c,u){return{...t(l),kind:ra.Start,terminalId:c,resolvedVariables:u}}e.start=i;function r(l,c,u){return{...t(l),kind:ra.ProcessStarted,terminalId:c,processId:u}}e.processStarted=r;function s(l,c,u){return{...t(l),kind:ra.ProcessEnded,terminalId:c,exitCode:u}}e.processEnded=s;function n(l,c,u){return{...t(l),kind:ra.Terminated,exitReason:u,terminalId:c}}e.terminated=n;function o(l,c,u){return{...t(c),kind:l,terminalId:u}}e.general=o;function a(){return{kind:ra.Changed}}e.changed=a})(zT||(zT={}));var Wg;(function(e){function t(r){const s=Object.keys(r).sort();let n="";for(const o of s){let a=r[o];a instanceof Object?a=t(a):typeof a=="string"&&(a=a.replace(/,/g,",,")),n+=o+","+a+","}return n}function i(r){const n={_key:t(r),type:r.taskType};return Object.assign(n,r),n}e.create=i})(Wg||(Wg={}));var qT;(function(e){e.AutoDetect="task.autoDetect",e.SaveBeforeRun="task.saveBeforeRun",e.ShowDecorations="task.showDecorations",e.ProblemMatchersNeverPrompt="task.problemMatchers.neverPrompt",e.SlowProviderWarning="task.slowProviderWarning",e.QuickOpenHistory="task.quickOpen.history",e.QuickOpenDetail="task.quickOpen.detail",e.QuickOpenSkip="task.quickOpen.skip",e.QuickOpenShowAll="task.quickOpen.showAll",e.AllowAutomaticTasks="task.allowAutomaticTasks",e.Reconnection="task.reconnection",e.VerboseLogging="task.verboseLogging"})(qT||(qT={}));var jT;(function(e){e.Tasks="tasks",e.SuppressTaskName="tasks.suppressTaskName",e.Windows="tasks.windows",e.Osx="tasks.osx",e.Linux="tasks.linux",e.ShowOutput="tasks.showOutput",e.IsShellCommand="tasks.isShellCommand",e.ServiceTestSetting="tasks.service.testSetting"})(jT||(jT={}));var GT;(function(e){function t(i,r){const s=HB.get(i.type);if(s===void 0){const l=Ye(i);return delete l._key,Wg.create(l)}const n=Object.create(null);n.type=s.taskType;const o=new Set;s.required.forEach(l=>o.add(l));const a=s.properties;for(const l of Object.keys(a)){const c=i[l];if(c!=null)n[l]=c;else if(o.has(l)){const u=a[l];if(u.default!==void 0)n[l]=Ye(u.default);else switch(u.type){case"boolean":n[l]=!1;break;case"number":case"integer":n[l]=0;break;case"string":n[l]="";break;default:r.error(h(11506,null,JSON.stringify(i,void 0,0),l));return}}}return Wg.create(n)}e.createTaskIdentifier=t})(GT||(GT={}));var Bg;(function(e){function t(r){if(r!=null)return r}e.from=t;function i(r){if(r!=null)return r}e.to=i})(Bg||(Bg={}));var Vg;(function(e){function t(r){if(r!=null)return r}e.from=t;function i(r){if(r!=null)return r}e.to=i})(Vg||(Vg={}));var Dy;(function(e){function t(r){if(r!=null)return r}e.from=t;function i(r){if(r!=null)return r}e.to=i})(Dy||(Dy={}));var fd;(function(e){function t(s){if(s){const n=s;return n&&!!n.process}else return!1}e.is=t;function i(s){if(s==null)return;const n={process:s.process,args:s.args};return s.options&&(n.options=Dy.from(s.options)),n}e.from=i;function r(s){if(s!=null)return new ol(s.process,s.args,s.options)}e.to=r})(fd||(fd={}));var ky;(function(e){function t(r){if(r!=null)return r}e.from=t;function i(r){if(r!=null)return r}e.to=i})(ky||(ky={}));var pd;(function(e){function t(s){if(s){const n=s;return n&&(!!n.commandLine||!!n.command)}else return!1}e.is=t;function i(s){if(s==null)return;const n={};return s.commandLine!==void 0?n.commandLine=s.commandLine:(n.command=s.command,n.args=s.args),s.options&&(n.options=ky.from(s.options)),n}e.from=i;function r(s){if(!(s==null||s.command===void 0&&s.commandLine===void 0))return s.commandLine?new Oo(s.commandLine,s.options):new Oo(s.command,s.args?s.args:[],s.options)}e.to=r})(pd||(pd={}));var zr;(function(e){function t(s){if(s){const n=s;return n&&n.customExecution==="customExecution"}else return!1}e.is=t;function i(s){return{customExecution:"customExecution"}}e.from=i;function r(s,n){return n.get(s)}e.to=r})(zr||(zr={}));var Iy;(function(e){function t(i,r){let s;return i.scope!==void 0&&typeof i.scope!="number"?s=i.scope.uri:i.scope!==void 0&&typeof i.scope=="number"&&(i.scope===Ln.Workspace&&r&&r.workspaceFile?s=r.workspaceFile:s=UB),{id:i._id,workspaceFolder:s}}e.from=t})(Iy||(Iy={}));var Py;(function(e){function t(i){if(i!=null)return{_id:i.id,isDefault:i.isDefault}}e.from=t})(Py||(Py={}));var fs;(function(e){function t(s,n){if(s==null)return[];const o=[];for(const a of s){const l=i(a,n);l&&o.push(l)}return o}e.fromMany=t;function i(s,n){if(s==null)return;let o;s.execution instanceof ol?o=fd.from(s.execution):s.execution instanceof Oo?o=pd.from(s.execution):s.execution&&s.execution instanceof j_&&(o=zr.from(s.execution));const a=Bg.from(s.definition);let l;return s.scope?typeof s.scope=="number"?l=s.scope:l=s.scope.uri:l=Ln.Workspace,!a||!l?void 0:{_id:s._id,definition:a,name:s.name,source:{extensionId:n.identifier.value,label:s.source,scope:l},execution:o,isBackground:s.isBackground,group:Py.from(s.group),presentationOptions:Vg.from(s.presentationOptions),problemMatchers:er(s.problemMatchers),hasDefinedMatchers:s.hasDefinedMatchers,runOptions:s.runOptions?s.runOptions:{reevaluateOnRerun:!0},detail:s.detail}}e.from=i;async function r(s,n,o){if(s==null)return;let a;fd.is(s.execution)?a=fd.to(s.execution):pd.is(s.execution)?a=pd.to(s.execution):zr.is(s.execution)&&(a=zr.to(s._id,o));const l=Bg.to(s.definition);let c;if(s.source&&(s.source.scope!==void 0?typeof s.source.scope=="number"?c=s.source.scope:c=await n.resolveWorkspaceFolder(b.revive(s.source.scope)):c=Ln.Workspace),!l||!c)return;const u=new Zf(l,c,s.name,s.source.label,a,s.problemMatchers);return s.isBackground!==void 0&&(u.isBackground=s.isBackground),s.group!==void 0&&(u.group=pu.from(s.group._id),u.group&&s.group.isDefault&&(u.group=new pu(u.group.id,u.group.label),s.group.isDefault===!0&&(u.group.isDefault=s.group.isDefault))),s.presentationOptions&&(u.presentationOptions=Vg.to(s.presentationOptions)),s._id&&(u._id=s._id),s.detail&&(u.detail=s.detail),u}e.to=r})(fs||(fs={}));var Ty;(function(e){function t(r){return r}e.from=t;function i(r){if(r)return Object.assign(Object.create(null),r)}e.to=i})(Ty||(Ty={}));var Ay=class{#e;constructor(e,t,i){this._id=t,this._task=i,this.#e=e}get task(){return this._task}terminate(){this.#e.terminateTask(this)}fireDidStartProcess(e){}fireDidEndProcess(e){}},zg=class{constructor(t,i,r,s,n,o,a,l){this._onDidExecuteTask=new D,this._onDidTerminateTask=new D,this._onDidTaskProcessStarted=new D,this._onDidTaskProcessEnded=new D,this._onDidStartTaskProblemMatchers=new D,this._onDidEndTaskProblemMatchers=new D,this._proxy=t.getProxy(Q.MainThreadTask),this._workspaceProvider=r,this._editorService=s,this._configurationService=n,this._terminalService=o,this._handleCounter=0,this._handlers=new Map,this._taskExecutions=new Map,this._taskExecutionPromises=new Map,this._providedCustomExecutions2=new Map,this._notProvidedCustomExecutions=new Set,this._activeCustomExecutions2=new Map,this._logService=a,this._deprecationService=l,this._proxy.$registerSupportedExecutions(!0)}registerTaskProvider(t,i,r){if(!r)return new Ie(()=>{});const s=this.nextHandle();return this._handlers.set(s,{type:i,provider:r,extension:t}),this._proxy.$registerTaskProvider(s,i),new Ie(()=>{this._handlers.delete(s),this._proxy.$unregisterTaskProvider(s)})}registerTaskSystem(t,i){this._proxy.$registerTaskSystem(t,i)}fetchTasks(t){return this._proxy.$fetchTasks(Ty.from(t)).then(async i=>{const r=[];for(const s of i){const n=await fs.to(s,this._workspaceProvider,this._providedCustomExecutions2);n&&r.push(n)}return r})}get taskExecutions(){const t=[];return this._taskExecutions.forEach(i=>t.push(i)),t}terminateTask(t){if(!(t instanceof Ay))throw new Error("No valid task execution provided");return this._proxy.$terminateTask(t._id)}get onDidStartTask(){return this._onDidExecuteTask.event}async $onDidStartTask(t,i,r){const s=this._providedCustomExecutions2.get(t.id);s&&(this._activeCustomExecutions2.set(t.id,s),this._terminalService.attachPtyToTerminal(i,await s.callback(r))),this._lastStartedTask=t.id,this._onDidExecuteTask.fire({execution:await this.getTaskExecution(t)})}get onDidEndTask(){return this._onDidTerminateTask.event}async $OnDidEndTask(t){if(!this._taskExecutionPromises.has(t.id))return;const i=await this.getTaskExecution(t);this._taskExecutionPromises.delete(t.id),this._taskExecutions.delete(t.id),this.customExecutionComplete(t),this._onDidTerminateTask.fire({execution:i})}get onDidStartTaskProcess(){return this._onDidTaskProcessStarted.event}async $onDidStartTaskProcess(t){const i=await this.getTaskExecution(t.id);this._onDidTaskProcessStarted.fire({execution:i,processId:t.processId})}get onDidEndTaskProcess(){return this._onDidTaskProcessEnded.event}async $onDidEndTaskProcess(t){const i=await this.getTaskExecution(t.id);this._onDidTaskProcessEnded.fire({execution:i,exitCode:t.exitCode})}get onDidStartTaskProblemMatchers(){return this._onDidStartTaskProblemMatchers.event}async $onDidStartTaskProblemMatchers(t){let i;try{i=await this.getTaskExecution(t.execution.id)}catch{return}this._onDidStartTaskProblemMatchers.fire({execution:i})}get onDidEndTaskProblemMatchers(){return this._onDidEndTaskProblemMatchers.event}async $onDidEndTaskProblemMatchers(t){let i;try{i=await this.getTaskExecution(t.execution.id)}catch{return}this._onDidEndTaskProblemMatchers.fire({execution:i,hasErrors:t.hasErrors})}$provideTasks(t,i){const r=this._handlers.get(t);if(!r)return Promise.reject(new Error("no handler found"));const s=[],n=ci(()=>r.provider.provideTasks(Be.None)).then(o=>this.provideTasksInternal(i,s,r,o));return new Promise(o=>{n.then(a=>{Promise.all(s).then(()=>{o(a)})})})}async $resolveTask(t,i){const r=this._handlers.get(t);if(!r)return Promise.reject(new Error("no handler found"));if(i.definition.type!==r.type)throw new Error(`Unexpected: Task of type [${i.definition.type}] cannot be resolved by provider of type [${r.type}].`);const s=await fs.to(i,this._workspaceProvider,this._providedCustomExecutions2);if(!s)throw new Error("Unexpected: Task cannot be resolved.");const n=await r.provider.resolveTask(s,Be.None);if(!n)return;this.checkDeprecation(n,r);const o=fs.from(n,r.extension);if(!o)throw new Error("Unexpected: Task cannot be resolved.");if(n.definition!==s.definition)throw new Error("Unexpected: The resolved task definition must be the same object as the original task definition. The task definition cannot be changed.");return zr.is(o.execution)&&await this.addCustomExecution(o,n,!0),await this.resolveTaskInternal(o)}nextHandle(){return this._handleCounter++}async addCustomExecution(t,i,r){const s=await this._proxy.$createTaskId(t);!r&&!this._providedCustomExecutions2.has(s)&&(this._notProvidedCustomExecutions.add(s),this._activeCustomExecutions2.set(s,i.execution)),this._providedCustomExecutions2.set(s,i.execution)}async getTaskExecution(t,i){if(typeof t=="string"){const n=this._taskExecutionPromises.get(t);if(!n)throw new xr("Unexpected: The specified task is missing an execution");return n}const r=this._taskExecutionPromises.get(t.id);if(r)return r;let s;return i?s=Promise.resolve(new Ay(this,t.id,i)):s=fs.to(t.task,this._workspaceProvider,this._providedCustomExecutions2).then(n=>{if(!n)throw new xr("Unexpected: Task does not exist.");return new Ay(this,t.id,n)}),this._taskExecutionPromises.set(t.id,s),s.then(n=>(this._taskExecutions.set(t.id,n),n))}checkDeprecation(t,i){t._deprecated&&this._deprecationService.report("Task.constructor",i.extension,"Use the Task constructor that takes a `scope` instead.")}customExecutionComplete(t){this._activeCustomExecutions2.get(t.id)&&this._activeCustomExecutions2.delete(t.id),this._notProvidedCustomExecutions.has(t.id)&&this._lastStartedTask!==t.id&&(this._providedCustomExecutions2.delete(t.id),this._notProvidedCustomExecutions.delete(t.id));const r=this._notProvidedCustomExecutions.values();let s=r.next();for(;!s.done;)!this._activeCustomExecutions2.has(s.value)&&this._lastStartedTask!==s.value&&(this._providedCustomExecutions2.delete(s.value),this._notProvidedCustomExecutions.delete(s.value)),s=r.next()}};zg=__decorate([__param(0,Pe),__param(1,zt),__param(2,Br),__param(3,ia),__param(4,vr),__param(5,Ks),__param(6,ke),__param(7,cd)],zg);var Ry=class extends zg{constructor(t,i,r,s,n,o,a,l){super(t,i,r,s,n,o,a,l),this.registerTaskSystem(V.vscodeRemote,{scheme:V.vscodeRemote,authority:"",platform:xL(0)})}async executeTask(t,i){if(!i.execution)throw new Error("Tasks to execute must include an execution");const r=fs.from(i,t);if(r===void 0)throw new Error("Task is not valid");if(zr.is(r.execution))await this.addCustomExecution(r,i,!1);else throw new hv;const s=await this.getTaskExecution(await this._proxy.$getTaskExecution(r),i);return this._proxy.$executeTask(r).catch(n=>{throw new Error(n)}),s}provideTasksInternal(t,i,r,s){const n=[];if(s)for(const o of s){if(this.checkDeprecation(o,r),!o.definition||!t[o.definition.type]){const l=o.source?o.source:"No task source";this._logService.warn(`The task [${l}, ${o.name}] uses an undefined task type. The task will be ignored in the future.`)}const a=fs.from(o,r.extension);a&&zr.is(a.execution)?(n.push(a),i.push(this.addCustomExecution(a,o,!0))):this._logService.warn("Only custom execution tasks supported.")}return{tasks:n,extension:r.extension}}async resolveTaskInternal(t){if(zr.is(t.execution))return t;this._logService.warn("Only custom execution tasks supported.")}async $resolveVariables(t,i){return{process:void 0,variables:Object.create(null)}}async $jsonTasksSupported(){return!1}async $findExecutable(t,i,r){}};Ry=__decorate([__param(0,Pe),__param(1,zt),__param(2,Br),__param(3,ia),__param(4,vr),__param(5,Ks),__param(6,ke),__param(7,cd)],Ry);var Ly=q("IExtHostTask"),QT=class{constructor(){this.pendingRequests=new Map,this.queue=[],this._onError=new D,this._onExit=new D,this.sequence=1}get onError(){return this._onError.event}get onExit(){return this._onExit.event}onMessage(e){this.messageCallback&&this._onError.fire(new Error("attempt to set more than one 'Message' callback")),this.messageCallback=e}onEvent(e){this.eventCallback&&this._onError.fire(new Error("attempt to set more than one 'Event' callback")),this.eventCallback=e}onRequest(e){this.requestCallback&&this._onError.fire(new Error("attempt to set more than one 'Request' callback")),this.requestCallback=e}sendResponse(e){e.seq>0?this._onError.fire(new Error(`attempt to send more than one response for command ${e.command}`)):this.internalSend("response",e)}sendRequest(e,t,i,r){const s={command:e};if(t&&Object.keys(t).length>0&&(s.arguments=t),this.internalSend("request",s),typeof r=="number"){const n=setTimeout(()=>{clearTimeout(n);const o=this.pendingRequests.get(s.seq);if(o){this.pendingRequests.delete(s.seq);const a={type:"response",seq:0,request_seq:s.seq,success:!1,command:e,message:h(6659,null,r,e)};o(a)}},r)}return i&&this.pendingRequests.set(s.seq,i),s.seq}acceptMessage(e){this.messageCallback?this.messageCallback(e):(this.queue.push(e),this.queue.length===1&&this.processQueue())}needsTaskBoundaryBetween(e,t){return e.type!=="event"||t.type!=="event"}async processQueue(){let e;for(;this.queue.length;){if((!e||this.needsTaskBoundaryBetween(this.queue[0],e))&&await ui(0),e=this.queue.shift(),!e)return;switch(e.type){case"event":this.eventCallback?.(e);break;case"request":this.requestCallback?.(e);break;case"response":{const t=e,i=this.pendingRequests.get(t.request_seq);i&&(this.pendingRequests.delete(t.request_seq),i(t));break}}}}internalSend(e,t){t.type=e,t.seq=this.sequence++,this.sendMessage(t)}async cancelPendingRequests(){if(this.pendingRequests.size===0)return Promise.resolve();const e=new Map;this.pendingRequests.forEach((t,i)=>e.set(i,t)),await ui(500),e.forEach((t,i)=>{t({type:"response",seq:0,request_seq:i,success:!1,command:"canceled",message:"canceled"}),this.pendingRequests.delete(i)})}getPendingRequestIds(){return Array.from(this.pendingRequests.keys())}dispose(){this.queue=[]}};function WB(e){return e.type&&(e.label||e.program||e.runtime)}var BB=/^[a-zA-Z][a-zA-Z0-9\+\-\.]+:/;function VB(e){return!!(e&&e.match(BB))}function JT(e){if(typeof e.path=="string"&&!(typeof e.sourceReference=="number"&&e.sourceReference>0)){if(VB(e.path))return b.parse(e.path);if(Dr(e.path))return b.file(e.path)}return e.path}function KT(e){if(typeof e.path=="object"){const t=b.revive(e.path);if(t)return t.scheme===V.file?t.fsPath:t.toString()}return e.path}function zB(e,t){const i=t?JT:KT,r=Ye(e);return XT(r,(s,n)=>{s&&n&&(n.path=i(n))}),r}function qB(e,t){const i=t?JT:KT,r=Ye(e);return XT(r,(s,n)=>{!s&&n&&(n.path=i(n))}),r}function XT(e,t){switch(e.type){case"event":{const i=e;switch(i.event){case"output":t(!1,i.body.source);break;case"loadedSource":t(!1,i.body.source);break;case"breakpoint":t(!1,i.body.breakpoint.source);break;default:break}break}case"request":{const i=e;switch(i.command){case"setBreakpoints":t(!0,i.arguments.source);break;case"breakpointLocations":t(!0,i.arguments.source);break;case"source":t(!0,i.arguments.source);break;case"gotoTargets":t(!0,i.arguments.source);break;case"launchVSCode":i.arguments.args.forEach(r=>t(!1,r));break;default:break}break}case"response":{const i=e;if(i.success&&i.body)switch(i.command){case"stackTrace":i.body.stackFrames.forEach(r=>t(!1,r.source));break;case"loadedSources":i.body.sources.forEach(r=>t(!1,r));break;case"scopes":i.body.scopes.forEach(r=>t(!1,r.source));break;case"setFunctionBreakpoints":i.body.breakpoints.forEach(r=>t(!1,r.source));break;case"setBreakpoints":i.body.breakpoints.forEach(r=>t(!1,r.source));break;case"disassemble":i.body?.instructions.forEach(s=>t(!1,s.location));break;case"locations":t(!1,i.body?.source);break;default:break}break}}}var Bl=q("IExtHostEditorTabs"),YT=class{constructor(e,t,i){this._activeTabIdGetter=i,this._parentGroup=t,this.acceptDtoUpdate(e)}get apiObject(){if(!this._apiObject){const e=this,t={get isActive(){return e._dto.id===e._activeTabIdGetter()},get label(){return e._dto.label},get input(){return e._input},get isDirty(){return e._dto.isDirty},get isPinned(){return e._dto.isPinned},get isPreview(){return e._dto.isPreview},get group(){return e._parentGroup.apiObject}};this._apiObject=Object.freeze(t)}return this._apiObject}get tabId(){return this._dto.id}acceptDtoUpdate(e){this._dto=e,this._input=this._initInput()}_initInput(){switch(this._dto.input.kind){case 1:return new d0(b.revive(this._dto.input.uri));case 2:return new Sp(b.revive(this._dto.input.original),b.revive(this._dto.input.modified));case 3:return new T4(b.revive(this._dto.input.base),b.revive(this._dto.input.input1),b.revive(this._dto.input.input2),b.revive(this._dto.input.result));case 6:return new h0(b.revive(this._dto.input.uri),this._dto.input.viewType);case 7:return new A4(this._dto.input.viewType);case 4:return new f0(b.revive(this._dto.input.uri),this._dto.input.notebookType);case 5:return new p0(b.revive(this._dto.input.original),b.revive(this._dto.input.modified),this._dto.input.notebookType);case 8:return new R4;case 9:return new L4(b.revive(this._dto.input.uri),b.revive(this._dto.input.inputBoxUri));case 10:return new N4;case 11:return new M4(this._dto.input.diffEditors.map(e=>new Sp(b.revive(e.original),b.revive(e.modified))));default:return}}},jB=class{constructor(e,t){this._tabs=[],this._activeTabId="",this._dto=e,this._activeGroupIdGetter=t;for(const i of e.tabs)i.isActive&&(this._activeTabId=i.id),this._tabs.push(new YT(i,this,()=>this.activeTabId()))}get apiObject(){if(!this._apiObject){const e=this,t={get isActive(){return e._dto.groupId===e._activeGroupIdGetter()},get viewColumn(){return jt.to(e._dto.viewColumn)},get activeTab(){return e._tabs.find(i=>i.tabId===e._activeTabId)?.apiObject},get tabs(){return Object.freeze(e._tabs.map(i=>i.apiObject))}};this._apiObject=Object.freeze(t)}return this._apiObject}get groupId(){return this._dto.groupId}get tabs(){return this._tabs}acceptGroupDtoUpdate(e){this._dto=e}acceptTabOperation(e){if(e.kind===0){const i=new YT(e.tabDto,this,()=>this.activeTabId());return this._tabs.splice(e.index,0,i),e.tabDto.isActive&&(this._activeTabId=i.tabId),i}else if(e.kind===1){const i=this._tabs.splice(e.index,1)[0];if(!i)throw new Error(`Tab close updated received for index ${e.index} which does not exist`);return i.tabId===this._activeTabId&&(this._activeTabId=""),i}else if(e.kind===3){if(e.oldIndex===void 0)throw new Error("Invalid old index on move IPC");const i=this._tabs.splice(e.oldIndex,1)[0];if(!i)throw new Error(`Tab move updated received for index ${e.oldIndex} which does not exist`);return this._tabs.splice(e.index,0,i),i}const t=this._tabs.find(i=>i.tabId===e.tabDto.id);if(!t)throw new Error("INVALID tab");return e.tabDto.isActive?this._activeTabId=e.tabDto.id:this._activeTabId===e.tabDto.id&&!e.tabDto.isActive&&(this._activeTabId=""),t.acceptDtoUpdate(e.tabDto),t}activeTabId(){return this._activeTabId}},Ny=class{constructor(t){this._onDidChangeTabs=new D,this._onDidChangeTabGroups=new D,this._extHostTabGroups=[],this._proxy=t.getProxy(Q.MainThreadEditorTabs)}get tabGroups(){if(!this._apiObject){const t=this,i={onDidChangeTabGroups:t._onDidChangeTabGroups.event,onDidChangeTabs:t._onDidChangeTabs.event,get all(){return Object.freeze(t._extHostTabGroups.map(r=>r.apiObject))},get activeTabGroup(){const r=t._activeGroupId;return Sa(t._extHostTabGroups.find(n=>n.groupId===r)?.apiObject)},close:async(r,s)=>{const n=Array.isArray(r)?r:[r];return n.length?GB(n[0])?this._closeGroups(n,s):this._closeTabs(n,s):!0}};this._apiObject=Object.freeze(i)}return this._apiObject}$acceptEditorTabModel(t){const i=new Set(this._extHostTabGroups.map(c=>c.groupId)),r=new Set(t.map(c=>c.groupId)),s=PR(i,r),n=this._extHostTabGroups.filter(c=>s.removed.includes(c.groupId)).map(c=>c.apiObject),o=[],a=[];this._extHostTabGroups=t.map(c=>{const u=new jB(c,()=>this._activeGroupId);return s.added.includes(u.groupId)?o.push(u.apiObject):a.push(u.apiObject),u});const l=Sa(t.find(c=>c.isActive===!0)?.groupId);l!==void 0&&this._activeGroupId!==l&&(this._activeGroupId=l),this._onDidChangeTabGroups.fire(Object.freeze({opened:o,closed:n,changed:a}))}$acceptTabGroupUpdate(t){const i=this._extHostTabGroups.find(r=>r.groupId===t.groupId);if(!i)throw new Error("Update Group IPC call received before group creation.");i.acceptGroupDtoUpdate(t),t.isActive&&(this._activeGroupId=t.groupId),this._onDidChangeTabGroups.fire(Object.freeze({changed:[i.apiObject],opened:[],closed:[]}))}$acceptTabOperation(t){const i=this._extHostTabGroups.find(s=>s.groupId===t.groupId);if(!i)throw new Error("Update Tabs IPC call received before group creation.");const r=i.acceptTabOperation(t);switch(t.kind){case 0:this._onDidChangeTabs.fire(Object.freeze({opened:[r.apiObject],closed:[],changed:[]}));return;case 1:this._onDidChangeTabs.fire(Object.freeze({opened:[],closed:[r.apiObject],changed:[]}));return;case 3:case 2:this._onDidChangeTabs.fire(Object.freeze({opened:[],closed:[],changed:[r.apiObject]}));return}}_findExtHostTabFromApi(t){for(const i of this._extHostTabGroups)for(const r of i.tabs)if(r.apiObject===t)return r}_findExtHostTabGroupFromApi(t){return this._extHostTabGroups.find(i=>i.apiObject===t)}async _closeTabs(t,i){const r=[];for(const s of t){const n=this._findExtHostTabFromApi(s);if(!n)throw new Error("Tab close: Invalid tab not found!");r.push(n.tabId)}return this._proxy.$closeTab(r,i)}async _closeGroups(t,i){const r=[];for(const s of t){const n=this._findExtHostTabGroupFromApi(s);if(!n)throw new Error("Group close: Invalid group not found!");r.push(n.groupId)}return this._proxy.$closeGroup(r,i)}};Ny=__decorate([__param(0,Pe)],Ny);function GB(e){return e.tabs!==void 0}var QB=0,ZT=new WeakMap,gd=q("IExtHostTesting"),My=class extends X{constructor(t,i,r,s){super(),this.logService=i,this.commands=r,this.editors=s,this.resultsChangedEmitter=this._register(new D),this.controllers=new Map,this.defaultProfilesChangedEmitter=this._register(new D),this.followupProviders=new Set,this.testFollowups=new Map,this.onResultsChanged=this.resultsChangedEmitter.event,this.results=[],this.proxy=t.getProxy(Q.MainThreadTesting),this.observer=new eV(this.proxy),this.runTracker=new XB(this.proxy,i),r.registerArgumentProcessor({processArgument:n=>{switch(n?.$mid){case 16:{const o=n,a=o.tests[o.tests.length-1].item.extId;return this.controllers.get(He.root(a))?.collection.tree.get(a)?.actual??M5(n)}case 18:{const{test:o,message:a}=n,l=o.item.extId;return{test:this.controllers.get(He.root(l))?.collection.tree.get(l)?.actual??M5({$mid:16,tests:[o]}),message:Pl.to(a)}}default:return n}}}),r.registerCommand(!1,"testing.getExplorerSelection",async()=>{const n=await r.executeCommand("_testing.getExplorerSelection"),o=a=>{const l=this.controllers.get(He.root(a));if(l)return He.isRoot(a)?l.controller:l.collection.tree.get(a)?.actual};return{include:n?.include.map(o).filter(ur)||[],exclude:n?.exclude.map(o).filter(ur)||[]}})}createTestController(t,i,r,s){if(this.controllers.has(i))throw new Error(`Attempt to insert a duplicate controller with ID "${i}"`);const n=new oe,o=n.add(new DW(i,r,this.editors));o.root.label=r;const a=new Map,l=new Set,c=this.proxy,u=()=>{let p=0;s&&(p|=2);const g=f.relatedCodeProvider;return g&&(g?.provideRelatedTests&&(p|=8),g?.provideRelatedCode&&(p|=4)),p},d={items:o.root.children,get label(){return r},set label(p){r=p,o.root.label=p,c.$updateController(i,{label:r})},get refreshHandler(){return s},set refreshHandler(p){s=p,c.$updateController(i,{capabilities:u()})},get id(){return i},get relatedCodeProvider(){return f.relatedCodeProvider},set relatedCodeProvider(p){M(t,"testRelatedCode"),f.relatedCodeProvider=p,c.$updateController(i,{capabilities:u()})},createRunProfile:(p,g,v,y,S,x)=>{let P=Rs(p);for(;a.has(P);)P++;return new r6(this.proxy,a,l,this.defaultProfilesChangedEmitter.event,i,P,p,g,v,y,S,x)},createTestItem(p,g,v){return new rd(i,p,g,v)},createTestRun:(p,g,v=!0)=>this.runTracker.createTestRun(t,i,o,p,g,v),invalidateTestResults:p=>{if(p===void 0)this.proxy.$markTestRetired(void 0);else{const g=p instanceof Array?p:[p];this.proxy.$markTestRetired(g.map(v=>He.fromExtHostTestItem(v,i).toString()))}},set resolveHandler(p){o.resolveHandler=p},get resolveHandler(){return o.resolveHandler},dispose:()=>{n.dispose()}},f={controller:d,collection:o,profiles:a,extension:t,activeProfiles:l};return c.$registerTestController(i,r,u()),n.add(ie(()=>c.$unregisterTestController(i))),this.controllers.set(i,f),n.add(ie(()=>this.controllers.delete(i))),n.add(o.onDidGenerateDiff(p=>c.$publishDiff(i,p.map(Nf.serialize)))),d}createTestObserver(){return this.observer.checkout()}async runTests(t,i=Be.None){const r=t6(t);if(!r)throw new Error("The request passed to `vscode.test.runTests` must include a profile");const s=this.controllers.get(r.controllerId);if(!s)throw new Error("Controller not found");await this.proxy.$runTests({preserveFocus:t.preserveFocus??!0,group:Tl.from(r.kind),targets:[{testIds:t.include?.map(n=>He.fromExtHostTestItem(n,s.collection.root.id).toString())??[s.collection.root.id],profileId:r.profileId,controllerId:r.controllerId}],exclude:t.exclude?.map(n=>n.id)},i)}registerTestFollowupProvider(t){return this.followupProviders.add(t),{dispose:()=>{this.followupProviders.delete(t)}}}async $getTestsRelatedToCode(t,i,r){const s=this.editors.getDocument(b.revive(t));if(!s)return[];const n=Qe.to(i),o=[];return await Promise.all([...this.controllers.values()].map(async a=>{let l;try{l=await a.relatedCodeProvider?.provideRelatedTests?.(s.document,n,r)}catch(c){r.isCancellationRequested||this.logService.warn(`Error thrown while providing related tests for ${a.controller.label}`,c)}if(l){for(const c of l)o.push(He.fromExtHostTestItem(c,a.controller.id).toString());a.collection.flushDiff()}})),o}async $getCodeRelatedToTest(t,i){const r=this.controllers.get(He.root(t));if(!r)return[];const s=r.collection.tree.get(t);return s?(await r.relatedCodeProvider?.provideRelatedCode?.(s.actual,i))?.map(Ai.from)??[]:[]}$syncTests(){for(const{collection:t}of this.controllers.values())t.flushDiff();return Promise.resolve()}async $getCoverageDetails(t,i,r){return(await this.runTracker.getCoverageDetails(t,i,r))?.map(Wu.fromDetails)}async $disposeRun(t){this.runTracker.disposeTestRun(t)}$configureRunProfile(t,i){this.controllers.get(t)?.profiles.get(i)?.configureHandler?.()}$setDefaultRunProfiles(t){const i=new Map;for(const[r,s]of Object.entries(t)){const n=this.controllers.get(r);if(!n)continue;const o=new Map,a=s.filter(c=>!n.activeProfiles.has(c)),l=[...n.activeProfiles].filter(c=>!s.includes(c));for(const c of a)o.set(c,!0),n.activeProfiles.add(c);for(const c of l)o.set(c,!1),n.activeProfiles.delete(c);o.size&&i.set(r,o)}this.defaultProfilesChangedEmitter.fire(i)}async $refreshTests(t,i){await this.controllers.get(t)?.controller.refreshHandler?.(i)}$publishTestResults(t){this.results=Object.freeze(t.map(i=>{const r=tw.to(i),s=i.tasks.findIndex(n=>n.hasCoverage);return s!==-1&&(r.getDetailedCoverage=(n,o=Be.None)=>this.proxy.$getCoverageDetails(i.id,s,n,o).then(a=>a.map(Wu.to))),ZT.set(r,i.id),r}).concat(this.results).sort((i,r)=>r.completedAt-i.completedAt).slice(0,32)),this.resultsChangedEmitter.fire()}async $expandTest(t,i){const r=this.controllers.get(He.fromString(t).controllerId)?.collection;r&&(await r.expand(t,i<0?1/0:i),r.flushDiff())}$acceptDiff(t){this.observer.applyDiff(t.map(i=>Nf.deserialize({asCanonicalUri:r=>r},i)))}async $runControllerTests(t,i){return Promise.all(t.map(r=>this.runControllerTestRequest(r,!1,i)))}async $startContinuousRun(t,i){const r=new rt(i),s=await Promise.all(t.map(n=>this.runControllerTestRequest(n,!0,r.token)));return!i.isCancellationRequested&&!s.some(n=>n.error)&&await new Promise(n=>i.onCancellationRequested(n)),r.dispose(!0),s}async $provideTestFollowups(t,i){const r=this.results.find(o=>ZT.get(o)===t.resultId),s=r&&tV(He.fromString(t.extId),r?.results);if(!s)return[];let n=[];return await Promise.all([...this.followupProviders].map(async o=>{try{const a=await o.provideFollowup(r,s,t.taskIndex,t.messageIndex,i);a&&(n=n.concat(a))}catch(a){this.logService.error("Error thrown while providing followup for test message",a)}})),i.isCancellationRequested?[]:n.map(o=>{const a=QB++;return this.testFollowups.set(a,o),{title:o.title,id:a}})}$disposeTestFollowups(t){for(const i of t)this.testFollowups.delete(i)}$executeTestFollowup(t){const i=this.testFollowups.get(t);return i?this.commands.executeCommand(i.command,...i.arguments||[]):Promise.resolve()}$cancelExtensionTestRun(t,i){t===void 0?this.runTracker.cancelAllRuns():this.runTracker.cancelRunById(t,i)}getMetadataForRun(t){for(const i of this.runTracker.trackers){const r=i.getTaskIdForRun(t);if(r)return{taskId:r,runId:i.id}}}async runControllerTestRequest(t,i,r){const s=this.controllers.get(t.controllerId);if(!s)return{};const{collection:n,profiles:o,extension:a}=s,l=o.get(t.profileId);if(!l)return{};const c=t.testIds.map(p=>n.tree.get(p)).filter(ur),u=t.excludeExtIds.map(p=>s.collection.tree.get(p)).filter(ur).filter(p=>c.some(g=>g.fullId.compare(p.fullId)===2));if(!c.length)return{};const d=new vp(c.some(p=>p.actual instanceof zw)?void 0:c.map(p=>p.actual),u.map(p=>p.actual),l,i),f=gH(t)&&this.runTracker.prepareForMainThreadTestRun(a,d,i6.fromInternal(t,s.collection),l,r);try{return await l.runHandler(d,r),{}}catch(p){return{error:String(p)}}finally{f&&f.hasRunningTasks&&!r.isCancellationRequested&&await Fe.toPromise(f.onEnd)}}};My=__decorate([__param(0,Pe),__param(1,ke),__param(2,Vr),__param(3,ia)],My);var JB=1e4,e6;(function(e){e[e.Running=0]="Running",e[e.Cancelling=1]="Cancelling",e[e.Ended=2]="Ended"})(e6||(e6={}));var KB=class extends X{get hasRunningTasks(){return this.running>0}get id(){return this.dto.id}constructor(e,t,i,r,s,n){super(),this.dto=e,this.proxy=t,this.logService=i,this.profile=r,this.extension=s,this.state=0,this.running=0,this.tasks=new Map,this.sharedTestIds=new Set,this.endEmitter=this._register(new D),this.publishedCoverage=new Map,this.onEnd=this.endEmitter.event,this.cts=this._register(new rt(n));const o=this._register(new ks(()=>this.forciblyEndTasks(),JB));this._register(this.cts.token.onCancellationRequested(()=>o.schedule()));const a=new D;this.onDidDispose=a.event,this._register(ie(()=>{a.fire(),a.dispose()}))}getTaskIdForRun(e){for(const[t,{run:i}]of this.tasks)if(i===e)return t}cancel(e){e?this.tasks.get(e)?.cts.cancel():this.state===0?(this.cts.cancel(),this.state=1):this.state===1&&this.forciblyEndTasks()}async getCoverageDetails(e,t,i){const[,r]=He.fromString(e).path,s=this.publishedCoverage.get(e);if(!s)return[];const{report:n,extIds:o}=s,a=this.tasks.get(r);if(!a)throw new Error("unreachable: run task was not found");let l;if(t&&n instanceof bp){const u=o.indexOf(t);if(u===-1)return[];l=n.includesTests[u]}return await(l?this.profile?.loadDetailedCoverageForTest?.(a.run,n,l,i):this.profile?.loadDetailedCoverage?.(a.run,n,i))??[]}createRun(e){const t=this.dto.id,i=this.dto.controllerId,r=mt(),s=c=>(u,...d)=>{if(o){this.logService.warn(`Setting the state of test "${u.id}" is a no-op after the run ends.`);return}this.ensureTestIsKnown(u),c(u,...d)},n=(c,u)=>{const d=u instanceof Array?u.map(Pl.from):[Pl.from(u)];if(c.uri&&c.range){const f={range:F.from(c.range),uri:c.uri};for(const p of d)p.location=p.location||f}this.proxy.$appendTestMessagesInRun(t,r,He.fromExtHostTestItem(c,i).toString(),d)};let o=!1;const a=this._register(new rt(this.cts.token)),l={isPersisted:this.dto.isPersisted,token:a.token,name:e,onDidDispose:this.onDidDispose,addCoverage:c=>{if(o)return;const u=c instanceof bp?c.includesTests:[];if(u.length)for(const p of u)this.ensureTestIsKnown(p);const d=c.uri.toString(),f=new He([t,r,d]).toString();this.publishedCoverage.set(f,{report:c,extIds:u.map(p=>He.fromExtHostTestItem(p,i).toString())}),this.proxy.$appendCoverage(t,r,Wu.fromFile(i,f,c))},enqueued:s(c=>{this.proxy.$updateTestStateInRun(t,r,He.fromExtHostTestItem(c,i).toString(),1)}),skipped:s(c=>{this.proxy.$updateTestStateInRun(t,r,He.fromExtHostTestItem(c,i).toString(),5)}),started:s(c=>{this.proxy.$updateTestStateInRun(t,r,He.fromExtHostTestItem(c,i).toString(),2)}),errored:s((c,u,d)=>{n(c,u),this.proxy.$updateTestStateInRun(t,r,He.fromExtHostTestItem(c,i).toString(),6,d)}),failed:s((c,u,d)=>{n(c,u),this.proxy.$updateTestStateInRun(t,r,He.fromExtHostTestItem(c,i).toString(),4,d)}),passed:s((c,u)=>{this.proxy.$updateTestStateInRun(t,r,He.fromExtHostTestItem(c,this.dto.controllerId).toString(),3,u)}),appendOutput:(c,u,d)=>{o||(d&&this.ensureTestIsKnown(d),this.proxy.$appendOutputToRun(t,r,z.fromString(c),u&&Ai.from(u),d&&He.fromExtHostTestItem(d,i).toString()))},end:()=>{o||(o=!0,this.proxy.$finishedTestRunTask(t,r),--this.running||this.markEnded())}};return this.running++,this.tasks.set(r,{run:l,cts:a}),this.proxy.$startedTestRunTask(t,{id:r,ctrlId:this.dto.controllerId,name:e||this.extension.displayName||this.extension.identifier.value,running:!0}),l}forciblyEndTasks(){for(const{run:e}of this.tasks.values())e.end()}markEnded(){this.state!==2&&(this.state=2,this.endEmitter.fire())}ensureTestIsKnown(e){if(!(e instanceof rd))throw new Mf(e.id);if(this.sharedTestIds.has(He.fromExtHostTestItem(e,this.dto.controllerId).toString()))return;const t=[],i=this.dto.colllection.root;for(;;){const r=Wn.from(e);if(t.unshift(r),this.sharedTestIds.has(r.extId)||(this.sharedTestIds.add(r.extId),e===i))break;e=e.parent||i}this.proxy.$addTestsToRun(this.dto.controllerId,this.dto.id,t)}dispose(){this.markEnded(),super.dispose()}},XB=class{get trackers(){return this.tracked.values()}constructor(e,t){this.proxy=e,this.logService=t,this.tracked=new Map,this.trackedById=new Map}getCoverageDetails(e,t,i){const r=He.root(e);return this.trackedById.get(r)?.getCoverageDetails(e,t,i)||[]}disposeTestRun(e){this.trackedById.get(e)?.dispose(),this.trackedById.delete(e);for(const[t,{id:i}]of this.tracked)i===e&&this.tracked.delete(t)}prepareForMainThreadTestRun(e,t,i,r,s){return this.getTracker(t,i,r,e,s)}cancelRunById(e,t){this.trackedById.get(e)?.cancel(t)}cancelAllRuns(){for(const e of this.tracked.values())e.cancel()}createTestRun(e,t,i,r,s,n){const o=this.tracked.get(r);if(o)return o.createRun(s);const a=i6.fromPublic(t,i,r,n),l=t6(r);this.proxy.$startedExtensionTestRun({controllerId:t,continuous:!!r.continuous,profile:l&&{group:Tl.from(l.kind),id:l.profileId},exclude:r.exclude?.map(u=>He.fromExtHostTestItem(u,i.root.id).toString())??[],id:a.id,include:r.include?.map(u=>He.fromExtHostTestItem(u,i.root.id).toString())??[i.root.id],preserveFocus:r.preserveFocus??!0,persist:n});const c=this.getTracker(r,a,r.profile,e);return Fe.once(c.onEnd)(()=>{this.proxy.$finishedExtensionTestRun(a.id)}),c.createRun(s)}getTracker(e,t,i,r,s){const n=new KB(t,this.proxy,this.logService,i,r,s);return this.tracked.set(e,n),this.trackedById.set(n.id,n),n}},t6=e=>{if(e.profile){if(!(e.profile instanceof r6))throw new Error("TestRunRequest.profile is not an instance created from TestController.createRunProfile");return e.profile}},i6=class OS{static fromPublic(t,i,r,s){return new OS(t,mt(),s,i)}static fromInternal(t,i){return new OS(t.controllerId,t.runId,!0,i)}constructor(t,i,r,s){this.controllerId=t,this.id=i,this.isPersisted=r,this.colllection=s}},YB=class{get isEmpty(){return this.added.size===0&&this.removed.size===0&&this.updated.size===0}constructor(e){this.emitter=e,this.added=new Set,this.updated=new Set,this.removed=new Set,this.alreadyRemoved=new Set}add(e){this.added.add(e)}update(e){Object.assign(e.revived,Wn.toPlain(e.item)),this.added.has(e)||this.updated.add(e)}remove(e){if(this.added.has(e)){this.added.delete(e);return}this.updated.delete(e);const t=He.parentId(e.item.extId);if(t&&this.alreadyRemoved.has(t.toString())){this.alreadyRemoved.add(e.item.extId);return}this.removed.add(e)}getChangeEvent(){const{added:e,updated:t,removed:i}=this;return{get added(){return[...e].map(r=>r.revived)},get updated(){return[...t].map(r=>r.revived)},get removed(){return[...i].map(r=>r.revived)}}}complete(){this.isEmpty||this.emitter.fire(this.getChangeEvent())}},ZB=class extends mH{constructor(){super(...arguments),this.changeEmitter=new D,this.onDidChangeTests=this.changeEmitter.event}get rootTests(){return this.roots}getMirroredTestDataById(e){return this.items.get(e)}getMirroredTestDataByReference(e){return this.items.get(e.id)}createItem(e,t){return{...e,revived:Wn.toPlain(e.item),depth:t?t.depth+1:0,children:new Set}}createChangeCollector(){return new YB(this.changeEmitter)}},eV=class{constructor(e){this.proxy=e}checkout(){this.current||(this.current=this.createObserverData());const e=this.current;return e.observers++,{onDidChangeTest:e.tests.onDidChangeTests,get tests(){return[...e.tests.rootTests].map(t=>t.revived)},dispose:eh(()=>{--e.observers===0&&(this.proxy.$unsubscribeFromDiffs(),this.current=void 0)})}}getMirroredTestDataByReference(e){return this.current?.tests.getMirroredTestDataByReference(e)}applyDiff(e){this.current?.tests.apply(e)}createObserverData(){const e=new ZB({asCanonicalUri:t=>t});return this.proxy.$subscribeToDiffs(),{observers:0,tests:e}}},md=(e,t,i,r)=>{i?Object.assign(i,r):t.$updateTestRunConfig(e.controllerId,e.profileId,r)},r6=class extends D4{#e;#t;#i;#r;#n;get label(){return this._label}set label(e){e!==this._label&&(this._label=e,md(this,this.#e,this.#r,{label:e}))}get supportsContinuousRun(){return this._supportsContinuousRun}set supportsContinuousRun(e){e!==this._supportsContinuousRun&&(this._supportsContinuousRun=e,md(this,this.#e,this.#r,{supportsContinuousRun:e}))}get isDefault(){return this.#t.has(this.profileId)}set isDefault(e){e!==this.isDefault&&(e?this.#t.add(this.profileId):this.#t.delete(this.profileId),md(this,this.#e,this.#r,{isDefault:e}))}get tag(){return this._tag}set tag(e){e?.id!==this._tag?.id&&(this._tag=e,md(this,this.#e,this.#r,{tag:e?Wr.namespace(this.controllerId,e.id):null}))}get configureHandler(){return this._configureHandler}set configureHandler(e){e!==this._configureHandler&&(this._configureHandler=e,md(this,this.#e,this.#r,{hasConfigurationHandler:!!e}))}get onDidChangeDefault(){return Fe.chain(this.#i,e=>e.map(t=>t.get(this.controllerId)?.get(this.profileId)).filter(ur))}constructor(e,t,i,r,s,n,o,a,l,c=!1,u=void 0,d=!1){super(s,n,a),this._label=o,this.runHandler=l,this._tag=u,this._supportsContinuousRun=d,this.#e=e,this.#n=t,this.#t=i,this.#i=r,t.set(n,this);const f=Tl.from(a);c&&i.add(n),this.#r={profileId:n,controllerId:s,tag:u?Wr.namespace(this.controllerId,u.id):null,label:o,group:f,isDefault:c,hasConfigurationHandler:!1,supportsContinuousRun:d},queueMicrotask(()=>{this.#r&&(this.#e.$publishTestRunProfile(this.#r),this.#r=void 0)})}dispose(){this.#n?.delete(this.profileId)&&(this.#n=void 0,this.#e.$removeTestProfile(this.controllerId,this.profileId)),this.#r=void 0}};function tV(e,t){for(let i=0;i<e.path.length;i++){const r=t.find(s=>s.id===e.path[i]);if(!r)return;if(i===e.path.length-1)return r;t=r.children}}var Yte=q("configurationResolverService"),lt;(function(e){e.Unknown="unknown",e.Env="env",e.Config="config",e.Command="command",e.Input="input",e.ExtensionInstallFolder="extensionInstallFolder",e.WorkspaceFolder="workspaceFolder",e.Cwd="cwd",e.WorkspaceFolderBasename="workspaceFolderBasename",e.UserHome="userHome",e.LineNumber="lineNumber",e.ColumnNumber="columnNumber",e.SelectedText="selectedText",e.File="file",e.FileWorkspaceFolder="fileWorkspaceFolder",e.FileWorkspaceFolderBasename="fileWorkspaceFolderBasename",e.RelativeFile="relativeFile",e.RelativeFileDirname="relativeFileDirname",e.FileDirname="fileDirname",e.FileExtname="fileExtname",e.FileBasename="fileBasename",e.FileBasenameNoExtension="fileBasenameNoExtension",e.FileDirnameBasename="fileDirnameBasename",e.ExecPath="execPath",e.ExecInstallFolder="execInstallFolder",e.PathSeparator="pathSeparator",e.PathSeparatorAlias="/"})(lt||(lt={}));var iV=Object.values(lt).filter(e=>typeof e=="string"),Ri=class extends xr{constructor(e,t){super(t),this.variable=e}},s6=class FS{static{this.VARIABLE_LHS="${"}constructor(t){this.locations=new Map,this.newReplacementNotifiers=new Set,typeof t=="string"?(this.stringRoot=!0,this.root={value:t}):(this.stringRoot=!1,this.root=structuredClone(t))}static parse(t){if(t instanceof FS)return t;const i=new FS(t);return i.applyPlatformSpecificKeys(),i.parseObject(i.root),i}applyPlatformSpecificKeys(){const t=this.root,i=Ve?"windows":Mt?"osx":Ct?"linux":void 0;i&&t&&typeof t=="object"&&t.hasOwnProperty(i)&&Object.keys(t[i]).forEach(r=>t[r]=t[i][r]),delete t.windows,delete t.osx,delete t.linux}parseVariable(t,i){if(t[i]!=="$"||t[i+1]!=="{")return;let r=i+2,s=1;for(;r<t.length;){if(t[r]==="{")s++;else if(t[r]==="}"&&(s--,s===0))break;r++}if(s!==0)return;const n=t.slice(i,r+1),o=t.substring(i+2,r),a=o.indexOf(":");return a===-1?{replacement:{id:n,name:o,inner:o},end:r}:{replacement:{id:n,inner:o,name:o.slice(0,a),arg:o.slice(a+1)},end:r}}parseObject(t){if(!(typeof t!="object"||t===null)){if(Array.isArray(t)){for(let i=0;i<t.length;i++){const r=t[i];typeof r=="string"?this.parseString(t,i,r):this.parseObject(r)}return}for(const[i,r]of Object.entries(t))typeof r=="string"?this.parseString(t,i,r):this.parseObject(r);for(const[i]of Object.entries(t))this.parseString(t,i,i,!0)}}parseString(t,i,r,s,n){let o=0;for(;o<r.length;){const a=r.indexOf("${",o);if(a===-1)break;const l=this.parseVariable(r,a);if(l){if(o=l.end+1,n?.includes(l.replacement.id))continue;const c=this.locations.get(l.replacement.id)||{locations:[],replacement:l.replacement},u={object:t,propertyName:i,replaceKeyName:s};c.locations.push(u),this.locations.set(l.replacement.id,c),c.resolved?this._resolveAtLocation(l.replacement,u,c.resolved,n):this.newReplacementNotifiers.forEach(d=>d(l.replacement))}else o=a+2}}*unresolved(){const t=new Map,i=r=>{t.set(r.id,r)};for(const r of this.locations.values())r.resolved===void 0&&t.set(r.replacement.id,r.replacement);for(this.newReplacementNotifiers.add(i);;){const r=ai.first(t);if(!r)break;const[s,n]=r;yield n,t.delete(s)}this.newReplacementNotifiers.delete(i)}resolved(){return ai.map(ai.filter(this.locations.values(),t=>!!t.resolved),t=>[t.replacement,t.resolved])}resolve(t,i){typeof i!="object"&&(i={value:String(i)});const r=this.locations.get(t.id);if(r&&(r.resolved=i,i.value!==void 0))for(const s of r.locations||ai.empty())this._resolveAtLocation(t,s,i)}_resolveAtLocation(t,{replaceKeyName:i,propertyName:r,object:s},n,o=[]){if(n.value!==void 0){if(o.push(t.id),i&&typeof r=="string"){const a=s[r],l=r.replaceAll(t.id,n.value);delete s[r],s[l]=a,this.parseString(s,l,n.value,!0,o)}else this.parseString(s,r,n.value,!1,o),s[r]=s[r].replaceAll(t.id,n.value);o.pop()}}toObject(){return this.stringRoot?this.root.value:this.root}},rV=class{constructor(e,t,i,r){this._contributedVariables=new Map,this.resolvableVariables=new Set(iV),this._context=e,this._labelService=t,this._userHomePromise=i,r&&(this._envVariablesPromise=r.then(s=>this.prepareEnv(s)))}prepareEnv(e){if(Ve){const t=Object.create(null);return Object.keys(e).forEach(i=>{t[i.toLowerCase()]=e[i]}),t}return e}async resolveWithEnvironment(e,t,i){const r=s6.parse(i);for(const s of r.unresolved()){const n=await this.evaluateSingleVariable(s,t?.uri,e);n!==void 0&&r.resolve(s,String(n))}return r.toObject()}async resolveAsync(e,t){const i=s6.parse(t);for(const r of i.unresolved()){const s=await this.evaluateSingleVariable(r,e?.uri);s!==void 0&&i.resolve(r,String(s))}return i.toObject()}resolveWithInteractionReplace(e,t){throw new Error("resolveWithInteractionReplace not implemented.")}resolveWithInteraction(e,t){throw new Error("resolveWithInteraction not implemented.")}contributeVariable(e,t){if(this._contributedVariables.has(e))throw new Error("Variable "+e+" is contributed twice.");this.resolvableVariables.add(e),this._contributedVariables.set(e,t)}fsPath(e){return this._labelService?this._labelService.getUriLabel(e,{noPrefix:!0}):e.fsPath}async evaluateSingleVariable(e,t,i,r){const s={env:i!==void 0?this.prepareEnv(i):await this._envVariablesPromise,userHome:i!==void 0?void 0:await this._userHomePromise},{name:n,arg:o}=e,a=u=>{const d=this._context.getFilePath();if(d)return nd(d);throw new Ri(u,h(13876,null,e.id))},l=u=>{const d=a(u);if(this._context.getWorkspaceFolderPathForFile){const f=this._context.getWorkspaceFolderPathForFile();if(f)return nd(f)}throw new Ri(u,h(13877,null,e.id,bt(d)))},c=u=>{if(o){const d=this._context.getFolderUri(o);if(d)return d;throw new Ri(u,h(13878,null,u,o))}if(t)return t;throw this._context.getWorkspaceFolderCount()>1?new Ri(u,h(13879,null,u)):new Ri(u,h(13880,null,u))};switch(n){case"env":if(o){if(s.env){const u=s.env[Ve?o.toLowerCase():o];if(Oe(u))return u}return""}throw new Ri(lt.Env,h(13881,null,e.id));case"config":if(o){const u=this._context.getConfigurationValue(t,o);if(Lt(u))throw new Ri(lt.Config,h(13882,null,e.id,o));if(It(u))throw new Ri(lt.Config,h(13883,null,e.id,o));return u}throw new Ri(lt.Config,h(13884,null,e.id));case"command":return this.resolveFromMap(lt.Command,e.id,o,r,"command");case"input":return this.resolveFromMap(lt.Input,e.id,o,r,"input");case"extensionInstallFolder":if(o){const u=await this._context.getExtension(o);if(!u)throw new Ri(lt.ExtensionInstallFolder,h(13885,null,e.id,o));return this.fsPath(u.extensionLocation)}throw new Ri(lt.ExtensionInstallFolder,h(13886,null,e.id));default:switch(n){case"workspaceRoot":case"workspaceFolder":{const u=c(lt.WorkspaceFolder);return u?nd(this.fsPath(u)):void 0}case"cwd":{if(!t&&!o)return so();const u=c(lt.Cwd);return u?nd(this.fsPath(u)):void 0}case"workspaceRootFolderName":case"workspaceFolderBasename":{const u=c(lt.WorkspaceFolderBasename);return u?nd(bt(this.fsPath(u))):void 0}case"userHome":if(s.userHome)return s.userHome;throw new Ri(lt.UserHome,h(13887,null,e.id));case"lineNumber":{const u=this._context.getLineNumber();if(u)return u;throw new Ri(lt.LineNumber,h(13888,null,e.id))}case"columnNumber":{const u=this._context.getColumnNumber();if(u)return u;throw new Error(h(13889,null,e.id))}case"selectedText":{const u=this._context.getSelectedText();if(u)return u;throw new Ri(lt.SelectedText,h(13890,null,e.id))}case"file":return a(lt.File);case"fileWorkspaceFolder":return l(lt.FileWorkspaceFolder);case"fileWorkspaceFolderBasename":return bt(l(lt.FileWorkspaceFolderBasename));case"relativeFile":return t||o?Da(this.fsPath(c(lt.RelativeFile)),a(lt.RelativeFile)):a(lt.RelativeFile);case"relativeFileDirname":{const u=Bi(a(lt.RelativeFileDirname));if(t||o){const d=Da(this.fsPath(c(lt.RelativeFileDirname)),u);return d.length===0?".":d}return u}case"fileDirname":return Bi(a(lt.FileDirname));case"fileExtname":return uh(a(lt.FileExtname));case"fileBasename":return bt(a(lt.FileBasename));case"fileBasenameNoExtension":{const u=bt(a(lt.FileBasenameNoExtension));return u.slice(0,u.length-uh(u).length)}case"fileDirnameBasename":return bt(Bi(a(lt.FileDirnameBasename)));case"execPath":{const u=this._context.getExecPath();return u||e.id}case"execInstallFolder":{const u=this._context.getAppRoot();return u||e.id}case"pathSeparator":case"/":return St;default:try{return this.resolveFromMap(lt.Unknown,e.id,o,r,void 0)}catch{return e.id}}}}resolveFromMap(e,t,i,r,s){if(i&&r){const n=s===void 0?r[i]:r[s+":"+i];if(typeof n=="string")return n;throw new Ri(e,h(13891,null,t))}return t}},Vl=q("IExtHostVariableResolverProvider"),sV=class extends rV{constructor(e,t,i,r,s,n,o){function a(){if(i){const l=i.activeEditor();if(l)return l.document.uri;const c=r.tabGroups.all.find(u=>u.isActive)?.activeTab;if(c!==void 0){if(c.input instanceof Sp||c.input instanceof p0)return c.input.modified;if(c.input instanceof d0||c.input instanceof f0||c.input instanceof h0)return c.input.uri}}}super({getFolderUri:l=>{const c=n.folders.filter(u=>u.name===l);if(c&&c.length>0)return c[0].uri},getWorkspaceFolderCount:()=>n.folders.length,getConfigurationValue:(l,c)=>s.getConfiguration(void 0,l).get(c),getAppRoot:()=>so(),getExecPath:()=>gn.VSCODE_EXEC_PATH,getFilePath:()=>{const l=a();if(l)return Cs(l.fsPath)},getWorkspaceFolderPathForFile:()=>{if(t){const l=a();if(l){const c=t.getWorkspaceFolder(l);if(c)return Cs(c.uri.fsPath)}}},getSelectedText:()=>{if(i){const l=i.activeEditor();if(l&&!l.selection.isEmpty)return l.document.getText(l.selection)}},getLineNumber:()=>{if(i){const l=i.activeEditor();if(l)return String(l.selection.end.line+1)}},getColumnNumber:()=>{if(i){const l=i.activeEditor();if(l)return String(l.selection.end.character+1)}},getExtension:l=>e.getExtension(l)},void 0,o?Promise.resolve(o):void 0,Promise.resolve(gn))}},qg=class extends X{constructor(t,i,r,s,n){super(),this.extensionService=t,this.workspaceService=i,this.editorService=r,this.configurationService=s,this.editorTabs=n,this._resolver=new Si(async()=>{const o=await this.configurationService.getConfigProvider(),l={folders:await this.workspaceService.getWorkspaceFolders2()||[]};return this._register(this.workspaceService.onDidChangeWorkspace(async c=>{l.folders=await this.workspaceService.getWorkspaceFolders2()||[]})),new sV(this.extensionService,this.workspaceService,this.editorService,this.editorTabs,o,l,this.homeDir())})}getResolver(){return this._resolver.value}homeDir(){}};qg=__decorate([__param(0,Xs),__param(1,Br),__param(2,ia),__param(3,vr),__param(4,Bl)],qg);var Oy=q("IExtHostDebugService"),jg=class extends X{get onDidStartDebugSession(){return this._onDidStartDebugSession.event}get onDidTerminateDebugSession(){return this._onDidTerminateDebugSession.event}get onDidChangeActiveDebugSession(){return this._onDidChangeActiveDebugSession.event}get activeDebugSession(){return this._activeDebugSession?.api}get onDidReceiveDebugSessionCustomEvent(){return this._onDidReceiveDebugSessionCustomEvent.event}get activeDebugConsole(){return this._activeDebugConsole.value}constructor(t,i,r,s,n,o,a,l){super(),this._workspaceService=i,this._extensionService=r,this._configurationService=s,this._editorTabs=n,this._variableResolver=o,this._commands=a,this._testing=l,this._debugSessions=new Map,this._debugVisualizationTreeItemIdsCounter=0,this._debugVisualizationProviders=new Map,this._debugVisualizationTrees=new Map,this._debugVisualizationTreeItemIds=new WeakMap,this._debugVisualizationElements=new Map,this._visualizers=new Map,this._visualizerIdCounter=0,this._configProviderHandleCounter=0,this._configProviders=[],this._adapterFactoryHandleCounter=0,this._adapterFactories=[],this._trackerFactoryHandleCounter=0,this._trackerFactories=[],this._debugAdapters=new Map,this._debugAdaptersTrackers=new Map,this._onDidStartDebugSession=this._register(new D),this._onDidTerminateDebugSession=this._register(new D),this._onDidChangeActiveDebugSession=this._register(new D),this._onDidReceiveDebugSessionCustomEvent=this._register(new D),this._debugServiceProxy=t.getProxy(Q.MainThreadDebugService),this._onDidChangeBreakpoints=this._register(new D),this._onDidChangeActiveStackItem=this._register(new D),this._activeDebugConsole=new oV(this._debugServiceProxy),this._breakpoints=new Map,this._extensionService.getExtensionRegistry().then(c=>{this._register(c.onDidChange(u=>{this.registerAllDebugTypes(c)})),this.registerAllDebugTypes(c)}),this._telemetryProxy=t.getProxy(Q.MainThreadTelemetry)}async $getVisualizerTreeItem(t,i){const r=this.hydrateVisualizationContext(i);if(!r)return;const s=await this._debugVisualizationTrees.get(t)?.getTreeItem?.(r);return s?this.convertVisualizerTreeItem(t,s):void 0}registerDebugVisualizationTree(t,i,r){const s=qe.toKey(t.identifier),n=this.extensionVisKey(s,i);if(this._debugVisualizationProviders.has(n))throw new Error(`A debug visualization provider with id '${i}' is already registered`);return this._debugVisualizationTrees.set(n,r),this._debugServiceProxy.$registerDebugVisualizerTree(n,!!r.editItem),ie(()=>{this._debugServiceProxy.$unregisterDebugVisualizerTree(n),this._debugVisualizationTrees.delete(i)})}async $getVisualizerTreeItemChildren(t,i){const r=this._debugVisualizationElements.get(i)?.item;return r?(await this._debugVisualizationTrees.get(t)?.getChildren?.(r))?.map(n=>this.convertVisualizerTreeItem(t,n))||[]:[]}async $editVisualizerTreeItem(t,i){const r=this._debugVisualizationElements.get(t);if(!r)return;const s=await this._debugVisualizationTrees.get(r.provider)?.editItem?.(r.item,i);return this.convertVisualizerTreeItem(r.provider,s||r.item)}$disposeVisualizedTree(t){const i=this._debugVisualizationElements.get(t);if(!i)return;const r=[i.children];for(const s of r)if(s)for(const n of s)r.push(this._debugVisualizationElements.get(n)?.children),this._debugVisualizationElements.delete(n)}convertVisualizerTreeItem(t,i){let r=this._debugVisualizationTreeItemIds.get(i);return r||(r=this._debugVisualizationTreeItemIdsCounter++,this._debugVisualizationTreeItemIds.set(i,r),this._debugVisualizationElements.set(r,{provider:t,item:i})),pw.from(i,r)}asDebugSourceUri(t,i){const r=t;if(typeof r.sourceReference=="number"&&r.sourceReference>0){let s=`debug:${encodeURIComponent(r.path||"")}`,n="?";return i&&(s+=`${n}session=${encodeURIComponent(i.id)}`,n="&"),s+=`${n}ref=${r.sourceReference}`,b.parse(s)}else{if(r.path)return b.file(r.path);throw new Error("cannot create uri from DAP 'source' object; properties 'path' and 'sourceReference' are both missing.")}}registerAllDebugTypes(t){const i=[];for(const r of t.getAllExtensionDescriptions())if(r.contributes){const s=r.contributes.debuggers;if(s&&s.length>0)for(const n of s)WB(n)&&i.push(n.type)}this._debugServiceProxy.$registerDebugTypes(i)}get activeStackItem(){return this._activeStackItem}get onDidChangeActiveStackItem(){return this._onDidChangeActiveStackItem.event}get onDidChangeBreakpoints(){return this._onDidChangeBreakpoints.event}get breakpoints(){const t=[];return this._breakpoints.forEach(i=>t.push(i)),t}async $resolveDebugVisualizer(t,i){const r=this._visualizers.get(t);if(!r)throw new Error(`No debug visualizer found with id '${t}'`);let{v:s,provider:n,extensionId:o}=r;if(s.visualization||(s=await n.resolveDebugVisualization?.(s,i)||s,r.v=s),!s.visualization)throw new Error(`No visualization returned from resolveDebugVisualization in '${n}'`);return this.serializeVisualization(o,s.visualization)}async $executeDebugVisualizerCommand(t){const i=this._visualizers.get(t);if(!i)throw new Error(`No debug visualizer found with id '${t}'`);const r=i.v.visualization;r&&"command"in r&&this._commands.executeCommand(r.command,...r.arguments||[])}hydrateVisualizationContext(t){const i=this._debugSessions.get(t.sessionId);return i&&{session:i.api,variable:t.variable,containerId:t.containerId,frameId:t.frameId,threadId:t.threadId}}async $provideDebugVisualizers(t,i,r,s){const n=this.hydrateVisualizationContext(r),o=this.extensionVisKey(t,i),a=this._debugVisualizationProviders.get(o);if(!n||!a)return[];const l=await a.provideDebugVisualization(n,s);return l?l.map(c=>{const u=++this._visualizerIdCounter;this._visualizers.set(u,{v:c,provider:a,extensionId:t});const d=c.iconPath?this.getIconPathOrClass(c.iconPath):void 0;return{id:u,name:c.name,iconClass:d?.iconClass,iconPath:d?.iconPath,visualization:this.serializeVisualization(t,c.visualization)}}):[]}$disposeDebugVisualizers(t){for(const i of t)this._visualizers.delete(i)}registerDebugVisualizationProvider(t,i,r){if(!t.contributes?.debugVisualizers?.some(o=>o.id===i))throw new Error(`Extensions may only call registerDebugVisualizationProvider() for renderers they contribute (got ${i})`);const s=qe.toKey(t.identifier),n=this.extensionVisKey(s,i);if(this._debugVisualizationProviders.has(n))throw new Error(`A debug visualization provider with id '${i}' is already registered`);return this._debugVisualizationProviders.set(n,r),this._debugServiceProxy.$registerDebugVisualizer(s,i),ie(()=>{this._debugServiceProxy.$unregisterDebugVisualizer(s,i),this._debugVisualizationProviders.delete(i)})}addBreakpoints(t){const i=t.filter(n=>{const o=n.id;return this._breakpoints.has(o)?!1:(this._breakpoints.set(o,n),!0)});this.fireBreakpointChanges(i,[],[]);const r=[],s=new Map;for(const n of i)if(n instanceof Ho){let o=s.get(n.location.uri.toString());o||(o={type:"sourceMulti",uri:n.location.uri,lines:[]},s.set(n.location.uri.toString(),o),r.push(o)),o.lines.push({id:n.id,enabled:n.enabled,condition:n.condition,hitCondition:n.hitCondition,logMessage:n.logMessage,line:n.location.range.start.line,character:n.location.range.start.character,mode:n.mode})}else n instanceof Uo&&r.push({type:"function",id:n.id,enabled:n.enabled,hitCondition:n.hitCondition,logMessage:n.logMessage,condition:n.condition,functionName:n.functionName,mode:n.mode});return this._debugServiceProxy.$registerBreakpoints(r)}removeBreakpoints(t){const i=t.filter(o=>this._breakpoints.delete(o.id));this.fireBreakpointChanges([],i,[]);const r=i.filter(o=>o instanceof Ho).map(o=>o.id),s=i.filter(o=>o instanceof Uo).map(o=>o.id),n=i.filter(o=>o instanceof rp).map(o=>o.id);return this._debugServiceProxy.$unregisterBreakpoints(r,s,n)}startDebugging(t,i,r){const s=r.testRun&&this._testing.getMetadataForRun(r.testRun);return this._debugServiceProxy.$startDebugging(t?t.uri:void 0,i,{parentSessionID:r.parentSession?r.parentSession.id:void 0,lifecycleManagedByParent:r.lifecycleManagedByParent,repl:r.consoleMode===cp.MergeWithParent?"mergeWithParent":"separate",noDebug:r.noDebug,compact:r.compact,suppressSaveBeforeStart:r.suppressSaveBeforeStart,testRun:s&&{runId:s.runId,taskId:s.taskId},suppressDebugStatusbar:r.suppressDebugStatusbar??r.debugUI?.simple,suppressDebugToolbar:r.suppressDebugToolbar??r.debugUI?.simple,suppressDebugView:r.suppressDebugView??r.debugUI?.simple})}stopDebugging(t){return this._debugServiceProxy.$stopDebugging(t?t.id:void 0)}registerDebugConfigurationProvider(t,i,r){if(!i)return new Ie(()=>{});const s=this._configProviderHandleCounter++;return this._configProviders.push({type:t,handle:s,provider:i}),this._debugServiceProxy.$registerDebugConfigurationProvider(t,r,!!i.provideDebugConfigurations,!!i.resolveDebugConfiguration,!!i.resolveDebugConfigurationWithSubstitutedVariables,s),new Ie(()=>{this._configProviders=this._configProviders.filter(n=>n.provider!==i),this._debugServiceProxy.$unregisterDebugConfigurationProvider(s)})}registerDebugAdapterDescriptorFactory(t,i,r){if(!r)return new Ie(()=>{});if(!this.definesDebugType(t,i))throw new Error(`a DebugAdapterDescriptorFactory can only be registered from the extension that defines the '${i}' debugger.`);if(this.getAdapterDescriptorFactoryByType(i))throw new Error("a DebugAdapterDescriptorFactory can only be registered once per a type.");const s=this._adapterFactoryHandleCounter++;return this._adapterFactories.push({type:i,handle:s,factory:r}),this._debugServiceProxy.$registerDebugAdapterDescriptorFactory(i,s),new Ie(()=>{this._adapterFactories=this._adapterFactories.filter(n=>n.factory!==r),this._debugServiceProxy.$unregisterDebugAdapterDescriptorFactory(s)})}registerDebugAdapterTrackerFactory(t,i){if(!i)return new Ie(()=>{});const r=this._trackerFactoryHandleCounter++;return this._trackerFactories.push({type:t,handle:r,factory:i}),new Ie(()=>{this._trackerFactories=this._trackerFactories.filter(s=>s.factory!==i)})}async $runInTerminal(t,i){return Promise.resolve(void 0)}async $substituteVariables(t,i){let r;const s=await this.getFolder(t);return s&&(r={uri:s.uri,name:s.name,index:s.index,toResource:()=>{throw new Error("Not implemented")}}),(await this._variableResolver.getResolver()).resolveAsync(r,i)}createDebugAdapter(t,i){if(t instanceof vu)return new lV(t.implementation)}createSignService(){}async $startDASession(t,i){const r=this,s=await this.getSession(i);return this.getAdapterDescriptor(this.getAdapterDescriptorFactoryByType(s.type),s).then(n=>{if(!n)throw new Error(`Couldn't find a debug adapter descriptor for debug type '${s.type}' (extension might have failed to activate)`);const o=this.createDebugAdapter(n,s);if(!o)throw new Error(`Couldn't create a debug adapter for type '${s.type}'.`);const a=o;return this._debugAdapters.set(t,a),this.getDebugAdapterTrackers(s).then(l=>(l&&this._debugAdaptersTrackers.set(t,l),a.onMessage(async c=>{if(c.type==="request"&&c.command==="handshake"){const u=c,d={type:"response",seq:0,command:u.command,request_seq:u.seq,success:!0};this._signService||(this._signService=this.createSignService());try{if(this._signService){const f=await this._signService.sign(u.arguments.value);d.body={signature:f},a.sendResponse(d)}else throw new Error("no signer")}catch(f){d.success=!1,d.message=f.message,a.sendResponse(d)}}else{l&&l.onDidSendMessage&&l.onDidSendMessage(c);try{c=qB(c,!0)}catch(u){const d=c.type+"_"+(c.command??c.event??"");throw this._telemetryProxy.$publicLog2("debugProtocolMessageError",{type:d,from:s.type}),u}r._debugServiceProxy.$acceptDAMessage(t,c)}}),a.onError(c=>{l&&l.onError&&l.onError(c),this._debugServiceProxy.$acceptDAError(t,c.name,c.message,c.stack)}),a.onExit(c=>{l&&l.onExit&&l.onExit(c??void 0,void 0),this._debugServiceProxy.$acceptDAExit(t,c??void 0,void 0)}),l&&l.onWillStartSession&&l.onWillStartSession(),a.startSession()))})}$sendDAMessage(t,i){i=zB(i,!1);const r=this._debugAdaptersTrackers.get(t);r&&r.onWillReceiveMessage&&r.onWillReceiveMessage(i),this._debugAdapters.get(t)?.sendMessage(i)}$stopDASession(t){const i=this._debugAdaptersTrackers.get(t);this._debugAdaptersTrackers.delete(t),i&&i.onWillStopSession&&i.onWillStopSession();const r=this._debugAdapters.get(t);return this._debugAdapters.delete(t),r?r.stopSession():Promise.resolve(void 0)}$acceptBreakpointsDelta(t){const i=[],r=[],s=[];if(t.added)for(const n of t.added){const o=n.id;if(o&&!this._breakpoints.has(o)){let a;if(n.type==="function")a=new Uo(n.functionName,n.enabled,n.condition,n.hitCondition,n.logMessage,n.mode);else if(n.type==="data")a=new rp(n.label,n.dataId,n.canPersist,n.enabled,n.hitCondition,n.condition,n.logMessage,n.mode);else{const l=b.revive(n.uri);a=new Ho(new nr(l,new Te(n.line,n.character)),n.enabled,n.condition,n.hitCondition,n.logMessage,n.mode)}iU(a,o),this._breakpoints.set(o,a),i.push(a)}}if(t.removed)for(const n of t.removed){const o=this._breakpoints.get(n);o&&(this._breakpoints.delete(n),r.push(o))}if(t.changed){for(const n of t.changed)if(n.id){const o=this._breakpoints.get(n.id);if(o){if(o instanceof Uo&&n.type==="function"){const a=o;a.enabled=n.enabled,a.condition=n.condition,a.hitCondition=n.hitCondition,a.logMessage=n.logMessage,a.functionName=n.functionName}else if(o instanceof Ho&&n.type==="source"){const a=o;a.enabled=n.enabled,a.condition=n.condition,a.hitCondition=n.hitCondition,a.logMessage=n.logMessage,a.location=new nr(b.revive(n.uri),new Te(n.line,n.character))}s.push(o)}}}this.fireBreakpointChanges(i,r,s)}async $acceptStackFrameFocus(t){let i;if(t){const r=await this.getSession(t.sessionId);t.kind==="thread"?i=new b4(r.api,t.threadId):i=new y4(r.api,t.threadId,t.frameId)}this._activeStackItem=i,this._onDidChangeActiveStackItem.fire(this._activeStackItem)}$provideDebugConfigurations(t,i,r){return ci(async()=>{const s=this.getConfigProviderByHandle(t);if(!s)throw new Error("no DebugConfigurationProvider found");if(!s.provideDebugConfigurations)throw new Error("DebugConfigurationProvider has no method provideDebugConfigurations");const n=await this.getFolder(i);return s.provideDebugConfigurations(n,r)}).then(s=>{if(!s)throw new Error("nothing returned from DebugConfigurationProvider.provideDebugConfigurations");return s})}$resolveDebugConfiguration(t,i,r,s){return ci(async()=>{const n=this.getConfigProviderByHandle(t);if(!n)throw new Error("no DebugConfigurationProvider found");if(!n.resolveDebugConfiguration)throw new Error("DebugConfigurationProvider has no method resolveDebugConfiguration");const o=await this.getFolder(i);return n.resolveDebugConfiguration(o,r,s)})}$resolveDebugConfigurationWithSubstitutedVariables(t,i,r,s){return ci(async()=>{const n=this.getConfigProviderByHandle(t);if(!n)throw new Error("no DebugConfigurationProvider found");if(!n.resolveDebugConfigurationWithSubstitutedVariables)throw new Error("DebugConfigurationProvider has no method resolveDebugConfigurationWithSubstitutedVariables");const o=await this.getFolder(i);return n.resolveDebugConfigurationWithSubstitutedVariables(o,r,s)})}async $provideDebugAdapter(t,i){const r=this.getAdapterDescriptorFactoryByHandle(t);if(!r)return Promise.reject(new Error("no adapter descriptor factory found for handle"));const s=await this.getSession(i);return this.getAdapterDescriptor(r,s).then(n=>{if(!n)throw new Error(`Couldn't find a debug adapter descriptor for debug type '${s.type}'`);return this.convertToDto(n)})}async $acceptDebugSessionStarted(t){const i=await this.getSession(t);this._onDidStartDebugSession.fire(i.api)}async $acceptDebugSessionTerminated(t){const i=await this.getSession(t);i&&(this._onDidTerminateDebugSession.fire(i.api),this._debugSessions.delete(i.id))}async $acceptDebugSessionActiveChanged(t){this._activeDebugSession=t?await this.getSession(t):void 0,this._onDidChangeActiveDebugSession.fire(this._activeDebugSession?.api)}async $acceptDebugSessionNameChanged(t,i){(await this.getSession(t))?._acceptNameChanged(i)}async $acceptDebugSessionCustomEvent(t,i){const s={session:(await this.getSession(t)).api,event:i.event,body:i.body};this._onDidReceiveDebugSessionCustomEvent.fire(s)}convertToDto(t){if(t instanceof dl)return this.convertExecutableToDto(t);if(t instanceof hl)return this.convertServerToDto(t);if(t instanceof mu)return this.convertPipeServerToDto(t);if(t instanceof vu)return this.convertImplementationToDto(t);throw new Error("convertToDto unexpected type")}convertExecutableToDto(t){return{type:"executable",command:t.command,args:t.args,options:t.options}}convertServerToDto(t){return{type:"server",port:t.port,host:t.host}}convertPipeServerToDto(t){return{type:"pipeServer",path:t.path}}convertImplementationToDto(t){return{type:"implementation"}}getAdapterDescriptorFactoryByType(t){const i=this._adapterFactories.filter(r=>r.type===t);if(i.length>0)return i[0].factory}getAdapterDescriptorFactoryByHandle(t){const i=this._adapterFactories.filter(r=>r.handle===t);if(i.length>0)return i[0].factory}getConfigProviderByHandle(t){const i=this._configProviders.filter(r=>r.handle===t);if(i.length>0)return i[0].provider}definesDebugType(t,i){if(t.contributes){const r=t.contributes.debuggers;if(r&&r.length>0){for(const s of r)if(s.label&&s.type&&s.type===i)return!0}}return!1}getDebugAdapterTrackers(t){const r=t.configuration.type,s=this._trackerFactories.filter(n=>n.type===r||n.type==="*").map(n=>ci(()=>n.factory.createDebugAdapterTracker(t.api)).then(o=>o,o=>null));return Promise.race([Promise.all(s).then(n=>{const o=Et(n);if(o.length>0)return new aV(o)}),new Promise(n=>setTimeout(()=>n(void 0),1e3))]).catch(n=>{})}async getAdapterDescriptor(t,i){const r=i.configuration.debugServer;if(typeof r=="number")return Promise.resolve(new hl(r));if(t){const n=await this._extensionService.getExtensionRegistry();return ci(()=>t.createDebugAdapterDescriptor(i.api,this.daExecutableFromPackage(i,n))).then(o=>{if(o)return o})}const s=await this._extensionService.getExtensionRegistry();return Promise.resolve(this.daExecutableFromPackage(i,s))}daExecutableFromPackage(t,i){}fireBreakpointChanges(t,i,r){(t.length>0||i.length>0||r.length>0)&&this._onDidChangeBreakpoints.fire(Object.freeze({added:t,removed:i,changed:r}))}async getSession(t){if(t)if(typeof t=="string"){const i=this._debugSessions.get(t);if(i)return i}else{let i=this._debugSessions.get(t.id);if(!i){const r=await this.getFolder(t.folderUri),s=t.parent?this._debugSessions.get(t.parent):void 0;i=new nV(this._debugServiceProxy,t.id,t.type,t.name,r,t.configuration,s?.api),this._debugSessions.set(i.id,i),this._debugServiceProxy.$sessionCached(i.id)}return i}throw new Error("cannot find session")}getFolder(t){if(t){const i=b.revive(t);return this._workspaceService.resolveWorkspaceFolder(i)}return Promise.resolve(void 0)}extensionVisKey(t,i){return`${t}\0${i}`}serializeVisualization(t,i){if(i){if("title"in i&&"command"in i)return{type:0};if("treeId"in i)return{type:1,id:`${t}\0${i.treeId}`};throw new Error("Unsupported debug visualization type")}}getIconPathOrClass(t){const i=this.getIconUris(t);let r,s;return"id"in i?s=Wt.asClassName(i):r=i,{iconPath:r,iconClass:s}}getIconUris(t){if(t instanceof pi)return{id:t.id};const i=typeof t=="object"&&"dark"in t?t.dark:t,r=typeof t=="object"&&"light"in t?t.light:t;return{dark:typeof i=="string"?b.file(i):i,light:typeof r=="string"?b.file(r):r}}};jg=__decorate([__param(0,Pe),__param(1,Br),__param(2,Xs),__param(3,vr),__param(4,Bl),__param(5,Vl),__param(6,Vr),__param(7,gd)],jg);var nV=class{constructor(e,t,i,r,s,n,o){this._debugServiceProxy=e,this._id=t,this._type=i,this._name=r,this._workspaceFolder=s,this._configuration=n,this._parentSession=o}get api(){const e=this;return this.apiSession??=Object.freeze({id:e._id,type:e._type,get name(){return e._name},set name(t){e._name=t,e._debugServiceProxy.$setDebugSessionName(e._id,t)},parentSession:e._parentSession,workspaceFolder:e._workspaceFolder,configuration:e._configuration,customRequest(t,i){return e._debugServiceProxy.$customDebugAdapterRequest(e._id,t,i)},getDebugProtocolBreakpoint(t){return e._debugServiceProxy.$getDebugProtocolBreakpoint(e._id,t.id)}})}get id(){return this._id}get type(){return this._type}_acceptNameChanged(e){this._name=e}get configuration(){return this._configuration}},oV=class{constructor(e){this.value=Object.freeze({append(t){e.$appendDebugConsole(t)},appendLine(t){this.append(t+`
`)}})}},aV=class{constructor(e){this.trackers=e}onWillStartSession(){this.trackers.forEach(e=>e.onWillStartSession?e.onWillStartSession():void 0)}onWillReceiveMessage(e){this.trackers.forEach(t=>t.onWillReceiveMessage?t.onWillReceiveMessage(e):void 0)}onDidSendMessage(e){this.trackers.forEach(t=>t.onDidSendMessage?t.onDidSendMessage(e):void 0)}onWillStopSession(){this.trackers.forEach(e=>e.onWillStopSession?e.onWillStopSession():void 0)}onError(e){this.trackers.forEach(t=>t.onError?t.onError(e):void 0)}onExit(e,t){this.trackers.forEach(i=>i.onExit?i.onExit(e,t):void 0)}},lV=class extends QT{constructor(e){super(),this.implementation=e,e.onDidSendMessage(t=>{this.acceptMessage(t)})}startSession(){return Promise.resolve(void 0)}sendMessage(e){this.implementation.handleMessage(e)}stopSession(){return this.implementation.dispose(),Promise.resolve(void 0)}},Fy=class extends jg{constructor(t,i,r,s,n,o,a,l){super(t,i,r,s,n,o,a,l)}};Fy=__decorate([__param(0,Pe),__param(1,Br),__param(2,Xs),__param(3,vr),__param(4,Bl),__param(5,Vl),__param(6,Vr),__param(7,gd)],Fy);function cV(e){return"uri"in e&&"ranges"in e&&"preview"in e}function uV(e){return e.folderOptions.map(t=>({folder:t.folder,excludes:t.excludes.map(i=>typeof i=="string"?i:i.pattern),includes:t.includes,useGlobalIgnoreFiles:t.useIgnoreFiles.global,useIgnoreFiles:t.useIgnoreFiles.local,useParentIgnoreFiles:t.useIgnoreFiles.parent,followSymlinks:t.followSymlinks,maxResults:e.maxResults,session:e.session}))}var n6=class{constructor(e){this.provider=e}provideFileSearchResults(e,t,i){return(async()=>{const s=uV(t);return Promise.all(s.map(n=>this.provider.provideFileSearchResults({pattern:e},n,i)))})().then(s=>Et(s).flat())}};function dV(e){return e.folderOptions.map(t=>({folder:t.folder,excludes:t.excludes.map(i=>typeof i=="string"?i:i.pattern),includes:t.includes,useGlobalIgnoreFiles:t.useIgnoreFiles.global,useIgnoreFiles:t.useIgnoreFiles.local,useParentIgnoreFiles:t.useIgnoreFiles.parent,followSymlinks:t.followSymlinks,maxResults:e.maxResults,previewOptions:o6(e.previewOptions),maxFileSize:e.maxFileSize,encoding:t.encoding,afterContext:e.surroundingContext,beforeContext:e.surroundingContext}))}function o6(e){return{matchLines:e?.matchLines??Sw.matchLines,charsPerLine:e?.charsPerLine??Sw.charsPerLine}}function hV(e){if(cV(e)){const t=er(e.ranges).map((i,r)=>{const n=er(e.preview.matches)[r];return{sourceRange:i,previewRange:n}});return new Gs(e.uri,t,e.preview.text)}else return new pg(e.uri,e.text,e.lineNumber)}var fV=class{constructor(e){this.provider=e}provideTextSearchResults(e,t,i,r){const s=a=>{pV(a)&&i.report(hV(a))};return(async()=>Et(await Promise.all(dV(t).map(a=>this.provider.provideTextSearchResults(e,a,{report:l=>s(l)},r)))).reduce((a,l)=>({limitHit:a.limitHit||l.limitHit}),{limitHit:!1}))().then(a=>({limitHit:a.limitHit,message:Et(er(a.message))}))}};function pV(e){if(gV(e)){if(Array.isArray(e.ranges)){if(!Array.isArray(e.preview.matches))return console.warn("INVALID - A text search provider match's`ranges` and`matches` properties must have the same type."),!1;if(e.preview.matches.length!==e.ranges.length)return console.warn("INVALID - A text search provider match's`ranges` and`matches` properties must have the same length."),!1}else if(Array.isArray(e.preview.matches))return console.warn("INVALID - A text search provider match's`ranges` and`matches` properties must have the same length."),!1}return!0}function gV(e){return!!e.preview}var a6=class extends xn{constructor(e,t,i=()=>!1){const r=new wD(i,()=>!1);super(r);const s=new Vt;e.forEach((n,o)=>{const a=n.folder.with({query:"",fragment:""});s.has(a)?s.get(a).push({fq:n,i:o}):s.set(a,[{fq:n,i:o}])}),s.forEach((n,o)=>{const a=new Map;for(const l of n){const c=t(l.fq,l.i);a.set(this.encodeKey(l.fq.folder),c)}super.set(o,a)})}findQueryFragmentAwareSubstr(e){const t=super.findSubstr(e.with({query:"",fragment:""}));if(!t)return;const i=this.encodeKey(e);return t.get(i)}forEachFolderQueryInfo(e){return this.forEach(t=>t.forEach(i=>e(i)))}encodeKey(e){let t="";return e.query&&(t+=e.query),e.fragment&&(t+="#"+e.fragment),t}},mV=class{constructor(e,t,i){this.config=e,this.provider=t,this.sessionLifecycle=i,this.isLimitHit=!1,this.resultCount=0,this.isCanceled=!1,this.filePattern=e.filePattern,this.includePattern=e.includePattern&&Lr(e.includePattern),this.maxResults=e.maxResults||void 0,this.exists=e.exists,this.activeCancellationTokens=new Set,this.globalExcludePattern=e.excludePattern&&Lr(e.excludePattern)}cancel(){this.isCanceled=!0,this.activeCancellationTokens.forEach(e=>e.cancel()),this.activeCancellationTokens=new Set}search(e){const t=this.config.folderQueries||[];return new Promise((i,r)=>{const s=n=>{this.resultCount++,e(n)};if(this.isCanceled)return i({limitHit:this.isLimitHit});this.config.extraFileResources&&this.config.extraFileResources.forEach(n=>{const o=n.toString(),a=bt(o);this.globalExcludePattern&&this.globalExcludePattern(o,a)||this.matchFile(s,{base:n,basename:a})}),this.doSearch(t,s).then(n=>{i({limitHit:this.isLimitHit,stats:n||void 0})},n=>{r(new Error(es(n)))})})}async doSearch(e,t){const i=new rt,r=e.map(c=>this.getSearchOptionsForFolder(c)),s=this.provider instanceof n6?this.sessionLifecycle?.tokenSource.token:this.sessionLifecycle?.obj,n={folderOptions:r,maxResults:this.config.maxResults??mg,session:s},o=c=>{const u=new f5(this.config,c),d=!u.hasSiblingExcludeClauses();return{queryTester:u,noSiblingsClauses:d,folder:c.folder,tree:this.initDirectoryTree()}},a=new a6(e,o);let l;try{this.activeCancellationTokens.add(i),l=Hi.create();const c=await this.provider.provideFileSearchResults(this.config.filePattern||"",n,i.token),u=l.elapsed(),d=Hi.create();return this.isCanceled&&!this.isLimitHit||(c&&c.forEach(f=>{const p=a.findQueryFragmentAwareSubstr(f),g=$e.relative(p.folder.path,f.path);if(p.noSiblingsClauses){const v=bt(f.path);this.matchFile(t,{base:p.folder,relativePath:g,basename:v});return}this.addDirectoryEntries(p.tree,p.folder,g,t)}),this.isCanceled&&!this.isLimitHit)?null:(a.forEachFolderQueryInfo(f=>{this.matchDirectoryTree(f.tree,f.queryTester,t)}),{providerTime:u,postProcessTime:d.elapsed()})}finally{i.dispose(),this.activeCancellationTokens.delete(i)}}getSearchOptionsForFolder(e){const t=Ml(this.config.includePattern,e.includePattern);let i=e.excludePattern?.map(s=>({folder:s.folder,patterns:Ml(this.config.excludePattern,s.pattern)}));i?.length||(i=[{folder:void 0,patterns:Ml(this.config.excludePattern,void 0)}]);const r=g5(i);return{folder:e.folder,excludes:r,includes:t,useIgnoreFiles:{local:!e.disregardIgnoreFiles,parent:!e.disregardParentIgnoreFiles,global:!e.disregardGlobalIgnoreFiles},followSymlinks:!e.ignoreSymlinks}}initDirectoryTree(){const e={rootEntries:[],pathToEntries:Object.create(null)};return e.pathToEntries["."]=e.rootEntries,e}addDirectoryEntries({pathToEntries:e},t,i,r){if(i===this.filePattern){const n=bt(this.filePattern);this.matchFile(r,{base:t,relativePath:this.filePattern,basename:n})}function s(n){const o=bt(n),a=Bi(n);let l=e[a];l||(l=e[a]=[],s(a)),l.push({base:t,relativePath:n,basename:o})}s(i)}matchDirectoryTree({rootEntries:e,pathToEntries:t},i,r){const s=this,n=this.filePattern;function o(a){const l=bw(()=>a.map(c=>c.basename));for(let c=0,u=a.length;c<u;c++){const d=a[c],{relativePath:f,basename:p}=d;if(i.matchesExcludesSync(f,p,n!==p?l:void 0))continue;const g=t[f];if(g)o(g);else{if(f===n)continue;s.matchFile(r,d)}if(s.isLimitHit)break}}o(e)}matchFile(e,t){(!this.includePattern||t.relativePath&&this.includePattern(t.relativePath,t.basename))&&((this.exists||this.maxResults&&this.resultCount>=this.maxResults)&&(this.isLimitHit=!0,this.cancel()),this.isLimitHit||e(t))}},vV=class{constructor(){this._obj=new Object,this.tokenSource=new rt}get obj(){if(this._obj)return this._obj;throw new Error("Session object has been dereferenced.")}cancel(){this.tokenSource.cancel(),this._obj=void 0}},_V=class k8{constructor(){this.sessions=new Map}static{this.BATCH_SIZE=512}fileSearch(t,i,r,s){const n=this.getSessionTokenSource(t.cacheKey),o=new mV(t,i,n);let a=0;const l=c=>{a+=c.length,r(c.map(u=>this.rawMatchToSearchItem(u)))};return this.doSearch(o,k8.BATCH_SIZE,l,s).then(c=>({limitHit:c.limitHit,stats:c.stats?{fromCache:!1,type:"fileSearchProvider",resultCount:a,detailStats:c.stats}:void 0,messages:[]}))}clearCache(t){this.sessions.get(t)?.cancel(),this.sessions.delete(t)}getSessionTokenSource(t){if(t)return this.sessions.has(t)||this.sessions.set(t,new vV),this.sessions.get(t)}rawMatchToSearchItem(t){return t.relativePath?{resource:Dt(t.base,t.relativePath)}:{resource:t.base}}doSearch(t,i,r,s){const n=s.onCancellationRequested(()=>{t.cancel()}),o=l=>{l&&(a.push(l),i>0&&a.length>=i&&(r(a),a=[]))};let a=[];return t.search(o).then(l=>(a.length&&r(a),n.dispose(),l),l=>(a.length&&r(a),n.dispose(),Promise.reject(l)))}},$y=class{constructor(e,t,i){this.queryProviderPair=e,this.fileUtils=t,this.processType=i,this.collector=null,this.isLimitHit=!1,this.resultCount=0}get query(){return this.queryProviderPair.query}search(e,t,i){const r=this.query.folderQueries||[],s=new rt(t);return new Promise((n,o)=>{this.collector=new yV(e);let a=!1;const l=(c,u)=>{if(!(c instanceof vw)&&!a&&!this.isLimitHit){const d=this.resultSize(c);c instanceof Gs&&typeof this.query.maxResults=="number"&&this.resultCount+d>this.query.maxResults&&(this.isLimitHit=!0,a=!0,s.cancel(),c=this.trimResultToSize(c,this.query.maxResults-this.resultCount));const f=this.resultSize(c);this.resultCount+=f;const p=c instanceof Gs;(f>0||!p)&&this.collector.add(c,u)}};this.doSearch(r,l,s.token,i).then(c=>{s.dispose(),this.collector.flush(),n({limitHit:this.isLimitHit||c?.limitHit,messages:this.getMessagesFromResults(c),stats:{type:this.processType}})},c=>{s.dispose();const u=es(c);o(new Error(u))})})}getMessagesFromResults(e){return e?.message?Array.isArray(e.message)?e.message:[e.message]:[]}resultSize(e){return e instanceof Gs?Array.isArray(e.ranges)?e.ranges.length:1:0}trimResultToSize(e,t){return new Gs(e.uri,e.ranges.slice(0,t),e.previewText)}async doSearch(e,t,i,r){const s=new a6(e,(u,d)=>({queryTester:new f5(this.query,u),folder:u.folder,folderIdx:d}),()=>!0),n=[],o={report:u=>{if(u instanceof vw)r?.(u);else{if(u.uri===void 0)throw Error("Text search result URI is undefined. Please check provider implementation.");const d=s.findQueryFragmentAwareSubstr(u.uri),f=d.folder.scheme===V.file?IU(()=>this.fileUtils.readdir(bc(u.uri))):void 0,p=hE(d.folder,u.uri);if(p){const g=d.queryTester.includedInQuery(p,bt(p),f);wn(g)?n.push(g.then(v=>{v&&t(u,d.folderIdx)})):g&&t(u,d.folderIdx)}}}},l={folderOptions:e.map(u=>this.getSearchOptionsForFolder(u)),maxFileSize:this.query.maxFileSize,maxResults:this.query.maxResults??mg,previewOptions:this.query.previewOptions??Sw,surroundingContext:this.query.surroundingContext??0};"usePCRE2"in this.query&&(l.usePCRE2=this.query.usePCRE2);let c;return this.queryProviderPair.query.type===3?c=await this.queryProviderPair.provider.provideAITextSearchResults(this.queryProviderPair.query.contentPattern,l,o,i):c=await this.queryProviderPair.provider.provideTextSearchResults(wV(this.queryProviderPair.query.contentPattern),l,o,i),n.length&&await Promise.all(n),c}getSearchOptionsForFolder(e){const t=Ml(this.query.includePattern,e.includePattern);let i=e.excludePattern?.map(n=>({folder:n.folder,patterns:Ml(this.query.excludePattern,n.pattern)}));(!i||i.length===0)&&(i=[{folder:void 0,patterns:Ml(this.query.excludePattern,void 0)}]);const r=g5(i);return{folder:b.from(e.folder),excludes:r,includes:t,useIgnoreFiles:{local:!e.disregardIgnoreFiles,parent:!e.disregardParentIgnoreFiles,global:!e.disregardGlobalIgnoreFiles},followSymlinks:!e.ignoreSymlinks,encoding:(e.fileEncoding&&this.fileUtils.toCanonicalName(e.fileEncoding))??""}}};function wV(e){return{isCaseSensitive:e.isCaseSensitive||!1,isRegExp:e.isRegExp||!1,isWordMatch:e.isWordMatch||!1,isMultiline:e.isMultiline||!1,pattern:e.pattern}}var yV=class{constructor(e){this._onResult=e,this._currentFolderIdx=-1,this._currentFileMatch=null,this._batchedCollector=new SV(512,t=>this.sendItems(t))}add(e,t){this._currentFileMatch&&(this._currentFolderIdx!==t||!lo(this._currentUri,e.uri))&&(this.pushToCollector(),this._currentFileMatch=null),this._currentFileMatch||(this._currentFolderIdx=t,this._currentFileMatch={resource:e.uri,results:[]}),this._currentFileMatch.results.push(bV(e))}pushToCollector(){const e=this._currentFileMatch&&this._currentFileMatch.results?this._currentFileMatch.results.length:0;this._batchedCollector.addItem(this._currentFileMatch,e)}flush(){this.pushToCollector(),this._batchedCollector.flush()}sendItems(e){this._onResult(e)}};function bV(e){return e instanceof Gs?{previewText:e.previewText,rangeLocations:e.ranges.map(t=>({preview:{startLineNumber:t.previewRange.start.line,startColumn:t.previewRange.start.character,endLineNumber:t.previewRange.end.line,endColumn:t.previewRange.end.character},source:{startLineNumber:t.sourceRange.start.line,startColumn:t.sourceRange.start.character,endLineNumber:t.sourceRange.end.line,endColumn:t.sourceRange.end.character}}))}:{text:e.text,lineNumber:e.lineNumber}}var SV=class $S{static{this.TIMEOUT=4e3}static{this.START_BATCH_AFTER_COUNT=50}constructor(t,i){this.maxBatchSize=t,this.cb=i,this.totalNumberCompleted=0,this.batch=[],this.batchSize=0}addItem(t,i){t&&this.addItemToBatch(t,i)}addItems(t,i){t&&this.addItemsToBatch(t,i)}addItemToBatch(t,i){this.batch.push(t),this.batchSize+=i,this.onUpdate()}addItemsToBatch(t,i){this.batch=this.batch.concat(t),this.batchSize+=i,this.onUpdate()}onUpdate(){this.totalNumberCompleted<$S.START_BATCH_AFTER_COUNT?this.flush():this.batchSize>=this.maxBatchSize?this.flush():this.timeoutHandle||(this.timeoutHandle=setTimeout(()=>{this.flush()},$S.TIMEOUT))}flush(){this.batchSize&&(this.totalNumberCompleted+=this.batchSize,this.cb(this.batch),this.batch=[],this.batchSize=0,this.timeoutHandle&&(clearTimeout(this.timeoutHandle),this.timeoutHandle=0))}},Hy=q("IExtHostSearch"),Gg=class{constructor(t,i,r){this.extHostRpc=t,this._uriTransformer=i,this._logService=r,this._proxy=this.extHostRpc.getProxy(Q.MainThreadSearch),this._handlePool=0,this._textSearchProvider=new Map,this._textSearchUsedSchemes=new Set,this._aiTextSearchProvider=new Map,this._aiTextSearchUsedSchemes=new Set,this._fileSearchProvider=new Map,this._fileSearchUsedSchemes=new Set,this._fileSearchManager=new _V}_transformScheme(t){return this._uriTransformer.transformOutgoingScheme(t)}registerTextSearchProviderOld(t,i){if(this._textSearchUsedSchemes.has(t))throw new Error(`a text search provider for the scheme '${t}' is already registered`);this._textSearchUsedSchemes.add(t);const r=this._handlePool++;return this._textSearchProvider.set(r,new fV(i)),this._proxy.$registerTextSearchProvider(r,this._transformScheme(t)),ie(()=>{this._textSearchUsedSchemes.delete(t),this._textSearchProvider.delete(r),this._proxy.$unregisterProvider(r)})}registerTextSearchProvider(t,i){if(this._textSearchUsedSchemes.has(t))throw new Error(`a text search provider for the scheme '${t}' is already registered`);this._textSearchUsedSchemes.add(t);const r=this._handlePool++;return this._textSearchProvider.set(r,i),this._proxy.$registerTextSearchProvider(r,this._transformScheme(t)),ie(()=>{this._textSearchUsedSchemes.delete(t),this._textSearchProvider.delete(r),this._proxy.$unregisterProvider(r)})}registerAITextSearchProvider(t,i){if(this._aiTextSearchUsedSchemes.has(t))throw new Error(`an AI text search provider for the scheme '${t}'is already registered`);this._aiTextSearchUsedSchemes.add(t);const r=this._handlePool++;return this._aiTextSearchProvider.set(r,i),this._proxy.$registerAITextSearchProvider(r,this._transformScheme(t)),ie(()=>{this._aiTextSearchUsedSchemes.delete(t),this._aiTextSearchProvider.delete(r),this._proxy.$unregisterProvider(r)})}registerFileSearchProviderOld(t,i){if(this._fileSearchUsedSchemes.has(t))throw new Error(`a file search provider for the scheme '${t}' is already registered`);this._fileSearchUsedSchemes.add(t);const r=this._handlePool++;return this._fileSearchProvider.set(r,new n6(i)),this._proxy.$registerFileSearchProvider(r,this._transformScheme(t)),ie(()=>{this._fileSearchUsedSchemes.delete(t),this._fileSearchProvider.delete(r),this._proxy.$unregisterProvider(r)})}registerFileSearchProvider(t,i){if(this._fileSearchUsedSchemes.has(t))throw new Error(`a file search provider for the scheme '${t}' is already registered`);this._fileSearchUsedSchemes.add(t);const r=this._handlePool++;return this._fileSearchProvider.set(r,i),this._proxy.$registerFileSearchProvider(r,this._transformScheme(t)),ie(()=>{this._fileSearchUsedSchemes.delete(t),this._fileSearchProvider.delete(r),this._proxy.$unregisterProvider(r)})}$provideFileSearchResults(t,i,r,s){const n=Qg(r),o=this._fileSearchProvider.get(t);if(o)return this._fileSearchManager.fileSearch(n,o,a=>{this._proxy.$handleFileMatch(t,i,a.map(l=>l.resource))},s);throw new Error("unknown provider: "+t)}async doInternalFileSearchWithCustomCallback(t,i,r){return{messages:[]}}$clearCache(t){return this._fileSearchManager.clearCache(t),Promise.resolve(void 0)}$provideTextSearchResults(t,i,r,s){const n=this._textSearchProvider.get(t);if(!n||!n.provideTextSearchResults)throw new Error(`Unknown Text Search Provider ${t}`);const o=Qg(r);return this.createTextSearchManager(o,n).search(l=>this._proxy.$handleTextMatch(t,i,l),s)}$provideAITextSearchResults(t,i,r,s){const n=this._aiTextSearchProvider.get(t);if(!n||!n.provideAITextSearchResults)throw new Error(`Unknown AI Text Search Provider ${t}`);const o=Qg(r);return this.createAITextSearchManager(o,n).search(l=>this._proxy.$handleTextMatch(t,i,l),s,l=>this._proxy.$handleKeywordResult(t,i,l))}$enableExtensionHostSearch(){}async $getAIName(t){const i=this._aiTextSearchProvider.get(t);if(!(!i||!i.provideAITextSearchResults))return i.name??"AI"}createTextSearchManager(t,i){return new $y({query:t,provider:i},{readdir:r=>Promise.resolve([]),toCanonicalName:r=>r},"textSearchProvider")}createAITextSearchManager(t,i){return new $y({query:t,provider:i},{readdir:r=>Promise.resolve([]),toCanonicalName:r=>r},"aiTextSearchProvider")}};Gg=__decorate([__param(0,Pe),__param(1,Nc),__param(2,ke)],Gg);function Qg(e){return{...e,folderQueries:e.folderQueries&&e.folderQueries.map(xV),extraFileResources:e.extraFileResources&&e.extraFileResources.map(t=>b.revive(t))}}function xV(e){return kt(e)}var Uy,Wy=class{static{Uy=this}static{this.InitialState={focused:!0,active:!0}}getState(){const t=this._state;return{get focused(){return t.focused},get active(){return t.active}}}constructor(t,i){this._onDidChangeWindowState=new D,this.onDidChangeWindowState=this._onDidChangeWindowState.event,this._state=Uy.InitialState,t.handle&&(this._nativeHandle=Dh(t.handle).buffer),this._proxy=i.getProxy(Q.MainThreadWindow),this._proxy.$getInitialState().then(({isFocused:r,isActive:s})=>{this.onDidChangeWindowProperty("focused",r),this.onDidChangeWindowProperty("active",s)})}get nativeHandle(){return this._nativeHandle}$onDidChangeActiveNativeWindowHandle(t){this._nativeHandle=t?Dh(t).buffer:void 0}$onDidChangeWindowFocus(t){this.onDidChangeWindowProperty("focused",t)}$onDidChangeWindowActive(t){this.onDidChangeWindowProperty("active",t)}onDidChangeWindowProperty(t,i){i!==this._state[t]&&(this._state={...this._state,[t]:i},this._onDidChangeWindowState.fire(this._state))}openUri(t,i){let r;if(typeof t=="string"){r=t;try{t=b.parse(t)}catch{return Promise.reject(`Invalid uri - '${t}'`)}}return dh(t.scheme)?Promise.reject("Invalid scheme - cannot be empty"):t.scheme===V.command?Promise.reject(`Invalid scheme '${t.scheme}'`):this._proxy.$openUri(t,r,i)}async asExternalUri(t,i){if(dh(t.scheme))return Promise.reject("Invalid scheme - cannot be empty");const r=await this._proxy.$asExternalUri(t,i);return b.from(r)}};Wy=Uy=__decorate([__param(0,zt),__param(1,Pe)],Wy);var l6=q("IExtHostWindow"),Jg=class extends FM{constructor(t,i){super(i.logLevel,i.logsLocation,i.loggers.map(r=>kt(r))),this._proxy=t.getProxy(Q.MainThreadLogger)}$setLogLevel(t,i){i?this.setLogLevel(b.revive(i),t):this.setLogLevel(t)}setVisibility(t,i){super.setVisibility(t,i),this._proxy.$setVisibility(t,i)}doCreateLogger(t,i,r){return new EV(this._proxy,t,i,r)}};Jg=__decorate([__param(0,Pe),__param(1,zt)],Jg);var EV=class extends g1{constructor(e,t,i,r){super(r?.logLevel==="always"),this.proxy=e,this.file=t,this.isLoggerCreated=!1,this.buffer=[],this.setLevel(i),this.proxy.$createLogger(t,r).then(()=>{this.doLog(this.buffer),this.isLoggerCreated=!0})}log(e,t){const i=[[e,t]];this.isLoggerCreated?this.doLog(i):this.buffer.push(...i)}doLog(e){this.proxy.$log(this.file,e)}flush(){this.proxy.$flush(this.file)}},By=q("IExtHostTerminalShellIntegration"),Vy=class extends X{constructor(t,i){super(),this._extHostTerminalService=i,this._activeShellIntegrations=new Map,this._onDidChangeTerminalShellIntegration=new D,this.onDidChangeTerminalShellIntegration=this._onDidChangeTerminalShellIntegration.event,this._onDidStartTerminalShellExecution=new D,this.onDidStartTerminalShellExecution=this._onDidStartTerminalShellExecution.event,this._onDidEndTerminalShellExecution=new D,this.onDidEndTerminalShellExecution=this._onDidEndTerminalShellExecution.event,this._proxy=t.getProxy(Q.MainThreadTerminalShellIntegration),this._register(ie(()=>{for(const[r,s]of this._activeShellIntegrations)s.dispose();this._activeShellIntegrations.clear()}))}$shellIntegrationChange(t){const i=this._extHostTerminalService.getTerminalById(t);if(!i)return;const r=i.value;let s=this._activeShellIntegrations.get(t);s||(s=new CV(i.value,this._onDidStartTerminalShellExecution),this._activeShellIntegrations.set(t,s),s.store.add(i.onWillDispose(()=>this._activeShellIntegrations.get(t)?.dispose())),s.store.add(s.onDidRequestShellExecution(n=>this._proxy.$executeCommand(t,n))),s.store.add(s.onDidRequestEndExecution(n=>this._onDidEndTerminalShellExecution.fire(n))),s.store.add(s.onDidRequestChangeShellIntegration(n=>this._onDidChangeTerminalShellIntegration.fire(n))),i.shellIntegration=s.value),this._onDidChangeTerminalShellIntegration.fire({terminal:r,shellIntegration:s.value})}$shellExecutionStart(t,i,r,s,n){this._activeShellIntegrations.has(t)||this.$shellIntegrationChange(t);const o={value:i,confidence:r,isTrusted:s};this._activeShellIntegrations.get(t)?.startShellExecution(o,b.revive(n))}$shellExecutionEnd(t,i,r,s,n){const o={value:i,confidence:r,isTrusted:s};this._activeShellIntegrations.get(t)?.endShellExecution(o,n)}$shellExecutionData(t,i){this._activeShellIntegrations.get(t)?.emitData(i)}$shellEnvChange(t,i,r,s){this._activeShellIntegrations.get(t)?.setEnv(i,r,s)}$cwdChange(t,i){this._activeShellIntegrations.get(t)?.setCwd(b.revive(i))}$closeTerminal(t){this._activeShellIntegrations.get(t)?.dispose(),this._activeShellIntegrations.delete(t)}};Vy=__decorate([__param(0,Pe),__param(1,Ks)],Vy);var CV=class extends X{get currentExecution(){return this._currentExecution}constructor(e,t){super(),this._terminal=e,this._onDidStartTerminalShellExecution=t,this._pendingExecutions=[],this.store=this._register(new oe),this._onDidRequestChangeShellIntegration=this._register(new D),this.onDidRequestChangeShellIntegration=this._onDidRequestChangeShellIntegration.event,this._onDidRequestShellExecution=this._register(new D),this.onDidRequestShellExecution=this._onDidRequestShellExecution.event,this._onDidRequestEndExecution=this._register(new D),this.onDidRequestEndExecution=this._onDidRequestEndExecution.event,this._onDidRequestNewExecution=this._register(new D),this.onDidRequestNewExecution=this._onDidRequestNewExecution.event;const i=this;this.value={get cwd(){return i._cwd},get env(){if(i._env)return Object.freeze({isTrusted:i._env.isTrusted,value:Object.freeze({...i._env.value})})},executeCommand(r,s){let n=r;if(s)for(const l of s)!l.match(/["'`]/)&&l.match(/\s/)?n+=` "${l}"`:n+=` ${l}`;i._onDidRequestShellExecution.fire(n);const o={value:n,confidence:fu.High,isTrusted:!0};return i.requestNewShellExecution(o,i._cwd).value}}}requestNewShellExecution(e,t){const i=new c6(e,t??this._cwd);return Kg(e.value).length>1&&(this._currentExecutionProperties={isMultiLine:!0,unresolvedCommandLines:Kg(e.value)}),this._pendingExecutions.push(i),this._onDidRequestNewExecution.fire(e.value),i}startShellExecution(e,t){if(this._pendingEndingExecution&&(this._onDidRequestEndExecution.fire({terminal:this._terminal,shellIntegration:this.value,execution:this._pendingEndingExecution.value,exitCode:void 0}),this._pendingEndingExecution=void 0),this._currentExecution){if(this._currentExecutionProperties?.isMultiLine&&this._currentExecutionProperties.unresolvedCommandLines){const r=u6(this._currentExecutionProperties.unresolvedCommandLines,e);if(r){this._currentExecutionProperties.unresolvedCommandLines=r.unresolvedCommandLines;return}}this._currentExecution.endExecution(void 0),this._currentExecution.flush(),this._onDidRequestEndExecution.fire({terminal:this._terminal,shellIntegration:this.value,execution:this._currentExecution.value,exitCode:void 0})}let i;if(e.confidence===fu.High)for(const[r,s]of this._pendingExecutions.entries())if(s.value.commandLine.value===e.value){i=s,this._currentExecutionProperties={isMultiLine:!1,unresolvedCommandLines:void 0},i=s,this._pendingExecutions.splice(r,1);break}else{const n=u6(Kg(s.value.commandLine.value),e);if(n){this._currentExecutionProperties={isMultiLine:!0,unresolvedCommandLines:n.unresolvedCommandLines},i=s,this._pendingExecutions.splice(r,1);break}}else i=this._pendingExecutions.shift();i||(i=new c6(e,t??this._cwd)),this._currentExecution=i,this._onDidStartTerminalShellExecution.fire({terminal:this._terminal,shellIntegration:this.value,execution:this._currentExecution.value})}emitData(e){this.currentExecution?.emitData(e)}endShellExecution(e,t){if(!(this._currentExecutionProperties?.isMultiLine&&this._currentExecutionProperties.unresolvedCommandLines&&this._currentExecutionProperties.unresolvedCommandLines.length>0)&&this._currentExecution){const i=this._currentExecutionProperties?.isMultiLine?this._currentExecution.value.commandLine:e;this._currentExecution.endExecution(i);const r=this._currentExecution;this._pendingEndingExecution=r,this._currentExecution=void 0,r.flush().then(()=>{this._pendingEndingExecution===r&&(this._onDidRequestEndExecution.fire({terminal:this._terminal,shellIntegration:this.value,execution:r.value,exitCode:t}),this._pendingEndingExecution=void 0)})}}setEnv(e,t,i){const r={};for(let s=0;s<e.length;s++)r[e[s]]=t[s];this._env={value:r,isTrusted:i},this._fireChangeEvent()}setCwd(e){let t=!1;b.isUri(this._cwd)?t=!b.isUri(e)||this._cwd.toString()!==e.toString():this._cwd!==e&&(t=!0),t&&(this._cwd=e,this._fireChangeEvent())}_fireChangeEvent(){this._onDidRequestChangeShellIntegration.fire({terminal:this._terminal,shellIntegration:this.value})}},c6=class{constructor(e,t){this._commandLine=e,this.cwd=t,this._isEnded=!1;const i=this;this.value={get commandLine(){return i._commandLine},get cwd(){return i.cwd},read(){return i._createDataStream()}}}_createDataStream(){if(!this._dataStream){if(this._isEnded)return Sc.EMPTY;this._dataStream=new DV}return this._dataStream.createIterable()}emitData(e){this._isEnded||this._dataStream?.emitData(e)}endExecution(e){e&&(this._commandLine=e),this._dataStream?.endExecution(),this._isEnded=!0}async flush(){this._dataStream&&(await this._dataStream.flush(),this._dataStream.dispose(),this._dataStream=void 0)}},DV=class extends X{constructor(){super(...arguments),this._iterables=[],this._emitters=[]}createIterable(){this._barrier||(this._barrier=new dr);const e=this._barrier,t=new Sc(async i=>{this._emitters.push(i),await e.wait()});return this._iterables.push(t),t}emitData(e){for(const t of this._emitters)t.emitOne(e)}endExecution(){this._barrier?.open()}async flush(){await Promise.all(this._iterables.map(e=>e.toPromise()))}};function Kg(e){return e.split(`
`).map(t=>t.trim()).filter(t=>t.length>0)}function u6(e,t){if(e.length===0)return!1;const i=[...e],r=Kg(t.value);if(i&&i.length>0){for(;i.length>0&&i[0]===r[0];)i.shift(),r.shift();if(r.length===0)return{unresolvedCommandLines:i}}return!1}var d6;(function(e){e[e.CR=13]="CR",e[e.LF=10]="LF",e[e.COLON=58]="COLON",e[e.SPACE=32]="SPACE"})(d6||(d6={}));var zy=class{constructor(e){this.dataBuffer="",this.eventTypeBuffer="",this.buffer=[],this.endedOnCR=!1,this.onEventHandler=e,this.decoder=new TextDecoder("utf-8")}getLastEventId(){return this.lastEventIdBuffer}getReconnectionTime(){return this.reconnectionTime}feed(e){if(e.length===0)return;let t=0;for(this.endedOnCR&&e[0]===10&&t++,this.endedOnCR=!1;t<e.length;){const i=e.indexOf(13,t),r=e.indexOf(10,t),s=i===-1?r:r===-1?i:Math.min(i,r);if(s===-1)break;let n="";for(const o of this.buffer)n+=this.decoder.decode(o,{stream:!0});n+=this.decoder.decode(e.subarray(t,s)),this.processLine(n),this.buffer.length=0,t=s+(e[s]===13&&e[s+1]===10?2:1)}t<e.length?this.buffer.push(e.subarray(t)):this.endedOnCR=e[e.length-1]===13}processLine(e){if(!e.length){this.dispatchEvent();return}if(e.startsWith(":"))return;let t,i;const r=e.indexOf(":");r===-1?(t=e,i=""):(t=e.substring(0,r),i=e.substring(r+1),i.startsWith(" ")&&(i=i.substring(1))),this.processField(t,i)}processField(e,t){switch(e){case"event":this.eventTypeBuffer=t;break;case"data":this.dataBuffer+=t,this.dataBuffer+=`
`;break;case"id":t.includes("\0")?this.currentEventId=void 0:this.currentEventId=this.lastEventIdBuffer=t;break;case"retry":/^\d+$/.test(t)&&(this.reconnectionTime=parseInt(t,10));break}}dispatchEvent(){if(this.dataBuffer===""){this.dataBuffer="",this.eventTypeBuffer="";return}this.dataBuffer.endsWith(`
`)&&(this.dataBuffer=this.dataBuffer.substring(0,this.dataBuffer.length-1));const e={type:this.eventTypeBuffer||"message",data:this.dataBuffer};this.currentEventId!==void 0&&(e.id=this.currentEventId),this.reconnectionTime!==void 0&&(e.retry=this.reconnectionTime),this.onEventHandler(e),this.reset()}reset(){this.dataBuffer="",this.eventTypeBuffer="",this.currentEventId=void 0}},Xg=q("IExtHostMpcService"),Yg=class extends X{constructor(t){super(),this._initialProviderPromises=new Set,this._sseEventSources=this._register(new fc),this._unresolvedMcpServers=new Map,this._proxy=t.getProxy(Q.MainThreadMcp)}$startMcp(t,i){this._startMcp(t,Nu.fromSerialized(i))}_startMcp(t,i){if(i.type===2){this._sseEventSources.set(t,new kV(t,i,this._proxy));return}throw new Error("not implemented")}$stopMcp(t){this._sseEventSources.has(t)&&(this._sseEventSources.deleteAndDispose(t),this._proxy.$onDidChangeState(t,{state:0}))}$sendMessage(t,i){this._sseEventSources.get(t)?.send(i)}async $waitForInitialCollectionProviders(){await Promise.all(this._initialProviderPromises)}async $resolveMcpLaunch(t,i){const r=this._unresolvedMcpServers.get(t);if(!r)return;const s=r.servers.find(o=>o.label===i);if(!s)return;if(!r.provider.resolveMcpServerDefinition)return Ku.from(s);const n=await r.provider.resolveMcpServerDefinition(s,Be.None);return n?Ku.from(n):void 0}registerMcpConfigurationProvider(t,i,r){const s=new oe,n=t.contributes?.modelContextServerCollections?.find(c=>c.id===i);if(!n)throw new Error(`MCP configuration providers must be registered in the contributes.modelContextServerCollections array within your package.json, but "${i}" was not`);const o={id:wU(t.identifier,i),isTrustedByDefault:!0,label:n?.label??t.displayName??t.name,scope:1,canResolveLaunch:typeof r.resolveMcpServerDefinition=="function",extensionId:t.identifier.value},a=async()=>{const c=await r.provideMcpServerDefinitions(Be.None);this._unresolvedMcpServers.set(o.id,{servers:c??[],provider:r});const u=[];for(const d of c??[]){let f=qe.toKey(t.identifier)+"/"+d.label;if(u.some(p=>p.id===f)){let p=2;for(;u.some(g=>g.id===f+p);)p++;f=f+p}u.push({id:f,label:d.label,cacheNonce:d.version,launch:Ku.from(d)})}this._proxy.$upsertMcpCollection(o,u)};s.add(ie(()=>{this._unresolvedMcpServers.delete(o.id),this._proxy.$deleteMcpCollection(o.id)})),r.onDidChangeServerDefinitions&&s.add(r.onDidChangeServerDefinitions(a)),r.onDidChange&&s.add(r.onDidChange(a));const l=new Promise(c=>{setTimeout(()=>a().finally(()=>{this._initialProviderPromises.delete(l),c()}),0)});return this._initialProviderPromises.add(l),s}};Yg=__decorate([__param(0,Pe)],Yg);var h6;(function(e){e[e.Unknown=0]="Unknown",e[e.Http=1]="Http",e[e.SSE=2]="SSE"})(h6||(h6={}));var kV=class extends X{constructor(e,t,i){super(),this._id=e,this._launch=t,this._proxy=i,this._requestSequencer=new U3,this._postEndpoint=new hr,this._mode={value:0},this._cts=new rt,this._abortCtrl=new AbortController,this._register(ie(()=>{this._abortCtrl.abort(),this._cts.dispose(!0)})),this._proxy.$onDidChangeState(this._id,{state:2})}async send(e){try{await this._requestSequencer.queue(()=>this._mode.value===2?this._sendLegacySSE(this._mode.endpoint,e):this._sendStreamableHttp(e,this._mode.value===1?this._mode.sessionId:void 0))}catch(t){const i=`Error sending message to ${this._launch.uri}: ${String(t)}`;this._proxy.$onDidChangeState(this._id,{state:3,message:i})}}async _sendStreamableHttp(e,t){const i=new TextEncoder().encode(e),r={...Object.fromEntries(this._launch.headers),"Content-Type":"application/json","Content-Length":String(i.length),Accept:"text/event-stream, application/json"};t&&(r["Mcp-Session-Id"]=t);const s=await fetch(this._launch.uri.toString(!0),{method:"POST",signal:this._abortCtrl.signal,headers:r,body:i}),n=this._mode.value===0,o=s.headers.get("Mcp-Session-Id");if(o&&(this._mode={value:1,sessionId:o}),this._mode.value===0&&s.status>=400&&s.status<500){this._log(ae.Info,`${s.status} status sending message to ${this._launch.uri}, will attempt to fall back to legacy SSE`);const a=await this._attachSSE();a&&(this._mode={value:2,endpoint:a},await this._sendLegacySSE(a,e));return}if(s.status>=300){const a=this._mode.value===1&&!!this._mode.sessionId;this._proxy.$onDidChangeState(this._id,{state:3,message:`${s.status} status sending message to ${this._launch.uri}: ${await this._getErrText(s)}`+a?"; will retry with new session ID":"",shouldRetry:a});return}this._mode.value===0&&(this._mode={value:1,sessionId:void 0}),n&&this._attachStreamableBackchannel(),this._handleSuccessfulStreamableHttp(s)}async _handleSuccessfulStreamableHttp(e){if(e.status!==202)switch(e.headers.get("Content-Type")?.toLowerCase()){case"text/event-stream":{const t=new zy(i=>{i.type==="message"&&this._proxy.$onDidReceiveMessage(this._id,i.data)});try{await this._doSSE(t,e)}catch(i){this._log(ae.Warning,`Error reading SSE stream: ${String(i)}`)}break}case"application/json":this._proxy.$onDidReceiveMessage(this._id,await e.text());break;default:{const t=await e.text();IV(t)?this._proxy.$onDidReceiveMessage(this._id,t):this._log(ae.Warning,`Unexpected ${e.status} response for request: ${t}`)}}}async _attachStreamableBackchannel(){let e;for(let t=0;!this._store.isDisposed;t++){await ui(Math.min(t*1e3,3e4),this._cts.token);let i;try{const s={...Object.fromEntries(this._launch.headers),Accept:"text/event-stream"};this._mode.value===1&&this._mode.sessionId!==void 0&&(s["Mcp-Session-Id"]=this._mode.sessionId),e&&(s["Last-Event-ID"]=e),i=await fetch(this._launch.uri.toString(!0),{method:"GET",signal:this._abortCtrl.signal,headers:s})}catch{this._log(ae.Info,`Error connecting to ${this._launch.uri} for async notifications, will retry`);continue}if(i.status>=400){this._log(ae.Debug,`${i.status} status connecting to ${this._launch.uri} for async notifications; they will be disabled: ${await this._getErrText(i)}`);return}t=0;const r=new zy(s=>{s.type==="message"&&this._proxy.$onDidReceiveMessage(this._id,s.data),s.id&&(e=s.id)});try{await this._doSSE(r,i)}catch(s){this._log(ae.Info,`Error reading from async stream, we will reconnect: ${s}`)}}}async _attachSSE(){const e=new hr;let t;try{if(t=await fetch(this._launch.uri.toString(!0),{method:"GET",signal:this._abortCtrl.signal,headers:{...Object.fromEntries(this._launch.headers),Accept:"text/event-stream"}}),t.status>=300){this._proxy.$onDidChangeState(this._id,{state:3,message:`${t.status} status connecting to ${this._launch.uri} as SSE: ${await this._getErrText(t)}`});return}}catch(r){this._proxy.$onDidChangeState(this._id,{state:3,message:`Error connecting to ${this._launch.uri} as SSE: ${r}`});return}const i=new zy(r=>{r.type==="message"?this._proxy.$onDidReceiveMessage(this._id,r.data):r.type==="endpoint"&&e.complete(new URL(r.data,this._launch.uri.toString(!0)).toString())});return this._register(ie(()=>e.cancel())),this._doSSE(i,t).catch(r=>{this._proxy.$onDidChangeState(this._id,{state:3,message:`Error reading SSE stream: ${String(r)}`})}),e.p}async _sendLegacySSE(e,t){const i=new TextEncoder().encode(t),r=await fetch(e,{method:"POST",signal:this._abortCtrl.signal,headers:{...Object.fromEntries(this._launch.headers),"Content-Type":"application/json","Content-Length":String(i.length)},body:i});r.status>=300&&this._log(ae.Warning,`${r.status} status sending message to ${this._postEndpoint}: ${await this._getErrText(r)}`)}async _doSSE(e,t){if(!t.body)return;const i=t.body.getReader();let r;do{try{r=await wh(i.read(),this._cts.token)}catch(s){if(i.cancel(),this._store.isDisposed)return;throw s}r.value&&e.feed(r.value)}while(!r.done)}_log(e,t){this._store.isDisposed||this._proxy.$onDidPublishLog(this._id,e,t)}async _getErrText(e){try{return await e.text()}catch{return e.statusText}}};function IV(e){try{return JSON.parse(e),!0}catch{return!1}}Ne(cy,ly,1),Ne(La,Jg,1),Ne(cd,by,1),Ne(Vr,jw,0),Ne(Kw,Xw,0),Ne(Yw,Zw,0),Ne(vr,Nw,0),Ne(td,Hw,0),Ne(gd,My,0),Ne(Oy,Fy,0),Ne(TT,_y,0),Ne(ia,yy,0),Ne(uy,dy,0),Ne(Ma,rO,0),Ne(PT,vy,1),Ne(Hy,Gg,0),Ne($w,L5,0),Ne(Ly,Ry,0),Ne(Ks,Jw,0),Ne(By,Vy,0),Ne(Ig,Pg,0),Ne(l6,Wy,0),Ne(Br,Tw,0),Ne(ay,bT,0),Ne(Bl,Ny,0),Ne(Vl,qg,0),Ne(Xg,Yg,0);var qy=class extends Ag{constructor(t,i){super(!0,t,i)}createTerminal(t,i,r){return this.createTerminalFromOptions({name:t,shellPath:i,shellArgs:r})}createTerminalFromOptions(t,i){const r=new Gw(this._proxy,mt(),t,t.name);return this._terminals.push(r),r.create(t,this._serializeParentTerminal(t,i)),r.value}};qy=__decorate([__param(0,Vr),__param(1,Pe)],qy);import{promises as f6}from"fs";var p6;(function(e){e[e.stdout=0]="stdout",e[e.stderr=1]="stderr"})(p6||(p6={}));var g6;(function(e){e[e.Success=0]="Success",e[e.Unknown=1]="Unknown",e[e.AccessDenied=2]="AccessDenied",e[e.ProcessNotFound=3]="ProcessNotFound"})(g6||(g6={}));function PV(e,...t){const i=t.reduce((n,o)=>(n[o]=!0,n),{}),r=[/^ELECTRON_.+$/,/^VSCODE_(?!(PORTABLE|SHELL_LOGIN|ENV_REPLACE|ENV_APPEND|ENV_PREPEND)).+$/,/^SNAP(|_.*)$/,/^GDK_PIXBUF_.+$/];Object.keys(e).filter(n=>!i[n]).forEach(n=>{for(let o=0;o<r.length;o++)if(n.search(r[o])!==-1){delete e[n];break}})}function TV(e){e&&(delete e.DEBUG,Ct&&delete e.LD_PRELOAD)}function m6(e=gn){return e.comspec||"cmd.exe"}function AV(e){let t=[],i=!1;const r=function(s){if(i){t.push(s);return}(!e.send(s,o=>{if(o&&console.error(o),i=!1,t.length>0){const a=t.slice(0);t=[],a.forEach(l=>r(l))}})||Ve)&&(i=!0)};return{send:r}}async function RV(e){if(await dt.exists(e)){let t;try{t=await f6.stat(e)}catch(i){i.message.startsWith("EACCES")&&(t=await f6.lstat(e))}return t?!t.isDirectory():!1}return!1}async function Zg(e,t,i,r=gn,s=RV){if(Dr(e))return await s(e)?e:void 0;if(t===void 0&&(t=so()),Bi(e)!=="."){const l=Xe(t,e);return await s(l)?l:void 0}const o=lC(r,"PATH");if(i===void 0&&Oe(o)&&(i=o.split(Fx)),i===void 0||i.length===0){const l=Xe(t,e);return await s(l)?l:void 0}for(const l of i){let c;if(Dr(l)?c=Xe(l,e):c=Xe(t,l,e),Ve){const d=(lC(r,"PATHEXT")||".COM;.EXE;.BAT;.CMD").split(";").map(async f=>{const p=c+f;return await s(p)?p:void 0});for(const f of d){const p=await f;if(p)return p}}if(await s(c))return c}const a=Xe(t,e);return await s(a)?a:void 0}import{homedir as LV}from"os";var jy=class extends zg{constructor(t,i,r,s,n,o,a,l,c){super(t,i,r,s,n,o,a,l),this.workspaceService=r,this.variableResolver=c,i.remote.isRemote&&i.remote.authority?this.registerTaskSystem(V.vscodeRemote,{scheme:V.vscodeRemote,authority:i.remote.authority,platform:process.platform}):this.registerTaskSystem(V.file,{scheme:V.file,authority:"",platform:process.platform}),this._proxy.$registerSupportedExecutions(!0,!0,!0)}async executeTask(t,i){const r=i;if(!i.execution&&r._id===void 0)throw new Error("Tasks to execute must include an execution");if(r._id!==void 0){const s=Iy.from(r,this.workspaceService),n=await this._proxy.$getTaskExecution(s);if(n.task===void 0)throw new Error("Task from execution DTO is undefined");const o=await this.getTaskExecution(n,i);return this._proxy.$executeTask(s).catch(()=>{}),o}else{const s=fs.from(i,t);if(s===void 0)return Promise.reject(new Error("Task is not valid"));zr.is(s.execution)&&await this.addCustomExecution(s,i,!1);const n=await this.getTaskExecution(await this._proxy.$getTaskExecution(s),i);return this._proxy.$executeTask(s).catch(()=>{}),n}}provideTasksInternal(t,i,r,s){const n=[];if(s)for(const o of s){this.checkDeprecation(o,r),(!o.definition||!t[o.definition.type])&&this._logService.warn(`The task [${o.source}, ${o.name}] uses an undefined task type. The task will be ignored in the future.`);const a=fs.from(o,r.extension);a&&(n.push(a),zr.is(a.execution)&&i.push(this.addCustomExecution(a,o,!0)))}return{tasks:n,extension:r.extension}}async resolveTaskInternal(t){return t}async getAFolder(t){let i=t&&t.length>0?t[0]:void 0;if(!i){const r=b.file(LV());i=new _1({uri:r,name:ir(r),index:0})}return{uri:i.uri,name:i.name,index:i.index,toResource:()=>{throw new Error("Not implemented")}}}async $resolveVariables(t,i){const r=b.revive(t),s={process:void 0,variables:Object.create(null)},n=await this._workspaceProvider.resolveWorkspaceFolder(r),o=await this._workspaceProvider.getWorkspaceFolders2()??[],a=await this.variableResolver.getResolver(),l=n?{uri:n.uri,name:n.name,index:n.index,toResource:()=>{throw new Error("Not implemented")}}:await this.getAFolder(o);for(const c of i.variables)s.variables[c]=await a.resolveAsync(l,c);if(i.process!==void 0){let c;if(i.process.path!==void 0){c=i.process.path.split(Fx);for(let p=0;p<c.length;p++)c[p]=await a.resolveAsync(l,c[p])}const u=await a.resolveAsync(l,i.process.name),d=i.process.cwd!==void 0?await a.resolveAsync(l,i.process.cwd):void 0,f=await Zg(u,d,c);f?s.process=f:Dr(u)?s.process=u:s.process=Xe(d??"",u)}return s}async $jsonTasksSupported(){return!0}async $findExecutable(t,i,r){return Zg(t,i,r)}};jy=__decorate([__param(0,Pe),__param(1,zt),__param(2,Br),__param(3,ia),__param(4,vr),__param(5,Ks),__param(6,ke),__param(7,cd),__param(8,Vl)],jy);import*as zl from"child_process";var die=q("externalTerminal"),em="Terminal.app",v6=h(2029,null),Gy=class{async getDefaultTerminalForPlatforms(){return{windows:Qy.getDefaultTerminalWindows(),linux:await _6.getDefaultTerminalLinuxReady(),osx:"xterm"}}},Qy=class ln extends Gy{static{this.CMD="cmd.exe"}openTerminal(t,i){return this.spawnTerminal(zl,t,m6(),i)}spawnTerminal(t,i,r,s){const n=i.windowsExec||ln.getDefaultTerminalWindows();s&&s[1]===":"&&(s=s[0].toUpperCase()+s.substr(1));const o=bt(n,".exe").toLowerCase();if(o==="cmder")return t.spawn(n,s?[s]:void 0),Promise.resolve(void 0);const a=["/c","start","/wait"];return n.indexOf(" ")>=0&&a.push(n),a.push(n),o==="wt"&&a.push("-d ."),new Promise((l,c)=>{const u=ql(process),d=t.spawn(r,a,{cwd:s,env:u,detached:!0});d.on("error",c),d.on("exit",()=>l())})}async runInTerminal(t,i,r,s,n){const o="windowsExec"in n&&n.windowsExec?n.windowsExec:ln.getDefaultTerminalWindows(),a=await ln.getWtExePath();return new Promise((l,c)=>{const u=`"${i} - ${v6}"`,d=`"${r.join('" "')}" & pause`,f=Object.assign({},ql(process),s);Object.keys(f).filter(S=>f[S]===null).forEach(S=>delete f[S]);const p={cwd:i,env:f,windowsVerbatimArguments:!0};let g,v;bt(o,".exe")==="wt"?(g=o,v=["-d",".",ln.CMD,"/c",d]):a?(g=a,v=["-d",".",o,"/c",d]):(g=ln.CMD,v=["/c","start",u,"/wait",o,"/c",`"${d}"`]),zl.spawn(g,v,p).on("error",S=>{c(Jy(S))}),l(void 0)})}static getDefaultTerminalWindows(){if(!ln._DEFAULT_TERMINAL_WINDOWS){const t=!!process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432");ln._DEFAULT_TERMINAL_WINDOWS=`${process.env.windir?process.env.windir:"C:\\Windows"}\\${t?"Sysnative":"System32"}\\cmd.exe`}return ln._DEFAULT_TERMINAL_WINDOWS}static async getWtExePath(){try{return await Zg("wt")}catch{return}}};__decorate([WE],Qy,"getWtExePath",null);var NV=class I8 extends Gy{static{this.OSASCRIPT="/usr/bin/osascript"}openTerminal(t,i){return this.spawnTerminal(zl,t,i)}runInTerminal(t,i,r,s,n){const o=n.osxExec||em;return new Promise((a,l)=>{if(o===em||o==="iTerm.app"){const c=o===em?"TerminalHelper":"iTermHelper",d=[Mv.asFileUri(`vs/workbench/contrib/externalTerminal/node/${c}.scpt`).fsPath,"-t",t||v6,"-w",i];for(const g of r)d.push("-a"),d.push(g);if(s){const g=Object.assign({},ql(process),s);for(const v in g){const y=g[v];y===null?(d.push("-u"),d.push(v)):(d.push("-e"),d.push(`${v}=${y}`))}}let f="";const p=zl.spawn(I8.OSASCRIPT,d);p.on("error",g=>{l(Jy(g))}),p.stderr.on("data",g=>{f+=g.toString()}),p.on("exit",g=>{if(g===0)a(void 0);else if(f){const v=f.split(`
`,1);l(new Error(v[0]))}else l(new Error(h(2030,null,c,g)))})}else l(new Error(h(2031,null,o)))})}spawnTerminal(t,i,r){const s=i.osxExec||em;return new Promise((n,o)=>{const a=["-a",s];r&&a.push(r);const l=ql(process),c=t.spawn("/usr/bin/open",a,{cwd:r,env:l});c.on("error",o),c.on("exit",()=>n())})}},_6=class Kn extends Gy{static{this.WAIT_MESSAGE=h(2032,null)}openTerminal(t,i){return this.spawnTerminal(zl,t,i)}runInTerminal(t,i,r,s,n){const o=n.linuxExec?Promise.resolve(n.linuxExec):Kn.getDefaultTerminalLinuxReady();return new Promise((a,l)=>{const c=[];o.then(u=>{u.indexOf("gnome-terminal")>=0?c.push("-x"):c.push("-e"),c.push("bash"),c.push("-c");const d=`${MV(r)}; echo; read -p "${Kn.WAIT_MESSAGE}" -n1;`;c.push(`''${d}''`);const f=Object.assign({},ql(process),s);Object.keys(f).filter(y=>f[y]===null).forEach(y=>delete f[y]);const p={cwd:i,env:f};let g="";const v=zl.spawn(u,c,p);v.on("error",y=>{l(Jy(y))}),v.stderr.on("data",y=>{g+=y.toString()}),v.on("exit",y=>{if(y===0)a(void 0);else if(g){const S=g.split(`
`,1);l(new Error(S[0]))}else l(new Error(h(2033,null,u,y)))})})})}static async getDefaultTerminalLinuxReady(){if(!Kn._DEFAULT_TERMINAL_LINUX_READY)if(!Ct)Kn._DEFAULT_TERMINAL_LINUX_READY=Promise.resolve("xterm");else{const t=await dt.exists("/etc/debian_version");Kn._DEFAULT_TERMINAL_LINUX_READY=new Promise(i=>{t?i("x-terminal-emulator"):process.env.DESKTOP_SESSION==="gnome"||process.env.DESKTOP_SESSION==="gnome-classic"?i("gnome-terminal"):process.env.DESKTOP_SESSION==="kde-plasma"?i("konsole"):process.env.COLORTERM?i(process.env.COLORTERM):process.env.TERM?i(process.env.TERM):i("xterm")})}return Kn._DEFAULT_TERMINAL_LINUX_READY}spawnTerminal(t,i,r){const s=i.linuxExec?Promise.resolve(i.linuxExec):Kn.getDefaultTerminalLinuxReady();return new Promise((n,o)=>{s.then(a=>{const l=ql(process),c=t.spawn(a,[],{cwd:r,env:l});c.on("error",o),c.on("exit",()=>n())})})}};function ql(e){const t={...e.env};return PV(t),t}function Jy(e){return"errno"in e&&e.errno==="ENOENT"&&"path"in e&&typeof e.path=="string"?new Error(h(2034,null,e.path)):e}function MV(e){let t="";for(const i of e)i.indexOf(" ")>=0?t+='"'+i+'"':t+=i,t+=" ";return t}var OV=class P8{constructor(){this.validators=new Map}static{this._nextId=1}async createNewMessage(t){try{const i=await this.getValidator();if(i){const r=String(P8._nextId++);return this.validators.set(r,i),{id:r,data:i.createNewMessage(t)}}}catch{}return{id:"",data:t}}async validate(t,i){if(!t.id)return!0;const r=this.validators.get(t.id);if(!r)return!1;this.validators.delete(t.id);try{return r.validate(i)==="ok"}catch{return!1}finally{r.dispose?.()}}async sign(t){try{return await this.signValue(t)}catch{}return t}},w6=class extends OV{getValidator(){return this.vsda().then(e=>new e.validator)}signValue(e){return this.vsda().then(t=>new t.signer().sign(e))}async vsda(){return console.log("[Extension Validation Bypass] Providing mock vsda module in SignService"),{signer:class{sign(e){return Promise.resolve("mock_signature")}},validator:class{validate(){return Promise.resolve(!0)}}}}};import*as Ky from"child_process";import*as y6 from"net";var b6=class rc extends QT{static{this.TWO_CRLF=`\r
\r
`}static{this.HEADER_LINESEPARATOR=/\r?\n/}static{this.HEADER_FIELDSEPARATOR=/: */}constructor(){super(),this.rawData=Buffer.allocUnsafe(0),this.contentLength=-1}connect(t,i){this.outputStream=i,this.rawData=Buffer.allocUnsafe(0),this.contentLength=-1,t.on("data",r=>this.handleData(r))}sendMessage(t){if(this.outputStream){const i=JSON.stringify(t);this.outputStream.write(`Content-Length: ${Buffer.byteLength(i,"utf8")}${rc.TWO_CRLF}${i}`,"utf8")}}handleData(t){for(this.rawData=Buffer.concat([this.rawData,t]);;){if(this.contentLength>=0){if(this.rawData.length>=this.contentLength){const i=this.rawData.toString("utf8",0,this.contentLength);if(this.rawData=this.rawData.slice(this.contentLength),this.contentLength=-1,i.length>0)try{this.acceptMessage(JSON.parse(i))}catch(r){this._onError.fire(new Error((r.message||r)+`
`+i))}continue}}else{const i=this.rawData.indexOf(rc.TWO_CRLF);if(i!==-1){const s=this.rawData.toString("utf8",0,i).split(rc.HEADER_LINESEPARATOR);for(const n of s){const o=n.split(rc.HEADER_FIELDSEPARATOR);o[0]==="Content-Length"&&(this.contentLength=Number(o[1]))}this.rawData=this.rawData.slice(i+rc.TWO_CRLF.length);continue}}break}}},S6=class extends b6{startSession(){return new Promise((e,t)=>{let i=!1;this.socket=this.createConnection(()=>{this.connect(this.socket,this.socket),e(),i=!0}),this.socket.on("close",()=>{i?this._onError.fire(new Error("connection closed")):t(new Error("connection closed"))}),this.socket.on("error",r=>{r instanceof AggregateError&&(r=r.errors[0]),i?this._onError.fire(r):t(r)})})}async stopSession(){await this.cancelPendingRequests(),this.socket&&(this.socket.end(),this.socket=void 0)}},FV=class extends S6{constructor(e){super(),this.adapterServer=e}createConnection(e){return y6.createConnection(this.adapterServer.port,this.adapterServer.host||"127.0.0.1",e)}},$V=class extends S6{constructor(e){super(),this.adapterServer=e}createConnection(e){return y6.createConnection(this.adapterServer.path,e)}},x6=class pa extends b6{constructor(t,i){super(),this.adapterExecutable=t,this.debugType=i}async startSession(){const t=this.adapterExecutable.command,i=this.adapterExecutable.args,r=this.adapterExecutable.options||{};try{if(t)if(Dr(t)){if(!await dt.exists(t))throw new Error(h(6797,null,t))}else t.indexOf("/")<0&&t.indexOf("\\")<0;else throw new Error(h(6798,null,this.debugType));let s=process.env;if(r.env&&Object.keys(r.env).length>0&&(s=Is(Ye(process.env),r.env)),t==="node")if(Array.isArray(i)&&i.length>0){const n=!!process.env.ELECTRON_RUN_AS_NODE||!!process.versions.electron,o={env:s,execArgv:n?["-e","delete process.env.ELECTRON_RUN_AS_NODE;require(process.argv[1])"]:[],silent:!0};r.cwd&&(o.cwd=r.cwd);const a=Ky.fork(i[0],i.slice(1),o);if(!a.pid)throw new Error(h(6799,null,i[0]));this.serverProcess=a}else throw new Error(h(6800,null));else{let n=t,o=i;const a={env:s};r.cwd&&(a.cwd=r.cwd),Ve&&(t.endsWith(".bat")||t.endsWith(".cmd"))&&(a.shell=!0,n=`"${t}"`,o=i.map(l=>(l=l.replace(/"/g,'\\"'),`"${l}"`))),this.serverProcess=Ky.spawn(n,o,a)}this.serverProcess.on("error",n=>{this._onError.fire(n)}),this.serverProcess.on("exit",(n,o)=>{this._onExit.fire(n)}),this.serverProcess.stdout.on("close",()=>{this._onError.fire(new Error("read error"))}),this.serverProcess.stdout.on("error",n=>{this._onError.fire(n)}),this.serverProcess.stdin.on("error",n=>{this._onError.fire(n)}),this.serverProcess.stderr.resume(),this.connect(this.serverProcess.stdout,this.serverProcess.stdin)}catch(s){this._onError.fire(s)}}async stopSession(){return this.serverProcess?(await this.cancelPendingRequests(),Ve?new Promise((t,i)=>{const r=Ky.exec(`taskkill /F /T /PID ${this.serverProcess.pid}`,function(s,n,o){if(s)return i(s)});r.on("exit",t),r.on("error",i)}):(this.serverProcess.kill("SIGTERM"),Promise.resolve(void 0))):Promise.resolve(void 0)}static extract(t,i){if(!t)return;const r=Object.create(null);t.runtime&&(t.runtime.indexOf("./")===0?r.runtime=Xe(i,t.runtime):r.runtime=t.runtime),t.runtimeArgs&&(r.runtimeArgs=t.runtimeArgs),t.program&&(Dr(t.program)?r.program=t.program:r.program=Xe(i,t.program)),t.args&&(r.args=t.args);const s=t;return s.win&&(r.win=pa.extract(s.win,i)),s.winx86&&(r.winx86=pa.extract(s.winx86,i)),s.windows&&(r.windows=pa.extract(s.windows,i)),s.osx&&(r.osx=pa.extract(s.osx,i)),s.linux&&(r.linux=pa.extract(s.linux,i)),r}static platformAdapterExecutable(t,i){let r=Object.create(null);i=i.toLowerCase();for(const c of t)if(c.contributes){const u=c.contributes.debuggers;u&&u.length>0&&u.filter(d=>typeof d.type=="string"&&kr(d.type,i)).forEach(d=>{const f=pa.extract(d,c.extensionLocation.fsPath);r=Is(r,f,c.isBuiltin)})}let s;Ve&&!process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432")?s=r.winx86||r.win||r.windows:Ve?s=r.win||r.windows:Mt?s=r.osx:Ct&&(s=r.linux),s=s||r;const n=s.program||r.program,o=s.args||r.args,a=s.runtime||r.runtime,l=s.runtimeArgs||r.runtimeArgs;if(a)return{type:"executable",command:a,args:(l||[]).concat(typeof n=="string"?[n]:[]).concat(o||[])};if(n)return{type:"executable",command:n,args:o||[]}}};import*as HV from"child_process";function UV(e,t){return new Promise((i,r)=>{let s="";const n=HV.spawn(e,t);n.pid&&n.stdout.on("data",o=>{s+=o.toString()}),n.on("error",o=>{r(o)}),n.on("close",o=>{i(s)})})}async function WV(e){if(e)if(Ve){const t=await import("@vscode/windows-process-tree");return new Promise(i=>{t.getProcessTree(e,r=>{i(!!r&&r.children.length>0)})})}else return UV("/usr/bin/pgrep",["-lP",String(e)]).then(t=>{const i=t.trim();return!(i.length===0||i.indexOf(" tmux")>=0)},t=>!0);return Promise.resolve(!0)}var E6;(function(e){e[e.cmd=0]="cmd",e[e.powershell=1]="powershell",e[e.bash=2]="bash"})(E6||(E6={}));function BV(e,t,i,r,s){e=e.trim().toLowerCase();let n;e.indexOf("powershell")>=0||e.indexOf("pwsh")>=0?n=1:e.indexOf("cmd.exe")>=0?n=0:e.indexOf("bash")>=0?n=2:Ve?n=0:n=2;let o,a=" ";switch(n){case 1:if(o=l=>(l=l.replace(/\'/g,"''"),l.length>0&&l.charAt(l.length-1)==="\\"?`'${l}\\'`:`'${l}'`),r){const l=iE(r);l&&(a+=`${l}:; `),a+=`cd ${o(r)}; `}if(s)for(const l in s){const c=s[l];c===null?a+=`Remove-Item env:${l}; `:a+=`\${env:${l}}='${c}'; `}if(t.length>0){const l=t.shift(),c=i?l:o(l);a+=c[0]==="'"?`& ${c} `:`${c} `;for(const u of t)a+=u==="<"||u===">"||i?u:o(u),a+=" "}break;case 0:if(o=l=>(l=l.replace(/\"/g,'""'),l=l.replace(/([><!^&|])/g,"^$1"),' "'.split("").some(c=>l.includes(c))||l.length===0?`"${l}"`:l),r){const l=iE(r);l&&(a+=`${l}: && `),a+=`cd ${o(r)} && `}if(s){a+='cmd /C "';for(const l in s){let c=s[l];c===null?a+=`set "${l}=" && `:(c=c.replace(/[&^|<>]/g,u=>`^${u}`),a+=`set "${l}=${c}" && `)}}for(const l of t)a+=l==="<"||l===">"||i?l:o(l),a+=" ";s&&(a+='"');break;case 2:{o=c=>(c=c.replace(/(["'\\\$!><#()\[\]*&^| ;{}?`])/g,"\\$1"),c.length===0?'""':c);const l=c=>/[^\w@%\/+=,.:^-]/.test(c)?`'${c.replace(/'/g,"'\\''")}'`:c;if(r&&(a+=`cd ${o(r)} ; `),s){a+="/usr/bin/env";for(const c in s){const u=s[c];u===null?a+=` -u ${l(c)}`:a+=` ${l(`${c}=${u}`)}`}a+=" "}for(const c of t)a+=c==="<"||c===">"||i?c:o(c),a+=" ";break}}return a}var Xy=class extends jg{constructor(t,i,r,s,n,o,a,l,c,u){super(t,i,r,s,a,l,c,u),this._terminalService=n,this._terminalShellIntegrationService=o,this._integratedTerminalInstances=new zV}createDebugAdapter(t,i){return t instanceof dl?new x6(this.convertExecutableToDto(t),i.type):t instanceof hl?new FV(this.convertServerToDto(t)):t instanceof mu?new $V(this.convertPipeServerToDto(t)):super.createDebugAdapter(t,i)}daExecutableFromPackage(t,i){const r=x6.platformAdapterExecutable(i.getAllExtensionDescriptions(),t.type);if(r)return new dl(r.command,r.args,r.options)}createSignService(){return new w6}async $runInTerminal(t,i){if(t.kind==="integrated"){this._terminalDisposedListener||(this._terminalDisposedListener=this._register(this._terminalService.onDidCloseTerminal(g=>{this._integratedTerminalInstances.onTerminalClosed(g)})));const r=await this._configurationService.getConfigProvider(),s=this._terminalService.getDefaultShell(!0),n=this._terminalService.getDefaultShellArgs(!0),o=t.title||h(2955,null),a=JSON.stringify({shell:s,shellArgs:n});let l=await this._integratedTerminalInstances.checkout(a,o),c,u=!1;if(l)c=t.cwd;else{const g={shellPath:s,shellArgs:n,cwd:t.cwd,name:o,iconPath:new pi("debug")};u=!0,l=this._terminalService.createTerminalFromOptions(g,{isFeatureTerminal:!0,forceShellIntegration:!0,useShellEnvironment:!0}),this._integratedTerminalInstances.insert(l,a)}l.show(!0);const d=await l.processId;if(u){let g;(function(y){y[y.DataDebounce=500]="DataDebounce",y[y.MaxDelay=5e3]="MaxDelay"})(g||(g={}));const v=new oe;await new Promise(y=>{const S=v.add(new ks(y,500));v.add(this._terminalService.onDidWriteTerminalData(x=>{x.terminal===l&&S.schedule()})),v.add(this._terminalShellIntegrationService.onDidChangeTerminalShellIntegration(x=>{x.terminal===l&&y()})),v.add($v(y,5e3))}),v.dispose()}else if(l.state.isInteractedWith&&!l.shellIntegration&&(l.sendText(""),await ui(200)),r.getConfiguration("debug.terminal").get("clearBeforeReusing")){let g;if(s.indexOf("powershell")>=0||s.indexOf("pwsh")>=0||s.indexOf("cmd.exe")>=0?g="cls":s.indexOf("bash")>=0?g="clear":Ve?g="cls":g="clear",l.shellIntegration){const v=new oe,y=l.shellIntegration.executeCommand(g);await new Promise(S=>{v.add(this._terminalShellIntegrationService.onDidEndTerminalShellExecution(x=>{x.execution===y&&S()})),v.add($v(S,500))}),v.dispose()}else l.sendText(g),await ui(200)}const f=BV(s,t.args,!!t.argsCanBeInterpretedByShell,c,t.env);l.shellIntegration?l.shellIntegration.executeCommand(f):l.sendText(f);const p=this.onDidTerminateDebugSession(g=>{g.id===i&&(this._integratedTerminalInstances.free(l),p.dispose())});return d}else if(t.kind==="external")return VV(t,await this._configurationService.getConfigProvider());return super.$runInTerminal(t,i)}};Xy=__decorate([__param(0,Pe),__param(1,Br),__param(2,Xs),__param(3,vr),__param(4,Ks),__param(5,By),__param(6,Bl),__param(7,Vl),__param(8,Vr),__param(9,gd)],Xy);var vd=void 0;function VV(e,t){if(!vd)if(Ve)vd=new Qy;else if(Mt)vd=new NV;else if(Ct)vd=new _6;else throw new Error("external terminals not supported on this platform");const i=t.getConfiguration("terminal");return vd.runInTerminal(e.title,e.cwd,e.args,e.env||{},i.external||{})}var zV=class T8{constructor(){this._terminalInstances=new Map}static{this.minUseDelay=1e3}async checkout(t,i,r=!1){const n=[...this._terminalInstances.entries()].map(([o,a])=>Ds(async l=>{if(o.name!==i||a.lastUsedAt!==-1&&await WV(await o.processId))return null;const c=Date.now();return a.lastUsedAt+T8.minUseDelay>c||l.isCancellationRequested?null:a.config!==t?(r&&o.dispose(),null):(a.lastUsedAt=c,o)}));return await V3(n,o=>!!o)}insert(t,i){this._terminalInstances.set(t,{lastUsedAt:Date.now(),config:i})}free(t){const i=this._terminalInstances.get(t);i&&(i.lastUsedAt=-1)}onTerminalClosed(t){this._terminalInstances.delete(t)}},C6=new Si(()=>{const e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});return{collator:e,collatorIsNumeric:e.resolvedOptions().numeric}}),fie=new Si(()=>({collator:new Intl.Collator(void 0,{numeric:!0})})),pie=new Si(()=>({collator:new Intl.Collator(void 0,{numeric:!0,sensitivity:"accent"})}));function D6(e,t,i=!1){const r=e||"",s=t||"",n=C6.value.collator.compare(r,s);return C6.value.collatorIsNumeric&&n===0&&r!==s?r<s?-1:1:n}function qV(e,t,i=!1){return i||(e=e&&e.toLowerCase(),t=t&&t.toLowerCase()),e===t?0:e<t?-1:1}function tm(e,t,i=!1){const r=e.split(St),s=t.split(St),n=r.length-1,o=s.length-1;let a,l;for(let c=0;;c++){if(a=n===c,l=o===c,a&&l)return D6(r[c],s[c],i);if(a)return-1;if(l)return 1;const u=qV(r[c],s[c],i);if(u!==0)return u}}function Yy(e,t,i){const r=e.toLowerCase(),s=t.toLowerCase(),n=jV(e,t,i);if(n)return n;const o=r.endsWith(i),a=s.endsWith(i);if(o!==a)return o?-1:1;const l=D6(r,s);return l!==0?l:r.localeCompare(s)}function jV(e,t,i){const r=e.toLowerCase(),s=t.toLowerCase(),n=r.startsWith(i),o=s.startsWith(i);if(n!==o)return n?-1:1;if(n&&o){if(r.length<s.length)return-1;if(r.length>s.length)return 1}return 0}var im=0,k6=[im,[]];function I6(e,t,i,r){if(!e||!t)return k6;const s=e.length,n=t.length;if(s<n)return k6;const o=e.toLowerCase();return GV(t,i,n,e,o,s,r)}function GV(e,t,i,r,s,n,o){const a=[],l=[];for(let f=0;f<i;f++){const p=f*n,g=p-n,v=f>0,y=e[f],S=t[f];for(let x=0;x<n;x++){const P=x>0,$=p+x,A=$-1,W=g+x-1,G=P?a[A]:0,J=v&&P?a[W]:0,H=v&&P?l[W]:0;let K;!J&&v?K=0:K=QV(y,S,r,s,x,H),K&&J+K>=G&&(o||v||s.startsWith(t,x))?(l[$]=H+1,a[$]=J+K):(l[$]=im,a[$]=G)}}const c=[];let u=i-1,d=n-1;for(;u>=0&&d>=0;){const f=u*n+d;l[f]===im||(c.push(d),u--),d--}return[a[i*n-1],c.reverse()]}function QV(e,t,i,r,s,n){let o=0;if(!JV(t,r[s]))return o;if(o+=1,n>0&&(o+=n*5),e===i[s]&&(o+=1),s===0)o+=8;else{const a=KV(i.charCodeAt(s-1));a?o+=a:Oc(i.charCodeAt(s))&&n===0&&(o+=2)}return o}function JV(e,t){return e===t?!0:e==="/"||e==="\\"?t==="/"||t==="\\":!1}function KV(e){switch(e){case 47:case 92:return 5;case 95:case 45:case 46:case 32:case 39:case 34:case 58:return 4;default:return 0}}var rm=Object.freeze({score:0}),sm=1<<18,Zy=1<<17,eb=65536;function XV(e,t,i,r){const s=r.values?r.values:[r];return Rs({[r.normalized]:{values:s.map(o=>({value:o.normalized,expectContiguousMatch:o.expectContiguousMatch})),label:e,description:t,allowNonContiguousMatches:i}})}function P6(e,t,i,r,s){if(!e||!t.normalized)return rm;const n=r.getItemLabel(e);if(!n)return rm;const o=r.getItemDescription(e),a=XV(n,o,i,t),l=s[a];if(l)return l;const c=YV(n,o,r.getItemPath(e),t,i);return s[a]=c,c}function YV(e,t,i,r,s){const n=!i||!r.containsPathSeparator;return i&&(Ct?r.pathNormalized===i:kr(r.pathNormalized,i))?{score:sm,labelMatch:[{start:0,end:e.length}],descriptionMatch:t?[{start:0,end:t.length}]:void 0}:r.values&&r.values.length>1?ZV(e,t,i,r.values,n,s):T6(e,t,i,r,n,s)}function ZV(e,t,i,r,s,n){let o=0;const a=[],l=[];for(const c of r){const{score:u,labelMatch:d,descriptionMatch:f}=T6(e,t,i,c,s,n);if(u===im)return rm;o+=u,d&&a.push(...d),f&&l.push(...f)}return{score:o,labelMatch:R6(a),descriptionMatch:R6(l)}}function T6(e,t,i,r,s,n){if(s||!t){const[o,a]=I6(e,r.normalized,r.normalizedLowercase,n&&!r.expectContiguousMatch);if(o){const l=b1(r.normalized,e);let c;if(l){c=Zy;const u=Math.round(r.normalized.length/e.length*100);c+=u}else c=eb;return{score:c+o,labelMatch:l||A6(a)}}}if(t){let o=t;i&&(o=`${t}${St}`);const a=o.length,l=`${o}${e}`,[c,u]=I6(l,r.normalized,r.normalizedLowercase,n&&!r.expectContiguousMatch);if(c){const d=A6(u),f=[],p=[];return d.forEach(g=>{g.start<a&&g.end>a?(f.push({start:0,end:g.end-a}),p.push({start:g.start,end:a})):g.start>=a?f.push({start:g.start-a,end:g.end-a}):p.push(g)}),{score:c,labelMatch:f,descriptionMatch:p}}}return rm}function A6(e){const t=[];if(!e)return t;let i;for(const r of e)i&&i.end===r?i.end+=1:(i={start:r,end:r+1},t.push(i));return t}function R6(e){const t=e.sort((s,n)=>s.start-n.start),i=[];let r;for(const s of t)!r||!ez(r,s)?(r=s,i.push(s)):(r.start=Math.min(r.start,s.start),r.end=Math.max(r.end,s.end));return i}function ez(e,t){return!(e.end<t.start||t.end<e.start)}function tz(e,t,i,r,s,n){const o=P6(e,i,r,s,n),a=P6(t,i,r,s,n),l=o.score,c=a.score;if((l===sm||c===sm)&&l!==c)return l===sm?-1:1;if(l>eb||c>eb){if(l!==c)return l>c?-1:1;if(l<Zy&&c<Zy){const y=iz(o.labelMatch,a.labelMatch);if(y!==0)return y}const g=s.getItemLabel(e)||"",v=s.getItemLabel(t)||"";if(g.length!==v.length)return g.length-v.length}if(l!==c)return l>c?-1:1;const u=Array.isArray(o.labelMatch)&&o.labelMatch.length>0,d=Array.isArray(a.labelMatch)&&a.labelMatch.length>0;if(u&&!d)return-1;if(d&&!u)return 1;const f=L6(e,o,s),p=L6(t,a,s);return f&&p&&f!==p?p>f?-1:1:rz(e,t,i,s)}function L6(e,t,i){let r=-1,s=-1;if(t.descriptionMatch&&t.descriptionMatch.length?r=t.descriptionMatch[0].start:t.labelMatch&&t.labelMatch.length&&(r=t.labelMatch[0].start),t.labelMatch&&t.labelMatch.length){if(s=t.labelMatch[t.labelMatch.length-1].end,t.descriptionMatch&&t.descriptionMatch.length){const n=i.getItemDescription(e);n&&(s+=n.length)}}else t.descriptionMatch&&t.descriptionMatch.length&&(s=t.descriptionMatch[t.descriptionMatch.length-1].end);return s-r}function iz(e,t){if(!e&&!t||(!e||!e.length)&&(!t||!t.length))return 0;if(!t||!t.length)return-1;if(!e||!e.length)return 1;const i=e[0].start,s=e[e.length-1].end-i,n=t[0].start,a=t[t.length-1].end-n;return s===a?0:a<s?1:-1}function rz(e,t,i,r){const s=r.getItemLabel(e)||"",n=r.getItemLabel(t)||"",o=r.getItemDescription(e),a=r.getItemDescription(t),l=s.length+(o?o.length:0),c=n.length+(a?a.length:0);if(l!==c)return l-c;const u=r.getItemPath(e),d=r.getItemPath(t);return u&&d&&u.length!==d.length?u.length-d.length:s!==n?Yy(s,n,i.normalized):o&&a&&o!==a?Yy(o,a,i.normalized):u&&d&&u!==d?Yy(u,d,i.normalized):0}function N6(e){return e.startsWith('"')&&e.endsWith('"')}var sz=" ";function tb(e){typeof e!="string"&&(e="");const t=e.toLowerCase(),{pathNormalized:i,normalized:r,normalizedLowercase:s}=M6(e),n=i.indexOf(St)>=0,o=N6(e);let a;const l=e.split(sz);if(l.length>1)for(const c of l){const u=N6(c),{pathNormalized:d,normalized:f,normalizedLowercase:p}=M6(c);f&&(a||(a=[]),a.push({original:c,originalLowercase:c.toLowerCase(),pathNormalized:d,normalized:f,normalizedLowercase:p,expectContiguousMatch:u}))}return{original:e,originalLowercase:t,pathNormalized:i,normalized:r,normalizedLowercase:s,values:a,containsPathSeparator:n,expectContiguousMatch:o}}function M6(e){let t;Ve?t=e.replace(/\//g,St):t=e.replace(/\\/g,St);const i=GL(t).replace(/\s|"/g,"");return{pathNormalized:t,normalized:i,normalizedLowercase:i.toLowerCase()}}import*as nz from"child_process";import*as ib from"fs";import{StringDecoder as O6}from"string_decoder";import*as oz from"child_process";function nm(e){return e.startsWith("**")||e.startsWith("/")?e:`/${e}`}function az(e){return new ww(e.start.line,e.start.character,e.end.line,e.end.character)}function F6(e){return new i5(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn)}var om=class{constructor(t,i){this.prefix=t,this.logService=i}appendLine(t){this.logService.debug(`${this.prefix}#search`,t)}};om=__decorate([__param(1,ke)],om);import{rgPath as lz}from"@vscode/ripgrep";var $6=lz.replace(/\bnode_modules\.asar\b/,"node_modules.asar.unpacked");function cz(e,t,i,r,s){const n=uz(e,t,i,r,s),o=t.folder.fsPath;return{cmd:oz.spawn($6,n.args,{cwd:o}),rgDiskPath:$6,siblingClauses:n.siblingClauses,rgArgs:n,cwd:o}}function uz(e,t,i,r,s){const n=["--files","--hidden","--case-sensitive","--no-require-git"];hz([t],i,!1).forEach(a=>{const l=nm(a);if(n.push("-g",l),Mt){const c=PE(l);c!==l&&n.push("-g",c)}});const o=dz([t],r,void 0,!1);return o.globArgs.forEach(a=>{const l=`!${nm(a)}`;if(n.push("-g",l),Mt){const c=PE(l);c!==l&&n.push("-g",c)}}),t.disregardIgnoreFiles!==!1?n.push("--no-ignore"):t.disregardParentIgnoreFiles!==!1&&n.push("--no-ignore-parent"),t.ignoreSymlinks||n.push("--follow"),e.exists&&n.push("--quiet"),s&&n.push("--threads",`${s}`),n.push("--no-config"),t.disregardGlobalIgnoreFiles&&n.push("--no-ignore-global"),{args:n,siblingClauses:o.siblingClauses}}function dz(e,t,i,r=!0){const s=[];let n={};return e.forEach(o=>{const a=Object.assign({},o.excludePattern||{},t||{}),l=H6(a,r?o.folder.fsPath:void 0,i);s.push(...l.globArgs),l.siblingClauses&&(n=Object.assign(n,l.siblingClauses))}),{globArgs:s,siblingClauses:n}}function hz(e,t,i=!0){const r=[];return e.forEach(s=>{const n=Object.assign({},t||{},s.includePattern||{}),o=H6(n,i?s.folder.fsPath:void 0);r.push(...o.globArgs)}),r}function H6(e,t,i){const r=[],s={};return Object.keys(e).forEach(n=>{if(i&&i.has(n)||!n)return;const o=e[n];n=pz(t?fz(t,n):n),n.startsWith("\\\\")?n="\\\\"+n.substr(2).replace(/\\/g,"/"):n=n.replace(/\\/g,"/"),typeof o=="boolean"&&o?(n.startsWith("\\\\")&&(n+="**"),r.push(gz(n))):o&&o.when&&(s[n]=o)}),{globArgs:r,siblingClauses:s}}function fz(e,t){return Dr(t)?t:Xe(e,t)}function pz(e){return e=vn(e,"\\"),vn(e,"/")}function gz(e){return Av(e).toLowerCase()==="c:/"?e.replace(/^c:[/\\]/i,"/"):e}var am=new Set;process.on("exit",()=>{am.forEach(e=>e())});var mz=class{constructor(e){this.normalizedFilePatternLowercase=null,this.maxFilesize=null,this.isCanceled=!1,this.fileWalkSW=null,this.cmdSW=null,this.cmdResultCount=0,this.config=e,this.filePattern=e.filePattern||"",this.includePattern=e.includePattern&&Lr(e.includePattern),this.maxResults=e.maxResults||null,this.exists=!!e.exists,this.walkedPaths=Object.create(null),this.resultCount=0,this.isLimitHit=!1,this.directoriesWalked=0,this.filesWalked=0,this.errors=[],this.filePattern&&(this.normalizedFilePatternLowercase=e.shouldGlobMatchFilePattern?null:tb(this.filePattern).normalizedLowercase),this.globalExcludePattern=e.excludePattern&&Lr(e.excludePattern),this.folderExcludePatterns=new Map,e.folderQueries.forEach(t=>{const i={};t.excludePattern?.forEach(s=>{Object.assign(i,s.pattern||{},this.config.excludePattern||{})}),t.excludePattern?.length||Object.assign(i,this.config.excludePattern||{});const r=t.folder.fsPath;e.folderQueries.map(s=>s.folder.fsPath).filter(s=>s!==r).forEach(s=>{ao(s,r)&&(i[Da(r,s)]=!0)}),this.folderExcludePatterns.set(r,new vz(i,r))})}cancel(){this.isCanceled=!0,am.forEach(e=>e())}walk(e,t,i,r,s,n){if(this.fileWalkSW=Hi.create(!1),this.isCanceled)return n(null,this.isLimitHit);t.forEach(o=>{const a=bt(o.fsPath);this.globalExcludePattern&&this.globalExcludePattern(o.fsPath,a)||this.matchFile(r,{relativePath:o.fsPath,searchPath:void 0})}),this.cmdSW=Hi.create(!1),this.parallel(e,(o,a)=>{this.call(this.cmdTraversal,this,o,i,r,s,l=>{if(l){const c=es(l);console.error(c),this.errors.push(c),a(l,void 0)}else a(null,void 0)})},(o,a)=>{this.fileWalkSW.stop();const l=o?Et(o)[0]:null;n(l,this.isLimitHit)})}parallel(e,t,i){const r=new Array(e.length),s=new Array(e.length);let n=!1,o=0;if(e.length===0)return i(null,[]);e.forEach((a,l)=>{t(a,(c,u)=>{if(c?(n=!0,r[l]=null,s[l]=c):(r[l]=u,s[l]=null),++o===e.length)return i(n?s:null,r)})})}call(e,t,...i){try{e.apply(t,i)}catch(r){i[i.length-1](r)}}cmdTraversal(e,t,i,r,s){const n=e.folder.fsPath,o=Mt,a=()=>f&&f.kill();am.add(a);let l=y=>{am.delete(a),l=()=>{},s(y)},c="";const u=this.initDirectoryTree(),d=cz(this.config,e,this.config.includePattern,this.folderExcludePatterns.get(e.folder.fsPath).expression,t),f=d.cmd,p=!Object.keys(d.siblingClauses).length,g=d.rgArgs.args.map(y=>y.match(/^-/)?y:`'${y}'`).join(" ");let v=`${d.rgDiskPath} ${g}
 - cwd: ${d.cwd}`;d.rgArgs.siblingClauses&&(v+=`
 - Sibling clauses: ${JSON.stringify(d.rgArgs.siblingClauses)}`),r({message:v}),this.cmdResultCount=0,this.collectStdout(f,"utf8",r,(y,S,x)=>{if(y){l(y);return}if(this.isLimitHit){l();return}const $=(c+(o?Ph(S||""):S)).split(`
`);if(x){const A=$.length;$[A-1]=$[A-1].trim(),$[A-1]||$.pop()}else c=$.pop()||"";if($.length&&$[0].indexOf(`
`)!==-1){l(new Error("Splitting up files failed"));return}if(this.cmdResultCount+=$.length,p){for(const A of $)if(this.matchFile(i,{base:n,relativePath:A,searchPath:this.getSearchPath(e,A)}),this.isLimitHit){a();break}(x||this.isLimitHit)&&l();return}this.addDirectoryEntries(e,u,n,$,i),x&&(this.matchDirectoryTree(u,n,i),l())})}spawnFindCmd(e){const t=this.folderExcludePatterns.get(e.folder.fsPath),i=t.getBasenameTerms(),r=t.getPathTerms(),s=["-L","."];if(i.length||r.length){s.push("-not","(","(");for(const n of i)s.push("-name",n),s.push("-o");for(const n of r)s.push("-path",n),s.push("-o");s.pop(),s.push(")","-prune",")")}return s.push("-type","f"),nz.spawn("find",s,{cwd:e.folder.fsPath})}readStdout(e,t,i){let r="";this.collectStdout(e,t,()=>{},(s,n,o)=>{if(s){i(s);return}r+=n,o&&i(null,r)})}collectStdout(e,t,i,r){let s=(a,l,c)=>{(a||c)&&(s=()=>{},this.cmdSW?.stop()),r(a,l,c)},n=!1;e.stdout?(this.forwardData(e.stdout,t,s),e.stdout.once("data",()=>n=!0)):i({message:"stdout is null"});let o;e.stderr?o=this.collectData(e.stderr):i({message:"stderr is null"}),e.on("error",a=>{s(a)}),e.on("close",a=>{let l;!n&&(l=this.decodeData(o,t))&&_z(l)?s(new Error(`command failed with error code ${a}: ${this.decodeData(o,t)}`)):(this.exists&&a===0&&(this.isLimitHit=!0),s(null,"",!0))})}forwardData(e,t,i){const r=new O6(t);return e.on("data",s=>{i(null,r.write(s))}),r}collectData(e){const t=[];return e.on("data",i=>{t.push(i)}),t}decodeData(e,t){const i=new O6(t);return e.map(r=>i.write(r)).join("")}initDirectoryTree(){const e={rootEntries:[],pathToEntries:Object.create(null)};return e.pathToEntries["."]=e.rootEntries,e}addDirectoryEntries(e,{pathToEntries:t},i,r,s){r.indexOf(this.filePattern)!==-1&&this.matchFile(s,{base:i,relativePath:this.filePattern,searchPath:this.getSearchPath(e,this.filePattern)});const n=o=>{const a=bt(o),l=Bi(o);let c=t[l];c||(c=t[l]=[],n(l)),c.push({base:i,relativePath:o,basename:a,searchPath:this.getSearchPath(e,o)})};r.forEach(n)}matchDirectoryTree({rootEntries:e,pathToEntries:t},i,r){const s=this,n=this.folderExcludePatterns.get(i),o=this.filePattern;function a(l){s.directoriesWalked++;const c=bw(()=>l.map(u=>u.basename));for(let u=0,d=l.length;u<d;u++){const f=l[u],{relativePath:p,basename:g}=f;if(n.test(p,g,o!==g?c:void 0))continue;const v=t[p];if(v)a(v);else{if(s.filesWalked++,p===o)continue;s.matchFile(r,f)}if(s.isLimitHit)break}}a(e)}getStats(){return{cmdTime:this.cmdSW.elapsed(),fileWalkTime:this.fileWalkSW.elapsed(),directoriesWalked:this.directoriesWalked,filesWalked:this.filesWalked,cmdResultCount:this.cmdResultCount}}doWalk(e,t,i,r,s){const n=e.folder,o=bw(()=>i);this.parallel(i,(a,l)=>{if(this.isCanceled||this.isLimitHit)return l(null);const c=t?[t,a].join(St):a;if(this.folderExcludePatterns.get(e.folder.fsPath).test(c,a,this.config.filePattern!==a?o:void 0))return l(null);const u=[n.fsPath,c].join(St);ib.lstat(u,(d,f)=>{if(d||this.isCanceled||this.isLimitHit)return l(null);this.statLinkIfNeeded(u,f,(p,g)=>p||this.isCanceled||this.isLimitHit?l(null):g.isDirectory()?(this.directoriesWalked++,this.realPathIfNeeded(u,f,(v,y)=>v||this.isCanceled||this.isLimitHit||(y=y||"",this.walkedPaths[y])?l(null):(this.walkedPaths[y]=!0,dt.readdir(u).then(S=>{if(this.isCanceled||this.isLimitHit)return l(null);this.doWalk(e,c,S,r,x=>l(x||null))},S=>{l(null)})))):(this.filesWalked++,c===this.filePattern||this.maxFilesize&&cr(g.size)&&g.size>this.maxFilesize||this.matchFile(r,{base:n.fsPath,relativePath:c,searchPath:this.getSearchPath(e,c)}),l(null,void 0)))})},a=>{const l=a&&Et(a);return s(l&&l.length>0?l[0]:void 0)})}matchFile(e,t){this.isFileMatch(t)&&(!this.includePattern||this.includePattern(t.relativePath,bt(t.relativePath)))&&(this.resultCount++,(this.exists||this.maxResults&&this.resultCount>this.maxResults)&&(this.isLimitHit=!0),this.isLimitHit||e(t))}isFileMatch(e){if(this.filePattern){if(this.filePattern==="*")return!0;if(this.normalizedFilePatternLowercase)return yw(e,this.normalizedFilePatternLowercase);if(this.filePattern)return yw(e,this.filePattern,!1)}return!0}statLinkIfNeeded(e,t,i){return t.isSymbolicLink()?ib.stat(e,i):i(null,t)}realPathIfNeeded(e,t,i){return t.isSymbolicLink()?ib.realpath(e,(r,s)=>r?i(r):i(null,s)):i(null,e)}getSearchPath(e,t){return e.folderName?Xe(e.folderName,t):t}},U6=class{constructor(e,t){this.folderQueries=e.folderQueries,this.extraFiles=e.extraFileResources||[],this.numThreads=t,this.walker=new mz(e)}search(e,t,i){this.walker.walk(this.folderQueries,this.extraFiles,this.numThreads,e,t,(r,s)=>{i(r,{limitHit:s,stats:this.walker.getStats(),messages:[]})})}cancel(){this.walker.cancel()}},vz=class{constructor(e,t){this.expression=e,this.root=t,this.init(e)}init(e){let t,i;Object.keys(e).filter(r=>e[r]).forEach(r=>{Dr(r)?(t=t||uI(),t[r]=e[r]):(i=i||uI(),i[r]=e[r])}),this.absoluteParsedExpr=t&&Lr(t,{trimForExclusions:!0}),this.relativeParsedExpr=i&&Lr(i,{trimForExclusions:!0})}test(e,t,i){return this.relativeParsedExpr&&this.relativeParsedExpr(e,t,i)||this.absoluteParsedExpr&&this.absoluteParsedExpr(Xe(this.root,e),t,i)}getBasenameTerms(){const e=[];return this.absoluteParsedExpr&&e.push(...vI(this.absoluteParsedExpr)),this.relativeParsedExpr&&e.push(...vI(this.relativeParsedExpr)),e}getPathTerms(){const e=[];return this.absoluteParsedExpr&&e.push(..._I(this.absoluteParsedExpr)),this.relativeParsedExpr&&e.push(..._I(this.relativeParsedExpr)),e}};function _z(e){const t=e.trim().split(`
`),i=t[0].trim();if(i.startsWith("Error parsing regex"))return i;if(i.startsWith("regex parse error"))return c3(t[t.length-1].trim());if(i.startsWith("error parsing glob")||i.startsWith("unsupported encoding"))return i.charAt(0).toUpperCase()+i.substr(1);if(i==="Literal '\\n' not allowed.")return"Literal '\\n' currently not supported";if(i.startsWith("Literal "))return i}import*as wz from"child_process";import{EventEmitter as yz}from"events";import{StringDecoder as bz}from"string_decoder";import{RegExpParser as Sz,RegExpVisitor as xz}from"vscode-regexpp";import{rgPath as Ez}from"@vscode/ripgrep";var W6=Ez.replace(/\bnode_modules\.asar\b/,"node_modules.asar.unpacked"),B6=class{constructor(e,t){this.outputChannel=e,this._numThreads=t}provideTextSearchResults(e,t,i,r){return Promise.all(t.folderOptions.map(s=>{const n={folderOptions:s,numThreads:this._numThreads,maxResults:t.maxResults,previewOptions:t.previewOptions,maxFileSize:t.maxFileSize,surroundingContext:t.surroundingContext};return this.provideTextSearchResultsWithRgOptions(e,n,i,r)})).then(s=>({limitHit:s.some(o=>!!o&&o.limitHit)}))}provideTextSearchResultsWithRgOptions(e,t,i,r){return this.outputChannel.appendLine(`provideTextSearchResults ${e.pattern}, ${JSON.stringify({...t,folder:t.folderOptions.folder.toString()})}`),new Promise((s,n)=>{r.onCancellationRequested(()=>g());const o={...t,numThreads:this._numThreads},a=Iz(e,o),l=t.folderOptions.folder.fsPath,c=a.map(P=>P.match(/^-/)?P:`'${P}'`).join(" ");this.outputChannel.appendLine(`${W6} ${c}
 - cwd: ${l}`);let u=wz.spawn(W6,a,{cwd:l});u.on("error",P=>{console.error(P),this.outputChannel.appendLine("Error: "+(P&&P.message)),n(h5(new Yo(P&&P.message,Bn.rgProcessError)))});let d=!1;const f=new kz(t.maxResults??mg,t.folderOptions.folder,o6(t.previewOptions));f.on("result",P=>{d=!0,y="",i.report(P)});let p=!1;const g=()=>{p=!0,u?.kill(),f?.cancel()};let v=!1;f.on("hitLimit",()=>{v=!0,g()});let y="";u.stdout.on("data",P=>{f.handleData(P),d||(y+=P)});let S=!1;u.stdout.once("data",()=>S=!0);let x="";u.stderr.on("data",P=>{const $=P.toString();this.outputChannel.appendLine($),x.length+$.length<1e6&&(x+=$)}),u.on("close",()=>{if(this.outputChannel.appendLine(S?"Got data from stdout":"No data from stdout"),this.outputChannel.appendLine(d?"Got result from parser":"No result from parser"),y&&this.outputChannel.appendLine(`Got data without result: ${y}`),this.outputChannel.appendLine(""),p)s({limitHit:v});else{f.flush(),u=null;let P;x&&!S&&(P=Cz(x))?n(h5(new Yo(P.message,P.code))):s({limitHit:v})}})})}};function Cz(e){const t=e.split(`
`),i=t[0].trim();if(t.some(s=>s.startsWith("regex parse error")))return new Yo(Dz(t),Bn.regexParseError);const r=i.match(/grep config error: unknown encoding: (.*)/);if(r)return new Yo(`Unknown encoding: ${r[1]}`,Bn.unknownEncoding);if(i.startsWith("error parsing glob"))return new Yo(i.charAt(0).toUpperCase()+i.substr(1),Bn.globParseError);if(i.startsWith("the literal"))return new Yo(i.charAt(0).toUpperCase()+i.substr(1),Bn.invalidLiteral);if(i.startsWith("PCRE2: error compiling pattern"))return new Yo(i,Bn.regexParseError)}function Dz(e){const t=["Regex parse error"],i=e.filter(r=>r.startsWith("PCRE2:"));if(i.length>=1){const r=i[0].replace("PCRE2:","");if(r.indexOf(":")!==-1&&r.split(":").length>=2){const s=r.split(":")[1];t.push(":"+s)}}return t.join("")}var kz=class extends yz{constructor(e,t,i){super(),this.maxResults=e,this.root=t,this.previewOptions=i,this.remainder="",this.isDone=!1,this.hitLimit=!1,this.numResults=0,this.stringDecoder=new bz}cancel(){this.isDone=!0}flush(){this.handleDecodedData(this.stringDecoder.end())}on(e,t){return super.on(e,t),this}handleData(e){if(this.isDone)return;const t=typeof e=="string"?e:this.stringDecoder.write(e);this.handleDecodedData(t)}handleDecodedData(e){let t=e.indexOf(`
`);const i=this.remainder+e;if(t>=0)t+=this.remainder.length;else{this.remainder=i;return}let r=0;for(;t>=0;)this.handleLine(i.substring(r,t).trim()),r=t+1,t=i.indexOf(`
`,r);this.remainder=i.substring(r)}handleLine(e){if(this.isDone||!e)return;let t;try{t=JSON.parse(e)}catch{throw new Error(`malformed line from rg: ${e}`)}if(t.type==="match"){const i=_d(t.data.path),r=b.joinPath(this.root,i),s=this.createTextSearchMatch(t.data,r);this.onResult(s),this.hitLimit&&(this.cancel(),this.emit("hitLimit"))}else if(t.type==="context"){const i=_d(t.data.path),r=b.joinPath(this.root,i);this.createTextSearchContexts(t.data,r).forEach(n=>this.onResult(n))}}createTextSearchMatch(e,t){const i=e.line_number-1,r=_d(e.lines),s=Buffer.from(r);let n=0,o=0,a=i;e.submatches.length===0&&e.submatches.push(r.length?{start:0,end:1,match:{text:r[0]}}:{start:0,end:0,match:{text:""}});const l=Et(e.submatches.map((d,f)=>{if(this.hitLimit)return null;this.numResults++,this.numResults>=this.maxResults&&(this.hitLimit=!0);const p=_d(d.match),g=s.slice(n,d.start).toString(),v=V6(g),y=v.numLines>0?v.lastLineLength:v.lastLineLength+o,S=V6(p),x=v.numLines+a,P=S.numLines+x,$=S.numLines>0?S.lastLineLength:S.lastLineLength+y;return n=d.end,o=$,a=P,new i5(x,y,P,$)})),c=th(l,az),u=new l5(r,c,this.previewOptions);return new Gs(t,u.rangeLocations.map(d=>({sourceRange:F6(d.source),previewRange:F6(d.preview)})),u.previewText)}createTextSearchContexts(e,t){const i=_d(e.lines),r=e.line_number;return i.replace(/\r?\n$/,"").split(`
`).map((s,n)=>new pg(t,s,r+n))}onResult(e){this.emit("result",e)}};function _d(e){return e.bytes?Buffer.from(e.bytes,"base64").toString():e.text}function V6(e){const t=/\n/g;let i=0,r=-1,s;for(;s=t.exec(e);)i++,r=s.index;const n=r>=0?e.length-r-1:e.length;return{numLines:i,lastLineLength:n}}function Iz(e,t){const i=["--hidden","--no-require-git"];i.push(e.isCaseSensitive?"--case-sensitive":"--ignore-case");const{doubleStarIncludes:r,otherIncludes:s}=cv(t.folderOptions.includes,o=>o.startsWith("**")?"doubleStarIncludes":"otherIncludes");if(s&&s.length){const o=new Set;s.forEach(a=>{o.add(a)}),i.push("-g","!*"),o.forEach(a=>{Pz(a).map(nm).forEach(l=>{i.push("-g",l)})})}r&&r.length&&r.forEach(o=>{i.push("-g",o)}),t.folderOptions.excludes.map(o=>typeof o=="string"?o:o.pattern).map(nm).forEach(o=>i.push("-g",`!${o}`)),t.maxFileSize&&i.push("--max-filesize",t.maxFileSize+""),t.folderOptions.useIgnoreFiles.local?t.folderOptions.useIgnoreFiles.parent||i.push("--no-ignore-parent"):i.push("--no-ignore"),t.folderOptions.followSymlinks&&i.push("--follow"),t.folderOptions.encoding&&t.folderOptions.encoding!=="utf8"&&i.push("--encoding",t.folderOptions.encoding),t.numThreads&&i.push("--threads",`${t.numThreads}`),e.pattern==="--"&&(e.isRegExp=!0,e.pattern="\\-\\-"),e.isMultiline&&!e.isRegExp&&(e.pattern=mn(e.pattern),e.isRegExp=!0),t.usePCRE2&&i.push("--pcre2"),i.push("--crlf"),e.isRegExp&&(e.pattern=Tz(e.pattern),i.push("--engine","auto"));let n;if(e.isWordMatch){const a=Hx(e.pattern,!!e.isRegExp,{wholeWord:e.isWordMatch}).source.replace(/\\\//g,"/");i.push("--regexp",a)}else if(e.isRegExp){let o=Az(e.pattern);o=Rz(o),i.push("--regexp",o)}else n=e.pattern,i.push("--fixed-strings");return i.push("--no-config"),t.folderOptions.useIgnoreFiles.global||i.push("--no-ignore-global"),i.push("--json"),e.isMultiline&&i.push("--multiline"),t.surroundingContext&&(i.push("--before-context",t.surroundingContext+""),i.push("--after-context",t.surroundingContext+"")),i.push("--"),n&&i.push(n),i.push("."),i}function Pz(e){return q6(e).flatMap(i=>{const r=qc(i,"/");return r.map((s,n)=>r.slice(0,n+1).join("/"))})}function Tz(e){const t=/((?:[^\\]|^)(?:\\\\)*)\\u([a-z0-9]{4})/gi;for(;e.match(t);)e=e.replace(t,"$1\\x{$2}");const i=/((?:[^\\]|^)(?:\\\\)*)\\u\{([a-z0-9]{4})\}/gi;for(;e.match(i);)e=e.replace(i,"$1\\x{$2}");return e}var z6=e=>e.type==="Assertion"&&e.kind==="lookbehind";function Az(e){let t;try{t=new Sz().parsePattern(e)}catch{return e}let i="",r=0;const s=(a,l,c)=>{i+=e.slice(r,a)+c,r=l},n=[];return new xz({onCharacterEnter(a){if(a.raw!=="\\n")return;const l=n[0];if(!l)s(a.start,a.end,"\\r?\\n");else if(!n.some(z6))if(l.type==="CharacterClass")if(l.negate){const c=e.slice(l.start+2,a.start)+e.slice(a.end,l.end-1);l.parent?.type==="Quantifier"?s(l.start,l.end,c?`[^${c}]`:"."):s(l.start,l.end,"(?!\\r?\\n"+(c?`|[${c}]`:"")+")")}else{const c=e.slice(l.start+1,a.start)+e.slice(a.end,l.end-1);s(l.start,l.end,c===""?"\\r?\\n":`(?:[${c}]|\\r?\\n)`)}else l.type==="Quantifier"&&s(a.start,a.end,"(?:\\r?\\n)")},onQuantifierEnter(a){n.unshift(a)},onQuantifierLeave(){n.shift()},onCharacterClassRangeEnter(a){n.unshift(a)},onCharacterClassRangeLeave(){n.shift()},onCharacterClassEnter(a){n.unshift(a)},onCharacterClassLeave(){n.shift()},onAssertionEnter(a){z6(a)&&n.push(a)},onAssertionLeave(a){n[0]===a&&n.shift()}}).visit(t),i+=e.slice(r),i}function Rz(e){return e.replace(/\n/g,"\\r?\\n")}function Lz(e){let t=!1,i=!1,r="",s="";for(let n=0;n<e.length;n++){const o=e[n];switch(o){case"\\":i?(t?s+="\\"+o:r+="\\"+o,i=!1):i=!0;break;case"{":if(i)t?s+=o:r+=o,i=!1;else{if(t)return{strInBraces:r+"{"+s+"{"+e.substring(n+1)};t=!0}break;case"}":if(i)t?s+=o:r+=o,i=!1;else{if(t)return{fixedStart:r,strInBraces:s,fixedEnd:e.substring(n+1)};r+=o}break;default:t?s+=(i?"\\":"")+o:r+=(i?"\\":"")+o,i=!1;break}}return{strInBraces:r+(t?"{"+s:"")}}function q6(e){const{fixedStart:t,strInBraces:i,fixedEnd:r}=Lz(e);if(t===void 0||r===void 0)return[i];let s=qc(i,",");s.length||(s=[""]);const n=q6(r);return s.flatMap(o=>{const a=t+o;return n.map(l=>a+l)})}var j6=class extends $y{constructor(e,t,i=Ih,r="searchProcess"){super({query:e,provider:t},{readdir:s=>i.Promises.readdir(s.fsPath),toCanonicalName:s=>GU(s)},r)}},Nz=class{constructor(e,t){this.query=e,this.numThreads=t}search(e,t,i){if((!this.query.folderQueries||!this.query.folderQueries.length)&&(!this.query.extraFileResources||!this.query.extraFileResources.length))return Promise.resolve({type:"success",limitHit:!1,stats:{type:"searchProcess"},messages:[]});const r={appendLine(n){i({message:n})}},s=new j6(this.query,new B6(r,this.numThreads),Ih);return new Promise((n,o)=>s.search(a=>{t(a.map(Mz))},e).then(a=>n({limitHit:a.limitHit??!1,type:"success",stats:a.stats,messages:[]}),o))}};function Mz(e){return{path:e.resource&&e.resource.fsPath,results:e.results,numMatches:(e.results||[]).reduce((t,i)=>_w(i)?t+i.rangeLocations.length:t+1,0)}}var Oz=class Zm{static{this.BATCH_SIZE=512}constructor(t="searchProcess",i){this.processType=t,this.getNumThreads=i,this.caches=Object.create(null)}fileSearch(t){let i;const r=G6(t),s=new D({onDidAddFirstListener:()=>{i=Ds(async n=>{const o=await this.getNumThreads?.();return this.doFileSearchWithEngine(U6,r,a=>s.fire(a),n,Zm.BATCH_SIZE,o)}),i.then(n=>s.fire(n),n=>s.fire({type:"error",error:{message:n.message,stack:n.stack}}))},onDidRemoveLastListener:()=>{i.cancel()}});return s.event}textSearch(t){let i;const r=G6(t),s=new D({onDidAddFirstListener:()=>{i=Ds(n=>this.ripgrepTextSearch(r,o=>s.fire(o),n)),i.then(n=>s.fire(n),n=>s.fire({type:"error",error:{message:n.message,stack:n.stack}}))},onDidRemoveLastListener:()=>{i.cancel()}});return s.event}async ripgrepTextSearch(t,i,r){t.maxFileSize=this.getPlatformFileLimits().maxFileSize;const s=await this.getNumThreads?.();return new Nz(t,s).search(r,i,i)}getPlatformFileLimits(){return{maxFileSize:16*Lk.GB}}doFileSearch(t,i,r,s){return this.doFileSearchWithEngine(U6,t,r,s,Zm.BATCH_SIZE,i)}doFileSearchWithEngine(t,i,r,s,n=Zm.BATCH_SIZE,o){let a=0;const l=u=>{Array.isArray(u)?(a+=u.length,r(u.map(d=>this.rawMatchToSearchItem(d)))):u.relativePath?(a++,r(this.rawMatchToSearchItem(u))):r(u)};if(i.sortByScore){let u=this.trySortedSearchFromCache(i,l,s);if(!u){const d=i.maxResults?Object.assign({},i,{maxResults:null}):i,f=new t(d,o);u=this.doSortedSearch(f,i,r,l,s)}return new Promise((d,f)=>{u.then(([p,g])=>{const v=g.map(y=>this.rawMatchToSearchItem(y));this.sendProgress(v,r,n),d(p)},f)})}const c=new t(i,o);return this.doSearch(c,l,n,s).then(u=>({limitHit:u.limitHit,type:"success",stats:{detailStats:u.stats,type:this.processType,fromCache:!1,resultCount:a,sortingTime:void 0},messages:[]}))}rawMatchToSearchItem(t){return{path:t.base?Xe(t.base,t.relativePath):t.relativePath}}doSortedSearch(t,i,r,s,n){const o=new D;let a=Ds(c=>{let u=[];const d=f=>{Array.isArray(f)?u=f:(s(f),o.fire(f))};return this.doSearch(t,d,-1,c).then(f=>[f,u])}),l;if(i.cacheKey){l=this.getOrCreateCache(i.cacheKey);const c={promise:a,event:o.event,resolved:!1};l.resultsToSearchCache[i.filePattern||""]=c,a.then(()=>{c.resolved=!0},u=>{delete l.resultsToSearchCache[i.filePattern||""]}),a=this.preventCancellation(a)}return a.then(([c,u])=>{const d=l?l.scorerCache:Object.create(null),f=(typeof i.maxResults!="number"||i.maxResults>0)&&Hi.create(!1);return this.sortResults(i,u,d,n).then(p=>{const g=f?f.elapsed():-1;return[{type:"success",stats:{detailStats:c.stats,sortingTime:g,fromCache:!1,type:this.processType,resultCount:p.length},messages:c.messages,limitHit:c.limitHit||typeof i.maxResults=="number"&&u.length>i.maxResults},p]})})}getOrCreateCache(t){const i=this.caches[t];return i||(this.caches[t]=new Fz)}trySortedSearchFromCache(t,i,r){const s=t.cacheKey&&this.caches[t.cacheKey];if(!s)return;const n=this.getResultsFromCache(s,t.filePattern||"",i,r);if(n)return n.then(([o,a,l])=>{const c=Hi.create(!1);return this.sortResults(t,a,s.scorerCache,r).then(u=>{const d=c.elapsed(),f={fromCache:!0,detailStats:l,type:this.processType,resultCount:a.length,sortingTime:d};return[{type:"success",limitHit:o.limitHit||typeof t.maxResults=="number"&&a.length>t.maxResults,stats:f,messages:[]},u]})})}sortResults(t,i,r,s){const n=tb(t.filePattern||""),o=(l,c)=>tz(l,c,n,!0,$z,r),a=typeof t.maxResults=="number"?t.maxResults:mg;return HR(i,o,a,1e4,s)}sendProgress(t,i,r){if(r&&r>0)for(let s=0;s<t.length;s+=r)i(t.slice(s,s+r));else i(t)}getResultsFromCache(t,i,r,s){const n=Hi.create(!1),o=i.indexOf(St)>=0;let a;for(const d in t.resultsToSearchCache)if(i.startsWith(d)){if(o&&d.indexOf(St)<0&&d!=="")continue;const f=t.resultsToSearchCache[d];a={promise:this.preventCancellation(f.promise),event:f.event,resolved:f.resolved};break}if(!a)return null;const l=n.elapsed(),c=Hi.create(!1),u=a.event(r);return s&&s.onCancellationRequested(()=>{u.dispose()}),a.promise.then(([d,f])=>{if(s&&s.isCancellationRequested)throw cc();const p=[],g=tb(i).normalizedLowercase;for(const v of f)yw(v,g)&&p.push(v);return[d,p,{cacheWasResolved:a.resolved,cacheLookupTime:l,cacheFilterTime:c.elapsed(),cacheEntryCount:f.length}]})}doSearch(t,i,r,s){return new Promise((n,o)=>{let a=[];s?.onCancellationRequested(()=>t.cancel()),t.search(l=>{l&&(r?(a.push(l),r>0&&a.length>=r&&(i(a),a=[])):i(l))},l=>{i(l)},(l,c)=>{a.length&&i(a),l?(i({message:"Search finished. Error: "+l.message}),o(l)):(i({message:"Search finished. Stats: "+JSON.stringify(c.stats)}),n(c))})})}clearCache(t){return delete this.caches[t],Promise.resolve(void 0)}preventCancellation(t){return new class{get[Symbol.toStringTag](){return this.toString()}cancel(){}then(i,r){return t.then(i,r)}catch(i){return this.then(void 0,i)}finally(i){return t.finally(i)}}}},Fz=class{constructor(){this.resultsToSearchCache=Object.create(null),this.scorerCache=Object.create(null)}},$z=new class{getItemLabel(e){return bt(e.relativePath)}getItemDescription(e){return Bi(e.relativePath)}getItemPath(e){return e.relativePath}};function G6(e){return{...e,folderQueries:e.folderQueries&&e.folderQueries.map(Hz),extraFileResources:e.extraFileResources&&e.extraFileResources.map(t=>b.revive(t))}}function Hz(e){return kt(e)}var Q6=class{constructor(e,t){this.outputChannel=e,this.getNumThreads=t,this.inProgress=new Set,process.once("exit",()=>this.dispose())}async provideTextSearchResults(e,t,i,r){const s=await this.getNumThreads(),n=new B6(this.outputChannel,s);return Promise.all(t.folderOptions.map(o=>{const a={folderOptions:o,numThreads:s,maxResults:t.maxResults,previewOptions:t.previewOptions,maxFileSize:t.maxFileSize,surroundingContext:t.surroundingContext};if(o.folder.scheme===V.vscodeUserData){const l={...a,folder:o.folder.with({scheme:V.file})},c=new Rg(u=>i.report({...u,uri:u.uri.with({scheme:o.folder.scheme})}));return this.withToken(r,u=>n.provideTextSearchResultsWithRgOptions(e,l,c,u))}else return this.withToken(r,l=>n.provideTextSearchResultsWithRgOptions(e,a,i,l))})).then(o=>({limitHit:o.some(l=>!!l&&l.limitHit)}))}async withToken(e,t){const i=Uz(e);this.inProgress.add(i);const r=await t(i.token);return this.inProgress.delete(i),r}dispose(){this.inProgress.forEach(e=>e.cancel())}};function Uz(e){const t=new rt;return e.onCancellationRequested(()=>t.cancel()),t}var rb=class extends Gg{constructor(t,i,r,s,n){super(t,r,n),this.configurationService=s,this._pfs=Ih,this._internalFileSearchHandle=-1,this._internalFileSearchProvider=null,this._registeredEHSearchProvider=!1,this._disposables=new oe,this.isDisposed=!1,this.getNumThreads=this.getNumThreads.bind(this),this.getNumThreadsCached=this.getNumThreadsCached.bind(this),this.handleConfigurationChanged=this.handleConfigurationChanged.bind(this);const o=new om("RipgrepSearchUD",this._logService);this._disposables.add(this.registerTextSearchProvider(V.vscodeUserData,new Q6(o,this.getNumThreadsCached))),i.remote.isRemote&&i.remote.authority&&this._registerEHSearchProviders(),s.getConfigProvider().then(a=>{this.isDisposed||this._disposables.add(a.onDidChangeConfiguration(this.handleConfigurationChanged))})}handleConfigurationChanged(t){t.affectsConfiguration("search")&&(this._numThreadsPromise=void 0)}async getNumThreads(){return(await this.configurationService.getConfigProvider()).getConfiguration("search").get("ripgrep.maxThreads")}async getNumThreadsCached(){return this._numThreadsPromise||(this._numThreadsPromise=this.getNumThreads()),this._numThreadsPromise}dispose(){this.isDisposed=!0,this._disposables.dispose()}$enableExtensionHostSearch(){this._registerEHSearchProviders()}_registerEHSearchProviders(){if(this._registeredEHSearchProvider)return;this._registeredEHSearchProvider=!0;const t=new om("RipgrepSearchEH",this._logService);this._disposables.add(this.registerTextSearchProvider(V.file,new Q6(t,this.getNumThreadsCached))),this._disposables.add(this.registerInternalFileSearchProvider(V.file,new Oz("fileSearchProvider",this.getNumThreadsCached)))}registerInternalFileSearchProvider(t,i){const r=this._handlePool++;return this._internalFileSearchProvider=i,this._internalFileSearchHandle=r,this._proxy.$registerFileSearchProvider(r,this._transformScheme(t)),ie(()=>{this._internalFileSearchProvider=null,this._proxy.$unregisterProvider(r)})}$provideFileSearchResults(t,i,r,s){const n=Qg(r);if(t===this._internalFileSearchHandle){const o=Date.now();return this.doInternalFileSearch(t,i,n,s).then(a=>{const l=Date.now()-o;return this._logService.debug(`Ext host file search time: ${l}ms`),a})}return super.$provideFileSearchResults(t,i,r,s)}async doInternalFileSearchWithCustomCallback(t,i,r){const s=o=>{if(DU(o)&&(o=[o]),Array.isArray(o)){r(o.map(a=>b.file(a.path)));return}o.message&&this._logService.debug("ExtHostSearch",o.message)};if(!this._internalFileSearchProvider)throw new Error("No internal file search handler");const n=await this.getNumThreadsCached();return this._internalFileSearchProvider.doFileSearch(t,n,s,i)}async doInternalFileSearch(t,i,r,s){return this.doInternalFileSearchWithCustomCallback(r,s,n=>{this._proxy.$handleFileMatch(t,i,n)})}$clearCache(t){return this._internalFileSearchProvider?.clearCache(t),super.$clearCache(t)}createTextSearchManager(t,i){return new j6(t,i,void 0,"textSearchProvider")}};rb=__decorate([__param(0,Pe),__param(1,zt),__param(2,Nc),__param(3,vr),__param(4,ke)],rb);function J6(e,t,i,r,s,n){if(Array.isArray(e)){let o=0;for(const a of e){const l=J6(a,t,i,r,s,n);if(l===10)return l;l>o&&(o=l)}return o}else{if(typeof e=="string")return r?e==="*"?5:e===i?10:0:0;if(e){const{language:o,pattern:a,scheme:l,hasAccessToAllModels:c,notebookType:u}=e;if(!r&&!c)return 0;u&&s&&(t=s);let d=0;if(l)if(l===t.scheme)d=10;else if(l==="*")d=5;else return 0;if(o)if(o===i)d=10;else if(o==="*")d=Math.max(d,5);else return 0;if(u)if(u===n)d=10;else if(u==="*"&&n!==void 0)d=Math.max(d,5);else return 0;if(a){let f;if(typeof a=="string"?f=a:f={...a,base:Cs(a.base)},f===t.fsPath||Va(f,t.fsPath))d=10;else return 0}return d}else return 0}}function K6(e){return typeof e=="string"?!1:Array.isArray(e)?e.some(K6):!!e.notebookType}var sb;(function(e){e[e.None=0]="None",e[e.Indent=1]="Indent",e[e.IndentOutdent=2]="IndentOutdent",e[e.Outdent=3]="Outdent"})(sb||(sb={}));var xie=q("editSessionIdentityService"),nb;(function(e){e[e.Complete=100]="Complete",e[e.Partial=50]="Partial",e[e.None=0]="None"})(nb||(nb={}));var Eie=new I("debugType",void 0,{type:"string",description:h(6660,null)}),Cie=new I("debugConfigurationType",void 0,{type:"string",description:h(6661,null)}),Die=new I("debugState","inactive",{type:"string",description:h(6662,null)}),Wz="debugUx",kie=new I(Wz,"default",{type:"string",description:h(6663,null)}),Iie=new I("hasDebugged",!1,{type:"boolean",description:h(6664,null)}),Pie=new I("inDebugMode",!1,{type:"boolean",description:h(6665,null)}),Tie=new I("inDebugRepl",!1,{type:"boolean",description:h(6666,null)}),Aie=new I("breakpointWidgetVisible",!1,{type:"boolean",description:h(6667,null)}),Rie=new I("inBreakpointWidget",!1,{type:"boolean",description:h(6668,null)}),Lie=new I("breakpointsFocused",!0,{type:"boolean",description:h(6669,null)}),Nie=new I("watchExpressionsFocused",!0,{type:"boolean",description:h(6670,null)}),Mie=new I("watchExpressionsExist",!1,{type:"boolean",description:h(6671,null)}),Oie=new I("variablesFocused",!0,{type:"boolean",description:h(6672,null)}),Fie=new I("expressionSelected",!1,{type:"boolean",description:h(6673,null)}),$ie=new I("breakpointInputFocused",!1,{type:"boolean",description:h(6674,null)}),Hie=new I("callStackItemType",void 0,{type:"string",description:h(6675,null)}),Uie=new I("callStackSessionIsAttach",!1,{type:"boolean",description:h(6676,null)}),Wie=new I("callStackItemStopped",!1,{type:"boolean",description:h(6677,null)}),Bie=new I("callStackSessionHasOneThread",!1,{type:"boolean",description:h(6678,null)}),Vie=new I("callStackFocused",!0,{type:"boolean",description:h(6679,null)}),zie=new I("watchItemType",void 0,{type:"string",description:h(6680,null)}),qie=new I("canViewMemory",void 0,{type:"boolean",description:h(6681,null)}),jie=new I("breakpointItemType",void 0,{type:"string",description:h(6682,null)}),Gie=new I("breakpointItemBytes",void 0,{type:"boolean",description:h(6683,null)}),Qie=new I("breakpointHasModes",!1,{type:"boolean",description:h(6684,null)}),Jie=new I("breakpointSupportsCondition",!1,{type:"boolean",description:h(6685,null)}),Kie=new I("loadedScriptsSupported",!1,{type:"boolean",description:h(6686,null)}),Xie=new I("loadedScriptsItemType",void 0,{type:"string",description:h(6687,null)}),Yie=new I("focusedSessionIsAttach",!1,{type:"boolean",description:h(6688,null)}),Zie=new I("focusedSessionIsNoDebug",!1,{type:"boolean",description:h(6689,null)}),ere=new I("stepBackSupported",!1,{type:"boolean",description:h(6690,null)}),tre=new I("restartFrameSupported",!1,{type:"boolean",description:h(6691,null)}),ire=new I("stackFrameSupportsRestart",!1,{type:"boolean",description:h(6692,null)}),rre=new I("jumpToCursorSupported",!1,{type:"boolean",description:h(6693,null)}),sre=new I("stepIntoTargetsSupported",!1,{type:"boolean",description:h(6694,null)}),nre=new I("breakpointsExist",!1,{type:"boolean",description:h(6695,null)}),ore=new I("debuggersAvailable",!1,{type:"boolean",description:h(6696,null)}),are=new I("debugExtensionAvailable",!0,{type:"boolean",description:h(6697,null)}),lre=new I("debugProtocolVariableMenuContext",void 0,{type:"string",description:h(6698,null)}),cre=new I("debugSetVariableSupported",!1,{type:"boolean",description:h(6699,null)}),ure=new I("debugSetDataBreakpointAddressSupported",!1,{type:"boolean",description:h(6700,null)}),dre=new I("debugSetExpressionSupported",!1,{type:"boolean",description:h(6701,null)}),hre=new I("breakWhenValueChangesSupported",!1,{type:"boolean",description:h(6702,null)}),fre=new I("breakWhenValueIsAccessedSupported",!1,{type:"boolean",description:h(6703,null)}),pre=new I("breakWhenValueIsReadSupported",!1,{type:"boolean",description:h(6704,null)}),gre=new I("terminateDebuggeeSupported",!1,{type:"boolean",description:h(6705,null)}),mre=new I("suspendDebuggeeSupported",!1,{type:"boolean",description:h(6706,null)}),vre=new I("variableEvaluateNamePresent",!1,{type:"boolean",description:h(6707,null)}),_re=new I("variableIsReadonly",!1,{type:"boolean",description:h(6708,null)}),wre=new I("variableValue",!1,{type:"string",description:h(6709,null)}),yre=new I("variableType",!1,{type:"string",description:h(6710,null)}),bre=new I("variableInterfaces",!1,{type:"array",description:h(6711,null)}),Sre=new I("variableName",!1,{type:"string",description:h(6712,null)}),xre=new I("variableLanguage",!1,{type:"string",description:h(6713,null)}),Ere=new I("variableExtensionId",!1,{type:"string",description:h(6714,null)}),Cre=new I("exceptionWidgetVisible",!1,{type:"boolean",description:h(6715,null)}),Dre=new I("multiSessionRepl",!1,{type:"boolean",description:h(6716,null)}),kre=new I("multiSessionDebug",!1,{type:"boolean",description:h(6717,null)}),Ire=new I("disassembleRequestSupported",!1,{type:"boolean",description:h(6718,null)}),Pre=new I("disassemblyViewFocus",!1,{type:"boolean",description:h(6719,null)}),Tre=new I("languageSupportsDisassembleRequest",!1,{type:"boolean",description:h(6720,null)}),Are=new I("focusedStackFrameHasInstructionReference",!1,{type:"boolean",description:h(6721,null)}),Rre={enum:["neverOpen","openOnSessionStart","openOnFirstSessionStart"],default:"openOnFirstSessionStart",description:h(6723,null)},X6;(function(e){e[e.Inactive=0]="Inactive",e[e.Initializing=1]="Initializing",e[e.Stopped=2]="Stopped",e[e.Running=3]="Running"})(X6||(X6={}));var Y6;(function(e){e[e.Valid=0]="Valid",e[e.Unreadable=1]="Unreadable",e[e.Error=2]="Error"})(Y6||(Y6={}));var Z6;(function(e){e[e.Variable=0]="Variable",e[e.Address=1]="Address"})(Z6||(Z6={}));var lm;(function(e){e[e.Initial=1]="Initial",e[e.Dynamic=2]="Dynamic"})(lm||(lm={}));var eA;(function(e){e.UnverifiedBreakpoints="unverifiedBreakpoints"})(eA||(eA={}));var Lre=q("debugService"),tA;(function(e){e[e.CONDITION=0]="CONDITION",e[e.HIT_COUNT=1]="HIT_COUNT",e[e.LOG_MESSAGE=2]="LOG_MESSAGE",e[e.TRIGGER_POINT=3]="TRIGGER_POINT"})(tA||(tA={}));var iA;(function(e){e[e.Command=0]="Command",e[e.Tree=1]="Tree"})(iA||(iA={}));var rA;(function(e){e[e.None=0]="None",e[e.Collapsed=1]="Collapsed",e[e.Expanded=2]="Expanded"})(rA||(rA={}));var sA;(function(e){e.deserialize=t=>t,e.serialize=t=>t})(sA||(sA={}));var nA;(function(e){e.deserialize=t=>({id:t.id,name:t.name,iconPath:t.iconPath&&{light:b.revive(t.iconPath.light),dark:b.revive(t.iconPath.dark)},iconClass:t.iconClass,visualization:t.visualization}),e.serialize=t=>t})(nA||(nA={}));var Bz=class{constructor(e){this._relatedInformationProviders=new Map,this._nextHandle=0,this._proxy=e.getProxy(Q.MainThreadAiRelatedInformation)}async $provideAiRelatedInformation(e,t,i){if(this._relatedInformationProviders.size===0)throw new Error("No related information providers registered");const r=this._relatedInformationProviders.get(e);if(!r)throw new Error("related information provider not found");return await r.provideRelatedInformation(t,i)??[]}getRelatedInformation(e,t,i){return this._proxy.$getAiRelatedInformation(t,i)}registerRelatedInformationProvider(e,t,i){const r=this._nextHandle;return this._nextHandle++,this._relatedInformationProviders.set(r,i),this._proxy.$registerAiRelatedInformationProvider(r,t),new Ie(()=>{this._proxy.$unregisterAiRelatedInformationProvider(r),this._relatedInformationProviders.delete(r)})}},oA;(function(e){e[e.Full=1]="Full",e[e.Delta=2]="Delta"})(oA||(oA={}));function aA(e){for(let t=0,i=e.length;t<i;t+=4){const r=e[t+0],s=e[t+1],n=e[t+2],o=e[t+3];e[t+0]=o,e[t+1]=n,e[t+2]=s,e[t+3]=r}}function Vz(e){const t=new Uint8Array(e.buffer,e.byteOffset,e.length*4);return Lx()||aA(t),z.wrap(t)}function zz(e){const t=e.buffer;if(Lx()||aA(t),t.byteOffset%4===0)return new Uint32Array(t.buffer,t.byteOffset,t.length/4);{const i=new Uint8Array(t.byteLength);return i.set(t),new Uint32Array(i.buffer,i.byteOffset,i.length/4)}}function ob(e){const t=new Uint32Array(qz(e));let i=0;if(t[i++]=e.id,e.type==="full")t[i++]=1,t[i++]=e.data.length,t.set(e.data,i),i+=e.data.length;else{t[i++]=2,t[i++]=e.deltas.length;for(const r of e.deltas)t[i++]=r.start,t[i++]=r.deleteCount,r.data?(t[i++]=r.data.length,t.set(r.data,i),i+=r.data.length):t[i++]=0}return Vz(t)}function qz(e){let t=0;if(t+=2,e.type==="full")t+=1+e.data.length;else{t+=1,t+=3*e.deltas.length;for(const i of e.deltas)i.data&&(t+=i.data.length)}return t}function lA(e){const t=zz(e);let i=0;const r=t[i++];if(t[i++]===1){const a=t[i++],l=t.subarray(i,i+a);return i+=a,{id:r,type:"full",data:l}}const n=t[i++],o=[];for(let a=0;a<n;a++){const l=t[i++],c=t[i++],u=t[i++];let d;u>0&&(d=t.subarray(i,i+u),i+=u),o[a]={start:l,deleteCount:c,data:d}}return{id:r,type:"delta",deltas:o}}var jz=[new me("vscode.executeDocumentHighlights","_executeDocumentHighlights","Execute document highlight provider.",[U.Uri,U.Position],new ge("A promise that resolves to an array of DocumentHighlight-instances.",qr(Sl.to))),new me("vscode.executeDocumentSymbolProvider","_executeDocumentSymbolProvider","Execute document symbol provider.",[U.Uri],new ge("A promise that resolves to an array of SymbolInformation and DocumentSymbol instances.",(e,t)=>{if(fv(e))return;class i extends nu{static to(s){const n=new i(s.name,mr.to(s.kind),s.containerName||"",new nr(t[0],F.to(s.range)));return n.detail=s.detail,n.range=n.location.range,n.selectionRange=F.to(s.selectionRange),n.children=s.children?s.children.map(i.to):[],n}}return e.map(i.to)})),new me("vscode.executeFormatDocumentProvider","_executeFormatDocumentProvider","Execute document format provider.",[U.Uri,new U("options","Formatting options",e=>!0,e=>e)],new ge("A promise that resolves to an array of TextEdits.",qr(Gt.to))),new me("vscode.executeFormatRangeProvider","_executeFormatRangeProvider","Execute range format provider.",[U.Uri,U.Range,new U("options","Formatting options",e=>!0,e=>e)],new ge("A promise that resolves to an array of TextEdits.",qr(Gt.to))),new me("vscode.executeFormatOnTypeProvider","_executeFormatOnTypeProvider","Execute format on type provider.",[U.Uri,U.Position,new U("ch","Trigger character",e=>typeof e=="string",e=>e),new U("options","Formatting options",e=>!0,e=>e)],new ge("A promise that resolves to an array of TextEdits.",qr(Gt.to))),new me("vscode.executeDefinitionProvider","_executeDefinitionProvider","Execute all definition providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Location or LocationLink instances.",jn)),new me("vscode.experimental.executeDefinitionProvider_recursive","_executeDefinitionProvider_recursive","Execute all definition providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Location or LocationLink instances.",jn)),new me("vscode.executeTypeDefinitionProvider","_executeTypeDefinitionProvider","Execute all type definition providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Location or LocationLink instances.",jn)),new me("vscode.experimental.executeTypeDefinitionProvider_recursive","_executeTypeDefinitionProvider_recursive","Execute all type definition providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Location or LocationLink instances.",jn)),new me("vscode.executeDeclarationProvider","_executeDeclarationProvider","Execute all declaration providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Location or LocationLink instances.",jn)),new me("vscode.experimental.executeDeclarationProvider_recursive","_executeDeclarationProvider_recursive","Execute all declaration providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Location or LocationLink instances.",jn)),new me("vscode.executeImplementationProvider","_executeImplementationProvider","Execute all implementation providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Location or LocationLink instances.",jn)),new me("vscode.experimental.executeImplementationProvider_recursive","_executeImplementationProvider_recursive","Execute all implementation providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Location or LocationLink instances.",jn)),new me("vscode.executeReferenceProvider","_executeReferenceProvider","Execute all reference providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Location-instances.",qr(Ai.to))),new me("vscode.experimental.executeReferenceProvider","_executeReferenceProvider_recursive","Execute all reference providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Location-instances.",qr(Ai.to))),new me("vscode.executeHoverProvider","_executeHoverProvider","Execute all hover providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Hover-instances.",qr(Fu.to))),new me("vscode.experimental.executeHoverProvider_recursive","_executeHoverProvider_recursive","Execute all hover providers.",[U.Uri,U.Position],new ge("A promise that resolves to an array of Hover-instances.",qr(Fu.to))),new me("vscode.executeSelectionRangeProvider","_executeSelectionRangeProvider","Execute selection range provider.",[U.Uri,new U("position","A position in a text document",e=>Array.isArray(e)&&e.every(t=>Te.isPosition(t)),e=>e.map(Qe.from))],new ge("A promise that resolves to an array of ranges.",e=>e.map(t=>{let i;for(const r of t.reverse())i=new cu(F.to(r),i);return i}))),new me("vscode.executeWorkspaceSymbolProvider","_executeWorkspaceSymbolProvider","Execute all workspace symbol providers.",[U.String.with("query","Search string")],new ge("A promise that resolves to an array of SymbolInformation-instances.",e=>e.map(jo.to))),new me("vscode.prepareCallHierarchy","_executePrepareCallHierarchy","Prepare call hierarchy at a position inside a document",[U.Uri,U.Position],new ge("A promise that resolves to an array of CallHierarchyItem-instances",e=>e.map(Go.to))),new me("vscode.provideIncomingCalls","_executeProvideIncomingCalls","Compute incoming calls for an item",[U.CallHierarchyItem],new ge("A promise that resolves to an array of CallHierarchyIncomingCall-instances",e=>e.map($0.to))),new me("vscode.provideOutgoingCalls","_executeProvideOutgoingCalls","Compute outgoing calls for an item",[U.CallHierarchyItem],new ge("A promise that resolves to an array of CallHierarchyOutgoingCall-instances",e=>e.map(H0.to))),new me("vscode.prepareRename","_executePrepareRename","Execute the prepareRename of rename provider.",[U.Uri,U.Position],new ge("A promise that resolves to a range and placeholder text.",e=>{if(e)return{range:F.to(e.range),placeholder:e.text}})),new me("vscode.executeDocumentRenameProvider","_executeDocumentRenameProvider","Execute rename provider.",[U.Uri,U.Position,U.String.with("newName","The new symbol name")],new ge("A promise that resolves to a WorkspaceEdit.",e=>{if(e){if(e.rejectReason)throw new Error(e.rejectReason);return Qi.to(e)}})),new me("vscode.executeLinkProvider","_executeLinkProvider","Execute document link provider.",[U.Uri,U.Number.with("linkResolveCount","Number of links that should be resolved, only when links are unresolved.").optional()],new ge("A promise that resolves to an array of DocumentLink-instances.",e=>e.map(Qo.to))),new me("vscode.provideDocumentSemanticTokensLegend","_provideDocumentSemanticTokensLegend","Provide semantic tokens legend for a document",[U.Uri],new ge("A promise that resolves to SemanticTokensLegend.",e=>{if(e)return new t0(e.tokenTypes,e.tokenModifiers)})),new me("vscode.provideDocumentSemanticTokens","_provideDocumentSemanticTokens","Provide semantic tokens for a document",[U.Uri],new ge("A promise that resolves to SemanticTokens.",e=>{if(!e)return;const t=lA(e);if(t.type==="full")return new pl(t.data,void 0)})),new me("vscode.provideDocumentRangeSemanticTokensLegend","_provideDocumentRangeSemanticTokensLegend","Provide semantic tokens legend for a document range",[U.Uri,U.Range.optional()],new ge("A promise that resolves to SemanticTokensLegend.",e=>{if(e)return new t0(e.tokenTypes,e.tokenModifiers)})),new me("vscode.provideDocumentRangeSemanticTokens","_provideDocumentRangeSemanticTokens","Provide semantic tokens for a document range",[U.Uri,U.Range],new ge("A promise that resolves to SemanticTokens.",e=>{if(!e)return;const t=lA(e);if(t.type==="full")return new pl(t.data,void 0)})),new me("vscode.executeCompletionItemProvider","_executeCompletionItemProvider","Execute completion item provider.",[U.Uri,U.Position,U.String.with("triggerCharacter","Trigger completion when the user types the character, like `,` or `(`").optional(),U.Number.with("itemResolveCount","Number of completions to resolve (too large numbers slow down completions)").optional()],new ge("A promise that resolves to a CompletionList-instance.",(e,t,i)=>{if(!e)return new Za([]);const r=e.suggestions.map(s=>z0.to(s,i));return new Za(r,e.incomplete)})),new me("vscode.executeSignatureHelpProvider","_executeSignatureHelpProvider","Execute signature help provider.",[U.Uri,U.Position,U.String.with("triggerCharacter","Trigger signature help when the user types the character, like `,` or `(`").optional()],new ge("A promise that resolves to SignatureHelp.",e=>{if(e)return $u.to(e)})),new me("vscode.executeCodeLensProvider","_executeCodeLensProvider","Execute code lens provider.",[U.Uri,U.Number.with("itemResolveCount","Number of lenses that should be resolved and returned. Will only return resolved lenses, will impact performance)").optional()],new ge("A promise that resolves to an array of CodeLens-instances.",(e,t,i)=>qr(r=>new qf(F.to(r.range),r.command&&i.fromInternal(r.command)))(e))),new me("vscode.executeCodeActionProvider","_executeCodeActionProvider","Execute code action provider.",[U.Uri,new U("rangeOrSelection","Range in a text document. Some refactoring provider requires Selection object.",e=>Se.isRange(e),e=>Bs.isSelection(e)?Ur.from(e):F.from(e)),U.String.with("kind","Code action kind to return code actions for").optional(),U.Number.with("itemResolveCount","Number of code actions to resolve (too large numbers slow down code actions)").optional()],new ge("A promise that resolves to an array of Command-instances.",(e,t,i)=>qr(r=>{if(r._isSynthetic){if(!r.command)throw new Error("Synthetic code actions must have a command");return i.fromInternal(r.command)}else{const s=new lu(r.title,r.kind?new wt(r.kind):void 0);return r.edit&&(s.edit=Qi.to(r.edit)),r.command&&(s.command=i.fromInternal(r.command)),s.isPreferred=r.isPreferred,s}})(e))),new me("vscode.executeDocumentColorProvider","_executeDocumentColorProvider","Execute document color provider.",[U.Uri],new ge("A promise that resolves to an array of ColorInformation objects.",e=>e?e.map(t=>new Xf(F.to(t.range),xl.to(t.color))):[])),new me("vscode.executeColorPresentationProvider","_executeColorPresentationProvider","Execute color presentation provider.",[new U("color","The color to show and insert",e=>e instanceof nl,xl.from),new U("context","Context object with uri and range",e=>!0,e=>({uri:e.uri,range:F.from(e.range)}))],new ge("A promise that resolves to an array of ColorPresentation objects.",e=>e?e.map(jp.to):[])),new me("vscode.executeInlayHintProvider","_executeInlayHintProvider","Execute inlay hints provider",[U.Uri,U.Range],new ge("A promise that resolves to an array of Inlay objects",(e,t,i)=>e.map(q0.to.bind(void 0,i)))),new me("vscode.executeFoldingRangeProvider","_executeFoldingRangeProvider","Execute folding range provider",[U.Uri],new ge("A promise that resolves to an array of FoldingRange objects",(e,t)=>{if(e)return e.map(Qp.to)})),new me("vscode.resolveNotebookContentProviders","_resolveNotebookContentProvider","Resolve Notebook Content Providers",[],new ge("A promise that resolves to an array of NotebookContentProvider static info objects.",qr(e=>({viewType:e.viewType,displayName:e.displayName,options:{transientOutputs:e.options.transientOutputs,transientCellMetadata:e.options.transientCellMetadata,transientDocumentMetadata:e.options.transientDocumentMetadata},filenamePattern:e.filenamePattern.map(t=>Kp.to(t))})))),new me("vscode.executeInlineValueProvider","_executeInlineValueProvider","Execute inline value provider",[U.Uri,U.Range,new U("context","An InlineValueContext",e=>e&&typeof e.frameId=="number"&&e.stoppedLocation instanceof Se,e=>Up.from(e))],new ge("A promise that resolves to an array of InlineValue objects",e=>e.map(Hp.to))),new me("vscode.open","_workbench.open","Opens the provided resource in the editor. Can be a text or binary file, or an http(s) URL. If you need more control over the options for opening a text file, use vscode.window.showTextDocument instead.",[new U("uriOrString","Uri-instance or string (only http/https)",e=>b.isUri(e)||typeof e=="string"&&P3(e,V.http,V.https),e=>e),new U("columnOrOptions","Either the column in which to open or editor options, see vscode.TextDocumentShowOptions",e=>e===void 0||typeof e=="number"||typeof e=="object",e=>e&&(typeof e=="number"?[jt.from(e),void 0]:[jt.from(e.viewColumn),Hu.from(e)])).optional(),U.String.with("label","").optional()],ge.Void),new me("vscode.openWith","_workbench.openWith","Opens the provided resource with a specific editor.",[U.Uri.with("resource","Resource to open"),U.String.with("viewId","Custom editor view id. This should be the viewType string for custom editors or the notebookType string for notebooks. Use 'default' to use CodeBuddy's default text editor"),new U("columnOrOptions","Either the column in which to open or editor options, see vscode.TextDocumentShowOptions",e=>e===void 0||typeof e=="number"||typeof e=="object",e=>e&&(typeof e=="number"?[jt.from(e),void 0]:[jt.from(e.viewColumn),Hu.from(e)])).optional()],ge.Void),new me("vscode.diff","_workbench.diff","Opens the provided resources in the diff editor to compare their contents.",[U.Uri.with("left","Left-hand side resource of the diff editor"),U.Uri.with("right","Right-hand side resource of the diff editor"),U.String.with("title","Human readable title for the diff editor").optional(),new U("columnOrOptions","Either the column in which to open or editor options, see vscode.TextDocumentShowOptions",e=>e===void 0||typeof e=="object",e=>e&&[jt.from(e.viewColumn),Hu.from(e)]).optional()],ge.Void),new me("vscode.changes","_workbench.changes","Opens a list of resources in the changes editor to compare their contents.",[U.String.with("title","Human readable title for the changes editor"),new U("resourceList","List of resources to compare",e=>{for(const t of e){if(t.length!==3)return!1;const[i,r,s]=t;if(!b.isUri(i)||!b.isUri(r)&&r!==void 0&&r!==null||!b.isUri(s)&&s!==void 0&&s!==null)return!1}return!0},e=>e)],ge.Void),new me("vscode.prepareTypeHierarchy","_executePrepareTypeHierarchy","Prepare type hierarchy at a position inside a document",[U.Uri,U.Position],new ge("A promise that resolves to an array of TypeHierarchyItem-instances",e=>e.map(Jo.to))),new me("vscode.provideSupertypes","_executeProvideSupertypes","Compute supertypes for an item",[U.TypeHierarchyItem],new ge("A promise that resolves to an array of TypeHierarchyItem-instances",e=>e.map(Jo.to))),new me("vscode.provideSubtypes","_executeProvideSubtypes","Compute subtypes for an item",[U.TypeHierarchyItem],new ge("A promise that resolves to an array of TypeHierarchyItem-instances",e=>e.map(Jo.to))),new me("vscode.revealTestInExplorer","_revealTestInExplorer","Reveals a test instance in the explorer",[U.TestItem],ge.Void),new me("vscode.startContinuousTestRun","testing.startContinuousRunFromExtension","Starts running the given tests with continuous run mode.",[U.TestProfile,U.Arr(U.TestItem)],ge.Void),new me("vscode.stopContinuousTestRun","testing.stopContinuousRunFromExtension","Stops running the given tests with continuous run mode.",[U.Arr(U.TestItem)],ge.Void),new me("vscode.experimental.editSession.continue","_workbench.editSessions.actions.continueEditSession","Continue the current edit session in a different workspace",[U.Uri.with("workspaceUri","The target workspace to continue the current edit session in")],ge.Void),new me("setContext","_setContext","Set a custom context key value that can be used in when clauses.",[U.String.with("name","The context key name"),new U("value","The context key value",()=>!0,e=>e)],ge.Void),new me("vscode.editorChat.start","inlineChat.start","Invoke a new editor chat session",[new U("Run arguments","",e=>!0,e=>{if(e)return{initialRange:e.initialRange?F.from(e.initialRange):void 0,initialSelection:Bs.isSelection(e.initialSelection)?Ur.from(e.initialSelection):void 0,message:e.message,attachments:e.attachments,autoSend:e.autoSend,position:e.position?Qe.from(e.position):void 0}})],ge.Void)],Gz=class{static register(e){jz.forEach(e.registerApiCommand,e),this._registerValidateWhenClausesCommand(e)}static _registerValidateWhenClausesCommand(e){e.registerCommand(!1,"_validateWhenClauses",AM)}};function qr(e){return t=>{if(Array.isArray(t))return t.map(e)}}function jn(e){if(!Array.isArray(e))return;const t=[];for(const i of e)rF(i)?t.push(Ou.to(i)):t.push(Ai.to(i));return t}var ab=class{constructor(t,i){this._proxy=t.getProxy(Q.MainThreadBulkEdits),this._versionInformationProvider={getTextDocumentVersion:r=>i.getDocument(r)?.version,getNotebookDocumentVersion:()=>{}}}applyWorkspaceEdit(t,i,r){const s=new wi(Qi.from(t,this._versionInformationProvider));return this._proxy.$tryApplyWorkspaceEdit(s,void 0,r?.isRefactoring??!1)}};ab=__decorate([__param(0,Pe)],ab);function Qz(e){return!!e&&typeof e.sessionId=="string"&&e.$mid===19}var Jz=class{constructor(e,t,i,r,s){this._extension=e,this._request=t,this._proxy=i,this._commandsConverter=r,this._sessionDisposables=s,this._stopWatch=Hi.create(!1),this._isClosed=!1}close(){this._isClosed=!0}get timings(){return{firstProgress:this._firstProgress,totalElapsed:this._stopWatch.elapsed()}}get apiObject(){if(!this._apiObject){let t=function(s){if(i._isClosed){const n=new Error("Response stream has been closed");throw Error.captureStackTrace(n,s),n}};var e=t;const i=this;this._stopWatch.reset();const r=(s,n)=>{if(typeof this._firstProgress>"u"&&(s.kind==="markdownContent"||s.kind==="markdownVuln")&&(this._firstProgress=this._stopWatch.elapsed()),n){const o=this._proxy.$handleProgressChunk(this._request.requestId,s),a={report:l=>{o?.then(c=>{c&&(Ti.isMarkdownString(l.value)?this._proxy.$handleProgressChunk(this._request.requestId,Gu.from(l),c):this._proxy.$handleProgressChunk(this._request.requestId,Xo.from(l),c))})}};Promise.all([o,n?.(a)]).then(([l,c])=>{l!==void 0&&this._proxy.$handleProgressChunk(this._request.requestId,nw.from(c),l)})}else this._proxy.$handleProgressChunk(this._request.requestId,s)};this._apiObject=Object.freeze({markdown(s){t(this.markdown);const n=new xp(s),o=zu.from(n);return r(o),this},markdownWithVulnerabilities(s,n){t(this.markdown),n&&M(i._extension,"chatParticipantAdditions");const o=new Pu(s,n),a=eg.from(o);return r(a),this},codeblockUri(s,n){t(this.codeblockUri),M(i._extension,"chatParticipantAdditions");const o=new Ip(s,n),a=Zp.from(o);return r(a),this},filetree(s,n){t(this.filetree);const o=new Cp(s,n),a=qu.from(o);return r(a),this},anchor(s,n){const o=new Tu(s,n);return this.push(o)},button(s){t(this.anchor);const n=new kp(s),o=Qu.from(n,i._commandsConverter,i._sessionDisposables);return r(o),this},progress(s,n){t(this.progress);const o=new Dp(s,n),a=n?ig.from(o):ju.from(o);return r(a,n),this},warning(s){t(this.progress),M(i._extension,"chatParticipantAdditions");const n=new Au(s),o=Gu.from(n);return r(o),this},reference(s,n){return this.reference2(s,n)},reference2(s,n,o){if(t(this.reference),typeof s=="object"&&"variableName"in s&&M(i._extension,"chatParticipantAdditions"),typeof s=="object"&&"variableName"in s&&!s.value){const a=i._request.variables.variables.find(l=>l.name===s.variableName);if(a){let l;if(a.references?.length)l=a.references.map(c=>({kind:"reference",reference:{variableName:s.variableName,value:c.reference}}));else{const c=new zo(s,n,o);l=[Xo.from(c)]}return l.forEach(c=>r(c)),this}}else{const a=new zo(s,n,o),l=Xo.from(a);r(l)}return this},codeCitation(s,n,o){t(this.codeCitation),M(i._extension,"chatParticipantAdditions");const a=new Pp(s,n,o),l=og.from(a);r(l)},textEdit(s,n){t(this.textEdit),M(i._extension,"chatParticipantAdditions");const o=new Ru(s,n);o.isDone=n===!0?!0:void 0;const a=rg.from(o);return r(a),this},notebookEdit(s,n){t(this.notebookEdit),M(i._extension,"chatParticipantAdditions");const o=new Ap(s,n),a=ng.from(o);return r(a),this},confirmation(s,n,o,a){t(this.confirmation),M(i._extension,"chatParticipantAdditions");const l=new Ep(s,n,o,a),c=tg.from(l);return r(c),this},push(s){if(t(this.push),(s instanceof Ru||s instanceof Ap||s instanceof Pu||s instanceof Au||s instanceof Ep||s instanceof Pp||s instanceof Tp||s instanceof b0||s instanceof Dp)&&M(i._extension,"chatParticipantAdditions"),s instanceof zo)this.reference2(s.value,s.iconPath,s.options);else if(s instanceof Dp){const n=s.task?ig.from(s):ju.from(s);r(n,s.task)}else if(s instanceof Tu){const n=Ll.from(s);if(s.resolve){M(i._extension,"chatParticipantAdditions"),n.resolveId=mt();const o=new rt;s.resolve(o.token).then(()=>{const a=Ll.from(s);i._proxy.$handleAnchorResolve(i._request.requestId,n.resolveId,a)}).then(()=>o.dispose(),()=>o.dispose()),i._sessionDisposables.add(ie(()=>o.dispose(!0)))}r(n)}else{const n=ag.from(s,i._commandsConverter,i._sessionDisposables);r(n)}return this}})}return this._apiObject}},Kz=class zd extends X{static{this._idPool=0}static{this._participantDetectionProviderIdPool=0}static{this._relatedFilesProviderIdPool=0}constructor(t,i,r,s,n,o,a){super(),this._logService=i,this._commands=r,this._documents=s,this._languageModels=n,this._diagnostics=o,this._tools=a,this._agents=new Map,this._participantDetectionProviders=new Map,this._relatedFilesProviders=new Map,this._sessionDisposables=this._register(new fc),this._completionDisposables=this._register(new fc),this._inFlightRequests=new Set,this._onDidDisposeChatSession=this._register(new D),this.onDidDisposeChatSession=this._onDidDisposeChatSession.event,this._proxy=t.getProxy(Q.MainThreadChatAgents2),r.registerArgumentProcessor({processArgument:l=>Qz(l)?null:l})}transferActiveChat(t){this._proxy.$transferActiveChatSession(t)}createChatAgent(t,i,r){const s=zd._idPool++,n=new cA(t,i,this._proxy,s,r);return this._agents.set(s,n),this._proxy.$registerAgent(s,t.identifier,i,{},void 0),n.apiAgent}createDynamicChatAgent(t,i,r,s){const n=zd._idPool++,o=new cA(t,i,this._proxy,n,s);return this._agents.set(n,o),this._proxy.$registerAgent(n,t.identifier,i,{isSticky:!0},r),o.apiAgent}registerChatParticipantDetectionProvider(t,i){const r=zd._participantDetectionProviderIdPool++;return this._participantDetectionProviders.set(r,new Xz(t,i)),this._proxy.$registerChatParticipantDetectionProvider(r),ie(()=>{this._participantDetectionProviders.delete(r),this._proxy.$unregisterChatParticipantDetectionProvider(r)})}registerRelatedFilesProvider(t,i,r){const s=zd._relatedFilesProviderIdPool++;return this._relatedFilesProviders.set(s,new Yz(t,i)),this._proxy.$registerRelatedFilesProvider(s,r),ie(()=>{this._relatedFilesProviders.delete(s),this._proxy.$unregisterRelatedFilesProvider(s)})}async $provideRelatedFiles(t,i,r){const s=this._relatedFilesProviders.get(t);if(!s)return Promise.resolve([]);const n=ow.to(i);return await s.provider.provideRelatedFiles(n,r)??void 0}async $detectChatParticipant(t,i,r,s,n){const o=this._participantDetectionProviders.get(t);if(!o)return;const{request:a,location:l,history:c}=await this._createRequest(i,r,o.extension),u=await this.getModelForRequest(a,o.extension),d=lg.to(a,l,u,this.getDiagnosticsWhenEnabled(o.extension),this.getToolsForRequest(o.extension,a),this.getTools2ForRequest(o.extension,a),o.extension);return o.provider.provideParticipantDetection(d,{history:c},{participants:s.participants,location:Ju.to(s.location)},n)}async _createRequest(t,i,r){const s=kt(t),n=await this.prepareHistoryTurns(r,s.agentId,i);let o;if(s.locationData?.type===fi.Editor){const a=this._documents.getDocument(s.locationData.document);o=new F4(a,Ur.to(s.locationData.selection),F.to(s.locationData.wholeRange))}else if(s.locationData?.type===fi.Notebook){const a=this._documents.getDocument(s.locationData.sessionInputUri);o=new $4(a)}else s.locationData?.type,fi.Terminal;return{request:s,location:o,history:n}}async getModelForRequest(t,i){let r;if(t.userSelectedModelId&&(r=await this._languageModels.getLanguageModelByIdentifier(i,t.userSelectedModelId)),!r&&(r=await this._languageModels.getDefaultLanguageModel(i),!r))throw new Error("Language model unavailable");return r}async $setRequestPaused(t,i,r){const s=this._agents.get(t);if(!s)return;const n=ai.find(this._inFlightRequests,o=>o.requestId===i);n&&s.setChatRequestPauseState({request:n.extRequest,isPaused:r})}async $invokeAgent(t,i,r,s){const n=this._agents.get(t);if(!n)throw new Error(`[CHAT](${t}) CANNOT invoke agent because the agent is not registered`);let o,a;try{const{request:l,location:c,history:u}=await this._createRequest(i,r,n.extension);let d=this._sessionDisposables.get(l.sessionId);d||(d=new oe,this._sessionDisposables.set(l.sessionId,d)),o=new Jz(n.extension,l,this._proxy,this._commands.converter,d);const f=await this.getModelForRequest(l,n.extension),p=lg.to(l,c,f,this.getDiagnosticsWhenEnabled(n.extension),this.getToolsForRequest(n.extension,l),this.getTools2ForRequest(n.extension,l),n.extension);a={requestId:i.requestId,extRequest:p},this._inFlightRequests.add(a);const g=n.invoke(p,{history:u},o.apiObject,s);return await mE(Promise.resolve(g).then(v=>{if(v?.metadata)try{JSON.stringify(v.metadata)}catch(S){const x=`result.metadata MUST be JSON.stringify-able. Got error: ${S.message}`;return this._logService.error(`[${n.extension.identifier.value}] [@${n.id}] ${x}`,n.extension),{errorDetails:{message:x},timings:o?.timings,nextQuestion:v.nextQuestion}}let y;return v?.errorDetails&&(y={...v.errorDetails,responseIsIncomplete:!0}),(y?.responseIsRedacted||y?.isQuotaExceeded)&&M(n.extension,"chatParticipantPrivate"),{errorDetails:y,timings:o?.timings,metadata:v?.metadata,nextQuestion:v?.nextQuestion}}),s)}catch(l){this._logService.error(l,n.extension),l instanceof qs&&l.cause&&(l=l.cause);const c=l instanceof Error&&l.name==="ChatQuotaExceeded";return{errorDetails:{message:es(l),responseIsIncomplete:!0,isQuotaExceeded:c}}}finally{a&&this._inFlightRequests.delete(a),o?.close()}}getDiagnosticsWhenEnabled(t){return nt(t,"chatReferenceDiagnostic")?this._diagnostics.getDiagnostics():[]}getTools2ForRequest(t,i){if(!i.userSelectedTools2)return new Map;const r=new Map;for(const s of this._tools.getTools(t))typeof i.userSelectedTools2[s.name]=="boolean"&&r.set(s.name,i.userSelectedTools2[s.name]);return r}getToolsForRequest(t,i){if(!ya(i.userSelectedTools))return;const r=new Set(i.userSelectedTools);return{tools:this._tools.getTools(t).filter(n=>r.has(n.name)),isExclusive:i.toolSelectionIsExclusive}}async prepareHistoryTurns(t,i,r){const s=[];for(const n of r.history){const o=Nl.to(n.result),a=i===n.request.agentId?o:{...o,metadata:void 0},l=n.request.variables.variables.filter(p=>p.kind!=="tool").map(p=>cg.to(p,this.getDiagnosticsWhenEnabled(t))),c=n.request.variables.variables.filter(p=>p.kind==="tool").map(ug.to),u=nt(t,"chatParticipantPrivate")?n.request.editedFileEvents:void 0,d=new S0(n.request.message,n.request.command,l,n.request.agentId,c,u);s.push(d);const f=Et(n.response.map(p=>ag.toContent(p,this._commands.converter)));s.push(new O4(f,a,n.request.agentId,n.request.command))}return s}$releaseSession(t){this._sessionDisposables.deleteAndDispose(t),this._onDidDisposeChatSession.fire(t)}async $provideFollowups(t,i,r,s,n){const o=this._agents.get(i);if(!o)return Promise.resolve([]);const a=kt(t),l=await this.prepareHistoryTurns(o.extension,o.id,s),c=Nl.to(r);return(await o.provideFollowups(c,{history:l},n)).filter(u=>{const d=!u.participant||ai.some(this._agents.values(),f=>f.id===u.participant&&qe.equals(f.extension.identifier,o.extension.identifier));return d||this._logService.warn(`[@${o.id}] ChatFollowup refers to an unknown participant: ${u.participant}`),d}).map(u=>Bu.from(u,a))}$acceptFeedback(t,i,r){const s=this._agents.get(t);if(!s)return;const n=Nl.to(i);let o;switch(r.direction){case xf.Down:o=Iu.Unhelpful;break;case xf.Up:o=Iu.Helpful;break}const a={result:n,kind:o,unhelpfulReason:nt(s.extension,"chatParticipantAdditions")?r.reason:void 0};s.acceptFeedback(Object.freeze(a))}$acceptAction(t,i,r){const s=this._agents.get(t);if(!s||r.action.kind==="vote")return;const n=lw.to(i,r,this._commands.converter);n&&s.acceptAction(Object.freeze(n))}async $invokeCompletionProvider(t,i,r){const s=this._agents.get(t);if(!s)return[];let n=this._completionDisposables.get(t);return n?n.clear():(n=new oe,this._completionDisposables.set(t,n)),(await s.invokeCompletionProvider(i,r)).map(a=>aw.from(a,this._commands.converter,n))}async $provideChatTitle(t,i,r){const s=this._agents.get(t);if(!s)return;const n=await this.prepareHistoryTurns(s.extension,s.id,{history:i});return await s.provideTitle({history:n},r)}async $provideSampleQuestions(t,i,r){const s=this._agents.get(t);if(s)return(await s.provideSampleQuestions(Ju.to(i),r)).map(n=>Bu.from(n,void 0))}},Xz=class{constructor(e,t){this.extension=e,this.provider=t}},Yz=class{constructor(e,t){this.extension=e,this.provider=t}},cA=class{constructor(e,t,i,r,s){this.extension=e,this.id=t,this._proxy=i,this._handle=r,this._requestHandler=s,this._onDidReceiveFeedback=new D,this._onDidPerformAction=new D,this._pauseStateEmitter=new D}acceptFeedback(e){this._onDidReceiveFeedback.fire(e)}acceptAction(e){this._onDidPerformAction.fire(e)}setChatRequestPauseState(e){this._pauseStateEmitter.fire(e)}async invokeCompletionProvider(e,t){return this._agentVariableProvider?await this._agentVariableProvider.provider.provideCompletionItems(e,t)??[]:[]}async provideFollowups(e,t,i){if(!this._followupProvider)return[];const r=await this._followupProvider.provideFollowups(e,t,i);return r?r.filter(s=>!(s&&"commandId"in s)).filter(s=>!(s&&"message"in s)):[]}async provideTitle(e,t){if(this._titleProvider)return await this._titleProvider.provideChatTitle(e,t)??void 0}async provideSampleQuestions(e,t){if(!this._welcomeMessageProvider||!this._welcomeMessageProvider.provideSampleQuestions)return[];const i=await this._welcomeMessageProvider.provideSampleQuestions(e,t);return i||[]}get apiAgent(){let e=!1,t=!1;const i=()=>{e||t||(t=!0,queueMicrotask(()=>{this._proxy.$updateAgent(this._handle,{icon:this._iconPath?this._iconPath instanceof b?this._iconPath:"light"in this._iconPath?this._iconPath.light:void 0:void 0,iconDark:this._iconPath&&"dark"in this._iconPath?this._iconPath.dark:void 0,themeIcon:this._iconPath instanceof pi?this._iconPath:void 0,hasFollowups:this._followupProvider!==void 0,helpTextPrefix:!this._helpTextPrefix||typeof this._helpTextPrefix=="string"?this._helpTextPrefix:ve.from(this._helpTextPrefix),helpTextVariablesPrefix:!this._helpTextVariablesPrefix||typeof this._helpTextVariablesPrefix=="string"?this._helpTextVariablesPrefix:ve.from(this._helpTextVariablesPrefix),helpTextPostfix:!this._helpTextPostfix||typeof this._helpTextPostfix=="string"?this._helpTextPostfix:ve.from(this._helpTextPostfix),supportIssueReporting:this._supportIssueReporting,requester:this._requester,additionalWelcomeMessage:!this._additionalWelcomeMessage||typeof this._additionalWelcomeMessage=="string"?this._additionalWelcomeMessage:ve.from(this._additionalWelcomeMessage)}),t=!1}))},r=this;return{get id(){return r.id},get iconPath(){return r._iconPath},set iconPath(s){r._iconPath=s,i()},get requestHandler(){return r._requestHandler},set requestHandler(s){vv(typeof s=="function","Invalid request handler"),r._requestHandler=s},get followupProvider(){return r._followupProvider},set followupProvider(s){r._followupProvider=s,i()},get helpTextPrefix(){return M(r.extension,"defaultChatParticipant"),r._helpTextPrefix},set helpTextPrefix(s){M(r.extension,"defaultChatParticipant"),r._helpTextPrefix=s,i()},get helpTextVariablesPrefix(){return M(r.extension,"defaultChatParticipant"),r._helpTextVariablesPrefix},set helpTextVariablesPrefix(s){M(r.extension,"defaultChatParticipant"),r._helpTextVariablesPrefix=s,i()},get helpTextPostfix(){return M(r.extension,"defaultChatParticipant"),r._helpTextPostfix},set helpTextPostfix(s){M(r.extension,"defaultChatParticipant"),r._helpTextPostfix=s,i()},get supportIssueReporting(){return M(r.extension,"chatParticipantPrivate"),r._supportIssueReporting},set supportIssueReporting(s){M(r.extension,"chatParticipantPrivate"),r._supportIssueReporting=s,i()},get onDidReceiveFeedback(){return r._onDidReceiveFeedback.event},set participantVariableProvider(s){if(M(r.extension,"chatParticipantAdditions"),r._agentVariableProvider=s,s){if(!s.triggerCharacters.length)throw new Error("triggerCharacters are required");r._proxy.$registerAgentCompletionsProvider(r._handle,r.id,s.triggerCharacters)}else r._proxy.$unregisterAgentCompletionsProvider(r._handle,r.id)},get participantVariableProvider(){return M(r.extension,"chatParticipantAdditions"),r._agentVariableProvider},set welcomeMessageProvider(s){M(r.extension,"defaultChatParticipant"),r._welcomeMessageProvider=s,i()},get welcomeMessageProvider(){return M(r.extension,"defaultChatParticipant"),r._welcomeMessageProvider},set additionalWelcomeMessage(s){M(r.extension,"defaultChatParticipant"),r._additionalWelcomeMessage=s,i()},get additionalWelcomeMessage(){return M(r.extension,"defaultChatParticipant"),r._additionalWelcomeMessage},set titleProvider(s){M(r.extension,"defaultChatParticipant"),r._titleProvider=s,i()},get titleProvider(){return M(r.extension,"defaultChatParticipant"),r._titleProvider},get onDidChangePauseState(){return M(r.extension,"chatParticipantAdditions"),r._pauseStateEmitter.event},onDidPerformAction:nt(this.extension,"chatParticipantAdditions")?this._onDidPerformAction.event:void 0,set requester(s){r._requester=s,i()},get requester(){return r._requester},dispose(){e=!0,r._followupProvider=void 0,r._onDidReceiveFeedback.dispose(),r._proxy.$unregisterAgent(r._handle)}}}invoke(e,t,i,r){return this._requestHandler(e,t,i,r)}},Zz=class{constructor(e){this._items=new Map,this._proxy=e.getProxy(Q.MainThreadChatStatus)}createChatStatusItem(e,t){const i=eq(e.identifier,t);if(this._items.has(i))throw new Error(`Chat status item '${t}' already exists`);const r={id:i,title:"",description:"",detail:""};let s=!1,n=!1;const o=()=>{if(s)throw new Error("Chat status item is disposed");n&&this._proxy.$setEntry(t,r)},a=Object.freeze({id:t,get title(){return r.title},set title(l){r.title=l,o()},get description(){return r.description},set description(l){r.description=l,o()},get detail(){return r.detail},set detail(l){r.detail=l,o()},show:()=>{n=!0,o()},hide:()=>{n=!1,this._proxy.$disposeEntry(t)},dispose:()=>{s=!0,this._proxy.$disposeEntry(t),this._items.delete(i)}});return this._items.set(i,a),a}};function eq(e,t){return`${qe.toKey(e)}.${t}`}var tq=class{constructor(e){const t=e.getProxy(Q.MainThreadClipboard);this.value=Object.freeze({readText(){return t.$readText()},writeText(i){return t.$writeText(i)}})}},uA="vscode-cdn.net",iq=`vscode-resource.${uA}`,lb=`'self' https://*.${uA}`;function wd(e,t){return e.scheme===V.http||e.scheme===V.https?e:(t&&t.authority&&t.isRemote&&e.scheme===V.file&&(e=b.from({scheme:V.vscodeRemote,authority:t.authority,path:e.path})),b.from({scheme:V.https,authority:`${e.scheme}+${rq(e.authority)}.${iq}`,path:e.path,fragment:e.fragment,query:e.query}))}function rq(e){return e.replace(/./g,t=>{const i=t.charCodeAt(0);return i>=97&&i<=122||i>=65&&i<=90||i>=48&&i<=57?t:"-"+i.toString(16).padStart(4,"0")})}var sq=class{constructor(e,t,i){this._proxy=e,this._editors=t,this._remoteInfo=i,this._handlePool=0,this._disposables=new oe,this._insets=new Map,this._disposables.add(t.onDidChangeVisibleTextEditors(()=>{const r=t.getVisibleTextEditors();for(const s of this._insets.values())r.indexOf(s.editor)<0&&s.inset.dispose()}))}dispose(){this._insets.forEach(e=>e.inset.dispose()),this._disposables.dispose()}createWebviewEditorInset(e,t,i,r,s){let n;for(const f of this._editors.getVisibleTextEditors(!0))if(f.value===e){n=f;break}if(!n)throw new Error("not a visible editor");const o=this,a=this._handlePool++,l=new D,c=new D,u=new class{constructor(){this._html="",this._options=Object.create(null)}asWebviewUri(f){return wd(f,o._remoteInfo)}get cspSource(){return lb}set options(f){this._options=f,o._proxy.$setOptions(a,f)}get options(){return this._options}set html(f){this._html=f,o._proxy.$setHtml(a,f)}get html(){return this._html}get onDidReceiveMessage(){return l.event}postMessage(f){return o._proxy.$postMessage(a,f)}},d=new class{constructor(){this.editor=e,this.line=t,this.height=i,this.webview=u,this.onDidDispose=c.event}dispose(){o._insets.has(a)&&(o._insets.delete(a),o._proxy.$disposeEditorInset(a),c.fire(),c.dispose(),l.dispose())}};return this._proxy.$createEditorInset(a,n.id,n.value.document.uri,t+1,i,r||{},s.identifier,s.extensionLocation),this._insets.set(a,{editor:e,inset:d,onDidReceiveMessage:l}),d}$onDidDispose(e){const t=this._insets.get(e);t&&t.inset.dispose()}$onDidReceiveMessage(e,t){this._insets.get(e)?.onDidReceiveMessage.fire(t)}},nq=class A8{static{this._providerHandlePool=0}constructor(t){this.providers=new Map,this._proxy=t.getProxy(Q.MainThreadCodeMapper)}async $mapCode(t,i,r){const s=this.providers.get(t);if(!s)throw new Error(`Received request to map code for unknown provider handle ${t}`);const n={textEdit:(l,c)=>{c=er(c),this._proxy.$handleProgress(i.requestId,{uri:l,edits:c.map(Gt.from)})},notebookEdit:(l,c)=>{c=er(c),this._proxy.$handleProgress(i.requestId,{uri:l,edits:c.map(sg.from)})}},o={location:i.location,chatRequestId:i.chatRequestId,chatRequestModel:i.chatRequestModel,chatSessionId:i.chatSessionId,codeBlocks:i.codeBlocks.map(l=>({code:l.code,resource:b.revive(l.resource),markdownBeforeBlock:l.markdownBeforeBlock}))};return await s.provideMappedEdits(o,n,r)??null}registerMappedEditsProvider(t,i){const r=A8._providerHandlePool++;return this._proxy.$registerCodeMapperProvider(r,t.displayName??t.name),this.providers.set(r,i),{dispose:()=>this._proxy.$unregisterCodeMapperProvider(r)}}};function oq(e,t,i){const r=e.getProxy(Q.MainThreadComments);class s{static{this.handlePool=0}constructor(){this._commentControllers=new Map,this._commentControllersByExtension=new As,t.registerArgumentProcessor({processArgument:g=>{if(g&&g.$mid===6){const v=this._commentControllers.get(g.handle);return v?v.value:g}else if(g&&g.$mid===7){const v=g,y=this._commentControllers.get(v.commentControlHandle);if(!y)return v;const S=y.getCommentThread(v.commentThreadHandle);return S?S.value:v}else if(g&&(g.$mid===9||g.$mid===8)){const v=this._commentControllers.get(g.thread.commentControlHandle);if(!v)return g;const y=v.getCommentThread(g.thread.commentThreadHandle);return y?g.$mid===8?y.value:{thread:y.value,text:g.text}:g}else if(g&&g.$mid===10){const v=this._commentControllers.get(g.thread.commentControlHandle);if(!v)return g;const y=v.getCommentThread(g.thread.commentThreadHandle);if(!y)return g;const S=g.commentUniqueId,x=y.getCommentByUniqueId(S);return x||g}else if(g&&g.$mid===11){const v=this._commentControllers.get(g.thread.commentControlHandle);if(!v)return g;const y=v.getCommentThread(g.thread.commentThreadHandle);if(!y)return g;const S=g.text,x=g.commentUniqueId,P=y.getCommentByUniqueId(x);return P?(typeof P.body=="string"?P.body=S:P.body=new Ti(S),P):g}return g}})}createCommentController(g,v,y){const S=s.handlePool++,x=new o(g,S,v,y);this._commentControllers.set(x.handle,x);const P=this._commentControllersByExtension.get(g.identifier)||[];return P.push(x),this._commentControllersByExtension.set(g.identifier,P),x.value}async $createCommentThreadTemplate(g,v,y,S){const x=this._commentControllers.get(g);x&&x.$createCommentThreadTemplate(v,y,S)}async $setActiveComment(g,v){const y=this._commentControllers.get(g);y&&y.$setActiveComment(v??void 0)}async $updateCommentThreadTemplate(g,v,y){const S=this._commentControllers.get(g);S&&S.$updateCommentThreadTemplate(v,y)}$deleteCommentThread(g,v){this._commentControllers.get(g)?.$deleteCommentThread(v)}async $updateCommentThread(g,v,y){this._commentControllers.get(g)?.$updateCommentThread(v,y)}async $provideCommentingRanges(g,v,y){const S=this._commentControllers.get(g);if(!S||!S.commentingRangeProvider)return Promise.resolve(void 0);const x=await i.ensureDocumentData(b.revive(v));return ci(async()=>{const P=await S.commentingRangeProvider?.provideCommentingRanges(x.document,y);let $;return Array.isArray(P)?$={ranges:P,fileComments:!1}:P?$={ranges:P.ranges||[],fileComments:P.enableFileComments||!1}:$=P??void 0,$}).then(P=>{let $;return P&&($={ranges:P.ranges.map(A=>F.from(A)),fileComments:P.fileComments}),$})}$toggleReaction(g,v,y,S,x){const P=this._commentControllers.get(g);return!P||!P.reactionHandler?Promise.resolve(void 0):ci(()=>{const $=P.getCommentThread(v);if($){const A=$.getCommentByUniqueId(S.uniqueIdInThread);if(P!==void 0&&A&&P.reactionHandler)return P.reactionHandler(A,c(x))}return Promise.resolve(void 0)})}}class n{static{this._handlePool=0}set threadId(g){this._id=g}get threadId(){return this._id}get id(){return this._id}get resource(){return this._uri}get uri(){return this._uri}set range(g){(g===void 0!=(this._range===void 0)||!g||!this._range||!g.isEqual(this._range))&&(this._range=g,this.modifications.range=g,this._onDidUpdateCommentThread.fire())}get range(){return this._range}set canReply(g){this._canReply!==g&&(this._canReply=g,this.modifications.canReply=g,this._onDidUpdateCommentThread.fire())}get canReply(){return this._canReply}get label(){return this._label}set label(g){this._label=g,this.modifications.label=g,this._onDidUpdateCommentThread.fire()}get contextValue(){return this._contextValue}set contextValue(g){this._contextValue=g,this.modifications.contextValue=g,this._onDidUpdateCommentThread.fire()}get comments(){return this._comments}set comments(g){this._comments=g,this.modifications.comments=g,this._onDidUpdateCommentThread.fire()}get collapsibleState(){return this._collapseState}set collapsibleState(g){this._collapseState!==g&&(this._collapseState=g,this.modifications.collapsibleState=g,this._onDidUpdateCommentThread.fire())}get state(){return this._state}set state(g){this._state=g,typeof g=="object"?(M(this.extensionDescription,"commentThreadApplicability"),this.modifications.state=g.resolved,this.modifications.applicability=g.applicability):this.modifications.state=g,this._onDidUpdateCommentThread.fire()}get isDisposed(){return this._isDiposed}constructor(g,v,y,S,x,P,$,A,W){this._commentControllerHandle=v,this._id=y,this._uri=S,this._range=x,this._comments=P,this.extensionDescription=$,this._isTemplate=A,this.handle=n._handlePool++,this.commentHandle=0,this.modifications=Object.create(null),this._onDidUpdateCommentThread=new D,this.onDidUpdateCommentThread=this._onDidUpdateCommentThread.event,this._canReply=!0,this._commentsMap=new Map,this._acceptInputDisposables=new Kr,this._acceptInputDisposables.value=new oe,this._id===void 0&&(this._id=`${g}.${this.handle}`),r.$createCommentThread(v,this.handle,this._id,this._uri,F.from(this._range),this._comments.map(J=>a(this,J,this._commentsMap,this.extensionDescription)),$.identifier,this._isTemplate,W),this._localDisposables=[],this._isDiposed=!1,this._localDisposables.push(this.onDidUpdateCommentThread(()=>{this.eventuallyUpdateCommentThread()})),this._localDisposables.push({dispose:()=>{r.$deleteCommentThread(v,this.handle)}});const G=this;this.value={get uri(){return G.uri},get range(){return G.range},set range(J){G.range=J},get comments(){return G.comments},set comments(J){G.comments=J},get collapsibleState(){return G.collapsibleState},set collapsibleState(J){G.collapsibleState=J},get canReply(){return G.canReply},set canReply(J){G.canReply=J},get contextValue(){return G.contextValue},set contextValue(J){G.contextValue=J},get label(){return G.label},set label(J){G.label=J},get state(){return G.state},set state(J){G.state=J},reveal:(J,H)=>G.reveal(J,H),hide:()=>G.hide(),dispose:()=>{G.dispose()}}}updateIsTemplate(){this._isTemplate&&(this._isTemplate=!1,this.modifications.isTemplate=!1)}eventuallyUpdateCommentThread(){if(this._isDiposed)return;this.updateIsTemplate(),this._acceptInputDisposables.value||(this._acceptInputDisposables.value=new oe);const g=y=>Object.prototype.hasOwnProperty.call(this.modifications,y),v={};g("range")&&(v.range=F.from(this._range)),g("label")&&(v.label=this.label),g("contextValue")&&(v.contextValue=this.contextValue??null),g("comments")&&(v.comments=this._comments.map(y=>a(this,y,this._commentsMap,this.extensionDescription))),g("collapsibleState")&&(v.collapseState=u(this._collapseState)),g("canReply")&&(v.canReply=this.canReply),g("state")&&(v.state=d(this._state)),g("applicability")&&(v.applicability=f(this._state)),g("isTemplate")&&(v.isTemplate=this._isTemplate),this.modifications={},r.$updateCommentThread(this._commentControllerHandle,this.handle,this._id,this._uri,v)}getCommentByUniqueId(g){for(const v of this._commentsMap){const y=v[0],S=v[1];if(g===S)return y}}async reveal(g,v){M(this.extensionDescription,"commentReveal");let y;g&&g.body!==void 0?y=g:v=v??g;let S=y?this._commentsMap.get(y):void 0;S??=this._commentsMap.get(this._comments[0]);let x=!0,P=!1;return v?.focus===xu.Reply?(P=!0,x=!1):v?.focus===xu.Comment&&(x=!1),r.$revealCommentThread(this._commentControllerHandle,this.handle,S,{preserveFocus:x,focusReply:P})}async hide(){return r.$hideCommentThread(this._commentControllerHandle,this.handle)}dispose(){this._isDiposed=!0,this._acceptInputDisposables.dispose(),this._localDisposables.forEach(g=>g.dispose())}}__decorate([Ah(100)],n.prototype,"eventuallyUpdateCommentThread",null);class o{get id(){return this._id}get label(){return this._label}get handle(){return this._handle}get commentingRangeProvider(){return this._commentingRangeProvider}set commentingRangeProvider(g){this._commentingRangeProvider=g,g?.resourceHints&&M(this._extension,"commentingRangeHint"),r.$updateCommentingRanges(this.handle,g?.resourceHints)}get reactionHandler(){return this._reactionHandler}set reactionHandler(g){this._reactionHandler=g,r.$updateCommentControllerFeatures(this.handle,{reactionHandler:!!g})}get options(){return this._options}set options(g){this._options=g,r.$updateCommentControllerFeatures(this.handle,{options:this._options})}get activeComment(){return M(this._extension,"activeComment"),this._activeComment}get activeCommentThread(){return M(this._extension,"activeComment"),this._activeThread?.value}constructor(g,v,y,S){this._extension=g,this._handle=v,this._id=y,this._label=S,this._threads=new Map,r.$registerCommentController(this.handle,y,S,this._extension.identifier.value);const x=this;this.value=Object.freeze({id:x.id,label:x.label,get options(){return x.options},set options(P){x.options=P},get commentingRangeProvider(){return x.commentingRangeProvider},set commentingRangeProvider(P){x.commentingRangeProvider=P},get reactionHandler(){return x.reactionHandler},set reactionHandler(P){x.reactionHandler=P},get activeCommentThread(){return x.activeCommentThread},createCommentThread(P,$,A){return x.createCommentThread(P,$,A).value},dispose:()=>{x.dispose()}}),this._localDisposables=[],this._localDisposables.push({dispose:()=>{r.$unregisterCommentController(this.handle)}})}createCommentThread(g,v,y){const S=new n(this.id,this.handle,void 0,g,v,y,this._extension,!1);return this._threads.set(S.handle,S),S}$setActiveComment(g){if(!g){this._activeComment=void 0,this._activeThread=void 0;return}const v=this._threads.get(g.commentThreadHandle);v&&(this._activeComment=g.uniqueIdInThread?v.getCommentByUniqueId(g.uniqueIdInThread):void 0,this._activeThread=v)}$createCommentThreadTemplate(g,v,y){const S=new n(this.id,this.handle,void 0,b.revive(g),F.to(v),[],this._extension,!0,y);return S.collapsibleState=Ha.Expanded,this._threads.set(S.handle,S),S}$updateCommentThreadTemplate(g,v){const y=this._threads.get(g);y&&(y.range=F.to(v))}$updateCommentThread(g,v){const y=this._threads.get(g);if(!y)return;(x=>Object.prototype.hasOwnProperty.call(v,x))("collapseState")&&(y.collapsibleState=u(v.collapseState))}$deleteCommentThread(g){this._threads.get(g)?.dispose(),this._threads.delete(g)}getCommentThread(g){return this._threads.get(g)}dispose(){this._threads.forEach(g=>{g.dispose()}),this._localDisposables.forEach(g=>g.dispose())}}function a(p,g,v,y){let S=v.get(g);return S||(S=++p.commentHandle,v.set(g,S)),g.state!==void 0&&M(y,"commentsDraftState"),g.reactions?.some(x=>x.reactors!==void 0)&&M(y,"commentReactor"),{mode:g.mode,contextValue:g.contextValue,uniqueIdInThread:S,body:typeof g.body=="string"?g.body:ve.from(g.body),userName:g.author.name,userIconPath:g.author.iconPath,label:g.label,commentReactions:g.reactions?g.reactions.map(x=>l(x)):void 0,state:g.state,timestamp:g.timestamp?.toJSON()}}function l(p){return{label:p.label,iconPath:p.iconPath?Fp(p.iconPath):void 0,count:p.count,hasReacted:p.authorHasReacted,reactors:p.reactors&&p.reactors.length>0&&typeof p.reactors[0]!="string"?p.reactors.map(g=>g.name):p.reactors}}function c(p){return{label:p.label||"",count:p.count||0,iconPath:p.iconPath?b.revive(p.iconPath):"",authorHasReacted:p.hasReacted||!1,reactors:p.reactors?.map(g=>({name:g}))}}function u(p){if(p!==void 0)switch(p){case yu.Expanded:return Ha.Expanded;case yu.Collapsed:return Ha.Collapsed}return Ha.Collapsed}function d(p){let g;if(typeof p=="object"?g=p.resolved:g=p,g!==void 0)switch(g){case bu.Unresolved:return Bc.Unresolved;case bu.Resolved:return Bc.Resolved}return Bc.Unresolved}function f(p){let g;if(typeof p=="object"&&(g=p.applicability),g!==void 0)switch(g){case Su.Current:return Vc.Current;case Su.Outdated:return Vc.Outdated}return Vc.Current}return new s}var cm={},Ue={exports:cm};(function(e,t){if(typeof cm=="object"&&typeof Ue=="object")Ue.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var i=t();for(var r in i)(typeof cm=="object"?cm:e)[r]=i[r]}})(typeof self<"u"?self:void 0,function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(r,s,n){i.o(r,s)||Object.defineProperty(r,s,{enumerable:!0,get:n})},i.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},i.t=function(r,s){if(1&s&&(r=i(r)),8&s||4&s&&typeof r=="object"&&r&&r.__esModule)return r;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&s&&typeof r!="string")for(var o in r)i.d(n,o,function(a){return r[a]}.bind(null,o));return n},i.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return i.d(s,"a",s),s},i.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},i.p="",i(i.s=0)}([function(e,t,i){(function(r){var s;t=e.exports=Je,s=typeof r=="object"&&r.env&&r.env.NODE_DEBUG&&/\bsemver\b/i.test(r.env.NODE_DEBUG)?function(){var k=Array.prototype.slice.call(arguments,0);k.unshift("SEMVER"),console.log.apply(console,k)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var n=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,a=t.re=[],l=t.src=[],c=0,u=c++;l[u]="0|[1-9]\\d*";var d=c++;l[d]="[0-9]+";var f=c++;l[f]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var p=c++;l[p]="("+l[u]+")\\.("+l[u]+")\\.("+l[u]+")";var g=c++;l[g]="("+l[d]+")\\.("+l[d]+")\\.("+l[d]+")";var v=c++;l[v]="(?:"+l[u]+"|"+l[f]+")";var y=c++;l[y]="(?:"+l[d]+"|"+l[f]+")";var S=c++;l[S]="(?:-("+l[v]+"(?:\\."+l[v]+")*))";var x=c++;l[x]="(?:-?("+l[y]+"(?:\\."+l[y]+")*))";var P=c++;l[P]="[0-9A-Za-z-]+";var $=c++;l[$]="(?:\\+("+l[P]+"(?:\\."+l[P]+")*))";var A=c++,W="v?"+l[p]+l[S]+"?"+l[$]+"?";l[A]="^"+W+"$";var G="[v=\\s]*"+l[g]+l[x]+"?"+l[$]+"?",J=c++;l[J]="^"+G+"$";var H=c++;l[H]="((?:<|>)?=?)";var K=c++;l[K]=l[d]+"|x|X|\\*";var Ee=c++;l[Ee]=l[u]+"|x|X|\\*";var ne=c++;l[ne]="[v=\\s]*("+l[Ee]+")(?:\\.("+l[Ee]+")(?:\\.("+l[Ee]+")(?:"+l[S]+")?"+l[$]+"?)?)?";var ct=c++;l[ct]="[v=\\s]*("+l[K]+")(?:\\.("+l[K]+")(?:\\.("+l[K]+")(?:"+l[x]+")?"+l[$]+"?)?)?";var j=c++;l[j]="^"+l[H]+"\\s*"+l[ne]+"$";var B=c++;l[B]="^"+l[H]+"\\s*"+l[ct]+"$";var te=c++;l[te]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var Y=c++;l[Y]="(?:~>?)";var ee=c++;l[ee]="(\\s*)"+l[Y]+"\\s+",a[ee]=new RegExp(l[ee],"g");var _e=c++;l[_e]="^"+l[Y]+l[ne]+"$";var Re=c++;l[Re]="^"+l[Y]+l[ct]+"$";var be=c++;l[be]="(?:\\^)";var et=c++;l[et]="(\\s*)"+l[be]+"\\s+",a[et]=new RegExp(l[et],"g");var Zt=c++;l[Zt]="^"+l[be]+l[ne]+"$";var xt=c++;l[xt]="^"+l[be]+l[ct]+"$";var si=c++;l[si]="^"+l[H]+"\\s*("+G+")$|^$";var gi=c++;l[gi]="^"+l[H]+"\\s*("+W+")$|^$";var tt=c++;l[tt]="(\\s*)"+l[H]+"\\s*("+G+"|"+l[ne]+")",a[tt]=new RegExp(l[tt],"g");var ws=c++;l[ws]="^\\s*("+l[ne]+")\\s+-\\s+("+l[ne]+")\\s*$";var ga=c++;l[ga]="^\\s*("+l[ct]+")\\s+-\\s+("+l[ct]+")\\s*$";var un=c++;l[un]="(<|>)?=?\\s*\\*";for(var ar=0;ar<35;ar++)s(ar,l[ar]),a[ar]||(a[ar]=new RegExp(l[ar]));function Ce(k,N){if(k instanceof Je)return k;if(typeof k!="string"||k.length>n||!(N?a[J]:a[A]).test(k))return null;try{return new Je(k,N)}catch{return null}}function Je(k,N){if(k instanceof Je){if(k.loose===N)return k;k=k.version}else if(typeof k!="string")throw new TypeError("Invalid Version: "+k);if(k.length>n)throw new TypeError("version is longer than "+n+" characters");if(!(this instanceof Je))return new Je(k,N);s("SemVer",k,N),this.loose=N;var O=k.trim().match(N?a[J]:a[A]);if(!O)throw new TypeError("Invalid Version: "+k);if(this.raw=k,this.major=+O[1],this.minor=+O[2],this.patch=+O[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");O[4]?this.prerelease=O[4].split(".").map(function(he){if(/^[0-9]+$/.test(he)){var we=+he;if(we>=0&&we<o)return we}return he}):this.prerelease=[],this.build=O[5]?O[5].split("."):[],this.format()}t.parse=Ce,t.valid=function(k,N){var O=Ce(k,N);return O?O.version:null},t.clean=function(k,N){var O=Ce(k.trim().replace(/^[=v]+/,""),N);return O?O.version:null},t.SemVer=Je,Je.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Je.prototype.toString=function(){return this.version},Je.prototype.compare=function(k){return s("SemVer.compare",this.version,this.loose,k),k instanceof Je||(k=new Je(k,this.loose)),this.compareMain(k)||this.comparePre(k)},Je.prototype.compareMain=function(k){return k instanceof Je||(k=new Je(k,this.loose)),Oi(this.major,k.major)||Oi(this.minor,k.minor)||Oi(this.patch,k.patch)},Je.prototype.comparePre=function(k){if(k instanceof Je||(k=new Je(k,this.loose)),this.prerelease.length&&!k.prerelease.length)return-1;if(!this.prerelease.length&&k.prerelease.length)return 1;if(!this.prerelease.length&&!k.prerelease.length)return 0;var N=0;do{var O=this.prerelease[N],he=k.prerelease[N];if(s("prerelease compare",N,O,he),O===void 0&&he===void 0)return 0;if(he===void 0)return 1;if(O===void 0)return-1;if(O!==he)return Oi(O,he)}while(++N)},Je.prototype.inc=function(k,N){switch(k){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",N);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",N);break;case"prepatch":this.prerelease.length=0,this.inc("patch",N),this.inc("pre",N);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",N),this.inc("pre",N);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var O=this.prerelease.length;--O>=0;)typeof this.prerelease[O]=="number"&&(this.prerelease[O]++,O=-2);O===-1&&this.prerelease.push(0)}N&&(this.prerelease[0]===N?isNaN(this.prerelease[1])&&(this.prerelease=[N,0]):this.prerelease=[N,0]);break;default:throw new Error("invalid increment argument: "+k)}return this.format(),this.raw=this.version,this},t.inc=function(k,N,O,he){typeof O=="string"&&(he=O,O=void 0);try{return new Je(k,O).inc(N,he).version}catch{return null}},t.diff=function(k,N){if(nc(k,N))return null;var O=Ce(k),he=Ce(N);if(O.prerelease.length||he.prerelease.length){for(var we in O)if((we==="major"||we==="minor"||we==="patch")&&O[we]!==he[we])return"pre"+we;return"prerelease"}for(var we in O)if((we==="major"||we==="minor"||we==="patch")&&O[we]!==he[we])return we},t.compareIdentifiers=Oi;var Qd=/^[0-9]+$/;function Oi(k,N){var O=Qd.test(k),he=Qd.test(N);return O&&he&&(k=+k,N=+N),O&&!he?-1:he&&!O?1:k<N?-1:k>N?1:0}function bi(k,N,O){return new Je(k,O).compare(new Je(N,O))}function Xn(k,N,O){return bi(k,N,O)>0}function ma(k,N,O){return bi(k,N,O)<0}function nc(k,N,O){return bi(k,N,O)===0}function Jd(k,N,O){return bi(k,N,O)!==0}function va(k,N,O){return bi(k,N,O)>=0}function oc(k,N,O){return bi(k,N,O)<=0}function Yn(k,N,O,he){var we;switch(N){case"===":typeof k=="object"&&(k=k.version),typeof O=="object"&&(O=O.version),we=k===O;break;case"!==":typeof k=="object"&&(k=k.version),typeof O=="object"&&(O=O.version),we=k!==O;break;case"":case"=":case"==":we=nc(k,O,he);break;case"!=":we=Jd(k,O,he);break;case">":we=Xn(k,O,he);break;case">=":we=va(k,O,he);break;case"<":we=ma(k,O,he);break;case"<=":we=oc(k,O,he);break;default:throw new TypeError("Invalid operator: "+N)}return we}function Fi(k,N){if(k instanceof Fi){if(k.loose===N)return k;k=k.value}if(!(this instanceof Fi))return new Fi(k,N);s("comparator",k,N),this.loose=N,this.parse(k),this.semver===ys?this.value="":this.value=this.operator+this.semver.version,s("comp",this)}t.rcompareIdentifiers=function(k,N){return Oi(N,k)},t.major=function(k,N){return new Je(k,N).major},t.minor=function(k,N){return new Je(k,N).minor},t.patch=function(k,N){return new Je(k,N).patch},t.compare=bi,t.compareLoose=function(k,N){return bi(k,N,!0)},t.rcompare=function(k,N,O){return bi(N,k,O)},t.sort=function(k,N){return k.sort(function(O,he){return t.compare(O,he,N)})},t.rsort=function(k,N){return k.sort(function(O,he){return t.rcompare(O,he,N)})},t.gt=Xn,t.lt=ma,t.eq=nc,t.neq=Jd,t.gte=va,t.lte=oc,t.cmp=Yn,t.Comparator=Fi;var ys={};function yt(k,N){if(k instanceof yt)return k.loose===N?k:new yt(k.raw,N);if(k instanceof Fi)return new yt(k.value,N);if(!(this instanceof yt))return new yt(k,N);if(this.loose=N,this.raw=k,this.set=k.split(/\s*\|\|\s*/).map(function(O){return this.parseRange(O.trim())},this).filter(function(O){return O.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+k);this.format()}function hi(k){return!k||k.toLowerCase()==="x"||k==="*"}function sv(k,N,O,he,we,Bt,Ke,Jt,At,ni,lr,Rt,ei){return((N=hi(O)?"":hi(he)?">="+O+".0.0":hi(we)?">="+O+"."+he+".0":">="+N)+" "+(Jt=hi(At)?"":hi(ni)?"<"+(+At+1)+".0.0":hi(lr)?"<"+At+"."+(+ni+1)+".0":Rt?"<="+At+"."+ni+"."+lr+"-"+Rt:"<="+Jt)).trim()}function dn(k,N){for(var O=0;O<k.length;O++)if(!k[O].test(N))return!1;if(N.prerelease.length){for(O=0;O<k.length;O++)if(s(k[O].semver),k[O].semver!==ys&&k[O].semver.prerelease.length>0){var he=k[O].semver;if(he.major===N.major&&he.minor===N.minor&&he.patch===N.patch)return!0}return!1}return!0}function _a(k,N,O){try{N=new yt(N,O)}catch{return!1}return N.test(k)}function ac(k,N,O,he){var we,Bt,Ke,Jt,At;switch(k=new Je(k,he),N=new yt(N,he),O){case">":we=Xn,Bt=oc,Ke=ma,Jt=">",At=">=";break;case"<":we=ma,Bt=va,Ke=Xn,Jt="<",At="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(_a(k,N,he))return!1;for(var ni=0;ni<N.set.length;++ni){var lr=N.set[ni],Rt=null,ei=null;if(lr.forEach(function(mi){mi.semver===ys&&(mi=new Fi(">=0.0.0")),Rt=Rt||mi,ei=ei||mi,we(mi.semver,Rt.semver,he)?Rt=mi:Ke(mi.semver,ei.semver,he)&&(ei=mi)}),Rt.operator===Jt||Rt.operator===At||(!ei.operator||ei.operator===Jt)&&Bt(k,ei.semver)||ei.operator===At&&Ke(k,ei.semver))return!1}return!0}Fi.prototype.parse=function(k){var N=this.loose?a[si]:a[gi],O=k.match(N);if(!O)throw new TypeError("Invalid comparator: "+k);this.operator=O[1],this.operator==="="&&(this.operator=""),O[2]?this.semver=new Je(O[2],this.loose):this.semver=ys},Fi.prototype.toString=function(){return this.value},Fi.prototype.test=function(k){return s("Comparator.test",k,this.loose),this.semver===ys||(typeof k=="string"&&(k=new Je(k,this.loose)),Yn(k,this.operator,this.semver,this.loose))},Fi.prototype.intersects=function(k,N){if(!(k instanceof Fi))throw new TypeError("a Comparator is required");var O;if(this.operator==="")return O=new yt(k.value,N),_a(this.value,O,N);if(k.operator==="")return O=new yt(this.value,N),_a(k.semver,O,N);var he=!(this.operator!==">="&&this.operator!==">"||k.operator!==">="&&k.operator!==">"),we=!(this.operator!=="<="&&this.operator!=="<"||k.operator!=="<="&&k.operator!=="<"),Bt=this.semver.version===k.semver.version,Ke=!(this.operator!==">="&&this.operator!=="<="||k.operator!==">="&&k.operator!=="<="),Jt=Yn(this.semver,"<",k.semver,N)&&(this.operator===">="||this.operator===">")&&(k.operator==="<="||k.operator==="<"),At=Yn(this.semver,">",k.semver,N)&&(this.operator==="<="||this.operator==="<")&&(k.operator===">="||k.operator===">");return he||we||Bt&&Ke||Jt||At},t.Range=yt,yt.prototype.format=function(){return this.range=this.set.map(function(k){return k.join(" ").trim()}).join("||").trim(),this.range},yt.prototype.toString=function(){return this.range},yt.prototype.parseRange=function(k){var N=this.loose;k=k.trim(),s("range",k,N);var O=N?a[ga]:a[ws];k=k.replace(O,sv),s("hyphen replace",k),k=k.replace(a[tt],"$1$2$3"),s("comparator trim",k,a[tt]),k=(k=(k=k.replace(a[ee],"$1~")).replace(a[et],"$1^")).split(/\s+/).join(" ");var he=N?a[si]:a[gi],we=k.split(" ").map(function(Bt){return function(Ke,Jt){return s("comp",Ke),Ke=function(At,ni){return At.trim().split(/\s+/).map(function(lr){return function(Rt,ei){s("caret",Rt,ei);var mi=ei?a[xt]:a[Zt];return Rt.replace(mi,function(Le,xe,Me,ft,gt){var Kt;return s("caret",Rt,Le,xe,Me,ft,gt),hi(xe)?Kt="":hi(Me)?Kt=">="+xe+".0.0 <"+(+xe+1)+".0.0":hi(ft)?Kt=xe==="0"?">="+xe+"."+Me+".0 <"+xe+"."+(+Me+1)+".0":">="+xe+"."+Me+".0 <"+(+xe+1)+".0.0":gt?(s("replaceCaret pr",gt),gt.charAt(0)!=="-"&&(gt="-"+gt),Kt=xe==="0"?Me==="0"?">="+xe+"."+Me+"."+ft+gt+" <"+xe+"."+Me+"."+(+ft+1):">="+xe+"."+Me+"."+ft+gt+" <"+xe+"."+(+Me+1)+".0":">="+xe+"."+Me+"."+ft+gt+" <"+(+xe+1)+".0.0"):(s("no pr"),Kt=xe==="0"?Me==="0"?">="+xe+"."+Me+"."+ft+" <"+xe+"."+Me+"."+(+ft+1):">="+xe+"."+Me+"."+ft+" <"+xe+"."+(+Me+1)+".0":">="+xe+"."+Me+"."+ft+" <"+(+xe+1)+".0.0"),s("caret return",Kt),Kt})}(lr,ni)}).join(" ")}(Ke,Jt),s("caret",Ke),Ke=function(At,ni){return At.trim().split(/\s+/).map(function(lr){return function(Rt,ei){var mi=ei?a[Re]:a[_e];return Rt.replace(mi,function(Le,xe,Me,ft,gt){var Kt;return s("tilde",Rt,Le,xe,Me,ft,gt),hi(xe)?Kt="":hi(Me)?Kt=">="+xe+".0.0 <"+(+xe+1)+".0.0":hi(ft)?Kt=">="+xe+"."+Me+".0 <"+xe+"."+(+Me+1)+".0":gt?(s("replaceTilde pr",gt),gt.charAt(0)!=="-"&&(gt="-"+gt),Kt=">="+xe+"."+Me+"."+ft+gt+" <"+xe+"."+(+Me+1)+".0"):Kt=">="+xe+"."+Me+"."+ft+" <"+xe+"."+(+Me+1)+".0",s("tilde return",Kt),Kt})}(lr,ni)}).join(" ")}(Ke,Jt),s("tildes",Ke),Ke=function(At,ni){return s("replaceXRanges",At,ni),At.split(/\s+/).map(function(lr){return function(Rt,ei){Rt=Rt.trim();var mi=ei?a[B]:a[j];return Rt.replace(mi,function(Le,xe,Me,ft,gt,Kt){s("xRange",Rt,Le,xe,Me,ft,gt,Kt);var Kd=hi(Me),C=Kd||hi(ft),$i=C||hi(gt);return xe==="="&&$i&&(xe=""),Kd?Le=xe===">"||xe==="<"?"<0.0.0":"*":xe&&$i?(C&&(ft=0),$i&&(gt=0),xe===">"?(xe=">=",C?(Me=+Me+1,ft=0,gt=0):$i&&(ft=+ft+1,gt=0)):xe==="<="&&(xe="<",C?Me=+Me+1:ft=+ft+1),Le=xe+Me+"."+ft+"."+gt):C?Le=">="+Me+".0.0 <"+(+Me+1)+".0.0":$i&&(Le=">="+Me+"."+ft+".0 <"+Me+"."+(+ft+1)+".0"),s("xRange return",Le),Le})}(lr,ni)}).join(" ")}(Ke,Jt),s("xrange",Ke),Ke=function(At,ni){return s("replaceStars",At,ni),At.trim().replace(a[un],"")}(Ke,Jt),s("stars",Ke),Ke}(Bt,N)}).join(" ").split(/\s+/);return this.loose&&(we=we.filter(function(Bt){return!!Bt.match(he)})),we=we.map(function(Bt){return new Fi(Bt,N)})},yt.prototype.intersects=function(k,N){if(!(k instanceof yt))throw new TypeError("a Range is required");return this.set.some(function(O){return O.every(function(he){return k.set.some(function(we){return we.every(function(Bt){return he.intersects(Bt,N)})})})})},t.toComparators=function(k,N){return new yt(k,N).set.map(function(O){return O.map(function(he){return he.value}).join(" ").trim().split(" ")})},yt.prototype.test=function(k){if(!k)return!1;typeof k=="string"&&(k=new Je(k,this.loose));for(var N=0;N<this.set.length;N++)if(dn(this.set[N],k))return!0;return!1},t.satisfies=_a,t.maxSatisfying=function(k,N,O){var he=null,we=null;try{var Bt=new yt(N,O)}catch{return null}return k.forEach(function(Ke){Bt.test(Ke)&&(he&&we.compare(Ke)!==-1||(we=new Je(he=Ke,O)))}),he},t.minSatisfying=function(k,N,O){var he=null,we=null;try{var Bt=new yt(N,O)}catch{return null}return k.forEach(function(Ke){Bt.test(Ke)&&(he&&we.compare(Ke)!==1||(we=new Je(he=Ke,O)))}),he},t.validRange=function(k,N){try{return new yt(k,N).range||"*"}catch{return null}},t.ltr=function(k,N,O){return ac(k,N,"<",O)},t.gtr=function(k,N,O){return ac(k,N,">",O)},t.outside=ac,t.prerelease=function(k,N){var O=Ce(k,N);return O&&O.prerelease.length?O.prerelease:null},t.intersects=function(k,N,O){return k=new yt(k,O),N=new yt(N,O),k.intersects(N)},t.coerce=function(k){if(k instanceof Je)return k;if(typeof k!="string")return null;var N=k.match(a[te]);return N==null?null:Ce((N[1]||"0")+"."+(N[2]||"0")+"."+(N[3]||"0"))}}).call(this,i(1))},function(e,t){var i,r,s=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(y){if(i===setTimeout)return setTimeout(y,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(y,0);try{return i(y,0)}catch{try{return i.call(null,y,0)}catch{return i.call(this,y,0)}}}(function(){try{i=typeof setTimeout=="function"?setTimeout:n}catch{i=n}try{r=typeof clearTimeout=="function"?clearTimeout:o}catch{r=o}})();var l,c=[],u=!1,d=-1;function f(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&p())}function p(){if(!u){var y=a(f);u=!0;for(var S=c.length;S;){for(l=c,c=[];++d<S;)l&&l[d].run();d=-1,S=c.length}l=null,u=!1,function(x){if(r===clearTimeout)return clearTimeout(x);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(x);try{r(x)}catch{try{return r.call(null,x)}catch{return r.call(this,x)}}}(y)}}function g(y,S){this.fun=y,this.array=S}function v(){}s.nextTick=function(y){var S=new Array(arguments.length-1);if(arguments.length>1)for(var x=1;x<arguments.length;x++)S[x-1]=arguments[x];c.push(new g(y,S)),c.length!==1||u||a(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=v,s.addListener=v,s.once=v,s.off=v,s.removeListener=v,s.removeAllListeners=v,s.emit=v,s.prependListener=v,s.prependOnceListener=v,s.listeners=function(y){return[]},s.binding=function(y){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(y){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}}])});var Mre=Ue.exports.SEMVER_SPEC_VERSION,Ore=Ue.exports.parse,Fre=Ue.exports.valid,$re=Ue.exports.coerce,Hre=Ue.exports.clean,Ure=Ue.exports.inc,Wre=Ue.exports.major,Bre=Ue.exports.minor,Vre=Ue.exports.patch,zre=Ue.exports.prerelease,qre=Ue.exports.gt,jre=Ue.exports.gte,Gre=Ue.exports.lt,Qre=Ue.exports.lte,Jre=Ue.exports.eq,Kre=Ue.exports.neq,Xre=Ue.exports.cmp,Yre=Ue.exports.compare,Zre=Ue.exports.rcompare,ese=Ue.exports.compareIdentifiers,tse=Ue.exports.rcompareIdentifiers,ise=Ue.exports.compareBuild,rse=Ue.exports.sort,sse=Ue.exports.rsort,nse=Ue.exports.diff,ose=Ue.exports.validRange,ase=Ue.exports.satisfies,lse=Ue.exports.maxSatisfying,cse=Ue.exports.minSatisfying,use=Ue.exports.minVersion,dse=Ue.exports.gtr,hse=Ue.exports.ltr,fse=Ue.exports.outside,pse=Ue.exports.intersects,gse=Ue.exports.SemVer,mse=Ue.exports.Comparator,vse=Ue.exports.Range,dA=/^(\^|>=)?((\d+)|x)\.((\d+)|x)\.((\d+)|x)(\-.*)?$/,aq=/^-(\d{4})(\d{2})(\d{2})$/;function lq(e){return e=e.trim(),e==="*"||dA.test(e)}function hA(e){if(!lq(e))return null;if(e=e.trim(),e==="*")return{hasCaret:!1,hasGreaterEquals:!1,majorBase:0,majorMustEqual:!1,minorBase:0,minorMustEqual:!1,patchBase:0,patchMustEqual:!1,preRelease:null};const t=e.match(dA);return t?{hasCaret:t[1]==="^",hasGreaterEquals:t[1]===">=",majorBase:t[2]==="x"?0:parseInt(t[2],10),majorMustEqual:t[2]!=="x",minorBase:t[4]==="x"?0:parseInt(t[4],10),minorMustEqual:t[4]!=="x",patchBase:t[6]==="x"?0:parseInt(t[6],10),patchMustEqual:t[6]!=="x",preRelease:t[8]||null}:null}function fA(e){if(!e)return null;const t=e.majorBase,i=e.majorMustEqual,r=e.minorBase;let s=e.minorMustEqual;const n=e.patchBase;let o=e.patchMustEqual;e.hasCaret&&(t===0||(s=!1),o=!1);let a=0;if(e.preRelease){const l=aq.exec(e.preRelease);if(l){const[,c,u,d]=l;a=Date.UTC(Number(c),Number(u)-1,Number(d))}}return{majorBase:t,majorMustEqual:i,minorBase:r,minorMustEqual:s,patchBase:n,patchMustEqual:o,isMinimum:e.hasGreaterEquals,notBefore:a}}var cq=class{constructor(){this.buffers=[]}add(e){let t=this.buffers.indexOf(e);return t<0&&(t=this.buffers.length,this.buffers.push(e)),t}};function uq(e,t){if(t.serializeBuffersForPostMessage){const i=new cq,s=JSON.stringify(e,(o,a)=>{if(a instanceof ArrayBuffer)return{$$vscode_array_buffer_reference$$:!0,index:i.add(a)};if(ArrayBuffer.isView(a)){const l=dq(a);if(l)return{$$vscode_array_buffer_reference$$:!0,index:i.add(a.buffer),view:{type:l,byteLength:a.byteLength,byteOffset:a.byteOffset}}}return a}),n=i.buffers.map(o=>{const a=new Uint8Array(o);return z.wrap(a)});return{message:s,buffers:n}}else return{message:JSON.stringify(e),buffers:[]}}function dq(e){switch(e.constructor.name){case"Int8Array":return 1;case"Uint8Array":return 2;case"Uint8ClampedArray":return 3;case"Int16Array":return 4;case"Uint16Array":return 5;case"Int32Array":return 6;case"Uint32Array":return 7;case"Float32Array":return 8;case"Float64Array":return 9;case"BigInt64Array":return 10;case"BigUint64Array":return 11}}function hq(e,t){const i=t.map(n=>{const o=new ArrayBuffer(n.byteLength);return new Uint8Array(o).set(n.buffer),o}),r=t.length?(n,o)=>{if(o&&typeof o=="object"&&o.$$vscode_array_buffer_reference$$){const a=o,{index:l}=a,c=i[l];if(a.view)switch(a.view.type){case 1:return new Int8Array(c,a.view.byteOffset,a.view.byteLength/Int8Array.BYTES_PER_ELEMENT);case 2:return new Uint8Array(c,a.view.byteOffset,a.view.byteLength/Uint8Array.BYTES_PER_ELEMENT);case 3:return new Uint8ClampedArray(c,a.view.byteOffset,a.view.byteLength/Uint8ClampedArray.BYTES_PER_ELEMENT);case 4:return new Int16Array(c,a.view.byteOffset,a.view.byteLength/Int16Array.BYTES_PER_ELEMENT);case 5:return new Uint16Array(c,a.view.byteOffset,a.view.byteLength/Uint16Array.BYTES_PER_ELEMENT);case 6:return new Int32Array(c,a.view.byteOffset,a.view.byteLength/Int32Array.BYTES_PER_ELEMENT);case 7:return new Uint32Array(c,a.view.byteOffset,a.view.byteLength/Uint32Array.BYTES_PER_ELEMENT);case 8:return new Float32Array(c,a.view.byteOffset,a.view.byteLength/Float32Array.BYTES_PER_ELEMENT);case 9:return new Float64Array(c,a.view.byteOffset,a.view.byteLength/Float64Array.BYTES_PER_ELEMENT);case 10:return new BigInt64Array(c,a.view.byteOffset,a.view.byteLength/BigInt64Array.BYTES_PER_ELEMENT);case 11:return new BigUint64Array(c,a.view.byteOffset,a.view.byteLength/BigUint64Array.BYTES_PER_ELEMENT);default:throw new Error("Unknown array buffer view type")}return c}return o}:void 0;return{message:JSON.parse(e,r),arrayBuffers:i}}var fq=class{#e;#t;#i;#r;#n;#s;#a;#o;#l;#c;#u;#h;constructor(e,t,i,r,s,n,o){this.#a="",this.#l=!1,this.#c=!1,this._onMessageEmitter=new D,this.onDidReceiveMessage=this._onMessageEmitter.event,this.#d=new D,this._onDidDispose=this.#d.event,this.#e=e,this.#t=t,this.#o=i,this.#r=r,this.#n=s,this.#s=n,this.#u=jl(n),this.#h=pq(n),this.#i=o}#d;dispose(){this.#l=!0,this.#d.fire(),this.#d.dispose(),this._onMessageEmitter.dispose()}asWebviewUri(e){return this.#c=!0,wd(e,this.#r)}get cspSource(){const e=this.#s.extensionLocation;if(e.scheme===V.https||e.scheme===V.http){let t=e.toString();return t.endsWith("/")||(t+="/"),t+" "+lb}return lb}get html(){return this.assertNotDisposed(),this.#a}set html(e){this.assertNotDisposed(),this.#a!==e&&(this.#a=e,this.#h&&!this.#c&&/(["'])vscode-resource:([^\s'"]+?)(["'])/i.test(e)&&(this.#c=!0,this.#i.report("Webview vscode-resource: uris",this.#s,"Please migrate to use the 'webview.asWebviewUri' api instead: https://aka.ms/vscode-webview-use-aswebviewuri")),this.#t.$setHtml(this.#e,this.rewriteOldResourceUrlsIfNeeded(e)))}get options(){return this.assertNotDisposed(),this.#o}set options(e){this.assertNotDisposed(),Ei(this.#o,e)||this.#t.$setOptions(this.#e,pA(this.#s,this.#n,e)),this.#o=e}async postMessage(e){if(this.#l)return!1;const t=uq(e,{serializeBuffersForPostMessage:this.#u});return this.#t.$postMessage(this.#e,t.message,...t.buffers)}assertNotDisposed(){if(this.#l)throw new Error("Webview is disposed")}rewriteOldResourceUrlsIfNeeded(e){if(!this.#h)return e;const t=this.#s.extensionLocation?.scheme===V.vscodeRemote,i=this.#s.extensionLocation.scheme===V.vscodeRemote?this.#s.extensionLocation.authority:void 0;return e.replace(/(["'])(?:vscode-resource):(\/\/([^\s\/'"]+?)(?=\/))?([^\s'"]+?)(["'])/gi,(r,s,n,o,a,l)=>{const c=b.from({scheme:o||"file",path:decodeURIComponent(a)}),u=wd(c,{isRemote:t,authority:i}).toString();return`${s}${u}${l}`}).replace(/(["'])(?:vscode-webview-resource):(\/\/[^\s\/'"]+\/([^\s\/'"]+?)(?=\/))?([^\s'"]+?)(["'])/gi,(r,s,n,o,a,l)=>{const c=b.from({scheme:o||"file",path:decodeURIComponent(a)}),u=wd(c,{isRemote:t,authority:i}).toString();return`${s}${u}${l}`})}};function jl(e){try{const t=fA(hA(e.engines.vscode));return!!t&&t.majorBase>=1&&t.minorBase>=57}catch{return!1}}function pq(e){try{const t=fA(hA(e.engines.vscode));return t?t.majorBase<1||t.majorBase===1&&t.minorBase<60:!1}catch{return!1}}var gq=class extends X{constructor(e,t,i,r,s){super(),this.remoteInfo=t,this.workspace=i,this._logService=r,this._deprecationService=s,this._webviews=new Map,this._webviewProxy=e.getProxy(Q.MainThreadWebviews)}dispose(){super.dispose();for(const e of this._webviews.values())e.dispose();this._webviews.clear()}$onMessage(e,t,i){const r=this.getWebview(e);if(r){const{message:s}=hq(t,i.value);r._onMessageEmitter.fire(s)}}$onMissingCsp(e,t){this._logService.warn(`${t} created a webview without a content security policy: https://aka.ms/vscode-webview-missing-csp`)}createNewWebview(e,t,i){const r=new fq(e,this._webviewProxy,mq(t),this.remoteInfo,this.workspace,i,this._deprecationService);this._webviews.set(e,r);const s=r._onDidDispose(()=>{s.dispose(),this.deleteWebview(e)});return r}deleteWebview(e){this._webviews.delete(e)}getWebview(e){return this._webviews.get(e)}};function um(e){return{id:e.identifier,location:e.extensionLocation}}function pA(e,t,i){return{enableCommandUris:i.enableCommandUris,enableScripts:i.enableScripts,enableForms:i.enableForms,portMapping:i.portMapping,localResourceRoots:i.localResourceRoots||vq(e,t)}}function mq(e){return{enableCommandUris:e.enableCommandUris,enableScripts:e.enableScripts,enableForms:e.enableForms,portMapping:e.portMapping,localResourceRoots:e.localResourceRoots?.map(t=>b.from(t))}}function vq(e,t){return[...(t?.getWorkspaceFolders()||[]).map(i=>i.uri),e.extensionLocation]}var jr=class R8{static{this.enableDebugLogging=!1}constructor(t){this.id=t,this._data=new Map,this._idPool=1}add(t){const i=this._idPool++;return this._data.set(i,t),this.logDebugInfo(),i}get(t,i){return this._data.has(t)?this._data.get(t)[i]:void 0}delete(t){this._data.delete(t),this.logDebugInfo()}logDebugInfo(){R8.enableDebugLogging&&console.log(`${this.id} cache size - ${this._data.size}`)}},_q=class{constructor(e,t){this.document=e,this._storagePath=t,this._backupCounter=1,this._edits=new jr("custom documents")}addEdit(e){return this._edits.add([e])}async undo(e,t){await this.getEdit(e).undo(),t||this.disposeBackup()}async redo(e,t){await this.getEdit(e).redo(),t||this.disposeBackup()}disposeEdits(e){for(const t of e)this._edits.delete(t)}getNewBackupUri(){if(!this._storagePath)throw new Error("Backup requires a valid storage path");const e=Eq(this.document.uri)+this._backupCounter++;return Dt(this._storagePath,e)}updateBackup(e){this._backup?.delete(),this._backup=e}disposeBackup(){this._backup?.delete(),this._backup=void 0}getEdit(e){const t=this._edits.get(e,0);if(!t)throw new Error("No edit found");return t}},wq=class{constructor(){this._documents=new Map}get(e,t){return this._documents.get(this.key(e,t))}add(e,t,i){const r=this.key(e,t.uri);if(this._documents.has(r))throw new Error(`Document already exists for viewType:${e} resource:${t.uri}`);const s=new _q(t,i);return this._documents.set(r,s),s}delete(e,t){const i=this.key(e,t.uri);this._documents.delete(i)}key(e,t){return`${e}@@@${t}`}},gA;(function(e){e[e.Text=0]="Text",e[e.Custom=1]="Custom"})(gA||(gA={}));var yq=class{constructor(){this._providers=new Map}addTextProvider(e,t,i){return this.add(e,{type:0,extension:t,provider:i})}addCustomProvider(e,t,i){return this.add(e,{type:1,extension:t,provider:i})}get(e){return this._providers.get(e)}add(e,t){if(this._providers.has(e))throw new Error(`Provider for viewType:${e} already registered`);return this._providers.set(e,t),new Ie(()=>this._providers.delete(e))}},bq=class{constructor(e,t,i,r,s){this._extHostDocuments=t,this._extensionStoragePaths=i,this._extHostWebview=r,this._extHostWebviewPanels=s,this._editorProviders=new yq,this._documents=new wq,this._proxy=e.getProxy(Q.MainThreadCustomEditors)}registerCustomEditorProvider(e,t,i,r){const s=new oe;return Sq(i)?(s.add(this._editorProviders.addTextProvider(t,e,i)),this._proxy.$registerTextEditorProvider(um(e),t,r.webviewOptions||{},{supportsMove:!!i.moveCustomTextEditor},jl(e))):(s.add(this._editorProviders.addCustomProvider(t,e,i)),dm(i)&&s.add(i.onDidChangeCustomDocument(n=>{const o=this.getCustomDocumentEntry(t,n.document.uri);if(xq(n)){const a=o.addEdit(n);this._proxy.$onDidEdit(n.document.uri,t,a,n.label)}else this._proxy.$onContentChange(n.document.uri,t)})),this._proxy.$registerCustomEditorProvider(um(e),t,r.webviewOptions||{},!!r.supportsMultipleEditorsPerDocument,jl(e))),Ie.from(s,new Ie(()=>{this._proxy.$unregisterEditorProvider(t)}))}async $createCustomDocument(e,t,i,r,s){const n=this._editorProviders.get(t);if(!n)throw new Error(`No provider found for '${t}'`);if(n.type!==1)throw new Error(`Invalid provide type for '${t}'`);const o=b.revive(e),a=await n.provider.openCustomDocument(o,{backupId:i,untitledDocumentData:r?.buffer},s);let l;return dm(n.provider)&&this._extensionStoragePaths&&(l=this._extensionStoragePaths.workspaceValue(n.extension)??this._extensionStoragePaths.globalValue(n.extension)),this._documents.add(t,a,l),{editable:dm(n.provider)}}async $disposeCustomDocument(e,t){const i=this._editorProviders.get(t);if(!i)throw new Error(`No provider found for '${t}'`);if(i.type!==1)throw new Error(`Invalid provider type for '${t}'`);const r=b.revive(e),{document:s}=this.getCustomDocumentEntry(t,r);this._documents.delete(t,s),s.dispose()}async $resolveCustomEditor(e,t,i,r,s,n){const o=this._editorProviders.get(i);if(!o)throw new Error(`No provider found for '${i}'`);const a=jt.to(s),l=this._extHostWebview.createNewWebview(t,r.contentOptions,o.extension),c=this._extHostWebviewPanels.createNewWebviewPanel(t,i,r.title,a,r.options,l,r.active),u=b.revive(e);switch(o.type){case 1:{const{document:d}=this.getCustomDocumentEntry(i,u);return o.provider.resolveCustomEditor(d,c,n)}case 0:{const d=this._extHostDocuments.getDocument(u);return o.provider.resolveCustomTextEditor(d,c,n)}default:throw new Error("Unknown webview provider type")}}$disposeEdits(e,t,i){this.getCustomDocumentEntry(t,e).disposeEdits(i)}async $onMoveCustomEditor(e,t,i){const r=this._editorProviders.get(i);if(!r)throw new Error(`No provider found for '${i}'`);if(!r.provider.moveCustomTextEditor)throw new Error(`Provider does not implement move '${i}'`);const s=this._extHostWebviewPanels.getWebviewPanel(e);if(!s)throw new Error("No webview found");const n=b.revive(t),o=this._extHostDocuments.getDocument(n);await r.provider.moveCustomTextEditor(o,s,Be.None)}async $undo(e,t,i,r){return this.getCustomDocumentEntry(t,e).undo(i,r)}async $redo(e,t,i,r){return this.getCustomDocumentEntry(t,e).redo(i,r)}async $revert(e,t,i){const r=this.getCustomDocumentEntry(t,e);await this.getCustomEditorProvider(t).revertCustomDocument(r.document,i),r.disposeBackup()}async $onSave(e,t,i){const r=this.getCustomDocumentEntry(t,e);await this.getCustomEditorProvider(t).saveCustomDocument(r.document,i),r.disposeBackup()}async $onSaveAs(e,t,i,r){const s=this.getCustomDocumentEntry(t,e);return this.getCustomEditorProvider(t).saveCustomDocumentAs(s.document,b.revive(i),r)}async $backup(e,t,i){const r=this.getCustomDocumentEntry(t,e),n=await this.getCustomEditorProvider(t).backupCustomDocument(r.document,{destination:r.getNewBackupUri()},i);return r.updateBackup(n),n.id}getCustomDocumentEntry(e,t){const i=this._documents.get(e,b.revive(t));if(!i)throw new Error("No custom document found");return i}getCustomEditorProvider(e){const i=this._editorProviders.get(e)?.provider;if(!i||!dm(i))throw new Error("Custom document is not editable");return i}};function dm(e){return!!e.onDidChangeCustomDocument}function Sq(e){return typeof e.resolveCustomTextEditor=="function"}function xq(e){return typeof e.undo=="function"&&typeof e.redo=="function"}function Eq(e){const t=e.scheme===V.file||e.scheme===V.untitled?e.fsPath:e.toString();return Rs(t)+""}var sa,mA=class L8{#e;#t;#i;constructor(t,i,r,s,n,o,a,l){this._name=t,this._owner=i,this._maxDiagnosticsTotal=r,this._maxDiagnosticsPerFile=s,this._modelVersionIdProvider=n,this._isDisposed=!1,this._maxDiagnosticsTotal=Math.max(s,r),this.#i=new Vt(c=>o.getComparisonKey(c)),this.#e=a,this.#t=l}dispose(){this._isDisposed||(this.#t.fire([...this.#i.keys()]),this.#e?.$clear(this._owner),this.#i.clear(),this._isDisposed=!0)}get name(){return this._checkDisposed(),this._name}set(t,i){if(!t){this.clear();return}this._checkDisposed();let r=[];if(b.isUri(t)){if(!i){this.delete(t);return}this.#i.set(t,i.slice()),r=[t]}else if(Array.isArray(t)){r=[];let o;t=[...t].sort(L8._compareIndexedTuplesByUri);for(const a of t){const[l,c]=a;if((!o||l.toString()!==o.toString())&&(o&&this.#i.get(o).length===0&&this.#i.delete(o),o=l,r.push(l),this.#i.set(l,[])),c)this.#i.get(l)?.push(...c);else{const u=this.#i.get(l);u&&(u.length=0)}}}if(this.#t.fire(r),!this.#e)return;const s=[];let n=0;for(const o of r){let a=[];const l=this.#i.get(o);if(l)if(l.length>this._maxDiagnosticsPerFile){a=[];const c=[di.Error,di.Warning,di.Information,di.Hint];e:for(let u=0;u<4;u++)for(const d of l)if(d.severity===c[u]&&a.push({...yl.from(d),modelVersionId:this._modelVersionIdProvider(o)})===this._maxDiagnosticsPerFile)break e;a.push({severity:ki.Info,message:h(2924,null,l.length-this._maxDiagnosticsPerFile),startLineNumber:a[a.length-1].startLineNumber,startColumn:a[a.length-1].startColumn,endLineNumber:a[a.length-1].endLineNumber,endColumn:a[a.length-1].endColumn})}else a=l.map(c=>({...yl.from(c),modelVersionId:this._modelVersionIdProvider(o)}));if(s.push([o,a]),n+=a.length,n>this._maxDiagnosticsTotal)break}this.#e.$changeMany(this._owner,s)}delete(t){this._checkDisposed(),this.#t.fire([t]),this.#i.delete(t),this.#e?.$changeMany(this._owner,[[t,void 0]])}clear(){this._checkDisposed(),this.#t.fire([...this.#i.keys()]),this.#i.clear(),this.#e?.$clear(this._owner)}forEach(t,i){this._checkDisposed();for(const[r,s]of this)t.call(i,r,s,this)}*[Symbol.iterator](){this._checkDisposed();for(const t of this.#i.keys())yield[t,this.get(t)]}get(t){this._checkDisposed();const i=this.#i.get(t);return Array.isArray(i)?Object.freeze(i.slice(0)):[]}has(t){return this._checkDisposed(),Array.isArray(this.#i.get(t))}_checkDisposed(){if(this._isDisposed)throw new Error("illegal state - object is disposed")}static _compareIndexedTuplesByUri(t,i){return t[0].toString()<i[0].toString()?-1:t[0].toString()>i[0].toString()?1:0}},cb=class{static{sa=this}static{this._idPool=0}static{this._maxDiagnosticsPerFile=1e3}static{this._maxDiagnosticsTotal=1.1*this._maxDiagnosticsPerFile}static _mapper(t){const i=new Vt;for(const r of t)i.set(r,r);return{uris:Object.freeze(Array.from(i.values()))}}constructor(t,i,r,s){this._logService=i,this._fileSystemInfoService=r,this._extHostDocumentsAndEditors=s,this._collections=new Map,this._onDidChangeDiagnostics=new pL({merge:n=>n.flat(),delay:50}),this.onDidChangeDiagnostics=Fe.map(this._onDidChangeDiagnostics.event,sa._mapper),this._proxy=t.getProxy(Q.MainThreadDiagnostics)}createDiagnosticCollection(t,i){const{_collections:r,_proxy:s,_onDidChangeDiagnostics:n,_logService:o,_fileSystemInfoService:a,_extHostDocumentsAndEditors:l}=this,c=new class{$changeMany(f,p){s.$changeMany(f,p),o.trace("[DiagnosticCollection] change many (extension, owner, uris)",t.value,f,p.length===0?"CLEARING":p)}$clear(f){s.$clear(f),o.trace("[DiagnosticCollection] remove all (extension, owner)",t.value,f)}dispose(){s.dispose()}};let u;if(!i)i="_generated_diagnostic_collection_name_#"+sa._idPool++,u=i;else if(!r.has(i))u=i;else{this._logService.warn(`DiagnosticCollection with name '${i}' does already exist.`);do u=i+sa._idPool++;while(r.has(u))}return new class extends mA{constructor(){super(i,u,sa._maxDiagnosticsTotal,sa._maxDiagnosticsPerFile,f=>l.getDocument(f)?.version,a.extUri,c,n),r.set(u,this)}dispose(){super.dispose(),r.delete(u)}}}getDiagnostics(t){if(t)return this._getDiagnostics(t);{const i=new Map,r=[];for(const s of this._collections.values())s.forEach((n,o)=>{let a=i.get(n.toString());typeof a>"u"&&(a=r.length,i.set(n.toString(),a),r.push([n,[]])),r[a][1]=r[a][1].concat(...o)});return r}}_getDiagnostics(t){let i=[];for(const r of this._collections.values())r.has(t)&&(i=i.concat(r.get(t)));return i}$acceptMarkersChange(t){if(!this._mirrorCollection){const i="_generated_mirror",r=new mA(i,i,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,s=>{},this._fileSystemInfoService.extUri,void 0,this._onDidChangeDiagnostics);this._collections.set(i,r),this._mirrorCollection=r}for(const[i,r]of t)this._mirrorCollection.set(b.revive(i),r.map(yl.to))}};cb=sa=__decorate([__param(1,ke),__param(2,Ma)],cb);var Cq=class{constructor(e){this._proxy=e.getProxy(Q.MainThreadDialogs)}showOpenDialog(e){return this._proxy.$showOpenDialog(e).then(t=>t?t.map(i=>b.revive(i)):void 0)}showSaveDialog(e){return this._proxy.$showSaveDialog(e).then(t=>t?b.revive(t):void 0)}},Dq=class N8{static{this._handlePool=0}constructor(t,i,r){this._documentsAndEditors=i,this._logService=r,this._documentContentProviders=new Map,this._proxy=t.getProxy(Q.MainThreadDocumentContentProviders)}registerTextDocumentContentProvider(t,i){if(Object.keys(V).indexOf(t)>=0)throw new Error(`scheme '${t}' already registered`);const r=N8._handlePool++;this._documentContentProviders.set(r,i),this._proxy.$registerTextContentProvider(r,t);let s;if(typeof i.onDidChange=="function"){let n;s=i.onDidChange(async o=>{if(o.scheme!==t){this._logService.warn(`Provider for scheme '${t}' is firing event for schema '${o.scheme}' which will be IGNORED`);return}if(!this._documentsAndEditors.getDocument(o))return;n&&await n;const a=this.$provideTextDocumentContent(r,o).then(async l=>{if(!l&&typeof l!="string")return;const c=this._documentsAndEditors.getDocument(o);if(!c)return;const u=Wx(l);if(!c.equalLines(u))return this._proxy.$onVirtualDocumentChange(o,l)}).catch(pt).finally(()=>{n===a&&(n=void 0)});n=a})}return new Ie(()=>{this._documentContentProviders.delete(r)&&this._proxy.$unregisterTextContentProvider(r),s&&(s.dispose(),s=void 0)})}$provideTextDocumentContent(t,i){const r=this._documentContentProviders.get(t);return r?Promise.resolve(r.provideTextDocumentContent(b.revive(i),Be.None)):Promise.reject(new Error(`unsupported uri-scheme: ${i.scheme}`))}},kq=class{constructor(e,t,i,r={timeout:1500,errors:3}){this._logService=e,this._documents=t,this._mainThreadBulkEdits=i,this._thresholds=r,this._callbacks=new hn,this._badListeners=new WeakMap}dispose(){this._callbacks.clear()}getOnWillSaveTextDocumentEvent(e){return(t,i,r)=>{const n={dispose:this._callbacks.push([t,i,e])};return Array.isArray(r)&&r.push(n),n}}async $participateInSave(e,t){const i=b.revive(e);let r=!1;const s=setTimeout(()=>r=!0,this._thresholds.timeout),n=[];try{for(const o of[...this._callbacks]){if(r)break;const a=this._documents.getDocument(i),l=await this._deliverEventAsyncAndBlameBadListeners(o,{document:a,reason:Gp.to(t)});n.push(l)}}finally{clearTimeout(s)}return n}_deliverEventAsyncAndBlameBadListeners([e,t,i],r){const s=this._badListeners.get(e);return typeof s=="number"&&s>this._thresholds.errors?Promise.resolve(!1):this._deliverEventAsync(i,e,t,r).then(()=>!0,n=>{if(this._logService.error(`onWillSaveTextDocument-listener from extension '${i.identifier.value}' threw ERROR`),this._logService.error(n),!(n instanceof Error)||n.message!=="concurrent_edits"){const o=this._badListeners.get(e);this._badListeners.set(e,o?o+1:1),typeof o=="number"&&o>this._thresholds.errors&&this._logService.info(`onWillSaveTextDocument-listener from extension '${i.identifier.value}' will now be IGNORED because of timeouts and/or errors`)}return!1})}_deliverEventAsync(e,t,i,r){const s=[],n=Date.now(),{document:o,reason:a}=r,{version:l}=o,c=Object.freeze({document:o,reason:a,waitUntil(u){if(Object.isFrozen(s))throw dv("waitUntil can not be called async");s.push(Promise.resolve(u))}});try{t.apply(i,[c])}catch(u){return Promise.reject(u)}return Object.freeze(s),new Promise((u,d)=>{const f=setTimeout(()=>d(new Error("timeout")),this._thresholds.timeout);return Promise.all(s).then(p=>{this._logService.debug(`onWillSaveTextDocument-listener from extension '${e.identifier.value}' finished after ${Date.now()-n}ms`),clearTimeout(f),u(p)}).catch(p=>{clearTimeout(f),d(p)})}).then(u=>{const d={edits:[]};for(const f of u)if(Array.isArray(f)&&f.every(p=>p instanceof An))for(const{newText:p,newEol:g,range:v}of f)d.edits.push({resource:o.uri,versionId:void 0,textEdit:{range:v&&F.from(v),text:p,eol:g&&Cl.from(g)}});if(d.edits.length!==0)return l===o.version?this._mainThreadBulkEdits.$tryApplyWorkspaceEdit(new wi(d)):Promise.reject(new Error("concurrent_edits"))})}},Iq=class{constructor(e,t){this._onDidAddDocument=new D,this._onDidRemoveDocument=new D,this._onDidChangeDocument=new D,this._onDidSaveDocument=new D,this.onDidAddDocument=this._onDidAddDocument.event,this.onDidRemoveDocument=this._onDidRemoveDocument.event,this.onDidChangeDocument=this._onDidChangeDocument.event,this.onDidSaveDocument=this._onDidSaveDocument.event,this._toDispose=new oe,this._documentLoader=new Map,this._proxy=e.getProxy(Q.MainThreadDocuments),this._documentsAndEditors=t,this._documentsAndEditors.onDidRemoveDocuments(i=>{for(const r of i)this._onDidRemoveDocument.fire(r.document)},void 0,this._toDispose),this._documentsAndEditors.onDidAddDocuments(i=>{for(const r of i)this._onDidAddDocument.fire(r.document)},void 0,this._toDispose)}dispose(){this._toDispose.dispose()}getAllDocumentData(){return[...this._documentsAndEditors.allDocuments()]}getDocumentData(e){if(!e)return;const t=this._documentsAndEditors.getDocument(e);if(t)return t}getDocument(e){const t=this.getDocumentData(e);if(!t?.document)throw new Error(`Unable to retrieve document from URI '${e}'`);return t.document}ensureDocumentData(e,t){const i=this._documentsAndEditors.getDocument(e);if(i&&(!t?.encoding||i.document.encoding===t.encoding))return Promise.resolve(i);let r=this._documentLoader.get(e.toString());return r?t?.encoding&&(r=r.then(s=>s.document.encoding!==t.encoding?this.ensureDocumentData(e,t):s)):(r=this._proxy.$tryOpenDocument(e,t).then(s=>{this._documentLoader.delete(e.toString());const n=b.revive(s);return Sa(this._documentsAndEditors.getDocument(n))},s=>(this._documentLoader.delete(e.toString()),Promise.reject(s))),this._documentLoader.set(e.toString(),r)),r}createDocumentData(e){return this._proxy.$tryCreateDocument(e).then(t=>b.revive(t))}$acceptModelLanguageChanged(e,t){const i=b.revive(e),r=this._documentsAndEditors.getDocument(i);if(!r)throw new Error("unknown document");this._onDidRemoveDocument.fire(r.document),r._acceptLanguageId(t),this._onDidAddDocument.fire(r.document)}$acceptModelSaved(e){const t=b.revive(e),i=this._documentsAndEditors.getDocument(t);if(!i)throw new Error("unknown document");this.$acceptDirtyStateChanged(e,!1),this._onDidSaveDocument.fire(i.document)}$acceptDirtyStateChanged(e,t){const i=b.revive(e),r=this._documentsAndEditors.getDocument(i);if(!r)throw new Error("unknown document");r._acceptIsDirty(t),this._onDidChangeDocument.fire({document:r.document,contentChanges:[],reason:void 0})}$acceptEncodingChanged(e,t){const i=b.revive(e),r=this._documentsAndEditors.getDocument(i);if(!r)throw new Error("unknown document");r._acceptEncoding(t),this._onDidChangeDocument.fire({document:r.document,contentChanges:[],reason:void 0})}$acceptModelChanged(e,t,i){const r=b.revive(e),s=this._documentsAndEditors.getDocument(r);if(!s)throw new Error("unknown document");s._acceptIsDirty(i),s.onEvents(t);let n;t.isUndoing?n=hu.Undo:t.isRedoing&&(n=hu.Redo),this._onDidChangeDocument.fire(oC({document:s.document,contentChanges:t.changes.map(o=>({range:F.to(o.range),rangeOffset:o.rangeOffset,rangeLength:o.rangeLength,text:o.text})),reason:n}))}setWordDefinitionFor(e,t){bB(e,t)}},Pq=class{constructor(e){this._provider=new Map,this._onDidChange=new D,this.onDidChange=this._onDidChange.event,this._allKnownModels=new Set,this._handlePool=0,this._proxy=e.getProxy(Q.MainThreadEmbeddings)}registerEmbeddingsProvider(e,t,i){if(this._allKnownModels.has(t))throw new Error("An embeddings provider for this model is already registered");const r=this._handlePool++;return this._proxy.$registerEmbeddingProvider(r,t),this._provider.set(r,{id:t,provider:i}),ie(()=>{this._allKnownModels.delete(t),this._proxy.$unregisterEmbeddingProvider(r),this._provider.delete(r)})}async computeEmbeddings(e,t,i){i??=Be.None;let r=!1;typeof t=="string"&&(t=[t],r=!0);const s=await this._proxy.$computeEmbeddings(e,t,i);if(s.length!==t.length)throw new Error;if(r){if(s.length!==1)throw new Error;return s[0]}return s}async $provideEmbeddings(e,t,i){const r=this._provider.get(e);if(!r)return[];const s=await r.provider.provideEmbeddings(t,i);return s||[]}get embeddingsModels(){return Array.from(this._allKnownModels)}$acceptEmbeddingModels(e){this._allKnownModels=new Set(e),this._onDidChange.fire()}},Tq=class{constructor(e){this._AiEmbeddingVectorProviders=new Map,this._nextHandle=0,this._proxy=e.getProxy(Q.MainThreadAiEmbeddingVector)}async $provideAiEmbeddingVector(e,t,i){if(this._AiEmbeddingVectorProviders.size===0)throw new Error("No embedding vector providers registered");const r=this._AiEmbeddingVectorProviders.get(e);if(!r)throw new Error("Embedding vector provider not found");const s=await r.provideEmbeddingVector(t,i);if(!s)throw new Error("Embedding vector provider returned undefined");return s}registerEmbeddingVectorProvider(e,t,i){const r=this._nextHandle;return this._nextHandle++,this._AiEmbeddingVectorProviders.set(r,i),this._proxy.$registerAiEmbeddingVectorProvider(t,r),new Ie(()=>{this._proxy.$unregisterAiEmbeddingVectorProvider(r),this._AiEmbeddingVectorProviders.delete(r)})}},vA;(function(e){e[e.Invalid=0]="Invalid",e[e.Start=1]="Start",e[e.H=2]="H",e[e.HT=3]="HT",e[e.HTT=4]="HTT",e[e.HTTP=5]="HTTP",e[e.F=6]="F",e[e.FI=7]="FI",e[e.FIL=8]="FIL",e[e.BeforeColon=9]="BeforeColon",e[e.AfterColon=10]="AfterColon",e[e.AlmostThere=11]="AlmostThere",e[e.End=12]="End",e[e.Accept=13]="Accept",e[e.LastKnownState=14]="LastKnownState"})(vA||(vA={}));var Aq=class{constructor(e,t,i){const r=new Uint8Array(e*t);for(let s=0,n=e*t;s<n;s++)r[s]=i;this._data=r,this.rows=e,this.cols=t}get(e,t){return this._data[e*this.cols+t]}set(e,t,i){this._data[e*this.cols+t]=i}},_A=class{constructor(e){let t=0,i=0;for(let s=0,n=e.length;s<n;s++){const[o,a,l]=e[s];a>t&&(t=a),o>i&&(i=o),l>i&&(i=l)}t++,i++;const r=new Aq(i,t,0);for(let s=0,n=e.length;s<n;s++){const[o,a,l]=e[s];r.set(o,a,l)}this._states=r,this._maxCharCode=t}nextState(e,t){return t<0||t>=this._maxCharCode?0:this._states.get(e,t)}},ub=null;function Rq(){return ub===null&&(ub=new _A([[1,104,2],[1,72,2],[1,102,6],[1,70,6],[2,116,3],[2,84,3],[3,116,4],[3,84,4],[4,112,5],[4,80,5],[5,115,9],[5,83,9],[5,58,10],[6,105,7],[6,73,7],[7,108,8],[7,76,8],[8,101,9],[8,69,9],[9,58,10],[10,47,11],[11,47,12]])),ub}var wA;(function(e){e[e.None=0]="None",e[e.ForceTermination=1]="ForceTermination",e[e.CannotEndIn=2]="CannotEndIn"})(wA||(wA={}));var yd=null;function Lq(){if(yd===null){yd=new Y5(0);const e=` 	<>'"\u3001\u3002\uFF61\uFF64\uFF0C\uFF0E\uFF1A\uFF1B\u2018\u3008\u300C\u300E\u3014\uFF08\uFF3B\uFF5B\uFF62\uFF63\uFF5D\uFF3D\uFF09\u3015\u300F\u300D\u3009\u2019\uFF40\uFF5E\u2026`;for(let i=0;i<e.length;i++)yd.set(e.charCodeAt(i),1);const t=".,;:";for(let i=0;i<t.length;i++)yd.set(t.charCodeAt(i),2)}return yd}var Nq=class HS{static _createLink(t,i,r,s,n){let o=n-1;do{const a=i.charCodeAt(o);if(t.get(a)!==2)break;o--}while(o>s);if(s>0){const a=i.charCodeAt(s-1),l=i.charCodeAt(o);(a===40&&l===41||a===91&&l===93||a===123&&l===125)&&o--}return{range:{startLineNumber:r,startColumn:s+1,endLineNumber:r,endColumn:o+2},url:i.substring(s,o+1)}}static computeLinks(t,i=Rq()){const r=Lq(),s=[];for(let n=1,o=t.getLineCount();n<=o;n++){const a=t.getLineContent(n),l=a.length;let c=0,u=0,d=0,f=1,p=!1,g=!1,v=!1,y=!1;for(;c<l;){let S=!1;const x=a.charCodeAt(c);if(f===13){let P;switch(x){case 40:p=!0,P=0;break;case 41:P=p?0:1;break;case 91:v=!0,g=!0,P=0;break;case 93:v=!1,P=g?0:1;break;case 123:y=!0,P=0;break;case 125:P=y?0:1;break;case 39:case 34:case 96:d===x?P=1:d===39||d===34||d===96?P=0:P=1;break;case 42:P=d===42?1:0;break;case 124:P=d===124?1:0;break;case 32:P=v?0:1;break;default:P=r.get(x)}P===1&&(s.push(HS._createLink(r,a,n,u,c)),S=!0)}else if(f===12){let P;x===91?(g=!0,P=0):P=r.get(x),P===1?S=!0:f=13}else f=i.nextState(f,x),f===0&&(S=!0);S&&(f=1,p=!1,g=!1,y=!1,u=c+1,d=x),c++}f===13&&s.push(HS._createLink(r,a,n,u,l))}return s}},Mq=class{constructor(){this._schemes=[]}add(e){this._stateMachine=void 0,this._schemes.push(e)}delete(e){const t=this._schemes.indexOf(e);t>=0&&(this._schemes.splice(t,1),this._stateMachine=void 0)}_initStateMachine(){if(!this._stateMachine){const e=this._schemes.sort(),t=[];let i,r,s=14,n=14;for(const o of e){let a=i?JL(i,o):0;for(a===0?r=1:r=n;a<o.length;a++)a+1===o.length?(s=n,n=9):n+=1,t.push([r,o.toUpperCase().charCodeAt(a),n]),t.push([r,o.toLowerCase().charCodeAt(a),n]),r=n;i=o,n=s}t.push([9,58,10]),t.push([10,47,12]),this._stateMachine=new _A(t)}}provideDocumentLinks(e){this._initStateMachine();const t=[],i=Nq.computeLinks({getLineContent(r){return e.lineAt(r-1).text},getLineCount(){return e.lineCount}},this._stateMachine);for(const r of i){const s=Qo.to(r);s.target&&t.push(s)}return t}},Oq=class US{constructor(t,i){this._extHostLanguageFeatures=i,this._linkProvider=new Mq,this._fsProvider=new Map,this._registeredSchemes=new Set,this._watches=new Map,this._handlePool=0,this._proxy=t.getProxy(Q.MainThreadFileSystem)}dispose(){this._linkProviderRegistration?.dispose()}registerFileSystemProvider(t,i,r,s={}){if(US._validateFileSystemProvider(r),this._registeredSchemes.has(i))throw new Error(`a provider for the scheme '${i}' is already registered`);this._linkProviderRegistration||(this._linkProviderRegistration=this._extHostLanguageFeatures.registerDocumentLinkProvider(t,"*",this._linkProvider));const n=this._handlePool++;this._linkProvider.add(i),this._registeredSchemes.add(i),this._fsProvider.set(n,r);let o=2;s.isCaseSensitive&&(o+=1024),s.isReadonly&&(o+=2048),typeof r.copy=="function"&&(o+=8),typeof r.open=="function"&&typeof r.close=="function"&&typeof r.read=="function"&&typeof r.write=="function"&&(M(t,"fsChunks"),o+=4);let a;s.isReadonly&&Ns(s.isReadonly)&&s.isReadonly.value!==""&&(a={value:s.isReadonly.value,isTrusted:s.isReadonly.isTrusted,supportThemeIcons:s.isReadonly.supportThemeIcons,supportHtml:s.isReadonly.supportHtml,baseUri:s.isReadonly.baseUri,uris:s.isReadonly.uris}),this._proxy.$registerFileSystemProvider(n,i,o,a).catch(c=>{console.error(`FAILED to register filesystem provider of ${t.identifier.value}-extension for the scheme ${i}`),console.error(c)});const l=r.onDidChangeFile(c=>{const u=[];for(const d of c){const{uri:f,type:p}=d;if(f.scheme!==i)continue;let g;switch(p){case fl.Changed:g=0;break;case fl.Created:g=1;break;case fl.Deleted:g=2;break;default:throw new Error("Unknown FileChangeType")}u.push({resource:f,type:g})}this._proxy.$onFileSystemChange(n,u)});return ie(()=>{l.dispose(),this._linkProvider.delete(i),this._registeredSchemes.delete(i),this._fsProvider.delete(n),this._proxy.$unregisterProvider(n)})}static _validateFileSystemProvider(t){if(!t)throw new Error("MISSING provider");if(typeof t.watch!="function")throw new Error("Provider does NOT implement watch");if(typeof t.stat!="function")throw new Error("Provider does NOT implement stat");if(typeof t.readDirectory!="function")throw new Error("Provider does NOT implement readDirectory");if(typeof t.createDirectory!="function")throw new Error("Provider does NOT implement createDirectory");if(typeof t.readFile!="function")throw new Error("Provider does NOT implement readFile");if(typeof t.writeFile!="function")throw new Error("Provider does NOT implement writeFile");if(typeof t.delete!="function")throw new Error("Provider does NOT implement delete");if(typeof t.rename!="function")throw new Error("Provider does NOT implement rename")}static _asIStat(t){const{type:i,ctime:r,mtime:s,size:n,permissions:o}=t;return{type:i,ctime:r,mtime:s,size:n,permissions:o}}$stat(t,i){return Promise.resolve(this._getFsProvider(t).stat(b.revive(i))).then(r=>US._asIStat(r))}$readdir(t,i){return Promise.resolve(this._getFsProvider(t).readDirectory(b.revive(i)))}$readFile(t,i){return Promise.resolve(this._getFsProvider(t).readFile(b.revive(i))).then(r=>z.wrap(r))}$writeFile(t,i,r,s){return Promise.resolve(this._getFsProvider(t).writeFile(b.revive(i),r.buffer,s))}$delete(t,i,r){return Promise.resolve(this._getFsProvider(t).delete(b.revive(i),r))}$rename(t,i,r,s){return Promise.resolve(this._getFsProvider(t).rename(b.revive(i),b.revive(r),s))}$copy(t,i,r,s){const n=this._getFsProvider(t);if(!n.copy)throw new Error('FileSystemProvider does not implement "copy"');return Promise.resolve(n.copy(b.revive(i),b.revive(r),s))}$mkdir(t,i){return Promise.resolve(this._getFsProvider(t).createDirectory(b.revive(i)))}$watch(t,i,r,s){const n=this._getFsProvider(t).watch(b.revive(r),s);this._watches.set(i,n)}$unwatch(t,i){const r=this._watches.get(i);r&&(r.dispose(),this._watches.delete(i))}$open(t,i,r){const s=this._getFsProvider(t);if(!s.open)throw new Error('FileSystemProvider does not implement "open"');return Promise.resolve(s.open(b.revive(i),r))}$close(t,i){const r=this._getFsProvider(t);if(!r.close)throw new Error('FileSystemProvider does not implement "close"');return Promise.resolve(r.close(i))}$read(t,i,r,s){const n=this._getFsProvider(t);if(!n.read)throw new Error('FileSystemProvider does not implement "read"');const o=z.alloc(s);return Promise.resolve(n.read(i,r,o.buffer,0,s)).then(a=>o.slice(0,a))}$write(t,i,r,s){const n=this._getFsProvider(t);if(!n.write)throw new Error('FileSystemProvider does not implement "write"');return Promise.resolve(n.write(i,r,s.buffer,0,s.byteLength))}_getFsProvider(t){const i=this._fsProvider.get(t);if(!i){const r=new Error;throw r.name="ENOPRO",r.message="no provider",r}return i}};function yA(e){return typeof e.correlationId=="number"}function Fq(e){return e.recursive===!0}var bA=class M8 extends X{static{this.MAX_RESTARTS=5}constructor(t,i,r,s){super(),this.onFileChanges=t,this.onLogMessage=i,this.verboseLogging=r,this.options=s,this.watcherDisposables=this._register(new Kr),this.requests=void 0,this.restartCounter=0}init(){const t=new oe;this.watcherDisposables.value=t,this.watcher=this.createWatcher(t),this.watcher.setVerboseLogging(this.verboseLogging),t.add(this.watcher.onDidChangeFile(i=>this.onFileChanges(i))),t.add(this.watcher.onDidLogMessage(i=>this.onLogMessage(i))),t.add(this.watcher.onDidError(i=>this.onError(i.error,i.request)))}onError(t,i){this.canRestart(t,i)?this.restartCounter<M8.MAX_RESTARTS&&this.requests?(this.error(`restarting watcher after unexpected error: ${t}`),this.restart(this.requests)):this.error(`gave up attempting to restart watcher after unexpected error: ${t}`):this.error(t)}canRestart(t,i){return!(!this.options.restartOnError||i||t.indexOf("No space left on device")!==-1||t.indexOf("EMFILE")!==-1)}restart(t){this.restartCounter++,this.init(),this.watch(t)}async watch(t){this.requests=t,await this.watcher?.watch(t)}async setVerboseLogging(t){this.verboseLogging=t,await this.watcher?.setVerboseLogging(t)}error(t){this.onLogMessage({type:"error",message:`[File Watcher (${this.options.type})] ${t}`})}trace(t){this.onLogMessage({type:"trace",message:`[File Watcher (${this.options.type})] ${t}`})}dispose(){return this.watcher=void 0,super.dispose()}},$q=class extends bA{constructor(e,t,i){super(e,t,i,{type:"node.js",restartOnError:!1})}},Hq=class extends bA{constructor(e,t,i){super(e,t,i,{type:"universal",restartOnError:!0})}};function SA(e){return e.map(t=>({type:t.type,resource:b.revive(t.resource),cId:t.cId}))}function Uq(e){const t=new Wq;for(const i of e)t.processEvent(i);return t.coalesce()}function xA(e,t){return typeof t=="string"&&!t.startsWith(Co)&&!Dr(t)?{base:e,pattern:t}:t}function EA(e,t){const i=[];for(const r of t)i.push(Lr(xA(e,r)));return i}var Wq=class{constructor(){this.coalesced=new Set,this.mapPathToChange=new Map}toKey(e){return Ct?e.resource.fsPath:e.resource.fsPath.toLowerCase()}processEvent(e){const t=this.mapPathToChange.get(this.toKey(e));let i=!1;if(t){const r=t.type,s=e.type;t.resource.fsPath!==e.resource.fsPath&&(e.type===2||e.type===1)?i=!0:r===1&&s===2?(this.mapPathToChange.delete(this.toKey(e)),this.coalesced.delete(t)):r===2&&s===1?t.type=0:r===1&&s===0||(t.type=s)}else i=!0;i&&(this.coalesced.add(e),this.mapPathToChange.set(this.toKey(e),e))}coalesce(){const e=[],t=[];return Array.from(this.coalesced).filter(i=>i.type!==2?(e.push(i),!1):!0).sort((i,r)=>i.resource.fsPath.length-r.resource.fsPath.length).filter(i=>t.some(r=>lF(i.resource.fsPath,r,!Ct))?!1:(t.push(i.resource.fsPath),!0)).concat(e)}};function Bq(e,t){if(typeof t=="number")switch(e.type){case 1:return(t&4)===0;case 2:return(t&8)===0;case 0:return(t&2)===0}return!1}function Vq(e){if(typeof e=="number"){const t=[];return e&4&&t.push("Added"),e&8&&t.push("Deleted"),e&2&&t.push("Updated"),t.length===0?"<all>":`[${t.join(", ")}]`}return"<none>"}var zq=class{get ignoreCreateEvents(){return!!(this._config&1)}get ignoreChangeEvents(){return!!(this._config&2)}get ignoreDeleteEvents(){return!!(this._config&4)}constructor(e,t,i,r,s,n,o){this.session=Math.random(),this._onDidCreate=new D,this._onDidChange=new D,this._onDidDelete=new D,this._config=0,o.ignoreCreateEvents&&(this._config+=1),o.ignoreChangeEvents&&(this._config+=2),o.ignoreDeleteEvents&&(this._config+=4);const a=Lr(n),l=typeof n=="string",c=!1,u=s(d=>{if(!(typeof d.session=="number"&&d.session!==this.session)&&!(c&&typeof d.session>"u")){if(!o.ignoreCreateEvents)for(const f of d.created){const p=b.revive(f);a(p.fsPath)&&(!l||i.getWorkspaceFolder(p))&&this._onDidCreate.fire(p)}if(!o.ignoreChangeEvents)for(const f of d.changed){const p=b.revive(f);a(p.fsPath)&&(!l||i.getWorkspaceFolder(p))&&this._onDidChange.fire(p)}if(!o.ignoreDeleteEvents)for(const f of d.deleted){const p=b.revive(f);a(p.fsPath)&&(!l||i.getWorkspaceFolder(p))&&this._onDidDelete.fire(p)}}});this._disposable=Ie.from(this.ensureWatching(e,i,t,r,n,o,!1),this._onDidCreate,this._onDidChange,this._onDidDelete,u)}ensureWatching(e,t,i,r,s,n,o){const a=Ie.from();if(typeof s=="string"||n.ignoreChangeEvents&&n.ignoreCreateEvents&&n.ignoreDeleteEvents)return a;const l=e.getProxy(Q.MainThreadFileSystemEventService);let c=!1;(s.pattern.includes(Co)||s.pattern.includes(Z1))&&(c=!0);const u=[];let d,f;if(o)(n.ignoreChangeEvents||n.ignoreCreateEvents||n.ignoreDeleteEvents)&&(f=14,n.ignoreChangeEvents&&(f&=-3),n.ignoreCreateEvents&&(f&=-5),n.ignoreDeleteEvents&&(f&=-9));else if(c&&u.length===0){const p=t.getWorkspaceFolder(b.revive(s.baseUri)),g=i.getConfiguration("files",p).get("watcherExclude");if(g)for(const v in g)v&&g[v]===!0&&u.push(v)}else if(!c){const p=t.getWorkspaceFolder(b.revive(s.baseUri));if(p){const g=i.getConfiguration("files",p).get("watcherExclude");if(g){for(const v in g)if(v&&g[v]===!0){const y=`${vn(v,"/")}/${Co}`;d||(d=[]),d.push(xA(p.uri.fsPath,y))}}if(!d||d.length===0)return a}}return l.$watch(r.identifier.value,this.session,s.baseUri,{recursive:c,excludes:u,includes:d,filter:f},!!o),Ie.from({dispose:()=>l.$unwatch(this.session)})}dispose(){this._disposable.dispose()}get onDidCreate(){return this._onDidCreate.event}get onDidChange(){return this._onDidChange.event}get onDidDelete(){return this._onDidDelete.event}},qq=class{get created(){return this._created.value}get changed(){return this._changed.value}get deleted(){return this._deleted.value}constructor(e){this._events=e,this._created=new Si(()=>this._events.created.map(b.revive)),this._changed=new Si(()=>this._events.changed.map(b.revive)),this._deleted=new Si(()=>this._events.deleted.map(b.revive)),this.session=this._events.session}},jq=class{constructor(e,t,i){this._mainContext=e,this._logService=t,this._extHostDocumentsAndEditors=i,this._onFileSystemEvent=new D,this._onDidRenameFile=new D,this._onDidCreateFile=new D,this._onDidDeleteFile=new D,this._onWillRenameFile=new pc,this._onWillCreateFile=new pc,this._onWillDeleteFile=new pc,this.onDidRenameFile=this._onDidRenameFile.event,this.onDidCreateFile=this._onDidCreateFile.event,this.onDidDeleteFile=this._onDidDeleteFile.event}createFileSystemWatcher(e,t,i,r,s){return new zq(this._mainContext,t,e,i,this._onFileSystemEvent.event,Ji.from(r),s)}$onFileEvent(e){this._onFileSystemEvent.fire(new qq(e))}$onDidRunFileOperation(e,t){switch(e){case 2:this._onDidRenameFile.fire(Object.freeze({files:t.map(i=>({oldUri:b.revive(i.source),newUri:b.revive(i.target)}))}));break;case 1:this._onDidDeleteFile.fire(Object.freeze({files:t.map(i=>b.revive(i.target))}));break;case 0:case 3:this._onDidCreateFile.fire(Object.freeze({files:t.map(i=>b.revive(i.target))}));break;default:}}getOnWillRenameFileEvent(e){return this._createWillExecuteEvent(e,this._onWillRenameFile)}getOnWillCreateFileEvent(e){return this._createWillExecuteEvent(e,this._onWillCreateFile)}getOnWillDeleteFileEvent(e){return this._createWillExecuteEvent(e,this._onWillDeleteFile)}_createWillExecuteEvent(e,t){return(i,r,s)=>{const n=function(a){i.call(r,a)};return n.extension=e,t.event(n,void 0,s)}}async $onWillRunFileOperation(e,t,i,r){switch(e){case 2:return await this._fireWillEvent(this._onWillRenameFile,{files:t.map(s=>({oldUri:b.revive(s.source),newUri:b.revive(s.target)}))},i,r);case 1:return await this._fireWillEvent(this._onWillDeleteFile,{files:t.map(s=>b.revive(s.target))},i,r);case 0:case 3:return await this._fireWillEvent(this._onWillCreateFile,{files:t.map(s=>b.revive(s.target))},i,r)}}async _fireWillEvent(e,t,i,r){const s=new Set,n=[];if(await e.fireAsync(t,r,async(a,l)=>{const c=Date.now(),u=await Promise.resolve(a);u instanceof Ao&&(n.push([l.extension,u]),s.add(l.extension.displayName??l.extension.identifier.value)),Date.now()-c>i&&this._logService.warn("SLOW file-participant",l.extension.identifier)}),r.isCancellationRequested||n.length===0)return;const o={edits:[]};for(const[,a]of n){const{edits:l}=Qi.from(a,{getTextDocumentVersion:c=>this._extHostDocumentsAndEditors.getDocument(c)?.version,getNotebookDocumentVersion:()=>{}});o.edits=o.edits.concat(l)}return{edit:o,extensionNames:Array.from(s)}}},Gq=class{constructor(e,t,i,r,s){this._extHostNotebooks=t,this._textDocumentsAndEditors=i,this._commands=r;const n=new me("interactive.open","_interactive.open","Open interactive window and return notebook editor and input URI",[new U("showOptions","Show Options",o=>!0,o=>o),new U("resource","Interactive resource Uri",o=>!0,o=>o),new U("controllerId","Notebook controller Id",o=>!0,o=>o),new U("title","Interactive editor title",o=>!0,o=>o)],new ge("Notebook and input URI",o=>{if(s.debug("[ExtHostInteractive] open iw with notebook editor id",o.notebookEditorId),o.notebookEditorId!==void 0){const a=this._extHostNotebooks.getEditorById(o.notebookEditorId);return s.debug("[ExtHostInteractive] notebook editor found",a.id),{notebookUri:b.revive(o.notebookUri),inputUri:b.revive(o.inputUri),notebookEditor:a.apiEditor}}return s.debug("[ExtHostInteractive] notebook editor not found, uris for the interactive document",o.notebookUri,o.inputUri),{notebookUri:b.revive(o.notebookUri),inputUri:b.revive(o.inputUri)}}));this._commands.registerApiCommand(n)}$willAddInteractiveDocument(e,t,i,r){this._textDocumentsAndEditors.acceptDocumentsAndEditorsDelta({addedDocuments:[{EOL:t,lines:[""],languageId:i,uri:e,isDirty:!1,versionId:1,encoding:"utf8"}]})}$willRemoveInteractiveDocument(e,t){this._textDocumentsAndEditors.acceptDocumentsAndEditorsDelta({removedDocuments:[e]})}},Qq=class{constructor(e){this._handlePool=0,this._proxy=e.getProxy(Q.MainThreadLabelService)}$registerResourceLabelFormatter(e){const t=this._handlePool++;return this._proxy.$registerResourceLabelFormatter(t,e),ie(()=>{this._proxy.$unregisterResourceLabelFormatter(t)})}},CA;(function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"})(CA||(CA={}));var Jq=class Sr extends je{constructor(t,i,r,s){super(t,i,r,s),this.selectionStartLineNumber=t,this.selectionStartColumn=i,this.positionLineNumber=r,this.positionColumn=s}toString(){return"["+this.selectionStartLineNumber+","+this.selectionStartColumn+" -> "+this.positionLineNumber+","+this.positionColumn+"]"}equalsSelection(t){return Sr.selectionsEqual(this,t)}static selectionsEqual(t,i){return t.selectionStartLineNumber===i.selectionStartLineNumber&&t.selectionStartColumn===i.selectionStartColumn&&t.positionLineNumber===i.positionLineNumber&&t.positionColumn===i.positionColumn}getDirection(){return this.selectionStartLineNumber===this.startLineNumber&&this.selectionStartColumn===this.startColumn?0:1}setEndPosition(t,i){return this.getDirection()===0?new Sr(this.startLineNumber,this.startColumn,t,i):new Sr(t,i,this.startLineNumber,this.startColumn)}getPosition(){return new sr(this.positionLineNumber,this.positionColumn)}getSelectionStart(){return new sr(this.selectionStartLineNumber,this.selectionStartColumn)}setStartPosition(t,i){return this.getDirection()===0?new Sr(t,i,this.endLineNumber,this.endColumn):new Sr(this.endLineNumber,this.endColumn,t,i)}static fromPositions(t,i=t){return new Sr(t.lineNumber,t.column,i.lineNumber,i.column)}static fromRange(t,i){return i===0?new Sr(t.startLineNumber,t.startColumn,t.endLineNumber,t.endColumn):new Sr(t.endLineNumber,t.endColumn,t.startLineNumber,t.startColumn)}static liftSelection(t){return new Sr(t.selectionStartLineNumber,t.selectionStartColumn,t.positionLineNumber,t.positionColumn)}static selectionsArrEqual(t,i){if(t&&!i||!t&&i)return!1;if(!t&&!i)return!0;if(t.length!==i.length)return!1;for(let r=0,s=t.length;r<s;r++)if(!this.selectionsEqual(t[r],i[r]))return!1;return!0}static isISelection(t){return t&&typeof t.selectionStartLineNumber=="number"&&typeof t.selectionStartColumn=="number"&&typeof t.positionLineNumber=="number"&&typeof t.positionColumn=="number"}static createWithDirection(t,i,r,s,n){return n===0?new Sr(t,i,r,s):new Sr(r,s,t,i)}},DA=class O8{constructor(t,i){this._documents=t,this._provider=i}async provideDocumentSymbols(t,i){const r=this._documents.getDocument(t),s=await this._provider.provideDocumentSymbols(r,i);if(!fv(s))return s[0]instanceof ou?s.map(F0.from):O8._asDocumentSymbolTree(s)}static _asDocumentSymbolTree(t){t=t.slice(0).sort((s,n)=>{let o=s.location.range.start.compareTo(n.location.range.start);return o===0&&(o=n.location.range.end.compareTo(s.location.range.end)),o});const i=[],r=[];for(const s of t){const n={name:s.name||"!!MISSING: name!!",kind:mr.from(s.kind),tags:s.tags?.map(js.from)||[],detail:"",containerName:s.containerName,range:F.from(s.location.range),selectionRange:F.from(s.location.range),children:[]};for(;;){if(r.length===0){r.push(n),i.push(n);break}const o=r[r.length-1];if(je.containsRange(o.range,n.range)&&!je.equalsRange(o.range,n.range)){o.children?.push(n),r.push(n);break}r.pop()}}return i}},hm=class{constructor(e,t,i,r,s,n){this._documents=e,this._commands=t,this._provider=i,this._extension=r,this._extTelemetry=s,this._logService=n,this._cache=new jr("CodeLens"),this._disposables=new Map}async provideCodeLenses(e,t){const i=this._documents.getDocument(e),r=await this._provider.provideCodeLenses(i,t);if(!r||t.isCancellationRequested)return;const s=this._cache.add(r),n=new oe;this._disposables.set(s,n);const o={cacheId:s,lenses:[]};for(let a=0;a<r.length;a++){if(!Se.isRange(r[a].range)){console.warn("INVALID code lens, range is not defined",this._extension.identifier.value);continue}o.lenses.push({cacheId:[s,a],range:F.from(r[a].range),command:this._commands.toInternal(r[a].command,n)})}return o}async resolveCodeLens(e,t){const i=e.cacheId&&this._cache.get(...e.cacheId);if(!i)return;let r;if(typeof this._provider.resolveCodeLens!="function"||i.isResolved?r=i:r=await this._provider.resolveCodeLens(i,t),r||(r=i),t.isCancellationRequested)return;const s=e.cacheId&&this._disposables.get(e.cacheId[0]);if(s){if(!r.command){const n=new Error("INVALID code lens resolved, lacks command: "+this._extension.identifier.value);this._extTelemetry.onExtensionError(this._extension.identifier,n),this._logService.error(n);return}return e.command=this._commands.toInternal(r.command,s),e}}releaseCodeLenses(e){this._disposables.get(e)?.dispose(),this._disposables.delete(e),this._cache.delete(e)}};function fm(e){return Array.isArray(e)?e.map(Ou.from):e?[Ou.from(e)]:[]}var kA=class{constructor(e,t){this._documents=e,this._provider=t}async provideDefinition(e,t,i){const r=this._documents.getDocument(e),s=Qe.to(t),n=await this._provider.provideDefinition(r,s,i);return fm(n)}},IA=class{constructor(e,t){this._documents=e,this._provider=t}async provideDeclaration(e,t,i){const r=this._documents.getDocument(e),s=Qe.to(t),n=await this._provider.provideDeclaration(r,s,i);return fm(n)}},PA=class{constructor(e,t){this._documents=e,this._provider=t}async provideImplementation(e,t,i){const r=this._documents.getDocument(e),s=Qe.to(t),n=await this._provider.provideImplementation(r,s,i);return fm(n)}},TA=class{constructor(e,t){this._documents=e,this._provider=t}async provideTypeDefinition(e,t,i){const r=this._documents.getDocument(e),s=Qe.to(t),n=await this._provider.provideTypeDefinition(r,s,i);return fm(n)}},db=class F8{static{this.HOVER_MAP_MAX_SIZE=10}constructor(t,i){this._documents=t,this._provider=i,this._hoverCounter=0,this._hoverMap=new Map}async provideHover(t,i,r,s){const n=this._documents.getDocument(t),o=Qe.to(i);let a;if(r&&r.verbosityRequest){const d=r.verbosityRequest.previousHover.id,f=this._hoverMap.get(d);if(!f)throw new Error(`Hover with id ${d} not found`);const p={verbosityDelta:r.verbosityRequest.verbosityDelta,previousHover:f};a=await this._provider.provideHover(n,o,s,p)}else a=await this._provider.provideHover(n,o,s);if(!a||fv(a.contents))return;a.range||(a.range=n.getWordRangeAtPosition(o)),a.range||(a.range=new Se(o,o));const l=Fu.from(a),c=this._hoverCounter;if(this._hoverMap.size===F8.HOVER_MAP_MAX_SIZE){const d=Math.min(...this._hoverMap.keys());this._hoverMap.delete(d)}return this._hoverMap.set(c,a),this._hoverCounter+=1,{...l,id:c}}releaseHover(t){this._hoverMap.delete(t)}},AA=class{constructor(e,t){this._documents=e,this._provider=t}async provideEvaluatableExpression(e,t,i){const r=this._documents.getDocument(e),s=Qe.to(t),n=await this._provider.provideEvaluatableExpression(r,s,i);if(n)return U0.from(n)}},RA=class{constructor(e,t){this._documents=e,this._provider=t}async provideInlineValues(e,t,i,r){const s=this._documents.getDocument(e),n=await this._provider.provideInlineValues(s,F.to(t),Up.to(i),r);if(Array.isArray(n))return n.map(o=>Hp.from(o))}},LA=class{constructor(e,t){this._documents=e,this._provider=t}async provideDocumentHighlights(e,t,i){const r=this._documents.getDocument(e),s=Qe.to(t),n=await this._provider.provideDocumentHighlights(r,s,i);if(Array.isArray(n))return n.map(Sl.from)}},NA=class{constructor(e,t,i){this._documents=e,this._provider=t,this._logService=i}async provideMultiDocumentHighlights(e,t,i,r){const s=this._documents.getDocument(e),n=i.map(l=>{try{return this._documents.getDocument(l)}catch(c){this._logService.error("Error: Unable to retrieve document from URI: "+l+". Error message: "+c);return}}).filter(l=>l!==void 0),o=Qe.to(t),a=await this._provider.provideMultiDocumentHighlights(s,o,n,r);if(Array.isArray(a))return a.map(W0.from)}},MA=class{constructor(e,t){this._documents=e,this._provider=t}async provideLinkedEditingRanges(e,t,i){const r=this._documents.getDocument(e),s=Qe.to(t),n=await this._provider.provideLinkedEditingRanges(r,s,i);if(n&&Array.isArray(n.ranges))return{ranges:Et(n.ranges.map(F.from)),wordPattern:n.wordPattern}}},OA=class{constructor(e,t){this._documents=e,this._provider=t}async provideReferences(e,t,i,r){const s=this._documents.getDocument(e),n=Qe.to(t),o=await this._provider.provideReferences(s,n,i,r);if(Array.isArray(o))return o.map(Ai.from)}},pm=class ev{static{this._maxCodeActionsPerFile=1e3}constructor(t,i,r,s,n,o,a){this._documents=t,this._commands=i,this._diagnostics=r,this._provider=s,this._logService=n,this._extension=o,this._apiDeprecation=a,this._cache=new jr("CodeAction"),this._disposables=new Map}async provideCodeActions(t,i,r,s){const n=this._documents.getDocument(t),o=Jq.isISelection(i)?Ur.to(i):F.to(i),a=[];for(const p of this._diagnostics.getDiagnostics(t))if(o.intersection(p.range)&&a.push(p)>ev._maxCodeActionsPerFile)break;const l={diagnostics:a,only:r.only?new wt(r.only):void 0,triggerKind:iw.to(r.trigger)},c=await this._provider.provideCodeActions(n,o,l,s);if(!ya(c)||s.isCancellationRequested)return;const u=this._cache.add(c),d=new oe;this._disposables.set(u,d);const f=[];for(let p=0;p<c.length;p++){const g=c[p];if(g)if(ev._isCommand(g)&&!(g instanceof lu))this._apiDeprecation.report("CodeActionProvider.provideCodeActions - return commands",this._extension,"Return 'CodeAction' instances instead."),f.push({_isSynthetic:!0,title:g.title,command:this._commands.toInternal(g,d)});else{const v=g;l.only&&(v.kind?l.only.contains(v.kind)||this._logService.warn(`${this._extension.identifier.value} - Code actions of kind '${l.only.value}' requested but returned code action is of kind '${v.kind.value}'. Code action will be dropped. Please check 'CodeActionContext.only' to only return requested code actions.`):this._logService.warn(`${this._extension.identifier.value} - Code actions of kind '${l.only.value}' requested but returned code action does not have a 'kind'. Code action will be dropped. Please set 'CodeAction.kind'.`));const y=v.ranges??[];f.push({cacheId:[u,p],title:v.title,command:v.command&&this._commands.toInternal(v.command,d),diagnostics:v.diagnostics&&v.diagnostics.map(yl.from),edit:v.edit&&Qi.from(v.edit,void 0),kind:v.kind&&v.kind.value,isPreferred:v.isPreferred,isAI:nt(this._extension,"codeActionAI")?v.isAI:!1,ranges:nt(this._extension,"codeActionRanges")?Et(y.map(F.from)):void 0,disabled:v.disabled?.reason})}}return{cacheId:u,actions:f}}async resolveCodeAction(t,i){const[r,s]=t,n=this._cache.get(r,s);if(!n||ev._isCommand(n))return{};if(!this._provider.resolveCodeAction)return{};const o=await this._provider.resolveCodeAction(n,i)??n;let a;o.edit&&(a=Qi.from(o.edit,void 0));let l;if(o.command){const c=this._disposables.get(r);c&&(l=this._commands.toInternal(o.command,c))}return{edit:a,command:l}}releaseCodeActions(t){this._disposables.get(t)?.dispose(),this._disposables.delete(t),this._cache.delete(t)}static _isCommand(t){return typeof t.command=="string"&&typeof t.title=="string"}},bd=class{constructor(e,t,i,r,s){this._proxy=e,this._documents=t,this._provider=i,this._handle=r,this._extension=s,this._editsCache=new jr("DocumentPasteEdit.edits")}async prepareDocumentPaste(e,t,i,r){if(!this._provider.prepareDocumentPaste)return;this._cachedPrepare=void 0;const s=this._documents.getDocument(e),n=t.map(u=>F.to(u)),o=Al.toDataTransfer(i,()=>{throw new RR});if(await this._provider.prepareDocumentPaste(s,n,o,r),r.isCancellationRequested)return;const a=Array.from(o).filter(([,u])=>!(u instanceof ip)),l=new Map,c=await Promise.all(Array.from(a,async([u,d])=>{const f=mt();return l.set(f,d),[u,await Ko.from(u,d,f)]}));return this._cachedPrepare=l,{items:c}}async providePasteEdits(e,t,i,r,s,n){if(!this._provider.provideDocumentPasteEdits)return[];const o=this._documents.getDocument(t),a=i.map(f=>F.to(f)),l=r.items.map(([f,p])=>{const g=this._cachedPrepare?.get(p.id);return g?[f,g]:[f,Ko.to(f,p,async v=>(await this._proxy.$resolvePasteFileData(this._handle,e,v)).buffer)]}),c=new al(l),u=await this._provider.provideDocumentPasteEdits(o,a,c,{only:s.only?new Nn(s.only):void 0,triggerKind:s.triggerKind},n);if(!u||n.isCancellationRequested)return[];const d=this._editsCache.add(u);return u.map((f,p)=>({_cacheId:[d,p],title:f.title??h(2927,null,this._extension.displayName||this._extension.name),kind:f.kind,yieldTo:f.yieldTo?.map(g=>g.value),insertText:typeof f.insertText=="string"?f.insertText:{snippet:f.insertText.value},additionalEdit:f.additionalEdit?Qi.from(f.additionalEdit,void 0):void 0}))}async resolvePasteEdit(e,t){const[i,r]=e,s=this._editsCache.get(i,r);if(!s||!this._provider.resolveDocumentPasteEdit)return{};const n=await this._provider.resolveDocumentPasteEdit(s,t)??s;return{insertText:n.insertText,additionalEdit:n.additionalEdit?Qi.from(n.additionalEdit,void 0):void 0}}releasePasteEdits(e){this._editsCache.delete(e)}},FA=class{constructor(e,t){this._documents=e,this._provider=t}async provideDocumentFormattingEdits(e,t,i){const r=this._documents.getDocument(e),s=await this._provider.provideDocumentFormattingEdits(r,t,i);if(Array.isArray(s))return s.map(Gt.from)}},hb=class{constructor(e,t){this._documents=e,this._provider=t}async provideDocumentRangeFormattingEdits(e,t,i,r){const s=this._documents.getDocument(e),n=F.to(t),o=await this._provider.provideDocumentRangeFormattingEdits(s,n,i,r);if(Array.isArray(o))return o.map(Gt.from)}async provideDocumentRangesFormattingEdits(e,t,i,r){vv(typeof this._provider.provideDocumentRangesFormattingEdits=="function","INVALID invocation of `provideDocumentRangesFormattingEdits`");const s=this._documents.getDocument(e),n=t.map(F.to),o=await this._provider.provideDocumentRangesFormattingEdits(s,n,i,r);if(Array.isArray(o))return o.map(Gt.from)}},$A=class{constructor(e,t){this._documents=e,this._provider=t,this.autoFormatTriggerCharacters=[]}async provideOnTypeFormattingEdits(e,t,i,r,s){const n=this._documents.getDocument(e),o=Qe.to(t),a=await this._provider.provideOnTypeFormattingEdits(n,o,i,r,s);if(Array.isArray(a))return a.map(Gt.from)}},gm=class{constructor(e,t){this._provider=e,this._logService=t,this._cache=new jr("WorkspaceSymbols")}async provideWorkspaceSymbols(e,t){const i=await this._provider.provideWorkspaceSymbols(e,t);if(!ya(i))return{symbols:[]};const r=this._cache.add(i),s={cacheId:r,symbols:[]};for(let n=0;n<i.length;n++){const o=i[n];if(!o||!o.name){this._logService.warn("INVALID SymbolInformation",o);continue}s.symbols.push({...jo.from(o),cacheId:[r,n]})}return s}async resolveWorkspaceSymbol(e,t){if(typeof this._provider.resolveWorkspaceSymbol!="function"||!e.cacheId)return e;const i=this._cache.get(...e.cacheId);if(i){const r=await this._provider.resolveWorkspaceSymbol(i,t);return r&&Is(e,jo.from(r),!0)}}releaseWorkspaceSymbols(e){this._cache.delete(e)}},mm=class WS{static supportsResolving(t){return typeof t.prepareRename=="function"}constructor(t,i,r){this._documents=t,this._provider=i,this._logService=r}async provideRenameEdits(t,i,r,s){const n=this._documents.getDocument(t),o=Qe.to(i);try{const a=await this._provider.provideRenameEdits(n,o,r,s);return a?Qi.from(a):void 0}catch(a){const l=WS._asMessage(a);return l?{rejectReason:l,edits:void 0}:Promise.reject(a)}}async resolveRenameLocation(t,i,r){if(typeof this._provider.prepareRename!="function")return Promise.resolve(void 0);const s=this._documents.getDocument(t),n=Qe.to(i);try{const o=await this._provider.prepareRename(s,n,r);let a,l;if(Se.isRange(o)?(a=o,l=s.getText(o)):It(o)&&(a=o.range,l=o.placeholder),!a||!l)return;if(a.start.line>n.line||a.end.line<n.line){this._logService.warn("INVALID rename location: position line must be within range start/end lines");return}return{range:F.from(a),text:l}}catch(o){const a=WS._asMessage(o);return a?{rejectReason:a,range:void 0,text:void 0}:Promise.reject(o)}}static _asMessage(t){return typeof t=="string"?t:t instanceof Error&&typeof t.message=="string"?t.message:void 0}},fb=class BS{static{this.languageTriggerKindToVSCodeTriggerKind={[Kh.Invoke]:wu.Invoke,[Kh.Automatic]:wu.Automatic}}constructor(t,i,r){this._documents=t,this._provider=i,this._logService=r}async supportsAutomaticNewSymbolNamesTriggerKind(){return this._provider.supportsAutomaticTriggerKind}async provideNewSymbolNames(t,i,r,s){const n=this._documents.getDocument(t),o=F.to(i);try{const a=BS.languageTriggerKindToVSCodeTriggerKind[r],l=await this._provider.provideNewSymbolNames(n,o,a,s);return l?l.map(c=>typeof c=="string"?{newSymbolName:c}:{newSymbolName:c.newSymbolName,tags:c.tags}):void 0}catch(a){this._logService.error(BS._asMessage(a)??JSON.stringify(a,null,"	"));return}}static _asMessage(t){return typeof t=="string"?t:t instanceof Error&&typeof t.message=="string"?t.message:void 0}},pb=class{constructor(e,t){this.resultId=e,this.tokens=t}},gb=class Qr{constructor(t,i){this._documents=t,this._provider=i,this._nextResultId=1,this._previousResults=new Map}async provideDocumentSemanticTokens(t,i,r){const s=this._documents.getDocument(t),n=i!==0?this._previousResults.get(i):null;let o=typeof n?.resultId=="string"&&typeof this._provider.provideDocumentSemanticTokensEdits=="function"?await this._provider.provideDocumentSemanticTokensEdits(s,n.resultId,r):await this._provider.provideDocumentSemanticTokens(s,r);return n&&this._previousResults.delete(i),o?(o=Qr._fixProvidedSemanticTokens(o),this._send(Qr._convertToEdits(n,o),o)):null}async releaseDocumentSemanticColoring(t){this._previousResults.delete(t)}static _fixProvidedSemanticTokens(t){return Qr._isSemanticTokens(t)?Qr._isCorrectSemanticTokens(t)?t:new pl(new Uint32Array(t.data),t.resultId):Qr._isSemanticTokensEdits(t)?Qr._isCorrectSemanticTokensEdits(t)?t:new lp(t.edits.map(i=>new S4(i.start,i.deleteCount,i.data?new Uint32Array(i.data):i.data)),t.resultId):t}static _isSemanticTokens(t){return t&&!!t.data}static _isCorrectSemanticTokens(t){return t.data instanceof Uint32Array}static _isSemanticTokensEdits(t){return t&&Array.isArray(t.edits)}static _isCorrectSemanticTokensEdits(t){for(const i of t.edits)if(!(i.data instanceof Uint32Array))return!1;return!0}static _convertToEdits(t,i){if(!Qr._isSemanticTokens(i)||!t||!t.tokens)return i;const r=t.tokens,s=r.length,n=i.data,o=n.length;let a=0;const l=Math.min(s,o);for(;a<l&&r[a]===n[a];)a++;if(a===s&&a===o)return new lp([],i.resultId);let c=0;const u=l-a;for(;c<u&&r[s-c-1]===n[o-c-1];)c++;return new lp([{start:a,deleteCount:s-a-c,data:n.subarray(a,o-c)}],i.resultId)}_send(t,i){if(Qr._isSemanticTokens(t)){const r=this._nextResultId++;return this._previousResults.set(r,new pb(t.resultId,t.data)),ob({id:r,type:"full",data:t.data})}if(Qr._isSemanticTokensEdits(t)){const r=this._nextResultId++;return Qr._isSemanticTokens(i)?this._previousResults.set(r,new pb(i.resultId,i.data)):this._previousResults.set(r,new pb(t.resultId)),ob({id:r,type:"delta",deltas:(t.edits||[]).map(s=>({start:s.start,deleteCount:s.deleteCount,data:s.data}))})}return null}},HA=class{constructor(e,t){this._documents=e,this._provider=t}async provideDocumentRangeSemanticTokens(e,t,i){const r=this._documents.getDocument(e),s=await this._provider.provideDocumentRangeSemanticTokens(r,F.to(t),i);return s?this._send(s):null}_send(e){return ob({id:0,type:"full",data:e.data})}},Sd=class $8{static supportsResolving(t){return typeof t.resolveCompletionItem=="function"}constructor(t,i,r,s,n){this._documents=t,this._commands=i,this._provider=r,this._apiDeprecation=s,this._extension=n,this._cache=new jr("CompletionItem"),this._disposables=new Map}async provideCompletionItems(t,i,r,s){const n=this._documents.getDocument(t),o=Qe.to(i),a=n.getWordRangeAtPosition(o)||new Se(o,o),l=a.with({end:o}),c=new Hi,u=await this._provider.provideCompletionItems(n,o,s,V0.to(r));if(!u||s.isCancellationRequested)return;const d=Array.isArray(u)?new Za(u):u,f=$8.supportsResolving(this._provider)?this._cache.add(d.items):this._cache.add([]),p=new oe;this._disposables.set(f,p);const g=[],v={x:f,b:g,a:{replace:F.from(a),insert:F.from(l)},c:d.isIncomplete||void 0,d:c.elapsed()};for(let y=0;y<d.items.length;y++){const S=d.items[y],x=this._convertCompletionItem(S,[f,y],l,a);g.push(x)}return v}async resolveCompletionItem(t,i){if(typeof this._provider.resolveCompletionItem!="function")return;const r=this._cache.get(...t);if(!r)return;const s=this._convertCompletionItem(r,t),n=await this._provider.resolveCompletionItem(r,i);if(!n)return;const o=this._convertCompletionItem(n,t);return(s.h!==o.h||s.i!==o.i)&&this._apiDeprecation.report("CompletionItem.insertText",this._extension,"extension MAY NOT change 'insertText' of a CompletionItem during resolve"),(s.n!==o.n||s.o!==o.o||!Ei(s.p,o.p))&&this._apiDeprecation.report("CompletionItem.command",this._extension,"extension MAY NOT change 'command' of a CompletionItem during resolve"),{...s,d:o.d,c:o.c,l:o.l,h:o.h,i:o.i,n:o.n,o:o.o,p:o.p}}releaseCompletionItems(t){this._disposables.get(t)?.dispose(),this._disposables.delete(t),this._cache.delete(t)}_convertCompletionItem(t,i,r,s){const n=this._disposables.get(i[0]);if(!n)throw Error("DisposableStore is missing...");const o=this._commands.toInternal(t.command,n),a={x:i,a:t.label,b:t.kind!==void 0?Bp.from(t.kind):void 0,m:t.tags&&t.tags.map(Wp.from),c:t.detail,d:typeof t.documentation>"u"?void 0:ve.fromStrict(t.documentation),e:t.sortText!==t.label?t.sortText:void 0,f:t.filterText!==t.label?t.filterText:void 0,g:t.preselect||void 0,i:t.keepWhitespace?1:0,k:t.commitCharacters?.join(""),l:t.additionalTextEdits&&t.additionalTextEdits.map(Gt.from),n:o?.$ident,o:o?.id,p:o?.$ident?void 0:o?.arguments};t.textEdit?(this._apiDeprecation.report("CompletionItem.textEdit",this._extension,"Use 'CompletionItem.insertText' and 'CompletionItem.range' instead."),a.h=t.textEdit.newText):typeof t.insertText=="string"?a.h=t.insertText:t.insertText instanceof Ro&&(a.h=t.insertText.value,a.i|=4);let l;return t.textEdit?l=t.textEdit.range:t.range&&(l=t.range),Se.isRange(l)?a.j=F.from(l):l&&(!r?.isEqual(l.inserting)||!s?.isEqual(l.replacing))&&(a.j={insert:F.from(l.inserting),replace:F.from(l.replacing)}),a}},Gn=class{constructor(e,t,i,r){this._extension=e,this._documents=t,this._provider=i,this._commands=r,this._references=new UA,this._isAdditionsProposedApiEnabled=nt(this._extension,"inlineCompletionsAdditions"),this.languageTriggerKindToVSCodeTriggerKind={[Qh.Automatic]:_u.Automatic,[Qh.Explicit]:_u.Invoke}}get supportsHandleEvents(){return nt(this._extension,"inlineCompletionsAdditions")&&(typeof this._provider.handleDidShowCompletionItem=="function"||typeof this._provider.handleDidPartiallyAcceptCompletionItem=="function"||typeof this._provider.handleDidRejectCompletionItem=="function"||typeof this._provider.handleEndOfLifetime=="function")}async provideInlineCompletions(e,t,i,r){const s=this._documents.getDocument(e),n=Qe.to(t),o=await this._provider.provideInlineCompletionItems(s,n,{selectedCompletionInfo:i.selectedSuggestionInfo?{range:F.to(i.selectedSuggestionInfo.range),text:i.selectedSuggestionInfo.text}:void 0,triggerKind:this.languageTriggerKindToVSCodeTriggerKind[i.triggerKind],requestUuid:i.requestUuid},r);if(!o||r.isCancellationRequested)return;const a=Array.isArray(o)?o:o.items,l=this._isAdditionsProposedApiEnabled?Array.isArray(o)?[]:o.commands||[]:[],c=this._isAdditionsProposedApiEnabled&&!Array.isArray(o)?o.enableForwardStability:void 0;let u;return{pid:this._references.createReferenceId({dispose(){u?.dispose()},items:a}),items:a.map((f,p)=>{let g;f.command&&(u||(u=new oe),g=this._commands.toInternal(f.command,u));let v;f.action&&(u||(u=new oe),v=this._commands.toInternal(f.action,u));const y=f.insertText;return{insertText:typeof y=="string"?y:{snippet:y.value},filterText:f.filterText,range:f.range?F.from(f.range):void 0,showRange:this._isAdditionsProposedApiEnabled&&f.showRange?F.from(f.showRange):void 0,command:g,action:v,idx:p,completeBracketPairs:this._isAdditionsProposedApiEnabled?f.completeBracketPairs:!1,isInlineEdit:this._isAdditionsProposedApiEnabled?f.isInlineEdit:!1,showInlineEditMenu:this._isAdditionsProposedApiEnabled?f.showInlineEditMenu:!1,displayLocation:f.displayLocation&&this._isAdditionsProposedApiEnabled?{range:F.from(f.displayLocation.range),label:f.displayLocation.label}:void 0,warning:f.warning&&this._isAdditionsProposedApiEnabled?{message:ve.from(f.warning.message),icon:f.warning.icon?gw.fromThemeIcon(f.warning.icon):void 0}:void 0}}),commands:l.map(f=>(u||(u=new oe),this._commands.toInternal(f,u))),suppressSuggestions:!1,enableForwardStability:c}}async provideInlineEditsForRange(e,t,i,r){if(!this._provider.provideInlineEditsForRange)return;M(this._extension,"inlineCompletionsAdditions");const s=this._documents.getDocument(e),n=F.to(t),o=await this._provider.provideInlineEditsForRange(s,n,{selectedCompletionInfo:i.selectedSuggestionInfo?{range:F.to(i.selectedSuggestionInfo.range),text:i.selectedSuggestionInfo.text}:void 0,triggerKind:this.languageTriggerKindToVSCodeTriggerKind[i.triggerKind],userPrompt:i.userPrompt,requestUuid:i.requestUuid},r);if(!o||r.isCancellationRequested)return;const a=Array.isArray(o)?o:o.items,l=this._isAdditionsProposedApiEnabled?Array.isArray(o)?[]:o.commands||[]:[],c=this._isAdditionsProposedApiEnabled&&!Array.isArray(o)?o.enableForwardStability:void 0;let u;return{pid:this._references.createReferenceId({dispose(){u?.dispose()},items:a}),items:a.map((f,p)=>{let g;f.command&&(u||(u=new oe),g=this._commands.toInternal(f.command,u));let v;f.action&&(u||(u=new oe),v=this._commands.toInternal(f.action,u));const y=f.insertText;return{insertText:typeof y=="string"?y:{snippet:y.value},filterText:f.filterText,range:f.range?F.from(f.range):void 0,command:g,action:v,idx:p,completeBracketPairs:this._isAdditionsProposedApiEnabled?f.completeBracketPairs:!1}}),commands:l.map(f=>(u||(u=new oe),this._commands.toInternal(f,u))),suppressSuggestions:!1,enableForwardStability:c}}disposeCompletions(e){this._references.disposeReferenceId(e)?.dispose()}handleDidShowCompletionItem(e,t,i){const r=this._references.get(e)?.items[t];r&&this._provider.handleDidShowCompletionItem&&this._isAdditionsProposedApiEnabled&&this._provider.handleDidShowCompletionItem(r,i)}handlePartialAccept(e,t,i,r){const s=this._references.get(e)?.items[t];s&&this._provider.handleDidPartiallyAcceptCompletionItem&&this._isAdditionsProposedApiEnabled&&(this._provider.handleDidPartiallyAcceptCompletionItem(s,i),this._provider.handleDidPartiallyAcceptCompletionItem(s,dw.to(r)))}handleEndOfLifetime(e,t,i){const r=this._references.get(e)?.items[t];if(r&&this._provider.handleEndOfLifetime&&this._isAdditionsProposedApiEnabled){const s=fw.to(i,n=>this._references.get(n.pid)?.items[n.idx]);this._provider.handleEndOfLifetime(r,s)}}handleRejection(e,t){const i=this._references.get(e)?.items[t];i&&this._provider.handleDidRejectCompletionItem&&this._isAdditionsProposedApiEnabled&&this._provider.handleDidRejectCompletionItem(i)}},mb=class{async provideInlineEdits(e,t,i){const r=this._documents.getDocument(e),s=await this._provider.provideInlineEdit(r,{triggerKind:this.languageTriggerKindToVSCodeTriggerKind[t.triggerKind],requestUuid:t.requestUuid},i);if(!s||i.isCancellationRequested)return;let n;const o=this._references.createReferenceId({dispose(){n?.dispose()},item:s});let a;s.accepted&&(n||(n=new oe),a=this._commands.toInternal(s.accepted,n));let l;s.rejected&&(n||(n=new oe),l=this._commands.toInternal(s.rejected,n));let c;s.shown&&(n||(n=new oe),c=this._commands.toInternal(s.shown,n));let u;return s.action&&(n||(n=new oe),u=this._commands.toInternal(s.action,n)),n||(n=new oe),{pid:o,text:s.text,range:F.from(s.range),showRange:F.from(s.showRange),accepted:a,rejected:l,shown:c,action:u,commands:s.commands?.map(f=>this._commands.toInternal(f,n))}}disposeEdit(e){this._references.disposeReferenceId(e)?.dispose()}constructor(e,t,i,r){this._documents=t,this._provider=i,this._commands=r,this._references=new UA,this.languageTriggerKindToVSCodeTriggerKind={[Xh.Automatic]:Lu.Automatic,[Xh.Invoke]:Lu.Invoke}}},UA=class{constructor(){this._references=new Map,this._idPool=1}createReferenceId(e){const t=this._idPool++;return this._references.set(t,e),t}disposeReferenceId(e){const t=this._references.get(e);return this._references.delete(e),t}get(e){return this._references.get(e)}},vb=class{constructor(e,t){this._documents=e,this._provider=t,this._cache=new jr("SignatureHelp")}async provideSignatureHelp(e,t,i,r){const s=this._documents.getDocument(e),n=Qe.to(t),o=this.reviveContext(i),a=await this._provider.provideSignatureHelp(s,n,r,o);if(a){const l=this._cache.add([a]);return{...$u.from(a),id:l}}}reviveContext(e){let t;if(e.activeSignatureHelp){const i=$u.to(e.activeSignatureHelp),r=this._cache.get(e.activeSignatureHelp.id,0);r?(t=r,t.activeSignature=i.activeSignature,t.activeParameter=i.activeParameter):t=i}return{...e,activeSignatureHelp:t}}releaseSignatureHelp(e){this._cache.delete(e)}},vm=class{constructor(e,t,i,r,s){this._documents=e,this._commands=t,this._provider=i,this._logService=r,this._extension=s,this._cache=new jr("InlayHints"),this._disposables=new Map}async provideInlayHints(e,t,i){const r=this._documents.getDocument(e),s=F.to(t),n=await this._provider.provideInlayHints(r,s,i);if(!Array.isArray(n)||n.length===0){this._logService.trace(`[InlayHints] NO inlay hints from '${this._extension.identifier.value}' for range ${JSON.stringify(t)}`);return}if(i.isCancellationRequested)return;const o=this._cache.add(n);this._disposables.set(o,new oe);const a={hints:[],cacheId:o};for(let l=0;l<n.length;l++)this._isValidInlayHint(n[l],s)&&a.hints.push(this._convertInlayHint(n[l],[o,l]));return this._logService.trace(`[InlayHints] ${a.hints.length} inlay hints from '${this._extension.identifier.value}' for range ${JSON.stringify(t)}`),a}async resolveInlayHint(e,t){if(typeof this._provider.resolveInlayHint!="function")return;const i=this._cache.get(...e);if(!i)return;const r=await this._provider.resolveInlayHint(i,t);if(r&&this._isValidInlayHint(r))return this._convertInlayHint(r,e)}releaseHints(e){this._disposables.get(e)?.dispose(),this._disposables.delete(e),this._cache.delete(e)}_isValidInlayHint(e,t){return e.label.length===0||Array.isArray(e.label)&&e.label.every(i=>i.value.length===0)?(console.log("INVALID inlay hint, empty label",e),!1):!(t&&!t.contains(e.position))}_convertInlayHint(e,t){const i=this._disposables.get(t[0]);if(!i)throw Error("DisposableStore is missing...");const r={label:"",cacheId:t,tooltip:ve.fromStrict(e.tooltip),position:Qe.from(e.position),textEdits:e.textEdits&&e.textEdits.map(Gt.from),kind:e.kind&&qp.from(e.kind),paddingLeft:e.paddingLeft,paddingRight:e.paddingRight};if(typeof e.label=="string")r.label=e.label;else{const s=[];r.label=s;for(const n of e.label){if(!n.value){console.warn("INVALID inlay hint, empty label part",this._extension.identifier.value);continue}const o={label:n.value,tooltip:ve.fromStrict(n.tooltip)};nr.isLocation(n.location)&&(o.location=Ai.from(n.location)),n.command&&(o.command=this._commands.toInternal(n.command,i)),s.push(o)}}return r}},_m=class tv{constructor(t,i){this._documents=t,this._provider=i,this._cache=new jr("DocumentLink")}async provideLinks(t,i){const r=this._documents.getDocument(t),s=await this._provider.provideDocumentLinks(r,i);if(!(!Array.isArray(s)||s.length===0)&&!i.isCancellationRequested){if(typeof this._provider.resolveDocumentLink!="function")return{links:s.filter(tv._validateLink).map(Qo.from)};{const n=this._cache.add(s),o={links:[],cacheId:n};for(let a=0;a<s.length;a++){if(!tv._validateLink(s[a]))continue;const l=Qo.from(s[a]);l.cacheId=[n,a],o.links.push(l)}return o}}}static _validateLink(t){return t.target&&t.target.path.length>5e4?(console.warn("DROPPING link because it is too long"),!1):!0}async resolveLink(t,i){if(typeof this._provider.resolveDocumentLink!="function")return;const r=this._cache.get(...t);if(!r)return;const s=await this._provider.resolveDocumentLink(r,i);if(!(!s||!tv._validateLink(s)))return Qo.from(s)}releaseLinks(t){this._cache.delete(t)}},_b=class{constructor(e,t){this._documents=e,this._provider=t}async provideColors(e,t){const i=this._documents.getDocument(e),r=await this._provider.provideDocumentColors(i,t);return Array.isArray(r)?r.map(n=>({color:xl.from(n.color),range:F.from(n.range)})):[]}async provideColorPresentations(e,t,i){const r=this._documents.getDocument(e),s=F.to(t.range),n=xl.to(t.color),o=await this._provider.provideColorPresentations(n,{document:r,range:s},i);if(Array.isArray(o))return o.map(jp.from)}},WA=class{constructor(e,t){this._documents=e,this._provider=t}async provideFoldingRanges(e,t,i){const r=this._documents.getDocument(e),s=await this._provider.provideFoldingRanges(r,t,i);if(Array.isArray(s))return s.map(Qp.from)}},BA=class{constructor(e,t,i){this._documents=e,this._provider=t,this._logService=i}async provideSelectionRanges(e,t,i){const r=this._documents.getDocument(e),s=t.map(Qe.to),n=await this._provider.provideSelectionRanges(r,s,i);if(!ya(n))return[];if(n.length!==s.length)return this._logService.warn("BAD selection ranges, provider must return ranges for each position"),[];const o=[];for(let a=0;a<s.length;a++){const l=[];o.push(l);let c=s[a],u=n[a];for(;;){if(!u.range.contains(c))throw new Error("INVALID selection range, must contain the previous range");if(l.push(G0.from(u)),!u.parent)break;c=u.range,u=u.parent}}return o}},xd=class{constructor(e,t){this._documents=e,this._provider=t,this._idPool=new Og(""),this._cache=new Map}async prepareSession(e,t,i){const r=this._documents.getDocument(e),s=Qe.to(t),n=await this._provider.prepareCallHierarchy(r,s,i);if(!n)return;const o=this._idPool.nextId();return this._cache.set(o,new Map),Array.isArray(n)?n.map(a=>this._cacheAndConvertItem(o,a)):[this._cacheAndConvertItem(o,n)]}async provideCallsTo(e,t,i){const r=this._itemFromCache(e,t);if(!r)throw new Error("missing call hierarchy item");const s=await this._provider.provideCallHierarchyIncomingCalls(r,i);if(s)return s.map(n=>({from:this._cacheAndConvertItem(e,n.from),fromRanges:n.fromRanges.map(o=>F.from(o))}))}async provideCallsFrom(e,t,i){const r=this._itemFromCache(e,t);if(!r)throw new Error("missing call hierarchy item");const s=await this._provider.provideCallHierarchyOutgoingCalls(r,i);if(s)return s.map(n=>({to:this._cacheAndConvertItem(e,n.to),fromRanges:n.fromRanges.map(o=>F.from(o))}))}releaseSession(e){this._cache.delete(e)}_cacheAndConvertItem(e,t){const i=this._cache.get(e),r=Go.from(t,e,i.size.toString(36));return i.set(r._itemId,t),r}_itemFromCache(e,t){return this._cache.get(e)?.get(t)}},Ed=class{constructor(e,t){this._documents=e,this._provider=t,this._idPool=new Og(""),this._cache=new Map}async prepareSession(e,t,i){const r=this._documents.getDocument(e),s=Qe.to(t),n=await this._provider.prepareTypeHierarchy(r,s,i);if(!n)return;const o=this._idPool.nextId();return this._cache.set(o,new Map),Array.isArray(n)?n.map(a=>this._cacheAndConvertItem(o,a)):[this._cacheAndConvertItem(o,n)]}async provideSupertypes(e,t,i){const r=this._itemFromCache(e,t);if(!r)throw new Error("missing type hierarchy item");const s=await this._provider.provideTypeHierarchySupertypes(r,i);if(s)return s.map(n=>this._cacheAndConvertItem(e,n))}async provideSubtypes(e,t,i){const r=this._itemFromCache(e,t);if(!r)throw new Error("missing type hierarchy item");const s=await this._provider.provideTypeHierarchySubtypes(r,i);if(s)return s.map(n=>this._cacheAndConvertItem(e,n))}releaseSession(e){this._cache.delete(e)}_cacheAndConvertItem(e,t){const i=this._cache.get(e),r=Jo.from(t,e,i.size.toString(36));return i.set(r._itemId,t),r}_itemFromCache(e,t){return this._cache.get(e)?.get(t)}},wm=class{constructor(e,t,i,r,s){this._proxy=e,this._documents=t,this._provider=i,this._handle=r,this._extension=s,this._cache=new jr("DocumentDropEdit")}async provideDocumentOnDropEdits(e,t,i,r,s){const n=this._documents.getDocument(t),o=Qe.to(i),a=Al.toDataTransfer(r,async d=>(await this._proxy.$resolveDocumentOnDropFileData(this._handle,e,d)).buffer),l=await this._provider.provideDocumentDropEdits(n,o,a,s);if(!l)return;const c=er(l),u=this._cache.add(c);return c.map((d,f)=>({_cacheId:[u,f],title:d.title??h(2928,null,this._extension.displayName||this._extension.name),kind:d.kind?.value,yieldTo:d.yieldTo?.map(p=>p.value),insertText:typeof d.insertText=="string"?d.insertText:{snippet:d.insertText.value},additionalEdit:d.additionalEdit?Qi.from(d.additionalEdit,void 0):void 0}))}async resolveDropEdit(e,t){const[i,r]=e,s=this._cache.get(i,r);if(!s||!this._provider.resolveDocumentDropEdit)return{};const n=await this._provider.resolveDocumentDropEdit(s,t)??s;return{additionalEdit:n.additionalEdit?Qi.from(n.additionalEdit,void 0):void 0}}releaseDropEdits(e){this._cache.delete(e)}},Cd=class{constructor(e,t){this.adapter=e,this.extension=t}},Kq=class Yt{static{this._handlePool=0}constructor(t,i,r,s,n,o,a,l){this._uriTransformer=i,this._documents=r,this._commands=s,this._diagnostics=n,this._logService=o,this._apiDeprecation=a,this._extensionTelemetry=l,this._adapter=new Map,this._proxy=t.getProxy(Q.MainThreadLanguageFeatures)}_transformDocumentSelector(t,i){return wl.from(t,this._uriTransformer,i)}_createDisposable(t){return new Ie(()=>{this._adapter.delete(t),this._proxy.$unregister(t)})}_nextHandle(){return Yt._handlePool++}async _withAdapter(t,i,r,s,n,o=!1){const a=this._adapter.get(t);if(!a||!(a.adapter instanceof i))return s;const l=Date.now();o||this._logService.trace(`[${a.extension.identifier.value}] INVOKE provider '${r.toString().replace(/[\r\n]/g,"")}'`);const c=r(a.adapter,a.extension);return Promise.resolve(c).catch(u=>{Yi(u)||(this._logService.error(`[${a.extension.identifier.value}] provider FAILED`),this._logService.error(u),this._extensionTelemetry.onExtensionError(a.extension.identifier,u))}).finally(()=>{o||this._logService.trace(`[${a.extension.identifier.value}] provider DONE after ${Date.now()-l}ms`)}),Be.isCancellationToken(n)?wh(c,n):c}_addNewAdapter(t,i){const r=this._nextHandle();return this._adapter.set(r,new Cd(t,i)),r}static _extLabel(t){return t.displayName||t.name}static _extId(t){return t.identifier.value}registerDocumentSymbolProvider(t,i,r,s){const n=this._addNewAdapter(new DA(this._documents,r),t),o=s&&s.label||Yt._extLabel(t);return this._proxy.$registerDocumentSymbolProvider(n,this._transformDocumentSelector(i,t),o),this._createDisposable(n)}$provideDocumentSymbols(t,i,r){return this._withAdapter(t,DA,s=>s.provideDocumentSymbols(b.revive(i),r),void 0,r)}registerCodeLensProvider(t,i,r){const s=this._nextHandle(),n=typeof r.onDidChangeCodeLenses=="function"?this._nextHandle():void 0;this._adapter.set(s,new Cd(new hm(this._documents,this._commands.converter,r,t,this._extensionTelemetry,this._logService),t)),this._proxy.$registerCodeLensSupport(s,this._transformDocumentSelector(i,t),n);let o=this._createDisposable(s);if(n!==void 0){const a=r.onDidChangeCodeLenses(l=>this._proxy.$emitCodeLensEvent(n));o=Ie.from(o,a)}return o}$provideCodeLenses(t,i,r){return this._withAdapter(t,hm,s=>s.provideCodeLenses(b.revive(i),r),void 0,r,i.scheme==="output")}$resolveCodeLens(t,i,r){return this._withAdapter(t,hm,s=>s.resolveCodeLens(i,r),void 0,void 0,!0)}$releaseCodeLenses(t,i){this._withAdapter(t,hm,r=>Promise.resolve(r.releaseCodeLenses(i)),void 0,void 0,!0)}registerDefinitionProvider(t,i,r){const s=this._addNewAdapter(new kA(this._documents,r),t);return this._proxy.$registerDefinitionSupport(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$provideDefinition(t,i,r,s){return this._withAdapter(t,kA,n=>n.provideDefinition(b.revive(i),r,s),[],s)}registerDeclarationProvider(t,i,r){const s=this._addNewAdapter(new IA(this._documents,r),t);return this._proxy.$registerDeclarationSupport(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$provideDeclaration(t,i,r,s){return this._withAdapter(t,IA,n=>n.provideDeclaration(b.revive(i),r,s),[],s)}registerImplementationProvider(t,i,r){const s=this._addNewAdapter(new PA(this._documents,r),t);return this._proxy.$registerImplementationSupport(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$provideImplementation(t,i,r,s){return this._withAdapter(t,PA,n=>n.provideImplementation(b.revive(i),r,s),[],s)}registerTypeDefinitionProvider(t,i,r){const s=this._addNewAdapter(new TA(this._documents,r),t);return this._proxy.$registerTypeDefinitionSupport(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$provideTypeDefinition(t,i,r,s){return this._withAdapter(t,TA,n=>n.provideTypeDefinition(b.revive(i),r,s),[],s)}registerHoverProvider(t,i,r,s){const n=this._addNewAdapter(new db(this._documents,r),t);return this._proxy.$registerHoverProvider(n,this._transformDocumentSelector(i,t)),this._createDisposable(n)}$provideHover(t,i,r,s,n){return this._withAdapter(t,db,o=>o.provideHover(b.revive(i),r,s,n),void 0,n)}$releaseHover(t,i){this._withAdapter(t,db,r=>Promise.resolve(r.releaseHover(i)),void 0,void 0)}registerEvaluatableExpressionProvider(t,i,r,s){const n=this._addNewAdapter(new AA(this._documents,r),t);return this._proxy.$registerEvaluatableExpressionProvider(n,this._transformDocumentSelector(i,t)),this._createDisposable(n)}$provideEvaluatableExpression(t,i,r,s){return this._withAdapter(t,AA,n=>n.provideEvaluatableExpression(b.revive(i),r,s),void 0,s)}registerInlineValuesProvider(t,i,r,s){const n=typeof r.onDidChangeInlineValues=="function"?this._nextHandle():void 0,o=this._addNewAdapter(new RA(this._documents,r),t);this._proxy.$registerInlineValuesProvider(o,this._transformDocumentSelector(i,t),n);let a=this._createDisposable(o);if(n!==void 0){const l=r.onDidChangeInlineValues(c=>this._proxy.$emitInlineValuesEvent(n));a=Ie.from(a,l)}return a}$provideInlineValues(t,i,r,s,n){return this._withAdapter(t,RA,o=>o.provideInlineValues(b.revive(i),r,s,n),void 0,n)}registerDocumentHighlightProvider(t,i,r){const s=this._addNewAdapter(new LA(this._documents,r),t);return this._proxy.$registerDocumentHighlightProvider(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}registerMultiDocumentHighlightProvider(t,i,r){const s=this._addNewAdapter(new NA(this._documents,r,this._logService),t);return this._proxy.$registerMultiDocumentHighlightProvider(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$provideDocumentHighlights(t,i,r,s){return this._withAdapter(t,LA,n=>n.provideDocumentHighlights(b.revive(i),r,s),void 0,s)}$provideMultiDocumentHighlights(t,i,r,s,n){return this._withAdapter(t,NA,o=>o.provideMultiDocumentHighlights(b.revive(i),r,s.map(a=>b.revive(a)),n),void 0,n)}registerLinkedEditingRangeProvider(t,i,r){const s=this._addNewAdapter(new MA(this._documents,r),t);return this._proxy.$registerLinkedEditingRangeProvider(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$provideLinkedEditingRanges(t,i,r,s){return this._withAdapter(t,MA,async n=>{const o=await n.provideLinkedEditingRanges(b.revive(i),r,s);if(o)return{ranges:o.ranges,wordPattern:o.wordPattern?Yt._serializeRegExp(o.wordPattern):void 0}},void 0,s)}registerReferenceProvider(t,i,r){const s=this._addNewAdapter(new OA(this._documents,r),t);return this._proxy.$registerReferenceSupport(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$provideReferences(t,i,r,s,n){return this._withAdapter(t,OA,o=>o.provideReferences(b.revive(i),r,s,n),void 0,n)}registerCodeActionProvider(t,i,r,s){const n=new oe,o=this._addNewAdapter(new pm(this._documents,this._commands.converter,this._diagnostics,r,this._logService,t,this._apiDeprecation),t);return this._proxy.$registerCodeActionSupport(o,this._transformDocumentSelector(i,t),{providedKinds:s?.providedCodeActionKinds?.map(a=>a.value),documentation:s?.documentation?.map(a=>({kind:a.kind.value,command:this._commands.converter.toInternal(a.command,n)}))},Yt._extLabel(t),Yt._extId(t),!!r.resolveCodeAction),n.add(this._createDisposable(o)),n}$provideCodeActions(t,i,r,s,n){return this._withAdapter(t,pm,o=>o.provideCodeActions(b.revive(i),r,s,n),void 0,n)}$resolveCodeAction(t,i,r){return this._withAdapter(t,pm,s=>s.resolveCodeAction(i,r),{},void 0)}$releaseCodeActions(t,i){this._withAdapter(t,pm,r=>Promise.resolve(r.releaseCodeActions(i)),void 0,void 0)}registerDocumentFormattingEditProvider(t,i,r){const s=this._addNewAdapter(new FA(this._documents,r),t);return this._proxy.$registerDocumentFormattingSupport(s,this._transformDocumentSelector(i,t),t.identifier,t.displayName||t.name),this._createDisposable(s)}$provideDocumentFormattingEdits(t,i,r,s){return this._withAdapter(t,FA,n=>n.provideDocumentFormattingEdits(b.revive(i),r,s),void 0,s)}registerDocumentRangeFormattingEditProvider(t,i,r){const s=typeof r.provideDocumentRangesFormattingEdits=="function",n=this._addNewAdapter(new hb(this._documents,r),t);return this._proxy.$registerRangeFormattingSupport(n,this._transformDocumentSelector(i,t),t.identifier,t.displayName||t.name,s),this._createDisposable(n)}$provideDocumentRangeFormattingEdits(t,i,r,s,n){return this._withAdapter(t,hb,o=>o.provideDocumentRangeFormattingEdits(b.revive(i),r,s,n),void 0,n)}$provideDocumentRangesFormattingEdits(t,i,r,s,n){return this._withAdapter(t,hb,o=>o.provideDocumentRangesFormattingEdits(b.revive(i),r,s,n),void 0,n)}registerOnTypeFormattingEditProvider(t,i,r,s){const n=this._addNewAdapter(new $A(this._documents,r),t);return this._proxy.$registerOnTypeFormattingSupport(n,this._transformDocumentSelector(i,t),s,t.identifier),this._createDisposable(n)}$provideOnTypeFormattingEdits(t,i,r,s,n,o){return this._withAdapter(t,$A,a=>a.provideOnTypeFormattingEdits(b.revive(i),r,s,n,o),void 0,o)}registerWorkspaceSymbolProvider(t,i){const r=this._addNewAdapter(new gm(i,this._logService),t);return this._proxy.$registerNavigateTypeSupport(r,typeof i.resolveWorkspaceSymbol=="function"),this._createDisposable(r)}$provideWorkspaceSymbols(t,i,r){return this._withAdapter(t,gm,s=>s.provideWorkspaceSymbols(i,r),{symbols:[]},r)}$resolveWorkspaceSymbol(t,i,r){return this._withAdapter(t,gm,s=>s.resolveWorkspaceSymbol(i,r),void 0,void 0)}$releaseWorkspaceSymbols(t,i){this._withAdapter(t,gm,r=>r.releaseWorkspaceSymbols(i),void 0,void 0)}registerRenameProvider(t,i,r){const s=this._addNewAdapter(new mm(this._documents,r,this._logService),t);return this._proxy.$registerRenameSupport(s,this._transformDocumentSelector(i,t),mm.supportsResolving(r)),this._createDisposable(s)}$provideRenameEdits(t,i,r,s,n){return this._withAdapter(t,mm,o=>o.provideRenameEdits(b.revive(i),r,s,n),void 0,n)}$resolveRenameLocation(t,i,r,s){return this._withAdapter(t,mm,n=>n.resolveRenameLocation(b.revive(i),r,s),void 0,s)}registerNewSymbolNamesProvider(t,i,r){const s=this._addNewAdapter(new fb(this._documents,r,this._logService),t);return this._proxy.$registerNewSymbolNamesProvider(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$supportsAutomaticNewSymbolNamesTriggerKind(t){return this._withAdapter(t,fb,i=>i.supportsAutomaticNewSymbolNamesTriggerKind(),!1,void 0)}$provideNewSymbolNames(t,i,r,s,n){return this._withAdapter(t,fb,o=>o.provideNewSymbolNames(b.revive(i),r,s,n),void 0,n)}registerDocumentSemanticTokensProvider(t,i,r,s){const n=this._addNewAdapter(new gb(this._documents,r),t),o=typeof r.onDidChangeSemanticTokens=="function"?this._nextHandle():void 0;this._proxy.$registerDocumentSemanticTokensProvider(n,this._transformDocumentSelector(i,t),s,o);let a=this._createDisposable(n);if(o){const l=r.onDidChangeSemanticTokens(c=>this._proxy.$emitDocumentSemanticTokensEvent(o));a=Ie.from(a,l)}return a}$provideDocumentSemanticTokens(t,i,r,s){return this._withAdapter(t,gb,n=>n.provideDocumentSemanticTokens(b.revive(i),r,s),null,s)}$releaseDocumentSemanticTokens(t,i){this._withAdapter(t,gb,r=>r.releaseDocumentSemanticColoring(i),void 0,void 0)}registerDocumentRangeSemanticTokensProvider(t,i,r,s){const n=this._addNewAdapter(new HA(this._documents,r),t);return this._proxy.$registerDocumentRangeSemanticTokensProvider(n,this._transformDocumentSelector(i,t),s),this._createDisposable(n)}$provideDocumentRangeSemanticTokens(t,i,r,s){return this._withAdapter(t,HA,n=>n.provideDocumentRangeSemanticTokens(b.revive(i),r,s),null,s)}registerCompletionItemProvider(t,i,r,s){const n=this._addNewAdapter(new Sd(this._documents,this._commands.converter,r,this._apiDeprecation,t),t);return this._proxy.$registerCompletionsProvider(n,this._transformDocumentSelector(i,t),s,Sd.supportsResolving(r),t.identifier),this._createDisposable(n)}$provideCompletionItems(t,i,r,s,n){return this._withAdapter(t,Sd,o=>o.provideCompletionItems(b.revive(i),r,s,n),void 0,n)}$resolveCompletionItem(t,i,r){return this._withAdapter(t,Sd,s=>s.resolveCompletionItem(i,r),void 0,r)}$releaseCompletionItems(t,i){this._withAdapter(t,Sd,r=>r.releaseCompletionItems(i),void 0,void 0)}registerInlineCompletionsProvider(t,i,r,s){const n=typeof r.onDidChange=="function"&&nt(t,"inlineCompletionsAdditions")?this._nextHandle():void 0,o=new Gn(t,this._documents,r,this._commands.converter),a=this._addNewAdapter(o,t);let l=this._createDisposable(a);if(n!==void 0){const c=r.onDidChange(u=>this._proxy.$emitInlineCompletionsChange(n));l=Ie.from(l,c)}return this._proxy.$registerInlineCompletionsSupport(a,this._transformDocumentSelector(i,t),o.supportsHandleEvents,qe.toKey(t.identifier.value),s?.yieldTo?.map(c=>qe.toKey(c))||[],s?.displayName,s?.debounceDelayMs,n),l}$provideInlineCompletions(t,i,r,s,n){return this._withAdapter(t,Gn,o=>o.provideInlineCompletions(b.revive(i),r,s,n),void 0,n)}$provideInlineEditsForRange(t,i,r,s,n){return this._withAdapter(t,Gn,o=>o.provideInlineEditsForRange(b.revive(i),r,s,n),void 0,n)}$handleInlineCompletionDidShow(t,i,r,s){this._withAdapter(t,Gn,async n=>{n.handleDidShowCompletionItem(i,r,s)},void 0,void 0)}$handleInlineCompletionPartialAccept(t,i,r,s,n){this._withAdapter(t,Gn,async o=>{o.handlePartialAccept(i,r,s,n)},void 0,void 0)}$handleInlineCompletionEndOfLifetime(t,i,r,s){this._withAdapter(t,Gn,async n=>{n.handleEndOfLifetime(i,r,s)},void 0,void 0)}$handleInlineCompletionRejection(t,i,r){this._withAdapter(t,Gn,async s=>{s.handleRejection(i,r)},void 0,void 0)}$freeInlineCompletionsList(t,i){this._withAdapter(t,Gn,async r=>{r.disposeCompletions(i)},void 0,void 0)}registerInlineEditProvider(t,i,r){const s=new mb(t,this._documents,r,this._commands.converter),n=this._addNewAdapter(s,t);return this._proxy.$registerInlineEditProvider(n,this._transformDocumentSelector(i,t),t.identifier,r.displayName||t.name),this._createDisposable(n)}$provideInlineEdit(t,i,r,s){return this._withAdapter(t,mb,n=>n.provideInlineEdits(b.revive(i),r,s),void 0,s)}$freeInlineEdit(t,i){this._withAdapter(t,mb,async r=>{r.disposeEdit(i)},void 0,void 0)}registerSignatureHelpProvider(t,i,r,s){const n=Array.isArray(s)?{triggerCharacters:s,retriggerCharacters:[]}:s,o=this._addNewAdapter(new vb(this._documents,r),t);return this._proxy.$registerSignatureHelpProvider(o,this._transformDocumentSelector(i,t),n),this._createDisposable(o)}$provideSignatureHelp(t,i,r,s,n){return this._withAdapter(t,vb,o=>o.provideSignatureHelp(b.revive(i),r,s,n),void 0,n)}$releaseSignatureHelp(t,i){this._withAdapter(t,vb,r=>r.releaseSignatureHelp(i),void 0,void 0)}registerInlayHintsProvider(t,i,r){const s=typeof r.onDidChangeInlayHints=="function"?this._nextHandle():void 0,n=this._addNewAdapter(new vm(this._documents,this._commands.converter,r,this._logService,t),t);this._proxy.$registerInlayHintsProvider(n,this._transformDocumentSelector(i,t),typeof r.resolveInlayHint=="function",s,Yt._extLabel(t));let o=this._createDisposable(n);if(s!==void 0){const a=r.onDidChangeInlayHints(l=>this._proxy.$emitInlayHintsEvent(s));o=Ie.from(o,a)}return o}$provideInlayHints(t,i,r,s){return this._withAdapter(t,vm,n=>n.provideInlayHints(b.revive(i),r,s),void 0,s)}$resolveInlayHint(t,i,r){return this._withAdapter(t,vm,s=>s.resolveInlayHint(i,r),void 0,r)}$releaseInlayHints(t,i){this._withAdapter(t,vm,r=>r.releaseHints(i),void 0,void 0)}registerDocumentLinkProvider(t,i,r){const s=this._addNewAdapter(new _m(this._documents,r),t);return this._proxy.$registerDocumentLinkProvider(s,this._transformDocumentSelector(i,t),typeof r.resolveDocumentLink=="function"),this._createDisposable(s)}$provideDocumentLinks(t,i,r){return this._withAdapter(t,_m,s=>s.provideLinks(b.revive(i),r),void 0,r,i.scheme==="output")}$resolveDocumentLink(t,i,r){return this._withAdapter(t,_m,s=>s.resolveLink(i,r),void 0,void 0,!0)}$releaseDocumentLinks(t,i){this._withAdapter(t,_m,r=>r.releaseLinks(i),void 0,void 0,!0)}registerColorProvider(t,i,r){const s=this._addNewAdapter(new _b(this._documents,r),t);return this._proxy.$registerDocumentColorProvider(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$provideDocumentColors(t,i,r){return this._withAdapter(t,_b,s=>s.provideColors(b.revive(i),r),[],r)}$provideColorPresentations(t,i,r,s){return this._withAdapter(t,_b,n=>n.provideColorPresentations(b.revive(i),r,s),void 0,s)}registerFoldingRangeProvider(t,i,r){const s=this._nextHandle(),n=typeof r.onDidChangeFoldingRanges=="function"?this._nextHandle():void 0;this._adapter.set(s,new Cd(new WA(this._documents,r),t)),this._proxy.$registerFoldingRangeProvider(s,this._transformDocumentSelector(i,t),t.identifier,n);let o=this._createDisposable(s);if(n!==void 0){const a=r.onDidChangeFoldingRanges(()=>this._proxy.$emitFoldingRangeEvent(n));o=Ie.from(o,a)}return o}$provideFoldingRanges(t,i,r,s){return this._withAdapter(t,WA,n=>n.provideFoldingRanges(b.revive(i),r,s),void 0,s)}registerSelectionRangeProvider(t,i,r){const s=this._addNewAdapter(new BA(this._documents,r,this._logService),t);return this._proxy.$registerSelectionRangeProvider(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$provideSelectionRanges(t,i,r,s){return this._withAdapter(t,BA,n=>n.provideSelectionRanges(b.revive(i),r,s),[],s)}registerCallHierarchyProvider(t,i,r){const s=this._addNewAdapter(new xd(this._documents,r),t);return this._proxy.$registerCallHierarchyProvider(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$prepareCallHierarchy(t,i,r,s){return this._withAdapter(t,xd,n=>Promise.resolve(n.prepareSession(b.revive(i),r,s)),void 0,s)}$provideCallHierarchyIncomingCalls(t,i,r,s){return this._withAdapter(t,xd,n=>n.provideCallsTo(i,r,s),void 0,s)}$provideCallHierarchyOutgoingCalls(t,i,r,s){return this._withAdapter(t,xd,n=>n.provideCallsFrom(i,r,s),void 0,s)}$releaseCallHierarchy(t,i){this._withAdapter(t,xd,r=>Promise.resolve(r.releaseSession(i)),void 0,void 0)}registerTypeHierarchyProvider(t,i,r){const s=this._addNewAdapter(new Ed(this._documents,r),t);return this._proxy.$registerTypeHierarchyProvider(s,this._transformDocumentSelector(i,t)),this._createDisposable(s)}$prepareTypeHierarchy(t,i,r,s){return this._withAdapter(t,Ed,n=>Promise.resolve(n.prepareSession(b.revive(i),r,s)),void 0,s)}$provideTypeHierarchySupertypes(t,i,r,s){return this._withAdapter(t,Ed,n=>n.provideSupertypes(i,r,s),void 0,s)}$provideTypeHierarchySubtypes(t,i,r,s){return this._withAdapter(t,Ed,n=>n.provideSubtypes(i,r,s),void 0,s)}$releaseTypeHierarchy(t,i){this._withAdapter(t,Ed,r=>Promise.resolve(r.releaseSession(i)),void 0,void 0)}registerDocumentOnDropEditProvider(t,i,r,s){const n=this._nextHandle();return this._adapter.set(n,new Cd(new wm(this._proxy,this._documents,r,n,t),t)),this._proxy.$registerDocumentOnDropEditProvider(n,this._transformDocumentSelector(i,t),s?{supportsResolve:!!r.resolveDocumentDropEdit,dropMimeTypes:s.dropMimeTypes,providedDropKinds:s.providedDropEditKinds?.map(o=>o.value)}:void 0),this._createDisposable(n)}$provideDocumentOnDropEdits(t,i,r,s,n,o){return this._withAdapter(t,wm,a=>Promise.resolve(a.provideDocumentOnDropEdits(i,b.revive(r),s,n,o)),void 0,void 0)}$resolveDropEdit(t,i,r){return this._withAdapter(t,wm,s=>s.resolveDropEdit(i,r),{},void 0)}$releaseDocumentOnDropEdits(t,i){this._withAdapter(t,wm,r=>Promise.resolve(r.releaseDropEdits(i)),void 0,void 0)}registerDocumentPasteEditProvider(t,i,r,s){const n=this._nextHandle();return this._adapter.set(n,new Cd(new bd(this._proxy,this._documents,r,n,t),t)),this._proxy.$registerPasteEditProvider(n,this._transformDocumentSelector(i,t),{supportsCopy:!!r.prepareDocumentPaste,supportsPaste:!!r.provideDocumentPasteEdits,supportsResolve:!!r.resolveDocumentPasteEdit,providedPasteEditKinds:s.providedPasteEditKinds?.map(o=>o.value),copyMimeTypes:s.copyMimeTypes,pasteMimeTypes:s.pasteMimeTypes}),this._createDisposable(n)}$prepareDocumentPaste(t,i,r,s,n){return this._withAdapter(t,bd,o=>o.prepareDocumentPaste(b.revive(i),r,s,n),void 0,n)}$providePasteEdits(t,i,r,s,n,o,a){return this._withAdapter(t,bd,l=>l.providePasteEdits(i,b.revive(r),s,n,o,a),void 0,a)}$resolvePasteEdit(t,i,r){return this._withAdapter(t,bd,s=>s.resolvePasteEdit(i,r),{},void 0)}$releasePasteEdits(t,i){this._withAdapter(t,bd,r=>Promise.resolve(r.releasePasteEdits(i)),void 0,void 0)}static _serializeRegExp(t){return{pattern:t.source,flags:t.flags}}static _serializeIndentationRule(t){return{decreaseIndentPattern:Yt._serializeRegExp(t.decreaseIndentPattern),increaseIndentPattern:Yt._serializeRegExp(t.increaseIndentPattern),indentNextLinePattern:t.indentNextLinePattern?Yt._serializeRegExp(t.indentNextLinePattern):void 0,unIndentedLinePattern:t.unIndentedLinePattern?Yt._serializeRegExp(t.unIndentedLinePattern):void 0}}static _serializeOnEnterRule(t){return{beforeText:Yt._serializeRegExp(t.beforeText),afterText:t.afterText?Yt._serializeRegExp(t.afterText):void 0,previousLineText:t.previousLineText?Yt._serializeRegExp(t.previousLineText):void 0,action:t.action}}static _serializeOnEnterRules(t){return t.map(Yt._serializeOnEnterRule)}static _serializeAutoClosingPair(t){return{open:t.open,close:t.close,notIn:t.notIn?t.notIn.map(i=>sl.toString(i)):void 0}}static _serializeAutoClosingPairs(t){return t.map(Yt._serializeAutoClosingPair)}setLanguageConfiguration(t,i,r){const{wordPattern:s}=r;if(s&&Ux(s))throw new Error(`Invalid language configuration: wordPattern '${s}' is not allowed to match the empty string.`);s?this._documents.setWordDefinitionFor(i,s):this._documents.setWordDefinitionFor(i,void 0),r.__electricCharacterSupport&&this._apiDeprecation.report("LanguageConfiguration.__electricCharacterSupport",t,"Do not use."),r.__characterPairSupport&&this._apiDeprecation.report("LanguageConfiguration.__characterPairSupport",t,"Do not use.");const n=this._nextHandle(),o={comments:r.comments,brackets:r.brackets,wordPattern:r.wordPattern?Yt._serializeRegExp(r.wordPattern):void 0,indentationRules:r.indentationRules?Yt._serializeIndentationRule(r.indentationRules):void 0,onEnterRules:r.onEnterRules?Yt._serializeOnEnterRules(r.onEnterRules):void 0,__electricCharacterSupport:r.__electricCharacterSupport,__characterPairSupport:r.__characterPairSupport,autoClosingPairs:r.autoClosingPairs?Yt._serializeAutoClosingPairs(r.autoClosingPairs):void 0};return this._proxy.$setLanguageConfiguration(n,i,o),this._createDisposable(n)}$setWordDefinitions(t){for(const i of t)this._documents.setWordDefinitionFor(i.languageId,new RegExp(i.regexSource,i.regexFlags))}},VA;(function(e){function t(i){switch(i.type){case"extension":return`extension:${i.extensionId.value}`;case"mcp":return`mcp:${i.collectionId}:${i.definitionId}`;case"internal":return"internal"}}e.toKey=t})(VA||(VA={}));function Xq(e){return typeof e=="object"&&typeof e.sessionId=="string"}var Yq=q("ILanguageModelToolsService"),Zq=q("notebookService"),ej=q("codeMapperService"),zA="vscode_editFile",wb="vscode_editFile_internal",qA={id:wb,displayName:"",modelDescription:"",source:{type:"internal"}},yb=class{constructor(t,i,r){this.chatService=t,this.codeMapperService=i,this.notebookService=r}async invoke(t,i,r,s){if(!t.context)throw new Error("toolInvocationToken is required for this tool");const n=t.parameters,o=b.revive(n.uri),a=af.parse(o)?.notebook||o,l=this.chatService.getSession(t.context?.sessionId),c=l.getRequests().at(-1);c.response?.response.getMarkdown().length&&l.acceptResponseProgress(c,{kind:"undoStop",id:mt()}),l.acceptResponseProgress(c,{kind:"markdownContent",content:new Fa("\n````\n")}),l.acceptResponseProgress(c,{kind:"codeblockUri",uri:a,isEdit:!0}),l.acceptResponseProgress(c,{kind:"markdownContent",content:new Fa("\n````\n")}),this.notebookService.hasSupportedNotebooks(a)&&this.notebookService.getNotebookTextModel(a)?l.acceptResponseProgress(c,{kind:"notebookEdit",edits:[],uri:a}):l.acceptResponseProgress(c,{kind:"textEdit",edits:[],uri:a});const u=l.editingSession;if(!u)throw new Error("This tool must be called from within an editing session");const d=await this.codeMapperService.mapCode({codeBlocks:[{code:n.code,resource:a,markdownBeforeBlock:n.explanation}],location:"tool",chatRequestId:t.chatRequestId,chatRequestModel:t.modelId,chatSessionId:t.context.sessionId},{textEdit:(p,g)=>{l.acceptResponseProgress(c,{kind:"textEdit",uri:p,edits:g})},notebookEdit(p,g){l.acceptResponseProgress(c,{kind:"notebookEdit",uri:p,edits:g})}},s);if(this.notebookService.hasSupportedNotebooks(a)&&this.notebookService.getNotebookTextModel(a)?l.acceptResponseProgress(c,{kind:"notebookEdit",uri:a,edits:[],done:!0}):l.acceptResponseProgress(c,{kind:"textEdit",uri:a,edits:[],done:!0}),d?.errorMessage)throw new Error(d.errorMessage);let f;return await new Promise(p=>{let g=!1;f=X1(v=>{const S=u.entries.read(v)?.find(x=>x.modifiedURI.toString()===a.toString());S&&(S.isCurrentlyBeingModifiedBy.read(v)?g=!0:g&&p(!0))})}).finally(()=>{f.dispose()}),{content:[{kind:"text",value:"The file was edited successfully"}]}}async prepareToolInvocation(t,i){return{presentation:"hidden"}}};yb=__decorate([__param(0,oH),__param(1,ej),__param(2,Zq)],yb);var jA=class extends X{static{this.ID="chat.builtinTools"}constructor(t,i){super();const r=i.createInstance(yb);this._register(t.registerToolData(qA)),this._register(t.registerToolImplementation(qA.id,r))}};jA=__decorate([__param(0,Yq),__param(1,Ic)],jA);var tj="vscode_fetchWebPage_internal",GA=q("commandService"),bb=new class{constructor(){this._commands=new Map,this._onDidRegisterCommand=new D,this.onDidRegisterCommand=this._onDidRegisterCommand.event}registerCommand(e,t){if(!e)throw new Error("invalid command");if(typeof e=="string"){if(!t)throw new Error("invalid command");return this.registerCommand({id:e,handler:t})}if(e.metadata&&Array.isArray(e.metadata.args)){const o=[];for(const l of e.metadata.args)o.push(l.constraint);const a=e.handler;e.handler=function(l,...c){return tL(c,o),a(l,...c)}}const{id:i}=e;let r=this._commands.get(i);r||(r=new hn,this._commands.set(i,r));const s=r.unshift(e),n=ie(()=>{s(),this._commands.get(i)?.isEmpty()&&this._commands.delete(i)});return this._onDidRegisterCommand.fire(i),_v(n)}registerCommandAlias(e,t){return bb.registerCommand(e,(i,...r)=>i.get(GA).executeCommand(t,...r))}getCommand(e){const t=this._commands.get(e);if(!(!t||t.isEmpty()))return ai.first(t)}getCommands(){const e=new Map;for(const t of this._commands.keys()){const i=this.getCommand(t);i&&e.set(t,i)}return e}};bb.registerCommand("noop",()=>{});var QA;(function(e){e[e.CtrlCmd=2048]="CtrlCmd",e[e.Shift=1024]="Shift",e[e.Alt=512]="Alt",e[e.WinCtrl=256]="WinCtrl",e[e.KeyCode=255]="KeyCode"})(QA||(QA={}));function JA(e,t){if(typeof e=="number"){if(e===0)return null;const i=(e&65535)>>>0,r=(e&4294901760)>>>16;return r!==0?new bm([ym(i,t),ym(r,t)]):new bm([ym(i,t)])}else{const i=[];for(let r=0;r<e.length;r++)i.push(ym(e[r],t));return new bm(i)}}function ym(e,t){const i=!!(e&2048),r=!!(e&256),s=t===2?r:i,n=!!(e&1024),o=!!(e&512),a=t===2?i:r,l=e&255;return new ij(s,n,o,a,l)}var ij=class H8{constructor(t,i,r,s,n){this.ctrlKey=t,this.shiftKey=i,this.altKey=r,this.metaKey=s,this.keyCode=n}equals(t){return t instanceof H8&&this.ctrlKey===t.ctrlKey&&this.shiftKey===t.shiftKey&&this.altKey===t.altKey&&this.metaKey===t.metaKey&&this.keyCode===t.keyCode}getHashCode(){const t=this.ctrlKey?"1":"0",i=this.shiftKey?"1":"0",r=this.altKey?"1":"0",s=this.metaKey?"1":"0";return`K${t}${i}${r}${s}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new bm([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},bm=class{constructor(e){if(e.length===0)throw De("chords");this.chords=e}getHashCode(){let e="";for(let t=0,i=this.chords.length;t<i;t++)t!==0&&(e+=";"),e+=this.chords[t].getHashCode();return e}equals(e){if(e===null||this.chords.length!==e.chords.length)return!1;for(let t=0;t<this.chords.length;t++)if(!this.chords[t].equals(e.chords[t]))return!1;return!0}},KA;(function(e){e[e.EditorCore=0]="EditorCore",e[e.EditorContrib=100]="EditorContrib",e[e.WorkbenchContrib=200]="WorkbenchContrib",e[e.BuiltinExtension=300]="BuiltinExtension",e[e.ExternalExtension=400]="ExternalExtension"})(KA||(KA={}));var rj=class U8{constructor(){this._coreKeybindings=new hn,this._extensionKeybindings=[],this._cachedMergedKeybindings=null}static bindToCurrentPlatform(t){if(io===1){if(t&&t.win)return t.win}else if(io===2){if(t&&t.mac)return t.mac}else if(t&&t.linux)return t.linux;return t}registerKeybindingRule(t){const i=U8.bindToCurrentPlatform(t),r=new oe;if(i&&i.primary){const s=JA(i.primary,io);s&&r.add(this._registerDefaultKeybinding(s,t.id,t.args,t.weight,0,t.when))}if(i&&Array.isArray(i.secondary))for(let s=0,n=i.secondary.length;s<n;s++){const o=i.secondary[s],a=JA(o,io);a&&r.add(this._registerDefaultKeybinding(a,t.id,t.args,t.weight,-s-1,t.when))}return r}setExtensionKeybindings(t){const i=[];let r=0;for(const s of t)s.keybinding&&(i[r++]={keybinding:s.keybinding,command:s.id,commandArgs:s.args,when:s.when,weight1:s.weight,weight2:0,extensionId:s.extensionId||null,isBuiltinExtension:s.isBuiltinExtension||!1});this._extensionKeybindings=i,this._cachedMergedKeybindings=null}registerCommandAndKeybindingRule(t){return wv(this.registerKeybindingRule(t),bb.registerCommand(t))}_registerDefaultKeybinding(t,i,r,s,n,o){const a=this._coreKeybindings.push({keybinding:t,command:i,commandArgs:r,when:o,weight1:s,weight2:n,extensionId:null,isBuiltinExtension:!1});return this._cachedMergedKeybindings=null,ie(()=>{a(),this._cachedMergedKeybindings=null})}getDefaultKeybindings(){return this._cachedMergedKeybindings||(this._cachedMergedKeybindings=Array.from(this._coreKeybindings).concat(this._extensionKeybindings),this._cachedMergedKeybindings.sort(oj)),this._cachedMergedKeybindings.slice(0)}},sj=new rj,nj={EditorModes:"platform.keybindingsRegistry"};Xt.add(nj.EditorModes,sj);function oj(e,t){if(e.weight1!==t.weight1)return e.weight1-t.weight1;if(e.command&&t.command){if(e.command<t.command)return-1;if(e.command>t.command)return 1}return e.weight2-t.weight2}var Sm;function aj(e){return e.command!==void 0}var xm=class T{static{this._instances=new Map}static{this.CommandPalette=new T("CommandPalette")}static{this.DebugBreakpointsContext=new T("DebugBreakpointsContext")}static{this.DebugCallStackContext=new T("DebugCallStackContext")}static{this.DebugConsoleContext=new T("DebugConsoleContext")}static{this.DebugVariablesContext=new T("DebugVariablesContext")}static{this.NotebookVariablesContext=new T("NotebookVariablesContext")}static{this.DebugHoverContext=new T("DebugHoverContext")}static{this.DebugWatchContext=new T("DebugWatchContext")}static{this.DebugToolBar=new T("DebugToolBar")}static{this.DebugToolBarStop=new T("DebugToolBarStop")}static{this.DebugDisassemblyContext=new T("DebugDisassemblyContext")}static{this.DebugCallStackToolbar=new T("DebugCallStackToolbar")}static{this.DebugCreateConfiguration=new T("DebugCreateConfiguration")}static{this.EditorContext=new T("EditorContext")}static{this.SimpleEditorContext=new T("SimpleEditorContext")}static{this.EditorContent=new T("EditorContent")}static{this.EditorLineNumberContext=new T("EditorLineNumberContext")}static{this.EditorContextCopy=new T("EditorContextCopy")}static{this.EditorContextPeek=new T("EditorContextPeek")}static{this.EditorContextShare=new T("EditorContextShare")}static{this.EditorTitle=new T("EditorTitle")}static{this.EditorTitleRun=new T("EditorTitleRun")}static{this.EditorTitleContext=new T("EditorTitleContext")}static{this.EditorTitleContextShare=new T("EditorTitleContextShare")}static{this.EmptyEditorGroup=new T("EmptyEditorGroup")}static{this.EmptyEditorGroupContext=new T("EmptyEditorGroupContext")}static{this.EditorTabsBarContext=new T("EditorTabsBarContext")}static{this.EditorTabsBarShowTabsSubmenu=new T("EditorTabsBarShowTabsSubmenu")}static{this.EditorTabsBarShowTabsZenModeSubmenu=new T("EditorTabsBarShowTabsZenModeSubmenu")}static{this.EditorActionsPositionSubmenu=new T("EditorActionsPositionSubmenu")}static{this.ExplorerContext=new T("ExplorerContext")}static{this.ExplorerContextShare=new T("ExplorerContextShare")}static{this.ExtensionContext=new T("ExtensionContext")}static{this.ExtensionEditorContextMenu=new T("ExtensionEditorContextMenu")}static{this.GlobalActivity=new T("GlobalActivity")}static{this.CommandCenter=new T("CommandCenter")}static{this.CommandCenterCenter=new T("CommandCenterCenter")}static{this.LayoutControlMenuSubmenu=new T("LayoutControlMenuSubmenu")}static{this.LayoutControlMenu=new T("LayoutControlMenu")}static{this.MenubarMainMenu=new T("MenubarMainMenu")}static{this.MenubarAppearanceMenu=new T("MenubarAppearanceMenu")}static{this.MenubarDebugMenu=new T("MenubarDebugMenu")}static{this.MenubarEditMenu=new T("MenubarEditMenu")}static{this.MenubarCopy=new T("MenubarCopy")}static{this.MenubarFileMenu=new T("MenubarFileMenu")}static{this.MenubarGoMenu=new T("MenubarGoMenu")}static{this.MenubarHelpMenu=new T("MenubarHelpMenu")}static{this.MenubarLayoutMenu=new T("MenubarLayoutMenu")}static{this.MenubarNewBreakpointMenu=new T("MenubarNewBreakpointMenu")}static{this.PanelAlignmentMenu=new T("PanelAlignmentMenu")}static{this.PanelPositionMenu=new T("PanelPositionMenu")}static{this.ActivityBarPositionMenu=new T("ActivityBarPositionMenu")}static{this.MenubarPreferencesMenu=new T("MenubarPreferencesMenu")}static{this.MenubarRecentMenu=new T("MenubarRecentMenu")}static{this.MenubarSelectionMenu=new T("MenubarSelectionMenu")}static{this.MenubarShare=new T("MenubarShare")}static{this.MenubarSwitchEditorMenu=new T("MenubarSwitchEditorMenu")}static{this.MenubarSwitchGroupMenu=new T("MenubarSwitchGroupMenu")}static{this.MenubarTerminalMenu=new T("MenubarTerminalMenu")}static{this.MenubarTerminalSuggestStatusMenu=new T("MenubarTerminalSuggestStatusMenu")}static{this.MenubarViewMenu=new T("MenubarViewMenu")}static{this.MenubarHomeMenu=new T("MenubarHomeMenu")}static{this.OpenEditorsContext=new T("OpenEditorsContext")}static{this.OpenEditorsContextShare=new T("OpenEditorsContextShare")}static{this.ProblemsPanelContext=new T("ProblemsPanelContext")}static{this.SCMInputBox=new T("SCMInputBox")}static{this.SCMChangeContext=new T("SCMChangeContext")}static{this.SCMResourceContext=new T("SCMResourceContext")}static{this.SCMResourceContextShare=new T("SCMResourceContextShare")}static{this.SCMResourceFolderContext=new T("SCMResourceFolderContext")}static{this.SCMResourceGroupContext=new T("SCMResourceGroupContext")}static{this.SCMSourceControl=new T("SCMSourceControl")}static{this.SCMSourceControlInline=new T("SCMSourceControlInline")}static{this.SCMSourceControlTitle=new T("SCMSourceControlTitle")}static{this.SCMHistoryTitle=new T("SCMHistoryTitle")}static{this.SCMHistoryItemContext=new T("SCMHistoryItemContext")}static{this.SCMHistoryItemHover=new T("SCMHistoryItemHover")}static{this.SCMHistoryItemRefContext=new T("SCMHistoryItemRefContext")}static{this.SCMQuickDiffDecorations=new T("SCMQuickDiffDecorations")}static{this.SCMTitle=new T("SCMTitle")}static{this.SearchContext=new T("SearchContext")}static{this.SearchActionMenu=new T("SearchActionContext")}static{this.StatusBarWindowIndicatorMenu=new T("StatusBarWindowIndicatorMenu")}static{this.StatusBarRemoteIndicatorMenu=new T("StatusBarRemoteIndicatorMenu")}static{this.StickyScrollContext=new T("StickyScrollContext")}static{this.TestItem=new T("TestItem")}static{this.TestItemGutter=new T("TestItemGutter")}static{this.TestProfilesContext=new T("TestProfilesContext")}static{this.TestMessageContext=new T("TestMessageContext")}static{this.TestMessageContent=new T("TestMessageContent")}static{this.TestPeekElement=new T("TestPeekElement")}static{this.TestPeekTitle=new T("TestPeekTitle")}static{this.TestCallStack=new T("TestCallStack")}static{this.TestCoverageFilterItem=new T("TestCoverageFilterItem")}static{this.TouchBarContext=new T("TouchBarContext")}static{this.TitleBar=new T("TitleBar")}static{this.TitleBarContext=new T("TitleBarContext")}static{this.TitleBarTitleContext=new T("TitleBarTitleContext")}static{this.TunnelContext=new T("TunnelContext")}static{this.TunnelPrivacy=new T("TunnelPrivacy")}static{this.TunnelProtocol=new T("TunnelProtocol")}static{this.TunnelPortInline=new T("TunnelInline")}static{this.TunnelTitle=new T("TunnelTitle")}static{this.TunnelLocalAddressInline=new T("TunnelLocalAddressInline")}static{this.TunnelOriginInline=new T("TunnelOriginInline")}static{this.ViewItemContext=new T("ViewItemContext")}static{this.ViewContainerTitle=new T("ViewContainerTitle")}static{this.ViewContainerTitleContext=new T("ViewContainerTitleContext")}static{this.ViewTitle=new T("ViewTitle")}static{this.ViewTitleContext=new T("ViewTitleContext")}static{this.CommentEditorActions=new T("CommentEditorActions")}static{this.CommentThreadTitle=new T("CommentThreadTitle")}static{this.CommentThreadActions=new T("CommentThreadActions")}static{this.CommentThreadAdditionalActions=new T("CommentThreadAdditionalActions")}static{this.CommentThreadTitleContext=new T("CommentThreadTitleContext")}static{this.CommentThreadCommentContext=new T("CommentThreadCommentContext")}static{this.CommentTitle=new T("CommentTitle")}static{this.CommentActions=new T("CommentActions")}static{this.CommentsViewThreadActions=new T("CommentsViewThreadActions")}static{this.InteractiveToolbar=new T("InteractiveToolbar")}static{this.InteractiveCellTitle=new T("InteractiveCellTitle")}static{this.InteractiveCellDelete=new T("InteractiveCellDelete")}static{this.InteractiveCellExecute=new T("InteractiveCellExecute")}static{this.InteractiveInputExecute=new T("InteractiveInputExecute")}static{this.InteractiveInputConfig=new T("InteractiveInputConfig")}static{this.ReplInputExecute=new T("ReplInputExecute")}static{this.IssueReporter=new T("IssueReporter")}static{this.NotebookToolbar=new T("NotebookToolbar")}static{this.NotebookToolbarContext=new T("NotebookToolbarContext")}static{this.NotebookStickyScrollContext=new T("NotebookStickyScrollContext")}static{this.NotebookCellTitle=new T("NotebookCellTitle")}static{this.NotebookCellDelete=new T("NotebookCellDelete")}static{this.NotebookCellInsert=new T("NotebookCellInsert")}static{this.NotebookCellBetween=new T("NotebookCellBetween")}static{this.NotebookCellListTop=new T("NotebookCellTop")}static{this.NotebookCellExecute=new T("NotebookCellExecute")}static{this.NotebookCellExecuteGoTo=new T("NotebookCellExecuteGoTo")}static{this.NotebookCellExecutePrimary=new T("NotebookCellExecutePrimary")}static{this.NotebookDiffCellInputTitle=new T("NotebookDiffCellInputTitle")}static{this.NotebookDiffDocumentMetadata=new T("NotebookDiffDocumentMetadata")}static{this.NotebookDiffCellMetadataTitle=new T("NotebookDiffCellMetadataTitle")}static{this.NotebookDiffCellOutputsTitle=new T("NotebookDiffCellOutputsTitle")}static{this.NotebookOutputToolbar=new T("NotebookOutputToolbar")}static{this.NotebookOutlineFilter=new T("NotebookOutlineFilter")}static{this.NotebookOutlineActionMenu=new T("NotebookOutlineActionMenu")}static{this.NotebookEditorLayoutConfigure=new T("NotebookEditorLayoutConfigure")}static{this.NotebookKernelSource=new T("NotebookKernelSource")}static{this.BulkEditTitle=new T("BulkEditTitle")}static{this.BulkEditContext=new T("BulkEditContext")}static{this.TimelineItemContext=new T("TimelineItemContext")}static{this.TimelineTitle=new T("TimelineTitle")}static{this.TimelineTitleContext=new T("TimelineTitleContext")}static{this.TimelineFilterSubMenu=new T("TimelineFilterSubMenu")}static{this.AccountsContext=new T("AccountsContext")}static{this.SidebarTitle=new T("SidebarTitle")}static{this.PanelTitle=new T("PanelTitle")}static{this.AuxiliaryBarTitle=new T("AuxiliaryBarTitle")}static{this.AuxiliaryBarHeader=new T("AuxiliaryBarHeader")}static{this.TerminalInstanceContext=new T("TerminalInstanceContext")}static{this.TerminalEditorInstanceContext=new T("TerminalEditorInstanceContext")}static{this.TerminalNewDropdownContext=new T("TerminalNewDropdownContext")}static{this.TerminalTabContext=new T("TerminalTabContext")}static{this.TerminalTabEmptyAreaContext=new T("TerminalTabEmptyAreaContext")}static{this.TerminalStickyScrollContext=new T("TerminalStickyScrollContext")}static{this.WebviewContext=new T("WebviewContext")}static{this.InlineCompletionsActions=new T("InlineCompletionsActions")}static{this.InlineEditsActions=new T("InlineEditsActions")}static{this.NewFile=new T("NewFile")}static{this.MergeInput1Toolbar=new T("MergeToolbar1Toolbar")}static{this.MergeInput2Toolbar=new T("MergeToolbar2Toolbar")}static{this.MergeBaseToolbar=new T("MergeBaseToolbar")}static{this.MergeInputResultToolbar=new T("MergeToolbarResultToolbar")}static{this.InlineSuggestionToolbar=new T("InlineSuggestionToolbar")}static{this.InlineEditToolbar=new T("InlineEditToolbar")}static{this.ChatContext=new T("ChatContext")}static{this.ChatCodeBlock=new T("ChatCodeblock")}static{this.ChatCompareBlock=new T("ChatCompareBlock")}static{this.ChatMessageTitle=new T("ChatMessageTitle")}static{this.ChatMessageFooter=new T("ChatMessageFooter")}static{this.ChatExecute=new T("ChatExecute")}static{this.ChatExecuteSecondary=new T("ChatExecuteSecondary")}static{this.ChatInput=new T("ChatInput")}static{this.ChatInputSide=new T("ChatInputSide")}static{this.ChatModelPicker=new T("ChatModelPicker")}static{this.ChatEditingWidgetToolbar=new T("ChatEditingWidgetToolbar")}static{this.ChatEditingEditorContent=new T("ChatEditingEditorContent")}static{this.ChatEditingEditorHunk=new T("ChatEditingEditorHunk")}static{this.ChatEditingDeletedNotebookCell=new T("ChatEditingDeletedNotebookCell")}static{this.ChatInputAttachmentToolbar=new T("ChatInputAttachmentToolbar")}static{this.ChatEditingWidgetModifiedFilesToolbar=new T("ChatEditingWidgetModifiedFilesToolbar")}static{this.ChatInputResourceAttachmentContext=new T("ChatInputResourceAttachmentContext")}static{this.ChatInputSymbolAttachmentContext=new T("ChatInputSymbolAttachmentContext")}static{this.ChatInlineResourceAnchorContext=new T("ChatInlineResourceAnchorContext")}static{this.ChatInlineSymbolAnchorContext=new T("ChatInlineSymbolAnchorContext")}static{this.ChatEditingCodeBlockContext=new T("ChatEditingCodeBlockContext")}static{this.ChatTitleBarMenu=new T("ChatTitleBarMenu")}static{this.ChatAttachmentsContext=new T("ChatAttachmentsContext")}static{this.AccessibleView=new T("AccessibleView")}static{this.MultiDiffEditorFileToolbar=new T("MultiDiffEditorFileToolbar")}static{this.DiffEditorHunkToolbar=new T("DiffEditorHunkToolbar")}static{this.DiffEditorSelectionToolbar=new T("DiffEditorSelectionToolbar")}static for(t){return T._instances.get(t)??new T(t)}constructor(t){if(T._instances.has(t))throw new TypeError(`MenuId with identifier '${t}' already exists. Use MenuId.for(ident) or a unique identifier`);T._instances.set(t,this),this.id=t}},bse=q("menuService"),Dd=class VS{static{this._all=new Map}static for(t){let i=this._all.get(t);return i||(i=new VS(t),this._all.set(t,i)),i}static merge(t){const i=new Set;for(const r of t)r instanceof VS&&i.add(r.id);return i}constructor(t){this.id=t,this.has=i=>i===t}},Sse=new class{constructor(){this._commands=new Map,this._menuItems=new Map,this._onDidChangeMenu=new gL({merge:Dd.merge}),this.onDidChangeMenu=this._onDidChangeMenu.event}addCommand(e){return this._commands.set(e.id,e),this._onDidChangeMenu.fire(Dd.for(xm.CommandPalette)),_v(ie(()=>{this._commands.delete(e.id)&&this._onDidChangeMenu.fire(Dd.for(xm.CommandPalette))}))}getCommand(e){return this._commands.get(e)}getCommands(){const e=new Map;return this._commands.forEach((t,i)=>e.set(i,t)),e}appendMenuItem(e,t){let i=this._menuItems.get(e);i||(i=new hn,this._menuItems.set(e,i));const r=i.push(t);return this._onDidChangeMenu.fire(Dd.for(e)),_v(ie(()=>{r(),this._onDidChangeMenu.fire(Dd.for(e))}))}appendMenuItems(e){const t=new oe;for(const{id:i,item:r}of e)t.add(this.appendMenuItem(i,r));return t}getMenuItems(e){let t;return this._menuItems.has(e)?t=[...this._menuItems.get(e)]:t=[],e===xm.CommandPalette&&this._appendImplicitItems(t),t}_appendImplicitItems(e){const t=new Set;for(const i of e)aj(i)&&(t.add(i.command.id),i.alt&&t.add(i.alt.id));this._commands.forEach((i,r)=>{t.has(r)||e.push({command:i})})}},XA=Sm=class{static label(t,i){return i?.renderShortTitle&&t.shortTitle?typeof t.shortTitle=="string"?t.shortTitle:t.shortTitle.value:typeof t.title=="string"?t.title:t.title.value}constructor(t,i,r,s,n,o,a){this.hideActions=s,this.menuKeybinding=n,this._commandService=a,this.id=t.id,this.label=Sm.label(t,r),this.tooltip=(typeof t.tooltip=="string"?t.tooltip:t.tooltip?.value)??"",this.enabled=!t.precondition||o.contextMatchesRules(t.precondition),this.checked=void 0;let l;if(t.toggled){const c=t.toggled.condition?t.toggled:{condition:t.toggled};this.checked=o.contextMatchesRules(c.condition),this.checked&&c.tooltip&&(this.tooltip=typeof c.tooltip=="string"?c.tooltip:c.tooltip.value),this.checked&&Wt.isThemeIcon(c.icon)&&(l=c.icon),this.checked&&c.title&&(this.label=typeof c.title=="string"?c.title:c.title.value)}l||(l=Wt.isThemeIcon(t.icon)?t.icon:void 0),this.item=t,this.alt=i?new Sm(i,void 0,r,s,void 0,o,a):void 0,this._options=r,this.class=l&&Wt.asClassName(l)}run(...t){let i=[];return this._options?.arg&&(i=[...i,this._options.arg]),this._options?.shouldForwardArgs&&(i=[...i,...t]),this._commandService.executeCommand(this.id,...i)}};XA=Sm=__decorate([__param(5,$h),__param(6,GA)],XA);var Ese=nh(7526,"Extensions"),YA;(function(e){e[e.Installing=0]="Installing",e[e.Installed=1]="Installed",e[e.Uninstalling=2]="Uninstalling",e[e.Uninstalled=3]="Uninstalled"})(YA||(YA={}));var ZA;(function(e){e.ReloadWindow="reloadWindow",e.RestartExtensions="restartExtensions",e.DownloadUpdate="downloadUpdate",e.ApplyUpdate="applyUpdate",e.QuitAndInstall="quitAndInstall"})(ZA||(ZA={}));var e7=q("extensionsWorkbenchService"),t7;(function(e){e.Readme="readme",e.Features="features",e.Changelog="changelog",e.Dependencies="dependencies",e.ExtensionPack="extensionPack"})(t7||(t7={}));var i7=class extends X{constructor(t,i){super(),this.containers=t,this._register(i.onChange(this.update,this))}set extension(t){this.containers.forEach(i=>i.extension=t)}update(t){for(const i of this.containers)t&&i.extension?PH(i.extension.identifier,t.identifier)&&(i.extension.server&&t.server&&i.extension.server!==t.server?i.updateWhenCounterExtensionChanges&&i.update():i.extension=t):i.update()}};i7=__decorate([__param(1,e7)],i7);var Dse=new I("hasOutdatedExtensions",!1),kse=new I("hasGallery",!1),Ise=new I("extensionResultListFocused ",!0),Pse=new xm("extensionsSearchActionsMenu"),r7="vscode_searchExtensions_internal",Tse={id:r7,toolReferenceName:"extensions",canBeReferencedInPrompt:!0,icon:Wt.fromId(ue.extensions.id),supportsToolPicker:!0,displayName:h(7540,null),modelDescription:h(7541,null),source:{type:"internal"},inputSchema:{type:"object",properties:{category:{type:"string",description:"The category of extensions to search for",enum:GC},keywords:{type:"array",items:{type:"string"},description:"The keywords to search for"},ids:{type:"array",items:{type:"string"},description:"The ids of the extensions to search for"}}}},s7=class{constructor(t){this.extensionWorkbenchService=t}async invoke(t,i,r,s){const n=t.parameters;if(!n.keywords?.length&&!n.category&&!n.ids?.length)return{content:[{kind:"text",value:h(7542,null)}]};const o=new Map,a=u=>{for(const d of u)d.deprecationInfo||d.isMalicious||o.set(d.identifier.id.toLowerCase(),{id:d.identifier.id,name:d.displayName,description:d.description,installed:d.state===1,installCount:d.installCount??0,rating:d.rating??0,categories:d.categories??[],tags:d.gallery?.tags??[]})},l=async u=>{const d=await this.extensionWorkbenchService.queryGallery({text:u,pageSize:10,sortBy:"InstallCount"},s);d.firstPage.length&&a(d.firstPage)};if(n.ids?.length){const u=await this.extensionWorkbenchService.getExtensions(n.ids.map(d=>({id:d})),s);a(u)}if(n.keywords?.length)for(const u of n.keywords??[])if(u==="featured")await l("featured");else{let d=n.category?`category:"${n.category}"`:"";d=u?`${d} ${u}`.trim():d,await l(d)}else await l(`category:"${n.category}"`);const c=Array.from(o.values());return{content:[{kind:"text",value:`Here are the list of extensions:
${JSON.stringify(c)}
. Important: Use the following format to display extensions to the user because there is a renderer available to parse these extensions in this format and display them with all details. So, do not describe about the extensions to the user.
\`\`\`vscode-extensions
extensionId1,extensionId2
\`\`\`
.`}],toolResultDetails:{input:JSON.stringify(n),output:[{type:"text",value:JSON.stringify(c.map(u=>u.id))}]}}}};s7=__decorate([__param(0,e7)],s7);var n7=class{constructor(e){this._data=e}update(e){this._data=e}get data(){return this._data}get apiObject(){if(!this._apiObject){const e=this;this._apiObject=Object.freeze({get name(){return e._data.id},get description(){return e._data.modelDescription},get inputSchema(){return e._data.inputSchema},get tags(){return e._data.tags??[]}})}return this._apiObject}},lj=class{constructor(e,t){this._languageModels=t,this._registeredTools=new Map,this._tokenCountFuncs=new Map,this._allTools=new Map,this._proxy=e.getProxy(Q.MainThreadLanguageModelTools),this._proxy.$getTools().then(i=>{for(const r of i)this._allTools.set(r.id,new n7(kt(r)))})}async $countTokensForInvocation(e,t,i){const r=this._tokenCountFuncs.get(e);if(!r)throw new Error(`Tool invocation call ${e} not found`);return await r(t,i)}async invokeTool(e,t,i,r){const s=mt();i.tokenizationOptions&&this._tokenCountFuncs.set(s,i.tokenizationOptions.countTokens);try{if(i.toolInvocationToken&&!Xq(i.toolInvocationToken))throw new Error("Invalid tool invocation token");if((t===wb||t===zA)&&!nt(e,"chatParticipantPrivate"))throw new Error(`Invalid tool: ${t}`);const n=await this._proxy.$invokeTool({toolId:t,callId:s,parameters:i.input,tokenBudget:i.tokenizationOptions?.tokenBudget,context:i.toolInvocationToken,chatRequestId:nt(e,"chatParticipantPrivate")?i.chatRequestId:void 0,chatInteractionId:nt(e,"chatParticipantPrivate")?i.chatInteractionId:void 0},r),o=n instanceof wi?n.value:n;return fg.to(kt(o))}finally{this._tokenCountFuncs.delete(s)}}$onDidChangeTools(e){const t=new Set(this._registeredTools.keys());for(const i of e){t.delete(i.id);const r=this._allTools.get(i.id);r?r.update(i):this._allTools.set(i.id,new n7(kt(i)))}for(const i of t)this._allTools.delete(i)}getTools(e){return Array.from(this._allTools.values()).map(t=>t.apiObject).filter(t=>{switch(t.name){case wb:case zA:case tj:case r7:return nt(e,"chatParticipantPrivate");default:return!0}})}async $invokeTool(e,t){const i=this._registeredTools.get(e.toolId);if(!i)throw new Error(`Unknown tool ${e.toolId}`);const r={input:e.parameters,toolInvocationToken:e.context};nt(i.extension,"chatParticipantPrivate")&&(r.chatRequestId=e.chatRequestId,r.chatInteractionId=e.chatInteractionId,r.chatSessionId=e.context?.sessionId,e.toolSpecificData?.kind==="terminal"&&(r.terminalCommand=e.toolSpecificData.command)),nt(i.extension,"chatParticipantAdditions")&&e.modelId&&(r.model=await this.getModel(e.modelId,i.extension)),e.tokenBudget!==void 0&&(r.tokenizationOptions={tokenBudget:e.tokenBudget,countTokens:this._tokenCountFuncs.get(e.callId)||((o,a=Be.None)=>this._proxy.$countTokensForInvocation(e.callId,o,a))});let s;nt(i.extension,"toolProgress")&&(s={report:o=>{this._proxy.$acceptToolProgress(e.callId,{message:ve.fromStrict(o.message),increment:o.increment,total:100})}});const n=await mE(Promise.resolve(i.tool.invoke(r,t,s)),t);if(!n)throw new oi;return fg.from(n,i.extension)}async getModel(e,t){let i;if(e&&(i=await this._languageModels.getLanguageModelByIdentifier(t,e)),!i&&(i=await this._languageModels.getDefaultLanguageModel(t),!i))throw new Error("Language model unavailable");return i}async $prepareToolInvocation(e,t,i){const r=this._registeredTools.get(e);if(!r)throw new Error(`Unknown tool ${e}`);const s={input:t};if(nt(r.extension,"chatParticipantPrivate")&&r.tool.prepareInvocation2){const n=await r.tool.prepareInvocation2(s,i);return n?{confirmationMessages:n.confirmationMessages?{title:n.confirmationMessages.title,message:typeof n.confirmationMessages.message=="string"?n.confirmationMessages.message:ve.from(n.confirmationMessages.message)}:void 0,toolSpecificData:{kind:"terminal",language:n.language,command:n.command}}:void 0}else if(r.tool.prepareInvocation){const n=await r.tool.prepareInvocation(s,i);return n?((n.pastTenseMessage||n.presentation)&&M(r.extension,"chatParticipantPrivate"),{confirmationMessages:n.confirmationMessages?{title:n.confirmationMessages.title,message:typeof n.confirmationMessages.message=="string"?n.confirmationMessages.message:ve.from(n.confirmationMessages.message)}:void 0,invocationMessage:ve.fromStrict(n.invocationMessage),pastTenseMessage:ve.fromStrict(n.pastTenseMessage),presentation:n.presentation}):void 0}}registerTool(e,t,i){return this._registeredTools.set(t,{extension:e,tool:i}),this._proxy.$registerTool(t),ie(()=>{this._registeredTools.delete(t),this._proxy.$unregisterTool(t)})}},cj=class{constructor(e,t,i,r){this._documents=t,this._commands=i,this._uriTransformer=r,this._languageIds=[],this._handlePool=0,this._ids=new Set,this._proxy=e.getProxy(Q.MainThreadLanguages)}$acceptLanguageIds(e){this._languageIds=e}async getLanguages(){return this._languageIds.slice(0)}async changeLanguage(e,t){await this._proxy.$changeLanguage(e,t);const i=this._documents.getDocumentData(e);if(!i)throw new Error(`document '${e.toString()}' NOT found`);return i.document}async tokenAtPosition(e,t){const i=e.version,r=Qe.from(t),s=await this._proxy.$tokensAtPosition(e.uri,r),n={type:On.Other,range:e.getWordRangeAtPosition(t)??new Se(t.line,t.character,t.line,t.character)};if(!s)return n;const o={range:F.to(s.range),type:N0.to(s.type)};return!o.range.contains(t)||i!==e.version?n:o}createLanguageStatusItem(e,t,i){const r=this._handlePool++,s=this._proxy,n=this._ids,o=`${e.identifier.value}/${t}`;if(n.has(o))throw new Error(`LanguageStatusItem with id '${t}' ALREADY exists`);n.add(o);const a={selector:i,id:t,name:e.displayName??e.name,severity:Xa.Information,command:void 0,text:"",detail:"",busy:!1};let l;const c=new oe,u=()=>{if(l?.dispose(),!n.has(o)){console.warn(`LanguageStatusItem (${t}) from ${e.identifier.value} has been disposed and CANNOT be updated anymore`);return}l=$v(()=>{c.clear(),this._proxy.$setLanguageStatus(r,{id:o,name:a.name??e.displayName??e.name,source:e.displayName??e.name,selector:wl.from(a.selector,this._uriTransformer),label:a.text,detail:a.detail??"",severity:a.severity===Xa.Error?Ft.Error:a.severity===Xa.Warning?Ft.Warning:Ft.Info,command:a.command&&this._commands.toInternal(a.command,c),accessibilityInfo:a.accessibilityInformation,busy:a.busy})},0)},d={dispose(){c.dispose(),l?.dispose(),s.$removeLanguageStatus(r),n.delete(o)},get id(){return a.id},get name(){return a.name},set name(f){a.name=f,u()},get selector(){return a.selector},set selector(f){a.selector=f,u()},get text(){return a.text},set text(f){a.text=f,u()},set text2(f){M(e,"languageStatusText"),a.text=f,u()},get text2(){return M(e,"languageStatusText"),a.text},get detail(){return a.detail},set detail(f){a.detail=f,u()},get severity(){return a.severity},set severity(f){a.severity=f,u()},get accessibilityInformation(){return a.accessibilityInformation},set accessibilityInformation(f){a.accessibilityInformation=f,u()},get command(){return a.command},set command(f){a.command=f,u()},get busy(){return a.busy},set busy(f){a.busy=f,u()}};return u(),d}};function uj(e){return e&&e.title}var Sb=class{constructor(t,i){this._logService=i,this._proxy=t.getProxy(Q.MainThreadMessageService)}showMessage(t,i,r,s,n){const o={source:{identifier:t.identifier,label:t.displayName||t.name}};let a;typeof s=="string"||uj(s)?a=[s,...n]:(o.modal=s?.modal,o.useCustom=s?.useCustom,o.detail=s?.detail,a=n),o.useCustom&&M(t,"resolvers");const l=[];let c=!1;for(let u=0;u<a.length;u++){const d=a[u];if(typeof d=="string")l.push({title:d,handle:u,isCloseAffordance:!1});else if(typeof d=="object"){const{title:f,isCloseAffordance:p}=d;l.push({title:f,isCloseAffordance:!!p,handle:u}),p&&(c?this._logService.warn(`[${t.identifier}] Only one message item can have 'isCloseAffordance':`,d):c=!0)}else this._logService.warn(`[${t.identifier}] Invalid message item:`,d)}return this._proxy.$showMessage(i,r,o,l).then(u=>{if(typeof u=="number")return a[u]})}};Sb=__decorate([__param(1,ke)],Sb);var xb=class{constructor(e,t,i,r){this.start=e,this.deletedCount=t,this.deletedItems=i,this.items=r}asApiEvent(){return{range:new zs(this.start,this.start+this.deletedCount),addedCells:this.items.map(e=>e.apiCell),removedCells:this.deletedItems}}},Eb=class{static asModelAddData(e){return{EOL:e.eol,lines:e.source,languageId:e.language,uri:e.uri,isDirty:!1,versionId:1,encoding:"utf8"}}constructor(e,t,i){this.notebook=e,this._extHostDocument=t,this._cellData=i,this.handle=i.handle,this.uri=b.revive(i.uri),this.cellKind=i.cellKind,this._outputs=i.outputs.map(Un.to),this._internalMetadata=i.internalMetadata??{},this._metadata=Object.freeze(i.metadata??{}),this._previousResult=Object.freeze(Dl.to(i.internalMetadata??{}))}get internalMetadata(){return this._internalMetadata}get apiCell(){if(!this._apiCell){const e=this,t=this._extHostDocument.getDocument(this.uri);if(!t)throw new Error(`MISSING extHostDocument for notebook cell: ${this.uri}`);const i={get index(){return e.notebook.getCellIndex(e)},notebook:e.notebook.apiNotebook,kind:Uu.to(this._cellData.cellKind),document:t.document,get mime(){return e._mime},set mime(r){e._mime=r},get outputs(){return e._outputs.slice(0)},get metadata(){return e._metadata},get executionSummary(){return e._previousResult}};this._apiCell=Object.freeze(i)}return this._apiCell}setOutputs(e){this._outputs=e.map(Un.to)}setOutputItems(e,t,i){const r=i.map(Il.to),s=this._outputs.find(n=>n.id===e);if(s&&(t||(s.items.length=0),s.items.push(...r),s.items.length>1&&s.items.every(n=>LI(n.mime)))){const n=new Map,o=[];s.items.forEach(a=>{let l;n.has(a.mime)?l=n.get(a.mime):(l=[],n.set(a.mime,l),o.push(a.mime)),l.push(a.data)}),s.items.length=0,o.forEach(a=>{const l=g$(n.get(a));s.items.push({mime:a,data:l.data.buffer})})}}setMetadata(e){this._metadata=Object.freeze(e)}setInternalMetadata(e){this._internalMetadata=e,this._previousResult=Object.freeze(Dl.to(e))}setMime(e){}},dj=class W8{static{this._handlePool=0}constructor(t,i,r,s,n){this._proxy=t,this._textDocumentsAndEditors=i,this._textDocuments=r,this.uri=s,this.handle=W8._handlePool++,this._cells=[],this._versionId=0,this._isDirty=!1,this._disposed=!1,this._notebookType=n.viewType,this._metadata=Object.freeze(n.metadata??Object.create(null)),this._spliceNotebookCells([[0,0,n.cells]],!0,void 0),this._versionId=n.versionId}dispose(){this._disposed=!0}get versionId(){return this._versionId}get apiNotebook(){if(!this._notebook){const t=this,i={get uri(){return t.uri},get version(){return t._versionId},get notebookType(){return t._notebookType},get isDirty(){return t._isDirty},get isUntitled(){return t.uri.scheme===V.untitled},get isClosed(){return t._disposed},get metadata(){return t._metadata},get cellCount(){return t._cells.length},cellAt(r){return r=t._validateIndex(r),t._cells[r].apiCell},getCells(r){return(r?t._getCells(r):t._cells).map(n=>n.apiCell)},save(){return t._save()},[Symbol.for("debug.description")](){return`NotebookDocument(${this.uri.toString()})`}};this._notebook=Object.freeze(i)}return this._notebook}acceptDocumentPropertiesChanged(t){t.metadata&&(this._metadata=Object.freeze({...this._metadata,...t.metadata}))}acceptDirty(t){this._isDirty=t}acceptModelChanged(t,i,r){this._versionId=t.versionId,this._isDirty=i,this.acceptDocumentPropertiesChanged({metadata:r});const s={notebook:this.apiNotebook,metadata:r,cellChanges:[],contentChanges:[]},n=[];for(const a of t.rawEvents)a.kind===Nr.ModelChange?this._spliceNotebookCells(a.changes,!1,s.contentChanges):a.kind===Nr.Move?this._moveCells(a.index,a.length,a.newIdx,s.contentChanges):a.kind===Nr.Output?(this._setCellOutputs(a.index,a.outputs),n.push({cell:this._cells[a.index].apiCell,outputs:this._cells[a.index].apiCell.outputs})):a.kind===Nr.OutputItem?(this._setCellOutputItems(a.index,a.outputId,a.append,a.outputItems),n.push({cell:this._cells[a.index].apiCell,outputs:this._cells[a.index].apiCell.outputs})):a.kind===Nr.ChangeCellLanguage?(this._changeCellLanguage(a.index,a.language),n.push({cell:this._cells[a.index].apiCell,document:this._cells[a.index].apiCell.document})):a.kind===Nr.ChangeCellContent?n.push({cell:this._cells[a.index].apiCell,document:this._cells[a.index].apiCell.document}):a.kind===Nr.ChangeCellMime?this._changeCellMime(a.index,a.mime):a.kind===Nr.ChangeCellMetadata?(this._changeCellMetadata(a.index,a.metadata),n.push({cell:this._cells[a.index].apiCell,metadata:this._cells[a.index].apiCell.metadata})):a.kind===Nr.ChangeCellInternalMetadata&&(this._changeCellInternalMetadata(a.index,a.internalMetadata),n.push({cell:this._cells[a.index].apiCell,executionSummary:this._cells[a.index].apiCell.executionSummary}));const o=new Map;for(let a=0;a<n.length;a++){const l=n[a],c=o.get(l.cell);if(c===void 0){const u=s.cellChanges.push({document:void 0,executionSummary:void 0,metadata:void 0,outputs:void 0,...l});o.set(l.cell,u-1)}else s.cellChanges[c]={...s.cellChanges[c],...l}}return Object.freeze(s),Object.freeze(s.cellChanges),Object.freeze(s.contentChanges),s}_validateIndex(t){return t=t|0,t<0?0:t>=this._cells.length?this._cells.length-1:t}_validateRange(t){let i=t.start|0,r=t.end|0;return i<0&&(i=0),r>this._cells.length&&(r=this._cells.length),t.with({start:i,end:r})}_getCells(t){t=this._validateRange(t);const i=[];for(let r=t.start;r<t.end;r++)i.push(this._cells[r]);return i}async _save(){return this._disposed?Promise.reject(new Error("Notebook has been closed")):this._proxy.$trySaveNotebook(this.uri)}_spliceNotebookCells(t,i,r){if(this._disposed)return;const s=[],n=[],o=[];if(t.reverse().forEach(a=>{const c=a[2].map(f=>{const p=new Eb(this,this._textDocumentsAndEditors,f);return i||n.push(Eb.asModelAddData(f)),p}),u=new xb(a[0],a[1],[],c),d=this._cells.splice(a[0],a[1],...c);for(const f of d)o.push(f.uri),u.deletedItems.push(f.apiCell);s.push(u)}),this._textDocumentsAndEditors.acceptDocumentsAndEditorsDelta({addedDocuments:n,removedDocuments:o}),r)for(const a of s)r.push(a.asApiEvent())}_moveCells(t,i,r,s){const n=this._cells.splice(t,i);this._cells.splice(r,0,...n);const o=[new xb(t,i,n.map(a=>a.apiCell),[]),new xb(r,0,[],n)];for(const a of o)s.push(a.asApiEvent())}_setCellOutputs(t,i){this._cells[t].setOutputs(i)}_setCellOutputItems(t,i,r,s){this._cells[t].setOutputItems(i,r,s)}_changeCellLanguage(t,i){const r=this._cells[t];r.apiCell.document.languageId!==i&&this._textDocuments.$acceptModelLanguageChanged(r.uri,i)}_changeCellMime(t,i){const r=this._cells[t];r.apiCell.mime=i}_changeCellMetadata(t,i){this._cells[t].setMetadata(i)}_changeCellInternalMetadata(t,i){this._cells[t].setInternalMetadata(i)}getCellFromApiCell(t){return this._cells.find(i=>i.apiCell===t)}getCellFromIndex(t){return this._cells[t]}getCell(t){return this._cells.find(i=>i.handle===t)}getCellIndex(t){return this._cells.indexOf(t)}},Cb=class B8{static{this.apiEditorsToExtHost=new WeakMap}constructor(t,i,r,s,n,o,a){this.id=t,this._proxy=i,this.notebookData=r,this._visibleRanges=s,this._selections=n,this._viewColumn=o,this.viewType=a,this._visible=!1}get apiEditor(){if(!this._editor){const t=this;this._editor={get notebook(){return t.notebookData.apiNotebook},get selection(){return t._selections[0]},set selection(i){this.selections=[i]},get selections(){return t._selections},set selections(i){if(!Array.isArray(i)||!i.every(zs.isNotebookRange))throw De("selections");t._selections=i,t._trySetSelections(i)},get visibleRanges(){return t._visibleRanges},revealRange(i,r){t._proxy.$tryRevealRange(t.id,us.from(i),r??pp.Default)},get viewColumn(){return t._viewColumn},get replOptions(){if(t.viewType==="repl")return{appendIndex:this.notebook.cellCount-1}},[Symbol.for("debug.description")](){return`NotebookEditor(${this.notebook.uri.toString()})`}},B8.apiEditorsToExtHost.set(this._editor,this)}return this._editor}get visible(){return this._visible}_acceptVisibility(t){this._visible=t}_acceptVisibleRanges(t){this._visibleRanges=t}_acceptSelections(t){this._selections=t}_trySetSelections(t){this._proxy.$trySetSelections(this.id,t.map(us.from))}_acceptViewColumn(t){this._viewColumn=t}},Db=class{constructor(e,t){this.piece=e,this.color=t,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}next(){if(this.right!==le)return kb(this.right);let e=this;for(;e.parent!==le&&e.parent.left!==e;)e=e.parent;return e.parent===le?le:e.parent}prev(){if(this.left!==le)return a7(this.left);let e=this;for(;e.parent!==le&&e.parent.right!==e;)e=e.parent;return e.parent===le?le:e.parent}detach(){this.parent=null,this.left=null,this.right=null}},o7;(function(e){e[e.Black=0]="Black",e[e.Red=1]="Red"})(o7||(o7={}));var le=new Db(null,0);le.parent=le,le.left=le,le.right=le,le.color=0;function kb(e){for(;e.left!==le;)e=e.left;return e}function a7(e){for(;e.right!==le;)e=e.right;return e}function Ib(e){return e===le?0:e.size_left+e.piece.length+Ib(e.right)}function Pb(e){return e===le?0:e.lf_left+e.piece.lineFeedCnt+Pb(e.right)}function Tb(){le.parent=le}function kd(e,t){const i=t.right;i.size_left+=t.size_left+(t.piece?t.piece.length:0),i.lf_left+=t.lf_left+(t.piece?t.piece.lineFeedCnt:0),t.right=i.left,i.left!==le&&(i.left.parent=t),i.parent=t.parent,t.parent===le?e.root=i:t.parent.left===t?t.parent.left=i:t.parent.right=i,i.left=t,t.parent=i}function Id(e,t){const i=t.left;t.left=i.right,i.right!==le&&(i.right.parent=t),i.parent=t.parent,t.size_left-=i.size_left+(i.piece?i.piece.length:0),t.lf_left-=i.lf_left+(i.piece?i.piece.lineFeedCnt:0),t.parent===le?e.root=i:t===t.parent.right?t.parent.right=i:t.parent.left=i,i.right=t,t.parent=i}function Em(e,t){let i,r;if(t.left===le?(r=t,i=r.right):t.right===le?(r=t,i=r.left):(r=kb(t.right),i=r.right),r===e.root){e.root=i,i.color=0,t.detach(),Tb(),e.root.parent=le;return}const s=r.color===1;if(r===r.parent.left?r.parent.left=i:r.parent.right=i,r===t?(i.parent=r.parent,Pd(e,i)):(r.parent===t?i.parent=r:i.parent=r.parent,Pd(e,i),r.left=t.left,r.right=t.right,r.parent=t.parent,r.color=t.color,t===e.root?e.root=r:t===t.parent.left?t.parent.left=r:t.parent.right=r,r.left!==le&&(r.left.parent=r),r.right!==le&&(r.right.parent=r),r.size_left=t.size_left,r.lf_left=t.lf_left,Pd(e,r)),t.detach(),i.parent.left===i){const o=Ib(i),a=Pb(i);if(o!==i.parent.size_left||a!==i.parent.lf_left){const l=o-i.parent.size_left,c=a-i.parent.lf_left;i.parent.size_left=o,i.parent.lf_left=a,Ys(e,i.parent,l,c)}}if(Pd(e,i.parent),s){Tb();return}let n;for(;i!==e.root&&i.color===0;)i===i.parent.left?(n=i.parent.right,n.color===1&&(n.color=0,i.parent.color=1,kd(e,i.parent),n=i.parent.right),n.left.color===0&&n.right.color===0?(n.color=1,i=i.parent):(n.right.color===0&&(n.left.color=0,n.color=1,Id(e,n),n=i.parent.right),n.color=i.parent.color,i.parent.color=0,n.right.color=0,kd(e,i.parent),i=e.root)):(n=i.parent.left,n.color===1&&(n.color=0,i.parent.color=1,Id(e,i.parent),n=i.parent.left),n.left.color===0&&n.right.color===0?(n.color=1,i=i.parent):(n.left.color===0&&(n.right.color=0,n.color=1,kd(e,n),n=i.parent.left),n.color=i.parent.color,i.parent.color=0,n.left.color=0,Id(e,i.parent),i=e.root));i.color=0,Tb()}function l7(e,t){for(Pd(e,t);t!==e.root&&t.parent.color===1;)if(t.parent===t.parent.parent.left){const i=t.parent.parent.right;i.color===1?(t.parent.color=0,i.color=0,t.parent.parent.color=1,t=t.parent.parent):(t===t.parent.right&&(t=t.parent,kd(e,t)),t.parent.color=0,t.parent.parent.color=1,Id(e,t.parent.parent))}else{const i=t.parent.parent.left;i.color===1?(t.parent.color=0,i.color=0,t.parent.parent.color=1,t=t.parent.parent):(t===t.parent.left&&(t=t.parent,Id(e,t)),t.parent.color=0,t.parent.parent.color=1,kd(e,t.parent.parent))}e.root.color=0}function Ys(e,t,i,r){for(;t!==e.root&&t!==le;)t.parent.left===t&&(t.parent.size_left+=i,t.parent.lf_left+=r),t=t.parent}function Pd(e,t){let i=0,r=0;if(t!==e.root){for(;t!==e.root&&t===t.parent.right;)t=t.parent;if(t!==e.root)for(t=t.parent,i=Ib(t.left)-t.size_left,r=Pb(t.left)-t.lf_left,t.size_left+=i,t.lf_left+=r;t!==e.root&&(i!==0||r!==0);)t.parent.left===t&&(t.parent.size_left+=i,t.parent.lf_left+=r),t=t.parent}}var Zs=65535;function c7(e){let t;return e[e.length-1]<65536?t=new Uint16Array(e.length):t=new Uint32Array(e.length),t.set(e,0),t}var hj=class{constructor(e,t,i,r,s){this.lineStarts=e,this.cr=t,this.lf=i,this.crlf=r,this.isBasicASCII=s}};function en(e,t=!0){const i=[0];let r=1;for(let s=0,n=e.length;s<n;s++){const o=e.charCodeAt(s);o===13?s+1<n&&e.charCodeAt(s+1)===10?(i[r++]=s+2,s++):i[r++]=s+1:o===10&&(i[r++]=s+1)}return t?c7(i):i}function fj(e,t){e.length=0,e[0]=0;let i=1,r=0,s=0,n=0,o=!0;for(let l=0,c=t.length;l<c;l++){const u=t.charCodeAt(l);u===13?l+1<c&&t.charCodeAt(l+1)===10?(n++,e[i++]=l+2,l++):(r++,e[i++]=l+1):u===10?(s++,e[i++]=l+1):o&&u!==9&&(u<32||u>126)&&(o=!1)}const a=new hj(c7(e),r,s,n,o);return e.length=0,a}var Li=class{constructor(e,t,i,r,s){this.bufferIndex=e,this.start=t,this.end=i,this.lineFeedCnt=r,this.length=s}},na=class{constructor(e,t){this.buffer=e,this.lineStarts=t}},pj=class{constructor(e,t){this._pieces=[],this._tree=e,this._BOM=t,this._index=0,e.root!==le&&e.iterate(e.root,i=>(i!==le&&this._pieces.push(i.piece),!0))}read(){return this._pieces.length===0?this._index===0?(this._index++,this._BOM):null:this._index>this._pieces.length-1?null:this._index===0?this._BOM+this._tree.getPieceContent(this._pieces[this._index++]):this._tree.getPieceContent(this._pieces[this._index++])}},gj=class{constructor(e){this._limit=e,this._cache=[]}get(e){for(let t=this._cache.length-1;t>=0;t--){const i=this._cache[t];if(i.nodeStartOffset<=e&&i.nodeStartOffset+i.node.piece.length>=e)return i}return null}get2(e){for(let t=this._cache.length-1;t>=0;t--){const i=this._cache[t];if(i.nodeStartLineNumber&&i.nodeStartLineNumber<e&&i.nodeStartLineNumber+i.node.piece.lineFeedCnt>=e)return i}return null}set(e){this._cache.length>=this._limit&&this._cache.shift(),this._cache.push(e)}validate(e){let t=!1;const i=this._cache;for(let r=0;r<i.length;r++){const s=i[r];if(s.node.parent===null||s.nodeStartOffset>=e){i[r]=null,t=!0;continue}}if(t){const r=[];for(const s of i)s!==null&&r.push(s);this._cache=r}}},mj=class{constructor(e,t,i){this.create(e,t,i)}create(e,t,i){this._buffers=[new na("",[0])],this._lastChangeBufferPos={line:0,column:0},this.root=le,this._lineCnt=1,this._length=0,this._EOL=t,this._EOLLength=t.length,this._EOLNormalized=i;let r=null;for(let s=0,n=e.length;s<n;s++)if(e[s].buffer.length>0){e[s].lineStarts||(e[s].lineStarts=en(e[s].buffer));const o=new Li(s+1,{line:0,column:0},{line:e[s].lineStarts.length-1,column:e[s].buffer.length-e[s].lineStarts[e[s].lineStarts.length-1]},e[s].lineStarts.length-1,e[s].buffer.length);this._buffers.push(e[s]),r=this.rbInsertRight(r,o)}this._searchCache=new gj(1),this._lastVisitedLine={lineNumber:0,value:""},this.computeBufferMetadata()}normalizeEOL(e){const t=Zs,i=t-Math.floor(t/3),r=i*2;let s="",n=0;const o=[];if(this.iterate(this.root,a=>{const l=this.getNodeContent(a),c=l.length;if(n<=i||n+c<r)return s+=l,n+=c,!0;const u=s.replace(/\r\n|\r|\n/g,e);return o.push(new na(u,en(u))),s=l,n=c,!0}),n>0){const a=s.replace(/\r\n|\r|\n/g,e);o.push(new na(a,en(a)))}this.create(o,e,!0)}getEOL(){return this._EOL}setEOL(e){this._EOL=e,this._EOLLength=this._EOL.length,this.normalizeEOL(e)}createSnapshot(e){return new pj(this,e)}equal(e){if(this.getLength()!==e.getLength()||this.getLineCount()!==e.getLineCount())return!1;let t=0;return this.iterate(this.root,r=>{if(r===le)return!0;const s=this.getNodeContent(r),n=s.length,o=e.nodeAt(t),a=e.nodeAt(t+n),l=e.getValueInRange2(o,a);return t+=n,s===l})}getOffsetAt(e,t){let i=0,r=this.root;for(;r!==le;)if(r.left!==le&&r.lf_left+1>=e)r=r.left;else if(r.lf_left+r.piece.lineFeedCnt+1>=e){i+=r.size_left;const s=this.getAccumulatedValue(r,e-r.lf_left-2);return i+=s+t-1}else e-=r.lf_left+r.piece.lineFeedCnt,i+=r.size_left+r.piece.length,r=r.right;return i}getPositionAt(e){e=Math.floor(e),e=Math.max(0,e);let t=this.root,i=0;const r=e;for(;t!==le;)if(t.size_left!==0&&t.size_left>=e)t=t.left;else if(t.size_left+t.piece.length>=e){const s=this.getIndexOf(t,e-t.size_left);if(i+=t.lf_left+s.index,s.index===0){const n=this.getOffsetAt(i+1,1),o=r-n;return new sr(i+1,o+1)}return new sr(i+1,s.remainder+1)}else if(e-=t.size_left+t.piece.length,i+=t.lf_left+t.piece.lineFeedCnt,t.right===le){const s=this.getOffsetAt(i+1,1),n=r-e-s;return new sr(i+1,n+1)}else t=t.right;return new sr(1,1)}getValueInRange(e,t){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return"";const i=this.nodeAt2(e.startLineNumber,e.startColumn),r=this.nodeAt2(e.endLineNumber,e.endColumn),s=this.getValueInRange2(i,r);return t?t!==this._EOL||!this._EOLNormalized?s.replace(/\r\n|\r|\n/g,t):t===this.getEOL()&&this._EOLNormalized?s:s.replace(/\r\n|\r|\n/g,t):s}getValueInRange2(e,t){if(e.node===t.node){const o=e.node,a=this._buffers[o.piece.bufferIndex].buffer,l=this.offsetInBuffer(o.piece.bufferIndex,o.piece.start);return a.substring(l+e.remainder,l+t.remainder)}let i=e.node;const r=this._buffers[i.piece.bufferIndex].buffer,s=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);let n=r.substring(s+e.remainder,s+i.piece.length);for(i=i.next();i!==le;){const o=this._buffers[i.piece.bufferIndex].buffer,a=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);if(i===t.node){n+=o.substring(a,a+t.remainder);break}else n+=o.substr(a,i.piece.length);i=i.next()}return n}getLinesContent(){const e=[];let t=0,i="",r=!1;return this.iterate(this.root,s=>{if(s===le)return!0;const n=s.piece;let o=n.length;if(o===0)return!0;const a=this._buffers[n.bufferIndex].buffer,l=this._buffers[n.bufferIndex].lineStarts,c=n.start.line,u=n.end.line;let d=l[c]+n.start.column;if(r&&(a.charCodeAt(d)===10&&(d++,o--),e[t++]=i,i="",r=!1,o===0))return!0;if(c===u)return!this._EOLNormalized&&a.charCodeAt(d+o-1)===13?(r=!0,i+=a.substr(d,o-1)):i+=a.substr(d,o),!0;i+=this._EOLNormalized?a.substring(d,Math.max(d,l[c+1]-this._EOLLength)):a.substring(d,l[c+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=i;for(let f=c+1;f<u;f++)i=this._EOLNormalized?a.substring(l[f],l[f+1]-this._EOLLength):a.substring(l[f],l[f+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=i;return!this._EOLNormalized&&a.charCodeAt(l[u]+n.end.column-1)===13?(r=!0,n.end.column===0?t--:i=a.substr(l[u],n.end.column-1)):i=a.substr(l[u],n.end.column),!0}),r&&(e[t++]=i,i=""),e[t++]=i,e}getLength(){return this._length}getLineCount(){return this._lineCnt}getLineContent(e){return this._lastVisitedLine.lineNumber===e?this._lastVisitedLine.value:(this._lastVisitedLine.lineNumber=e,e===this._lineCnt?this._lastVisitedLine.value=this.getLineRawContent(e):this._EOLNormalized?this._lastVisitedLine.value=this.getLineRawContent(e,this._EOLLength):this._lastVisitedLine.value=this.getLineRawContent(e).replace(/(\r\n|\r|\n)$/,""),this._lastVisitedLine.value)}_getCharCode(e){if(e.remainder===e.node.piece.length){const t=e.node.next();if(!t)return 0;const i=this._buffers[t.piece.bufferIndex],r=this.offsetInBuffer(t.piece.bufferIndex,t.piece.start);return i.buffer.charCodeAt(r)}else{const t=this._buffers[e.node.piece.bufferIndex],r=this.offsetInBuffer(e.node.piece.bufferIndex,e.node.piece.start)+e.remainder;return t.buffer.charCodeAt(r)}}getLineCharCode(e,t){const i=this.nodeAt2(e,t+1);return this._getCharCode(i)}getLineLength(e){if(e===this.getLineCount()){const t=this.getOffsetAt(e,1);return this.getLength()-t}return this.getOffsetAt(e+1,1)-this.getOffsetAt(e,1)-this._EOLLength}getCharCode(e){const t=this.nodeAt(e);return this._getCharCode(t)}getNearestChunk(e){const t=this.nodeAt(e);if(t.remainder===t.node.piece.length){const i=t.node.next();if(!i||i===le)return"";const r=this._buffers[i.piece.bufferIndex],s=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);return r.buffer.substring(s,s+i.piece.length)}else{const i=this._buffers[t.node.piece.bufferIndex],r=this.offsetInBuffer(t.node.piece.bufferIndex,t.node.piece.start),s=r+t.remainder,n=r+t.node.piece.length;return i.buffer.substring(s,n)}}findMatchesInNode(e,t,i,r,s,n,o,a,l,c,u){const d=this._buffers[e.piece.bufferIndex],f=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start),p=this.offsetInBuffer(e.piece.bufferIndex,s),g=this.offsetInBuffer(e.piece.bufferIndex,n);let v;const y={line:0,column:0};let S,x;t._wordSeparators?(S=d.buffer.substring(p,g),x=P=>P+p,t.reset(0)):(S=d.buffer,x=P=>P,t.reset(p));do if(v=t.next(S),v){if(x(v.index)>=g)return c;this.positionInBuffer(e,x(v.index)-f,y);const P=this.getLineFeedCnt(e.piece.bufferIndex,s,y),$=y.line===s.line?y.column-s.column+r:y.column+1,A=$+v[0].length;if(u[c++]=pT(new je(i+P,$,i+P,A),v,a),x(v.index)+v[0].length>=g||c>=l)return c}while(v);return c}findMatchesLineByLine(e,t,i,r){const s=[];let n=0;const o=new jW(t.wordSeparators,t.regex);let a=this.nodeAt2(e.startLineNumber,e.startColumn);if(a===null)return[];const l=this.nodeAt2(e.endLineNumber,e.endColumn);if(l===null)return[];let c=this.positionInBuffer(a.node,a.remainder);const u=this.positionInBuffer(l.node,l.remainder);if(a.node===l.node)return this.findMatchesInNode(a.node,o,e.startLineNumber,e.startColumn,c,u,t,i,r,n,s),s;let d=e.startLineNumber,f=a.node;for(;f!==l.node;){const g=this.getLineFeedCnt(f.piece.bufferIndex,c,f.piece.end);if(g>=1){const y=this._buffers[f.piece.bufferIndex].lineStarts,S=this.offsetInBuffer(f.piece.bufferIndex,f.piece.start),x=y[c.line+g],P=d===e.startLineNumber?e.startColumn:1;if(n=this.findMatchesInNode(f,o,d,P,c,this.positionInBuffer(f,x-S),t,i,r,n,s),n>=r)return s;d+=g}const v=d===e.startLineNumber?e.startColumn-1:0;if(d===e.endLineNumber){const y=this.getLineContent(d).substring(v,e.endColumn-1);return n=this._findMatchesInLine(t,o,y,e.endLineNumber,v,n,s,i,r),s}if(n=this._findMatchesInLine(t,o,this.getLineContent(d).substr(v),d,v,n,s,i,r),n>=r)return s;d++,a=this.nodeAt2(d,1),f=a.node,c=this.positionInBuffer(a.node,a.remainder)}if(d===e.endLineNumber){const g=d===e.startLineNumber?e.startColumn-1:0,v=this.getLineContent(d).substring(g,e.endColumn-1);return n=this._findMatchesInLine(t,o,v,e.endLineNumber,g,n,s,i,r),s}const p=d===e.startLineNumber?e.startColumn:1;return n=this.findMatchesInNode(l.node,o,d,p,c,u,t,i,r,n,s),s}_findMatchesInLine(e,t,i,r,s,n,o,a,l){const c=e.wordSeparators;if(!a&&e.simpleSearch){const d=e.simpleSearch,f=d.length,p=i.length;let g=-f;for(;(g=i.indexOf(d,g+f))!==-1;)if((!c||gT(c,i,p,g,f))&&(o[n++]=new ry(new je(r,g+1+s,r,g+1+f+s),null),n>=l))return n;return n}let u;t.reset(0);do if(u=t.next(i),u&&(o[n++]=pT(new je(r,u.index+1+s,r,u.index+1+u[0].length+s),u,a),n>=l))return n;while(u);return n}insert(e,t,i=!1){if(this._EOLNormalized=this._EOLNormalized&&i,this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",this.root!==le){const{node:r,remainder:s,nodeStartOffset:n}=this.nodeAt(e),o=r.piece,a=o.bufferIndex,l=this.positionInBuffer(r,s);if(r.piece.bufferIndex===0&&o.end.line===this._lastChangeBufferPos.line&&o.end.column===this._lastChangeBufferPos.column&&n+o.length===e&&t.length<Zs){this.appendToNode(r,t),this.computeBufferMetadata();return}if(n===e)this.insertContentToNodeLeft(t,r),this._searchCache.validate(e);else if(n+r.piece.length>e){const c=[];let u=new Li(o.bufferIndex,l,o.end,this.getLineFeedCnt(o.bufferIndex,l,o.end),this.offsetInBuffer(a,o.end)-this.offsetInBuffer(a,l));if(this.shouldCheckCRLF()&&this.endWithCR(t)&&this.nodeCharCodeAt(r,s)===10){const g={line:u.start.line+1,column:0};u=new Li(u.bufferIndex,g,u.end,this.getLineFeedCnt(u.bufferIndex,g,u.end),u.length-1),t+=`
`}if(this.shouldCheckCRLF()&&this.startWithLF(t))if(this.nodeCharCodeAt(r,s-1)===13){const g=this.positionInBuffer(r,s-1);this.deleteNodeTail(r,g),t="\r"+t,r.piece.length===0&&c.push(r)}else this.deleteNodeTail(r,l);else this.deleteNodeTail(r,l);const d=this.createNewPieces(t);u.length>0&&this.rbInsertRight(r,u);let f=r;for(let p=0;p<d.length;p++)f=this.rbInsertRight(f,d[p]);this.deleteNodes(c)}else this.insertContentToNodeRight(t,r)}else{const r=this.createNewPieces(t);let s=this.rbInsertLeft(null,r[0]);for(let n=1;n<r.length;n++)s=this.rbInsertRight(s,r[n])}this.computeBufferMetadata()}delete(e,t){if(this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",t<=0||this.root===le)return;const i=this.nodeAt(e),r=this.nodeAt(e+t),s=i.node,n=r.node;if(s===n){const d=this.positionInBuffer(s,i.remainder),f=this.positionInBuffer(s,r.remainder);if(i.nodeStartOffset===e){if(t===s.piece.length){const p=s.next();Em(this,s),this.validateCRLFWithPrevNode(p),this.computeBufferMetadata();return}this.deleteNodeHead(s,f),this._searchCache.validate(e),this.validateCRLFWithPrevNode(s),this.computeBufferMetadata();return}if(i.nodeStartOffset+s.piece.length===e+t){this.deleteNodeTail(s,d),this.validateCRLFWithNextNode(s),this.computeBufferMetadata();return}this.shrinkNode(s,d,f),this.computeBufferMetadata();return}const o=[],a=this.positionInBuffer(s,i.remainder);this.deleteNodeTail(s,a),this._searchCache.validate(e),s.piece.length===0&&o.push(s);const l=this.positionInBuffer(n,r.remainder);this.deleteNodeHead(n,l),n.piece.length===0&&o.push(n);const c=s.next();for(let d=c;d!==le&&d!==n;d=d.next())o.push(d);const u=s.piece.length===0?s.prev():s;this.deleteNodes(o),this.validateCRLFWithNextNode(u),this.computeBufferMetadata()}insertContentToNodeLeft(e,t){const i=[];if(this.shouldCheckCRLF()&&this.endWithCR(e)&&this.startWithLF(t)){const n=t.piece,o={line:n.start.line+1,column:0},a=new Li(n.bufferIndex,o,n.end,this.getLineFeedCnt(n.bufferIndex,o,n.end),n.length-1);t.piece=a,e+=`
`,Ys(this,t,-1,-1),t.piece.length===0&&i.push(t)}const r=this.createNewPieces(e);let s=this.rbInsertLeft(t,r[r.length-1]);for(let n=r.length-2;n>=0;n--)s=this.rbInsertLeft(s,r[n]);this.validateCRLFWithPrevNode(s),this.deleteNodes(i)}insertContentToNodeRight(e,t){this.adjustCarriageReturnFromNext(e,t)&&(e+=`
`);const i=this.createNewPieces(e),r=this.rbInsertRight(t,i[0]);let s=r;for(let n=1;n<i.length;n++)s=this.rbInsertRight(s,i[n]);this.validateCRLFWithPrevNode(r)}positionInBuffer(e,t,i){const r=e.piece,s=e.piece.bufferIndex,n=this._buffers[s].lineStarts,a=n[r.start.line]+r.start.column+t;let l=r.start.line,c=r.end.line,u=0,d=0,f=0;for(;l<=c&&(u=l+(c-l)/2|0,f=n[u],u!==c);)if(d=n[u+1],a<f)c=u-1;else if(a>=d)l=u+1;else break;return i?(i.line=u,i.column=a-f,null):{line:u,column:a-f}}getLineFeedCnt(e,t,i){if(i.column===0)return i.line-t.line;const r=this._buffers[e].lineStarts;if(i.line===r.length-1)return i.line-t.line;const s=r[i.line+1],n=r[i.line]+i.column;if(s>n+1)return i.line-t.line;const o=n-1;return this._buffers[e].buffer.charCodeAt(o)===13?i.line-t.line+1:i.line-t.line}offsetInBuffer(e,t){return this._buffers[e].lineStarts[t.line]+t.column}deleteNodes(e){for(let t=0;t<e.length;t++)Em(this,e[t])}createNewPieces(e){if(e.length>Zs){const c=[];for(;e.length>Zs;){const d=e.charCodeAt(Zs-1);let f;d===13||d>=55296&&d<=56319?(f=e.substring(0,Zs-1),e=e.substring(Zs-1)):(f=e.substring(0,Zs),e=e.substring(Zs));const p=en(f);c.push(new Li(this._buffers.length,{line:0,column:0},{line:p.length-1,column:f.length-p[p.length-1]},p.length-1,f.length)),this._buffers.push(new na(f,p))}const u=en(e);return c.push(new Li(this._buffers.length,{line:0,column:0},{line:u.length-1,column:e.length-u[u.length-1]},u.length-1,e.length)),this._buffers.push(new na(e,u)),c}let t=this._buffers[0].buffer.length;const i=en(e,!1);let r=this._lastChangeBufferPos;if(this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-1]===t&&t!==0&&this.startWithLF(e)&&this.endWithCR(this._buffers[0].buffer)){this._lastChangeBufferPos={line:this._lastChangeBufferPos.line,column:this._lastChangeBufferPos.column+1},r=this._lastChangeBufferPos;for(let c=0;c<i.length;c++)i[c]+=t+1;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(i.slice(1)),this._buffers[0].buffer+="_"+e,t+=1}else{if(t!==0)for(let c=0;c<i.length;c++)i[c]+=t;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(i.slice(1)),this._buffers[0].buffer+=e}const s=this._buffers[0].buffer.length,n=this._buffers[0].lineStarts.length-1,o=s-this._buffers[0].lineStarts[n],a={line:n,column:o},l=new Li(0,r,a,this.getLineFeedCnt(0,r,a),s-t);return this._lastChangeBufferPos=a,[l]}getLinesRawContent(){return this.getContentOfSubTree(this.root)}getLineRawContent(e,t=0){let i=this.root,r="";const s=this._searchCache.get2(e);if(s){i=s.node;const n=this.getAccumulatedValue(i,e-s.nodeStartLineNumber-1),o=this._buffers[i.piece.bufferIndex].buffer,a=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);if(s.nodeStartLineNumber+i.piece.lineFeedCnt===e)r=o.substring(a+n,a+i.piece.length);else{const l=this.getAccumulatedValue(i,e-s.nodeStartLineNumber);return o.substring(a+n,a+l-t)}}else{let n=0;const o=e;for(;i!==le;)if(i.left!==le&&i.lf_left>=e-1)i=i.left;else if(i.lf_left+i.piece.lineFeedCnt>e-1){const a=this.getAccumulatedValue(i,e-i.lf_left-2),l=this.getAccumulatedValue(i,e-i.lf_left-1),c=this._buffers[i.piece.bufferIndex].buffer,u=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);return n+=i.size_left,this._searchCache.set({node:i,nodeStartOffset:n,nodeStartLineNumber:o-(e-1-i.lf_left)}),c.substring(u+a,u+l-t)}else if(i.lf_left+i.piece.lineFeedCnt===e-1){const a=this.getAccumulatedValue(i,e-i.lf_left-2),l=this._buffers[i.piece.bufferIndex].buffer,c=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);r=l.substring(c+a,c+i.piece.length);break}else e-=i.lf_left+i.piece.lineFeedCnt,n+=i.size_left+i.piece.length,i=i.right}for(i=i.next();i!==le;){const n=this._buffers[i.piece.bufferIndex].buffer;if(i.piece.lineFeedCnt>0){const o=this.getAccumulatedValue(i,0),a=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);return r+=n.substring(a,a+o-t),r}else{const o=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);r+=n.substr(o,i.piece.length)}i=i.next()}return r}computeBufferMetadata(){let e=this.root,t=1,i=0;for(;e!==le;)t+=e.lf_left+e.piece.lineFeedCnt,i+=e.size_left+e.piece.length,e=e.right;this._lineCnt=t,this._length=i,this._searchCache.validate(this._length)}getIndexOf(e,t){const i=e.piece,r=this.positionInBuffer(e,t),s=r.line-i.start.line;if(this.offsetInBuffer(i.bufferIndex,i.end)-this.offsetInBuffer(i.bufferIndex,i.start)===t){const n=this.getLineFeedCnt(e.piece.bufferIndex,i.start,r);if(n!==s)return{index:n,remainder:0}}return{index:s,remainder:r.column}}getAccumulatedValue(e,t){if(t<0)return 0;const i=e.piece,r=this._buffers[i.bufferIndex].lineStarts,s=i.start.line+t+1;return s>i.end.line?r[i.end.line]+i.end.column-r[i.start.line]-i.start.column:r[s]-r[i.start.line]-i.start.column}deleteNodeTail(e,t){const i=e.piece,r=i.lineFeedCnt,s=this.offsetInBuffer(i.bufferIndex,i.end),n=t,o=this.offsetInBuffer(i.bufferIndex,n),a=this.getLineFeedCnt(i.bufferIndex,i.start,n),l=a-r,c=o-s,u=i.length+c;e.piece=new Li(i.bufferIndex,i.start,n,a,u),Ys(this,e,c,l)}deleteNodeHead(e,t){const i=e.piece,r=i.lineFeedCnt,s=this.offsetInBuffer(i.bufferIndex,i.start),n=t,o=this.getLineFeedCnt(i.bufferIndex,n,i.end),a=this.offsetInBuffer(i.bufferIndex,n),l=o-r,c=s-a,u=i.length+c;e.piece=new Li(i.bufferIndex,n,i.end,o,u),Ys(this,e,c,l)}shrinkNode(e,t,i){const r=e.piece,s=r.start,n=r.end,o=r.length,a=r.lineFeedCnt,l=t,c=this.getLineFeedCnt(r.bufferIndex,r.start,l),u=this.offsetInBuffer(r.bufferIndex,t)-this.offsetInBuffer(r.bufferIndex,s);e.piece=new Li(r.bufferIndex,r.start,l,c,u),Ys(this,e,u-o,c-a);const d=new Li(r.bufferIndex,i,n,this.getLineFeedCnt(r.bufferIndex,i,n),this.offsetInBuffer(r.bufferIndex,n)-this.offsetInBuffer(r.bufferIndex,i)),f=this.rbInsertRight(e,d);this.validateCRLFWithPrevNode(f)}appendToNode(e,t){this.adjustCarriageReturnFromNext(t,e)&&(t+=`
`);const i=this.shouldCheckCRLF()&&this.startWithLF(t)&&this.endWithCR(e),r=this._buffers[0].buffer.length;this._buffers[0].buffer+=t;const s=en(t,!1);for(let f=0;f<s.length;f++)s[f]+=r;if(i){const f=this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-2];this._buffers[0].lineStarts.pop(),this._lastChangeBufferPos={line:this._lastChangeBufferPos.line-1,column:r-f}}this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(s.slice(1));const n=this._buffers[0].lineStarts.length-1,o=this._buffers[0].buffer.length-this._buffers[0].lineStarts[n],a={line:n,column:o},l=e.piece.length+t.length,c=e.piece.lineFeedCnt,u=this.getLineFeedCnt(0,e.piece.start,a),d=u-c;e.piece=new Li(e.piece.bufferIndex,e.piece.start,a,u,l),this._lastChangeBufferPos=a,Ys(this,e,t.length,d)}nodeAt(e){let t=this.root;const i=this._searchCache.get(e);if(i)return{node:i.node,nodeStartOffset:i.nodeStartOffset,remainder:e-i.nodeStartOffset};let r=0;for(;t!==le;)if(t.size_left>e)t=t.left;else if(t.size_left+t.piece.length>=e){r+=t.size_left;const s={node:t,remainder:e-t.size_left,nodeStartOffset:r};return this._searchCache.set(s),s}else e-=t.size_left+t.piece.length,r+=t.size_left+t.piece.length,t=t.right;return null}nodeAt2(e,t){let i=this.root,r=0;for(;i!==le;)if(i.left!==le&&i.lf_left>=e-1)i=i.left;else if(i.lf_left+i.piece.lineFeedCnt>e-1){const s=this.getAccumulatedValue(i,e-i.lf_left-2),n=this.getAccumulatedValue(i,e-i.lf_left-1);return r+=i.size_left,{node:i,remainder:Math.min(s+t-1,n),nodeStartOffset:r}}else if(i.lf_left+i.piece.lineFeedCnt===e-1){const s=this.getAccumulatedValue(i,e-i.lf_left-2);if(s+t-1<=i.piece.length)return{node:i,remainder:s+t-1,nodeStartOffset:r};t-=i.piece.length-s;break}else e-=i.lf_left+i.piece.lineFeedCnt,r+=i.size_left+i.piece.length,i=i.right;for(i=i.next();i!==le;){if(i.piece.lineFeedCnt>0){const s=this.getAccumulatedValue(i,0),n=this.offsetOfNode(i);return{node:i,remainder:Math.min(t-1,s),nodeStartOffset:n}}else if(i.piece.length>=t-1){const s=this.offsetOfNode(i);return{node:i,remainder:t-1,nodeStartOffset:s}}else t-=i.piece.length;i=i.next()}return null}nodeCharCodeAt(e,t){if(e.piece.lineFeedCnt<1)return-1;const i=this._buffers[e.piece.bufferIndex],r=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start)+t;return i.buffer.charCodeAt(r)}offsetOfNode(e){if(!e)return 0;let t=e.size_left;for(;e!==this.root;)e.parent.right===e&&(t+=e.parent.size_left+e.parent.piece.length),e=e.parent;return t}shouldCheckCRLF(){return!(this._EOLNormalized&&this._EOL===`
`)}startWithLF(e){if(typeof e=="string")return e.charCodeAt(0)===10;if(e===le||e.piece.lineFeedCnt===0)return!1;const t=e.piece,i=this._buffers[t.bufferIndex].lineStarts,r=t.start.line,s=i[r]+t.start.column;return r===i.length-1||i[r+1]>s+1?!1:this._buffers[t.bufferIndex].buffer.charCodeAt(s)===10}endWithCR(e){return typeof e=="string"?e.charCodeAt(e.length-1)===13:e===le||e.piece.lineFeedCnt===0?!1:this.nodeCharCodeAt(e,e.piece.length-1)===13}validateCRLFWithPrevNode(e){if(this.shouldCheckCRLF()&&this.startWithLF(e)){const t=e.prev();this.endWithCR(t)&&this.fixCRLF(t,e)}}validateCRLFWithNextNode(e){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const t=e.next();this.startWithLF(t)&&this.fixCRLF(e,t)}}fixCRLF(e,t){const i=[],r=this._buffers[e.piece.bufferIndex].lineStarts;let s;e.piece.end.column===0?s={line:e.piece.end.line-1,column:r[e.piece.end.line]-r[e.piece.end.line-1]-1}:s={line:e.piece.end.line,column:e.piece.end.column-1};const n=e.piece.length-1,o=e.piece.lineFeedCnt-1;e.piece=new Li(e.piece.bufferIndex,e.piece.start,s,o,n),Ys(this,e,-1,-1),e.piece.length===0&&i.push(e);const a={line:t.piece.start.line+1,column:0},l=t.piece.length-1,c=this.getLineFeedCnt(t.piece.bufferIndex,a,t.piece.end);t.piece=new Li(t.piece.bufferIndex,a,t.piece.end,c,l),Ys(this,t,-1,-1),t.piece.length===0&&i.push(t);const u=this.createNewPieces(`\r
`);this.rbInsertRight(e,u[0]);for(let d=0;d<i.length;d++)Em(this,i[d])}adjustCarriageReturnFromNext(e,t){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const i=t.next();if(this.startWithLF(i)){if(e+=`
`,i.piece.length===1)Em(this,i);else{const r=i.piece,s={line:r.start.line+1,column:0},n=r.length-1,o=this.getLineFeedCnt(r.bufferIndex,s,r.end);i.piece=new Li(r.bufferIndex,s,r.end,o,n),Ys(this,i,-1,-1)}return!0}}return!1}iterate(e,t){if(e===le)return t(le);const i=this.iterate(e.left,t);return i&&t(e)&&this.iterate(e.right,t)}getNodeContent(e){if(e===le)return"";const t=this._buffers[e.piece.bufferIndex],i=e.piece,r=this.offsetInBuffer(i.bufferIndex,i.start),s=this.offsetInBuffer(i.bufferIndex,i.end);return t.buffer.substring(r,s)}getPieceContent(e){const t=this._buffers[e.bufferIndex],i=this.offsetInBuffer(e.bufferIndex,e.start),r=this.offsetInBuffer(e.bufferIndex,e.end);return t.buffer.substring(i,r)}rbInsertRight(e,t){const i=new Db(t,1);if(i.left=le,i.right=le,i.parent=le,i.size_left=0,i.lf_left=0,this.root===le)this.root=i,i.color=0;else if(e.right===le)e.right=i,i.parent=e;else{const s=kb(e.right);s.left=i,i.parent=s}return l7(this,i),i}rbInsertLeft(e,t){const i=new Db(t,1);if(i.left=le,i.right=le,i.parent=le,i.size_left=0,i.lf_left=0,this.root===le)this.root=i,i.color=0;else if(e.left===le)e.left=i,i.parent=e;else{const r=a7(e.left);r.right=i,i.parent=r}return l7(this,i),i}getContentOfSubTree(e){let t="";return this.iterate(e,i=>(t+=this.getNodeContent(i),!0)),t}},u7;(function(e){e[e.Unknown=0]="Unknown",e[e.Invalid=3]="Invalid",e[e.LF=1]="LF",e[e.CRLF=2]="CRLF"})(u7||(u7={}));function Ab(e){let t=0,i=0,r=0,s=0;for(let n=0,o=e.length;n<o;n++){const a=e.charCodeAt(n);a===13?(t===0&&(i=n),t++,n+1<o&&e.charCodeAt(n+1)===10?(s|=2,n++):s|=3,r=n+1):a===10&&(s|=1,t===0&&(i=n),t++,r=n+1)}return t===0&&(i=e.length),[t,i,e.length-r,s]}var Rb;function vj(){return Rb||(Rb=new TextDecoder("UTF-16LE")),Rb}function _j(e,t,i){const r=new Uint16Array(e.buffer,t,i);return i>0&&(r[0]===65279||r[0]===65534)?wj(e,t,i):vj().decode(r)}function wj(e,t,i){const r=[];let s=0;for(let n=0;n<i;n++){const o=tN(e,t);t+=2,r[s++]=String.fromCharCode(o)}return r.join("")}function Cm(e){return e.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}var yj=class _s{get oldLength(){return this.oldText.length}get oldEnd(){return this.oldPosition+this.oldText.length}get newLength(){return this.newText.length}get newEnd(){return this.newPosition+this.newText.length}constructor(t,i,r,s){this.oldPosition=t,this.oldText=i,this.newPosition=r,this.newText=s}toString(){return this.oldText.length===0?`(insert@${this.oldPosition} "${Cm(this.newText)}")`:this.newText.length===0?`(delete@${this.oldPosition} "${Cm(this.oldText)}")`:`(replace@${this.oldPosition} "${Cm(this.oldText)}" with "${Cm(this.newText)}")`}static _writeStringSize(t){return 4+2*t.length}static _writeString(t,i,r){const s=i.length;Ch(t,s,r),r+=4;for(let n=0;n<s;n++)iN(t,i.charCodeAt(n),r),r+=2;return r}static _readString(t,i){const r=Eh(t,i);return i+=4,_j(t,i,r)}writeSize(){return 8+_s._writeStringSize(this.oldText)+_s._writeStringSize(this.newText)}write(t,i){return Ch(t,this.oldPosition,i),i+=4,Ch(t,this.newPosition,i),i+=4,i=_s._writeString(t,this.oldText,i),i=_s._writeString(t,this.newText,i),i}static read(t,i,r){const s=Eh(t,i);i+=4;const n=Eh(t,i);i+=4;const o=_s._readString(t,i);i+=_s._writeStringSize(o);const a=_s._readString(t,i);return i+=_s._writeStringSize(a),r.push(new _s(s,o,n,a)),i}},bj=class qd extends X{constructor(t,i,r,s,n,o,a){super(),this._onDidChangeContent=this._register(new D),this.onDidChangeContent=this._onDidChangeContent.event,this._BOM=i,this._mightContainNonBasicASCII=!o,this._mightContainRTL=s,this._mightContainUnusualLineTerminators=n,this._pieceTree=new mj(t,r,a)}equals(t){return!(t instanceof qd)||this._BOM!==t._BOM||this.getEOL()!==t.getEOL()?!1:this._pieceTree.equal(t._pieceTree)}mightContainRTL(){return this._mightContainRTL}mightContainUnusualLineTerminators(){return this._mightContainUnusualLineTerminators}resetMightContainUnusualLineTerminators(){this._mightContainUnusualLineTerminators=!1}mightContainNonBasicASCII(){return this._mightContainNonBasicASCII}getBOM(){return this._BOM}getEOL(){return this._pieceTree.getEOL()}createSnapshot(t){return this._pieceTree.createSnapshot(t?this._BOM:"")}getOffsetAt(t,i){return this._pieceTree.getOffsetAt(t,i)}getPositionAt(t){return this._pieceTree.getPositionAt(t)}getRangeAt(t,i){const r=t+i,s=this.getPositionAt(t),n=this.getPositionAt(r);return new je(s.lineNumber,s.column,n.lineNumber,n.column)}getValueInRange(t,i=0){if(t.isEmpty())return"";const r=this._getEndOfLine(i);return this._pieceTree.getValueInRange(t,r)}getValueLengthInRange(t,i=0){if(t.isEmpty())return 0;if(t.startLineNumber===t.endLineNumber)return t.endColumn-t.startColumn;const r=this.getOffsetAt(t.startLineNumber,t.startColumn),s=this.getOffsetAt(t.endLineNumber,t.endColumn);let n=0;const o=this._getEndOfLine(i),a=this.getEOL();if(o.length!==a.length){const l=o.length-a.length,c=t.endLineNumber-t.startLineNumber;n=l*c}return s-r+n}getCharacterCountInRange(t,i=0){if(this._mightContainNonBasicASCII){let r=0;const s=t.startLineNumber,n=t.endLineNumber;for(let o=s;o<=n;o++){const a=this.getLineContent(o),l=o===s?t.startColumn-1:0,c=o===n?t.endColumn-1:a.length;for(let u=l;u<c;u++)fh(a.charCodeAt(u))?(r=r+1,u=u+1):r=r+1}return r+=this._getEndOfLine(i).length*(n-s),r}return this.getValueLengthInRange(t,i)}getNearestChunk(t){return this._pieceTree.getNearestChunk(t)}getLength(){return this._pieceTree.getLength()}getLineCount(){return this._pieceTree.getLineCount()}getLinesContent(){return this._pieceTree.getLinesContent()}getLineContent(t){return this._pieceTree.getLineContent(t)}getLineCharCode(t,i){return this._pieceTree.getLineCharCode(t,i)}getCharCode(t){return this._pieceTree.getCharCode(t)}getLineLength(t){return this._pieceTree.getLineLength(t)}getLineMinColumn(t){return 1}getLineMaxColumn(t){return this.getLineLength(t)+1}getLineFirstNonWhitespaceColumn(t){const i=Dv(this.getLineContent(t));return i===-1?0:i+1}getLineLastNonWhitespaceColumn(t){const i=QL(this.getLineContent(t));return i===-1?0:i+2}_getEndOfLine(t){switch(t){case 1:return`
`;case 2:return`\r
`;case 0:return this.getEOL();default:throw new Error("Unknown EOL preference")}}setEOL(t){this._pieceTree.setEOL(t)}applyEdits(t,i,r){let s=this._mightContainRTL,n=this._mightContainUnusualLineTerminators,o=this._mightContainNonBasicASCII,a=!0,l=[];for(let v=0;v<t.length;v++){const y=t[v];a&&y._isTracked&&(a=!1);const S=y.range;if(y.text){let W=!0;o||(W=!t3(y.text),o=W),!s&&W&&(s=jx(y.text)),!n&&W&&(n=Gx(y.text))}let x="",P=0,$=0,A=0;if(y.text){let W;[P,$,A,W]=Ab(y.text);const G=this.getEOL();W===0||W===(G===`\r
`?2:1)?x=y.text:x=y.text.replace(/\r\n|\r|\n/g,G)}l[v]={sortIndex:v,identifier:y.identifier||null,range:S,rangeOffset:this.getOffsetAt(S.startLineNumber,S.startColumn),rangeLength:this.getValueLengthInRange(S),text:x,eolCount:P,firstLineLength:$,lastLineLength:A,forceMoveMarkers:!!y.forceMoveMarkers,isAutoWhitespaceEdit:y.isAutoWhitespaceEdit||!1}}l.sort(qd._sortOpsAscending);let c=!1;for(let v=0,y=l.length-1;v<y;v++){const S=l[v].range.getEndPosition(),x=l[v+1].range.getStartPosition();if(x.isBeforeOrEqual(S)){if(x.isBefore(S))throw new Error("Overlapping ranges are not allowed!");c=!0}}a&&(l=this._reduceOperations(l));const u=r||i?qd._getInverseEditRanges(l):[],d=[];if(i)for(let v=0;v<l.length;v++){const y=l[v],S=u[v];if(y.isAutoWhitespaceEdit&&y.range.isEmpty())for(let x=S.startLineNumber;x<=S.endLineNumber;x++){let P="";x===S.startLineNumber&&(P=this.getLineContent(y.range.startLineNumber),Dv(P)!==-1)||d.push({lineNumber:x,oldContent:P})}}let f=null;if(r){let v=0;f=[];for(let y=0;y<l.length;y++){const S=l[y],x=u[y],P=this.getValueInRange(S.range),$=S.rangeOffset+v;v+=S.text.length-P.length,f[y]={sortIndex:S.sortIndex,identifier:S.identifier,range:x,text:P,textChange:new yj(S.rangeOffset,P,$,S.text)}}c||f.sort((y,S)=>y.sortIndex-S.sortIndex)}this._mightContainRTL=s,this._mightContainUnusualLineTerminators=n,this._mightContainNonBasicASCII=o;const p=this._doApplyEdits(l);let g=null;if(i&&d.length>0){d.sort((v,y)=>y.lineNumber-v.lineNumber),g=[];for(let v=0,y=d.length;v<y;v++){const S=d[v].lineNumber;if(v>0&&d[v-1].lineNumber===S)continue;const x=d[v].oldContent,P=this.getLineContent(S);P.length===0||P===x||Dv(P)!==-1||g.push(S)}}return this._onDidChangeContent.fire(),new VW(f,p,g)}_reduceOperations(t){return t.length<1e3?t:[this._toSingleEditOperation(t)]}_toSingleEditOperation(t){let i=!1;const r=t[0].range,s=t[t.length-1].range,n=new je(r.startLineNumber,r.startColumn,s.endLineNumber,s.endColumn);let o=r.startLineNumber,a=r.startColumn;const l=[];for(let p=0,g=t.length;p<g;p++){const v=t[p],y=v.range;i=i||v.forceMoveMarkers,l.push(this.getValueInRange(new je(o,a,y.startLineNumber,y.startColumn))),v.text.length>0&&l.push(v.text),o=y.endLineNumber,a=y.endColumn}const c=l.join(""),[u,d,f]=Ab(c);return{sortIndex:0,identifier:t[0].identifier,range:n,rangeOffset:this.getOffsetAt(n.startLineNumber,n.startColumn),rangeLength:this.getValueLengthInRange(n,0),text:c,eolCount:u,firstLineLength:d,lastLineLength:f,forceMoveMarkers:i,isAutoWhitespaceEdit:!1}}_doApplyEdits(t){t.sort(qd._sortOpsDescending);const i=[];for(let r=0;r<t.length;r++){const s=t[r],n=s.range.startLineNumber,o=s.range.startColumn,a=s.range.endLineNumber,l=s.range.endColumn;if(n===a&&o===l&&s.text.length===0)continue;s.text?(this._pieceTree.delete(s.rangeOffset,s.rangeLength),this._pieceTree.insert(s.rangeOffset,s.text,!0)):this._pieceTree.delete(s.rangeOffset,s.rangeLength);const c=new je(n,o,a,l);i.push({range:c,rangeLength:s.rangeLength,text:s.text,rangeOffset:s.rangeOffset,forceMoveMarkers:s.forceMoveMarkers})}return i}findMatchesLineByLine(t,i,r,s){return this._pieceTree.findMatchesLineByLine(t,i,r,s)}getPieceTree(){return this._pieceTree}static _getInverseEditRange(t,i){const r=t.startLineNumber,s=t.startColumn,[n,o,a]=Ab(i);let l;if(i.length>0){const c=n+1;c===1?l=new je(r,s,r,s+o):l=new je(r,s,r+c-1,a+1)}else l=new je(r,s,r,s);return l}static _getInverseEditRanges(t){const i=[];let r=0,s=0,n=null;for(let o=0,a=t.length;o<a;o++){const l=t[o];let c,u;n?n.range.endLineNumber===l.range.startLineNumber?(c=r,u=s+(l.range.startColumn-n.range.endColumn)):(c=r+(l.range.startLineNumber-n.range.endLineNumber),u=l.range.startColumn):(c=l.range.startLineNumber,u=l.range.startColumn);let d;if(l.text.length>0){const f=l.eolCount+1;f===1?d=new je(c,u,c,u+l.firstLineLength):d=new je(c,u,c+f-1,l.lastLineLength+1)}else d=new je(c,u,c,u);r=d.endLineNumber,s=d.endColumn,i.push(d),n=l}return i}static _sortOpsAscending(t,i){const r=je.compareRangesUsingEnds(t.range,i.range);return r===0?t.sortIndex-i.sortIndex:r}static _sortOpsDescending(t,i){const r=je.compareRangesUsingEnds(t.range,i.range);return r===0?i.sortIndex-t.sortIndex:-r}},Sj=class{constructor(e,t,i,r,s,n,o,a,l){this._chunks=e,this._bom=t,this._cr=i,this._lf=r,this._crlf=s,this._containsRTL=n,this._containsUnusualLineTerminators=o,this._isBasicASCII=a,this._normalizeEOL=l}_getEOL(e){const t=this._cr+this._lf+this._crlf,i=this._cr+this._crlf;return t===0?e===1?`
`:`\r
`:i>t/2?`\r
`:`
`}create(e){const t=this._getEOL(e),i=this._chunks;if(this._normalizeEOL&&(t===`\r
`&&(this._cr>0||this._lf>0)||t===`
`&&(this._cr>0||this._crlf>0)))for(let s=0,n=i.length;s<n;s++){const o=i[s].buffer.replace(/\r\n|\r|\n/g,t),a=en(o);i[s]=new na(o,a)}const r=new bj(i,this._bom,t,this._containsRTL,this._containsUnusualLineTerminators,this._isBasicASCII,this._normalizeEOL);return{textBuffer:r,disposable:r}}getFirstLineText(e){return this._chunks[0].buffer.substr(0,e).split(/\r\n|\r|\n/)[0]}},d7=class{constructor(){this.chunks=[],this.BOM="",this._hasPreviousChar=!1,this._previousChar=0,this._tmpLineStarts=[],this.cr=0,this.lf=0,this.crlf=0,this.containsRTL=!1,this.containsUnusualLineTerminators=!1,this.isBasicASCII=!0}acceptChunk(e){if(e.length===0)return;this.chunks.length===0&&a3(e)&&(this.BOM=o3,e=e.substr(1));const t=e.charCodeAt(e.length-1);t===13||t>=55296&&t<=56319?(this._acceptChunk1(e.substr(0,e.length-1),!1),this._hasPreviousChar=!0,this._previousChar=t):(this._acceptChunk1(e,!1),this._hasPreviousChar=!1,this._previousChar=t)}_acceptChunk1(e,t){!t&&e.length===0||(this._hasPreviousChar?this._acceptChunk2(String.fromCharCode(this._previousChar)+e):this._acceptChunk2(e))}_acceptChunk2(e){const t=fj(this._tmpLineStarts,e);this.chunks.push(new na(e,t.lineStarts)),this.cr+=t.cr,this.lf+=t.lf,this.crlf+=t.crlf,t.isBasicASCII||(this.isBasicASCII=!1,this.containsRTL||(this.containsRTL=jx(e)),this.containsUnusualLineTerminators||(this.containsUnusualLineTerminators=Gx(e)))}finish(e=!0){return this._finish(),new Sj(this.chunks,this.BOM,this.cr,this.lf,this.crlf,this.containsRTL,this.containsUnusualLineTerminators,this.isBasicASCII,e)}_finish(){if(this.chunks.length===0&&this._acceptChunk1("",!0),this._hasPreviousChar){this._hasPreviousChar=!1;const e=this.chunks[this.chunks.length-1];e.buffer+=String.fromCharCode(this._previousChar);const t=en(e.buffer);e.lineStarts=t,this._previousChar===13&&this.cr++}}},xj=class extends X{constructor(e,t,i){super(),this._source=e,this._inputTextBuffer=t,this._outputs=i,this._outputTextBuffers=void 0}_getFullModelRange(e){const t=e.getLineCount();return new je(1,1,t,this._getLineMaxColumn(e,t))}_getLineMaxColumn(e,t){if(t<1||t>e.getLineCount())throw new Error("Illegal value for lineNumber");return e.getLineLength(t)+1}get inputTextBuffer(){if(!this._inputTextBuffer){const e=new d7;e.acceptChunk(this._source);const t=e.finish(!0),{textBuffer:i,disposable:r}=t.create(1);this._inputTextBuffer=i,this._register(r)}return this._inputTextBuffer}get outputTextBuffers(){return this._outputTextBuffers||(this._outputTextBuffers=this._outputs.map(e=>{const t=new d7;t.acceptChunk(e);const i=t.finish(!0),{textBuffer:r,disposable:s}=i.create(1);return this._register(s),r})),this._outputTextBuffers}findInInputs(e){const i=new hT(e,!1,!1,null).parseSearchRequest();if(!i)return[];const r=this._getFullModelRange(this.inputTextBuffer);return this.inputTextBuffer.findMatchesLineByLine(r,i,!0,5e3)}findInOutputs(e){const i=new hT(e,!1,!1,null).parseSearchRequest();return i?this.outputTextBuffers.map(r=>{const s=r.findMatchesLineByLine(this._getFullModelRange(r),i,!0,5e3);if(s.length!==0)return{textBuffer:r,matches:s}}).filter(r=>!!r):[]}};function h7(e,t){let i=-1;const r=[];let s=[];return e.forEach(o=>{o.range.startLineNumber!==i&&s.length>0&&(r.push([...s]),s=[]),s.push(o),i=o.range.endLineNumber}),s.length>0&&r.push([...s]),r.map(o=>{const a=[],l=o[0].range.startLineNumber,c=o[o.length-1].range.endLineNumber;for(let u=l;u<=c;u++)a.push(t.getLineContent(u));return new l5(a.join(`
`)+`
`,o.map(u=>new je(u.range.startLineNumber-1,u.range.startColumn-1,u.range.endLineNumber-1,u.range.endColumn-1)))})}var Lse=Object.freeze({id:"application",order:100,title:h(4245,null),type:"object"}),Ej=Object.freeze({id:"workbench",order:7,title:h(4246,null),type:"object"}),Cj=Object.freeze({id:"security",scope:1,title:h(4247,null),type:"object",order:7}),Nse=Object.freeze({id:"problems",title:h(4248,null),type:"object",order:101}),Dj=Object.freeze({id:"window",order:8,title:h(4249,null),type:"object"}),kj={ConfigurationMigration:"base.contributions.configuration.migration"},Ij=class{constructor(){this.migrations=[],this._onDidRegisterConfigurationMigrations=new D,this.onDidRegisterConfigurationMigration=this._onDidRegisterConfigurationMigrations.event}registerConfigurationMigrations(e){this.migrations.push(...e)}},Dm=new Ij;Xt.add(kj.ConfigurationMigration,Dm);var f7=class extends X{static{this.ID="workbench.contrib.configurationMigration"}constructor(t,i){super(),this.configurationService=t,this.workspaceService=i,this._register(this.workspaceService.onDidChangeWorkspaceFolders(async r=>{for(const s of r.added)await this.migrateConfigurationsForFolder(s,Dm.migrations)})),this.migrateConfigurations(Dm.migrations),this._register(Dm.onDidRegisterConfigurationMigration(r=>this.migrateConfigurations(r)))}async migrateConfigurations(t){await this.migrateConfigurationsForFolder(void 0,t);for(const i of this.workspaceService.getWorkspace().folders)await this.migrateConfigurationsForFolder(i,t)}async migrateConfigurationsForFolder(t,i){await Promise.all([i.map(r=>this.migrateConfigurationsForFolderAndOverride(r,t?.uri))])}async migrateConfigurationsForFolderAndOverride(t,i){const r=this.configurationService.inspect(t.key,{resource:i}),s=this.workspaceService.getWorkbenchState()===3?[["user",2],["userLocal",3],["userRemote",4],["workspace",5],["workspaceFolder",6]]:[["user",2],["userLocal",3],["userRemote",4],["workspace",5]];for(const[n,o]of s){const a=r[n];if(!a)continue;const l=[];if(a.value!==void 0){const c=await this.runMigration(t,n,a.value,i,void 0);for(const u of c??[])l.push([u,[]])}for(const{identifiers:c,value:u}of a.overrides??[])if(u!==void 0){const d=await this.runMigration(t,n,u,i,c);for(const f of d??[])l.push([f,c])}l.length&&await Promise.allSettled(l.map(async([[c,u],d])=>this.configurationService.updateValue(c,u.value,{resource:i,overrideIdentifiers:d},o)))}}async runMigration(t,i,r,s,n){const o=l=>{const u=this.configurationService.inspect(l,{resource:s})[i];if(u)return n?u.overrides?.find(({identifiers:d})=>Ei(d,n))?.value:u.value},a=await t.migrateFn(r,o);return Array.isArray(a)?a:[[t.key,a]]}};f7=__decorate([__param(0,Us),__param(1,Uh)],f7);var p7=class extends X{static{this.ID="workbench.contrib.dynamicWorkbenchSecurityConfiguration"}constructor(t){super(),this.remoteAgentService=t,this._ready=new hr,this.ready=this._ready.p,this.create()}async create(){try{await this.doCreate()}finally{this._ready.complete()}}async doCreate(){if(!Ve&&(await this.remoteAgentService.getEnvironment())?.os!==1)return;Xt.as(Do.Configuration).registerConfiguration({...Cj,properties:{"security.allowedUNCHosts":{type:"array",items:{type:"string",pattern:"^[^\\\\]+$",patternErrorMessage:h(4250,null)},default:[],markdownDescription:h(4251,null),scope:3},"security.restrictUNCAccess":{type:"boolean",default:!0,markdownDescription:h(4252,null),scope:3}}})}};p7=__decorate([__param(0,_T)],p7);var Td="window.newWindowProfile",g7=class extends X{static{this.ID="workbench.contrib.dynamicWindowConfiguration"}constructor(t,i){super(),this.userDataProfilesService=t,this.configurationService=i,this.registerNewWindowProfileConfiguration(),this._register(this.userDataProfilesService.onDidChangeProfiles(r=>this.registerNewWindowProfileConfiguration())),this.setNewWindowProfile(),this.checkAndResetNewWindowProfileConfig(),this._register(i.onDidChangeConfiguration(r=>{r.source!==7&&r.affectsConfiguration(Td)&&this.setNewWindowProfile()})),this._register(this.userDataProfilesService.onDidChangeProfiles(()=>this.checkAndResetNewWindowProfileConfig()))}registerNewWindowProfileConfiguration(){const t=Xt.as(Do.Configuration),i={...Dj,properties:{[Td]:{type:["string","null"],default:null,enum:[...this.userDataProfilesService.profiles.map(r=>r.name),null],enumItemLabels:[...this.userDataProfilesService.profiles.map(r=>""),h(4253,null)],description:h(4254,null),scope:1}}};this.configurationNode?t.updateConfigurations({add:[i],remove:[this.configurationNode]}):t.registerConfiguration(i),this.configurationNode=i}setNewWindowProfile(){const t=this.configurationService.getValue(Td);this.newWindowProfile=t?this.userDataProfilesService.profiles.find(i=>i.name===t):void 0}checkAndResetNewWindowProfileConfig(){const t=this.configurationService.getValue(Td);if(!t)return;const i=this.newWindowProfile?this.userDataProfilesService.profiles.find(r=>r.id===this.newWindowProfile.id):void 0;t!==i?.name&&this.configurationService.updateValue(Td,i?.name)}};g7=__decorate([__param(0,B$),__param(1,Us)],g7);var $se=q("editorResolverService"),Pj=Xt.as(Do.Configuration),Tj={...Ej,properties:{"workbench.editorAssociations":{type:"object",markdownDescription:h(13946,null),additionalProperties:{type:"string"}}}};Pj.registerConfiguration(Tj);var Lb;(function(e){e.builtin="builtin",e.option="option",e.exclusive="exclusive",e.default="default"})(Lb||(Lb={}));var m7;(function(e){e[e.ABORT=1]="ABORT",e[e.NONE=2]="NONE"})(m7||(m7={}));function Aj(e,t){if(new Set([V.extension,V.webviewPanel,V.vscodeWorkspaceTrust,V.vscodeSettings]).has(t.scheme))return!1;const s=typeof e=="string"&&e.indexOf($e.sep)>=0?`${t.scheme}:${t.path}`:ir(t);return Va(typeof e=="string"?e.toLowerCase():e,s.toLowerCase())}var Rj=class jd{static{this._notebookStatusBarItemProviderHandlePool=0}get activeNotebookEditor(){return this._activeNotebookEditor?.apiEditor}get visibleNotebookEditors(){return this._visibleNotebookEditors.map(t=>t.apiEditor)}constructor(t,i,r,s,n,o,a){this._textDocumentsAndEditors=r,this._textDocuments=s,this._extHostFileSystem=n,this._extHostSearch=o,this._logService=a,this._notebookStatusBarItemProviders=new Map,this._documents=new Vt,this._editors=new Map,this._onDidChangeActiveNotebookEditor=new D,this.onDidChangeActiveNotebookEditor=this._onDidChangeActiveNotebookEditor.event,this._visibleNotebookEditors=[],this._onDidOpenNotebookDocument=new D,this.onDidOpenNotebookDocument=this._onDidOpenNotebookDocument.event,this._onDidCloseNotebookDocument=new D,this.onDidCloseNotebookDocument=this._onDidCloseNotebookDocument.event,this._onDidChangeVisibleNotebookEditors=new D,this.onDidChangeVisibleNotebookEditors=this._onDidChangeVisibleNotebookEditors.event,this._statusBarCache=new jr("NotebookCellStatusBarCache"),this._handlePool=0,this._notebookSerializer=new Map,this._notebookProxy=t.getProxy(Q.MainThreadNotebook),this._notebookDocumentsProxy=t.getProxy(Q.MainThreadNotebookDocuments),this._notebookEditorsProxy=t.getProxy(Q.MainThreadNotebookEditors),this._commandsConverter=i.converter,i.registerArgumentProcessor({processArgument:l=>{if(l&&l.$mid===13){const c=l.notebookEditor?.notebookUri,u=l.cell.handle,f=this._documents.get(c)?.getCell(u);if(f)return f.apiCell}if(l&&l.$mid===14){const c=l.uri,u=this._documents.get(c);if(u)return u.apiNotebook}return l}}),jd._registerApiCommands(i)}getEditorById(t){const i=this._editors.get(t);if(!i)throw new Error(`unknown text editor: ${t}. known editors: ${[...this._editors.keys()]} `);return i}getIdByEditor(t){for(const[i,r]of this._editors)if(r.apiEditor===t)return i}get notebookDocuments(){return[...this._documents.values()]}getNotebookDocument(t,i){const r=this._documents.get(t);if(!r&&!i)throw new Error(`NO notebook document for '${t}'`);return r}static _convertNotebookRegistrationData(t,i){if(!i)return;const r=i.filenamePattern.map(s=>Kp.from(s)).filter(s=>s!==void 0);if(i.filenamePattern&&!r){console.warn(`Notebook content provider view options file name pattern is invalid ${i.filenamePattern}`);return}return{extension:t.identifier,providerDisplayName:t.displayName||t.name,displayName:i.displayName,filenamePattern:r,priority:i.exclusive?Lb.exclusive:void 0}}registerNotebookCellStatusBarItemProvider(t,i,r){const s=jd._notebookStatusBarItemProviderHandlePool++,n=typeof r.onDidChangeCellStatusBarItems=="function"?jd._notebookStatusBarItemProviderHandlePool++:void 0;this._notebookStatusBarItemProviders.set(s,r),this._notebookProxy.$registerNotebookCellStatusBarItemProvider(s,n,i);let o;return n!==void 0&&(o=r.onDidChangeCellStatusBarItems(a=>this._notebookProxy.$emitCellStatusBarEvent(n))),new Ie(()=>{this._notebookStatusBarItemProviders.delete(s),this._notebookProxy.$unregisterNotebookCellStatusBarItemProvider(s,n),o?.dispose()})}async createNotebookDocument(t){const i=await this._notebookDocumentsProxy.$tryCreateNotebook({viewType:t.viewType,content:t.content&&Hn.from(t.content)});return b.revive(i)}async openNotebookDocument(t){const i=this._documents.get(t);if(i)return i.apiNotebook;const r=await this._notebookDocumentsProxy.$tryOpenNotebook(t),s=this._documents.get(b.revive(r));return Sa(s?.apiNotebook)}async showNotebookDocument(t,i){let r;typeof i=="object"?r={position:jt.from(i.viewColumn),preserveFocus:i.preserveFocus,selections:i.selections&&i.selections.map(us.from),pinned:typeof i.preview=="boolean"?!i.preview:void 0,label:typeof i.asRepl=="string"?i.asRepl:typeof i.asRepl=="object"?i.asRepl.label:void 0}:r={preserveFocus:!1,pinned:!0};const s=i?.asRepl?"repl":t.notebookType,n=await this._notebookEditorsProxy.$tryShowNotebookDocument(t.uri,s,r),o=n&&this._editors.get(n)?.apiEditor;if(o)return o;throw n?new Error(`Could NOT open editor for "${t.uri.toString()}" because another editor opened in the meantime.`):new Error(`Could NOT open editor for "${t.uri.toString()}".`)}async $provideNotebookCellStatusBarItems(t,i,r,s){const n=this._notebookStatusBarItemProviders.get(t),o=b.revive(i),a=this._documents.get(o);if(!a||!n)return;const l=a.getCellFromIndex(r);if(!l)return;const c=await n.provideCellStatusBarItems(l.apiCell,s);if(!c)return;const u=new oe,d=this._statusBarCache.add([u]),p=(Array.isArray(c)?c:[c]).map(g=>X0.from(g,this._commandsConverter,u));return{cacheId:d,items:p}}$releaseNotebookCellStatusBarItems(t){this._statusBarCache.delete(t)}registerNotebookSerializer(t,i,r,s,n){if(dh(i))throw new Error("viewType cannot be empty or just whitespace");const o=this._handlePool++;return this._notebookSerializer.set(o,{viewType:i,serializer:r,options:s}),this._notebookProxy.$registerNotebookSerializer(o,{id:t.identifier,location:t.extensionLocation},i,Z0.from(s),jd._convertNotebookRegistrationData(t,n)),ie(()=>{this._notebookProxy.$unregisterNotebookSerializer(o)})}async $dataToNotebook(t,i,r){const s=this._notebookSerializer.get(t);if(!s)throw new Error("NO serializer found");const n=await s.serializer.deserializeNotebook(i.buffer,r);return new wi(Hn.from(n))}async $notebookToData(t,i,r){const s=this._notebookSerializer.get(t);if(!s)throw new Error("NO serializer found");const n=await s.serializer.serializeNotebook(Hn.to(i.value),r);return z.wrap(n)}async $saveNotebook(t,i,r,s,n){const o=b.revive(i),a=this._notebookSerializer.get(t);if(this.trace(`enter saveNotebook(versionId: ${r}, ${o.toString()})`),!a)throw new Error("NO serializer found");const l=this._documents.get(o);if(!l)throw new Error("Document NOT found");if(l.versionId!==r)throw new Error("Document version mismatch");if(!this._extHostFileSystem.value.isWritableFileSystem(o.scheme))throw new H1(h(2933,null,this._resourceForError(o)),6);const c={metadata:cC(l.apiNotebook.metadata,g=>!(a.options?.transientDocumentMetadata??{})[g]),cells:[]};for(const g of l.apiNotebook.getCells()){const v=new dp(g.kind,g.document.getText(),g.document.languageId,g.mime,a.options?.transientOutputs?[]:[...g.outputs],g.metadata,g.executionSummary);v.metadata=cC(g.metadata,y=>!(a.options?.transientCellMetadata??{})[y]),c.cells.push(v)}if(await this._validateWriteFile(o,s),n.isCancellationRequested)throw new Error("canceled");const u=await a.serializer.serializeNotebook(c,n);if(n.isCancellationRequested)throw new Error("canceled");this.trace(`serialized versionId: ${r} ${o.toString()}`),await this._extHostFileSystem.value.writeFile(o,u),this.trace(`Finished write versionId: ${r} ${o.toString()}`);const d=this._extHostFileSystem.getFileSystemProviderExtUri(o.scheme),f=await this._extHostFileSystem.value.stat(o),p={name:d.basename(o),isFile:(f.type&qi.File)!==0,isDirectory:(f.type&qi.Directory)!==0,isSymbolicLink:(f.type&qi.SymbolicLink)!==0,mtime:f.mtime,ctime:f.ctime,size:f.size,readonly:!!((f.permissions??0)&En.Readonly)||!this._extHostFileSystem.value.isWritableFileSystem(o.scheme),locked:!!((f.permissions??0)&En.Locked),etag:Rk({mtime:f.mtime,size:f.size}),children:void 0};return this.trace(`exit saveNotebook(versionId: ${r}, ${o.toString()})`),p}async $searchInNotebooks(t,i,r,s,n){const o=this._notebookSerializer.get(t)?.serializer;if(!o)return{limitHit:!1,results:[]};const a=new ox;await(async(f,p,g)=>{await Promise.all(f.map(async v=>await Promise.all(v.filenamePatterns.map(y=>{const S={_reason:g._reason,folderQueries:g.folderQueries,includePattern:g.includePattern,excludePattern:g.excludePattern,maxResults:g.maxResults,type:1,filePattern:y};return this._extHostSearch.doInternalFileSearchWithCustomCallback(S,p,x=>{x.forEach(P=>{a.has(P)||s.some(A=>v.isFromSettings&&!A.isFromSettings?!1:A.filenamePatterns.some(W=>Aj(W,P)))||a.add(P)})}).catch(x=>{if(x.code==="ENOENT")return console.warn("Could not find notebook search results, ignoring notebook results."),{limitHit:!1,messages:[]};throw x})}))))})(r,n,i);const c=new Vt;let u=!1;const d=Array.from(a).map(async f=>{const p=[];try{if(n.isCancellationRequested)return;if(i.maxResults&&[...c.values()].reduce((S,x)=>S+x.cellResults.length,0)>i.maxResults){u=!0;return}const g=[],v=this._documents.get(f);if(v)v.apiNotebook.getCells().forEach(x=>g.push({input:x.document.getText(),outputs:x.outputs.flatMap(P=>P.items.map($=>$.data.toString()))}));else{const S=await this._extHostFileSystem.value.readFile(f),x=z.fromString(S.toString()),P=await o.deserializeNotebook(x.buffer,n);if(n.isCancellationRequested)return;Hn.from(P).cells.forEach(A=>g.push({input:A.source,outputs:A.outputs.flatMap(W=>W.items.map(G=>G.valueBytes.toString()))}))}if(n.isCancellationRequested)return;g.forEach((S,x)=>{const P=i.contentPattern.pattern,$=new xj(S.input,void 0,S.outputs),A=$.findInInputs(P),W=$.findInOutputs(P),G=W.flatMap(J=>h7(J.matches,J.textBuffer)).map((J,H)=>(J.webviewIndex=H,J));if(A.length>0||W.length>0){const J={index:x,contentResults:h7(A,$.inputTextBuffer),webviewResults:G};p.push(J)}});const y={resource:f,cellResults:p};c.set(f,y);return}catch{return}});return await Promise.all(d),{limitHit:u,results:[...c.values()]}}async _validateWriteFile(t,i){const r=await this._extHostFileSystem.value.stat(t);if(typeof i?.mtime=="number"&&typeof i.etag=="string"&&i.etag!==cF&&typeof r.mtime=="number"&&typeof r.size=="number"&&i.mtime<r.mtime&&i.etag!==Rk({mtime:i.mtime,size:r.size}))throw new H1(h(2934,null),3,i)}_resourceForError(t){return t.scheme===V.file?t.fsPath:t.toString()}_createExtHostEditor(t,i,r){if(this._editors.has(i))throw new Error(`editor with id ALREADY EXSIST: ${i}`);const s=new Cb(i,this._notebookEditorsProxy,t,r.visibleRanges.map(us.to),r.selections.map(us.to),typeof r.viewColumn=="number"?jt.to(r.viewColumn):void 0,r.viewType);this._editors.set(i,s)}$acceptDocumentAndEditorsDelta(t){if(t.value.removedDocuments)for(const r of t.value.removedDocuments){const s=b.revive(r),n=this._documents.get(s);n&&(n.dispose(),this._documents.delete(s),this._textDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({removedDocuments:n.apiNotebook.getCells().map(o=>o.document.uri)}),this._onDidCloseNotebookDocument.fire(n.apiNotebook));for(const o of this._editors.values())o.notebookData.uri.toString()===s.toString()&&this._editors.delete(o.id)}if(t.value.addedDocuments){const r=[];for(const s of t.value.addedDocuments){const n=b.revive(s.uri);if(this._documents.has(n))throw new Error(`adding EXISTING notebook ${n} `);const o=new dj(this._notebookDocumentsProxy,this._textDocumentsAndEditors,this._textDocuments,n,s);r.push(...s.cells.map(a=>Eb.asModelAddData(a))),this._documents.get(n)?.dispose(),this._documents.set(n,o),this._textDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({addedDocuments:r}),this._onDidOpenNotebookDocument.fire(o.apiNotebook)}}if(t.value.addedEditors)for(const r of t.value.addedEditors){if(this._editors.has(r.id))return;const s=b.revive(r.documentUri),n=this._documents.get(s);n&&this._createExtHostEditor(n,r.id,r)}const i=[];if(t.value.removedEditors)for(const r of t.value.removedEditors){const s=this._editors.get(r);s&&(this._editors.delete(r),this._activeNotebookEditor?.id===s.id&&(this._activeNotebookEditor=void 0),i.push(s))}if(t.value.visibleEditors){this._visibleNotebookEditors=t.value.visibleEditors.map(s=>this._editors.get(s)).filter(s=>!!s);const r=new Set;this._visibleNotebookEditors.forEach(s=>r.add(s.id));for(const s of this._editors.values()){const n=r.has(s.id);s._acceptVisibility(n)}this._visibleNotebookEditors=[...this._editors.values()].map(s=>s).filter(s=>s.visible),this._onDidChangeVisibleNotebookEditors.fire(this.visibleNotebookEditors)}t.value.newActiveEditor===null?this._activeNotebookEditor=void 0:t.value.newActiveEditor&&(this._editors.get(t.value.newActiveEditor)||console.error(`FAILED to find active notebook editor ${t.value.newActiveEditor}`),this._activeNotebookEditor=this._editors.get(t.value.newActiveEditor)),t.value.newActiveEditor!==void 0&&this._onDidChangeActiveNotebookEditor.fire(this._activeNotebookEditor?.apiEditor)}static _registerApiCommands(t){const i=U.String.with("notebookType","A notebook type"),r=new me("vscode.executeDataToNotebook","_executeDataToNotebook","Invoke notebook serializer",[i,new U("data","Bytes to convert to data",n=>n instanceof Uint8Array,n=>z.wrap(n))],new ge("Notebook Data",n=>Hn.to(n.value))),s=new me("vscode.executeNotebookToData","_executeNotebookToData","Invoke notebook serializer",[i,new U("NotebookData","Notebook data to convert to bytes",n=>!0,n=>new wi(Hn.from(n)))],new ge("Bytes",n=>n.buffer));t.registerApiCommand(r),t.registerApiCommand(s)}trace(t){this._logService.trace(`[Extension Host Notebook] ${t}`)}},Lj=class{constructor(e,t,i,r={timeout:1500,errors:3}){this._logService=e,this._notebooksAndEditors=t,this._mainThreadBulkEdits=i,this._thresholds=r,this._onWillSaveNotebookDocumentEvent=new pc}dispose(){}getOnWillSaveNotebookDocumentEvent(e){return(t,i,r)=>{const s=function(o){t.call(i,o)};return s.extension=e,this._onWillSaveNotebookDocumentEvent.event(s,void 0,r)}}async $participateInSave(e,t,i){const r=b.revive(e),s=this._notebooksAndEditors.getNotebookDocument(r);if(!s)throw new Error("Unable to resolve notebook document");const n=[];if(await this._onWillSaveNotebookDocumentEvent.fireAsync({notebook:s.apiNotebook,reason:Gp.to(t)},i,async(a,l)=>{const c=Date.now(),u=await await Promise.resolve(a);Date.now()-c>this._thresholds.timeout&&this._logService.warn("onWillSaveNotebookDocument-listener from extension",l.extension.identifier),!i.isCancellationRequested&&u&&(u instanceof Ao?n.push(u):this._logService.warn("onWillSaveNotebookDocument-listener from extension",l.extension.identifier,"ignored due to invalid data"))}),i.isCancellationRequested)return!1;if(n.length===0)return!0;const o={edits:[]};for(const a of n){const{edits:l}=Qi.from(a);o.edits=o.edits.concat(l)}return this._mainThreadBulkEdits.$tryApplyWorkspaceEdit(new wi(o))}},Nj=class{constructor(e){this._notebooksAndEditors=e,this._onDidSaveNotebookDocument=new D,this.onDidSaveNotebookDocument=this._onDidSaveNotebookDocument.event,this._onDidChangeNotebookDocument=new D,this.onDidChangeNotebookDocument=this._onDidChangeNotebookDocument.event}$acceptModelChanged(e,t,i,r){const n=this._notebooksAndEditors.getNotebookDocument(b.revive(e)).acceptModelChanged(t.value,i,r);this._onDidChangeNotebookDocument.fire(n)}$acceptDirtyStateChanged(e,t){this._notebooksAndEditors.getNotebookDocument(b.revive(e)).acceptDirty(t)}$acceptModelSaved(e){const t=this._notebooksAndEditors.getNotebookDocument(b.revive(e));this._onDidSaveNotebookDocument.fire(t.apiNotebook)}},Nb=class{constructor(t,i){this._logService=t,this._notebooksAndEditors=i,this._onDidChangeNotebookEditorSelection=new D,this._onDidChangeNotebookEditorVisibleRanges=new D,this.onDidChangeNotebookEditorSelection=this._onDidChangeNotebookEditorSelection.event,this.onDidChangeNotebookEditorVisibleRanges=this._onDidChangeNotebookEditorVisibleRanges.event}$acceptEditorPropertiesChanged(t,i){this._logService.debug("ExtHostNotebook#$acceptEditorPropertiesChanged",t,i);const r=this._notebooksAndEditors.getEditorById(t);i.visibleRanges&&r._acceptVisibleRanges(i.visibleRanges.ranges.map(us.to)),i.selections&&r._acceptSelections(i.selections.selections.map(us.to)),i.visibleRanges&&this._onDidChangeNotebookEditorVisibleRanges.fire({notebookEditor:r.apiEditor,visibleRanges:r.apiEditor.visibleRanges}),i.selections&&this._onDidChangeNotebookEditorSelection.fire(Object.freeze({notebookEditor:r.apiEditor,selections:r.apiEditor.selections}))}$acceptEditorViewColumns(t){for(const i in t)this._notebooksAndEditors.getEditorById(i)._acceptViewColumn(jt.to(t[i]))}};Nb=__decorate([__param(0,ke)],Nb);var Gl;(function(e){e[e.Output=1]="Output",e[e.OutputItems=2]="OutputItems",e[e.ExecutionState=3]="ExecutionState"})(Gl||(Gl={}));var Use=q("INotebookExecutionService"),Mj=100,v7;(function(e){e[e.Disconnected=1]="Disconnected",e[e.Connected=2]="Connected",e[e.Initializing=3]="Initializing"})(v7||(v7={}));var Wse=q("INotebookKernelService"),Bse=q("INotebookKernelHistoryService"),Mb=class{constructor(t,i,r,s,n){this._initData=i,this._extHostNotebook=r,this._commands=s,this._logService=n,this._activeExecutions=new Vt,this._activeNotebookExecutions=new Vt,this._kernelDetectionTask=new Map,this._kernelDetectionTaskHandlePool=0,this._kernelSourceActionProviders=new Map,this._kernelSourceActionProviderHandlePool=0,this._kernelData=new Map,this._handlePool=0,this._onDidChangeCellExecutionState=new D,this.onDidChangeNotebookCellExecutionState=this._onDidChangeCellExecutionState.event,this.id=0,this.variableStore={},this._proxy=t.getProxy(Q.MainThreadNotebookKernels);const o=new me("notebook.selectKernel","_notebook.selectKernel","Trigger kernel picker for specified notebook editor widget",[new U("options","Select kernel options",l=>!0,l=>{if(l&&"notebookEditor"in l&&"id"in l){const c=this._extHostNotebook.getIdByEditor(l.notebookEditor);return{id:l.id,extension:l.extension,notebookEditorId:c}}else if(l&&"notebookEditor"in l){const c=this._extHostNotebook.getIdByEditor(l.notebookEditor);if(c===void 0)throw new Error(`Cannot invoke 'notebook.selectKernel' for unrecognized notebook editor ${l.notebookEditor.notebook.uri.toString()}`);return"skipIfAlreadySelected"in l?{notebookEditorId:c,skipIfAlreadySelected:l.skipIfAlreadySelected}:{notebookEditorId:c}}return l})],ge.Void),a=new me("vscode.executeNotebookVariableProvider","_executeNotebookVariableProvider","Execute notebook variable provider",[U.Uri],new ge("A promise that resolves to an array of variables",(l,c)=>l.map(u=>({variable:{name:u.name,value:u.value,expression:u.expression,type:u.type,language:u.language},hasNamedChildren:u.hasNamedChildren,indexedChildrenCount:u.indexedChildrenCount}))));this._commands.registerApiCommand(o),this._commands.registerApiCommand(a)}createNotebookController(t,i,r,s,n,o){for(const A of this._kernelData.values())if(A.controller.id===i&&qe.equals(t.identifier,A.extensionId))throw new Error(`notebook controller with id '${i}' ALREADY exist`);const a=this._handlePool++,l=this;this._logService.trace(`NotebookController[${a}], CREATED by ${t.identifier.value}, ${i}`);const c=()=>console.warn(`NO execute handler from notebook controller '${p.id}' of extension: '${t.identifier}'`);let u=!1;const d=new D,f=new D,p={id:km(t.identifier,i),notebookType:r,extensionId:t.identifier,extensionLocation:t.extensionLocation,label:s||t.identifier.value,preloads:o?o.map(Xp.from):[]};let g=n??c,v,y;this._proxy.$addKernel(a,p).catch(A=>{console.log(A),u=!0});let S=0;const x=()=>{if(u)return;const A=++S;Promise.resolve().then(()=>{A===S&&this._proxy.$updateKernel(a,p)})},P=new Vt,$={get id(){return i},get notebookType(){return p.notebookType},onDidChangeSelectedNotebooks:d.event,get label(){return p.label},set label(A){p.label=A??t.displayName??t.name,x()},get detail(){return p.detail??""},set detail(A){p.detail=A,x()},get description(){return p.description??""},set description(A){p.description=A,x()},get supportedLanguages(){return p.supportedLanguages},set supportedLanguages(A){p.supportedLanguages=A,x()},get supportsExecutionOrder(){return p.supportsExecutionOrder??!1},set supportsExecutionOrder(A){p.supportsExecutionOrder=A,x()},get rendererScripts(){return p.preloads?p.preloads.map(Xp.to):[]},get executeHandler(){return g},set executeHandler(A){g=A??c},get interruptHandler(){return v},set interruptHandler(A){v=A,p.supportsInterrupt=!!A,x()},set variableProvider(A){M(t,"notebookVariableProvider"),y=A,p.hasVariableProvider=!!A,A?.onDidChangeVariables(W=>l._proxy.$variablesUpdated(W.uri)),x()},get variableProvider(){return y},createNotebookCellExecution(A){if(u)throw new Error("notebook controller is DISPOSED");if(!P.has(A.notebook.uri))throw l._logService.trace(`NotebookController[${a}] NOT associated to notebook, associated to THESE notebooks:`,Array.from(P.keys()).map(W=>W.toString())),new Error(`notebook controller is NOT associated to notebook: ${A.notebook.uri.toString()}`);return l._createNotebookCellExecution(A,km(t.identifier,this.id))},createNotebookExecution(A){if(M(t,"notebookExecution"),u)throw new Error("notebook controller is DISPOSED");if(!P.has(A.uri))throw l._logService.trace(`NotebookController[${a}] NOT associated to notebook, associated to THESE notebooks:`,Array.from(P.keys()).map(W=>W.toString())),new Error(`notebook controller is NOT associated to notebook: ${A.uri.toString()}`);return l._createNotebookExecution(A,km(t.identifier,this.id))},dispose:()=>{u||(this._logService.trace(`NotebookController[${a}], DISPOSED`),u=!0,this._kernelData.delete(a),d.dispose(),f.dispose(),this._proxy.$removeKernel(a))},updateNotebookAffinity(A,W){W===gp.Hidden&&M(t,"notebookControllerAffinityHidden"),l._proxy.$updateNotebookPriority(a,A.uri,W)},onDidReceiveMessage:f.event,postMessage(A,W){return M(t,"notebookMessaging"),l._proxy.$postMessage(a,W&&l._extHostNotebook.getIdByEditor(W),A)},asWebviewUri(A){return M(t,"notebookMessaging"),wd(A,l._initData.remote)}};return this._kernelData.set(a,{extensionId:t.identifier,controller:$,onDidReceiveMessage:f,onDidChangeSelection:d,associatedNotebooks:P}),$}getIdByController(t){for(const[i,r]of this._kernelData)if(r.controller===t)return km(r.extensionId,t.id);return null}createNotebookControllerDetectionTask(t,i){const r=this._kernelDetectionTaskHandlePool++,s=this;this._logService.trace(`NotebookControllerDetectionTask[${r}], CREATED by ${t.identifier.value}`),this._proxy.$addKernelDetectionTask(r,i);const n={dispose:()=>{this._kernelDetectionTask.delete(r),s._proxy.$removeKernelDetectionTask(r)}};return this._kernelDetectionTask.set(r,n),n}registerKernelSourceActionProvider(t,i,r){const s=this._kernelSourceActionProviderHandlePool++,n=typeof r.onDidChangeNotebookKernelSourceActions=="function"?s:void 0,o=this;this._kernelSourceActionProviders.set(s,r),this._logService.trace(`NotebookKernelSourceActionProvider[${s}], CREATED by ${t.identifier.value}`),this._proxy.$addKernelSourceActionProvider(s,s,i);let a;return n!==void 0&&(a=r.onDidChangeNotebookKernelSourceActions(l=>this._proxy.$emitNotebookKernelSourceActionsChangeEvent(n))),{dispose:()=>{this._kernelSourceActionProviders.delete(s),o._proxy.$removeKernelSourceActionProvider(s,s),a?.dispose()}}}async $provideKernelSourceActions(t,i){const r=this._kernelSourceActionProviders.get(t);if(r){const s=new oe;return(await r.provideNotebookKernelSourceActions(i)??[]).map(o=>Y0.from(o,this._commands.converter,s))}return[]}$acceptNotebookAssociation(t,i,r){const s=this._kernelData.get(t);if(s){const n=this._extHostNotebook.getNotebookDocument(b.revive(i));r?s.associatedNotebooks.set(n.uri,!0):s.associatedNotebooks.delete(n.uri),this._logService.trace(`NotebookController[${t}] ASSOCIATE notebook`,n.uri.toString(),r),s.onDidChangeSelection.fire({selected:r,notebook:n.apiNotebook})}}async $executeCells(t,i,r){const s=this._kernelData.get(t);if(!s)return;const n=this._extHostNotebook.getNotebookDocument(b.revive(i)),o=[];for(const a of r){const l=n.getCell(a);l&&o.push(l.apiCell)}try{this._logService.trace(`NotebookController[${t}] EXECUTE cells`,n.uri.toString(),o.length),await s.controller.executeHandler.call(s.controller,o,n.apiNotebook,s.controller)}catch(a){this._logService.error(`NotebookController[${t}] execute cells FAILED`,a),console.error(a)}}async $cancelCells(t,i,r){const s=this._kernelData.get(t);if(!s)return;const n=this._extHostNotebook.getNotebookDocument(b.revive(i));if(s.controller.interruptHandler)await s.controller.interruptHandler.call(s.controller,n.apiNotebook);else for(const o of r){const a=n.getCell(o);a&&this._activeExecutions.get(a.uri)?.cancel()}if(s.controller.interruptHandler){const o=this._activeNotebookExecutions.get(n.uri);this._activeNotebookExecutions.delete(n.uri),r.length&&Array.isArray(o)&&o.length&&o.forEach(a=>a.dispose())}}async $provideVariables(t,i,r,s,n,o,a){const l=this._kernelData.get(t);if(!l)return;const c=this._extHostNotebook.getNotebookDocument(b.revive(r)),u=l.controller.variableProvider;if(!u)return;let d;if(s!==void 0){if(d=this.variableStore[s],!d)return}else this.variableStore={};const f=n==="named"?Du.Named:Du.Indexed,p=u.provideVariables(c.apiNotebook,d,f,o,a);let g=0;for await(const v of p){if(a.isCancellationRequested)return;const y={id:this.id++,name:v.variable.name,value:v.variable.value,type:v.variable.type,interfaces:v.variable.interfaces,language:v.variable.language,expression:v.variable.expression,hasNamedChildren:v.hasNamedChildren,indexedChildrenCount:v.indexedChildrenCount,extensionId:l.extensionId.value};if(this.variableStore[y.id]=v.variable,this._proxy.$receiveVariable(i,y),g++>=Mj)return}}$acceptKernelMessageFromRenderer(t,i,r){const s=this._kernelData.get(t);if(!s)return;const n=this._extHostNotebook.getEditorById(i);s.onDidReceiveMessage.fire(Object.freeze({editor:n.apiEditor,message:r}))}$cellExecutionChanged(t,i,r){const n=this._extHostNotebook.getNotebookDocument(b.revive(t)).getCell(i);if(n){const o=r?K0.to(r):ml.Idle;o!==void 0&&this._onDidChangeCellExecutionState.fire({cell:n.apiCell,state:o})}}_createNotebookCellExecution(t,i){if(t.index<0)throw new Error("CANNOT execute cell that has been REMOVED from notebook");const s=this._extHostNotebook.getNotebookDocument(t.notebook.uri).getCellFromApiCell(t);if(!s)throw new Error("invalid cell");if(this._activeExecutions.has(s.uri))throw new Error(`duplicate execution for ${s.uri}`);const n=new Oj(i,s,this._proxy);this._activeExecutions.set(s.uri,n);const o=n.onDidChangeState(()=>{n.state===Gr.Resolved&&(n.dispose(),o.dispose(),this._activeExecutions.delete(s.uri))});return n.asApiObject()}_createNotebookExecution(t,i){const r=this._extHostNotebook.getNotebookDocument(t.uri),s=t.getCells().find(a=>{const l=r.getCellFromApiCell(a);return l&&this._activeExecutions.has(l.uri)});if(s)throw new Error(`duplicate cell execution for ${s.document.uri}`);if(this._activeNotebookExecutions.has(r.uri))throw new Error(`duplicate notebook execution for ${r.uri}`);const n=new $j(i,r,this._proxy),o=n.onDidChangeState(()=>{n.state===tn.Resolved&&(n.dispose(),o.dispose(),this._activeNotebookExecutions.delete(r.uri))});return this._activeNotebookExecutions.set(r.uri,[n,o]),n.asApiObject()}};Mb=__decorate([__param(4,ke)],Mb);var Gr;(function(e){e[e.Init=0]="Init",e[e.Started=1]="Started",e[e.Resolved=2]="Resolved"})(Gr||(Gr={}));var Oj=class V8 extends X{static{this.HANDLE=0}get state(){return this._state}constructor(t,i,r){super(),this._cell=i,this._proxy=r,this._handle=V8.HANDLE++,this._onDidChangeState=new D,this.onDidChangeState=this._onDidChangeState.event,this._state=Gr.Init,this._tokenSource=this._register(new rt),this._collector=new Hj(10,s=>this.update(s)),this._executionOrder=i.internalMetadata.executionOrder,this._proxy.$createExecution(this._handle,t,this._cell.notebook.uri,this._cell.handle)}cancel(){this._tokenSource.cancel()}async updateSoon(t){await this._collector.addItem(t)}async update(t){const i=Array.isArray(t)?t:[t];return this._proxy.$updateExecution(this._handle,new wi(i))}verifyStateForOutput(){if(this._state===Gr.Init)throw new Error("Must call start before modifying cell output");if(this._state===Gr.Resolved)throw new Error("Cannot modify cell output after calling resolve")}cellIndexToHandle(t){let i=this._cell;if(t&&(i=this._cell.notebook.getCellFromApiCell(t)),!i)throw new Error("INVALID cell");return i.handle}validateAndConvertOutputs(t){return t.map(i=>{const r=hp.ensureUniqueMimeTypes(i.items,!0);return r===i.items?Un.from(i):Un.from({items:r,id:i.id,metadata:i.metadata})})}async updateOutputs(t,i,r){const s=this.cellIndexToHandle(i),n=this.validateAndConvertOutputs(er(t));return this.updateSoon({editType:Gl.Output,cellHandle:s,append:r,outputs:n})}async updateOutputItems(t,i,r){return t=hp.ensureUniqueMimeTypes(er(t),!0),this.updateSoon({editType:Gl.OutputItems,items:t.map(Il.from),outputId:i.id,append:r})}asApiObject(){const t=this;return Object.freeze({get token(){return t._tokenSource.token},get cell(){return t._cell.apiCell},get executionOrder(){return t._executionOrder},set executionOrder(r){t._executionOrder=r,t.update([{editType:Gl.ExecutionState,executionOrder:t._executionOrder}])},start(r){if(t._state===Gr.Resolved||t._state===Gr.Started)throw new Error("Cannot call start again");t._state=Gr.Started,t._onDidChangeState.fire(),t.update({editType:Gl.ExecutionState,runStartTime:r})},end(r,s,n){if(t._state===Gr.Resolved)throw new Error("Cannot call resolve twice");t._state=Gr.Resolved,t._onDidChangeState.fire(),t._collector.flush();const o=Fj(n);t._proxy.$completeExecution(t._handle,new wi({runEndTime:s,lastRunSuccess:r,error:o}))},clearOutput(r){return t.verifyStateForOutput(),t.updateOutputs([],r,!1)},appendOutput(r,s){return t.verifyStateForOutput(),t.updateOutputs(r,s,!0)},replaceOutput(r,s){return t.verifyStateForOutput(),t.updateOutputs(r,s,!1)},appendOutputItems(r,s){return t.verifyStateForOutput(),t.updateOutputItems(r,s,!0)},replaceOutputItems(r,s){return t.verifyStateForOutput(),t.updateOutputItems(r,s,!1)}})}};function Fj(e){const t=s=>s?{startLineNumber:s.start.line,startColumn:s.start.character,endLineNumber:s.end.line,endColumn:s.end.character}:void 0,i=s=>({uri:s.uri,position:s.position,label:s.label});return e?{name:e.name,message:e.message,stack:e.stack instanceof Array?e.stack.map(s=>i(s)):e.stack,location:t(e.location),uri:e.uri}:void 0}var tn;(function(e){e[e.Init=0]="Init",e[e.Started=1]="Started",e[e.Resolved=2]="Resolved"})(tn||(tn={}));var $j=class z8 extends X{static{this.HANDLE=0}get state(){return this._state}constructor(t,i,r){super(),this._notebook=i,this._proxy=r,this._handle=z8.HANDLE++,this._onDidChangeState=new D,this.onDidChangeState=this._onDidChangeState.event,this._state=tn.Init,this._tokenSource=this._register(new rt),this._proxy.$createNotebookExecution(this._handle,t,this._notebook.uri)}cancel(){this._tokenSource.cancel()}asApiObject(){return Object.freeze({start:()=>{if(this._state===tn.Resolved||this._state===tn.Started)throw new Error("Cannot call start again");this._state=tn.Started,this._onDidChangeState.fire(),this._proxy.$beginNotebookExecution(this._handle)},end:()=>{if(this._state===tn.Resolved)throw new Error("Cannot call resolve twice");this._state=tn.Resolved,this._onDidChangeState.fire(),this._proxy.$completeNotebookExecution(this._handle)}})}},Hj=class{constructor(e,t){this.delay=e,this.callback=t,this.batch=[],this.startedTimer=Date.now()}addItem(e){return this.batch.push(e),this.currentDeferred||(this.currentDeferred=new hr,this.startedTimer=Date.now(),ui(this.delay).then(()=>this.flush())),Date.now()-this.startedTimer>this.delay?this.flush():this.currentDeferred.p}flush(){if(this.batch.length===0||!this.currentDeferred)return Promise.resolve();const e=this.currentDeferred;this.currentDeferred=void 0;const t=this.batch;return this.batch=[],this.callback(t).finally(()=>e.complete())}};function km(e,t){return`${e.value}/${t}`}var Uj=class{constructor(e,t){this._extHostNotebook=t,this._rendererMessageEmitters=new Map,this.proxy=e.getProxy(Q.MainThreadNotebookRenderers)}$postRendererMessage(e,t,i){const r=this._extHostNotebook.getEditorById(e);this._rendererMessageEmitters.get(t)?.fire({editor:r.apiEditor,message:i})}createRendererMessaging(e,t){if(!e.contributes?.notebookRenderer?.some(r=>r.id===t))throw new Error(`Extensions may only call createRendererMessaging() for renderers they contribute (got ${t})`);return{onDidReceiveMessage:(r,s,n)=>this.getOrCreateEmitterFor(t).event(r,s,n),postMessage:(r,s)=>{Cb.apiEditorsToExtHost.has(r)&&([r,s]=[s,r]);const n=s&&Cb.apiEditorsToExtHost.get(s);return this.proxy.$postMessage(n?.id,t,r)}}}getOrCreateEmitterFor(e){let t=this._rendererMessageEmitters.get(e);return t||(t=new D({onDidRemoveLastListener:()=>{t?.dispose(),this._rendererMessageEmitters.delete(e)}}),this._rendererMessageEmitters.set(e,t),t)}},Wj=class{constructor(e){this.handlers=new Map,this.proxy=e.getProxy(Q.MainThreadProfileContentHandlers)}registerProfileContentHandler(e,t,i){if(M(e,"profileContentHandlers"),this.handlers.has(t))throw new Error(`Handler with id '${t}' already registered`);return this.handlers.set(t,i),this.proxy.$registerProfileContentHandler(t,i.name,i.description,e.identifier.value),ie(()=>{this.handlers.delete(t),this.proxy.$unregisterProfileContentHandler(t)})}async $saveProfile(e,t,i,r){const s=this.handlers.get(e);if(!s)throw new Error(`Unknown handler with id: ${e}`);return s.saveProfile(t,i,r)}async $readProfile(e,t,i){const r=this.handlers.get(e);if(!r)throw new Error(`Unknown handler with id: ${e}`);return r.readProfile(Oe(t)?t:b.revive(t),i)}},Bj=class{constructor(e){this._handles=0,this._mapHandleToCancellationSource=new Map,this._proxy=e}async withProgress(e,t,i){const r=this._handles++,{title:s,location:n,cancellable:o}=t,a={label:e.displayName||e.name,id:e.identifier.value};return this._proxy.$startProgress(r,{location:Q0.from(n),title:s,source:a,cancellable:o},e.isUnderDevelopment?void 0:e.identifier.value).catch(XS),this._withProgress(r,i,!!o)}_withProgress(e,t,i){let r;i&&(r=new rt,this._mapHandleToCancellationSource.set(e,r));const s=o=>{this._proxy.$progressEnd(o),this._mapHandleToCancellationSource.delete(o),r?.dispose()};let n;try{n=t(new _7(this._proxy,e),i&&r?r.token:Be.None)}catch(o){throw s(e),o}return n.then(o=>s(e),o=>s(e)),n}$acceptProgressCanceled(e){const t=this._mapHandleToCancellationSource.get(e);t&&(t.cancel(),this._mapHandleToCancellationSource.delete(e))}};function Vj(e,t){return e.message=t.message,typeof t.increment=="number"&&(typeof e.increment=="number"?e.increment+=t.increment:e.increment=t.increment),e}var _7=class extends Rg{constructor(e,t){super(i=>this.throttledReport(i)),this._proxy=e,this._handle=t}throttledReport(e){this._proxy.$progressReport(this._handle,e)}};__decorate([MN(100,(e,t)=>Vj(e,t),()=>Object.create(null))],_7.prototype,"throttledReport",null);var zj=class q8{static{this.handlePool=0}constructor(t,i){this.uriTransformer=i,this.providers=new Map,this.proxy=t.getProxy(Q.MainThreadQuickDiff)}$provideOriginalResource(t,i,r){const s=b.revive(i),n=this.providers.get(t);return n?ci(()=>n.provideOriginalResource(s,r)).then(o=>o||null):Promise.resolve(null)}registerQuickDiffProvider(t,i,r,s,n,o){const a=q8.handlePool++;this.providers.set(a,r);const l=qe.toKey(t.identifier);return this.proxy.$registerQuickDiffProvider(a,wl.from(i,this.uriTransformer),`${l}.${s}`,n,o),{dispose:()=>{this.proxy.$unregisterQuickDiffProvider(a),this.providers.delete(a)}}}};function qj(e,t,i){const r=e.getProxy(Q.MainThreadQuickOpen);class s{constructor(p,g){this._sessions=new Map,this._instances=0,this._workspace=p,this._commands=g}showQuickPick(p,g,v,y=Be.None){this._onDidSelectItem=void 0;const S=Promise.resolve(g),x=++this._instances,P=r.$show(x,{title:v?.title,placeHolder:v?.placeHolder,matchOnDescription:v?.matchOnDescription,matchOnDetail:v?.matchOnDetail,ignoreFocusLost:v?.ignoreFocusOut,canPickMany:v?.canPickMany},y),$={},A=P.then(()=>$);return Promise.race([A,S]).then(W=>{if(W===$)return;const G=nt(p,"quickPickItemTooltip");return S.then(J=>{const H=[];for(let K=0;K<J.length;K++){const Ee=J[K];if(typeof Ee=="string")H.push({label:Ee,handle:K});else if(Ee.kind===Cu.Separator)H.push({type:"separator",label:Ee.label});else{Ee.tooltip&&!G&&console.warn(`Extension '${p.identifier.value}' uses a tooltip which is proposed API that is only available when running out of dev or with the following command line switch: --enable-proposed-api ${p.identifier.value}`);const ne=Ee.iconPath?c(Ee.iconPath):void 0;H.push({label:Ee.label,iconPath:ne?.iconPath,iconClass:ne?.iconClass,description:Ee.description,detail:Ee.detail,picked:Ee.picked,alwaysShow:Ee.alwaysShow,tooltip:G?ve.fromStrict(Ee.tooltip):void 0,handle:K})}}return v&&typeof v.onDidSelectItem=="function"&&(this._onDidSelectItem=K=>{v.onDidSelectItem(J[K])}),r.$setItems(x,H),P.then(K=>{if(typeof K=="number")return J[K];if(Array.isArray(K))return K.map(Ee=>J[Ee])})})}).then(void 0,W=>{if(!Yi(W))return r.$setError(x,W),Promise.reject(W)})}$onItemSelected(p){this._onDidSelectItem?.(p)}showInput(p,g=Be.None){return this._validateInput=p?.validateInput,r.$input(p,typeof this._validateInput=="function",g).then(void 0,v=>{if(!Yi(v))return Promise.reject(v)})}async $validateInput(p){if(!this._validateInput)return;const g=await this._validateInput(p);if(!g||typeof g=="string")return g;let v;switch(g.severity){case gl.Info:v=Ft.Info;break;case gl.Warning:v=Ft.Warning;break;case gl.Error:v=Ft.Error;break;default:v=g.message?Ft.Error:Ft.Ignore;break}return{content:g.message,severity:v}}async showWorkspaceFolderPick(p,g=Be.None){const v=await this._commands.executeCommand("_workbench.pickWorkspaceFolder",[p]);if(!v)return;const y=await this._workspace.getWorkspaceFolders2();if(y)return y.find(S=>S.uri.toString()===v.uri.toString())}createQuickPick(p){const g=new u(p,()=>this._sessions.delete(g._id));return this._sessions.set(g._id,g),g}createInputBox(p){const g=new d(p,()=>this._sessions.delete(g._id));return this._sessions.set(g._id,g),g}$onDidChangeValue(p,g){this._sessions.get(p)?._fireDidChangeValue(g)}$onDidAccept(p){this._sessions.get(p)?._fireDidAccept()}$onDidChangeActive(p,g){const v=this._sessions.get(p);v instanceof u&&v._fireDidChangeActive(g)}$onDidChangeSelection(p,g){const v=this._sessions.get(p);v instanceof u&&v._fireDidChangeSelection(g)}$onDidTriggerButton(p,g){this._sessions.get(p)?._fireDidTriggerButton(g)}$onDidTriggerItemButton(p,g,v){const y=this._sessions.get(p);y instanceof u&&y._fireDidTriggerItemButton(g,v)}$onDidHide(p){this._sessions.get(p)?._fireDidHide()}}class n{static{this._nextId=1}constructor(p,g){this._extension=p,this._onDidDispose=g,this._id=u._nextId++,this._visible=!1,this._expectingHide=!1,this._enabled=!0,this._busy=!1,this._ignoreFocusOut=!0,this._value="",this._valueSelection=void 0,this._buttons=[],this._handlesToButtons=new Map,this._onDidAcceptEmitter=new D,this._onDidChangeValueEmitter=new D,this._onDidTriggerButtonEmitter=new D,this._onDidHideEmitter=new D,this._pendingUpdate={id:this._id},this._disposed=!1,this._disposables=[this._onDidTriggerButtonEmitter,this._onDidHideEmitter,this._onDidAcceptEmitter,this._onDidChangeValueEmitter],this.onDidChangeValue=this._onDidChangeValueEmitter.event,this.onDidAccept=this._onDidAcceptEmitter.event,this.onDidTriggerButton=this._onDidTriggerButtonEmitter.event,this.onDidHide=this._onDidHideEmitter.event}get title(){return this._title}set title(p){this._title=p,this.update({title:p})}get step(){return this._steps}set step(p){this._steps=p,this.update({step:p})}get totalSteps(){return this._totalSteps}set totalSteps(p){this._totalSteps=p,this.update({totalSteps:p})}get enabled(){return this._enabled}set enabled(p){this._enabled=p,this.update({enabled:p})}get busy(){return this._busy}set busy(p){this._busy=p,this.update({busy:p})}get ignoreFocusOut(){return this._ignoreFocusOut}set ignoreFocusOut(p){this._ignoreFocusOut=p,this.update({ignoreFocusOut:p})}get value(){return this._value}set value(p){this._value=p,this.update({value:p})}get valueSelection(){return this._valueSelection}set valueSelection(p){this._valueSelection=p,this.update({valueSelection:p})}get placeholder(){return this._placeholder}set placeholder(p){this._placeholder=p,this.update({placeholder:p})}get buttons(){return this._buttons}set buttons(p){const g=nt(this._extension,"quickInputButtonLocation");!g&&p.some(v=>v.location)&&console.warn(`Extension '${this._extension.identifier.value}' uses a button location which is proposed API that is only available when running out of dev or with the following command line switch: --enable-proposed-api ${this._extension.identifier.value}`),this._buttons=p.slice(),this._handlesToButtons.clear(),p.forEach((v,y)=>{const S=v===Eu.Back?-1:y;this._handlesToButtons.set(S,v)}),this.update({buttons:p.map((v,y)=>({...c(v.iconPath),tooltip:v.tooltip,handle:v===Eu.Back?-1:y,location:g?v.location:void 0}))})}show(){this._visible=!0,this._expectingHide=!0,this.update({visible:!0})}hide(){this._visible=!1,this.update({visible:!1})}_fireDidAccept(){this._onDidAcceptEmitter.fire()}_fireDidChangeValue(p){this._value=p,this._onDidChangeValueEmitter.fire(p)}_fireDidTriggerButton(p){const g=this._handlesToButtons.get(p);g&&this._onDidTriggerButtonEmitter.fire(g)}_fireDidHide(){this._expectingHide&&(this._expectingHide=this._visible,this._onDidHideEmitter.fire())}dispose(){this._disposed||(this._disposed=!0,this._fireDidHide(),this._disposables=Cr(this._disposables),this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=void 0),this._onDidDispose(),r.$dispose(this._id))}update(p){if(!this._disposed){for(const g of Object.keys(p)){const v=p[g];this._pendingUpdate[g]=v===void 0?null:v}"visible"in this._pendingUpdate?(this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=void 0),this.dispatchUpdate()):this._visible&&!this._updateTimeout&&(this._updateTimeout=setTimeout(()=>{this._updateTimeout=void 0,this.dispatchUpdate()},0))}}dispatchUpdate(){r.$createOrUpdate(this._pendingUpdate),this._pendingUpdate={id:this._id}}}function o(f){if(f instanceof pi)return{id:f.id};const p=l(f),g=a(f);return{dark:typeof p=="string"?b.file(p):p,light:typeof g=="string"?b.file(g):g}}function a(f){return typeof f=="object"&&"light"in f?f.light:f}function l(f){return typeof f=="object"&&"dark"in f?f.dark:f}function c(f){const p=o(f);let g,v;return"id"in p?v=Wt.asClassName(p):g=p,{iconPath:g,iconClass:v}}class u extends n{constructor(p,g){super(p,g),this._items=[],this._handlesToItems=new Map,this._itemsToHandles=new Map,this._canSelectMany=!1,this._matchOnDescription=!0,this._matchOnDetail=!0,this._sortByLabel=!0,this._keepScrollPosition=!1,this._activeItems=[],this._onDidChangeActiveEmitter=new D,this._selectedItems=[],this._onDidChangeSelectionEmitter=new D,this._onDidTriggerItemButtonEmitter=new D,this.onDidChangeActive=this._onDidChangeActiveEmitter.event,this.onDidChangeSelection=this._onDidChangeSelectionEmitter.event,this.onDidTriggerItemButton=this._onDidTriggerItemButtonEmitter.event,this._disposables.push(this._onDidChangeActiveEmitter,this._onDidChangeSelectionEmitter,this._onDidTriggerItemButtonEmitter),this.update({type:"quickPick"})}get items(){return this._items}set items(p){this._items=p.slice(),this._handlesToItems.clear(),this._itemsToHandles.clear(),p.forEach((y,S)=>{this._handlesToItems.set(S,y),this._itemsToHandles.set(y,S)});const g=nt(this._extension,"quickPickItemTooltip"),v=[];for(let y=0;y<p.length;y++){const S=p[y];if(S.kind===Cu.Separator)v.push({type:"separator",label:S.label});else{S.tooltip&&!g&&console.warn(`Extension '${this._extension.identifier.value}' uses a tooltip which is proposed API that is only available when running out of dev or with the following command line switch: --enable-proposed-api ${this._extension.identifier.value}`);const x=S.iconPath?c(S.iconPath):void 0;v.push({handle:y,label:S.label,iconPath:x?.iconPath,iconClass:x?.iconClass,description:S.description,detail:S.detail,picked:S.picked,alwaysShow:S.alwaysShow,tooltip:g?ve.fromStrict(S.tooltip):void 0,buttons:S.buttons?.map((P,$)=>({...c(P.iconPath),tooltip:P.tooltip,handle:$}))})}}this.update({items:v})}get canSelectMany(){return this._canSelectMany}set canSelectMany(p){this._canSelectMany=p,this.update({canSelectMany:p})}get matchOnDescription(){return this._matchOnDescription}set matchOnDescription(p){this._matchOnDescription=p,this.update({matchOnDescription:p})}get matchOnDetail(){return this._matchOnDetail}set matchOnDetail(p){this._matchOnDetail=p,this.update({matchOnDetail:p})}get sortByLabel(){return this._sortByLabel}set sortByLabel(p){this._sortByLabel=p,this.update({sortByLabel:p})}get keepScrollPosition(){return this._keepScrollPosition}set keepScrollPosition(p){this._keepScrollPosition=p,this.update({keepScrollPosition:p})}get activeItems(){return this._activeItems}set activeItems(p){this._activeItems=p.filter(g=>this._itemsToHandles.has(g)),this.update({activeItems:this._activeItems.map(g=>this._itemsToHandles.get(g))})}get selectedItems(){return this._selectedItems}set selectedItems(p){this._selectedItems=p.filter(g=>this._itemsToHandles.has(g)),this.update({selectedItems:this._selectedItems.map(g=>this._itemsToHandles.get(g))})}_fireDidChangeActive(p){const g=Et(p.map(v=>this._handlesToItems.get(v)));this._activeItems=g,this._onDidChangeActiveEmitter.fire(g)}_fireDidChangeSelection(p){const g=Et(p.map(v=>this._handlesToItems.get(v)));this._selectedItems=g,this._onDidChangeSelectionEmitter.fire(g)}_fireDidTriggerItemButton(p,g){const v=this._handlesToItems.get(p);if(!v||!v.buttons||!v.buttons.length)return;const y=v.buttons[g];y&&this._onDidTriggerItemButtonEmitter.fire({button:y,item:v})}}class d extends n{constructor(p,g){super(p,g),this._password=!1,this.update({type:"inputBox"})}get password(){return this._password}set password(p){this._password=p,this.update({password:p})}get prompt(){return this._prompt}set prompt(p){this._prompt=p,this.update({prompt:p})}get validationMessage(){return this._validationMessage}set validationMessage(p){this._validationMessage=p,p?typeof p=="string"?this.update({validationMessage:p,severity:Ft.Error}):this.update({validationMessage:p.message,severity:p.severity??Ft.Error}):this.update({validationMessage:void 0,severity:Ft.Ignore})}}return new s(t,i)}var Ob;function w7(e){return e instanceof b}function jj(e,t){return e.scheme===V.file&&t.scheme===V.file&&Ct?e.toString()===t.toString():e.toString().toLowerCase()===t.toString().toLowerCase()}function Fb(e){if(e)return typeof e.iconPath=="string"?b.file(e.iconPath):b.isUri(e.iconPath)||Wt.isThemeIcon(e.iconPath)?e.iconPath:void 0}function oa(e){if(e){if(b.isUri(e))return e;if(Wt.isThemeIcon(e))return e;{const t=e;return{light:t.light,dark:t.dark}}}else return}function Gj(e){const t=oa(e.authorIcon),i=e.references?.map(r=>({...r,icon:oa(r.icon)}));return{...e,authorIcon:t,references:i}}function $b(e){return e?{...e,icon:oa(e.icon)}:void 0}function Hb(e,t){if(!e.iconPath&&!t.iconPath)return 0;if(e.iconPath){if(!t.iconPath)return 1}else return-1;const i=typeof e.iconPath=="string"?e.iconPath:b.isUri(e.iconPath)?e.iconPath.fsPath:e.iconPath.id,r=typeof t.iconPath=="string"?t.iconPath:b.isUri(t.iconPath)?t.iconPath.fsPath:t.iconPath.id;return tm(i,r)}function Qj(e,t){let i=0;if(e.strikeThrough!==t.strikeThrough)return e.strikeThrough?1:-1;if(e.faded!==t.faded)return e.faded?1:-1;if(e.tooltip!==t.tooltip)return(e.tooltip||"").localeCompare(t.tooltip||"");if(i=Hb(e,t),i!==0)return i;if(e.light&&t.light)i=Hb(e.light,t.light);else{if(e.light)return 1;if(t.light)return-1}if(i!==0)return i;if(e.dark&&t.dark)i=Hb(e.dark,t.dark);else{if(e.dark)return 1;if(t.dark)return-1}return i}function Jj(e,t){if(e.command!==t.command)return e.command<t.command?-1:1;if(e.title!==t.title)return e.title<t.title?-1:1;if(e.tooltip!==t.tooltip){if(e.tooltip!==void 0&&t.tooltip!==void 0)return e.tooltip<t.tooltip?-1:1;if(e.tooltip!==void 0)return 1;if(t.tooltip!==void 0)return-1}if(e.arguments===t.arguments)return 0;if(e.arguments)if(t.arguments){if(e.arguments.length!==t.arguments.length)return e.arguments.length-t.arguments.length}else return 1;else return-1;for(let i=0;i<e.arguments.length;i++){const r=e.arguments[i],s=t.arguments[i];if(r!==s&&!(w7(r)&&w7(s)&&jj(r,s)))return r<s?-1:1}return 0}function y7(e,t){let i=tm(e.resourceUri.fsPath,t.resourceUri.fsPath,!0);if(i!==0)return i;if(e.command&&t.command)i=Jj(e.command,t.command);else{if(e.command)return 1;if(t.command)return-1}if(i!==0)return i;if(e.decorations&&t.decorations)i=Qj(e.decorations,t.decorations);else{if(e.decorations)return 1;if(t.decorations)return-1}if(i!==0)return i;if(e.multiFileDiffEditorModifiedUri&&t.multiFileDiffEditorModifiedUri)i=tm(e.multiFileDiffEditorModifiedUri.fsPath,t.multiFileDiffEditorModifiedUri.fsPath,!0);else{if(e.multiFileDiffEditorModifiedUri)return 1;if(t.multiFileDiffEditorModifiedUri)return-1}if(i!==0)return i;if(e.multiDiffEditorOriginalUri&&t.multiDiffEditorOriginalUri)i=tm(e.multiDiffEditorOriginalUri.fsPath,t.multiDiffEditorOriginalUri.fsPath,!0);else{if(e.multiDiffEditorOriginalUri)return 1;if(t.multiDiffEditorOriginalUri)return-1}return i}function Kj(e,t){for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function Xj(e,t){return e.command===t.command&&e.title===t.title&&e.tooltip===t.tooltip&&(e.arguments&&t.arguments?Kj(e.arguments,t.arguments):e.arguments===t.arguments)}function Yj(e,t){return Er(e,t,Xj)}var Zj=class{#e;#t;get value(){return this._value}set value(e){e=e??"",this.#e.$setInputBoxValue(this._sourceControlHandle,e),this.updateValue(e)}get onDidChange(){return this._onDidChange.event}get placeholder(){return this._placeholder}set placeholder(e){this.#e.$setInputBoxPlaceholder(this._sourceControlHandle,e),this._placeholder=e}get validateInput(){return M(this._extension,"scmValidation"),this._validateInput}set validateInput(e){if(M(this._extension,"scmValidation"),e&&typeof e!="function")throw new Error(`[${this._extension.identifier.value}]: Invalid SCM input box validation function`);this._validateInput=e,this.#e.$setValidationProviderIsEnabled(this._sourceControlHandle,!!e)}get enabled(){return this._enabled}set enabled(e){e=!!e,this._enabled!==e&&(this._enabled=e,this.#e.$setInputBoxEnablement(this._sourceControlHandle,e))}get visible(){return this._visible}set visible(e){e=!!e,this._visible!==e&&(this._visible=e,this.#e.$setInputBoxVisibility(this._sourceControlHandle,e))}get document(){return M(this._extension,"scmTextDocument"),this.#t.getDocument(this._documentUri)}constructor(e,t,i,r,s){this._extension=e,this._sourceControlHandle=r,this._documentUri=s,this._value="",this._onDidChange=new D,this._placeholder="",this._enabled=!0,this._visible=!0,this.#t=t,this.#e=i}showValidationMessage(e,t){M(this._extension,"scmValidation"),this.#e.$showValidationMessage(this._sourceControlHandle,e,t)}$onInputBoxValueChange(e){this.updateValue(e)}updateValue(e){this._value=e,this._onDidChange.fire(e)}},eG=class j8{static{this._handlePool=0}get disposed(){return this._disposed}get id(){return this._id}get label(){return this._label}set label(t){this._label=t,this._proxy.$updateGroupLabel(this._sourceControlHandle,this.handle,t)}get contextValue(){return this._contextValue}set contextValue(t){this._contextValue=t,this._proxy.$updateGroup(this._sourceControlHandle,this.handle,this.features)}get hideWhenEmpty(){return this._hideWhenEmpty}set hideWhenEmpty(t){this._hideWhenEmpty=t,this._proxy.$updateGroup(this._sourceControlHandle,this.handle,this.features)}get features(){return{contextValue:this.contextValue,hideWhenEmpty:this.hideWhenEmpty}}get resourceStates(){return[...this._resourceStates]}set resourceStates(t){this._resourceStates=[...t],this._onDidUpdateResourceStates.fire()}constructor(t,i,r,s,n,o,a){this._proxy=t,this._commands=i,this._sourceControlHandle=r,this._id=s,this._label=n,this.multiDiffEditorEnableViewChanges=o,this._extension=a,this._resourceHandlePool=0,this._resourceStates=[],this._resourceStatesMap=new Map,this._resourceStatesCommandsMap=new Map,this._resourceStatesDisposablesMap=new Map,this._onDidUpdateResourceStates=new D,this.onDidUpdateResourceStates=this._onDidUpdateResourceStates.event,this._disposed=!1,this._onDidDispose=new D,this.onDidDispose=this._onDidDispose.event,this._handlesSnapshot=[],this._resourceSnapshot=[],this._contextValue=void 0,this._hideWhenEmpty=void 0,this.handle=j8._handlePool++}getResourceState(t){return this._resourceStatesMap.get(t)}$executeResourceCommand(t,i){const r=this._resourceStatesCommandsMap.get(t);return r?ci(()=>this._commands.executeCommand(r.command,...r.arguments||[],i)):Promise.resolve(void 0)}_takeResourceStateSnapshot(){const t=[...this._resourceStates].sort(y7),r=ex(this._resourceSnapshot,t,y7).map(o=>{const a=o.toInsert.map(l=>{const c=this._resourceHandlePool++;this._resourceStatesMap.set(c,l);const u=l.resourceUri;let d;if(l.command)if(l.command.command==="vscode.open"||l.command.command==="vscode.diff"||l.command.command==="vscode.changes"){const J=new oe;d=this._commands.converter.toInternal(l.command,J),this._resourceStatesDisposablesMap.set(c,J)}else this._resourceStatesCommandsMap.set(c,l.command);const f=nt(this._extension,"scmMultiDiffEditor"),p=f?l.multiDiffEditorOriginalUri:void 0,g=f?l.multiFileDiffEditorModifiedUri:void 0,v=Fb(l.decorations),y=l.decorations&&Fb(l.decorations.light)||v,S=l.decorations&&Fb(l.decorations.dark)||v,x=[y,S],P=l.decorations&&l.decorations.tooltip||"",$=l.decorations&&!!l.decorations.strikeThrough,A=l.decorations&&!!l.decorations.faded,W=l.contextValue||"";return{rawResource:[c,u,x,P,$,A,W,d,p,g],handle:c}});return{start:o.start,deleteCount:o.deleteCount,toInsert:a}}),s=r.map(({start:o,deleteCount:a,toInsert:l})=>[o,a,l.map(c=>c.rawResource)]),n=r.reverse();for(const{start:o,deleteCount:a,toInsert:l}of n){const c=l.map(d=>d.handle),u=this._handlesSnapshot.splice(o,a,...c);for(const d of u)this._resourceStatesMap.delete(d),this._resourceStatesCommandsMap.delete(d),this._resourceStatesDisposablesMap.get(d)?.dispose(),this._resourceStatesDisposablesMap.delete(d)}return this._resourceSnapshot=t,s}dispose(){this._disposed=!0,this._onDidDispose.fire()}},Ub=class G8{static{this._handlePool=0}#e;get id(){return this._id}get label(){return this._label}get rootUri(){return this._rootUri}get inputBox(){return this._inputBox}get count(){return this._count}set count(t){this._count!==t&&(this._count=t,this.#e.$updateSourceControl(this.handle,{count:t}))}get quickDiffProvider(){return this._quickDiffProvider}set quickDiffProvider(t){this._quickDiffProvider=t;let i;nt(this._extension,"quickDiffProvider")&&(i=t?.label),this.#e.$updateSourceControl(this.handle,{hasQuickDiffProvider:!!t,quickDiffLabel:i})}get secondaryQuickDiffProvider(){return M(this._extension,"quickDiffProvider"),this._secondaryQuickDiffProvider}set secondaryQuickDiffProvider(t){M(this._extension,"quickDiffProvider"),this._secondaryQuickDiffProvider=t;const i=t?.label;this.#e.$updateSourceControl(this.handle,{hasSecondaryQuickDiffProvider:!!t,secondaryQuickDiffLabel:i})}get historyProvider(){return M(this._extension,"scmHistoryProvider"),this._historyProvider}set historyProvider(t){M(this._extension,"scmHistoryProvider"),this._historyProvider=t,this._historyProviderDisposable.value=new oe,this.#e.$updateSourceControl(this.handle,{hasHistoryProvider:!!t}),t&&(this._historyProviderDisposable.value.add(t.onDidChangeCurrentHistoryItemRefs(()=>{const i=$b(t?.currentHistoryItemRef),r=$b(t?.currentHistoryItemRemoteRef),s=$b(t?.currentHistoryItemBaseRef);this.#e.$onDidChangeHistoryProviderCurrentHistoryItemRefs(this.handle,i,r,s)})),this._historyProviderDisposable.value.add(t.onDidChangeHistoryItemRefs(i=>{if(i.added.length===0&&i.modified.length===0&&i.removed.length===0)return;const r=i.added.map(o=>({...o,icon:oa(o.icon)})),s=i.modified.map(o=>({...o,icon:oa(o.icon)})),n=i.removed.map(o=>({...o,icon:oa(o.icon)}));this.#e.$onDidChangeHistoryProviderHistoryItemRefs(this.handle,{added:r,modified:s,removed:n,silent:i.silent})})))}get commitTemplate(){return this._commitTemplate}set commitTemplate(t){t!==this._commitTemplate&&(this._commitTemplate=t,this.#e.$updateSourceControl(this.handle,{commitTemplate:t}))}get acceptInputCommand(){return this._acceptInputCommand}set acceptInputCommand(t){this._acceptInputDisposables.value=new oe,this._acceptInputCommand=t;const i=this._commands.converter.toInternal(t,this._acceptInputDisposables.value);this.#e.$updateSourceControl(this.handle,{acceptInputCommand:i})}get actionButton(){return M(this._extension,"scmActionButton"),this._actionButton}set actionButton(t){if(M(this._extension,"scmActionButton"),z1(this._actionButton,t))return;this._actionButton=t,this._actionButtonDisposables.value=new oe;const i=t!==void 0?{command:{...this._commands.converter.toInternal(t.command,this._actionButtonDisposables.value),shortTitle:t.command.shortTitle},secondaryCommands:t.secondaryCommands?.map(r=>r.map(s=>this._commands.converter.toInternal(s,this._actionButtonDisposables.value))),enabled:t.enabled}:void 0;this.#e.$updateSourceControl(this.handle,{actionButton:i??null})}get statusBarCommands(){return this._statusBarCommands}set statusBarCommands(t){if(this._statusBarCommands&&t&&Yj(this._statusBarCommands,t))return;this._statusBarDisposables.value=new oe,this._statusBarCommands=t;const i=(t||[]).map(r=>this._commands.converter.toInternal(r,this._statusBarDisposables.value));this.#e.$updateSourceControl(this.handle,{statusBarCommands:i})}get selected(){return this._selected}constructor(t,i,r,s,n,o,a){this._extension=t,this._commands=s,this._id=n,this._label=o,this._rootUri=a,this._groups=new Map,this._count=void 0,this._quickDiffProvider=void 0,this._secondaryQuickDiffProvider=void 0,this._historyProviderDisposable=new Kr,this._commitTemplate=void 0,this._acceptInputDisposables=new Kr,this._acceptInputCommand=void 0,this._actionButtonDisposables=new Kr,this._statusBarDisposables=new Kr,this._statusBarCommands=void 0,this._selected=!1,this._onDidChangeSelection=new D,this.onDidChangeSelection=this._onDidChangeSelection.event,this.handle=G8._handlePool++,this.createdResourceGroups=new Map,this.updatedResourceGroups=new Set,this.#e=r;const l=b.from({scheme:V.vscodeSourceControl,path:`${n}/scm${this.handle}/input`,query:a?`rootUri=${encodeURIComponent(a.toString())}`:void 0});this._inputBox=new Zj(t,i,this.#e,this.handle,l),this.#e.$registerSourceControl(this.handle,n,o,a,l)}createResourceGroup(t,i,r){const s=nt(this._extension,"scmMultiDiffEditor")&&r?.multiDiffEditorEnableViewChanges===!0,n=new eG(this.#e,this._commands,this.handle,t,i,s,this._extension),o=Fe.once(n.onDidDispose)(()=>this.createdResourceGroups.delete(n));return this.createdResourceGroups.set(n,o),this.eventuallyAddResourceGroups(),n}eventuallyAddResourceGroups(){const t=[],i=[];for(const[r,s]of this.createdResourceGroups){s.dispose();const n=r.onDidUpdateResourceStates(()=>{this.updatedResourceGroups.add(r),this.eventuallyUpdateResourceStates()});Fe.once(r.onDidDispose)(()=>{this.updatedResourceGroups.delete(r),n.dispose(),this._groups.delete(r.handle),this.#e.$unregisterGroup(this.handle,r.handle)}),t.push([r.handle,r.id,r.label,r.features,r.multiDiffEditorEnableViewChanges]);const o=r._takeResourceStateSnapshot();o.length>0&&i.push([r.handle,o]),this._groups.set(r.handle,r)}this.#e.$registerGroups(this.handle,t,i),this.createdResourceGroups.clear()}eventuallyUpdateResourceStates(){const t=[];this.updatedResourceGroups.forEach(i=>{const r=i._takeResourceStateSnapshot();r.length!==0&&t.push([i.handle,r])}),t.length>0&&this.#e.$spliceResourceStates(this.handle,t),this.updatedResourceGroups.clear()}getResourceGroup(t){return this._groups.get(t)}setSelectionState(t){this._selected=t,this._onDidChangeSelection.fire(t)}dispose(){this._acceptInputDisposables.dispose(),this._actionButtonDisposables.dispose(),this._statusBarDisposables.dispose(),this._groups.forEach(t=>t.dispose()),this.#e.$unregisterSourceControl(this.handle)}};__decorate([Ah(100)],Ub.prototype,"eventuallyAddResourceGroups",null),__decorate([Ah(100)],Ub.prototype,"eventuallyUpdateResourceStates",null);var Wb=class{static{Ob=this}static{this._handlePool=0}get onDidChangeActiveProvider(){return this._onDidChangeActiveProvider.event}constructor(t,i,r,s){this._commands=i,this._extHostDocuments=r,this.logService=s,this._sourceControls=new Map,this._sourceControlsByExtension=new As,this._onDidChangeActiveProvider=new D,this._proxy=t.getProxy(Q.MainThreadSCM),this._telemetry=t.getProxy(Q.MainThreadTelemetry),i.registerArgumentProcessor({processArgument:n=>{if(n&&n.$mid===3){const o=this._sourceControls.get(n.sourceControlHandle);if(!o)return n;const a=o.getResourceGroup(n.groupHandle);return a?a.getResourceState(n.handle):n}else if(n&&n.$mid===4){const o=this._sourceControls.get(n.sourceControlHandle);return o?o.getResourceGroup(n.groupHandle):n}else if(n&&n.$mid===5){const o=this._sourceControls.get(n.handle);return o||n}return n}})}createSourceControl(t,i,r,s){this.logService.trace("ExtHostSCM#createSourceControl",t.identifier.value,i,r,s),this._telemetry.$publicLog2("api/scm/createSourceControl",{extensionId:t.identifier.value});const n=Ob._handlePool++,o=new Ub(t,this._extHostDocuments,this._proxy,this._commands,i,r,s);this._sourceControls.set(n,o);const a=this._sourceControlsByExtension.get(t.identifier)||[];return a.push(o),this._sourceControlsByExtension.set(t.identifier,a),o}getLastInputBox(t){this.logService.trace("ExtHostSCM#getLastInputBox",t.identifier.value);const i=this._sourceControlsByExtension.get(t.identifier),r=i&&i[i.length-1];return r&&r.inputBox}$provideOriginalResource(t,i,r){const s=b.revive(i);this.logService.trace("ExtHostSCM#$provideOriginalResource",t,s.toString());const n=this._sourceControls.get(t);return!n||!n.quickDiffProvider||!n.quickDiffProvider.provideOriginalResource?Promise.resolve(null):ci(()=>n.quickDiffProvider.provideOriginalResource(s,r)).then(o=>o||null)}$provideSecondaryOriginalResource(t,i,r){const s=b.revive(i);this.logService.trace("ExtHostSCM#$provideSecondaryOriginalResource",t,s.toString());const n=this._sourceControls.get(t);return!n||!n.secondaryQuickDiffProvider||!n.secondaryQuickDiffProvider.provideOriginalResource?Promise.resolve(null):ci(()=>n.secondaryQuickDiffProvider.provideOriginalResource(s,r)).then(o=>o||null)}$onInputBoxValueChange(t,i){this.logService.trace("ExtHostSCM#$onInputBoxValueChange",t);const r=this._sourceControls.get(t);return r&&r.inputBox.$onInputBoxValueChange(i),Promise.resolve(void 0)}$executeResourceCommand(t,i,r,s){this.logService.trace("ExtHostSCM#$executeResourceCommand",t,i,r);const n=this._sourceControls.get(t);if(!n)return Promise.resolve(void 0);const o=n.getResourceGroup(i);return o?o.$executeResourceCommand(r,s):Promise.resolve(void 0)}$validateInput(t,i,r){this.logService.trace("ExtHostSCM#$validateInput",t);const s=this._sourceControls.get(t);return!s||!s.inputBox.validateInput?Promise.resolve(void 0):ci(()=>s.inputBox.validateInput(i,r)).then(n=>{if(!n)return Promise.resolve(void 0);const o=ve.fromStrict(n.message);return o?Promise.resolve([o,n.type]):Promise.resolve(void 0)})}$setSelectedSourceControl(t){return this.logService.trace("ExtHostSCM#$setSelectedSourceControl",t),t!==void 0&&this._sourceControls.get(t)?.setSelectionState(!0),this._selectedSourceControlHandle!==void 0&&this._sourceControls.get(this._selectedSourceControlHandle)?.setSelectionState(!1),this._selectedSourceControlHandle=t,Promise.resolve(void 0)}async $resolveHistoryItemRefsCommonAncestor(t,i,r){try{return await this._sourceControls.get(t)?.historyProvider?.resolveHistoryItemRefsCommonAncestor(i,r)??void 0}catch(s){this.logService.error("ExtHostSCM#$resolveHistoryItemRefsCommonAncestor",s);return}}async $provideHistoryItemRefs(t,i,r){try{return(await this._sourceControls.get(t)?.historyProvider?.provideHistoryItemRefs(i,r))?.map(o=>({...o,icon:oa(o.icon)}))??void 0}catch(s){this.logService.error("ExtHostSCM#$provideHistoryItemRefs",s);return}}async $provideHistoryItems(t,i,r){try{return(await this._sourceControls.get(t)?.historyProvider?.provideHistoryItems(i,r))?.map(o=>Gj(o))??void 0}catch(s){this.logService.error("ExtHostSCM#$provideHistoryItems",s);return}}async $provideHistoryItemChanges(t,i,r,s){try{return await this._sourceControls.get(t)?.historyProvider?.provideHistoryItemChanges(i,r,s)??void 0}catch(n){this.logService.error("ExtHostSCM#$provideHistoryItemChanges",n);return}}};Wb=Ob=__decorate([__param(3,ke)],Wb);var tG=class Q8{static{this.handlePool=0}constructor(t,i){this.uriTransformer=i,this.providers=new Map,this.proxy=t.getProxy(Q.MainThreadShare)}async $provideShare(t,i,r){return await this.providers.get(t)?.provideShare({selection:F.to(i.selection),resourceUri:b.revive(i.resourceUri)},r)??void 0}registerShareProvider(t,i){const r=Q8.handlePool++;return this.providers.set(r,i),this.proxy.$registerShareProvider(r,wl.from(t,this.uriTransformer),i.id,i.label,i.priority),{dispose:()=>{this.proxy.$unregisterShareProvider(r),this.providers.delete(r)}}}},iG=class J8{static{this.ID_POOL=1}constructor(t){this.providers=new Map,this.sessions=new Map,this.synthesizers=new Map,this.proxy=t.getProxy(Q.MainThreadSpeech)}async $createSpeechToTextSession(t,i,r){const s=this.providers.get(t);if(!s)return;const n=new oe,o=new rt;this.sessions.set(i,o);const a=await s.provideSpeechToTextSession(o.token,r?{language:r}:void 0);a&&(n.add(a.onDidChange(l=>{o.token.isCancellationRequested||this.proxy.$emitSpeechToTextEvent(i,l)})),n.add(o.token.onCancellationRequested(()=>n.dispose())))}async $cancelSpeechToTextSession(t){this.sessions.get(t)?.dispose(!0),this.sessions.delete(t)}async $createTextToSpeechSession(t,i,r){const s=this.providers.get(t);if(!s)return;const n=new oe,o=new rt;this.sessions.set(i,o);const a=await s.provideTextToSpeechSession(o.token,r?{language:r}:void 0);a&&(this.synthesizers.set(i,a),n.add(a.onDidChange(l=>{o.token.isCancellationRequested||this.proxy.$emitTextToSpeechEvent(i,l)})),n.add(o.token.onCancellationRequested(()=>n.dispose())))}async $synthesizeSpeech(t,i){this.synthesizers.get(t)?.synthesize(i)}async $cancelTextToSpeechSession(t){this.sessions.get(t)?.dispose(!0),this.sessions.delete(t),this.synthesizers.delete(t)}async $createKeywordRecognitionSession(t,i){const r=this.providers.get(t);if(!r)return;const s=new oe,n=new rt;this.sessions.set(i,n);const o=await r.provideKeywordRecognitionSession(n.token);o&&(s.add(o.onDidChange(a=>{n.token.isCancellationRequested||this.proxy.$emitKeywordRecognitionEvent(i,a)})),s.add(n.token.onCancellationRequested(()=>s.dispose())))}async $cancelKeywordRecognitionSession(t){this.sessions.get(t)?.dispose(!0),this.sessions.delete(t)}registerProvider(t,i,r){const s=J8.ID_POOL++;return this.providers.set(s,r),this.proxy.$registerProvider(s,i,{extension:t,displayName:t.value}),ie(()=>{this.proxy.$unregisterProvider(s),this.providers.delete(s)})}},rG=class iv{static{this.ID_GEN=0}static{this.ALLOWED_BACKGROUND_COLORS=new Map([["statusBarItem.errorBackground",new gu("statusBarItem.errorForeground")],["statusBarItem.warningBackground",new gu("statusBarItem.warningForeground")]])}#e;#t;constructor(t,i,r,s,n,o=Rn.Left,a,l){if(this._onDispose=l,this._disposed=!1,this._text="",this._staleCommandRegistrations=new oe,this.#e=t,this.#t=i,n&&s){this._entryId=jH(s.identifier,n);const c=r.get(this._entryId);c&&(o=c.alignLeft?Rn.Left:Rn.Right,a=c.priority,this._visible=!0,this.name=c.name,this.text=c.text,this.tooltip=c.tooltip,this.command=c.command,this.accessibilityInformation=c.accessibilityInformation)}else this._entryId=String(iv.ID_GEN++);this._extension=s,this._id=n,this._alignment=o,this._priority=this.validatePriority(a)}validatePriority(t){if(cr(t))return t===Number.POSITIVE_INFINITY?Number.MAX_VALUE:t===Number.NEGATIVE_INFINITY?-Number.MAX_VALUE:t}get id(){return this._id??this._extension.identifier.value}get entryId(){return this._entryId}get alignment(){return this._alignment}get priority(){return this._priority}get text(){return this._text}get name(){return this._name}get tooltip(){return this._tooltip}get tooltip2(){return this._extension&&M(this._extension,"statusBarItemTooltip"),this._tooltip2}get color(){return this._color}get backgroundColor(){return this._backgroundColor}get command(){return this._command?.fromApi}get accessibilityInformation(){return this._accessibilityInformation}set text(t){this._text=t,this.update()}set name(t){this._name=t,this.update()}set tooltip(t){this._tooltip=t,this.update()}set tooltip2(t){this._extension&&M(this._extension,"statusBarItemTooltip"),this._tooltip2=t,this.update()}set color(t){this._color=t,this.update()}set backgroundColor(t){t&&!iv.ALLOWED_BACKGROUND_COLORS.has(t.id)&&(t=void 0),this._backgroundColor=t,this.update()}set command(t){this._command?.fromApi!==t&&(this._latestCommandRegistration&&this._staleCommandRegistrations.add(this._latestCommandRegistration),this._latestCommandRegistration=new oe,typeof t=="string"?this._command={fromApi:t,internal:this.#t.toInternal({title:"",command:t},this._latestCommandRegistration)}:t?this._command={fromApi:t,internal:this.#t.toInternal(t,this._latestCommandRegistration)}:this._command=void 0,this.update())}set accessibilityInformation(t){this._accessibilityInformation=t,this.update()}show(){this._visible=!0,this.update()}hide(){clearTimeout(this._timeoutHandle),this._visible=!1,this.#e.$disposeEntry(this._entryId)}update(){this._disposed||!this._visible||(clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{this._timeoutHandle=void 0;let t;this._extension?this._id?t=`${this._extension.identifier.value}.${this._id}`:t=this._extension.identifier.value:t=this._id;let i;this._name?i=this._name:i=h(2935,null,this._extension.displayName||this._extension.name);let r=this._color;this._backgroundColor&&(r=iv.ALLOWED_BACKGROUND_COLORS.get(this._backgroundColor.id));let s,n;typeof this._tooltip2=="function"?(s=ve.fromStrict(this._tooltip),n=!0):(s=ve.fromStrict(this._tooltip2??this._tooltip),n=!1),this.#e.$setEntry(this._entryId,t,this._extension?.identifier.value,i,this._text,s,n,this._command?.internal,r,this._backgroundColor,this._alignment===Rn.Left,this._priority,this._accessibilityInformation),this._staleCommandRegistrations.clear()},0))}dispose(){this.hide(),this._onDispose?.(),this._disposed=!0}},sG=class{constructor(e){this._messages=[],this._item=e.createStatusBarEntry(void 0,"status.extensionMessage",Rn.Left,Number.MIN_VALUE),this._item.name=h(2936,null)}dispose(){this._messages.length=0,this._item.dispose()}setMessage(e){const t={message:e};return this._messages.unshift(t),this._update(),new Ie(()=>{const i=this._messages.indexOf(t);i>=0&&(this._messages.splice(i,1),this._update())})}_update(){this._messages.length>0?(this._item.text=this._messages[0].message,this._item.show()):this._item.hide()}},nG=class{constructor(e,t){this._entries=new Map,this._existingItems=new Map,this._proxy=e.getProxy(Q.MainThreadStatusBar),this._commands=t,this._statusMessage=new sG(this)}$acceptStaticEntries(e){for(const t of e)this._existingItems.set(t.entryId,t)}async $provideTooltip(e,t){const i=this._entries.get(e);if(!i)return;const r=typeof i.tooltip2=="function"?await i.tooltip2(t):i.tooltip2;return t.isCancellationRequested?void 0:ve.fromStrict(r)}createStatusBarEntry(e,t,i,r){const s=new rG(this._proxy,this._commands,this._existingItems,e,t,i,r,()=>this._entries.delete(s.entryId));return this._entries.set(s.entryId,s),s}setStatusBarMessage(e,t){const i=this._statusMessage.setMessage(e);let r;return typeof t=="number"?r=setTimeout(()=>i.dispose(),t):typeof t<"u"&&t.then(()=>i.dispose(),()=>i.dispose()),new Ie(()=>{i.dispose(),clearTimeout(r)})}},oG=class extends X{constructor(e,t){super(),this._extHostDocumentsAndEditors=t,this._onDidChangeTextEditorSelection=new D,this._onDidChangeTextEditorOptions=new D,this._onDidChangeTextEditorVisibleRanges=new D,this._onDidChangeTextEditorViewColumn=new D,this._onDidChangeTextEditorDiffInformation=new D,this._onDidChangeActiveTextEditor=new D,this._onDidChangeVisibleTextEditors=new D,this.onDidChangeTextEditorSelection=this._onDidChangeTextEditorSelection.event,this.onDidChangeTextEditorOptions=this._onDidChangeTextEditorOptions.event,this.onDidChangeTextEditorVisibleRanges=this._onDidChangeTextEditorVisibleRanges.event,this.onDidChangeTextEditorViewColumn=this._onDidChangeTextEditorViewColumn.event,this.onDidChangeTextEditorDiffInformation=this._onDidChangeTextEditorDiffInformation.event,this.onDidChangeActiveTextEditor=this._onDidChangeActiveTextEditor.event,this.onDidChangeVisibleTextEditors=this._onDidChangeVisibleTextEditors.event,this._proxy=e.getProxy(Q.MainThreadTextEditors),this._register(this._extHostDocumentsAndEditors.onDidChangeVisibleTextEditors(i=>this._onDidChangeVisibleTextEditors.fire(i))),this._register(this._extHostDocumentsAndEditors.onDidChangeActiveTextEditor(i=>this._onDidChangeActiveTextEditor.fire(i)))}getActiveTextEditor(){return this._extHostDocumentsAndEditors.activeEditor()}getVisibleTextEditors(e){const t=this._extHostDocumentsAndEditors.allEditors();return e?t:t.map(i=>i.value)}async showTextDocument(e,t,i){let r;typeof t=="number"?r={position:jt.from(t),preserveFocus:i}:typeof t=="object"?r={position:jt.from(t.viewColumn),preserveFocus:t.preserveFocus,selection:typeof t.selection=="object"?F.from(t.selection):void 0,pinned:typeof t.preview=="boolean"?!t.preview:void 0}:r={preserveFocus:!1};const s=await this._proxy.$tryShowTextDocument(e.uri,r),n=s&&this._extHostDocumentsAndEditors.getEditor(s);if(n)return n.value;throw s?new Error(`Could NOT open editor for "${e.uri.toString()}" because another editor opened in the meantime.`):new Error(`Could NOT open editor for "${e.uri.toString()}".`)}createTextEditorDecorationType(e,t){return new CB(this._proxy,e,t).value}$acceptEditorPropertiesChanged(e,t){const i=this._extHostDocumentsAndEditors.getEditor(e);if(!i)throw new Error("unknown text editor");if(t.options&&i._acceptOptions(t.options),t.selections){const r=t.selections.selections.map(Ur.to);i._acceptSelections(r)}if(t.visibleRanges){const r=Et(t.visibleRanges.map(F.to));i._acceptVisibleRanges(r)}if(t.options&&this._onDidChangeTextEditorOptions.fire({textEditor:i.value,options:{...t.options,lineNumbers:El.to(t.options.lineNumbers)}}),t.selections){const r=il.fromValue(t.selections.source),s=t.selections.selections.map(Ur.to);this._onDidChangeTextEditorSelection.fire({textEditor:i.value,selections:s,kind:r})}if(t.visibleRanges){const r=Et(t.visibleRanges.map(F.to));this._onDidChangeTextEditorVisibleRanges.fire({textEditor:i.value,visibleRanges:r})}}$acceptEditorPositionData(e){for(const t in e){const i=this._extHostDocumentsAndEditors.getEditor(t);if(!i)throw new Error("Unknown text editor");const r=jt.to(e[t]);i.value.viewColumn!==r&&(i._acceptViewColumn(r),this._onDidChangeTextEditorViewColumn.fire({textEditor:i.value,viewColumn:r}))}}$acceptEditorDiffInformation(e,t){const i=this._extHostDocumentsAndEditors.getEditor(e);if(!i)throw new Error("unknown text editor");if(!t){i._acceptDiffInformation(void 0),this._onDidChangeTextEditorDiffInformation.fire({textEditor:i.value,diffInformation:void 0});return}const r=this,s=t.map(n=>{const o=b.revive(n.original),a=b.revive(n.modified),l=n.changes.map(c=>{const[u,d,f,p]=c;let g;return u===d?g=rl.Addition:f===p?g=rl.Deletion:g=rl.Modification,{original:{startLineNumber:u,endLineNumberExclusive:d},modified:{startLineNumber:f,endLineNumberExclusive:p},kind:g}});return Object.freeze({documentVersion:n.documentVersion,original:o,modified:a,changes:l,get isStale(){return r._extHostDocumentsAndEditors.getDocument(a)?.version!==n.documentVersion}})});i._acceptDiffInformation(s),this._onDidChangeTextEditorDiffInformation.fire({textEditor:i.value,diffInformation:s})}getDiffInformation(e){return Promise.resolve(this._proxy.$getDiffInformation(e))}},Bb=class{constructor(t){this._actual=new up(Mn.Dark),this._onDidChangeActiveColorTheme=new D}get activeColorTheme(){return this._actual}$onColorThemeChange(t){let i;switch(t){case"light":i=Mn.Light;break;case"hcDark":i=Mn.HighContrast;break;case"hcLight":i=Mn.HighContrastLight;break;default:i=Mn.Dark}this._actual=new up(i),this._onDidChangeActiveColorTheme.fire(this._actual)}get onDidChangeActiveColorTheme(){return this._onDidChangeActiveColorTheme.event}};Bb=__decorate([__param(0,Pe)],Bb);var jse=q("IExtHostTimeline"),aG=class{constructor(e,t){this._providers=new Map,this._itemsBySourceAndUriMap=new Map,this._proxy=e.getProxy(Q.MainThreadTimeline),t.registerArgumentProcessor({processArgument:(i,r)=>{if(i&&i.$mid===12)if(this._providers.get(i.source)&&r&&nt(r,"timeline")){const s=i.uri===void 0?void 0:b.revive(i.uri);return this._itemsBySourceAndUriMap.get(i.source)?.get(b7(s))?.get(i.handle)}else return;return i}})}async $getTimeline(e,t,i,r){return this._providers.get(e)?.provider.provideTimeline(b.revive(t),i,r)}registerTimelineProvider(e,t,i,r){const s=new oe,n=this.convertTimelineItem(t.id,r,s).bind(this);let o;t.onDidChange&&(o=t.onDidChange(l=>this._proxy.$emitTimelineChangeEvent({uri:void 0,reset:!0,...l,id:t.id}),this));const a=this._itemsBySourceAndUriMap;return this.registerTimelineProviderCore({...t,scheme:e,onDidChange:void 0,async provideTimeline(l,c,u){c?.resetCache&&(s.clear(),a.get(t.id)?.clear());const d=await t.provideTimeline(l,c,u);if(d==null)return;const f=n(l,c);return{...d,source:t.id,items:d.items.map(f)}},dispose(){for(const l of a.values())l.get(t.id)?.clear();o?.dispose(),s.dispose()}},i)}convertTimelineItem(e,t,i){return(r,s)=>{let n;if(s?.cacheResults){let o=this._itemsBySourceAndUriMap.get(e);o===void 0&&(o=new Map,this._itemsBySourceAndUriMap.set(e,o));const a=b7(r);n=o.get(a),n===void 0&&(n=new Map,o.set(a,n))}return o=>{const{iconPath:a,...l}=o,c=`${e}|${o.id??o.timestamp}`;n?.set(c,o);let u,d,f;o.iconPath&&(a instanceof pi?f={id:a.id,color:a.color}:b.isUri(a)?(u=a,d=a):{light:u,dark:d}=a);let p;return Ti.isMarkdownString(l.tooltip)?p=ve.from(l.tooltip):Oe(l.tooltip)?p=l.tooltip:Ti.isMarkdownString(l.detail)?(console.warn("Using deprecated TimelineItem.detail, migrate to TimelineItem.tooltip"),p=ve.from(l.detail)):Oe(l.detail)&&(console.warn("Using deprecated TimelineItem.detail, migrate to TimelineItem.tooltip"),p=l.detail),{...l,id:l.id??void 0,handle:c,source:e,command:o.command?t.toInternal(o.command,i):void 0,icon:u,iconDark:d,themeIcon:f,tooltip:p,accessibilityInformation:o.accessibilityInformation}}}}registerTimelineProviderCore(e,t){if(this._providers.get(e.id))throw new Error(`Timeline Provider ${e.id} already exists.`);return this._proxy.$registerTimelineProvider({id:e.id,label:e.label,scheme:e.scheme}),this._providers.set(e.id,{provider:e,extension:t}),ie(()=>{for(const r of this._itemsBySourceAndUriMap.values())r.get(e.id)?.clear();this._providers.delete(e.id),this._proxy.$unregisterTimelineProvider(e.id),e.dispose()})}};function b7(e){return e?.toString()}var lG={IconContribution:"base.contributions.icons"},S7;(function(e){function t(i,r){let s=i.defaults;for(;Wt.isThemeIcon(s);){const n=Ql.getIcon(s.id);if(!n)return;s=n.defaults}return s}e.getDefinition=t})(S7||(S7={}));var x7;(function(e){function t(r){return{weight:r.weight,style:r.style,src:r.src.map(s=>({format:s.format,location:s.location.toString()}))}}e.toJSONObject=t;function i(r){const s=n=>Oe(n)?n:void 0;if(r&&Array.isArray(r.src)&&r.src.every(n=>Oe(n.format)&&Oe(n.location)))return{weight:s(r.weight),style:s(r.style),src:r.src.map(n=>({format:n.format,location:b.parse(n.location)}))}}e.fromJSONObject=i})(x7||(x7={}));var cG=/^([\w_-]+)$/,uG=h(2558,null),dG=class extends X{constructor(){super(),this._onDidChange=this._register(new D),this.onDidChange=this._onDidChange.event,this.iconSchema={definitions:{icons:{type:"object",properties:{fontId:{type:"string",description:h(2559,null),pattern:cG.source,patternErrorMessage:uG},fontCharacter:{type:"string",description:h(2560,null)}},additionalProperties:!1,defaultSnippets:[{body:{fontCharacter:"\\\\e030"}}]}},type:"object",properties:{}},this.iconReferenceSchema={type:"string",pattern:`^${Wt.iconNameExpression}$`,enum:[],enumDescriptions:[]},this.iconsById={},this.iconFontsById={}}registerIcon(e,t,i,r){const s=this.iconsById[e];if(s){if(i&&!s.description){s.description=i,this.iconSchema.properties[e].markdownDescription=`${i} $(${e})`;const a=this.iconReferenceSchema.enum.indexOf(e);a!==-1&&(this.iconReferenceSchema.enumDescriptions[a]=i),this._onDidChange.fire()}return s}const n={id:e,description:i,defaults:t,deprecationMessage:r};this.iconsById[e]=n;const o={$ref:"#/definitions/icons"};return r&&(o.deprecationMessage=r),i&&(o.markdownDescription=`${i}: $(${e})`),this.iconSchema.properties[e]=o,this.iconReferenceSchema.enum.push(e),this.iconReferenceSchema.enumDescriptions.push(i||""),this._onDidChange.fire(),{id:e}}deregisterIcon(e){delete this.iconsById[e],delete this.iconSchema.properties[e];const t=this.iconReferenceSchema.enum.indexOf(e);t!==-1&&(this.iconReferenceSchema.enum.splice(t,1),this.iconReferenceSchema.enumDescriptions.splice(t,1)),this._onDidChange.fire()}getIcons(){return Object.keys(this.iconsById).map(e=>this.iconsById[e])}getIcon(e){return this.iconsById[e]}getIconSchema(){return this.iconSchema}getIconReferenceSchema(){return this.iconReferenceSchema}registerIconFont(e,t){const i=this.iconFontsById[e];return i||(this.iconFontsById[e]=t,this._onDidChange.fire(),t)}deregisterIconFont(e){delete this.iconFontsById[e]}getIconFont(e){return this.iconFontsById[e]}toString(){const e=(s,n)=>s.id.localeCompare(n.id),t=s=>{for(;Wt.isThemeIcon(s.defaults);)s=this.iconsById[s.defaults.id];return`codicon codicon-${s?s.id:""}`},i=[];i.push("| preview     | identifier                        | default codicon ID                | description"),i.push("| ----------- | --------------------------------- | --------------------------------- | --------------------------------- |");const r=Object.keys(this.iconsById).map(s=>this.iconsById[s]);for(const s of r.filter(n=>!!n.description).sort(e))i.push(`|<i class="${t(s)}"></i>|${s.id}|${Wt.isThemeIcon(s.defaults)?s.defaults.id:s.id}|${s.description||""}|`);i.push("| preview     | identifier                        "),i.push("| ----------- | --------------------------------- |");for(const s of r.filter(n=>!Wt.isThemeIcon(n.defaults)).sort(e))i.push(`|<i class="${t(s)}"></i>|${s.id}|`);return i.join(`
`)}},Ql=new dG;Xt.add(lG.IconContribution,Ql);function Im(e,t,i,r){return Ql.registerIcon(e,t,i,r)}function hG(){const e=hO();for(const t in e){const i="\\"+e[t].toString(16);Ql.registerIcon(t,{fontCharacter:i})}}hG();var E7="vscode://schemas/icons",C7=Xt.as(df.JSONContribution);C7.registerSchema(E7,Ql.getIconSchema());var D7=new ks(()=>C7.notifySchemaChanged(E7),200);Ql.onDidChange(()=>{D7.isScheduled()||D7.schedule()});var Gse=Im("widget-close",ue.close,h(2561,null)),Qse=Im("goto-previous-location",ue.arrowUp,h(2562,null)),Jse=Im("goto-next-location",ue.arrowDown,h(2563,null)),Kse=Wt.modify(ue.sync,"spin"),Xse=Wt.modify(ue.loading,"spin"),Yse=h(4495,null),Zse=Im("default-view-icon",ue.window,h(4496,null)),Pm;(function(e){e.ViewContainersRegistry="workbench.registry.view.containers",e.ViewsRegistry="workbench.registry.view"})(Pm||(Pm={}));var k7;(function(e){e[e.Sidebar=0]="Sidebar",e[e.Panel=1]="Panel",e[e.AuxiliaryBar=2]="AuxiliaryBar"})(k7||(k7={}));var fG=class extends X{constructor(){super(...arguments),this._onDidRegister=this._register(new D),this.onDidRegister=this._onDidRegister.event,this._onDidDeregister=this._register(new D),this.onDidDeregister=this._onDidDeregister.event,this.viewContainers=new Map,this.defaultViewContainers=[]}get all(){return[...this.viewContainers.values()].flat()}registerViewContainer(e,t,i){const r=this.get(e.id);if(r)return r;const s=e;return s.openCommandActionDescriptor=i?.doNotRegisterOpenCommand?void 0:s.openCommandActionDescriptor??{id:s.id},qR(this.viewContainers,t,[]).push(s),i?.isDefault&&this.defaultViewContainers.push(s),this._onDidRegister.fire({viewContainer:s,viewContainerLocation:t}),s}deregisterViewContainer(e){for(const t of this.viewContainers.keys()){const i=this.viewContainers.get(t),r=i?.indexOf(e);if(r!==-1){i?.splice(r,1),i.length===0&&this.viewContainers.delete(t),this._onDidDeregister.fire({viewContainer:e,viewContainerLocation:t});return}}}get(e){return this.all.filter(t=>t.id===e)[0]}getViewContainers(e){return[...this.viewContainers.get(e)||[]]}getViewContainerLocation(e){return[...this.viewContainers.keys()].filter(t=>this.getViewContainers(t).filter(i=>i?.id===e.id).length>0)[0]}getDefaultViewContainer(e){return this.defaultViewContainers.find(t=>this.getViewContainerLocation(t)===e)}};Xt.add(Pm.ViewContainersRegistry,new fG);var Tm;(function(e){e.Open="2_open",e.Debug="4_debug",e.SCM="5_scm",e.More="9_more"})(Tm||(Tm={}));function pG(e,t){const i=e.group??Tm.More,r=t.group??Tm.More;return i!==r?i.localeCompare(r):(e.order??5)-(t.order??5)}var gG=class extends X{constructor(){super(...arguments),this._onViewsRegistered=this._register(new D),this.onViewsRegistered=this._onViewsRegistered.event,this._onViewsDeregistered=this._register(new D),this.onViewsDeregistered=this._onViewsDeregistered.event,this._onDidChangeContainer=this._register(new D),this.onDidChangeContainer=this._onDidChangeContainer.event,this._onDidChangeViewWelcomeContent=this._register(new D),this.onDidChangeViewWelcomeContent=this._onDidChangeViewWelcomeContent.event,this._viewContainers=[],this._views=new Map,this._viewWelcomeContents=new lx}registerViews(e,t){this.registerViews2([{views:e,viewContainer:t}])}registerViews2(e){e.forEach(({views:t,viewContainer:i})=>this.addViews(t,i)),this._onViewsRegistered.fire(e)}deregisterViews(e,t){const i=this.removeViews(e,t);i.length&&this._onViewsDeregistered.fire({views:i,viewContainer:t})}moveViews(e,t){for(const i of this._views.keys())if(i!==t){const r=this.removeViews(e,i);r.length&&(this.addViews(r,t),this._onDidChangeContainer.fire({views:r,from:i,to:t}))}}getViews(e){return this._views.get(e)||[]}getView(e){for(const t of this._viewContainers){const i=(this._views.get(t)||[]).filter(r=>r.id===e)[0];if(i)return i}return null}getViewContainer(e){for(const t of this._viewContainers)if((this._views.get(t)||[]).filter(r=>r.id===e)[0])return t;return null}registerViewWelcomeContent(e,t){return this._viewWelcomeContents.add(e,t),this._onDidChangeViewWelcomeContent.fire(e),ie(()=>{this._viewWelcomeContents.delete(e,t),this._onDidChangeViewWelcomeContent.fire(e)})}registerViewWelcomeContent2(e,t){const i=new Map;for(const[r,s]of t)this._viewWelcomeContents.add(e,s),i.set(r,ie(()=>{this._viewWelcomeContents.delete(e,s),this._onDidChangeViewWelcomeContent.fire(e)}));return this._onDidChangeViewWelcomeContent.fire(e),i}getViewWelcomeContent(e){const t=[];return this._viewWelcomeContents.forEach(e,i=>t.push(i)),t.sort(pG)}addViews(e,t){let i=this._views.get(t);i||(i=[],this._views.set(t,i),this._viewContainers.push(t));for(const r of e){if(this.getView(r.id)!==null)throw new Error(h(4497,null,r.id));i.push(r)}}removeViews(e,t){const i=this._views.get(t);if(!i)return[];const r=[],s=[];for(const n of i)e.includes(n)?r.push(n):s.push(n);return r.length&&(s.length?this._views.set(t,s):(this._views.delete(t),this._viewContainers.splice(this._viewContainers.indexOf(t),1))),r}};Xt.add(Pm.ViewsRegistry,new gG);var ene=q("viewDescriptorService"),I7;(function(e){e[e.Default=0]="Default",e[e.Expand=1]="Expand"})(I7||(I7={}));var P7;(function(e){e[e.None=0]="None",e[e.Collapsed=1]="Collapsed",e[e.Expanded=2]="Expanded"})(P7||(P7={}));var rn=class extends Error{constructor(e){super(h(4498,null,e)),this.name="NoTreeViewError"}static is(e){return!!e&&e.name==="NoTreeViewError"}},mG=class{constructor(){this._dragOperations=new Map}removeDragOperationTransfer(e){if(e&&this._dragOperations.has(e)){const t=this._dragOperations.get(e);return this._dragOperations.delete(e),t}}addDragOperationTransfer(e,t){this._dragOperations.set(e,t)}};function T7(e,t){if(Oe(e))return{label:e};if(e&&typeof e=="object"&&typeof e.label=="string"){let i;return Array.isArray(e.highlights)&&(i=e.highlights.filter(r=>r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"),i=i.length?i:void 0),{label:e.label,highlights:i}}}var vG=class extends X{constructor(e,t,i){super(),this._proxy=e,this.commands=t,this.logService=i,this.treeViews=new Map,this.treeDragAndDropService=new mG;function r(s){return s&&s.$treeViewId&&(s.$treeItemHandle||s.$selectedTreeItems||s.$focusedTreeItem)}t.registerArgumentProcessor({processArgument:s=>r(s)?this.convertArgument(s):Array.isArray(s)&&s.length>0?s.map(n=>r(n)?this.convertArgument(n):n):s})}registerTreeDataProvider(e,t,i){const r=this.createTreeView(e,{treeDataProvider:t},i);return{dispose:()=>r.dispose()}}createTreeView(e,t,i){if(!t||!t.treeDataProvider)throw new Error("Options with treeDataProvider is mandatory");const r=t.dragAndDropController?.dropMimeTypes??[],s=t.dragAndDropController?.dragMimeTypes??[],n=!!t.dragAndDropController?.handleDrag,o=!!t.dragAndDropController?.handleDrop,a=this.createExtHostTreeView(e,t,i),l={showCollapseAll:!!t.showCollapseAll,canSelectMany:!!t.canSelectMany,dropMimeTypes:r,dragMimeTypes:s,hasHandleDrag:n,hasHandleDrop:o,manuallyManageCheckboxes:!!t.manageCheckboxStateManually},c=this._proxy.$registerTreeViewDataProvider(e,l),u={get onDidCollapseElement(){return a.onDidCollapseElement},get onDidExpandElement(){return a.onDidExpandElement},get selection(){return a.selectedElements},get onDidChangeSelection(){return a.onDidChangeSelection},get activeItem(){return M(i,"treeViewActiveItem"),a.focusedElement},get onDidChangeActiveItem(){return M(i,"treeViewActiveItem"),a.onDidChangeActiveItem},get visible(){return a.visible},get onDidChangeVisibility(){return a.onDidChangeVisibility},get onDidChangeCheckboxState(){return a.onDidChangeCheckboxState},get message(){return a.message},set message(d){Ns(d)&&M(i,"treeViewMarkdownMessage"),a.message=d},get title(){return a.title},set title(d){a.title=d},get description(){return a.description},set description(d){a.description=d},get badge(){return a.badge},set badge(d){d!==void 0&&G_.isViewBadge(d)?a.badge={value:Math.floor(Math.abs(d.value)),tooltip:d.tooltip}:d===void 0&&(a.badge=void 0)},reveal:(d,f)=>a.reveal(d,f),dispose:async()=>{await c,this.treeViews.delete(e),a.dispose()}};return this._register(u),u}async $getChildren(e,t){const i=this.treeViews.get(e);if(!i)return Promise.reject(new rn(e));if(!t){const s=await i.getChildren();return s?[[0,...s]]:void 0}const r=[];for(let s=0;s<t.length;s++){const n=t[s],o=await i.getChildren(n);o&&r.push([s,...o])}return r}async $handleDrop(e,t,i,r,s,n,o,a){const l=this.treeViews.get(e);if(!l)return Promise.reject(new rn(e));const c=Al.toDataTransfer(i,async u=>(await this._proxy.$resolveDropFileData(e,t,u)).buffer);return o===e&&a&&await this.addAdditionalTransferItems(c,l,a,s,n),l.onDrop(c,r,s)}async addAdditionalTransferItems(e,t,i,r,s){const n=this.treeDragAndDropService.removeDragOperationTransfer(s);if(n)(await n)?.forEach((o,a)=>{o&&e.set(a,o)});else if(s&&t.handleDrag){const o=t.handleDrag(i,e,r);this.treeDragAndDropService.addDragOperationTransfer(s,o),await o}return e}async $handleDrag(e,t,i,r){const s=this.treeViews.get(e);if(!s)return Promise.reject(new rn(e));const n=await this.addAdditionalTransferItems(new al,s,t,r,i);if(!(!n||r.isCancellationRequested))return Al.from(n)}async $hasResolve(e){const t=this.treeViews.get(e);if(!t)throw new rn(e);return t.hasResolve}$resolve(e,t,i){const r=this.treeViews.get(e);if(!r)throw new rn(e);return r.resolveTreeItem(t,i)}$setExpanded(e,t,i){const r=this.treeViews.get(e);if(!r)throw new rn(e);r.setExpanded(t,i)}$setSelectionAndFocus(e,t,i){const r=this.treeViews.get(e);if(!r)throw new rn(e);r.setSelectionAndFocus(t,i)}$setVisible(e,t){const i=this.treeViews.get(e);if(!i){if(!t)return;throw new rn(e)}i.setVisible(t)}$changeCheckboxState(e,t){const i=this.treeViews.get(e);if(!i)throw new rn(e);i.setCheckboxState(t)}createExtHostTreeView(e,t,i){const r=this._register(new _G(e,t,this._proxy,this.commands.converter,this.logService,i));return this.treeViews.set(e,r),r}convertArgument(e){const t=this.treeViews.get(e.$treeViewId);return t&&"$treeItemHandle"in e?t.getExtensionElement(e.$treeItemHandle):t&&"$focusedTreeItem"in e&&e.$focusedTreeItem?t.focusedElement:null}},_G=class zS extends X{static{this.LABEL_HANDLE_PREFIX="0"}static{this.ID_HANDLE_PREFIX="1"}get visible(){return this._visible}get selectedElements(){return this._selectedHandles.map(t=>this.getExtensionElement(t)).filter(t=>!Lt(t))}get focusedElement(){return this._focusedHandle?this.getExtensionElement(this._focusedHandle):void 0}constructor(t,i,r,s,n,o){if(super(),this.viewId=t,this.proxy=r,this.commands=s,this.logService=n,this.extension=o,this.roots=void 0,this.elements=new Map,this.nodes=new Map,this._visible=!1,this._selectedHandles=[],this._focusedHandle=void 0,this._onDidExpandElement=this._register(new D),this.onDidExpandElement=this._onDidExpandElement.event,this._onDidCollapseElement=this._register(new D),this.onDidCollapseElement=this._onDidCollapseElement.event,this._onDidChangeSelection=this._register(new D),this.onDidChangeSelection=this._onDidChangeSelection.event,this._onDidChangeActiveItem=this._register(new D),this.onDidChangeActiveItem=this._onDidChangeActiveItem.event,this._onDidChangeVisibility=this._register(new D),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._onDidChangeCheckboxState=this._register(new D),this.onDidChangeCheckboxState=this._onDidChangeCheckboxState.event,this._onDidChangeData=this._register(new D),this.refreshPromise=Promise.resolve(),this.refreshQueue=Promise.resolve(),this._message="",this._title="",this._refreshCancellationSource=new rt,o.contributes&&o.contributes.views)for(const u in o.contributes.views)for(const d of o.contributes.views[u])d.id===t&&(this._title=d.name);this.dataProvider=i.treeDataProvider,this.dndController=i.dragAndDropController,this.dataProvider.onDidChangeTreeData&&this._register(this.dataProvider.onDidChangeTreeData(u=>{Array.isArray(u)&&u.length===0||this._onDidChangeData.fire({message:!1,element:u})}));let a,l;const c=Fe.debounce(this._onDidChangeData.event,(u,d)=>(u||(u={message:!1,elements:[]}),d.element!==!1&&(a||(a=new Promise(f=>l=f),this.refreshPromise=this.refreshPromise.then(()=>a)),Array.isArray(d.element)?u.elements.push(...d.element):u.elements.push(d.element)),d.message&&(u.message=!0),u),200,!0);this._register(c(({message:u,elements:d})=>{d.length&&(this.refreshQueue=this.refreshQueue.then(()=>{const f=l;return a=null,this.refresh(d).then(()=>f())})),u&&this.proxy.$setMessage(this.viewId,ve.fromStrict(this._message)??"")}))}async getChildren(t){const i=t?this.getExtensionElement(t):void 0;if(t&&!i)return this.logService.error(`No tree item with id '${t}' found.`),Promise.resolve([]);let r=this.getChildrenNodes(t);return r||(r=await this.fetchChildrenNodes(i)),r?r.map(s=>s.item):void 0}getExtensionElement(t){return this.elements.get(t)}reveal(t,i){i=i||{select:!0,focus:!1};const r=Lt(i.select)?!0:i.select,s=Lt(i.focus)?!1:i.focus,n=Lt(i.expand)?!1:i.expand;return typeof this.dataProvider.getParent!="function"?Promise.reject(new Error("Required registered TreeDataProvider to implement 'getParent' method to access 'reveal' method")):t?this.refreshPromise.then(()=>this.resolveUnknownParentChain(t)).then(o=>this.resolveTreeNode(t,o[o.length-1]).then(a=>this.proxy.$reveal(this.viewId,{item:a.item,parentChain:o.map(l=>l.item)},{select:r,focus:s,expand:n})),o=>this.logService.error(o)):this.proxy.$reveal(this.viewId,void 0,{select:r,focus:s,expand:n})}get message(){return this._message}set message(t){this._message=t,this._onDidChangeData.fire({message:!0,element:!1})}get title(){return this._title}set title(t){this._title=t,this.proxy.$setTitle(this.viewId,t,this._description)}get description(){return this._description}set description(t){this._description=t,this.proxy.$setTitle(this.viewId,this._title,t)}get badge(){return this._badge}set badge(t){this._badge?.value===t?.value&&this._badge?.tooltip===t?.tooltip||(this._badge=Yp.from(t),this.proxy.$setBadge(this.viewId,t))}setExpanded(t,i){const r=this.getExtensionElement(t);r&&(i?this._onDidExpandElement.fire(Object.freeze({element:r})):this._onDidCollapseElement.fire(Object.freeze({element:r})))}setSelectionAndFocus(t,i){const r=!Er(this._selectedHandles,t);this._selectedHandles=t;const s=this._focusedHandle!==i;this._focusedHandle=i,r&&this._onDidChangeSelection.fire(Object.freeze({selection:this.selectedElements})),s&&this._onDidChangeActiveItem.fire(Object.freeze({activeItem:this.focusedElement}))}setVisible(t){t!==this._visible&&(this._visible=t,this._onDidChangeVisibility.fire(Object.freeze({visible:this._visible})))}async setCheckboxState(t){const i=(await Promise.all(t.map(async r=>{const s=this.getExtensionElement(r.treeItemHandle);return s?{extensionItem:s,treeItem:await this.dataProvider.getTreeItem(s),newState:r.newState?as.Checked:as.Unchecked}:Promise.resolve(void 0)}))).filter(r=>r!==void 0);i.forEach(r=>{r.treeItem.checkboxState=r.newState?as.Checked:as.Unchecked}),this._onDidChangeCheckboxState.fire({items:i.map(r=>[r.extensionItem,r.newState])})}async handleDrag(t,i,r){const s=[];for(const n of t){const o=this.getExtensionElement(n);o&&s.push(o)}if(!(!this.dndController?.handleDrag||s.length===0))return await this.dndController.handleDrag(s,i,r),i}get hasHandleDrag(){return!!this.dndController?.handleDrag}async onDrop(t,i,r){const s=i?this.getExtensionElement(i):void 0;if(!(!s&&i||!this.dndController?.handleDrop))return ci(()=>this.dndController?.handleDrop?this.dndController.handleDrop(s,t,r):void 0)}get hasResolve(){return!!this.dataProvider.resolveTreeItem}async resolveTreeItem(t,i){if(!this.dataProvider.resolveTreeItem)return;const r=this.elements.get(t);if(r){const s=this.nodes.get(r);if(s){const n=await this.dataProvider.resolveTreeItem(s.extensionItem,r,i)??s.extensionItem;return this.validateTreeItem(n),s.item.tooltip=this.getTooltip(n.tooltip),s.item.command=this.getCommand(s.disposableStore,n.command),s.item}}}resolveUnknownParentChain(t){return this.resolveParent(t).then(i=>i?this.resolveUnknownParentChain(i).then(r=>this.resolveTreeNode(i,r[r.length-1]).then(s=>(r.push(s),r))):Promise.resolve([]))}resolveParent(t){const i=this.nodes.get(t);return i?Promise.resolve(i.parent?this.elements.get(i.parent.item.handle):void 0):ci(()=>this.dataProvider.getParent(t))}resolveTreeNode(t,i){const r=this.nodes.get(t);return r?Promise.resolve(r):ci(()=>this.dataProvider.getTreeItem(t)).then(s=>this.createHandle(t,s,i,!0)).then(s=>this.getChildren(i?i.item.handle:void 0).then(()=>{const n=this.getExtensionElement(s);if(n){const o=this.nodes.get(n);if(o)return Promise.resolve(o)}throw new Error(`Cannot resolve tree item for element ${s} from extension ${this.extension.identifier.value}`)}))}getChildrenNodes(t){if(t){let i;if(typeof t=="string"){const r=this.getExtensionElement(t);i=r?this.nodes.get(r):void 0}else i=t;return i&&i.children||void 0}return this.roots}async fetchChildrenNodes(t){this.clearChildren(t);const i=new rt(this._refreshCancellationSource.token);try{const r=t?this.nodes.get(t):void 0,s=await this.dataProvider.getChildren(t);if(i.token.isCancellationRequested)return;const n=Et(s||[]),o=await Promise.all(Et(n).map(l=>this.dataProvider.getTreeItem(l)));if(i.token.isCancellationRequested)return;const a=o.map((l,c)=>l?this.createAndRegisterTreeNode(n[c],l,r):null);return Et(a)}finally{i.dispose()}}refresh(t){if(t.some(r=>!r))return this._refreshCancellationSource.dispose(!0),this._refreshCancellationSource=new rt,this.clearAll(),this.proxy.$refresh(this.viewId);{const r=this.getHandlesToRefresh(t);if(r.length)return this.refreshHandles(r)}return Promise.resolve(void 0)}getHandlesToRefresh(t){const i=new Set,r=t.map(n=>this.nodes.get(n));for(const n of r)if(n&&!i.has(n.item.handle)){let o=n;for(;o&&o.parent&&r.findIndex(a=>o&&o.parent&&a&&a.item.handle===o.parent.item.handle)===-1;){const a=this.elements.get(o.parent.item.handle);o=a?this.nodes.get(a):void 0}o&&!o.parent&&i.add(n.item.handle)}const s=[];return i.forEach(n=>{const o=this.elements.get(n);if(o){const a=this.nodes.get(o);a&&(!a.parent||!i.has(a.parent.item.handle))&&s.push(n)}}),s}refreshHandles(t){const i={};return Promise.all(t.map(r=>this.refreshNode(r).then(s=>{s&&(i[r]=s.item)}))).then(()=>Object.keys(i).length?this.proxy.$refresh(this.viewId,i):void 0)}refreshNode(t){const i=this.getExtensionElement(t);if(i){const r=this.nodes.get(i);if(r)return this.clearChildren(i),ci(()=>this.dataProvider.getTreeItem(i)).then(s=>{if(s){const n=this.createTreeNode(i,s,r.parent);return this.updateNodeCache(i,n,r,r.parent),r.dispose(),n}return null})}return Promise.resolve(null)}createAndRegisterTreeNode(t,i,r){const s=this.createTreeNode(t,i,r);if(i.id&&this.elements.has(s.item.handle))throw new Error(h(2939,null,i.id));return this.addNodeToCache(t,s),this.addNodeToParentCache(s,r),s}getTooltip(t){return Ti.isMarkdownString(t)?ve.from(t):t}getCommand(t,i){return i?{...this.commands.toInternal(i,t),originalId:i.command}:void 0}getCheckbox(t){if(t.checkboxState===void 0)return;let i,r,s;return typeof t.checkboxState=="number"?i=t.checkboxState:(i=t.checkboxState.state,r=t.checkboxState.tooltip,s=t.checkboxState.accessibilityInformation),{isChecked:i===as.Checked,tooltip:r,accessibilityInformation:s}}validateTreeItem(t){if(!ep.isTreeItem(t,this.extension))throw new Error(`Extension ${this.extension.identifier.value} has provided an invalid tree item.`)}createTreeNode(t,i,r){this.validateTreeItem(i);const s=this._register(new oe),n=this.createHandle(t,i,r),o=this.getLightIconPath(i);return{item:{handle:n,parentHandle:r?r.item.handle:void 0,label:T7(i.label,this.extension),description:i.description,resourceUri:i.resourceUri,tooltip:this.getTooltip(i.tooltip),command:this.getCommand(s,i.command),contextValue:i.contextValue,icon:o,iconDark:this.getDarkIconPath(i)||o,themeIcon:this.getThemeIcon(i),collapsibleState:Lt(i.collapsibleState)?$o.None:i.collapsibleState,accessibilityInformation:i.accessibilityInformation,checkbox:this.getCheckbox(i)},extensionItem:i,parent:r,children:void 0,disposableStore:s,dispose(){s.dispose()}}}getThemeIcon(t){return t.iconPath instanceof pi?t.iconPath:void 0}createHandle(t,{id:i,label:r,resourceUri:s},n,o){if(i)return`${zS.ID_HANDLE_PREFIX}/${i}`;const a=T7(r,this.extension),l=n?n.item.handle:zS.LABEL_HANDLE_PREFIX;let c=a?a.label:s?ir(s):"";c=c.indexOf("/")!==-1?c.replace("/","//"):c;const u=this.nodes.has(t)?this.nodes.get(t).item.handle:void 0,d=this.getChildrenNodes(n)||[];let f,p=0;do{if(f=`${l}/${p}:${c}`,o||!this.elements.has(f)||u===f)break;p++}while(p<=d.length);return f}getLightIconPath(t){if(t.iconPath&&!(t.iconPath instanceof pi))return typeof t.iconPath=="string"||b.isUri(t.iconPath)?this.getIconPath(t.iconPath):this.getIconPath(t.iconPath.light)}getDarkIconPath(t){if(t.iconPath&&!(t.iconPath instanceof pi)&&t.iconPath.dark)return this.getIconPath(t.iconPath.dark)}getIconPath(t){return b.isUri(t)?t:b.file(t)}addNodeToCache(t,i){this.elements.set(i.item.handle,t),this.nodes.set(t,i)}updateNodeCache(t,i,r,s){this.elements.delete(i.item.handle),this.nodes.delete(t),i.item.handle!==r.item.handle&&this.elements.delete(r.item.handle),this.addNodeToCache(t,i);const n=this.getChildrenNodes(s)||[],o=n.filter(a=>a.item.handle===r.item.handle)[0];o&&n.splice(n.indexOf(o),1,i)}addNodeToParentCache(t,i){i?(i.children||(i.children=[]),i.children.push(t)):(this.roots||(this.roots=[]),this.roots.push(t))}clearChildren(t){if(t){const i=this.nodes.get(t);if(i){if(i.children)for(const r of i.children){const s=this.elements.get(r.item.handle);s&&this.clear(s)}i.children=void 0}}else this.clearAll()}clear(t){const i=this.nodes.get(t);if(i){if(i.children)for(const r of i.children){const s=this.elements.get(r.item.handle);s&&this.clear(s)}this.nodes.delete(t),this.elements.delete(i.item.handle),i.dispose()}}clearAll(){this.roots=void 0,this.elements.clear(),this.nodes.forEach(t=>t.dispose()),this.nodes.clear()}dispose(){super.dispose(),this._refreshCancellationSource.dispose(),this.clearAll(),this.proxy.$disposeTree(this.viewId)}},wG=class K8{static{this.supportedSchemes=new Set([V.http,V.https])}constructor(t){this._openers=new Map,this._proxy=t.getProxy(Q.MainThreadUriOpeners)}registerExternalUriOpener(t,i,r,s){if(this._openers.has(i))throw new Error(`Opener with id '${i}' already registered`);const n=s.schemes.find(o=>!K8.supportedSchemes.has(o));if(n)throw new Error(`Scheme '${n}' is not supported. Only http and https are currently supported.`);return this._openers.set(i,r),this._proxy.$registerUriOpener(i,s.schemes,t,s.label),ie(()=>{this._openers.delete(i),this._proxy.$unregisterUriOpener(i)})}async $canOpenUri(t,i,r){const s=this._openers.get(t);if(!s)throw new Error(`Unknown opener with id: ${t}`);const n=b.revive(i);return s.canOpenExternalUri(n,r)}async $openUri(t,i,r){const s=this._openers.get(t);if(!s)throw new Error(`Unknown opener id: '${t}'`);return s.openExternalUri(b.revive(i.resolvedUri),{sourceUri:b.revive(i.sourceUri)},r)}},yG=class X8{static{this.HandlePool=0}constructor(t){this.handles=new mo,this.handlers=new Map,this._proxy=t.getProxy(Q.MainThreadUrls)}registerUriHandler(t,i){const r=t.identifier;if(this.handles.has(r))throw new Error(`Protocol handler already registered for extension ${r}`);const s=X8.HandlePool++;return this.handles.add(r),this.handlers.set(s,i),this._proxy.$registerUriHandler(s,r,t.displayName||t.name),ie(()=>{this.handles.delete(r),this.handlers.delete(s),this._proxy.$unregisterUriHandler(s)})}$handleExternalUri(t,i){const r=this.handlers.get(t);if(!r)return Promise.resolve(void 0);try{r.handleUri(b.revive(i))}catch(s){pt(s)}return Promise.resolve(void 0)}async createAppUri(t){return b.revive(await this._proxy.$createAppUri(t))}},bG=class extends X{#e;#t;#i;#r;#n;#s;#a;#o;#l;#c;#u;#h;#d;constructor(e,t,i,r){super(),this.#o=void 0,this.#l=!0,this.#u=!1,this.#h=this._register(new D),this.onDidDispose=this.#h.event,this.#d=this._register(new D),this.onDidChangeViewState=this.#d.event,this.#e=e,this.#t=t,this.#r=i,this.#i=r.viewType,this.#n=r.panelOptions,this.#o=r.viewColumn,this.#s=r.title,this.#c=r.active}dispose(){this.#u||(this.#u=!0,this.#h.fire(),this.#t.$disposeWebview(this.#e),this.#r.dispose(),super.dispose())}get webview(){return this.assertNotDisposed(),this.#r}get viewType(){return this.assertNotDisposed(),this.#i}get title(){return this.assertNotDisposed(),this.#s}set title(e){this.assertNotDisposed(),this.#s!==e&&(this.#s=e,this.#t.$setTitle(this.#e,e))}get iconPath(){return this.assertNotDisposed(),this.#a}set iconPath(e){this.assertNotDisposed(),this.#a!==e&&(this.#a=e,this.#t.$setIconPath(this.#e,b.isUri(e)?{light:e,dark:e}:e))}get options(){return this.#n}get viewColumn(){if(this.assertNotDisposed(),!(typeof this.#o=="number"&&this.#o<0))return this.#o}get active(){return this.assertNotDisposed(),this.#c}get visible(){return this.assertNotDisposed(),this.#l}_updateViewState(e){this.#u||(this.active!==e.active||this.visible!==e.visible||this.viewColumn!==e.viewColumn)&&(this.#c=e.active,this.#l=e.visible,this.#o=e.viewColumn,this.#d.fire({webviewPanel:this}))}reveal(e,t){this.assertNotDisposed(),this.#t.$reveal(this.#e,{viewColumn:typeof e>"u"?void 0:jt.from(e),preserveFocus:!!t})}assertNotDisposed(){if(this.#u)throw new Error("Webview is disposed")}},SG=class Y8 extends X{static newHandle(){return mt()}constructor(t,i,r){super(),this.webviews=i,this.workspace=r,this._webviewPanels=new Map,this._serializers=new Map,this._proxy=t.getProxy(Q.MainThreadWebviewPanels)}dispose(){super.dispose(),this._webviewPanels.forEach(t=>t.dispose()),this._webviewPanels.clear()}createWebviewPanel(t,i,r,s,n={}){const o=typeof s=="object"?s.viewColumn:s,a={viewColumn:jt.from(o),preserveFocus:typeof s=="object"&&!!s.preserveFocus},l=jl(t),c=Y8.newHandle();this._proxy.$createWebviewPanel(um(t),c,i,{title:r,panelOptions:xG(n),webviewOptions:pA(t,this.workspace,n),serializeBuffersForPostMessage:l},a);const u=this.webviews.createNewWebview(c,n,t);return this.createNewWebviewPanel(c,i,r,o,n,u,!0)}$onDidChangeWebviewPanelViewStates(t){const i=Object.keys(t);i.sort((r,s)=>{const n=t[r],o=t[s];return n.active?1:o.active?-1:+n.visible-+o.visible});for(const r of i){const s=this.getWebviewPanel(r);if(!s)continue;const n=t[r];s._updateViewState({active:n.active,visible:n.visible,viewColumn:jt.to(n.position)})}}async $onDidDisposeWebviewPanel(t){this.getWebviewPanel(t)?.dispose(),this._webviewPanels.delete(t),this.webviews.deleteWebview(t)}registerWebviewPanelSerializer(t,i,r){if(this._serializers.has(i))throw new Error(`Serializer for '${i}' already registered`);return this._serializers.set(i,{serializer:r,extension:t}),this._proxy.$registerSerializer(i,{serializeBuffersForPostMessage:jl(t)}),new Ie(()=>{this._serializers.delete(i),this._proxy.$unregisterSerializer(i)})}async $deserializeWebviewPanel(t,i,r,s){const n=this._serializers.get(i);if(!n)throw new Error(`No serializer found for '${i}'`);const{serializer:o,extension:a}=n,l=this.webviews.createNewWebview(t,r.webviewOptions,a),c=this.createNewWebviewPanel(t,i,r.title,s,r.panelOptions,l,r.active);await o.deserializeWebviewPanel(c,r.state)}createNewWebviewPanel(t,i,r,s,n,o,a){const l=new bG(t,this._proxy,o,{viewType:i,title:r,viewColumn:s,panelOptions:n,active:a});return this._webviewPanels.set(t,l),l}getWebviewPanel(t){return this._webviewPanels.get(t)}};function xG(e){return{enableFindWidget:e.enableFindWidget,retainContextWhenHidden:e.retainContextWhenHidden}}var EG=class extends X{#e;#t;#i;#r;#n;#s;#a;#o;#l;constructor(e,t,i,r,s,n){super(),this.#n=!1,this.#c=this._register(new D),this.onDidChangeVisibility=this.#c.event,this.#u=this._register(new D),this.onDidDispose=this.#u.event,this.#i=i,this.#a=r,this.#e=e,this.#t=t,this.#r=s,this.#s=n}dispose(){this.#n||(this.#n=!0,this.#u.fire(),this.#r.dispose(),super.dispose())}#c;#u;get title(){return this.assertNotDisposed(),this.#a}set title(e){this.assertNotDisposed(),this.#a!==e&&(this.#a=e,this.#t.$setWebviewViewTitle(this.#e,e))}get description(){return this.assertNotDisposed(),this.#o}set description(e){this.assertNotDisposed(),this.#o!==e&&(this.#o=e,this.#t.$setWebviewViewDescription(this.#e,e))}get visible(){return this.#s}get webview(){return this.#r}get viewType(){return this.#i}_setVisible(e){e===this.#s||this.#n||(this.#s=e,this.#c.fire())}get badge(){return this.assertNotDisposed(),this.#l}set badge(e){this.assertNotDisposed(),!(e?.value===this.#l?.value&&e?.tooltip===this.#l?.tooltip)&&(this.#l=Yp.from(e),this.#t.$setWebviewViewBadge(this.#e,e))}show(e){this.assertNotDisposed(),this.#t.$show(this.#e,!!e)}assertNotDisposed(){if(this.#n)throw new Error("Webview is disposed")}},CG=class{constructor(e,t){this._extHostWebview=t,this._viewProviders=new Map,this._webviewViews=new Map,this._proxy=e.getProxy(Q.MainThreadWebviewViews)}registerWebviewViewProvider(e,t,i,r){if(this._viewProviders.has(t))throw new Error(`View provider for '${t}' already registered`);return this._viewProviders.set(t,{provider:i,extension:e}),this._proxy.$registerWebviewViewProvider(um(e),t,{retainContextWhenHidden:r?.retainContextWhenHidden,serializeBuffersForPostMessage:jl(e)}),new Ie(()=>{this._viewProviders.delete(t),this._proxy.$unregisterWebviewViewProvider(t)})}async $resolveWebviewView(e,t,i,r,s){const n=this._viewProviders.get(t);if(!n)throw new Error(`No view provider found for '${t}'`);const{provider:o,extension:a}=n,l=this._extHostWebview.createNewWebview(e,{},a),c=new EG(e,this._proxy,t,i,l,!0);this._webviewViews.set(e,c),await o.resolveWebviewView(c,{state:r},s)}async $onDidChangeWebviewViewVisibility(e,t){this.getWebviewView(e)._setVisible(t)}async $disposeWebviewView(e){const t=this.getWebviewView(e);this._webviewViews.delete(e),t.dispose(),this._extHostWebview.deleteWebview(e)}getWebviewView(e){const t=this._webviewViews.get(e);if(!t)throw new Error("No webview found");return t}},DG=class{constructor(e){this._settingsSearchProviders=new Map,this._nextHandle=0,this._proxy=e.getProxy(Q.MainThreadAiSettingsSearch)}async $startSearch(e,t,i,r){if(this._settingsSearchProviders.size===0)throw new Error("No related information providers registered");const s=this._settingsSearchProviders.get(e);if(!s)throw new Error("Settings search provider not found");const n=new Rg(o=>{this._proxy.$handleSearchResult(e,mw.fromSettingsSearchResult(o))});return s.provideSettingsSearchResults(t,i,n,r)}registerSettingsSearchProvider(e,t){const i=this._nextHandle;return this._nextHandle++,this._settingsSearchProviders.set(i,t),this._proxy.$registerAiSettingsSearchProvider(i),new Ie(()=>{this._proxy.$unregisterAiSettingsSearchProvider(i),this._settingsSearchProviders.delete(i)})}},kG=class{constructor(e,t,i,r,s,n){this.widget=e,this.onDidChangeRenderMode=t,this.onDidEnd=i,this.onWillChangeDiffs=r,this.onDidChangeDiffs=s,this.onDidChangeFocusIndex=n}dispose(){this.onDidChangeRenderMode.dispose(),this.onDidEnd.dispose()}},IG=class{constructor(e,t){this._proxy=e,this._editors=t,this._handlePool=0,this._contextMap=new Map}addInlineDiffWidget(e,t){let i;for(const u of this._editors.getVisibleTextEditors(!0))if(u.value===e){i=u;break}if(!i)throw new Error("not a visible editor");const r=this._nextHandle();this._proxy.$addInlineDiffWidget(r,i.id,i.value.document.uri,{oldRange:{startLineNumber:t.oldRange.startLineNumber,endLineNumberExclusive:t.oldRange.endLineNumberExclusive},done:t.done??!0,text:t.text,partial:t.partial});const s=new D,n=new D,o=new D,a=new D,l=new D,c={updateText:this.updateText.bind(this,r),accept:this.accept.bind(this,r),reject:this.reject.bind(this,r),cancel:this.cancel.bind(this,r),focusOnDiff:this.focusOnDiff.bind(this,r),toggleRenderMode:this.toggleRenderMode.bind(this,r),onDidChangeRenderMode:n.event,onDidEnd:s.event,onDidChangeDiffs:a.event,onWillChangeDiffs:o.event,onDidChangeFocus:l.event,dispose:()=>{this._contextMap.has(r)&&(this._proxy.$removeInlineDiffWidget(r),this._contextMap.delete(r))}};return this._contextMap.set(r,new kG(c,n,s,o,a,l)),c}$onDidChangeRenderMode(e,t){const i=this._contextMap.get(e);i&&i.onDidChangeRenderMode.fire({renderSideBySide:t})}$onDidEnd(e){const t=this._contextMap.get(e);t&&(t.onDidEnd.fire(),t.dispose())}$onDidDispose(e){this._contextMap.has(e)&&this._contextMap.get(e)?.dispose()}$onDidChangeDiffs(e,t){this._contextMap.has(e)&&this._contextMap.get(e)?.onDidChangeDiffs.fire(t)}$onWillChangeDiffs(e,t){this._contextMap.has(e)&&this._contextMap.get(e)?.onWillChangeDiffs.fire({action:t.action,changes:t.changes,all:t.all,source:t.source})}$onDidChangeFocus(e,t,i){this._contextMap.has(e)&&this._contextMap.get(e)?.onDidChangeFocusIndex.fire({index:t,focus:i})}async updateText(e,t,i){return this._proxy.$updateModifiedText(e,t,i)}async accept(e){return this._proxy.$acceptDiff(e)}async reject(e){return this._proxy.$rejectDiff(e)}async cancel(e,t){return this._proxy.$cancel(e,t)}async toggleRenderMode(e,t){return this._proxy.$toggleRenderMode(e,t)}focusOnDiff(e,t){return this._proxy.$focusOnDiff(e,t)}_nextHandle(){return this._handlePool=this._handlePool+1,this._handlePool}},PG=class{constructor(e,t){this._proxy=e,this._editors=t,this._handlePool=0,this._disposables=new oe,this._widgets=new Map}dispose(){this._widgets.forEach(e=>e.widget.dispose()),this._disposables.dispose()}addOverlayWidget(e,t,i){let r;for(const l of this._editors.getVisibleTextEditors(!0))if(l.value===e){r=l;break}if(!r)throw new Error("not a visible editor");const s=this,n=this._handlePool++,o=new D,a=new class{constructor(){this.editor=e,this.onDidDispose=o.event}updateContent(l){s._proxy.$updateContent(n,s.convertContentToDto(l))}dispose(){s._widgets.has(n)&&(s._widgets.delete(n),s._proxy.$removeOverlayWidget(n),o.fire(),o.dispose())}};return this._proxy.$addOverlayWidget(n,r.id,r.value.document.uri,s.convertContentToDto(t||[]),i.identifier,i.extensionLocation),this._widgets.set(n,{editor:e,widget:a}),a}convertContentToDto(e){return e.map(t=>Ti.isMarkdownString(t)?ve.from(t):t)}$onDidDispose(e){const t=this._widgets.get(e);t&&t.widget.dispose()}},TG=class{constructor(e,t,i,r){this.engines=e,this.onRequest=t,this.onStopRequest=i,this.onDidDispose=r}dispose(){this.onDidDispose?.()}},AG=class{constructor(e,t){this._proxy=e,this._editors=t,this._handlePool=0,this._contextMap=new Map}showInlineChatWidget(e,t,i,r){let s;for(const a of this._editors.getVisibleTextEditors(!0))if(a.value===e){s=a;break}if(!s)throw new Error("not a visible editor");const n=this._nextHandle(),o=new D;return this._contextMap.set(n,new TG(t.engines,i,r||(()=>{}),()=>{this._contextMap.has(n)&&this._contextMap.delete(n),this._proxy.$hideInlineChatWidget(n),o.fire(),o.dispose()})),this._proxy.$showInlineChatWidget(n,{engines:t.engines,defaultEngine:t.defaultEngine,lineNumber:t.lineNumber,column:t.column},s.id,s.value.document.uri),{setCurrentEngine:a=>{this._proxy.$setEngine(n,a)},onDidDispose:o.event,dispose:()=>{this._contextMap.has(n)&&this._contextMap.get(n)?.dispose()}}}async $onDidRequest(e,t,i,r){const s=this._contextMap.get(e);if(s){await Promise.resolve(s.onRequest(t,i));return}throw new Error("cannot find handler")}$onDidStopRequest(e){const t=this._contextMap.get(e);if(t){t.onStopRequest();return}}$onDidDispose(e){this._contextMap.has(e)&&this._contextMap.get(e)?.dispose()}_nextHandle(){return this._handlePool=this._handlePool+1,this._handlePool}},RG=class{constructor(e){this._proxy=e,this._handlePool=0,this.providers=new Map}registerTerminalCommandChatProvider(e){const t=this.nextHandle(),i={provider:e,dispose:()=>{this._proxy.$unregisterTerminalCommandChatProvider(t),this.providers.delete(t)}};return this.providers.set(t,i),this._proxy.$registerTerminalCommandChatProvider(t,e.engines,e.defaultEngine),i}$provideCommand(e,t,i,r,s){const n=this.providers.get(e);return n?Promise.resolve(n.provider.provideCommand(t,i,{cwd:r.cwd,historys:r.historys,cursor:{line:r.cursor.lineNumber-1,charactor:r.cursor.column-1}},s)).then(o=>o??void 0):Promise.resolve(void 0)}nextHandle(){return++this._handlePool}},A7=class{constructor(e){this._provider=e,this._actionMap=new Map}async provideActions(e,t){return await this._provider.provideActions(e,t)||[]}releaseHover(e){this._actionMap.delete(e.toString())}},LG=class{constructor(e,t){this.adapter=e,this.extension=t}},NG=class{constructor(e,t,i){this._proxy=e,this._editors=t,this._extensionTelemetry=i,this._adapter=new Map,this._providers=new Map,this.handlePool=0}dispose(){this._providers.forEach((e,t)=>{this._proxy.$unregisterSelectionActionProvider(t)}),this._providers.clear()}registerSelectionActionProvider(e,t){const i=this._addNewAdapter(new A7(e),t);return this._proxy.$registerSelectionActionProvider(i),new Ie(()=>{this._adapter.delete(i),this._proxy.$unregisterSelectionActionProvider(i)})}_nextHandle(){return++this.handlePool}_addNewAdapter(e,t){const i=this._nextHandle();return this._adapter.set(i,new LG(e,t)),i}async _withAdapter(e,t,i,r,s){const n=this._adapter.get(e);if(!n||!(n.adapter instanceof t))return r;const o=i(n.adapter,n.extension);return Promise.resolve(o).catch(a=>{Yi(a)||this._extensionTelemetry.onExtensionError(n.extension.identifier,a)}),Be.isCancellationToken(s)?wh(o,s):o}$provideActions(e,t,i){let r=null;for(const s of this._editors.getVisibleTextEditors(!0))if(lo(s.value.document.uri,b.revive(t))){r=s;break}return r?this._withAdapter(e,A7,s=>s.provideActions(r.value,i),[],i):Promise.resolve([])}$releaseActions(e,t){}},Vb=class{constructor(e){this._provider=e,this._actionMap=new Map}async provideActions(e,t){return await this._provider.provideActions(e,t)||[]}releaseActions(e){this._actionMap.delete(e)}},MG=class{constructor(e,t){this.adapter=e,this.extension=t}},OG=class{constructor(e,t){this._proxy=e,this._extHostTelemetry=t,this._adapter=new Map,this._providers=new Map,this.handlePool=0}dispose(){this._providers.forEach((e,t)=>{this._proxy.$unregisterTerminalSelectionActionProvider(t)}),this._providers.clear()}registerTerminalSelectionActionProvider(e,t){const i=this._addNewAdapter(new Vb(e),t);return this._proxy.$registerTerminalSelectionActionProvider(i),new Ie(()=>{this._adapter.delete(i),this._proxy.$unregisterTerminalSelectionActionProvider(i)})}_nextHandle(){return++this.handlePool}_addNewAdapter(e,t){const i=this._nextHandle();return this._adapter.set(i,new MG(e,t)),i}async _withAdapter(e,t,i,r,s){const n=this._adapter.get(e);if(!n||!(n.adapter instanceof t))return r;const o=i(n.adapter,n.extension);return Promise.resolve(o).catch(a=>{Yi(a)||this._extHostTelemetry.onExtensionError(n.extension.identifier,a)}),Be.isCancellationToken(s)?wh(o,s):o}$provideTerminalActions(e,t,i){return this._withAdapter(e,Vb,async r=>{const s={id:t};return(await r.provideActions(s,i)).map(o=>({id:o.id,label:o.label,icon:o.icon,keybinding:o.keybinding,commandId:o.commandId,commandArgs:o.commandArgs}))},[],i)}$releaseTerminalActions(e,t){const i=this._adapter.get(e);i?.adapter instanceof Vb&&i.adapter.releaseActions(String(t))}},FG=class{constructor(e){this._onDidAddOrDeleteDiffZones=new D,this.onDidAddOrDeleteDiffZones=this._onDidAddOrDeleteDiffZones.event,this._onDidChangeDiffsInDiffZoneNotStreaming=new D,this.onDidChangeDiffsInDiffZoneNotStreaming=this._onDidChangeDiffsInDiffZoneNotStreaming.event,this._onDidChangeStreamingInDiffZone=new D,this.onDidChangeStreamingInDiffZone=this._onDidChangeStreamingInDiffZone.event,this._onDidChangeCommandBarState=new D,this.onDidChangeCommandBarState=this._onDidChangeCommandBarState.event,this._onDidChangeActiveURI=new D,this.onDidChangeActiveURI=this._onDidChangeActiveURI.event,this._onDidAcceptOrRejectFile=new D,this.onDidAcceptOrRejectFile=this._onDidAcceptOrRejectFile.event,this._proxy=e.getProxy(Q.MainThreadEditCode)}$onDidAddOrDeleteDiffZones(e){this._onDidAddOrDeleteDiffZones.fire({uri:b.revive(e)})}$onDidChangeDiffsInDiffZoneNotStreaming(e,t){this._onDidChangeDiffsInDiffZoneNotStreaming.fire({uri:b.revive(e),diffareaid:t})}$onDidChangeStreamingInDiffZone(e,t){this._onDidChangeStreamingInDiffZone.fire({uri:b.revive(e),diffareaid:t})}$onDidChangeCommandBarState(e){this._onDidChangeCommandBarState.fire({uri:b.revive(e)})}$onDidChangeActiveURI(e){this._onDidChangeActiveURI.fire({uri:e?b.revive(e):null})}$onDidAcceptOrRejectFile(e,t,i,r,s){this._onDidAcceptOrRejectFile.fire({uri:b.revive(e),behavior:t,diffid:i,isUserTriggered:r,diffData:s})}async processRawKeybindingText(e){return this._proxy.$processRawKeybindingText(e)}async callBeforeApplyOrEdit(e){e==="current"?await this._proxy.$callBeforeApplyOrEdit({scheme:"current"}):await this._proxy.$callBeforeApplyOrEdit(e.toJSON())}instantlyApplySearchReplaceBlocks(e){this._proxy.$instantlyApplySearchReplaceBlocks(e.uri.toJSON(),e.searchReplaceBlocks)}instantlyRewriteFile(e){this._proxy.$instantlyRewriteFile(e.uri.toJSON(),e.newContent)}instantlyRewriteFileRange(e){this._proxy.$instantlyRewriteFileRange(e.uri.toJSON(),e.newContent,e.range)}async acceptOrRejectAllDiffAreas(e){await this._proxy.$acceptOrRejectAllDiffAreas({uri:e.uri.toJSON(),removeCtrlKs:e.removeCtrlKs,behavior:e.behavior,_addToHistory:e._addToHistory,isUserTriggered:e.isUserTriggered})}async acceptDiff(e){await this._proxy.$acceptDiff(e)}async rejectDiff(e){await this._proxy.$rejectDiff(e)}async getGenieFileSnapshot(e){return this._proxy.$getGenieFileSnapshot(e.toJSON())}async restoreGenieFileSnapshot(e,t){await this._proxy.$restoreGenieFileSnapshot(e.toJSON(),{snapshotedDiffAreaOfId:t.snapshotedDiffAreaOfId,entireFileCode:t.entireFileCode})}async getCommandBarService(){const e=await this._proxy.$getCommandBarService(),t={};for(const[i,r]of Object.entries(e.stateOfURI))t[i]={sortedDiffZoneIds:r.sortedDiffZoneIds,sortedDiffIds:r.sortedDiffIds,isStreaming:r.isStreaming,diffIdx:r.diffIdx};return{stateOfURI:t,sortedURIs:e.sortedURIs.map(i=>b.revive(i)),activeURI:e.activeURI?b.revive(e.activeURI):null,onDidChangeState:this.onDidChangeCommandBarState,onDidChangeActiveURI:this.onDidChangeActiveURI,onDidAcceptOrRejectFile:this.onDidAcceptOrRejectFile}}async getDiffOfId(){return this._proxy.$getDiffOfId()}async getDiffAreaOfId(){return this._proxy.$getDiffAreaOfId()}async getDiffAreasOfURI(){return this._proxy.$getDiffAreasOfURI()}async openCurrentDiffsInMultiEditor(){return this._proxy.$openCurrentDiffsInMultiEditor()}};function $G(e){const t=e.get(zt),i=e.get(Ma),r=e.get(td),s=e.get(Xs),n=e.get(Br),o=e.get(Tg),a=e.get(vr),l=e.get(Nc),c=e.get(Pe),u=e.get($w),d=e.get(Uw),f=e.get(La),p=e.get(ke),g=e.get(Ig),v=e.get(cd),y=e.get(l6),S=e.get(ay),x=e.get(Bl),P=e.get(uy),$=e.get(Kw),A=e.get(Yw),W=e.get(Xg);c.set(re.ExtHostFileSystemInfo,i),c.set(re.ExtHostLogLevelServiceShape,f),c.set(re.ExtHostWorkspace,n),c.set(re.ExtHostConfiguration,a),c.set(re.ExtHostExtensionService,s),c.set(re.ExtHostStorage,u),c.set(re.ExtHostTunnelService,g),c.set(re.ExtHostWindow,y),c.set(re.ExtHostSecretState,S),c.set(re.ExtHostTelemetry,o),c.set(re.ExtHostEditorTabs,x),c.set(re.ExtHostManagedSockets,P),c.set(re.ExtHostAuthentication,$),c.set(re.ExtHostChatProvider,A);const G=c.set(re.ExtHostDecorations,e.get(TT)),J=c.set(re.ExtHostDocumentsAndEditors,e.get(ia)),H=c.set(re.ExtHostCommands,e.get(Vr)),K=c.set(re.ExtHostTerminalService,e.get(Ks)),Ee=c.set(re.ExtHostTerminalShellIntegration,e.get(By)),ne=c.set(re.ExtHostDebugService,e.get(Oy)),ct=c.set(re.ExtHostSearch,e.get(Hy)),j=c.set(re.ExtHostTask,e.get(Ly)),B=c.set(re.ExtHostOutputService,e.get(PT)),te=c.set(re.ExtHostLocalization,e.get(cy)),Y=c.set(re.ExtHostUrls,new yG(c)),ee=c.set(re.ExtHostDocuments,new Iq(c,J)),_e=c.set(re.ExtHostDocumentContentProviders,new Dq(c,J,p)),Re=c.set(re.ExtHostDocumentSaveParticipant,new kq(p,ee,c.getProxy(Q.MainThreadBulkEdits))),be=c.set(re.ExtHostNotebook,new Rj(c,H,J,ee,r,ct,p)),et=c.set(re.ExtHostNotebookDocuments,new Nj(be)),Zt=c.set(re.ExtHostNotebookEditors,new Nb(p,be)),xt=c.set(re.ExtHostNotebookKernels,new Mb(c,t,be,H,p)),si=c.set(re.ExtHostNotebookRenderers,new Uj(c,be)),gi=c.set(re.ExtHostNotebookDocumentSaveParticipant,new Lj(p,be,c.getProxy(Q.MainThreadBulkEdits))),tt=c.set(re.ExtHostEditors,new oG(c,J)),ws=c.set(re.ExtHostTreeViews,new vG(c.getProxy(Q.MainThreadTreeViews),H,p)),ga=c.set(re.ExtHostEditorInsets,new sq(c.getProxy(Q.MainThreadEditorInsets),tt,t.remote)),un=c.set(re.ExtHostDiagnostics,new cb(c,p,i,J)),ar=c.set(re.ExtHostLanguages,new cj(c,ee,H.converter,l)),Ce=c.set(re.ExtHostLanguageFeatures,new Kq(c,l,ee,H,un,p,v,o)),Je=c.set(re.ExtHostCodeMapper,new nq(c)),Qd=c.set(re.ExtHostFileSystem,new Oq(c,Ce)),Oi=c.set(re.ExtHostFileSystemEventService,new jq(c,p,J)),bi=c.set(re.ExtHostQuickOpen,qj(c,n,H)),Xn=c.set(re.ExtHostSCM,new Wb(c,H,ee,p)),ma=c.set(re.ExtHostQuickDiff,new zj(c,l)),nc=c.set(re.ExtHostShare,new tG(c,l)),Jd=c.set(re.ExtHostComments,oq(c,H,ee)),va=c.set(re.ExtHostProgress,new Bj(c.getProxy(Q.MainThreadProgress))),oc=c.set(re.ExtHostLabelService,new Qq(c)),Yn=c.set(re.ExtHostTheming,new Bb(c)),Fi=c.set(re.ExtHostTimeline,new aG(c,H)),ys=c.set(re.ExtHostWebviews,new gq(c,t.remote,n,p,v)),yt=c.set(re.ExtHostWebviewPanels,new SG(c,ys,n)),hi=c.set(re.ExtHostCustomEditors,new bq(c,ee,d,ys,yt)),sv=c.set(re.ExtHostWebviewViews,new CG(c,ys)),dn=c.set(re.ExtHostTesting,e.get(gd)),_a=c.set(re.ExtHostUriOpeners,new wG(c)),ac=c.set(re.ExtHostProfileContentHandlers,new Wj(c));c.set(re.ExtHostInteractive,new Gq(c,be,J,H,p));const k=c.set(re.ExtHostLanguageModelTools,new lj(c,A)),N=c.set(re.ExtHostChatAgents2,new Kz(c,p,H,ee,A,un,k)),O=c.set(re.ExtHostAiRelatedInformation,new Bz(c)),he=c.set(re.ExtHostAiEmbeddingVector,new Tq(c)),we=c.set(re.ExtHostAiSettingsSearch,new DG(c)),Bt=c.set(re.ExtHostStatusBar,new nG(c,H.converter)),Ke=c.set(re.ExtHostSpeech,new iG(c)),Jt=c.set(re.ExtHostEmbeddings,new Pq(c)),At=c.set(re.ExtHostInlineDiff,new IG(c.getProxy(Q.MainThreadInlineDiff),tt)),ni=c.set(re.ExtHostEditorBottomWidget,new PG(c.getProxy(Q.MainThreadEditorBottomWidget),tt)),lr=c.set(re.ExtHostInlineChat,new AG(c.getProxy(Q.MainThreadInlineChat),tt)),Rt=c.set(re.ExtHostTerminalCommandChat,new RG(c.getProxy(Q.MainThreadTerminalCommandChat))),ei=c.set(re.ExtHostSelectionAction,new NG(c.getProxy(Q.MainThreadSelectionAction),tt,o)),mi=c.set(re.ExtHostTerminalSelectionAction,new OG(c.getProxy(Q.MainThreadTerminalSelectionAction),o));c.set(re.ExtHostMcp,e.get(Xg));const Le=c.set(re.ExtHostEditCode,new FG(c)),xe=Object.values(re);c.assertRegistered(xe);const Me=new ab(c,J),ft=new tq(c),gt=new Sb(c,p),Kt=new Cq(c),Kd=new Zz(c);return Gz.register(H),function(C,$i,nv){function se(_){return(w,E,pe)=>{const ut=_(ti=>{try{w.call(E,ti)}catch(vR){XS(new KC(C.identifier,vR,"FAILED to handle event"))}});return pe?.push(ut),ut}}const it=function(){let _=!C.isUnderDevelopment;function w(){_||(p.info(`Extension '${C.identifier.value}' uses a document selector without scheme. Learn more about this: https://go.microsoft.com/fwlink/?linkid=872305`),_=!0)}return function E(pe){if(Array.isArray(pe))pe.forEach(E);else if(typeof pe=="string")w();else{const ut=pe;typeof ut.scheme>"u"&&w(),typeof ut.exclusive=="boolean"&&M(C,"documentFiltersExclusive")}return pe}}(),eR={getSession(_,w,E){return(typeof E?.forceNewSession=="object"&&E.forceNewSession.learnMore||typeof E?.createIfNone=="object"&&E.createIfNone.learnMore)&&M(C,"authLearnMore"),$.getSession(C,_,w,E)},getAccounts(_){return $.getAccounts(_)},async hasSession(_,w){return M(C,"authSession"),!!await $.getSession(C,_,w,{silent:!0})},get onDidChangeSessions(){return se($.getExtensionScopedSessionsEvent(C.identifier.value))},registerAuthenticationProvider(_,w,E,pe){return $.registerAuthenticationProvider(_,w,E,pe)}},tR={registerCommand(_,w,E){return H.registerCommand(!0,_,w,E,void 0,C)},registerTextEditorCommand(_,w,E){return H.registerCommand(!0,_,(...pe)=>{const ut=tt.getActiveTextEditor();if(!ut){p.warn("Cannot execute "+_+" because there is no active text editor.");return}return ut.edit(ti=>{w.apply(E,[ut,ti,...pe])}).then(ti=>{ti||p.warn("Edits from command "+_+" were not applied.")},ti=>{p.warn("An error occurred while running command "+_,ti)})},void 0,void 0,C)},registerDiffInformationCommand:(_,w,E)=>(M(C,"diffCommand"),H.registerCommand(!0,_,async(...pe)=>{const ut=J.activeEditor(!0);if(!ut){p.warn("Cannot execute "+_+" because there is no active text editor.");return}const ti=await tt.getDiffInformation(ut.id);w.apply(E,[ti,...pe])},void 0,void 0,C)),executeCommand(_,...w){return H.executeCommand(_,...w)},getCommands(_=!1){return H.getCommands(_)}},iR={processRawKeybindingText(_){return Le.processRawKeybindingText(_)},callBeforeApplyOrEdit(_){return Le.callBeforeApplyOrEdit(_)},instantlyApplySearchReplaceBlocks(_){Le.instantlyApplySearchReplaceBlocks(_)},instantlyRewriteFile(_){Le.instantlyRewriteFile(_)},instantlyRewriteFileRange(_){Le.instantlyRewriteFileRange(_)},get onDidChangeDiffZones(){const _=Fe.map(Le.onDidAddOrDeleteDiffZones,w=>w.uri);return se(_)},get onDidChangeDiffContent(){const _=Fe.map(Le.onDidChangeDiffsInDiffZoneNotStreaming,w=>({uri:w.uri,diffareaid:Number(w.diffareaid)}));return se(_)},get onDidChangeDiffProcessingMode(){const _=Fe.map(Le.onDidChangeStreamingInDiffZone,w=>({uri:w.uri,diffareaid:Number(w.diffareaid)}));return se(_)},async getCommandBarService(){return await Le.getCommandBarService()},get onDidChangeCommandBarState(){return se(Le.onDidChangeCommandBarState)},get onDidChangeActiveURI(){return se(Le.onDidChangeActiveURI)},get onDidAcceptOrRejectFile(){return se(Le.onDidAcceptOrRejectFile)},getEditCodeService(){const _=new D,w=new D;return Le.onDidChangeDiffsInDiffZoneNotStreaming(E=>{_.fire({uri:E.uri,diffareaid:Number(E.diffareaid)})}),Le.onDidChangeStreamingInDiffZone(E=>{w.fire({uri:E.uri,diffareaid:Number(E.diffareaid)})}),{onDidAddOrDeleteDiffZones:Le.onDidAddOrDeleteDiffZones,onDidChangeDiffsInDiffZoneNotStreaming:_.event,onDidChangeStreamingInDiffZone:w.event,processRawKeybindingText:E=>Le.processRawKeybindingText(E),callBeforeApplyOrEdit:E=>Le.callBeforeApplyOrEdit(E),instantlyApplySearchReplaceBlocks:async E=>{Le.instantlyApplySearchReplaceBlocks(E)},instantlyRewriteFile:async E=>{Le.instantlyRewriteFile(E)},instantlyRewriteFileRange:async E=>{Le.instantlyRewriteFileRange(E)},acceptOrRejectAllDiffAreas:E=>Le.acceptOrRejectAllDiffAreas(E),acceptDiff:E=>Le.acceptDiff(String(E)),rejectDiff:E=>Le.rejectDiff(String(E)),getGenieFileSnapshot:async E=>({content:(await Le.getGenieFileSnapshot(E)).entireFileCode,version:Date.now()}),restoreGenieFileSnapshot:async(E,pe)=>{await Le.restoreGenieFileSnapshot(E,{snapshotedDiffAreaOfId:{},entireFileCode:pe.content})},openCurrentDiffsInMultiEditor:()=>Le.openCurrentDiffsInMultiEditor(),diffOfId:{},diffAreaOfId:{},diffAreasOfURI:{},async refreshDiffData(){const E=this;E.diffOfId=await Le.getDiffOfId(),E.diffAreaOfId=await Le.getDiffAreaOfId(),E.diffAreasOfURI=await Le.getDiffAreasOfURI()}}}},qS={get machineId(){return t.telemetryInfo.machineId},get sessionId(){return t.telemetryInfo.sessionId},get language(){return t.environment.appLanguage},get appName(){return t.environment.appName},get appRoot(){return t.environment.appRoot?.fsPath??""},get appHost(){return t.environment.appHost},get uriScheme(){return t.environment.appUriScheme},get clipboard(){return ft.value},get shell(){return K.getDefaultShell(!1)},get onDidChangeShell(){return se(K.onDidChangeShell)},get isTelemetryEnabled(){return o.getTelemetryConfiguration()},get onDidChangeTelemetryEnabled(){return se(o.onDidChangeTelemetryEnabled)},get telemetryConfiguration(){return M(C,"telemetry"),o.getTelemetryDetails()},get onDidChangeTelemetryConfiguration(){return M(C,"telemetry"),se(o.onDidChangeTelemetryConfiguration)},get isNewAppInstall(){return W5(t.telemetryInfo.firstSessionDate)},createTelemetryLogger(_,w){return U5.validateSender(_),o.instantiateLogger(C,_,w)},openExternal(_,w){return y.openUri(_,{allowTunneling:!!t.remote.authority,allowContributedOpeners:w?.allowContributedOpeners})},async asExternalUri(_){if(_.scheme===t.environment.appUriScheme)return Y.createAppUri(_);try{return await y.asExternalUri(_,{allowTunneling:!!t.remote.authority})}catch(w){if(Nv(_,V.http)||Nv(_,V.https))return _;throw w}},get remoteName(){return r1(t.remote.authority)},get remoteAuthority(){return M(C,"resolvers"),t.remote.authority},get uiKind(){return t.uiKind},get logLevel(){return p.getLevel()},get onDidChangeLogLevel(){return se(p.onDidChangeLogLevel)},get appQuality(){return M(C,"resolvers"),t.quality},get appCommit(){return M(C,"resolvers"),t.commit}};t.environment.extensionTestsLocationURI||Object.freeze(qS);const rR={createTestController(_,w,E){return dn.createTestController(C,_,w,E)},createTestObserver(){return M(C,"testObserver"),dn.createTestObserver()},runTests(_){return M(C,"testObserver"),dn.runTests(_)},registerTestFollowupProvider(_){return M(C,"testObserver"),dn.registerTestFollowupProvider(_)},get onDidChangeTestResults(){return M(C,"testObserver"),se(dn.onResultsChanged)},get testResults(){return M(C,"testObserver"),dn.results}},Xd=t.remote.isRemote?Wo.Workspace:Wo.UI,sR={getExtension(_,w){nt(C,"extensionsAny")||(w=!1);const E=$i.mine.getExtensionDescription(_);if(E)return new od(s,C.identifier,E,Xd,!1);if(w){const pe=$i.all.getExtensionDescription(_);if(pe)return new od(s,C.identifier,pe,Xd,!0)}},get all(){const _=[];for(const w of $i.mine.getAllExtensionDescriptions())_.push(new od(s,C.identifier,w,Xd,!1));return _},get allAcrossExtensionHosts(){M(C,"extensionsAny");const _=new mo($i.mine.getAllExtensionDescriptions().map(E=>E.identifier)),w=[];for(const E of $i.all.getAllExtensionDescriptions()){const pe=!_.has(E.identifier);w.push(new od(s,C.identifier,E,Xd,pe))}return w},get onDidChange(){return nt(C,"extensionsAny")?se(Fe.any($i.mine.onDidChange,$i.all.onDidChange)):se($i.mine.onDidChange)}},nR={createDiagnosticCollection(_){return un.createDiagnosticCollection(C.identifier,_)},get onDidChangeDiagnostics(){return se(un.onDidChangeDiagnostics)},getDiagnostics:_=>un.getDiagnostics(_),getLanguages(){return ar.getLanguages()},setTextDocumentLanguage(_,w){return ar.changeLanguage(_.uri,w)},match(_,w){const E=J0.from(_);let pe;return K6(E)&&(pe=be.notebookDocuments.find(ut=>ut.apiNotebook.getCells().find(ti=>ti.document===w))?.apiNotebook),J6(E,w.uri,w.languageId,!0,pe?.uri,pe?.notebookType)},registerCodeActionsProvider(_,w,E){return Ce.registerCodeActionProvider(C,it(_),w,E)},registerDocumentPasteEditProvider(_,w,E){return Ce.registerDocumentPasteEditProvider(C,it(_),w,E)},registerCodeLensProvider(_,w){return Ce.registerCodeLensProvider(C,it(_),w)},registerDefinitionProvider(_,w){return Ce.registerDefinitionProvider(C,it(_),w)},registerDeclarationProvider(_,w){return Ce.registerDeclarationProvider(C,it(_),w)},registerImplementationProvider(_,w){return Ce.registerImplementationProvider(C,it(_),w)},registerTypeDefinitionProvider(_,w){return Ce.registerTypeDefinitionProvider(C,it(_),w)},registerHoverProvider(_,w){return Ce.registerHoverProvider(C,it(_),w,C.identifier)},registerEvaluatableExpressionProvider(_,w){return Ce.registerEvaluatableExpressionProvider(C,it(_),w,C.identifier)},registerInlineValuesProvider(_,w){return Ce.registerInlineValuesProvider(C,it(_),w,C.identifier)},registerDocumentHighlightProvider(_,w){return Ce.registerDocumentHighlightProvider(C,it(_),w)},registerMultiDocumentHighlightProvider(_,w){return Ce.registerMultiDocumentHighlightProvider(C,it(_),w)},registerLinkedEditingRangeProvider(_,w){return Ce.registerLinkedEditingRangeProvider(C,it(_),w)},registerReferenceProvider(_,w){return Ce.registerReferenceProvider(C,it(_),w)},registerRenameProvider(_,w){return Ce.registerRenameProvider(C,it(_),w)},registerNewSymbolNamesProvider(_,w){return M(C,"newSymbolNamesProvider"),Ce.registerNewSymbolNamesProvider(C,it(_),w)},registerDocumentSymbolProvider(_,w,E){return Ce.registerDocumentSymbolProvider(C,it(_),w,E)},registerWorkspaceSymbolProvider(_){return Ce.registerWorkspaceSymbolProvider(C,_)},registerDocumentFormattingEditProvider(_,w){return Ce.registerDocumentFormattingEditProvider(C,it(_),w)},registerDocumentRangeFormattingEditProvider(_,w){return Ce.registerDocumentRangeFormattingEditProvider(C,it(_),w)},registerOnTypeFormattingEditProvider(_,w,E,...pe){return Ce.registerOnTypeFormattingEditProvider(C,it(_),w,[E].concat(pe))},registerDocumentSemanticTokensProvider(_,w,E){return Ce.registerDocumentSemanticTokensProvider(C,it(_),w,E)},registerDocumentRangeSemanticTokensProvider(_,w,E){return Ce.registerDocumentRangeSemanticTokensProvider(C,it(_),w,E)},registerSignatureHelpProvider(_,w,E,...pe){return typeof E=="object"?Ce.registerSignatureHelpProvider(C,it(_),w,E):Ce.registerSignatureHelpProvider(C,it(_),w,typeof E>"u"?[]:[E,...pe])},registerCompletionItemProvider(_,w,...E){return Ce.registerCompletionItemProvider(C,it(_),w,E)},registerInlineCompletionItemProvider(_,w,E){return w.handleDidShowCompletionItem&&M(C,"inlineCompletionsAdditions"),w.handleDidPartiallyAcceptCompletionItem&&M(C,"inlineCompletionsAdditions"),E&&M(C,"inlineCompletionsAdditions"),Ce.registerInlineCompletionsProvider(C,it(_),w,E)},registerInlineEditProvider(_,w){return M(C,"inlineEdit"),Ce.registerInlineEditProvider(C,it(_),w)},registerDocumentLinkProvider(_,w){return Ce.registerDocumentLinkProvider(C,it(_),w)},registerColorProvider(_,w){return Ce.registerColorProvider(C,it(_),w)},registerFoldingRangeProvider(_,w){return Ce.registerFoldingRangeProvider(C,it(_),w)},registerSelectionRangeProvider(_,w){return Ce.registerSelectionRangeProvider(C,_,w)},registerCallHierarchyProvider(_,w){return Ce.registerCallHierarchyProvider(C,_,w)},registerTypeHierarchyProvider(_,w){return Ce.registerTypeHierarchyProvider(C,_,w)},setLanguageConfiguration:(_,w)=>Ce.setLanguageConfiguration(C,_,w),getTokenInformationAtPosition(_,w){return M(C,"tokenInformation"),ar.tokenAtPosition(_,w)},registerInlayHintsProvider(_,w){return Ce.registerInlayHintsProvider(C,_,w)},createLanguageStatusItem(_,w){return ar.createLanguageStatusItem(C,_,w)},registerDocumentDropEditProvider(_,w,E){return Ce.registerDocumentOnDropEditProvider(C,_,w,E)}},oR={get activeTextEditor(){return tt.getActiveTextEditor()},get visibleTextEditors(){return tt.getVisibleTextEditors()},get activeTerminal(){return K.activeTerminal},get terminals(){return K.terminals},async showTextDocument(_,w,E){b.isUri(_)&&_.scheme===V.vscodeRemote&&!_.authority&&v.report("workspace.showTextDocument",C,"A URI of 'vscode-remote' scheme requires an authority.");const pe=await(b.isUri(_)?Promise.resolve(jS.openTextDocument(_)):Promise.resolve(_));return tt.showTextDocument(pe,w,E)},createTextEditorDecorationType(_){return tt.createTextEditorDecorationType(C,_)},onDidChangeActiveTextEditor(_,w,E){return se(tt.onDidChangeActiveTextEditor)(_,w,E)},onDidChangeVisibleTextEditors(_,w,E){return se(tt.onDidChangeVisibleTextEditors)(_,w,E)},onDidChangeTextEditorSelection(_,w,E){return se(tt.onDidChangeTextEditorSelection)(_,w,E)},onDidChangeTextEditorOptions(_,w,E){return se(tt.onDidChangeTextEditorOptions)(_,w,E)},onDidChangeTextEditorVisibleRanges(_,w,E){return se(tt.onDidChangeTextEditorVisibleRanges)(_,w,E)},onDidChangeTextEditorViewColumn(_,w,E){return se(tt.onDidChangeTextEditorViewColumn)(_,w,E)},onDidChangeTextEditorDiffInformation(_,w,E){return M(C,"textEditorDiffInformation"),se(tt.onDidChangeTextEditorDiffInformation)(_,w,E)},onDidCloseTerminal(_,w,E){return se(K.onDidCloseTerminal)(_,w,E)},onDidOpenTerminal(_,w,E){return se(K.onDidOpenTerminal)(_,w,E)},onDidChangeActiveTerminal(_,w,E){return se(K.onDidChangeActiveTerminal)(_,w,E)},onDidChangeTerminalDimensions(_,w,E){return M(C,"terminalDimensions"),se(K.onDidChangeTerminalDimensions)(_,w,E)},onDidChangeTerminalState(_,w,E){return se(K.onDidChangeTerminalState)(_,w,E)},onDidWriteTerminalData(_,w,E){return M(C,"terminalDataWriteEvent"),se(K.onDidWriteTerminalData)(_,w,E)},onDidExecuteTerminalCommand(_,w,E){return M(C,"terminalExecuteCommandEvent"),se(K.onDidExecuteTerminalCommand)(_,w,E)},onDidChangeTerminalShellIntegration(_,w,E){return se(Ee.onDidChangeTerminalShellIntegration)(_,w,E)},onDidStartTerminalShellExecution(_,w,E){return se(Ee.onDidStartTerminalShellExecution)(_,w,E)},onDidEndTerminalShellExecution(_,w,E){return se(Ee.onDidEndTerminalShellExecution)(_,w,E)},get state(){return y.getState()},onDidChangeWindowState(_,w,E){return se(y.onDidChangeWindowState)(_,w,E)},showInformationMessage(_,...w){return gt.showMessage(C,Ft.Info,_,w[0],w.slice(1))},showWarningMessage(_,...w){return gt.showMessage(C,Ft.Warning,_,w[0],w.slice(1))},showErrorMessage(_,...w){return gt.showMessage(C,Ft.Error,_,w[0],w.slice(1))},showQuickPick(_,w,E){return bi.showQuickPick(C,_,w,E)},showWorkspaceFolderPick(_){return bi.showWorkspaceFolderPick(_)},showInputBox(_,w){return bi.showInput(_,w)},showOpenDialog(_){return Kt.showOpenDialog(_)},showSaveDialog(_){return Kt.showSaveDialog(_)},createStatusBarItem(_,w,E){let pe,ut,ti;return typeof _=="string"?(pe=_,ut=w,ti=E):(ut=_,ti=w),Bt.createStatusBarEntry(C,pe,ut,ti)},setStatusBarMessage(_,w){return Bt.setStatusBarMessage(_,w)},withScmProgress(_){return v.report("window.withScmProgress",C,"Use 'withProgress' instead."),va.withProgress(C,{location:Fo.SourceControl},(w,E)=>_({report(pe){}}))},withProgress(_,w){return va.withProgress(C,_,w)},createOutputChannel(_,w){return B.createOutputChannel(_,w,C)},createWebviewPanel(_,w,E,pe){return yt.createWebviewPanel(C,_,w,E,pe)},createWebviewTextEditorInset(_,w,E,pe){return M(C,"editorInsets"),ga.createWebviewEditorInset(_,w,E,pe,C)},createTerminal(_,w,E){return typeof _=="object"?"pty"in _?K.createExtensionTerminal(_):K.createTerminalFromOptions(_):K.createTerminal(_,w,E)},registerTerminalLinkProvider(_){return K.registerLinkProvider(_)},registerTerminalProfileProvider(_,w){return K.registerProfileProvider(C,_,w)},registerTerminalCompletionProvider(_,...w){return M(C,"terminalCompletionProvider"),K.registerTerminalCompletionProvider(C,_,...w)},registerTerminalQuickFixProvider(_,w){return M(C,"terminalQuickFixProvider"),K.registerTerminalQuickFixProvider(_,C.identifier.value,w)},registerTreeDataProvider(_,w){return ws.registerTreeDataProvider(_,w,C)},createTreeView(_,w){return ws.createTreeView(_,w,C)},registerWebviewPanelSerializer:(_,w)=>yt.registerWebviewPanelSerializer(C,_,w),registerCustomEditorProvider:(_,w,E={})=>hi.registerCustomEditorProvider(C,_,w,E),registerFileDecorationProvider(_){return G.registerFileDecorationProvider(_,C)},registerUriHandler(_){return Y.registerUriHandler(C,_)},createQuickPick(){return bi.createQuickPick(C)},createInputBox(){return bi.createInputBox(C)},get activeColorTheme(){return Yn.activeColorTheme},onDidChangeActiveColorTheme(_,w,E){return se(Yn.onDidChangeActiveColorTheme)(_,w,E)},registerWebviewViewProvider(_,w,E){return sv.registerWebviewViewProvider(C,_,w,E?.webviewOptions)},get activeNotebookEditor(){return be.activeNotebookEditor},onDidChangeActiveNotebookEditor(_,w,E){return se(be.onDidChangeActiveNotebookEditor)(_,w,E)},get visibleNotebookEditors(){return be.visibleNotebookEditors},get onDidChangeVisibleNotebookEditors(){return se(be.onDidChangeVisibleNotebookEditors)},onDidChangeNotebookEditorSelection(_,w,E){return se(Zt.onDidChangeNotebookEditorSelection)(_,w,E)},onDidChangeNotebookEditorVisibleRanges(_,w,E){return se(Zt.onDidChangeNotebookEditorVisibleRanges)(_,w,E)},showNotebookDocument(_,w){return be.showNotebookDocument(_,w)},registerExternalUriOpener(_,w,E){return M(C,"externalUriOpener"),_a.registerExternalUriOpener(C.identifier,_,w,E)},registerProfileContentHandler(_,w){return M(C,"profileContentHandlers"),ac.registerProfileContentHandler(C,_,w)},registerQuickDiffProvider(_,w,E,pe,ut){return M(C,"quickDiffProvider"),ma.registerQuickDiffProvider(C,it(_),w,E,pe,ut)},get tabGroups(){return x.tabGroups},registerShareProvider(_,w){return M(C,"shareProvider"),nc.registerShareProvider(it(_),w)},get nativeHandle(){return M(C,"nativeWindowHandle"),y.nativeHandle},createChatStatusItem:_=>(M(C,"chatStatusItem"),Kd.createChatStatusItem(C,_)),addInlineDiffWidget(_,w){return At.addInlineDiffWidget(_,w)},addEditorBottomWidget(_,w){return ni.addOverlayWidget(_,w,C)},showInlineChatWidget(_,w,E,pe){return lr.showInlineChatWidget(_,w,E,pe)},registerTerminalCommandChatProvider(_){return Rt.registerTerminalCommandChatProvider(_)},registerSelectionActionProvider:_=>ei.registerSelectionActionProvider(_,C),registerTerminalSelectionActionProvider:_=>mi.registerTerminalSelectionActionProvider(_,C)},jS={get rootPath(){return v.report("workspace.rootPath",C,"Please use 'workspace.workspaceFolders' instead. More details: https://aka.ms/vscode-eliminating-rootpath"),n.getPath()},set rootPath(_){throw new Zn("rootPath")},getWorkspaceFolder(_){return n.getWorkspaceFolder(_)},get workspaceFolders(){return n.getWorkspaceFolders()},get name(){return n.name},set name(_){throw new Zn("name")},get workspaceFile(){return n.workspaceFile},set workspaceFile(_){throw new Zn("workspaceFile")},updateWorkspaceFolders:(_,w,...E)=>n.updateWorkspaceFolders(C,_,w||0,...E),onDidChangeWorkspaceFolders:function(_,w,E){return se(n.onDidChangeWorkspace)(_,w,E)},asRelativePath:(_,w)=>n.getRelativePath(_,w),findFiles:(_,w,E,pe)=>n.findFiles(_,w,E,C.identifier,pe),findFiles2:(_,w,E)=>(M(C,"findFiles2"),n.findFiles2(_,w,C.identifier,E)),findTextInFiles:(_,w,E,pe)=>{M(C,"findTextInFiles");let ut,ti;return typeof w=="object"?(ut=w,ti=E):(ut={},ti=w,pe=E),n.findTextInFiles(_,ut||{},ti,C.identifier,pe)},findTextInFiles2:(_,w,E)=>(M(C,"findTextInFiles2"),M(C,"textSearchProvider2"),n.findTextInFiles2(_,w,C.identifier,E)),save:_=>n.save(_),saveAs:_=>n.saveAs(_),saveAll:_=>n.saveAll(_),applyEdit(_,w){return Me.applyWorkspaceEdit(_,C,w)},createFileSystemWatcher:(_,w,E,pe)=>{const ut={ignoreCreateEvents:!!w,ignoreChangeEvents:!!E,ignoreDeleteEvents:!!pe};return Oi.createFileSystemWatcher(n,nv,C,_,ut)},get textDocuments(){return ee.getAllDocumentData().map(_=>_.document)},set textDocuments(_){throw new Zn("textDocuments")},openTextDocument(_,w){let E;if(w=w??_,typeof _=="string")E=Promise.resolve(b.file(_));else if(b.isUri(_))E=Promise.resolve(_);else if(!w||typeof w=="object")E=ee.createDocumentData(w);else throw new Error("illegal argument - uriOrFileNameOrOptions");return E.then(pe=>(p.trace(`openTextDocument from ${C.identifier}`),pe.scheme===V.vscodeRemote&&!pe.authority&&v.report("workspace.openTextDocument",C,"A URI of 'vscode-remote' scheme requires an authority."),ee.ensureDocumentData(pe,w).then(ut=>ut.document)))},onDidOpenTextDocument:(_,w,E)=>se(ee.onDidAddDocument)(_,w,E),onDidCloseTextDocument:(_,w,E)=>se(ee.onDidRemoveDocument)(_,w,E),onDidChangeTextDocument:(_,w,E)=>se(ee.onDidChangeDocument)(_,w,E),onDidSaveTextDocument:(_,w,E)=>se(ee.onDidSaveDocument)(_,w,E),onWillSaveTextDocument:(_,w,E)=>se(Re.getOnWillSaveTextDocumentEvent(C))(_,w,E),get notebookDocuments(){return be.notebookDocuments.map(_=>_.apiNotebook)},async openNotebookDocument(_,w){let E;if(b.isUri(_))E=_,await be.openNotebookDocument(_);else if(typeof _=="string")E=b.revive(await be.createNotebookDocument({viewType:_,content:w}));else throw new Error("Invalid arguments");return be.getNotebookDocument(E).apiNotebook},onDidSaveNotebookDocument(_,w,E){return se(et.onDidSaveNotebookDocument)(_,w,E)},onDidChangeNotebookDocument(_,w,E){return se(et.onDidChangeNotebookDocument)(_,w,E)},onWillSaveNotebookDocument(_,w,E){return se(gi.getOnWillSaveNotebookDocumentEvent(C))(_,w,E)},get onDidOpenNotebookDocument(){return se(be.onDidOpenNotebookDocument)},get onDidCloseNotebookDocument(){return se(be.onDidCloseNotebookDocument)},registerNotebookSerializer(_,w,E,pe){return be.registerNotebookSerializer(C,_,w,E,nt(C,"notebookLiveShare")?pe:void 0)},onDidChangeConfiguration:(_,w,E)=>se(nv.onDidChangeConfiguration)(_,w,E),getConfiguration(_,w){return w=arguments.length===1?void 0:w,nv.getConfiguration(_,w,C)},registerTextDocumentContentProvider(_,w){return _e.registerTextDocumentContentProvider(_,w)},registerTaskProvider:(_,w)=>(v.report("window.registerTaskProvider",C,"Use the corresponding function on the 'tasks' namespace instead"),j.registerTaskProvider(C,_,w)),registerFileSystemProvider(_,w,E){return wv(Qd.registerFileSystemProvider(C,_,w,E),r.addFileSystemProvider(_,w,E))},get fs(){return r.value},registerFileSearchProvider:(_,w)=>(M(C,"fileSearchProvider"),ct.registerFileSearchProviderOld(_,w)),registerTextSearchProvider:(_,w)=>(M(C,"textSearchProvider"),ct.registerTextSearchProviderOld(_,w)),registerAITextSearchProvider:(_,w)=>(M(C,"aiTextSearchProvider"),M(C,"textSearchProvider2"),ct.registerAITextSearchProvider(_,w)),registerFileSearchProvider2:(_,w)=>(M(C,"fileSearchProvider2"),ct.registerFileSearchProvider(_,w)),registerTextSearchProvider2:(_,w)=>(M(C,"textSearchProvider2"),ct.registerTextSearchProvider(_,w)),registerRemoteAuthorityResolver:(_,w)=>(M(C,"resolvers"),s.registerRemoteAuthorityResolver(_,w)),registerResourceLabelFormatter:_=>(M(C,"resolvers"),oc.$registerResourceLabelFormatter(_)),getRemoteExecServer:_=>(M(C,"resolvers"),s.getRemoteExecServer(_)),onDidCreateFiles:(_,w,E)=>se(Oi.onDidCreateFile)(_,w,E),onDidDeleteFiles:(_,w,E)=>se(Oi.onDidDeleteFile)(_,w,E),onDidRenameFiles:(_,w,E)=>se(Oi.onDidRenameFile)(_,w,E),onWillCreateFiles:(_,w,E)=>se(Oi.getOnWillCreateFileEvent(C))(_,w,E),onWillDeleteFiles:(_,w,E)=>se(Oi.getOnWillDeleteFileEvent(C))(_,w,E),onWillRenameFiles:(_,w,E)=>se(Oi.getOnWillRenameFileEvent(C))(_,w,E),openTunnel:_=>(M(C,"tunnels"),g.openTunnel(C,_).then(w=>{if(!w)throw new Error("cannot open tunnel");return w})),get tunnels(){return M(C,"tunnels"),g.getTunnels()},onDidChangeTunnels:(_,w,E)=>(M(C,"tunnels"),se(g.onDidChangeTunnels)(_,w,E)),registerPortAttributesProvider:(_,w)=>(M(C,"portsAttributes"),g.registerPortsAttributesProvider(_,w)),registerTunnelProvider:(_,w)=>(M(C,"tunnelFactory"),g.registerTunnelProvider(_,w)),registerTimelineProvider:(_,w)=>(M(C,"timeline"),Fi.registerTimelineProvider(_,w,C.identifier,H.converter)),get isTrusted(){return n.trusted},requestWorkspaceTrust:_=>(M(C,"workspaceTrust"),n.requestWorkspaceTrust(_)),onDidGrantWorkspaceTrust:(_,w,E)=>se(n.onDidGrantWorkspaceTrust)(_,w,E),registerEditSessionIdentityProvider:(_,w)=>(M(C,"editSessionIdentityProvider"),n.registerEditSessionIdentityProvider(_,w)),onWillCreateEditSessionIdentity:(_,w,E)=>(M(C,"editSessionIdentityProvider"),se(n.getOnWillCreateEditSessionIdentityEvent(C))(_,w,E)),registerCanonicalUriProvider:(_,w)=>(M(C,"canonicalUriProvider"),n.registerCanonicalUriProvider(_,w)),getCanonicalUri:(_,w,E)=>(M(C,"canonicalUriProvider"),n.provideCanonicalUri(_,w,E)),decode(_,w){return n.decode(_,w)},encode(_,w){return n.encode(_,w)}},aR={get inputBox(){return v.report("scm.inputBox",C,"Use 'SourceControl.inputBox' instead"),Xn.getLastInputBox(C)},createSourceControl(_,w,E){return Xn.createSourceControl(C,_,w,E)}},lR={createCommentController(_,w){return Jd.createCommentController(C,_,w)}},cR={get activeDebugSession(){return ne.activeDebugSession},get activeDebugConsole(){return ne.activeDebugConsole},get breakpoints(){return ne.breakpoints},get activeStackItem(){return ne.activeStackItem},registerDebugVisualizationProvider(_,w){return M(C,"debugVisualization"),ne.registerDebugVisualizationProvider(C,_,w)},registerDebugVisualizationTreeProvider(_,w){return M(C,"debugVisualization"),ne.registerDebugVisualizationTree(C,_,w)},onDidStartDebugSession(_,w,E){return se(ne.onDidStartDebugSession)(_,w,E)},onDidTerminateDebugSession(_,w,E){return se(ne.onDidTerminateDebugSession)(_,w,E)},onDidChangeActiveDebugSession(_,w,E){return se(ne.onDidChangeActiveDebugSession)(_,w,E)},onDidReceiveDebugSessionCustomEvent(_,w,E){return se(ne.onDidReceiveDebugSessionCustomEvent)(_,w,E)},onDidChangeBreakpoints(_,w,E){return se(ne.onDidChangeBreakpoints)(_,w,E)},onDidChangeActiveStackItem(_,w,E){return se(ne.onDidChangeActiveStackItem)(_,w,E)},registerDebugConfigurationProvider(_,w,E){return ne.registerDebugConfigurationProvider(_,w,E||lm.Initial)},registerDebugAdapterDescriptorFactory(_,w){return ne.registerDebugAdapterDescriptorFactory(C,_,w)},registerDebugAdapterTrackerFactory(_,w){return ne.registerDebugAdapterTrackerFactory(_,w)},startDebugging(_,w,E){return!E||typeof E=="object"&&"configuration"in E?ne.startDebugging(_,w,{parentSession:E}):ne.startDebugging(_,w,E||{})},stopDebugging(_){return ne.stopDebugging(_)},addBreakpoints(_){return ne.addBreakpoints(_)},removeBreakpoints(_){return ne.removeBreakpoints(_)},asDebugSourceUri(_,w){return ne.asDebugSourceUri(_,w)}},uR={registerTaskProvider:(_,w)=>j.registerTaskProvider(C,_,w),fetchTasks:_=>j.fetchTasks(_),executeTask:_=>j.executeTask(C,_),get taskExecutions(){return j.taskExecutions},onDidStartTask:(_,w,E)=>se(j.onDidStartTask)(_,w,E),onDidEndTask:(_,w,E)=>se(j.onDidEndTask)(_,w,E),onDidStartTaskProcess:(_,w,E)=>se(j.onDidStartTaskProcess)(_,w,E),onDidEndTaskProcess:(_,w,E)=>se(j.onDidEndTaskProcess)(_,w,E),onDidStartTaskProblemMatchers:(_,w,E)=>(M(C,"taskProblemMatcherStatus"),se(j.onDidStartTaskProblemMatchers)(_,w,E)),onDidEndTaskProblemMatchers:(_,w,E)=>(M(C,"taskProblemMatcherStatus"),se(j.onDidEndTaskProblemMatchers)(_,w,E))},dR={createNotebookController(_,w,E,pe,ut){return xt.createNotebookController(C,_,w,E,pe,nt(C,"notebookMessaging")?ut:void 0)},registerNotebookCellStatusBarItemProvider:(_,w)=>be.registerNotebookCellStatusBarItemProvider(C,_,w),createRendererMessaging(_){return si.createRendererMessaging(C,_)},createNotebookControllerDetectionTask(_){return M(C,"notebookKernelSource"),xt.createNotebookControllerDetectionTask(C,_)},registerKernelSourceActionProvider(_,w){return M(C,"notebookKernelSource"),xt.registerKernelSourceActionProvider(C,_,w)},onDidChangeNotebookCellExecutionState(_,w,E){return M(C,"notebookCellExecutionState"),se(xt.onDidChangeNotebookCellExecutionState)(_,w,E)}},hR={t(..._){if(typeof _[0]=="string"){const w=_.shift(),E=!_||typeof _[0]!="object"?_:_[0];return te.getMessage(C.identifier.value,{message:w,args:E})}return te.getMessage(C.identifier.value,_[0])},get bundle(){return te.getBundle(C.identifier.value)},get uri(){return te.getBundleUri(C.identifier.value)}},fR={transferActiveChat(_){return M(C,"interactive"),N.transferActiveChat(_)}},pR={getRelatedInformation(_,w){return M(C,"aiRelatedInformation"),O.getRelatedInformation(C,_,w)},registerRelatedInformationProvider(_,w){return M(C,"aiRelatedInformation"),O.registerRelatedInformationProvider(C,_,w)},registerEmbeddingVectorProvider(_,w){return M(C,"aiRelatedInformation"),he.registerEmbeddingVectorProvider(C,_,w)},registerSettingsSearchProvider(_){return M(C,"aiSettingsSearch"),we.registerSettingsSearchProvider(C,_)}},gR={registerMappedEditsProvider(_,w){return M(C,"mappedEditsProvider"),{dispose(){}}},registerMappedEditsProvider2(_){return M(C,"mappedEditsProvider"),Je.registerMappedEditsProvider(C,_)},createChatParticipant(_,w){return N.createChatAgent(C,_,w)},createDynamicChatParticipant(_,w,E){return M(C,"chatParticipantPrivate"),N.createDynamicChatAgent(C,_,w,E)},registerChatParticipantDetectionProvider(_){return M(C,"chatParticipantPrivate"),N.registerChatParticipantDetectionProvider(C,_)},registerRelatedFilesProvider(_,w){return M(C,"chatEditing"),N.registerRelatedFilesProvider(C,_,w)},onDidDisposeChatSession:(_,w,E)=>(M(C,"chatParticipantPrivate"),se(N.onDidDisposeChatSession)(_,w,E))},ov={selectChatModels:_=>A.selectLanguageModels(C,_??{}),onDidChangeChatModels:(_,w,E)=>A.onDidChangeProviders(_,w,E),registerChatModelProvider:(_,w,E)=>(M(C,"chatProvider"),A.registerLanguageModel(C,_,w,E)),get embeddingModels(){return M(C,"embeddings"),Jt.embeddingsModels},onDidChangeEmbeddingModels:(_,w,E)=>(M(C,"embeddings"),Jt.onDidChange(_,w,E)),registerEmbeddingsProvider(_,w){return M(C,"embeddings"),Jt.registerEmbeddingsProvider(C,_,w)},async computeEmbeddings(_,w,E){return M(C,"embeddings"),Jt.computeEmbeddings(_,w,E)},registerTool(_,w){return k.registerTool(C,_,w)},invokeTool(_,w,E){return k.invokeTool(C,_,w,E)},get tools(){return k.getTools(C)},fileIsIgnored(_,w){return A.fileIsIgnored(C,_,w)},registerIgnoredFileProvider(_){return A.registerIgnoredFileProvider(C,_)},registerMcpServerDefinitionProvider(_,w){return M(C,"mcpConfigurationProvider"),W.registerMcpConfigurationProvider(C,_,w)}};ov.registerMcpConfigurationProvider=ov.registerMcpServerDefinitionProvider;const mR={registerSpeechProvider(_,w){return M(C,"speech"),Ke.registerProvider(C.identifier,_,w)}};return{version:t.version,ai:pR,authentication:eR,commands:tR,comments:lR,chat:gR,debug:cR,env:qS,extensions:sR,interactive:fR,l10n:hR,languages:nR,lm:ov,notebooks:dR,scm:aR,speech:mR,tasks:uR,tests:rR,window:oR,workspace:jS,genieEditor:iR,Breakpoint:ul,TerminalOutputAnchor:D_,ChatResultFeedbackKind:Iu,ChatVariableLevel:v0,ChatCompletionItem:fU,ChatReferenceDiagnostic:U4,CallHierarchyIncomingCall:g4,CallHierarchyItem:P_,CallHierarchyOutgoingCall:m4,CancellationError:oi,CancellationTokenSource:rt,CandidatePortSource:e1,CodeAction:lu,CodeActionKind:wt,CodeActionTriggerKind:au,CodeLens:qf,Color:nl,ColorInformation:Xf,ColorPresentation:Yf,ColorThemeKind:Mn,CommentMode:Z_,CommentState:e0,CommentThreadCollapsibleState:yu,CommentThreadState:bu,CommentThreadApplicability:Su,CommentThreadFocus:xu,CompletionItem:Qf,CompletionItemKind:fe,CompletionItemTag:uu,CompletionList:Za,CompletionTriggerKind:Ya,ConfigurationTarget:ll,CustomExecution:j_,DebugAdapterExecutable:dl,DebugAdapterInlineImplementation:vu,DebugAdapterNamedPipeServer:mu,DebugAdapterServer:hl,DebugConfigurationProviderTriggerKind:lm,DebugConsoleMode:cp,DebugVisualization:oU,DecorationRangeBehavior:Mo,Diagnostic:Uf,DiagnosticRelatedInformation:iu,DiagnosticSeverity:di,DiagnosticTag:Lo,Disposable:Ie,DocumentHighlight:Vf,DocumentHighlightKind:ru,MultiDocumentHighlight:zf,DocumentLink:Kf,DocumentSymbol:ou,EndOfLine:Fr,EnvironmentVariableMutatorType:Ka,EvaluatableExpression:sp,InlineValueText:np,InlineValueVariableLookup:op,InlineValueEvaluatableExpression:ap,InlineCompletionTriggerKind:_u,EventEmitter:D,ExtensionKind:Wo,ExtensionMode:vl,ExternalUriOpenerPriority:a0,FileChangeType:fl,FileDecoration:r0,FileDecoration2:r0,FileSystemError:qt,FileType:qi,FilePermission:En,FoldingRange:Y_,FoldingRangeKind:Vs,FunctionBreakpoint:Uo,InlineCompletionItem:M_,InlineCompletionList:O_,Hover:Wf,VerboseHover:Bf,HoverVerbosityAction:I_,IndentAction:sb,Location:nr,MarkdownString:Ti,OverviewRulerLane:iy,ParameterInformation:T_,PortAutoForwardAction:c0,Position:Te,ProcessExecution:ol,ProgressLocation:Fo,QuickInputButtonLocation:i0,QuickInputButtons:Eu,Range:Se,RelativePattern:cl,Selection:Bs,SelectionRange:cu,SemanticTokens:pl,SemanticTokensBuilder:nU,SemanticTokensEdit:S4,SemanticTokensEdits:lp,SemanticTokensLegend:t0,ShellExecution:Oo,ShellQuoting:q_,SignatureHelp:R_,SignatureHelpTriggerKind:L_,SignatureInformation:A_,SnippetString:Ro,SourceBreakpoint:Ho,StandardTokenType:On,StatusBarAlignment:Rn,SymbolInformation:nu,SymbolKind:at,SymbolTag:su,Task:Zf,TaskEventKind:V_,TaskGroup:pu,TaskPanelKind:z_,TaskRevealKind:B_,TaskScope:Ln,TerminalLink:GH,TerminalQuickFixTerminalCommand:JH,TerminalQuickFixOpener:QH,TerminalLocation:U_,TerminalProfile:KH,TerminalExitReason:$_,TerminalShellExecutionCommandLineConfidence:fu,TerminalCompletionItem:XH,TerminalCompletionItemKind:W_,TerminalCompletionList:YH,TerminalShellType:H_,TextDocumentSaveReason:tl,TextEdit:An,SnippetTextEdit:k_,TextEditorCursorStyle:Tr,TextEditorChangeKind:rl,TextEditorLineNumbersStyle:$r,TextEditorRevealType:Jf,TextEditorSelectionChangeKind:il,SyntaxTokenType:sl,TextDocumentChangeReason:hu,ThemeColor:gu,ThemeIcon:pi,TreeItem:ep,TreeItemCheckboxState:as,TreeItemCollapsibleState:$o,TypeHierarchyItem:u0,UIKind:sd,Uri:b,ViewColumn:du,WorkspaceEdit:Ao,DocumentPasteTriggerKind:J_,DocumentDropEdit:Q_,DocumentDropOrPasteEditKind:Nn,DocumentPasteEdit:tU,InlayHint:Gf,InlayHintLabelPart:jf,InlayHintKind:N_,RemoteAuthorityResolverError:Ja,ResolvedAuthority:qH,ManagedResolvedAuthority:$f,SourceControlInputBoxValidationType:F_,ExtensionRuntime:mp,TimelineItem:n0,NotebookRange:zs,NotebookCellKind:Bo,NotebookCellExecutionState:ml,NotebookCellData:dp,NotebookData:x4,NotebookRendererScript:C4,NotebookCellStatusBarAlignment:fp,NotebookEditorRevealType:pp,NotebookCellOutput:hp,NotebookCellOutputItem:E4,CellErrorStackFrame:aU,NotebookCellStatusBarItem:lU,NotebookControllerAffinity:s0,NotebookControllerAffinity2:gp,NotebookEdit:Hf,NotebookKernelSourceAction:cU,NotebookVariablesRequestKind:Du,PortAttributes:dU,LinkedEditingRanges:uU,TestResultState:o0,TestRunRequest:vp,TestMessage:_p,TestMessageStackFrame:hU,TestTag:ku,TestRunProfileKind:_l,TextSearchCompleteMessageType:gg,DataTransfer:al,DataTransferItem:tp,TestCoverageCount:wp,FileCoverage:bp,StatementCoverage:k4,BranchCoverage:I4,DeclarationCoverage:P4,WorkspaceTrustState:l0,LanguageStatusSeverity:Xa,QuickPickItemKind:Cu,InputBoxValidationSeverity:gl,TabInputText:d0,TabInputTextDiff:Sp,TabInputTextMerge:T4,TabInputCustom:h0,TabInputNotebook:f0,TabInputNotebookDiff:p0,TabInputWebview:A4,TabInputTerminal:R4,TabInputInteractiveWindow:L4,TabInputChat:N4,TabInputTextMultiDiff:M4,TelemetryTrustedValue:v_,LogLevel:ae,EditSessionIdentityMatch:nb,InteractiveSessionVoteDirection:g0,ChatCopyKind:m0,ChatEditingSessionActionOutcome:Vo,InteractiveEditorResponseFeedbackKind:w0,DebugStackFrame:y4,DebugThread:b4,RelatedInformationType:I0,SpeechToTextStatus:T0,TextToSpeechStatus:A0,PartialAcceptTriggerKind:No,InlineCompletionEndOfLifeReasonKind:el,KeywordRecognitionStatus:R0,ChatImageMimeType:Lp,ChatResponseMarkdownPart:xp,ChatResponseFileTreePart:Cp,ChatResponseAnchorPart:Tu,ChatResponseProgressPart:y0,ChatResponseProgressPart2:Dp,ChatResponseReferencePart:zo,ChatResponseReferencePart2:zo,ChatResponseCodeCitationPart:Pp,ChatResponseCodeblockUriPart:Ip,ChatResponseWarningPart:Au,ChatResponseTextEditPart:Ru,ChatResponseNotebookEditPart:Ap,ChatResponseMarkdownWithVulnerabilitiesPart:Pu,ChatResponseCommandButtonPart:kp,ChatResponseConfirmationPart:Ep,ChatResponseMovePart:Tp,ChatResponseExtensionsPart:b0,ChatResponseReferencePartStatusKind:x0,ChatRequestTurn:S0,ChatRequestTurn2:S0,ChatResponseTurn:O4,ChatLocation:Hr,ChatRequestEditorData:F4,ChatRequestNotebookData:$4,ChatReferenceBinaryData:H4,ChatRequestEditedFileEventKind:_0,LanguageModelChatMessageRole:Gi,LanguageModelChatMessage:W4,LanguageModelChatMessage2:B4,LanguageModelToolResultPart:Rp,LanguageModelToolResultPart2:E0,LanguageModelTextPart:Tt,LanguageModelToolCallPart:qo,LanguageModelError:qs,LanguageModelToolResult:Np,LanguageModelToolResult2:V4,LanguageModelDataPart:Fn,LanguageModelExtraDataPart:D0,ExtendedLanguageModelToolResult:gU,PreparedTerminalToolInvocation:pU,LanguageModelChatToolMode:k0,LanguageModelPromptTsxPart:ls,NewSymbolName:rU,NewSymbolNameTag:X_,NewSymbolNameTriggerKind:wu,InlineEdit:mU,InlineEditTriggerKind:Lu,ExcludeSettingOptions:Qs,TextSearchContext2:pg,TextSearchMatch2:Gs,AISearchKeyword:vw,TextSearchCompleteMessageTypeNew:gg,ChatErrorLevel:C0,McpHttpServerDefinition:_U,McpStdioServerDefinition:vU,SettingsSearchResultKind:P0}}}var Am,Rm=class{constructor(t,i,r,s,n,o,a){this._apiFactory=t,this._extensionRegistry=i,this._instaService=r,this._extHostConfiguration=s,this._extHostExtensionService=n,this._initData=o,this._logService=a,this._factories=new Map,this._alternatives=[]}async install(){this._installInterceptor(),Pt("code/extHost/willWaitForConfig");const t=await this._extHostConfiguration.getConfigProvider();Pt("code/extHost/didWaitForConfig");const i=await this._extHostExtensionService.getExtensionPathIndex();this.register(new HG(this._apiFactory,i,this._extensionRegistry,t,this._logService)),this.register(this._instaService.createInstance(zb)),this._initData.remote.isRemote&&this.register(this._instaService.createInstance(qb,i,this._initData.environment.appUriScheme))}register(t){if("nodeModuleName"in t)if(Array.isArray(t.nodeModuleName))for(const i of t.nodeModuleName)this._factories.set(i,t);else this._factories.set(t.nodeModuleName,t);typeof t.alternativeModuleName=="function"&&this._alternatives.push(i=>t.alternativeModuleName(i))}};Rm=__decorate([__param(2,Ic),__param(3,vr),__param(4,Xs),__param(5,zt),__param(6,ke)],Rm);var zb=class{static{Am=this}static{this.aliased=new Map([["vscode-ripgrep","@vscode/ripgrep"],["vscode-windows-registry","@vscode/windows-registry"]])}constructor(t){if(t.environment.appRoot&&Am.aliased.size){const i=mn(this.forceForwardSlashes(t.environment.appRoot.fsPath)),r="[a-z0-9_.-]",s=`@${r}+\\/${r}+|${r}+`,n="node_modules|node_modules\\.asar(?:\\.unpacked)?";this.re=new RegExp(`^(${i}/${n}\\/)(${s})(.*)$`,"i")}}alternativeModuleName(t){if(!this.re)return;const i=this.re.exec(this.forceForwardSlashes(t));if(!i)return;const[,r,s,n]=i,o=Am.aliased.get(s);if(o!==void 0)return console.warn(`${s} as been renamed to ${o}, please update your imports`),r+o+n}forceForwardSlashes(t){return t.replace(/\\/g,"/")}};zb=Am=__decorate([__param(0,zt)],zb);var HG=class{constructor(e,t,i,r,s){this._apiFactory=e,this._extensionPaths=t,this._extensionRegistry=i,this._configProvider=r,this._logService=s,this.nodeModuleName="vscode",this._extApiImpl=new As}load(e,t){const i=this._extensionPaths.findSubstr(t);if(i){let r=this._extApiImpl.get(i.identifier);return r||(r=this._apiFactory(i,this._extensionRegistry,this._configProvider),this._extApiImpl.set(i.identifier,r)),r}if(!this._defaultApiImpl){let r="";this._extensionPaths.forEach((s,n)=>r+=`	${n} -> ${s.identifier.value}
`),this._logService.warn(`Could not identify extension for 'vscode' require call from ${t}. These are the extension path mappings: 
${r}`),this._defaultApiImpl=this._apiFactory(RH,this._extensionRegistry,this._configProvider)}return this._defaultApiImpl}},qb=class{constructor(t,i,r){this._extensionPaths=t,this._appUriScheme=i,this.nodeModuleName=["open","opn"],this._mainThreadTelemetry=r.getProxy(Q.MainThreadTelemetry);const s=r.getProxy(Q.MainThreadWindow);this._impl=(n,o)=>{const a=b.parse(n);return o?this.callOriginal(n,o):a.scheme==="http"||a.scheme==="https"?s.$openUri(a,n,{allowTunneling:!0}):a.scheme==="mailto"||a.scheme===this._appUriScheme?s.$openUri(a,n,{}):this.callOriginal(n,o)}}load(t,i,r){const s=this._extensionPaths.findSubstr(i);return s&&(this._extensionId=s.identifier.value,this.sendShimmingTelemetry()),this._original=r(t),this._impl}callOriginal(t,i){return this.sendNoForwardTelemetry(),this._original(t,i)}sendShimmingTelemetry(){this._extensionId&&this._mainThreadTelemetry.$publicLog2("shimming.open",{extension:this._extensionId})}sendNoForwardTelemetry(){this._extensionId&&this._mainThreadTelemetry.$publicLog2("shimming.open.call.noForward",{extension:this._extensionId})}};qb=__decorate([__param(2,Pe)],qb);import{LogLevel as aa,createHttpPatch as R7,createProxyResolver as UG,createTlsPatch as WG,createNetPatch as BG,loadSystemCertificates as VG}from"@vscode/proxy-agent";import{createRequire as zG}from"node:module";import{parse as L7}from"url";import{spawn as qG}from"child_process";import{userInfo as jG}from"os";import*as N7 from"os";var M7=/^\d+$/,GG=/^Microsoft.PowerShell_.*/,QG=/^Microsoft.PowerShellPreview_.*/,O7;(function(e){e[e.x64=0]="x64",e[e.x86=1]="x86",e[e.ARM=2]="ARM"})(O7||(O7={}));var Ad;switch(process.arch){case"ia32":Ad=1;break;case"arm":case"arm64":Ad=2;break;default:Ad=0;break}var Jl;process.env.PROCESSOR_ARCHITEW6432?Jl=process.env.PROCESSOR_ARCHITEW6432==="ARM64"?2:0:process.env.PROCESSOR_ARCHITECTURE==="ARM64"?Jl=2:process.env.PROCESSOR_ARCHITECTURE==="X86"?Jl=1:Jl=0;var Rd=class{constructor(e,t,i){this.exePath=e,this.displayName=t,this.knownToExist=i}async exists(){return this.knownToExist===void 0&&(this.knownToExist=await xi.existsFile(this.exePath)),this.knownToExist}};function JG({useAlternateBitness:e=!1}={}){return e?Ad===0?process.env["ProgramFiles(x86)"]||null:Jl===0&&process.env.ProgramW6432||null:process.env.ProgramFiles||null}async function Lm({useAlternateBitness:e=!1,findPreview:t=!1}={}){const i=JG({useAlternateBitness:e});if(!i)return null;const r=Xe(i,"PowerShell");if(!await xi.existsDirectory(r))return null;let s=-1,n=null;for(const l of await dt.readdir(r)){let c=-1;if(t){const d=l.indexOf("-");if(d<0)continue;const f=l.substring(0,d);if(!M7.test(f)||l.substring(d+1)!=="preview")continue;c=parseInt(f,10)}else{if(!M7.test(l))continue;c=parseInt(l,10)}if(c<=s)continue;const u=Xe(r,l,"pwsh.exe");await xi.existsFile(u)&&(n=u,s=c)}if(!n)return null;const o=i.includes("x86")?" (x86)":"",a=t?" Preview":"";return new Rd(n,`PowerShell${a}${o}`,!0)}async function F7({findPreview:e}={}){if(!process.env.LOCALAPPDATA)return null;const t=Xe(process.env.LOCALAPPDATA,"Microsoft","WindowsApps");if(!await xi.existsDirectory(t))return null;const{pwshMsixDirRegex:i,pwshMsixName:r}=e?{pwshMsixDirRegex:QG,pwshMsixName:"PowerShell Preview (Store)"}:{pwshMsixDirRegex:GG,pwshMsixName:"PowerShell (Store)"};for(const s of await dt.readdir(t))if(i.test(s)){const n=Xe(t,s,"pwsh.exe");return new Rd(n,r)}return null}function KG(){const e=Xe(N7.homedir(),".dotnet","tools","pwsh.exe");return new Rd(e,".NET Core PowerShell Global Tool")}function XG(){const e=Xe(N7.homedir(),"scoop","apps"),t=Xe(e,"pwsh","current","pwsh.exe");return new Rd(t,"PowerShell (Scoop)")}function YG(){const e=Xe(process.env.windir,Ad===1&&Jl!==1?"SysNative":"System32","WindowsPowerShell","v1.0","powershell.exe");return new Rd(e,"Windows PowerShell",!0)}async function*ZG(){let e=await Lm();e&&(yield e),e=await Lm({useAlternateBitness:!0}),e&&(yield e),e=await F7(),e&&(yield e),e=KG(),e&&(yield e),e=await Lm({findPreview:!0}),e&&(yield e),e=await F7({findPreview:!0}),e&&(yield e),e=await Lm({useAlternateBitness:!0,findPreview:!0}),e&&(yield e),e=await XG(),e&&(yield e),e=YG(),e&&(yield e)}async function*eQ(){for await(const e of ZG())await e.exists()&&(yield e)}async function tQ(){for await(const e of eQ())return e;return null}async function iQ(e,t){return e===1?Ve?sQ():m6(t):rQ(e,t)}var jb=null;function rQ(e,t){if(Ct&&e===2||Mt&&e===3)return"/bin/bash";if(!jb){let i;if(Ve)i="/bin/bash";else{if(i=t.SHELL,!i)try{i=jG().shell}catch{}i||(i="sh"),i==="/bin/false"&&(i="/bin/bash")}jb=i}return jb}var Gb=null;async function sQ(){return Gb||(Gb=(await tQ()).exePath),Gb}import"assert";var dne=QS(JS(),1),hne={o:h(1854,null),e:h(1855,null),t:h(1856,null)},fne={tunnel:{type:"subcommand",description:"Make the current machine accessible from vscode.dev or other machines through a secure tunnel",options:{"cli-data-dir":{type:"string",args:"dir",description:h(1857,null)},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"},user:{type:"subcommand",options:{login:{type:"subcommand",options:{provider:{type:"string"},"access-token":{type:"string"}}}}}}},"serve-web":{type:"subcommand",description:"Run a server that displays the editor UI in browsers.",options:{"cli-data-dir":{type:"string",args:"dir",description:h(1858,null)},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"}}},diff:{type:"boolean",cat:"o",alias:"d",args:["file","file"],description:h(1859,null)},merge:{type:"boolean",cat:"o",alias:"m",args:["path1","path2","base","result"],description:h(1860,null)},add:{type:"boolean",cat:"o",alias:"a",args:"folder",description:h(1861,null)},remove:{type:"boolean",cat:"o",args:"folder",description:h(1862,null)},goto:{type:"boolean",cat:"o",alias:"g",args:"file:line[:character]",description:h(1863,null)},"new-window":{type:"boolean",cat:"o",alias:"n",description:h(1864,null)},"reuse-window":{type:"boolean",cat:"o",alias:"r",description:h(1865,null)},wait:{type:"boolean",cat:"o",alias:"w",description:h(1866,null)},waitMarkerFilePath:{type:"string"},locale:{type:"string",cat:"o",args:"locale",description:h(1867,null)},"user-data-dir":{type:"string",cat:"o",args:"dir",description:h(1868,null)},profile:{type:"string",cat:"o",args:"profileName",description:h(1869,null)},help:{type:"boolean",cat:"o",alias:"h",description:h(1870,null)},"extensions-dir":{type:"string",deprecates:["extensionHomePath"],cat:"e",args:"dir",description:h(1871,null)},"extensions-download-dir":{type:"string"},"builtin-extensions-dir":{type:"string"},"list-extensions":{type:"boolean",cat:"e",description:h(1872,null)},"show-versions":{type:"boolean",cat:"e",description:h(1873,null)},category:{type:"string",allowEmptyValue:!0,cat:"e",description:h(1874,null),args:"category"},"install-extension":{type:"string[]",cat:"e",args:"ext-id | path",description:h(1875,null)},"pre-release":{type:"boolean",cat:"e",description:h(1876,null)},"uninstall-extension":{type:"string[]",cat:"e",args:"ext-id",description:h(1877,null)},"update-extensions":{type:"boolean",cat:"e",description:h(1878,null)},"enable-proposed-api":{type:"string[]",allowEmptyValue:!0,cat:"e",args:"ext-id",description:h(1879,null)},"add-mcp":{type:"string[]",cat:"o",args:"json",description:h(1880,null)},version:{type:"boolean",cat:"t",alias:"v",description:h(1881,null)},verbose:{type:"boolean",cat:"t",global:!0,description:h(1882,null)},log:{type:"string[]",cat:"t",args:"level",global:!0,description:h(1883,null)},status:{type:"boolean",alias:"s",cat:"t",description:h(1884,null)},"prof-startup":{type:"boolean",cat:"t",description:h(1885,null)},"prof-append-timers":{type:"string"},"prof-duration-markers":{type:"string[]"},"prof-duration-markers-file":{type:"string"},"no-cached-data":{type:"boolean"},"prof-startup-prefix":{type:"string"},"prof-v8-extensions":{type:"boolean"},"disable-extensions":{type:"boolean",deprecates:["disableExtensions"],cat:"t",description:h(1886,null)},"disable-extension":{type:"string[]",cat:"t",args:"ext-id",description:h(1887,null)},sync:{type:"string",cat:"t",description:h(1888,null),args:["on | off"]},"inspect-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugPluginHost"],args:"port",cat:"t",description:h(1889,null)},"inspect-brk-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugBrkPluginHost"],args:"port",cat:"t",description:h(1890,null)},"disable-lcd-text":{type:"boolean",cat:"t",description:h(1891,null)},"disable-gpu":{type:"boolean",cat:"t",description:h(1892,null)},"disable-chromium-sandbox":{type:"boolean",cat:"t",description:h(1893,null)},sandbox:{type:"boolean"},"locate-shell-integration-path":{type:"string",cat:"t",args:["shell"],description:h(1894,null)},telemetry:{type:"boolean",cat:"t",description:h(1895,null)},remote:{type:"string",allowEmptyValue:!0},"folder-uri":{type:"string[]",cat:"o",args:"uri"},"file-uri":{type:"string[]",cat:"o",args:"uri"},"locate-extension":{type:"string[]"},extensionDevelopmentPath:{type:"string[]"},extensionDevelopmentKind:{type:"string[]"},extensionTestsPath:{type:"string"},extensionEnvironment:{type:"string"},debugId:{type:"string"},debugRenderer:{type:"boolean"},"inspect-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-brk-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-search":{type:"string",deprecates:["debugSearch"],allowEmptyValue:!0},"inspect-brk-search":{type:"string",deprecates:["debugBrkSearch"],allowEmptyValue:!0},"inspect-sharedprocess":{type:"string",allowEmptyValue:!0},"inspect-brk-sharedprocess":{type:"string",allowEmptyValue:!0},"export-default-configuration":{type:"string"},"install-source":{type:"string"},"enable-smoke-test-driver":{type:"boolean"},logExtensionHostCommunication:{type:"boolean"},"skip-release-notes":{type:"boolean"},"skip-welcome":{type:"boolean"},"disable-telemetry":{type:"boolean"},"disable-updates":{type:"boolean"},"use-inmemory-secretstorage":{type:"boolean",deprecates:["disable-keytar"]},"password-store":{type:"string"},"disable-workspace-trust":{type:"boolean"},"disable-crash-reporter":{type:"boolean"},"crash-reporter-directory":{type:"string"},"crash-reporter-id":{type:"string"},"skip-add-to-recently-opened":{type:"boolean"},"open-url":{type:"boolean"},"file-write":{type:"boolean"},"file-chmod":{type:"boolean"},"install-builtin-extension":{type:"string[]"},force:{type:"boolean"},"do-not-sync":{type:"boolean"},"do-not-include-pack-dependencies":{type:"boolean"},trace:{type:"boolean"},"trace-memory-infra":{type:"boolean"},"trace-category-filter":{type:"string"},"trace-options":{type:"string"},"preserve-env":{type:"boolean"},"force-user-env":{type:"boolean"},"force-disable-user-env":{type:"boolean"},"open-devtools":{type:"boolean"},"disable-gpu-sandbox":{type:"boolean"},logsPath:{type:"string"},"__enable-file-policy":{type:"boolean"},editSessionId:{type:"string"},continueOn:{type:"string"},"enable-coi":{type:"boolean"},"unresponsive-sample-interval":{type:"string"},"unresponsive-sample-period":{type:"string"},"no-proxy-server":{type:"boolean"},"no-sandbox":{type:"boolean",alias:"sandbox"},"proxy-server":{type:"string"},"proxy-bypass-list":{type:"string"},"proxy-pac-url":{type:"string"},"js-flags":{type:"string"},inspect:{type:"string",allowEmptyValue:!0},"inspect-brk":{type:"string",allowEmptyValue:!0},nolazy:{type:"boolean"},"force-device-scale-factor":{type:"string"},"force-renderer-accessibility":{type:"boolean"},"ignore-certificate-errors":{type:"boolean"},"allow-insecure-localhost":{type:"boolean"},"log-net-log":{type:"string"},vmodule:{type:"string"},_urls:{type:"string[]"},"disable-dev-shm-usage":{type:"boolean"},"profile-temp":{type:"boolean"},"ozone-platform":{type:"string"},"enable-tracing":{type:"string"},"trace-startup-format":{type:"string"},"trace-startup-file":{type:"string"},"trace-startup-duration":{type:"string"},"xdg-portal-required-version":{type:"string"},_:{type:"string[]"}};function $7(e){return e.VSCODE_CLI==="1"}var Qb=void 0;async function nQ(e,t,i,r){return i["force-disable-user-env"]?(t.trace("resolveShellEnv(): skipped (--force-disable-user-env)"),{}):Ve?(t.trace("resolveShellEnv(): skipped (Windows)"),{}):$7(r)&&!i["force-user-env"]?(t.trace("resolveShellEnv(): skipped (VSCODE_CLI is set)"),{}):($7(r)?t.trace("resolveShellEnv(): running (--force-user-env)"):t.trace("resolveShellEnv(): running (macOS/Linux)"),Qb||(Qb=yn.withAsyncBody(async(s,n)=>{const o=new rt;let a=1e4;const l=e.getValue("application.shellEnvironmentResolutionTimeout");typeof l=="number"&&(a=QM(l,1,120)*1e3);const c=setTimeout(()=>{o.dispose(!0),n(new Error(h(2246,null)))},a);try{s(await oQ(t,o.token))}catch(u){!Yi(u)&&!o.token.isCancellationRequested?n(new Error(h(2247,null,es(u)))):s({})}finally{clearTimeout(c),o.dispose()}})),Qb)}async function oQ(e,t){const i=process.env.ELECTRON_RUN_AS_NODE;e.trace("getUnixShellEnvironment#runAsNode",i);const r=process.env.ELECTRON_NO_ATTACH_CONSOLE;e.trace("getUnixShellEnvironment#noAttach",r);const s=mt().replace(/-/g,"").substr(0,12),n=new RegExp(s+"({.*})"+s),o={...process.env,ELECTRON_RUN_AS_NODE:"1",ELECTRON_NO_ATTACH_CONSOLE:"1",VSCODE_RESOLVING_ENVIRONMENT:"1"};e.trace("getUnixShellEnvironment#env",o);const a=await iQ(io,o);return e.trace("getUnixShellEnvironment#shell",a),new Promise((l,c)=>{if(t.isCancellationRequested)return c(new oi);const u=bt(a);let d,f;const p="";/^(?:pwsh|powershell)(?:-preview)?$/.test(u)?(d=`& '${process.execPath}' ${p} -p '''${s}'' + JSON.stringify(process.env) + ''${s}'''`,f=["-Login","-Command"]):u==="nu"?(d=`^'${process.execPath}' ${p} -p '"${s}" + JSON.stringify(process.env) + "${s}"'`,f=["-i","-l","-c"]):u==="xonsh"?(d=`import os, json; print("${s}", json.dumps(dict(os.environ)), "${s}")`,f=["-i","-l","-c"]):(d=`'${process.execPath}' ${p} -p '"${s}" + JSON.stringify(process.env) + "${s}"'`,u==="tcsh"||u==="csh"?f=["-ic"]:f=["-i","-l","-c"]),e.trace("getUnixShellEnvironment#spawn",JSON.stringify(f),d);const g=qG(a,[...f,d],{detached:!0,stdio:["ignore","pipe","pipe"],env:o});t.onCancellationRequested(()=>(g.kill(),c(new oi))),g.on("error",S=>{e.error("getUnixShellEnvironment#errorChildProcess",es(S)),c(S)});const v=[];g.stdout.on("data",S=>v.push(S));const y=[];g.stderr.on("data",S=>y.push(S)),g.on("close",(S,x)=>{const P=Buffer.concat(v).toString("utf8");e.trace("getUnixShellEnvironment#raw",P);const $=Buffer.concat(y).toString("utf8");if($.trim()&&e.trace("getUnixShellEnvironment#stderr",$),S||x)return c(new Error(h(2248,null,S,x)));const A=n.exec(P),W=A?A[1]:"{}";try{const G=JSON.parse(W);i?G.ELECTRON_RUN_AS_NODE=i:delete G.ELECTRON_RUN_AS_NODE,r?G.ELECTRON_NO_ATTACH_CONSOLE=r:delete G.ELECTRON_NO_ATTACH_CONSOLE,delete G.VSCODE_RESOLVING_ENVIRONMENT,delete G.XDG_RUNTIME_DIR,e.trace("getUnixShellEnvironment#result",G),l(G)}catch(G){e.error("getUnixShellEnvironment#errorCaught",es(G)),c(G)}})})}import{parse as H7}from"url";function aQ(e,t){return e.protocol==="http:"?t.HTTP_PROXY||t.http_proxy||null:e.protocol==="https:"&&(t.HTTPS_PROXY||t.https_proxy||t.HTTP_PROXY||t.http_proxy)||null}async function lQ(e,t,i={}){const r=H7(e),s=i.proxyUrl||aQ(r,t);if(!s)return null;const n=H7(s);if(!/^https?:$/.test(n.protocol||""))return null;const o={host:n.hostname||"",port:(n.port?+n.port:0)||(n.protocol==="https"?443:80),auth:n.auth,rejectUnauthorized:ux(i.strictSSL)?i.strictSSL:!0};if(r.protocol==="http:"){const{default:a}=await import("http-proxy-agent");return new a.HttpProxyAgent(s,o)}else{const{default:a}=await import("https-proxy-agent");return new a.HttpsProxyAgent(s,o)}}import{createGunzip as cQ}from"zlib";var U7=class extends M${constructor(t,i,r,s){super(s),this.machine=t,this.configurationService=i,this.environmentService=r,this.configure(),this._register(i.onDidChangeConfiguration(n=>{n.affectsConfiguration("http")&&this.configure()}))}configure(){this.proxyUrl=this.getConfigValue("http.proxy"),this.strictSSL=!!this.getConfigValue("http.proxyStrictSSL"),this.authorization=this.getConfigValue("http.proxyAuthorization")}async request(t,i){const{proxyUrl:r,strictSSL:s}=this;let n;try{n=await nQ(this.configurationService,this.logService,this.environmentService.args,process.env)}catch(l){this.shellEnvErrorLogged||(this.shellEnvErrorLogged=!0,this.logService.error("resolving shell environment failed",ZS(l)))}const o={...process.env,...n},a=t.agent?t.agent:await lQ(t.url||"",o,{proxyUrl:r,strictSSL:s});return t.agent=a,t.strictSSL=s,this.authorization&&(t.headers={...t.headers||{},"Proxy-Authorization":this.authorization}),this.logAndRequest(t,()=>B7(t,i))}async resolveProxy(t){}async lookupAuthorization(t){}async lookupKerberosAuthorization(t){try{const i=this.getConfigValue("http.proxyKerberosServicePrincipal");return"Negotiate "+await W7(t,i,this.logService,"RequestService#lookupKerberosAuthorization")}catch(i){this.logService.debug("RequestService#lookupKerberosAuthorization Kerberos authentication failed",i);return}}async loadCertificates(){return(await import("@vscode/proxy-agent")).loadSystemCertificates({log:this.logService})}getConfigValue(t){if(this.machine==="remote")return this.configurationService.getValue(t);const i=this.configurationService.inspect(t);return i.userLocalValue||i.defaultValue}};U7=__decorate([__param(1,Us),__param(2,U$),__param(3,ke)],U7);async function W7(e,t,i,r){const s=await import("kerberos"),n=s.default||s,o=new URL(e),a=t||(process.platform==="win32"?`HTTP/${o.hostname}`:`HTTP@${o.hostname}`);return i.debug(`${r} Kerberos authentication lookup`,`proxyURL:${o}`,`spn:${a}`),(await n.initializeClient(a)).step("")}async function uQ(e){return(L7(e.url).protocol==="https:"?await import("https"):await import("http")).request}async function B7(e,t){return yn.withAsyncBody(async(i,r)=>{const s=L7(e.url),n=e.getRawRequest?e.getRawRequest(e):await uQ(e),o={hostname:s.hostname,port:s.port?parseInt(s.port):s.protocol==="https:"?443:80,protocol:s.protocol,path:s.path,method:e.type||"GET",headers:e.headers,agent:e.agent,rejectUnauthorized:ux(e.strictSSL)?e.strictSSL:!0};e.user&&e.password&&(o.auth=e.user+":"+e.password),e.disableCache&&(o.cache="no-store");const a=n(o,l=>{const c=cr(e.followRedirects)?e.followRedirects:3;if(l.statusCode&&l.statusCode>=300&&l.statusCode<400&&c>0&&l.headers.location)B7({...e,url:l.headers.location,followRedirects:c-1},t).then(i,r);else{let u=l;!e.isChromiumNetwork&&l.headers["content-encoding"]==="gzip"&&(u=l.pipe(cQ())),i({res:l,stream:uN(u)})}});if(a.on("error",r),e.timeout)if(e.isChromiumNetwork){const l=setTimeout(()=>{a.abort(),r(new Error(`Request timeout after ${e.timeout}ms`))},e.timeout);a.on("response",()=>clearTimeout(l)),a.on("error",()=>clearTimeout(l)),a.on("abort",()=>clearTimeout(l))}else a.setTimeout(e.timeout);e.isChromiumNetwork&&a.removeHeader("Content-Length"),e.data&&typeof e.data=="string"&&a.write(e.data),a.end(),t.onCancellationRequested(()=>{a.abort(),r(new oi)})})}import*as Nm from"@vscode/proxy-agent";var Kl=zG(import.meta.url),V7=Kl("http"),Mm=Kl("https"),z7=Kl("tls"),q7=Kl("net"),j7=!1,G7=!1;function dQ(e,t,i,r,s,n,o){const a=n.remote.isRemote,l=n.environment.useHostProxy??!a,c=l,u=l,d=()=>!a||t.getConfiguration("http").get("useLocalProxyConfiguration",l),f={resolveProxy:S=>e.resolveProxy(S),lookupProxyAuthorization:wQ.bind(void 0,e,r,s,t,{},{},n.remote.isRemote,c),getProxyURL:()=>sn(t,a,"http.proxy"),getProxySupport:()=>sn(t,a,"http.proxySupport")||"off",getNoProxyConfig:()=>sn(t,a,"http.noProxy")||[],isAdditionalFetchSupportEnabled:()=>sn(t,a,"http.fetchAdditionalSupport",!0),addCertificatesV1:()=>mQ(t,a),addCertificatesV2:()=>vQ(t,a),log:r,getLogLevel:()=>{const S=r.getLevel();switch(S){case ae.Trace:return aa.Trace;case ae.Debug:return aa.Debug;case ae.Info:return aa.Info;case ae.Warning:return aa.Warning;case ae.Error:return aa.Error;case ae.Off:return aa.Off;default:return x(S)}function x(P){return r.error("Unknown log level",P),aa.Debug}},proxyResolveTelemetry:()=>{},isUseHostProxyEnabled:d,loadAdditionalCertificates:async()=>{const S=[];if(n.remote.isRemote&&S.push(VG({log:r})),u){r.trace("ProxyResolver#loadAdditionalCertificates: Loading certificates from main process");const x=e.loadCertificates();x.then(P=>r.trace("ProxyResolver#loadAdditionalCertificates: Loaded certificates from main process",P.length)),S.push(x)}return n.environment.extensionTestsLocationURI&&Mm.globalAgent.testCertificates?.length&&(r.trace("ProxyResolver#loadAdditionalCertificates: Loading test certificates"),S.push(Promise.resolve(Mm.globalAgent.testCertificates))),(await Promise.all(S)).flat()},env:process.env},{resolveProxyWithRequest:p,resolveProxyURL:g}=UG(f),v=Nm.default||Nm;v.resolveProxyURL=g,fQ(f,t,s,n,g,o);const y=gQ(f,p);return _Q(i,y)}var hQ=["content-length","host","trailer","te","upgrade","cookie2","keep-alive","transfer-encoding","set-cookie"];function fQ(e,t,i,r,s,n){if(!globalThis.__vscodeOriginalFetch){const o=globalThis.fetch;globalThis.__vscodeOriginalFetch=o;const a=Nm.createFetchPatch(e,o,s);globalThis.__vscodePatchedFetch=a;let l=!1;r.remote.isRemote||(l=t.getConfiguration("http").get("electronFetch",G7),n.add(t.onDidChangeConfiguration(c=>{c.affectsConfiguration("http.electronFetch")&&(l=t.getConfiguration("http").get("electronFetch",G7))}))),globalThis.fetch=async function(u,d){function f(A){return d&&A in d?d[A]:typeof u=="object"&&"cache"in u?u[A]:void 0}const p=typeof u=="string"?u:"cache"in u?u.url:u.toString(),g=p.startsWith("data:");g&&Xl(i,"data");const v=p.startsWith("blob:");v&&Xl(i,"blob");const y=f("redirect")==="manual";y&&Xl(i,"manualRedirect");const S=f("integrity");if(S&&Xl(i,"integrity"),!l||g||v||y||S){const A=await a(u,d);return Q7(i,A,p),A}if(d?.headers){const A=new Headers(d.headers);for(const W of hQ)A.delete(W);d={...d,headers:A}}const x=u instanceof URL?u.toString():u,$=await Kl("electron").net.fetch(x,d);return Q7(i,$,p),$}}}function Q7(e,t,i){const r=t.url;Object.defineProperty(t,"url",{get(){return Xl(e,"url"),r||i}});const s=t.type;Object.defineProperty(t,"type",{get(){return Xl(e,"typeProperty"),s!=="default"?s:"basic"}})}var J7={url:0,typeProperty:0,data:0,blob:0,integrity:0,manualRedirect:0},Om,pQ=!1;function Xl(e,t){pQ&&!J7[t]++&&(Om&&clearTimeout(Om),Om=setTimeout(()=>{e.$publicLog2("fetchFeatureUse",J7)},1e4),Om.unref())}function gQ(e,t){function i(n,o){const a=n.default||n;return a.__vscodeOriginal=Object.assign({},a),Object.assign(a,o)}const r=R7(e,V7,t),s=R7(e,Mm,t);return{http:i(V7,r),https:i(Mm,s),net:i(q7,BG(e,q7)),tls:i(z7,WG(e,z7))}}function mQ(e,t){return!sn(e,t,"http.experimental.systemCertificatesV2",j7)&&!!sn(e,t,"http.systemCertificates")}function vQ(e,t){return!!sn(e,t,"http.experimental.systemCertificatesV2",j7)&&!!sn(e,t,"http.systemCertificates")}var K7=new Map;function _Q(e,t){return e.getExtensionPathIndex().then(i=>{const r=Kl("module"),s=r._load;r._load=function(o,a,l){if(o==="net")return t.net;if(o==="tls")return t.tls;if(o!=="http"&&o!=="https"&&o!=="undici")return s.apply(this,arguments);const c=i.findSubstr(b.file(a.filename));let u=K7.get(c);if(u||K7.set(c,u={}),!u[o])if(o==="undici"){const d=s.apply(this,arguments);Nm.patchUndici(d),u[o]=d}else{const d=t[o];u[o]={...d}}return u[o]}})}async function wQ(e,t,i,r,s,n,o,a,l,c,u){const d=s[l];c&&(s[l]=c),t.trace("ProxyResolver#lookupProxyAuthorization callback",`proxyURL:${l}`,`proxyAuthenticate:${c}`,`proxyAuthenticateCache:${d}`);const f=c||d,p=Array.isArray(f)?f:typeof f=="string"?[f]:[];if(bQ(i,p,o),p.some(v=>/^(Negotiate|Kerberos)( |$)/i.test(v))&&!u.kerberosRequested){u.kerberosRequested=!0;try{const v=sn(r,o,"http.proxyKerberosServicePrincipal");return"Negotiate "+await W7(l,v,t,"ProxyResolver#lookupProxyAuthorization")}catch(v){t.debug("ProxyResolver#lookupProxyAuthorization Kerberos authentication failed",v)}if(o&&a){t.debug("ProxyResolver#lookupProxyAuthorization Kerberos authentication lookup on host",`proxyURL:${l}`);const v=await e.lookupKerberosAuthorization(l);if(v)return"Negotiate "+v}}const g=p.find(v=>/^Basic( |$)/i.test(v));if(g)try{const v=n[l];if(v)if(u.basicAuthCacheUsed)t.debug("ProxyResolver#lookupProxyAuthorization Basic authentication deleting cached credentials",`proxyURL:${l}`),delete n[l];else return t.debug("ProxyResolver#lookupProxyAuthorization Basic authentication using cached credentials",`proxyURL:${l}`),u.basicAuthCacheUsed=!0,v;u.basicAuthAttempt=(u.basicAuthAttempt||0)+1;const y=/ realm="([^"]+)"/i.exec(g)?.[1];t.debug("ProxyResolver#lookupProxyAuthorization Basic authentication lookup",`proxyURL:${l}`,`realm:${y}`);const S=new URL(l),x={scheme:"basic",host:S.hostname,port:Number(S.port),realm:y||"",isProxy:!0,attempt:u.basicAuthAttempt},P=await e.lookupAuthorization(x);if(P){t.debug("ProxyResolver#lookupProxyAuthorization Basic authentication received credentials",`proxyURL:${l}`,`realm:${y}`);const $="Basic "+Buffer.from(`${P.username}:${P.password}`).toString("base64");return n[l]=$,$}else t.debug("ProxyResolver#lookupProxyAuthorization Basic authentication received no credentials",`proxyURL:${l}`,`realm:${y}`)}catch(v){t.error("ProxyResolver#lookupProxyAuthorization Basic authentication failed",v)}}var X7=!1,yQ=!1;function bQ(e,t,i){!yQ||X7||!t.length||(X7=!0,e.$publicLog2("proxyAuthenticationRequest",{authenticationType:t.map(r=>r.split(" ")[0]).join(","),extensionHostType:i?"remote":"local"}))}function sn(e,t,i,r){if(t)return e.getConfiguration().get(i)??r;const s=e.getConfiguration().inspect(i);return s?.globalLocalValue??s?.defaultValue??r}import{tmpdir as SQ}from"os";var Jb=class extends X{constructor(t,i){super();const r=t.getProxy(Q.MainThreadDownloadService);i.registerCommand(!1,"_workbench.downloadResource",async s=>{const n=b.file(Xe(SQ(),mt()));return await r.$download(s,n),n})}};Jb=__decorate([__param(0,Pe),__param(1,Vr)],Jb);import*as xQ from"http";import*as Y7 from"fs";var EQ=class{constructor(e,t,i){this._commands=e,this.logService=t,this._ipcHandlePath=i,this._server=xQ.createServer((r,s)=>this.onRequest(r,s)),this.setup().catch(r=>(t.error(r),""))}get ipcHandlePath(){return this._ipcHandlePath}async setup(){try{this._server.listen(this.ipcHandlePath),this._server.on("error",e=>this.logService.error(e))}catch{this.logService.error("Could not start open from terminal server.")}return this._ipcHandlePath}onRequest(e,t){const i=(s,n)=>{t.writeHead(s,{"content-type":"application/json"}),t.end(JSON.stringify(n||null),o=>o&&this.logService.error(o))},r=[];e.setEncoding("utf8"),e.on("data",s=>r.push(s)),e.on("end",async()=>{try{const s=JSON.parse(r.join(""));let n;switch(s.type){case"open":n=await this.open(s);break;case"openExternal":n=await this.openExternal(s);break;case"status":n=await this.getStatus(s);break;case"extensionManagement":n=await this.manageExtensions(s);break;default:i(404,`Unknown message type: ${s.type}`);break}i(200,n)}catch(s){const n=s instanceof Error?s.message:JSON.stringify(s);i(500,n),this.logService.error("Error while processing pipe request",s)}})}async open(e){const{fileURIs:t,folderURIs:i,forceNewWindow:r,diffMode:s,mergeMode:n,addMode:o,removeMode:a,forceReuseWindow:l,gotoLineMode:c,waitMarkerFilePath:u,remoteAuthority:d}=e,f=[];if(Array.isArray(i))for(const y of i)try{f.push({folderUri:b.parse(y)})}catch{}if(Array.isArray(t))for(const y of t)try{iO(y)?f.push({workspaceUri:b.parse(y)}):f.push({fileUri:b.parse(y)})}catch{}const p=u?b.file(u):void 0,v={forceNewWindow:r,diffMode:s,mergeMode:n,addMode:o,removeMode:a,gotoLineMode:c,forceReuseWindow:l,preferNewWindow:!l&&!p&&!o&&!a,waitMarkerFileURI:p,remoteAuthority:d};this._commands.executeCommand("_remoteCLI.windowOpen",f,v)}async openExternal(e){for(const t of e.uris){const i=b.parse(t),r=i.scheme==="file"?i:t;await this._commands.executeCommand("_remoteCLI.openExternal",r)}}async manageExtensions(e){const t=r=>r?.map(s=>/\.vsix$/i.test(s)?b.parse(s):s),i={list:e.list,install:t(e.install),uninstall:t(e.uninstall),force:e.force};return await this._commands.executeCommand("_remoteCLI.manageExtensions",i)}async getStatus(e){return await this._commands.executeCommand("_remoteCLI.getSystemStatus")}dispose(){this._server.close(),this._ipcHandlePath&&process.platform!=="win32"&&Y7.existsSync(this._ipcHandlePath)&&Y7.unlinkSync(this._ipcHandlePath)}},Kb=class extends EQ{constructor(t,i){super(t,i,i2())}};Kb=__decorate([__param(0,Vr),__param(1,ke)],Kb);var Xb=class{constructor(t,i){this._mainThreadConsole=t.getProxy(Q.MainThreadConsole),this._includeStack=i.consoleForward.includeStack,this._logNative=i.consoleForward.logNative,this._wrapConsoleMethod("info","log"),this._wrapConsoleMethod("log","log"),this._wrapConsoleMethod("warn","warn"),this._wrapConsoleMethod("debug","debug"),this._wrapConsoleMethod("error","error")}_wrapConsoleMethod(t,i){const r=this,s=console[t];Object.defineProperty(console,t,{set:()=>{},get:()=>function(){r._handleConsoleCall(t,i,s,arguments)}})}_handleConsoleCall(t,i,r,s){this._mainThreadConsole.$logExtensionHostMessage({type:"__$console",severity:i,arguments:DQ(s,this._includeStack)}),this._logNative&&this._nativeConsoleLogMessage(t,r,s)}};Xb=__decorate([__param(0,Pe),__param(1,zt)],Xb);var CQ=1e5;function DQ(e,t){const i=[];if(e.length)for(let r=0;r<e.length;r++){let s=e[r];if(typeof s>"u")s="undefined";else if(s instanceof Error){const n=s;n.stack?s=n.stack:s=n.toString()}i.push(s)}if(t){const r=new Error().stack;r&&i.push({__$stack:r.split(`
`).slice(3).join(`
`)})}try{const r=s2(i);return r.length>CQ?"Output omitted for a large object that exceeds the limits":r}catch(r){return`Output omitted for an object that cannot be inspected ('${r.toString()}')`}}var kQ=1024*1024,Yb=class extends Xb{constructor(t,i){super(t,i),this._isMakingConsoleCall=!1,this._wrapStream("stderr","error"),this._wrapStream("stdout","log")}_nativeConsoleLogMessage(t,i,r){const s=t==="error"||t==="warn"?process.stderr:process.stdout;this._isMakingConsoleCall=!0,s.write(`
START_NATIVE_LOG
`),i.apply(console,r),s.write(`
END_NATIVE_LOG
`),this._isMakingConsoleCall=!1}_wrapStream(t,i){const r=process[t],s=r.write;let n="";Object.defineProperty(r,"write",{set:()=>{},get:()=>(o,a,l)=>{if(!this._isMakingConsoleCall){n+=o.toString(a);const c=n.length>kQ?n.length:n.lastIndexOf(`
`);c!==-1&&(console[i](n.slice(0,c)),n=n.slice(c+1))}s.call(r,o,a,l)}})}};Yb=__decorate([__param(0,Pe),__param(1,zt)],Yb);import{promises as la}from"fs";async function IQ(e,t,i,r,s,n){let o;try{await PQ(e,t,i,r,s,n)}catch(a){o=a}finally{o&&s.errorTransformer&&(o=s.errorTransformer(o)),typeof o<"u"&&i.error(o),i.end()}}async function PQ(e,t,i,r,s,n){Zb(n);const o=await e.open(t,{create:!1});try{Zb(n);let a=0,l=0,c=s&&typeof s.length=="number"?s.length:void 0,u=z.alloc(Math.min(s.bufferSize,typeof c=="number"?c:s.bufferSize)),d=s&&typeof s.position=="number"?s.position:0,f=0;do l=await e.read(o,d,u.buffer,f,u.byteLength-f),d+=l,f+=l,a+=l,typeof c=="number"&&(c-=l),f===u.byteLength&&(await i.write(r(u)),u=z.alloc(Math.min(s.bufferSize,typeof c=="number"?c:s.bufferSize)),f=0);while(l>0&&(typeof c!="number"||c>0)&&Zb(n)&&TQ(a,s));if(f>0){let p=f;typeof c=="number"&&(p=Math.min(f,c)),i.write(r(u.slice(0,p)))}}catch(a){throw oF(a)}finally{await e.close(o)}}function Zb(e){if(e.isCancellationRequested)throw cc();return!0}function TQ(e,t){if(typeof t?.limits?.size=="number"&&e>t.limits.size)throw Os(h(2076,null),de.FileTooLarge);return!0}var AQ=class extends X{constructor(e,t){super(),this.logService=e,this.options=t,this._onDidChangeFile=this._register(new D),this.onDidChangeFile=this._onDidChangeFile.event,this._onDidWatchError=this._register(new D),this.onDidWatchError=this._onDidWatchError.event,this.universalWatchRequests=[],this.universalWatchRequestDelayer=this._register(new yh(this.getRefreshWatchersDelay(this.universalWatchRequests.length))),this.nonRecursiveWatchRequests=[],this.nonRecursiveWatchRequestDelayer=this._register(new yh(this.getRefreshWatchersDelay(this.nonRecursiveWatchRequests.length)))}watch(e,t){return t.recursive||this.options?.watcher?.forceUniversal?this.watchUniversal(e,t):this.watchNonRecursive(e,t)}getRefreshWatchersDelay(e){return e>200?500:0}watchUniversal(e,t){const i=this.toWatchRequest(e,t),r=tx(this.universalWatchRequests,i);return this.refreshUniversalWatchers(),ie(()=>{r(),this.refreshUniversalWatchers()})}toWatchRequest(e,t){const i={path:this.toWatchPath(e),excludes:t.excludes,includes:t.includes,recursive:t.recursive,filter:t.filter,correlationId:t.correlationId};if(Fq(i)){const r=this.options?.watcher?.recursive?.usePolling;r===!0?i.pollingInterval=this.options?.watcher?.recursive?.pollingInterval??5e3:Array.isArray(r)&&r.includes(i.path)&&(i.pollingInterval=this.options?.watcher?.recursive?.pollingInterval??5e3)}return i}refreshUniversalWatchers(){this.universalWatchRequestDelayer.trigger(()=>this.doRefreshUniversalWatchers(),this.getRefreshWatchersDelay(this.universalWatchRequests.length)).catch(e=>pt(e))}doRefreshUniversalWatchers(){return this.universalWatcher||(this.universalWatcher=this._register(this.createUniversalWatcher(e=>this._onDidChangeFile.fire(SA(e)),e=>this.onWatcherLogMessage(e),this.logService.getLevel()===ae.Trace)),this._register(this.logService.onDidChangeLogLevel(()=>{this.universalWatcher?.setVerboseLogging(this.logService.getLevel()===ae.Trace)}))),this.universalWatcher.watch(this.universalWatchRequests)}watchNonRecursive(e,t){const i={path:this.toWatchPath(e),excludes:t.excludes,includes:t.includes,recursive:!1,filter:t.filter,correlationId:t.correlationId},r=tx(this.nonRecursiveWatchRequests,i);return this.refreshNonRecursiveWatchers(),ie(()=>{r(),this.refreshNonRecursiveWatchers()})}refreshNonRecursiveWatchers(){this.nonRecursiveWatchRequestDelayer.trigger(()=>this.doRefreshNonRecursiveWatchers(),this.getRefreshWatchersDelay(this.nonRecursiveWatchRequests.length)).catch(e=>pt(e))}doRefreshNonRecursiveWatchers(){return this.nonRecursiveWatcher||(this.nonRecursiveWatcher=this._register(this.createNonRecursiveWatcher(e=>this._onDidChangeFile.fire(SA(e)),e=>this.onWatcherLogMessage(e),this.logService.getLevel()===ae.Trace)),this._register(this.logService.onDidChangeLogLevel(()=>{this.nonRecursiveWatcher?.setVerboseLogging(this.logService.getLevel()===ae.Trace)}))),this.nonRecursiveWatcher.watch(this.nonRecursiveWatchRequests)}onWatcherLogMessage(e){e.type==="error"&&this._onDidWatchError.fire(e.message),this.logWatcherMessage(e)}logWatcherMessage(e){this.logService[e.type](e.message)}toFilePath(e){return Cs(e.fsPath)}toWatchPath(e){const t=this.toFilePath(e);return v3(t)}};import{fork as RQ}from"child_process";function LQ(e){const t=e;return t&&typeof t.type=="string"&&typeof t.severity=="string"}function NQ(e){const t=[];let i;try{const r=JSON.parse(e.arguments),s=r[r.length-1];s&&s.__$stack&&(r.pop(),i=s.__$stack),t.push(...r)}catch{t.push("Unable to log remote console arguments",e.arguments)}return{args:t,stack:i}}function MQ(e){if(!e)return e;const t=e.indexOf(`
`);return t===-1?e:e.substring(0,t)}function OQ(e,t){const{args:i,stack:r}=NQ(e),s=typeof i[0]=="string"&&i.length===1;let n=MQ(r);n&&(n=`(${n.trim()})`);let o=[];if(typeof i[0]=="string"?n&&s?o=[`%c[${t}] %c${i[0]} %c${n}`,Yl("blue"),Yl(""),Yl("grey")]:o=[`%c[${t}] %c${i[0]}`,Yl("blue"),Yl(""),...i.slice(1)]:o=[`%c[${t}]%`,Yl("blue"),...i],n&&!s&&o.push(n),typeof console[e.severity]!="function")throw new Error("Unknown console method");console[e.severity].apply(console,o)}function Yl(e){return`color: ${e}`}var FQ=class{constructor(e,t){this.modulePath=e,this.options=t,this.activeRequests=new Set,this.channels=new Map,this._onDidProcessExit=new D,this.onDidProcessExit=this._onDidProcessExit.event;const i=t&&t.timeout?t.timeout:6e4;this.disposeDelayer=new _E(i),this.child=null,this._client=null}getChannel(e){const t=this;return{call(i,r,s){return t.requestPromise(e,i,r,s)},listen(i,r){return t.requestEvent(e,i,r)}}}requestPromise(e,t,i,r=Be.None){if(!this.disposeDelayer)return Promise.reject(new Error("disposed"));if(r.isCancellationRequested)return Promise.reject(cc());this.disposeDelayer.cancel();const s=this.getCachedChannel(e),n=Ds(l=>s.call(t,i,l)),o=r.onCancellationRequested(()=>n.cancel()),a=ie(()=>n.cancel());return this.activeRequests.add(a),n.finally(()=>{o.dispose(),this.activeRequests.delete(a),this.activeRequests.size===0&&this.disposeDelayer&&this.disposeDelayer.trigger(()=>this.disposeClient())}),n}requestEvent(e,t,i){if(!this.disposeDelayer)return Fe.None;this.disposeDelayer.cancel();let r;const s=new D({onWillAddFirstListener:()=>{r=this.getCachedChannel(e).listen(t,i)(s.fire,s),this.activeRequests.add(r)},onDidRemoveLastListener:()=>{this.activeRequests.delete(r),r.dispose(),this.activeRequests.size===0&&this.disposeDelayer&&this.disposeDelayer.trigger(()=>this.disposeClient())}});return s.event}get client(){if(!this._client){const e=this.options&&this.options.args?this.options.args:[],t=Object.create(null);t.env={...Ye(process.env),VSCODE_PARENT_PID:String(process.pid)},this.options&&this.options.env&&(t.env={...t.env,...this.options.env}),this.options&&this.options.freshExecArgv&&(t.execArgv=[]),this.options&&typeof this.options.debug=="number"&&(t.execArgv=["--nolazy","--inspect="+this.options.debug]),this.options&&typeof this.options.debugBrk=="number"&&(t.execArgv=["--nolazy","--inspect-brk="+this.options.debugBrk]),t.execArgv===void 0&&(t.execArgv=process.execArgv.filter(u=>!/^--inspect(-brk)?=/.test(u)).filter(u=>!u.startsWith("--vscode-"))),TV(t.env),this.child=RQ(this.modulePath,e,t);const i=new D,s=Fe.fromNodeEventEmitter(this.child,"message",u=>u)(u=>{if(LQ(u)){OQ(u,`IPC Library: ${this.options.serverName}`);return}i.fire(z.wrap(Buffer.from(u,"base64")))}),n=this.options.useQueue?AV(this.child):this.child,o=u=>this.child&&this.child.connected&&n.send(u.buffer.toString("base64")),a=i.event,l={send:o,onMessage:a};this._client=new QE(l);const c=()=>this.disposeClient();process.once("exit",c),this.child.on("error",u=>console.warn('IPC "'+this.options.serverName+'" errored with '+u)),this.child.on("exit",(u,d)=>{process.removeListener("exit",c),s.dispose(),this.activeRequests.forEach(f=>Cr(f)),this.activeRequests.clear(),u!==0&&d!=="SIGTERM"&&console.warn('IPC "'+this.options.serverName+'" crashed with exit code '+u+" and signal "+d),this.disposeDelayer?.cancel(),this.disposeClient(),this._onDidProcessExit.fire({code:u,signal:d})})}return this._client}getCachedChannel(e){let t=this.channels.get(e);return t||(t=this.client.getChannel(e),this.channels.set(e,t)),t}disposeClient(){this._client&&(this.child&&(this.child.kill(),this.child=null),this._client=null,this.channels.clear())}dispose(){this._onDidProcessExit.dispose(),this.disposeDelayer?.cancel(),this.disposeDelayer=void 0,this.disposeClient(),this.activeRequests.clear()}},$Q=class extends Hq{constructor(e,t,i){super(e,t,i),this.init()}createWatcher(e){const t=e.add(new FQ(Mv.asFileUri("bootstrap-fork").fsPath,{serverName:"File Watcher",args:["--type=fileWatcher"],env:{VSCODE_ESM_ENTRYPOINT:"vs/platform/files/node/watcher/watcherMain",VSCODE_PIPE_LOGGING:"true",VSCODE_VERBOSE_LOGGING:"true"}}));return e.add(t.onDidProcessExit(({code:i,signal:r})=>this.onError(`terminated by itself with code ${i}, signal: ${r} (ETERM)`))),Jv.toService(BN(t.getChannel("watcher")))}};import{watchFile as HQ,unwatchFile as UQ}from"fs";var WQ=class extends X{constructor(){super(),this._onDidChangeFile=this._register(new D),this.onDidChangeFile=this._onDidChangeFile.event,this._onDidLogMessage=this._register(new D),this.onDidLogMessage=this._onDidLogMessage.event,this._onDidWatchFail=this._register(new D),this.onDidWatchFail=this._onDidWatchFail.event,this.correlatedWatchRequests=new Map,this.nonCorrelatedWatchRequests=new Map,this.suspendedWatchRequests=this._register(new fc),this.suspendedWatchRequestsWithPolling=new Set,this.updateWatchersDelayer=this._register(new yh(this.getUpdateWatchersDelay())),this.suspendedWatchRequestPollingInterval=5007,this.joinWatch=new hr,this.verboseLogging=!1,this._register(this.onDidWatchFail(e=>this.suspendWatchRequest({id:this.computeId(e),correlationId:this.isCorrelated(e)?e.correlationId:void 0,path:e.path})))}isCorrelated(e){return yA(e)}computeId(e){return this.isCorrelated(e)?e.correlationId:Rs(e)}async watch(e){this.joinWatch.isSettled||this.joinWatch.complete(),this.joinWatch=new hr;try{this.correlatedWatchRequests.clear(),this.nonCorrelatedWatchRequests.clear();for(const t of e)this.isCorrelated(t)?this.correlatedWatchRequests.set(t.correlationId,t):this.nonCorrelatedWatchRequests.set(this.computeId(t),t);for(const[t]of this.suspendedWatchRequests)!this.nonCorrelatedWatchRequests.has(t)&&!this.correlatedWatchRequests.has(t)&&(this.suspendedWatchRequests.deleteAndDispose(t),this.suspendedWatchRequestsWithPolling.delete(t));return await this.updateWatchers(!1)}finally{this.joinWatch.complete()}}updateWatchers(e){const t=[];for(const[i,r]of[...this.nonCorrelatedWatchRequests,...this.correlatedWatchRequests])this.suspendedWatchRequests.has(i)||t.push(r);return this.updateWatchersDelayer.trigger(()=>this.doWatch(t),e?this.getUpdateWatchersDelay():0).catch(i=>pt(i))}getUpdateWatchersDelay(){return 800}isSuspended(e){const t=this.computeId(e);return this.suspendedWatchRequestsWithPolling.has(t)?"polling":this.suspendedWatchRequests.has(t)}async suspendWatchRequest(e){if(this.suspendedWatchRequests.has(e.id))return;const t=new oe;this.suspendedWatchRequests.set(e.id,t),await this.joinWatch.p,!t.isDisposed&&(this.monitorSuspendedWatchRequest(e,t),this.updateWatchers(!0))}resumeWatchRequest(e){this.suspendedWatchRequests.deleteAndDispose(e.id),this.suspendedWatchRequestsWithPolling.delete(e.id),this.updateWatchers(!1)}monitorSuspendedWatchRequest(e,t){this.doMonitorWithExistingWatcher(e,t)?(this.trace(`reusing an existing recursive watcher to monitor ${e.path}`),this.suspendedWatchRequestsWithPolling.delete(e.id)):(this.doMonitorWithNodeJS(e,t),this.suspendedWatchRequestsWithPolling.add(e.id))}doMonitorWithExistingWatcher(e,t){const i=this.recursiveWatcher?.subscribe(e.path,(r,s)=>{t.isDisposed||(r?this.monitorSuspendedWatchRequest(e,t):s?.type===1&&this.onMonitoredPathAdded(e))});return i?(t.add(i),!0):!1}doMonitorWithNodeJS(e,t){let i=!1;const r=(s,n)=>{if(t.isDisposed)return;const o=this.isPathNotFound(s),a=this.isPathNotFound(n),l=i;i=o,!o&&(a||l)&&this.onMonitoredPathAdded(e)};this.trace(`starting fs.watchFile() on ${e.path} (correlationId: ${e.correlationId})`);try{HQ(e.path,{persistent:!1,interval:this.suspendedWatchRequestPollingInterval},r)}catch(s){this.warn(`fs.watchFile() failed with error ${s} on path ${e.path} (correlationId: ${e.correlationId})`)}t.add(ie(()=>{this.trace(`stopping fs.watchFile() on ${e.path} (correlationId: ${e.correlationId})`);try{UQ(e.path,r)}catch(s){this.warn(`fs.unwatchFile() failed with error ${s} on path ${e.path} (correlationId: ${e.correlationId})`)}}))}onMonitoredPathAdded(e){this.trace(`detected ${e.path} exists again, resuming watcher (correlationId: ${e.correlationId})`);const t={resource:b.file(e.path),type:1,cId:e.correlationId};this._onDidChangeFile.fire([t]),this.traceEvent(t,e),this.resumeWatchRequest(e)}isPathNotFound(e){return e.ctimeMs===0&&e.ino===0}async stop(){this.suspendedWatchRequests.clearAndDisposeAll(),this.suspendedWatchRequestsWithPolling.clear()}traceEvent(e,t){if(this.verboseLogging){const i=` >> normalized ${e.type===1?"[ADDED]":e.type===2?"[DELETED]":"[CHANGED]"} ${e.resource.fsPath}`;this.traceWithCorrelation(i,t)}}traceWithCorrelation(e,t){this.verboseLogging&&this.trace(`${e}${typeof t.correlationId=="number"?` <${t.correlationId}> `:""}`)}requestToString(e){return`${e.path} (excludes: ${e.excludes.length>0?e.excludes:"<none>"}, includes: ${e.includes&&e.includes.length>0?JSON.stringify(e.includes):"<all>"}, filter: ${Vq(e.filter)}, correlationId: ${typeof e.correlationId=="number"?e.correlationId:"<none>"})`}async setVerboseLogging(e){this.verboseLogging=e}};import{watch as BQ,promises as VQ}from"fs";var zQ=class rv extends X{static{this.FILE_DELETE_HANDLER_DELAY=100}static{this.FILE_CHANGES_HANDLER_DELAY=75}get isReusingRecursiveWatcher(){return this._isReusingRecursiveWatcher}get failed(){return this.didFail}constructor(t,i,r,s,n,o){super(),this.request=t,this.recursiveWatcher=i,this.onDidFilesChange=r,this.onDidWatchFail=s,this.onLogMessage=n,this.verboseLogging=o,this.throttledFileChangesEmitter=this._register(new SE({maxWorkChunkSize:100,throttleDelay:200,maxBufferedWork:1e4},a=>this.onDidFilesChange(a))),this.fileChangesAggregator=this._register(new j3(a=>this.handleFileChanges(a),rv.FILE_CHANGES_HANDLER_DELAY)),this.cts=new rt,this.realPath=new Si(async()=>{let a=this.request.path;try{a=await $E(this.request.path),this.request.path!==a&&this.trace(`correcting a path to watch that seems to be a symbolic link (original: ${this.request.path}, real: ${a})`)}catch{}return a}),this._isReusingRecursiveWatcher=!1,this.didFail=!1,this.excludes=EA(this.request.path,this.request.excludes),this.includes=this.request.includes?EA(this.request.path,this.request.includes):void 0,this.filter=yA(this.request)?this.request.filter:void 0,this.ready=this.watch()}async watch(){try{const t=await VQ.stat(this.request.path);if(this.cts.token.isCancellationRequested)return;this._register(await this.doWatch(t.isDirectory()))}catch(t){t.code!=="ENOENT"?this.error(t):this.trace(`ignoring a path for watching who's stat info failed to resolve: ${this.request.path} (error: ${t})`),this.notifyWatchFailed()}}notifyWatchFailed(){this.didFail=!0,this.onDidWatchFail?.()}async doWatch(t){const i=new oe;return this.doWatchWithExistingWatcher(t,i)?(this.trace(`reusing an existing recursive watcher for ${this.request.path}`),this._isReusingRecursiveWatcher=!0):(this._isReusingRecursiveWatcher=!1,await this.doWatchWithNodeJS(t,i)),i}doWatchWithExistingWatcher(t,i){if(t)return!1;const r=b.file(this.request.path),s=this.recursiveWatcher?.subscribe(this.request.path,async(n,o)=>{if(!i.isDisposed)if(n){const a=await this.doWatch(t);i.isDisposed?a.dispose():i.add(a)}else o&&(typeof o.cId=="number"||typeof this.request.correlationId=="number")&&this.onFileChange({resource:r,type:o.type,cId:this.request.correlationId},!0)});return s?(i.add(s),!0):!1}async doWatchWithNodeJS(t,i){const r=await this.realPath.value;if(this.cts.token.isCancellationRequested)return;if(Mt&&ao(r,"/Volumes/",!0)){this.error(`Refusing to watch ${r} for changes using fs.watch() for possibly being a network share where watching is unreliable and unstable.`);return}const s=new rt(this.cts.token);i.add(ie(()=>s.dispose(!0)));const n=new oe;i.add(n);try{const o=b.file(this.request.path),a=bt(r),l=BQ(r);n.add(ie(()=>{l.removeAllListeners(),l.close()})),this.trace(`Started watching: '${r}'`);const c=new Set;if(t)try{for(const d of await dt.readdir(r))c.add(d)}catch(d){this.error(d)}if(s.token.isCancellationRequested)return;const u=new Map;n.add(ie(()=>{for(const[,d]of u)d.dispose();u.clear()})),l.on("error",(d,f)=>{s.token.isCancellationRequested||(this.error(`Failed to watch ${r} for changes using fs.watch() (${d}, ${f})`),this.notifyWatchFailed())}),l.on("change",(d,f)=>{if(s.token.isCancellationRequested)return;this.verboseLogging&&this.traceWithCorrelation(`[raw] ["${d}"] ${f}`);let p="";if(f&&(p=f.toString(),Mt&&(p=Ph(p))),!(!p||d!=="change"&&d!=="rename"))if(t)if(d==="rename"){u.get(p)?.dispose();const g=setTimeout(async()=>{if(u.delete(p),gh(p,a,!Ct)&&!await dt.exists(r)){this.onWatchedPathDeleted(o);return}if(s.token.isCancellationRequested)return;const v=await this.existsChildStrictCase(Xe(r,p));if(s.token.isCancellationRequested)return;let y;v?c.has(p)?y=0:(y=1,c.add(p)):(c.delete(p),y=2),this.onFileChange({resource:Dt(o,p),type:y,cId:this.request.correlationId})},rv.FILE_DELETE_HANDLER_DELAY);u.set(p,ie(()=>clearTimeout(g)))}else{let g;c.has(p)?g=0:(g=1,c.add(p)),this.onFileChange({resource:Dt(o,p),type:g,cId:this.request.correlationId})}else if(d==="rename"||!gh(p,a,!Ct)){const g=setTimeout(async()=>{const v=await dt.exists(r);s.token.isCancellationRequested||(v?(this.onFileChange({resource:o,type:0,cId:this.request.correlationId},!0),n.add(await this.doWatch(!1))):this.onWatchedPathDeleted(o))},rv.FILE_DELETE_HANDLER_DELAY);n.clear(),n.add(ie(()=>clearTimeout(g)))}else this.onFileChange({resource:o,type:0,cId:this.request.correlationId},!0)})}catch(o){if(s.token.isCancellationRequested)return;this.error(`Failed to watch ${r} for changes using fs.watch() (${o.toString()})`),this.notifyWatchFailed()}}onWatchedPathDeleted(t){this.warn("Watcher shutdown because watched path got deleted"),this.onFileChange({resource:t,type:2,cId:this.request.correlationId},!0),this.fileChangesAggregator.flush(),this.notifyWatchFailed()}onFileChange(t,i=!1){this.cts.token.isCancellationRequested||(this.verboseLogging&&this.traceWithCorrelation(`${t.type===1?"[ADDED]":t.type===2?"[DELETED]":"[CHANGED]"} ${t.resource.fsPath}`),!i&&this.excludes.some(r=>r(t.resource.fsPath))?this.verboseLogging&&this.traceWithCorrelation(` >> ignored (excluded) ${t.resource.fsPath}`):!i&&this.includes&&this.includes.length>0&&!this.includes.some(r=>r(t.resource.fsPath))?this.verboseLogging&&this.traceWithCorrelation(` >> ignored (not included) ${t.resource.fsPath}`):this.fileChangesAggregator.work(t))}handleFileChanges(t){const i=Uq(t),r=[];for(const n of i){if(Bq(n,this.filter)){this.verboseLogging&&this.traceWithCorrelation(` >> ignored (filtered) ${n.resource.fsPath}`);continue}r.push(n)}if(r.length===0)return;if(this.verboseLogging)for(const n of r)this.traceWithCorrelation(` >> normalized ${n.type===1?"[ADDED]":n.type===2?"[DELETED]":"[CHANGED]"} ${n.resource.fsPath}`);this.throttledFileChangesEmitter.work(r)?this.throttledFileChangesEmitter.pending>0&&this.trace(`started throttling events due to large amount of file change events at once (pending: ${this.throttledFileChangesEmitter.pending}, most recent change: ${r[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`):this.warn(`started ignoring events due to too many file change events at once (incoming: ${r.length}, most recent change: ${r[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`)}async existsChildStrictCase(t){if(Ct)return dt.exists(t);try{const i=bt(t);return(await dt.readdir(Bi(t))).some(s=>s===i)}catch(i){return this.trace(i),!1}}setVerboseLogging(t){this.verboseLogging=t}error(t){this.cts.token.isCancellationRequested||this.onLogMessage?.({type:"error",message:`[File Watcher (node.js)] ${t}`})}warn(t){this.cts.token.isCancellationRequested||this.onLogMessage?.({type:"warn",message:`[File Watcher (node.js)] ${t}`})}trace(t){!this.cts.token.isCancellationRequested&&this.verboseLogging&&this.onLogMessage?.({type:"trace",message:`[File Watcher (node.js)] ${t}`})}traceWithCorrelation(t){!this.cts.token.isCancellationRequested&&this.verboseLogging&&this.trace(`${t}${typeof this.request.correlationId=="number"?` <${this.request.correlationId}> `:""}`)}dispose(){this.cts.dispose(!0),super.dispose()}},qQ=class extends WQ{get watchers(){return this._watchers.values()}constructor(e){super(),this.recursiveWatcher=e,this.onDidError=Fe.None,this._watchers=new Map,this.worker=this._register(new Kr)}async doWatch(e){e=this.removeDuplicateRequests(e);const t=[],i=new Set(Array.from(this.watchers));for(const r of e){const s=this._watchers.get(this.requestToWatcherKey(r));s&&yI(s.request.excludes,r.excludes)&&yI(s.request.includes,r.includes)?i.delete(s):t.push(r)}t.length&&this.trace(`Request to start watching: ${t.map(r=>this.requestToString(r)).join(",")}`),i.size&&this.trace(`Request to stop watching: ${Array.from(i).map(r=>this.requestToString(r.request)).join(",")}`),this.worker.clear();for(const r of i)this.stopWatching(r);this.createWatchWorker().work(t)}createWatchWorker(){return this.worker.value=new SE({maxWorkChunkSize:100,throttleDelay:100,maxBufferedWork:Number.MAX_VALUE},e=>{for(const t of e)this.startWatching(t)}),this.worker.value}requestToWatcherKey(e){return typeof e.correlationId=="number"?e.correlationId:this.pathToWatcherKey(e.path)}pathToWatcherKey(e){return Ct?e:e.toLowerCase()}startWatching(e){const t=new zQ(e,this.recursiveWatcher,r=>this._onDidChangeFile.fire(r),()=>this._onDidWatchFail.fire(e),r=>this._onDidLogMessage.fire(r),this.verboseLogging),i={request:e,instance:t};this._watchers.set(this.requestToWatcherKey(e),i)}async stop(){await super.stop();for(const e of this.watchers)this.stopWatching(e)}stopWatching(e){this.trace("stopping file watcher",e),this._watchers.delete(this.requestToWatcherKey(e.request)),e.instance.dispose()}removeDuplicateRequests(e){const t=new Map;for(const i of e){let r=t.get(i.correlationId);r||(r=new Map,t.set(i.correlationId,r));const s=this.pathToWatcherKey(i.path);r.has(s)&&this.trace(`ignoring a request for watching who's path is already watched: ${this.requestToString(i)}`),r.set(s,i)}return Array.from(t.values()).map(i=>Array.from(i.values())).flat()}async setVerboseLogging(e){super.setVerboseLogging(e);for(const t of this.watchers)t.instance.setVerboseLogging(e)}trace(e,t){this.verboseLogging&&this._onDidLogMessage.fire({type:"trace",message:this.toMessage(e,t)})}warn(e){this._onDidLogMessage.fire({type:"warn",message:this.toMessage(e)})}toMessage(e,t){return t?`[File Watcher (node.js)] ${e} (${this.requestToString(t.request)})`:`[File Watcher (node.js)] ${e}`}},jQ=class extends $q{constructor(e,t,i){super(e,t,i),this.init()}createWatcher(e){return e.add(new qQ(void 0))}},GQ=class Gd extends AQ{static{this.TRACE_LOG_RESOURCE_LOCKS=!1}constructor(t,i){super(t,i),this.onDidChangeCapabilities=Fe.None,this.resourceLocks=new Vt(r=>Ov.getComparisonKey(r)),this.mapHandleToPos=new Map,this.mapHandleToLock=new Map,this.writeHandles=new Map}get capabilities(){return this._capabilities||(this._capabilities=253982,Ct&&(this._capabilities|=1024)),this._capabilities}async stat(t){try{const{stat:i,symbolicLink:r}=await xi.stat(this.toFilePath(t));return{type:this.toType(i,r),ctime:i.birthtime.getTime(),mtime:i.mtime.getTime(),size:i.size,permissions:(i.mode&128)===0?En.Locked:void 0}}catch(i){throw this.toFileSystemProviderError(i)}}async statIgnoreError(t){try{return await this.stat(t)}catch{return}}async readdir(t){try{const i=await dt.readdir(this.toFilePath(t),{withFileTypes:!0}),r=[];return await Promise.all(i.map(async s=>{try{let n;s.isSymbolicLink()?n=(await this.stat(Dt(t,s.name))).type:n=this.toType(s),r.push([s.name,n])}catch(n){this.logService.trace(n)}})),r}catch(i){throw this.toFileSystemProviderError(i)}}toType(t,i){let r;return i?.dangling?r=qi.Unknown:t.isFile()?r=qi.File:t.isDirectory()?r=qi.Directory:r=qi.Unknown,i&&(r|=qi.SymbolicLink),r}async createResourceLock(t){const i=this.toFilePath(t);this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - request to acquire resource lock (${i})`);let r;for(;r=this.resourceLocks.get(t);)this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - waiting for resource lock to be released (${i})`),await r.wait();const s=new dr;return this.resourceLocks.set(t,s),this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - new resource lock created (${i})`),ie(()=>{this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock dispose() (${i})`),this.resourceLocks.get(t)===s&&(this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock removed from resource-lock map (${i})`),this.resourceLocks.delete(t)),this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock barrier open() (${i})`),s.open()})}async readFile(t,i){let r;try{i?.atomic&&(this.traceLock(`[Disk FileSystemProvider]: atomic read operation started (${this.toFilePath(t)})`),r=await this.createResourceLock(t));const s=this.toFilePath(t);return await la.readFile(s)}catch(s){throw this.toFileSystemProviderError(s)}finally{r?.dispose()}}traceLock(t){Gd.TRACE_LOG_RESOURCE_LOCKS&&this.logService.trace(t)}readFileStream(t,i,r){const s=Sh(n=>z.concat(n.map(o=>z.wrap(o))).buffer);return IQ(this,t,s,n=>n.buffer,{...i,bufferSize:256*1024},r),s}async writeFile(t,i,r){return r?.atomic!==!1&&r?.atomic?.postfix&&await this.canWriteFileAtomic(t)?this.doWriteFileAtomic(t,Dt(bc(t),`${ir(t)}${r.atomic.postfix}`),i,r):this.doWriteFile(t,i,r)}async canWriteFileAtomic(t){try{const i=this.toFilePath(t),{symbolicLink:r}=await xi.stat(i);if(r)return!1}catch{}return!0}async doWriteFileAtomic(t,i,r,s){const n=new oe;try{n.add(await this.createResourceLock(t)),n.add(await this.createResourceLock(i)),await this.doWriteFile(i,r,s,!0);try{await this.rename(i,t,{overwrite:!0})}catch(o){try{await this.delete(i,{recursive:!1,useTrash:!1,atomic:!1})}catch{}throw o}}finally{n.dispose()}}async doWriteFile(t,i,r,s){let n;try{const o=this.toFilePath(t);if(!r.create||!r.overwrite){if(await dt.exists(o)){if(!r.overwrite)throw Os(h(2079,null),de.FileExists)}else if(!r.create)throw Os(h(2080,null),de.FileNotFound)}n=await this.open(t,{create:!0,unlock:r.unlock},s),await this.write(n,0,i,0,i.byteLength)}catch(o){throw await this.toFileSystemProviderWriteError(t,o)}finally{typeof n=="number"&&await this.close(n)}}static{this.canFlush=!0}static configureFlushOnWrite(t){Gd.canFlush=t}async open(t,i,r){const s=this.toFilePath(t);let n;Ua(i)&&!r&&(n=await this.createResourceLock(t));let o;try{if(Ua(i)&&i.unlock)try{const{stat:a}=await xi.stat(s);a.mode&128||await la.chmod(s,a.mode|128)}catch(a){a.code!=="ENOENT"&&this.logService.trace(a)}if(Ve&&Ua(i))try{o=await dt.open(s,"r+"),await dt.ftruncate(o,0)}catch(a){if(a.code!=="ENOENT"&&this.logService.trace(a),typeof o=="number"){try{await dt.close(o)}catch(l){this.logService.trace(l)}o=void 0}}typeof o!="number"&&(o=await dt.open(s,Ua(i)?"w":"r"))}catch(a){throw n?.dispose(),Ua(i)?await this.toFileSystemProviderWriteError(t,a):this.toFileSystemProviderError(a)}if(this.mapHandleToPos.set(o,0),Ua(i)&&this.writeHandles.set(o,t),n){const a=this.mapHandleToLock.get(o);this.traceLock(`[Disk FileSystemProvider]: open() - storing lock for handle ${o} (${s})`),this.mapHandleToLock.set(o,n),a&&(this.traceLock(`[Disk FileSystemProvider]: open() - disposing a previous lock that was still stored on same handle ${o} (${s})`),a.dispose())}return o}async close(t){const i=this.mapHandleToLock.get(t);try{if(this.mapHandleToPos.delete(t),this.writeHandles.delete(t)&&Gd.canFlush)try{await dt.fdatasync(t)}catch(r){Gd.configureFlushOnWrite(!1),this.logService.error(r)}return await dt.close(t)}catch(r){throw this.toFileSystemProviderError(r)}finally{i&&(this.mapHandleToLock.get(t)===i&&(this.traceLock(`[Disk FileSystemProvider]: close() - resource lock removed from handle-lock map ${t}`),this.mapHandleToLock.delete(t)),this.traceLock(`[Disk FileSystemProvider]: close() - disposing lock for handle ${t}`),i.dispose())}}async read(t,i,r,s,n){const o=this.normalizePos(t,i);let a=null;try{a=(await dt.read(t,r,s,n,o)).bytesRead}catch(l){throw this.toFileSystemProviderError(l)}finally{this.updatePos(t,o,a)}return a}normalizePos(t,i){return i===this.mapHandleToPos.get(t)?null:i}updatePos(t,i,r){const s=this.mapHandleToPos.get(t);typeof s=="number"&&(typeof i=="number"||(typeof r=="number"?this.mapHandleToPos.set(t,s+r):this.mapHandleToPos.delete(t)))}async write(t,i,r,s,n){return J3(()=>this.doWrite(t,i,r,s,n),100,3)}async doWrite(t,i,r,s,n){const o=this.normalizePos(t,i);let a=null;try{a=(await dt.write(t,r,s,n,o)).bytesWritten}catch(l){throw await this.toFileSystemProviderWriteError(this.writeHandles.get(t),l)}finally{this.updatePos(t,o,a)}return a}async mkdir(t){try{await la.mkdir(this.toFilePath(t))}catch(i){throw this.toFileSystemProviderError(i)}}async delete(t,i){try{const r=this.toFilePath(t);if(i.recursive){let s;i?.atomic!==!1&&i.atomic.postfix&&(s=Xe(Bi(r),`${bt(r)}${i.atomic.postfix}`)),await dt.rm(r,co.MOVE,s)}else try{await la.unlink(r)}catch(s){if(s.code==="EPERM"||s.code==="EISDIR"){let n=!1;try{const{stat:o,symbolicLink:a}=await xi.stat(r);n=o.isDirectory()&&!a}catch{}if(n)await la.rmdir(r);else throw s}else throw s}}catch(r){throw this.toFileSystemProviderError(r)}}async rename(t,i,r){const s=this.toFilePath(t),n=this.toFilePath(i);if(s!==n)try{await this.validateMoveCopy(t,i,"move",r.overwrite),await dt.rename(s,n)}catch(o){throw(o.code==="EINVAL"||o.code==="EBUSY"||o.code==="ENAMETOOLONG")&&(o=new Error(h(2081,null,bt(s),bt(Bi(n)),o.toString()))),this.toFileSystemProviderError(o)}}async copy(t,i,r){const s=this.toFilePath(t),n=this.toFilePath(i);if(s!==n)try{await this.validateMoveCopy(t,i,"copy",r.overwrite),await dt.copy(s,n,{preserveSymlinks:!0})}catch(o){throw(o.code==="EINVAL"||o.code==="EBUSY"||o.code==="ENAMETOOLONG")&&(o=new Error(h(2082,null,bt(s),bt(Bi(n)),o.toString()))),this.toFileSystemProviderError(o)}}async validateMoveCopy(t,i,r,s){const n=this.toFilePath(t),o=this.toFilePath(i);let a=!1;if(!!(this.capabilities&1024)||(a=gh(n,o,!0)),a){if(r==="copy")throw Os(h(2083,null),de.FileExists);if(r==="move")return}const c=await this.statIgnoreError(t);if(!c)throw Os(h(2084,null),de.FileNotFound);const u=await this.statIgnoreError(i);if(u){if(!s)throw Os(h(2085,null),de.FileExists);(c.type&qi.File)!==0&&(u.type&qi.File)!==0||await this.delete(i,{recursive:!0,useTrash:!1,atomic:!1})}}async cloneFile(t,i){return this.doCloneFile(t,i,!1)}async doCloneFile(t,i,r){const s=this.toFilePath(t),n=this.toFilePath(i),o=!!(this.capabilities&1024);if(gh(s,n,!o))return;const a=new oe;try{a.add(await this.createResourceLock(t)),a.add(await this.createResourceLock(i)),r&&await la.mkdir(Bi(n),{recursive:!0}),await la.copyFile(s,n)}catch(l){if(l.code==="ENOENT"&&!r)return this.doCloneFile(t,i,!0);throw this.toFileSystemProviderError(l)}finally{a.dispose()}}createUniversalWatcher(t,i,r){return new $Q(s=>t(s),s=>i(s),r)}createNonRecursiveWatcher(t,i,r){return new jQ(s=>t(s),s=>i(s),r)}toFileSystemProviderError(t){if(t instanceof Yh)return t;let i=t,r;switch(t.code){case"ENOENT":r=de.FileNotFound;break;case"EISDIR":r=de.FileIsADirectory;break;case"ENOTDIR":r=de.FileNotADirectory;break;case"EEXIST":r=de.FileExists;break;case"EPERM":case"EACCES":r=de.NoPermissions;break;case"ERR_UNC_HOST_NOT_ALLOWED":i=`${t.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`,r=de.Unknown;break;default:r=de.Unknown}return Os(i,r)}async toFileSystemProviderWriteError(t,i){let r=this.toFileSystemProviderError(i);if(t&&r.code===de.NoPermissions)try{const{stat:s}=await xi.stat(this.toFilePath(t));s.mode&128||(r=Os(i,de.FileWriteLocked))}catch(s){this.logService.trace(s)}return r}},eS=class{constructor(t,i){t.addFileSystemProvider(V.file,new QQ(i),{isCaseSensitive:Ct})}};eS=__decorate([__param(0,td),__param(1,ke)],eS);var QQ=class{constructor(e){this.impl=new GQ(e)}async stat(e){const t=await this.impl.stat(e);return{type:t.type,ctime:t.ctime,mtime:t.mtime,size:t.size,permissions:t.permissions===En.Readonly?1:void 0}}readDirectory(e){return this.impl.readdir(e)}createDirectory(e){return this.impl.mkdir(e)}readFile(e){return this.impl.readFile(e)}writeFile(e,t,i){return this.impl.writeFile(e,t,{...i,unlock:!1,atomic:!1})}delete(e,t){return this.impl.delete(e,{...t,useTrash:!1,atomic:!1})}rename(e,t,i){return this.impl.rename(e,t,i)}copy(e,t,i){return this.impl.copy(e,t,i)}get onDidChangeFile(){throw new Error("Method not implemented.")}watch(e,t){throw new Error("Method not implemented.")}};import Z7 from"node:module";var e9=Z7.createRequire(import.meta.url),JQ=class extends Rm{_installInterceptor(){const e=this,t=e9("module"),i=t._load;t._load=function(l,c,u){return l=o(l),e._factories.has(l)?e._factories.get(l).load(l,b.file(NN(c.filename)),d=>i.apply(this,[d,c,u])):i.apply(this,arguments)};const r=t._resolveLookupPaths;t._resolveLookupPaths=(a,l)=>r.call(this,o(a),l);const s=t._resolveFilename;t._resolveFilename=function(l,c,u,d){return l==="vsda"?(console.log("[Extension Validation Bypass] Intercepting vsda module resolution"),"__mock_vsda_module__"):(l==="vsda"&&Array.isArray(d?.paths)&&d.paths.length===0&&(d.paths=t._nodeModulePaths(import.meta.dirname)),s.call(this,l,c,u,d))};const n=t._load;t._load=function(a,l,c){return a==="__mock_vsda_module__"||a==="vsda"?(console.log("[Extension Validation Bypass] Providing mock vsda module with signer and validator"),{signer:{sign:()=>Promise.resolve("mock_signature"),verify:()=>Promise.resolve(!0)},validator:{validate:()=>Promise.resolve(!0),check:()=>!0}}):n.call(this,a,l,c)};const o=a=>{for(const l of e._alternatives){const c=l(a);if(c){a=c;break}}return a}}},KQ=class sc extends Rm{constructor(){super(...arguments),this._store=new oe}static _createDataUri(t){return`data:text/javascript;base64,${Buffer.from(t).toString("base64")}`}static{this._loaderScript=`
	let lookup;
	export const initialize = async (context) => {
		let requestIds = 0;
		const { port } = context;
		const pendingRequests = new Map();
		port.onmessage = (event) => {
			const { id, url } = event.data;
			pendingRequests.get(id)?.(url);
		};
		lookup = url => {
			// debugger;
			const myId = requestIds++;
			return new Promise((resolve) => {
				pendingRequests.set(myId, resolve);
				port.postMessage({ id: myId, url, });
			});
		};
	};
	export const resolve = async (specifier, context, nextResolve) => {
		if (specifier !== 'vscode' || !context.parentURL) {
			return nextResolve(specifier, context);
		}
		const otherUrl = await lookup(context.parentURL);
		return {
			url: otherUrl,
			shortCircuit: true,
		};
	};`}static{this._vscodeImportFnName="_VSCODE_IMPORT_VSCODE_API"}dispose(){this._store.dispose()}_installInterceptor(){const t=new KR,i=new Map;Object.defineProperty(globalThis,sc._vscodeImportFnName,{enumerable:!1,configurable:!1,writable:!1,value:a=>t.getKey(a)});const{port1:r,port2:s}=new MessageChannel;let n;const o=r;o.onmessage=a=>{n||(n=this._factories.get("vscode"),vv(n));const{id:l,url:c}=a.data,u=b.parse(c),d=n.load("_not_used",u,()=>{throw new Error("CANNOT LOAD MODULE from here.")});let f=t.get(d);f||(f=mt(),t.set(d,f));let p=i.get(f);if(!p){const g=`const _vscodeInstance = globalThis.${sc._vscodeImportFnName}('${f}');

${Object.keys(d).map(v=>`export const ${v} = _vscodeInstance['${v}'];`).join(`
`)}`;p=sc._createDataUri(g),i.set(f,p)}r.postMessage({id:l,url:p})},Z7.register(sc._createDataUri(sc._loaderScript),{parentURL:import.meta.url,data:{port:s},transferList:[s]}),this._store.add(ie(()=>{r.close(),s.close()}))}},XQ=class extends fy{constructor(){super(...arguments),this.extensionRuntime=mp.Node}async _beforeAlmostReadyToRunExtensions(){this._instaService.createInstance(Yb);const e=this._instaService.invokeFunction($G);if(this._instaService.createInstance(Jb),this._initData.remote.isRemote&&this._initData.remote.authority){const i=this._instaService.createInstance(Kb);process.env.VSCODE_IPC_HOOK_CLI=i.ipcHandlePath}this._instaService.createInstance(eS),await this._instaService.createInstance(JQ,e,{mine:this._myRegistry,all:this._globalRegistry}).install(),await this._store.add(this._instaService.createInstance(KQ,e,{mine:this._myRegistry,all:this._globalRegistry})).install(),Pt("code/extHost/didInitAPI");const t=await this._extHostConfiguration.getConfigProvider();await dQ(this._extHostWorkspace,t,this,this._logService,this._mainThreadTelemetryProxy,this._initData,this._store),Pt("code/extHost/didInitProxyResolver")}_getEntryPoint(e){return e.main}async _doLoadModule(e,t,i,r){if(t.scheme!==V.file)throw new Error(`Cannot load URI: '${t}', must be of file-scheme`);let s=null;i.codeLoadingStart(),this._logService.trace(`ExtensionService#loadModule [${r}] -> ${t.toString(!0)}`),this._logService.flush();const n=e?.identifier.value;e&&await this._extHostLocalizationService.initializeLocalizedMessages(e);try{n&&Pt(`code/extHost/willLoadExtensionCode/${n}`),r==="esm"?s=await import(t.toString(!0)):s=e9(t.fsPath)}finally{n&&Pt(`code/extHost/didLoadExtensionCode/${n}`),i.codeLoadingStop()}return s}async _loadCommonJSModule(e,t,i){return this._doLoadModule(e,t,i,"cjs")}async _loadESMModule(e,t,i){return this._doLoadModule(e,t,i,"esm")}async $setRemoteEnvironment(e){if(this._initData.remote.isRemote)for(const t in e){const i=e[t];i===null?delete process.env[t]:process.env[t]=i}}};import*as Ld from"fs";import{exec as t9}from"child_process";var YQ=(e,t,i)=>{const r=new Uint8Array(16);for(let o=0;o<16;o++)r[o]=Math.round(Math.random()*256);const s=kh(z.wrap(r));return[`GET ws://localhost${e}?${t}&skipWebSocketFrames=true HTTP/1.1`,"Connection: Upgrade","Upgrade: websocket",`Sec-WebSocket-Key: ${s}`].join(`\r
`)+`\r
\r
`},i9=z.fromString(`\r
\r
`);async function ZQ(e,t,i,r,s){e.write(z.fromString(YQ(t,i,r)));const n=new oe;try{return await new Promise((o,a)=>{let l;n.add(e.onData(c=>{l?l=z.concat([l,c],l.byteLength+c.byteLength):l=c;const u=l.indexOf(i9);if(u===-1)return;o(e),e.pauseData();const d=l.slice(u+i9.byteLength);d.byteLength&&s.onData.fire(d)})),n.add(e.onClose(c=>a(c??new Error("socket closed")))),n.add(e.onEnd(()=>a(new Error("socket ended"))))})}catch(o){throw e.dispose(),o}finally{n.dispose()}}var eJ=class extends X{constructor(e,t){super(),this.debugLabel=e,this.pausableDataEmitter=this._register(new gc),this.onData=(...i)=>(this.pausableDataEmitter.isPaused&&queueMicrotask(()=>this.pausableDataEmitter.resume()),this.pausableDataEmitter.event(...i)),this.didDisposeEmitter=this._register(new D),this.onDidDispose=this.didDisposeEmitter.event,this.ended=!1,this._register(t.onData),this._register(t.onData.event(i=>this.pausableDataEmitter.fire(i))),this.onClose=this._register(t.onClose).event,this.onEnd=this._register(t.onEnd).event}pauseData(){this.pausableDataEmitter.pause()}drain(){return Promise.resolve()}end(){this.ended=!0,this.closeRemote()}traceSocketEvent(e,t){Rh.traceSocketEvent(this,this.debugLabel,e,t)}dispose(){this.ended||this.closeRemote(),this.didDisposeEmitter.fire(),super.dispose()}},tJ="signService",Nd=q(tJ);import*as iJ from"net";import*as rJ from"os";import*as sJ from"net";var r9={1:!0,7:!0,9:!0,11:!0,13:!0,15:!0,17:!0,19:!0,20:!0,21:!0,22:!0,23:!0,25:!0,37:!0,42:!0,43:!0,53:!0,69:!0,77:!0,79:!0,87:!0,95:!0,101:!0,102:!0,103:!0,104:!0,109:!0,110:!0,111:!0,113:!0,115:!0,117:!0,119:!0,123:!0,135:!0,137:!0,139:!0,143:!0,161:!0,179:!0,389:!0,427:!0,465:!0,512:!0,513:!0,514:!0,515:!0,526:!0,530:!0,531:!0,532:!0,540:!0,548:!0,554:!0,556:!0,563:!0,587:!0,601:!0,636:!0,989:!0,990:!0,993:!0,995:!0,1719:!0,1720:!0,1723:!0,2049:!0,3659:!0,4045:!0,5060:!0,5061:!0,6e3:!0,6566:!0,6665:!0,6666:!0,6667:!0,6668:!0,6669:!0,6697:!0,10080:!0};function nJ(e,t,i,r="127.0.0.1"){let s=!1,n,o=1;const a=sJ.createServer({pauseOnConnect:!0});function l(c,u){s||(s=!0,a.removeAllListeners(),a.close(),n&&clearTimeout(n),u(c))}return new Promise(c=>{n=setTimeout(()=>{l(0,c)},i),a.on("listening",()=>{l(e,c)}),a.on("error",u=>{u&&(u.code==="EADDRINUSE"||u.code==="EACCES")&&o<t?(e++,o++,a.listen(e,r)):l(0,c)}),a.on("close",()=>{l(0,c)}),a.listen(e,r)})}var oJ=30*1e3,s9;(function(e){e[e.Management=1]="Management",e[e.ExtensionHost=2]="ExtensionHost",e[e.Tunnel=3]="Tunnel"})(s9||(s9={}));function tS(e){switch(e){case 1:return"Management";case 2:return"ExtensionHost";case 3:return"Tunnel"}}function n9(e){const t=new rt;return setTimeout(()=>t.cancel(),e),t.token}function aJ(e,t){if(e.isCancellationRequested||t.isCancellationRequested)return Be.Cancelled;const i=new rt;return e.onCancellationRequested(()=>i.cancel()),t.onCancellationRequested(()=>i.cancel()),i.token}var iS=class{get didTimeout(){return this._state==="timedout"}constructor(e){this._state="pending",this._disposables=new oe,{promise:this.promise,resolve:this._resolvePromise,reject:this._rejectPromise}=vE(),e.isCancellationRequested?this._timeout():this._disposables.add(e.onCancellationRequested(()=>this._timeout()))}registerDisposable(e){this._state==="pending"?this._disposables.add(e):e.dispose()}_timeout(){this._state==="pending"&&(this._disposables.dispose(),this._state="timedout",this._rejectPromise(this._createTimeoutError()))}_createTimeoutError(){const e=new Error("Time limit reached");return e.code="ETIMEDOUT",e.syscall="connect",e}resolve(e){this._state==="pending"&&(this._disposables.dispose(),this._state="resolved",this._resolvePromise(e))}reject(e){this._state==="pending"&&(this._disposables.dispose(),this._state="rejected",this._rejectPromise(e))}};function lJ(e,t){const i=new iS(t);return i.registerDisposable(e.onControlMessage(r=>{const s=JSON.parse(r.toString()),n=_J(s);n?i.reject(n):i.resolve(s)})),i.promise}function cJ(e,t,i,r,s,n,o,a){const l=new iS(a),c=Hi.create(!1);return e.info(`Creating a socket (${o})...`),Pt(`code/willCreateSocket/${n}`),t.connect(i,r,s,o).then(u=>{l.didTimeout?(Pt(`code/didCreateSocketError/${n}`),e.info(`Creating a socket (${o}) finished after ${c.elapsed()} ms, but this is too late and has timed out already.`),u?.dispose()):(Pt(`code/didCreateSocketOK/${n}`),e.info(`Creating a socket (${o}) was successful after ${c.elapsed()} ms.`),l.resolve(u))},u=>{Pt(`code/didCreateSocketError/${n}`),e.info(`Creating a socket (${o}) returned an error after ${c.elapsed()} ms.`),e.error(u),l.reject(u)}),l.promise}function rS(e,t){const i=new iS(t);return e.then(r=>{i.didTimeout||i.resolve(r)},r=>{i.didTimeout||i.reject(r)}),i.promise}async function uJ(e,t,i,r){const s=u9(e,t);e.logService.trace(`${s} 1/6. invoking socketFactory.connect().`);let n;try{n=await cJ(e.logService,e.remoteSocketFactoryService,e.connectTo,lE.getServerRootPath(),`reconnectionToken=${e.reconnectionToken}&reconnection=${e.reconnectionProtocol?"true":"false"}`,tS(t),`renderer-${tS(t)}-${e.reconnectionToken}`,r)}catch(u){throw e.logService.error(`${s} socketFactory.connect() failed or timed out. Error:`),e.logService.error(u),u}e.logService.trace(`${s} 2/6. socketFactory.connect() was successful.`);let o,a;e.reconnectionProtocol?(e.reconnectionProtocol.beginAcceptReconnection(n,null),o=e.reconnectionProtocol,a=!1):(o=new Xv({socket:n}),a=!0),e.logService.trace(`${s} 3/6. sending AuthRequest control message.`);const l=await rS(e.signService.createNewMessage(mt()),r),c={type:"auth",auth:e.connectionToken||"00000000000000000000",data:l.data};o.sendControl(z.fromString(JSON.stringify(c)));try{const u=await lJ(o,aJ(r,n9(1e4)));if(u.type!=="sign"||typeof u.data!="string"){const g=new Error("Unexpected handshake message");throw g.code="VSCODE_CONNECTION_ERROR",g}if(e.logService.trace(`${s} 4/6. received SignRequest control message.`),!await rS(e.signService.validate(l,u.signedData),r)){const g=new Error("Refused to connect to unsupported server");throw g.code="VSCODE_CONNECTION_ERROR",g}const f=await rS(e.signService.sign(u.data),r),p={type:"connectionType",commit:e.commit,signedData:f,desiredConnectionType:t};return i&&(p.args=i),e.logService.trace(`${s} 5/6. sending ConnectionTypeRequest control message.`),o.sendControl(z.fromString(JSON.stringify(p))),{protocol:o,ownsProtocol:a}}catch(u){throw u&&u.code==="ETIMEDOUT"&&(e.logService.error(`${s} the handshake timed out. Error:`),e.logService.error(u)),u&&u.code==="VSCODE_CONNECTION_ERROR"&&(e.logService.error(`${s} received error control message when negotiating connection. Error:`),e.logService.error(u)),a&&c9(o),u}}async function dJ(e,t,i){const r=Date.now(),s=u9(e,3),{protocol:n}=await uJ(e,3,t,i);return e.logService.trace(`${s} 6/6. handshake finished, connection is up and running after ${bJ(r)}!`),n}async function o9(e,t,i){const{connectTo:r,connectionToken:s}=await e.addressProvider.getAddress();return{commit:e.commit,quality:e.quality,connectTo:r,connectionToken:s,reconnectionToken:t,reconnectionProtocol:i,remoteSocketFactoryService:e.remoteSocketFactoryService,signService:e.signService,logService:e.logService}}async function hJ(e,t,i){const r=await o9(e,mt(),null);return await dJ(r,{host:t,port:i},Be.None)}function fJ(e){return Ds(t=>new Promise((i,r)=>{const s=setTimeout(i,e*1e3);t.onCancellationRequested(()=>{clearTimeout(s),i()})}))}var a9;(function(e){e[e.ConnectionLost=0]="ConnectionLost",e[e.ReconnectionWait=1]="ReconnectionWait",e[e.ReconnectionRunning=2]="ReconnectionRunning",e[e.ReconnectionPermanentFailure=3]="ReconnectionPermanentFailure",e[e.ConnectionGain=4]="ConnectionGain"})(a9||(a9={}));var pJ=class{constructor(e,t){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.type=0}},gJ=class{constructor(e,t,i,r){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.durationSeconds=i,this.cancellableTimer=r,this.type=1}skipWait(){this.cancellableTimer.cancel()}},mJ=class{constructor(e,t,i){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.type=2}},l9=class{constructor(e,t,i){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.type=4}},vJ=class{constructor(e,t,i,r){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.handled=r,this.type=3}},Pne=class cn extends X{static triggerPermanentFailure(t,i,r){this._permanentFailure=!0,this._permanentFailureMillisSinceLastIncomingData=t,this._permanentFailureAttempt=i,this._permanentFailureHandled=r,this._instances.forEach(s=>s._gotoPermanentFailure(this._permanentFailureMillisSinceLastIncomingData,this._permanentFailureAttempt,this._permanentFailureHandled))}static debugTriggerReconnection(){this._instances.forEach(t=>t._beginReconnecting())}static debugPauseSocketWriting(){this._instances.forEach(t=>t._pauseSocketWriting())}static{this._permanentFailure=!1}static{this._permanentFailureMillisSinceLastIncomingData=0}static{this._permanentFailureAttempt=0}static{this._permanentFailureHandled=!1}static{this._instances=[]}get _isPermanentFailure(){return this._permanentFailure||cn._permanentFailure}constructor(t,i,r,s,n){super(),this._connectionType=t,this._options=i,this.reconnectionToken=r,this.protocol=s,this._reconnectionFailureIsFatal=n,this._onDidStateChange=this._register(new D),this.onDidStateChange=this._onDidStateChange.event,this._permanentFailure=!1,this._isReconnecting=!1,this._isDisposed=!1,this._onDidStateChange.fire(new l9(this.reconnectionToken,0,0)),this._register(s.onSocketClose(o=>{const a=Fm(this._connectionType,this.reconnectionToken,!0);o?o.type===0?(this._options.logService.info(`${a} received socket close event (hadError: ${o.hadError}).`),o.error&&this._options.logService.error(o.error)):(this._options.logService.info(`${a} received socket close event (wasClean: ${o.wasClean}, code: ${o.code}, reason: ${o.reason}).`),o.event&&this._options.logService.error(o.event)):this._options.logService.info(`${a} received socket close event.`),this._beginReconnecting()})),this._register(s.onSocketTimeout(o=>{const a=Fm(this._connectionType,this.reconnectionToken,!0);this._options.logService.info(`${a} received socket timeout event (unacknowledgedMsgCount: ${o.unacknowledgedMsgCount}, timeSinceOldestUnacknowledgedMsg: ${o.timeSinceOldestUnacknowledgedMsg}, timeSinceLastReceivedSomeData: ${o.timeSinceLastReceivedSomeData}).`),this._beginReconnecting()})),cn._instances.push(this),this._register(ie(()=>{const o=cn._instances.indexOf(this);o>=0&&cn._instances.splice(o,1)})),this._isPermanentFailure&&this._gotoPermanentFailure(cn._permanentFailureMillisSinceLastIncomingData,cn._permanentFailureAttempt,cn._permanentFailureHandled)}dispose(){super.dispose(),this._isDisposed=!0}async _beginReconnecting(){if(!this._isReconnecting)try{this._isReconnecting=!0,await this._runReconnectingLoop()}finally{this._isReconnecting=!1}}async _runReconnectingLoop(){if(this._isPermanentFailure||this._isDisposed)return;const t=Fm(this._connectionType,this.reconnectionToken,!0);this._options.logService.info(`${t} starting reconnecting loop. You can get more information with the trace log level.`),this._onDidStateChange.fire(new pJ(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData()));const i=[0,5,5,10,10,10,10,10,30];let r=-1;do{r++;const s=r<i.length?i[r]:i[i.length-1];try{if(s>0){const o=fJ(s);this._onDidStateChange.fire(new gJ(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),s,o)),this._options.logService.info(`${t} waiting for ${s} seconds before reconnecting...`);try{await o}catch{}}if(this._isPermanentFailure){this._options.logService.error(`${t} permanent failure occurred while running the reconnecting loop.`);break}this._onDidStateChange.fire(new mJ(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),r+1)),this._options.logService.info(`${t} resolving connection...`);const n=await o9(this._options,this.reconnectionToken,this.protocol);this._options.logService.info(`${t} connecting to ${n.connectTo}...`),await this._reconnect(n,n9(oJ)),this._options.logService.info(`${t} reconnected!`),this._onDidStateChange.fire(new l9(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),r+1));break}catch(n){if(n.code==="VSCODE_CONNECTION_ERROR"){this._options.logService.error(`${t} A permanent error occurred in the reconnecting loop! Will give up now! Error:`),this._options.logService.error(n),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),r+1,!1);break}if(r>360){this._options.logService.error(`${t} An error occurred while reconnecting, but it will be treated as a permanent error because the reconnection grace time has expired! Will give up now! Error:`),this._options.logService.error(n),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),r+1,!1);break}if(__.isTemporarilyNotAvailable(n)){this._options.logService.info(`${t} A temporarily not available error occurred while trying to reconnect, will try again...`),this._options.logService.trace(n);continue}if((n.code==="ETIMEDOUT"||n.code==="ENETUNREACH"||n.code==="ECONNREFUSED"||n.code==="ECONNRESET")&&n.syscall==="connect"){this._options.logService.info(`${t} A network error occurred while trying to reconnect, will try again...`),this._options.logService.trace(n);continue}if(Yi(n)){this._options.logService.info(`${t} A promise cancelation error occurred while trying to reconnect, will try again...`),this._options.logService.trace(n);continue}if(n instanceof __){this._options.logService.error(`${t} A RemoteAuthorityResolverError occurred while trying to reconnect. Will give up now! Error:`),this._options.logService.error(n),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),r+1,__.isHandled(n));break}this._options.logService.error(`${t} An unknown error occurred while trying to reconnect, since this is an unknown case, it will be treated as a permanent error! Will give up now! Error:`),this._options.logService.error(n),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),r+1,!1);break}}while(!this._isPermanentFailure&&!this._isDisposed)}_onReconnectionPermanentFailure(t,i,r){this._reconnectionFailureIsFatal?cn.triggerPermanentFailure(t,i,r):this._gotoPermanentFailure(t,i,r)}_gotoPermanentFailure(t,i,r){this._onDidStateChange.fire(new vJ(this.reconnectionToken,t,i,r)),c9(this.protocol)}_pauseSocketWriting(){this.protocol.pauseSocketWriting()}};function c9(e){try{e.acceptDisconnect();const t=e.getSocket();e.dispose(),t.dispose()}catch(t){pt(t)}}function _J(e){if(e&&e.type==="error"){const t=new Error(`Connection error: ${e.reason}`);return t.code="VSCODE_CONNECTION_ERROR",t}return null}function wJ(e,t){for(;e.length<t;)e+=" ";return e}function yJ(e,t){return`[remote-connection][${wJ(tS(e),13)}][${t.substr(0,5)}\u2026]`}function Fm(e,t,i){return`${yJ(e,t)}[${i?"reconnect":"initial"}]`}function u9(e,t){return`${Fm(t,e.reconnectionToken,!!e.reconnectionProtocol)}[${e.connectTo}]`}function bJ(e){return`${Date.now()-e} ms`}var sS=q("remoteSocketFactoryService");async function SJ(e,t,i,r,s){let n;for(let o=3;o&&(n?.dispose(),n=await new d9(e,t,i,r,s).waitForReady(),!(s&&r9[s]||!r9[n.tunnelLocalPort]));o--);return n}var d9=class extends X{constructor(e,t,i,r,s){super(),this.defaultTunnelHost=t,this.suggestedLocalPort=s,this.privacy=hs.Private,this._socketsDispose=new Map,this._options=e,this._server=iJ.createServer(),this._barrier=new dr,this._listeningListener=()=>this._barrier.open(),this._server.on("listening",this._listeningListener),this._connectionListener=n=>this._onConnection(n),this._server.on("connection",this._connectionListener),this._errorListener=()=>{},this._server.on("error",this._errorListener),this.tunnelRemotePort=r,this.tunnelRemoteHost=i}async dispose(){super.dispose(),this._server.removeListener("listening",this._listeningListener),this._server.removeListener("connection",this._connectionListener),this._server.removeListener("error",this._errorListener),this._server.close(),Array.from(this._socketsDispose.values()).forEach(t=>{t()})}async waitForReady(){const e=this.suggestedLocalPort??this.tunnelRemotePort,t=Js(this.defaultTunnelHost)?"0.0.0.0":"127.0.0.1";let i=await nJ(e,2,1e3,t),r=null;return this._server.listen(i,this.defaultTunnelHost),await this._barrier.wait(),r=this._server.address(),r||(i=0,this._server.listen(i,this.defaultTunnelHost),await this._barrier.wait(),r=this._server.address()),this.tunnelLocalPort=r.port,this.localAddress=`${this.tunnelRemoteHost==="127.0.0.1"?"127.0.0.1":"localhost"}:${r.port}`,this}async _onConnection(e){e.pause();const t=ea(this.tunnelRemoteHost)||Js(this.tunnelRemoteHost)?"localhost":this.tunnelRemoteHost,i=await hJ(this._options,t,this.tunnelRemotePort),r=i.getSocket(),s=i.readEntireBuffer();i.dispose(),s.byteLength>0&&e.write(s.buffer),e.on("end",()=>{e.localAddress&&this._socketsDispose.delete(e.localAddress),r.end()}),e.on("close",()=>r.end()),e.on("error",()=>{e.localAddress&&this._socketsDispose.delete(e.localAddress),r instanceof Cc?r.socket.destroy():r.end()}),r instanceof Cc?this._mirrorNodeSocket(e,r):this._mirrorGenericSocket(e,r),e.localAddress&&this._socketsDispose.set(e.localAddress,()=>{e.end(),r.end()})}_mirrorGenericSocket(e,t){t.onClose(()=>e.destroy()),t.onEnd(()=>e.end()),t.onData(i=>e.write(i.buffer)),e.on("data",i=>t.write(z.wrap(i))),e.resume()}_mirrorNodeSocket(e,t){const i=t.socket;i.on("end",()=>e.end()),i.on("close",()=>e.end()),i.on("error",()=>{e.destroy()}),i.pipe(e),e.pipe(i)}},nS=class extends Bw{constructor(t,i,r,s,n){super(i,n),this.remoteSocketFactoryService=t,this.signService=r,this.productService=s}isPortPrivileged(t){return _W(t,this.defaultTunnelHost,io,rJ.release())}retainOrCreateTunnel(t,i,r,s,n,o,a,l){const c=this.getTunnelFromMap(i,r);if(c)return++c.refcount,c.value;if(mW(t))return this.createWithProvider(t,i,r,n,o,a,l);{this.logService.trace(`ForwardedPorts: (TunnelService) Creating tunnel without provider ${i}:${r} on local port ${n}.`);const u={commit:this.productService.commit,quality:this.productService.quality,addressProvider:t,remoteSocketFactoryService:this.remoteSocketFactoryService,signService:this.signService,logService:this.logService,ipcLogger:null},d=SJ(u,s,i,r,n);return this.logService.trace("ForwardedPorts: (TunnelService) Tunnel created without provider."),this.addTunnelToMap(i,r,d),d}}};nS=__decorate([__param(0,sS),__param(1,ke),__param(2,Nd),__param(3,cf),__param(4,Us)],nS);var oS=class extends nS{constructor(t,i,r,s,n){super(t,i,r,s,n)}};oS=__decorate([__param(0,sS),__param(1,ke),__param(2,Nd),__param(3,cf),__param(4,Us)],oS);var h9=class extends X{constructor(t,i,r,s,n){super(),this.remoteSocketFactoryService=t,this.logService=i,this.productService=r,this.signService=s,this.configurationService=n,this._tunnelServices=new Map}async openTunnel(t,i,r,s,n,o,a,l,c){if(this.logService.trace(`ForwardedPorts: (SharedTunnelService) openTunnel request for ${r}:${s} on local port ${o}.`),!this._tunnelServices.has(t)){const u=new oS(this.remoteSocketFactoryService,this.logService,this.signService,this.productService,this.configurationService);this._register(u),this._tunnelServices.set(t,u),u.onTunnelClosed(async()=>{(await u.tunnels).length===0&&(u.dispose(),this._tunnelServices.delete(t))})}return this._tunnelServices.get(t).openTunnel(i,r,s,n,o,a,l,c)}};h9=__decorate([__param(0,sS),__param(1,ke),__param(2,cf),__param(3,Nd),__param(4,Us)],h9);var xJ=q("dialogService"),f9;(function(e){e[e.Confirmation=1]="Confirmation",e[e.Prompt=2]="Prompt",e[e.Input=3]="Input"})(f9||(f9={}));var Lne=q("fileDialogService"),p9;(function(e){e[e.SAVE=0]="SAVE",e[e.DONT_SAVE=1]="DONT_SAVE",e[e.CANCEL=2]="CANCEL"})(p9||(p9={}));var EJ=10*1e3,$m="remote.tunnels.toRestore",aS="remote.tunnels.toRestoreExpiration",CJ=1e3*60*60*24*14,g9="onTunnel",Nne=new I("forwardedPortsViewEnabled",!1,h(14365,null)),DJ=new I("forwardedPortsViewOnlyEnabled",!1,h(14366,null));function m9(e){const t=e.match(/^([a-zA-Z0-9_-]+(?:\.[a-zA-Z0-9_-]+)*:)?([0-9]+)$/);if(t)return{host:t[1]?.substring(0,t[1].length-1)||"localhost",port:Number(t[2])}}var Md;(function(e){e.Other="Other",e.User="User",e.AutoForwardEnd="AutoForwardEnd"})(Md||(Md={}));var nn;(function(e){e[e.User=0]="User",e[e.Auto=1]="Auto",e[e.Extension=2]="Extension"})(nn||(nn={}));var lS={source:nn.User,description:h(14367,null)},Mne={source:nn.Auto,description:h(14368,null)};function v9(e,t,i){const r=e.get(Ki(t,i));if(r)return r;if(ea(t))for(const s of id){const n=Ki(s,i);if(e.has(n))return e.get(n)}else if(Js(t))for(const s of kg){const n=Ki(s,i);if(e.has(n))return e.get(n)}}function Ni(e,t,i){const r=v9(e,t,i);if(r)return r;const s=Js(t)?"localhost":ea(t)?"0.0.0.0":void 0;if(s)return v9(e,s,i)}function Ki(e,t){return e+":"+t}var Qn;(function(e){e.Notify="notify",e.OpenBrowser="openBrowser",e.OpenBrowserOnce="openBrowserOnce",e.OpenPreview="openPreview",e.Silent="silent",e.Ignore="ignore"})(Qn||(Qn={}));function kJ(e){return e&&"host"in e&&typeof e.host=="string"&&"port"in e&&typeof e.port=="number"&&(!("detail"in e)||typeof e.detail=="string")&&(!("pid"in e)||typeof e.pid=="string")}var _9=class Jr extends X{static{this.SETTING="remote.portsAttributes"}static{this.DEFAULTS="remote.otherPortsAttributes"}static{this.RANGE=/^(\d+)\-(\d+)$/}static{this.HOST_AND_PORT=/^([a-z0-9\-]+):(\d{1,5})$/}constructor(t){super(),this.configurationService=t,this.portsAttributes=[],this._onDidChangeAttributes=new D,this.onDidChangeAttributes=this._onDidChangeAttributes.event,this._register(t.onDidChangeConfiguration(i=>{(i.affectsConfiguration(Jr.SETTING)||i.affectsConfiguration(Jr.DEFAULTS))&&this.updateAttributes()})),this.updateAttributes()}updateAttributes(){this.portsAttributes=this.readSetting(),this._onDidChangeAttributes.fire()}getAttributes(t,i,r){let s=this.findNextIndex(t,i,r,this.portsAttributes,0);const n={label:void 0,onAutoForward:void 0,elevateIfNeeded:void 0,requireLocalPort:void 0,protocol:void 0};for(;s>=0;){const o=this.portsAttributes[s];o.key===t?(n.onAutoForward=o.onAutoForward??n.onAutoForward,n.elevateIfNeeded=o.elevateIfNeeded!==void 0?o.elevateIfNeeded:n.elevateIfNeeded,n.label=o.label??n.label,n.requireLocalPort=o.requireLocalPort,n.protocol=o.protocol):(n.onAutoForward=n.onAutoForward??o.onAutoForward,n.elevateIfNeeded=n.elevateIfNeeded!==void 0?n.elevateIfNeeded:o.elevateIfNeeded,n.label=n.label??o.label,n.requireLocalPort=n.requireLocalPort!==void 0?n.requireLocalPort:void 0,n.protocol=n.protocol??o.protocol),s=this.findNextIndex(t,i,r,this.portsAttributes,s+1)}return n.onAutoForward!==void 0||n.elevateIfNeeded!==void 0||n.label!==void 0||n.requireLocalPort!==void 0||n.protocol!==void 0?n:this.getOtherAttributes()}hasStartEnd(t){return t.start!==void 0&&t.end!==void 0}hasHostAndPort(t){return t.host!==void 0&&t.port!==void 0&&Oe(t.host)&&cr(t.port)}findNextIndex(t,i,r,s,n){if(n>=s.length)return-1;const o=!ea(i)&&!Js(i),l=s.slice(n).findIndex(c=>cr(c.key)?o?!1:c.key===t:this.hasStartEnd(c.key)?o?!1:t>=c.key.start&&t<=c.key.end:this.hasHostAndPort(c.key)?t===c.key.port&&i===c.key.host:r?c.key.test(r):!1);return l>=0?l+n:-1}readSetting(){const t=this.configurationService.getValue(Jr.SETTING);if(!t||!It(t))return[];const i=[];for(const s in t){if(s===void 0)continue;const n=t[s];let o;if(Number(s))o=Number(s);else if(Oe(s))if(Jr.RANGE.test(s)){const a=s.match(Jr.RANGE);o={start:Number(a[1]),end:Number(a[2])}}else if(Jr.HOST_AND_PORT.test(s)){const a=s.match(Jr.HOST_AND_PORT);o={host:a[1],port:Number(a[2])}}else{let a;try{a=RegExp(s)}catch{}a&&(o=a)}o&&i.push({key:o,elevateIfNeeded:n.elevateIfNeeded,onAutoForward:n.onAutoForward,label:n.label,requireLocalPort:n.requireLocalPort,protocol:n.protocol})}const r=this.configurationService.getValue(Jr.DEFAULTS);return r&&(this.defaultPortAttributes={elevateIfNeeded:r.elevateIfNeeded,label:r.label,onAutoForward:r.onAutoForward,requireLocalPort:r.requireLocalPort,protocol:r.protocol}),this.sortAttributes(i)}sortAttributes(t){function i(r,s){return cr(r.key)?r.key:s.hasStartEnd(r.key)?r.key.start:s.hasHostAndPort(r.key)?r.key.port:Number.MAX_VALUE}return t.sort((r,s)=>i(r,this)-i(s,this))}getOtherAttributes(){return this.defaultPortAttributes}static providedActionToAction(t){switch(t){case zn.Notify:return Qn.Notify;case zn.OpenBrowser:return Qn.OpenBrowser;case zn.OpenBrowserOnce:return Qn.OpenBrowserOnce;case zn.OpenPreview:return Qn.OpenPreview;case zn.Silent:return Qn.Silent;case zn.Ignore:return Qn.Ignore;default:return}}async addAttributes(t,i,r){const n=this.configurationService.inspect(Jr.SETTING).userRemoteValue;let o;!n||!It(n)?o={}:o=Ye(n),o[`${t}`]||(o[`${t}`]={});for(const a in i)o[`${t}`][a]=i[a];return this.configurationService.updateValue(Jr.SETTING,o,r)}},cS=class extends X{constructor(t,i,r,s,n,o,a,l,c,u){super(),this.tunnelService=t,this.storageService=i,this.configurationService=r,this.environmentService=s,this.remoteAuthorityResolverService=n,this.workspaceContextService=o,this.logService=a,this.dialogService=l,this.extensionService=c,this.contextKeyService=u,this.inProgress=new Map,this._onForwardPort=new D,this.onForwardPort=this._onForwardPort.event,this._onClosePort=new D,this.onClosePort=this._onClosePort.event,this._onPortName=new D,this.onPortName=this._onPortName.event,this._onCandidatesChanged=new D,this.onCandidatesChanged=this._onCandidatesChanged.event,this._onEnvironmentTunnelsSet=new D,this.onEnvironmentTunnelsSet=this._onEnvironmentTunnelsSet.event,this._environmentTunnelsSet=!1,this.restoreListener=void 0,this.restoreComplete=!1,this.onRestoreComplete=new D,this.unrestoredExtensionTunnels=new Map,this.sessionCachedProperties=new Map,this.portAttributesProviders=[],this.hasCheckedExtensionsOnTunnelOpened=!1,this.mismatchCooldown=new Date,this.configPortsAttributes=new _9(r),this.tunnelRestoreValue=this.getTunnelRestoreValue(),this._register(this.configPortsAttributes.onDidChangeAttributes(this.updateAttributes,this)),this.forwarded=new Map,this.remoteTunnels=new Map,this.tunnelService.tunnels.then(async d=>{const f=await this.getAttributes(d.map(p=>({port:p.tunnelRemotePort,host:p.tunnelRemoteHost})));for(const p of d)if(p.localAddress){const g=Ki(p.tunnelRemoteHost,p.tunnelRemotePort),v=Ni(this._candidates??new Map,p.tunnelRemoteHost,p.tunnelRemotePort);this.forwarded.set(g,{remotePort:p.tunnelRemotePort,remoteHost:p.tunnelRemoteHost,localAddress:p.localAddress,protocol:f?.get(p.tunnelRemotePort)?.protocol??_r.Http,localUri:await this.makeLocalUri(p.localAddress,f?.get(p.tunnelRemotePort)),localPort:p.tunnelLocalPort,name:f?.get(p.tunnelRemotePort)?.label,runningProcess:v?.detail,hasRunningProcess:!!v,pid:v?.pid,privacy:p.privacy,source:lS}),this.remoteTunnels.set(g,p)}}),this.detected=new Map,this._register(this.tunnelService.onTunnelOpened(async d=>{const f=Ki(d.tunnelRemoteHost,d.tunnelRemotePort);if(!Ni(this.forwarded,d.tunnelRemoteHost,d.tunnelRemotePort)&&!Ni(this.detected,d.tunnelRemoteHost,d.tunnelRemotePort)&&!Ni(this.inProgress,d.tunnelRemoteHost,d.tunnelRemotePort)&&d.localAddress){const p=Ni(this._candidates??new Map,d.tunnelRemoteHost,d.tunnelRemotePort),g=(await this.getAttributes([{port:d.tunnelRemotePort,host:d.tunnelRemoteHost}]))?.get(d.tunnelRemotePort);this.forwarded.set(f,{remoteHost:d.tunnelRemoteHost,remotePort:d.tunnelRemotePort,localAddress:d.localAddress,protocol:g?.protocol??_r.Http,localUri:await this.makeLocalUri(d.localAddress,g),localPort:d.tunnelLocalPort,name:g?.label,closeable:!0,runningProcess:p?.detail,hasRunningProcess:!!p,pid:p?.pid,privacy:d.privacy,source:lS})}await this.storeForwarded(),this.checkExtensionActivationEvents(!0),this.remoteTunnels.set(f,d),this._onForwardPort.fire(this.forwarded.get(f))})),this._register(this.tunnelService.onTunnelClosed(d=>this.onTunnelClosed(d,Md.Other))),this.checkExtensionActivationEvents(!1)}extensionHasActivationEvent(){return this.extensionService.extensions.find(t=>t.activationEvents?.includes(g9))?(this.contextKeyService.createKey(DJ.key,!0),!0):!1}checkExtensionActivationEvents(t){if(this.hasCheckedExtensionsOnTunnelOpened||(t&&(this.hasCheckedExtensionsOnTunnelOpened=!0),this.environmentService.remoteAuthority!==void 0&&!t)||this.extensionHasActivationEvent())return;const r=this._register(this.extensionService.onDidRegisterExtensions(()=>{this.extensionHasActivationEvent()&&r.dispose()}))}async onTunnelClosed(t,i){const r=Ki(t.host,t.port);this.forwarded.has(r)&&(this.forwarded.delete(r),await this.storeForwarded(),this._onClosePort.fire(t))}makeLocalUri(t,i){if(t.startsWith("http"))return b.parse(t);const r=i?.protocol??"http";return b.parse(`${r}://${t}`)}async addStorageKeyPostfix(t){const i=this.workspaceContextService.getWorkspace(),r=i.configuration?Rs(i.configuration.path):i.folders.length>0?Rs(i.folders[0].uri.path):void 0;if(r===void 0){this.logService.debug("Could not get workspace hash for forwarded ports storage key.");return}return`${t}.${this.environmentService.remoteAuthority}.${r}`}async getTunnelRestoreStorageKey(){return this.addStorageKeyPostfix($m)}async getRestoreExpirationStorageKey(){return this.addStorageKeyPostfix(aS)}async getTunnelRestoreValue(){const t=this.storageService.get($m,1);if(t)return this.storageService.remove($m,1),await this.storeForwarded(),t;const i=await this.getTunnelRestoreStorageKey();if(i)return this.storageService.get(i,0)}async restoreForwarded(){if(this.cleanupExpiredTunnelsForRestore(),this.configurationService.getValue("remote.restoreForwardedPorts")){const t=await this.tunnelRestoreValue;if(t&&t!==this.knownPortsRestoreValue){const i=JSON.parse(t)??[];this.logService.trace(`ForwardedPorts: (TunnelModel) restoring ports ${i.map(r=>r.remotePort).join(", ")}`);for(const r of i){const s=Ni(this.detected,r.remoteHost,r.remotePort);r.source.source!==nn.Extension&&!s||r.source.source===nn.Extension&&s?await this.doForward({remote:{host:r.remoteHost,port:r.remotePort},local:r.localPort,name:r.name,elevateIfNeeded:!0,source:r.source}):r.source.source===nn.Extension&&!s&&this.unrestoredExtensionTunnels.set(Ki(r.remoteHost,r.remotePort),r)}}}if(this.restoreComplete=!0,this.onRestoreComplete.fire(),!this.restoreListener){const t=await this.getTunnelRestoreStorageKey();this.restoreListener=this._register(new oe),this.restoreListener.add(this.storageService.onDidChangeValue(0,void 0,this.restoreListener)(async i=>{i.key===t&&(this.tunnelRestoreValue=Promise.resolve(this.storageService.get(t,0)),await this.restoreForwarded())}))}}cleanupExpiredTunnelsForRestore(){const t=this.storageService.keys(0,0).filter(i=>i.startsWith(aS));for(const i of t){const r=this.storageService.getNumber(i,0);if(r&&r<Date.now()){this.tunnelRestoreValue=Promise.resolve(void 0);const s=i.replace(aS,$m);this.storageService.remove(i,0),this.storageService.remove(s,0)}}}async storeForwarded(){if(this.configurationService.getValue("remote.restoreForwardedPorts")){const t=Array.from(this.forwarded.values()),i=t.map(o=>({remoteHost:o.remoteHost,remotePort:o.remotePort,localPort:o.localPort,name:o.name,localAddress:o.localAddress,localUri:o.localUri,protocol:o.protocol,source:o.source}));let r;t.length>0&&(r=JSON.stringify(i));const s=await this.getTunnelRestoreStorageKey(),n=await this.getRestoreExpirationStorageKey();!r&&s&&n?(this.storageService.remove(s,0),this.storageService.remove(n,0)):r!==this.knownPortsRestoreValue&&s&&n&&(this.storageService.store(s,r,0,0),this.storageService.store(n,Date.now()+CJ,0,0)),this.knownPortsRestoreValue=r}}async showPortMismatchModalIfNeeded(t,i,r){if(!t.tunnelLocalPort||!r?.requireLocalPort||t.tunnelLocalPort===i)return;const s=new Date;if(this.mismatchCooldown.getTime()+EJ>s.getTime())return;this.mismatchCooldown=s;const n=h(14369,null,i,t.tunnelRemotePort,t.tunnelLocalPort);return this.dialogService.info(n)}async forward(t,i){return!this.restoreComplete&&this.environmentService.remoteAuthority&&await Fe.toPromise(this.onRestoreComplete.event),this.doForward(t,i)}async doForward(t,i){await this.extensionService.activateByEvent(g9);const r=Ni(this.forwarded,t.remote.host,t.remote.port);i=i??(i!==null?(await this.getAttributes([t.remote]))?.get(t.remote.port):void 0);const s=t.local!==void 0?t.local:t.remote.port;let n;if(r)return this.mergeAttributesIntoExistingTunnel(r,t,i);{const o=this.environmentService.remoteAuthority,a=o?{getAddress:async()=>(await this.remoteAuthorityResolverService.resolveAuthority(o)).authority}:void 0,l=Ki(t.remote.host,t.remote.port);this.inProgress.set(l,!0),t=this.mergeCachedAndUnrestoredProperties(l,t);const c=await this.tunnelService.openTunnel(a,t.remote.host,t.remote.port,void 0,s,t.elevateIfNeeded?t.elevateIfNeeded:i?.elevateIfNeeded,t.privacy,i?.protocol);if(typeof c=="string")n=c;else if(c&&c.localAddress){const u=Ni(this._candidates??new Map,t.remote.host,t.remote.port),d=c.protocol?c.protocol===_r.Https?_r.Https:_r.Http:i?.protocol??_r.Http,f={remoteHost:c.tunnelRemoteHost,remotePort:c.tunnelRemotePort,localPort:c.tunnelLocalPort,name:i?.label??t.name,closeable:!0,localAddress:c.localAddress,protocol:d,localUri:await this.makeLocalUri(c.localAddress,i),runningProcess:u?.detail,hasRunningProcess:!!u,pid:u?.pid,source:t.source??lS,privacy:c.privacy};return this.forwarded.set(l,f),this.remoteTunnels.set(l,c),this.inProgress.delete(l),await this.storeForwarded(),await this.showPortMismatchModalIfNeeded(c,s,i),this._onForwardPort.fire(f),c}this.inProgress.delete(l)}return n}mergeCachedAndUnrestoredProperties(t,i){const r=this.unrestoredExtensionTunnels.has(t)?this.unrestoredExtensionTunnels:this.sessionCachedProperties.has(t)?this.sessionCachedProperties:void 0;if(r){const s=r.get(t);r.delete(t),s&&(i.name=s.name??i.name,i.local=("local"in s?s.local:"localPort"in s?s.localPort:void 0)??i.local,i.privacy=i.privacy)}return i}async mergeAttributesIntoExistingTunnel(t,i,r){const s=r?.label??i.name;let n;(function(a){a[a.None=0]="None",a[a.Fire=1]="Fire",a[a.Reopen=2]="Reopen"})(n||(n={}));let o=n.None;switch(s!==t.name&&(t.name=s,o=n.Fire),(r?.protocol||t.protocol!==_r.Http)&&r?.protocol!==t.protocol&&(i.source=t.source,o=n.Reopen),i.privacy&&t.privacy!==i.privacy&&(o=n.Reopen),o){case n.Fire:{this._onForwardPort.fire();break}case n.Reopen:await this.close(t.remoteHost,t.remotePort,Md.User),await this.doForward(i,r)}return Ni(this.remoteTunnels,i.remote.host,i.remote.port)}async name(t,i,r){const s=Ni(this.forwarded,t,i),n=Ki(t,i);if(s){s.name=r,await this.storeForwarded(),this._onPortName.fire({host:t,port:i});return}else this.detected.has(n)&&(this.detected.get(n).name=r,this._onPortName.fire({host:t,port:i}))}async close(t,i,r){const s=Ki(t,i),n=this.forwarded.get(s);return r===Md.AutoForwardEnd&&n&&n.source.source===nn.Auto&&this.sessionCachedProperties.set(s,{local:n.localPort,name:n.name,privacy:n.privacy}),await this.tunnelService.closeTunnel(t,i),this.onTunnelClosed({host:t,port:i},r)}address(t,i){const r=Ki(t,i);return(this.forwarded.get(r)||this.detected.get(r))?.localAddress}get environmentTunnelsSet(){return this._environmentTunnelsSet}addEnvironmentTunnels(t){if(t)for(const i of t){const r=Ni(this._candidates??new Map,i.remoteAddress.host,i.remoteAddress.port),s=typeof i.localAddress=="string"?i.localAddress:Ki(i.localAddress.host,i.localAddress.port);this.detected.set(Ki(i.remoteAddress.host,i.remoteAddress.port),{remoteHost:i.remoteAddress.host,remotePort:i.remoteAddress.port,localAddress:s,protocol:_r.Http,localUri:this.makeLocalUri(s),closeable:!1,runningProcess:r?.detail,hasRunningProcess:!!r,pid:r?.pid,privacy:hs.ConstantPrivate,source:{source:nn.Extension,description:h(14370,null)}}),this.tunnelService.setEnvironmentTunnel(i.remoteAddress.host,i.remoteAddress.port,s,hs.ConstantPrivate,_r.Http)}this._environmentTunnelsSet=!0,this._onEnvironmentTunnelsSet.fire(),this._onForwardPort.fire()}setCandidateFilter(t){this._candidateFilter=t}async setCandidates(t){let i=t;this._candidateFilter&&(i=await this._candidateFilter(t));const r=this.updateInResponseToCandidates(i);this.logService.trace(`ForwardedPorts: (TunnelModel) removed candidates ${Array.from(r.values()).map(s=>s.port).join(", ")}`),this._onCandidatesChanged.fire(r)}updateInResponseToCandidates(t){const i=this._candidates??new Map,r=new Map;return this._candidates=r,t.forEach(s=>{const n=Ki(s.host,s.port);r.set(n,{host:s.host,port:s.port,detail:s.detail,pid:s.pid}),i.has(n)&&i.delete(n);const o=Ni(this.forwarded,s.host,s.port);o&&(o.runningProcess=s.detail,o.hasRunningProcess=!0,o.pid=s.pid)}),i.forEach((s,n)=>{const o=m9(n);if(!o)return;const a=Ni(this.forwarded,o.host,o.port);a&&(a.runningProcess=void 0,a.hasRunningProcess=!1,a.pid=void 0);const l=Ni(this.detected,o.host,o.port);l&&(l.runningProcess=void 0,l.hasRunningProcess=!1,l.pid=void 0)}),i}get candidates(){return this._candidates?Array.from(this._candidates.values()):[]}get candidatesOrUndefined(){return this._candidates?this.candidates:void 0}async updateAttributes(){const t=Array.from(this.forwarded.values()),i=await this.getAttributes(t.map(r=>({port:r.remotePort,host:r.remoteHost})),!1);if(i)for(const r of t){const s=i.get(r.remotePort);(s?.protocol||r.protocol!==_r.Http)&&s?.protocol!==r.protocol&&await this.doForward({remote:{host:r.remoteHost,port:r.remotePort},local:r.localPort,name:r.name,source:r.source},s),s&&s.label&&s.label!==r.name&&await this.name(r.remoteHost,r.remotePort,s.label)}}async getAttributes(t,i=!0){const r=new Map,s=new Map;t.forEach(c=>{const u=Ni(this._candidates??new Map,id[0],c.port)??c;if(u){r.set(c.port,u);const d=kJ(u)?u.pid:void 0;s.has(d)||s.set(d,[]),s.get(d)?.push(c.port)}});const n=new Map;if(t.forEach(c=>{const u=this.configPortsAttributes.getAttributes(c.port,c.host,r.get(c.port)?.detail);u&&n.set(c.port,u)}),this.portAttributesProviders.length===0||!i)return n.size>0?n:void 0;const o=await Promise.all(this.portAttributesProviders.flatMap(c=>Array.from(s.entries()).map(u=>{const d=u[1],f=r.get(d[0]);return c.providePortAttributes(d,f?.pid,f?.detail,Be.None)}))),a=new Map;if(o.forEach(c=>c.forEach(u=>{u&&a.set(u.port,u)})),!n&&!a)return;const l=new Map;return t.forEach(c=>{const u=n.get(c.port),d=a.get(c.port);l.set(c.port,{elevateIfNeeded:u?.elevateIfNeeded,label:u?.label,onAutoForward:u?.onAutoForward??_9.providedActionToAction(d?.autoForwardAction),requireLocalPort:u?.requireLocalPort,protocol:u?.protocol})}),l}addAttributesProvider(t){this.portAttributesProviders.push(t)}};__decorate([Ah(1e3)],cS.prototype,"storeForwarded",null),cS=__decorate([__param(0,gW),__param(1,GI),__param(2,Us),__param(3,vT),__param(4,BH),__param(5,Uh),__param(6,ke),__param(7,xJ),__param(8,LH),__param(9,$h)],cS);function IJ(e){const t=e.trim().split(`
`),i=[];return t.forEach(s=>{const n=/\/proc\/(\d+)\/fd\/\d+ -> socket:\[(\d+)\]/.exec(s);n&&n.length>=3&&i.push({pid:parseInt(n[1],10),socket:parseInt(n[2],10)})}),i.reduce((s,n)=>(s[n.socket]=n,s),{})}function PJ(...e){const t=[].concat(...e.map(AJ));return[...new Map(t.filter(i=>i.st==="0A").map(i=>{const r=i.local_address.split(":");return{socket:parseInt(i.inode,10),ip:TJ(r[0]),port:parseInt(r[1],16)}}).map(i=>[i.ip+":"+i.port,i])).values()]}function TJ(e){let t="";if(e.length===8)for(let i=e.length-2;i>=0;i-=2)t+=parseInt(e.substr(i,2),16),i!==0&&(t+=".");else for(let i=0;i<e.length;i+=8){const r=e.substring(i,i+8);let s="";for(let n=8;n>=2;n-=2)s+=r.substring(n-2,n),(n===6||n===2)&&(s=parseInt(s,16).toString(16),t+=`${s}`,s="",i+n!==e.length-6&&(t+=":"))}return t}function AJ(e){const t=e.trim().split(`
`),i=t.shift().trim().split(/\s+/).filter(s=>s!=="rx_queue"&&s!=="tm->when");return t.map(s=>s.trim().split(/\s+/).reduce((n,o,a)=>(n[i[a]||a]=o,n),{}))}function RJ(e){return e.length>500?!1:!!e.match(/.*\.vscode-server-[a-zA-Z]+\/bin.*/)||e.indexOf("out/server-main.js")!==-1||e.indexOf("_productName=VSCode")!==-1}function LJ(e){const t=e.trim().split(`
`),i=[];return t.forEach(r=>{const s=/^\d+\s+\D+\s+root\s+(\d+)\s+(\d+).+\d+\:\d+\:\d+\s+(.+)$/.exec(r);s&&s.length>=4&&i.push({pid:parseInt(s[1],10),ppid:parseInt(s[2]),cmd:s[3]})}),i}async function NJ(e,t,i){const r=i.reduce((n,o)=>(n[o.pid]=o,n),{}),s=[];return e.forEach(({socket:n,ip:o,port:a})=>{const l=t[n]?t[n].pid:void 0,c=l?r[l]?.cmd:void 0;l&&c&&!RJ(c)&&s.push({host:o,port:a,detail:c,pid:l})}),s}function MJ(e,t,i){const r=new Map,s=LJ(t);for(const n of e){const o=i.get(n.port);if(o){r.set(n.port,o);continue}const a=s.find(l=>l.cmd.includes(`${n.port}`));if(a){let l=a,c;do c=s.find(u=>u.ppid===l.pid),c&&(l=c);while(c);r.set(n.port,{host:n.ip,port:n.port,pid:l.pid,detail:l.cmd,ppid:l.ppid})}else r.set(n.port,{host:n.ip,port:n.port,ppid:Number.MAX_VALUE})}return r}var uS=class extends Pg{constructor(t,i,r,s){super(t,i,r),this.initData=i,this.signService=s,this._initialCandidates=void 0,this._foundRootPorts=new Map,this._candidateFindingEnabled=!1,Ct&&i.remote.isRemote&&i.remote.authority&&(this._proxy.$setRemoteTunnelService(process.pid),this.setInitialCandidates())}async $registerCandidateFinder(t){if(t&&this._candidateFindingEnabled)return;this._candidateFindingEnabled=t;let i;this._initialCandidates&&(i=this._initialCandidates,await this._proxy.$onFoundNewCandidates(this._initialCandidates));const r=new KM;let s=0;for(;this._candidateFindingEnabled;){const n=new Date().getTime(),o=(await this.findCandidatePorts()).filter(c=>ea(c.host)||Js(c.host));this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) found candidate ports ${o.map(c=>c.port).join(", ")}`);const a=new Date().getTime()-n;this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) candidate port scan took ${a} ms.`),s++>3&&r.update(a),(!i||JSON.stringify(i)!==JSON.stringify(o))&&(i=o,await this._proxy.$onFoundNewCandidates(i));const l=this.calculateDelay(r.value);this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) next candidate port scan in ${l} ms.`),await new Promise(c=>setTimeout(()=>c(),l))}}calculateDelay(t){return Math.max(t*20,2e3)}async setInitialCandidates(){this._initialCandidates=await this.findCandidatePorts(),this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) Initial candidates found: ${this._initialCandidates.map(t=>t.port).join(", ")}`)}async findCandidatePorts(){let t="",i="";try{t=await Ld.promises.readFile("/proc/net/tcp","utf8"),i=await Ld.promises.readFile("/proc/net/tcp6","utf8")}catch{}const r=PJ(t,i),s=await new Promise(f=>{t9("ls -l /proc/[0-9]*/fd/[0-9]* | grep socket:",(p,g,v)=>{f(g)})}),n=IJ(s),o=await dt.readdir("/proc"),a=[];for(const f of o)try{const p=Number(f),g=Dt(b.file("/proc"),f);if((await Ld.promises.stat(g.fsPath)).isDirectory()&&!isNaN(p)){const y=await Ld.promises.readlink(Dt(g,"cwd").fsPath),S=await Ld.promises.readFile(Dt(g,"cmdline").fsPath,"utf8");a.push({pid:p,cwd:y,cmd:S})}}catch{}const l=[],c=r.filter(f=>{const p=n[f.socket];return p||l.push(f),p}),u=NJ(c,n,a);let d;if(this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) number of possible root ports ${l.length}`),l.length>0){const f=await new Promise(p=>{t9("ps -F -A -l | grep root",(g,v,y)=>{p(v)})});this._foundRootPorts=MJ(l,f,this._foundRootPorts),d=Array.from(this._foundRootPorts.values()),this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) heuristic ports ${d.map(p=>p.port).join(", ")}`)}return u.then(f=>d?f.concat(d):f)}makeManagedTunnelFactory(t){return async i=>{const r=new d9({commit:this.initData.commit,quality:this.initData.quality,logService:this.logService,ipcLogger:null,remoteSocketFactoryService:{_serviceBrand:void 0,async connect(n,o,a,l){const c=await t.makeConnection();return OJ.connect(c,o,a,l)},register(){throw new Error("not implemented")}},addressProvider:{getAddress(){return Promise.resolve({connectTo:new c4(0),connectionToken:t.connectionToken})}},signService:this.signService},"localhost",i.remoteAddress.host||"localhost",i.remoteAddress.port,i.localAddressPort);await r.waitForReady();const s=new D;return{localAddress:m9(r.localAddress)??r.localAddress,remoteAddress:{port:r.tunnelRemotePort,host:r.tunnelRemoteHost},onDidDispose:s.event,dispose:()=>{r.dispose(),s.fire(),s.dispose()}}}}};uS=__decorate([__param(0,Pe),__param(1,zt),__param(2,ke),__param(3,Nd)],uS);var OJ=class Z8 extends eJ{static connect(t,i,r,s){const n=new oe,o={onClose:n.add(new D),onData:n.add(new D),onEnd:n.add(new D)};n.add(t.onDidReceiveMessage(l=>o.onData.fire(z.wrap(l)))),n.add(t.onDidEnd(()=>o.onEnd.fire())),n.add(t.onDidClose(l=>o.onClose.fire({type:0,error:l,hadError:!!l})));const a=new Z8(t,s,o);return a._register(n),ZQ(a,i,r,s,o)}constructor(t,i,r){super(i,r),this.passing=t}write(t){this.passing.send(t.buffer)}closeRemote(){this.passing.end()}async drain(){await this.passing.drain?.()}};import*as ca from"fs";var FJ=class extends Ww{constructor(){super(...arguments),this._workspaceStorageLock=null}async _getWorkspaceStorageURI(e){const t=await super._getWorkspaceStorageURI(e);if(t.scheme!==V.file)return t;if(this._environment.skipWorkspaceStorageLock)return this._logService.info(`Skipping acquiring lock for ${t.fsPath}.`),t;const i=t.fsPath;let r=0;do{let s;r===0?s=i:s=/[/\\]$/.test(i)?`${i.substr(0,i.length-1)}-${r}`:`${i}-${r}`,await $J(s);const n=Xe(s,"vscode.lock"),o=await y9(this._logService,n,!1);if(o)return this._workspaceStorageLock=o,process.on("exit",()=>{o.dispose()}),b.file(s);r++}while(r<10);return t}onWillDeactivateAll(){this._workspaceStorageLock?.setWillRelease(6e3)}};async function $J(e){try{await ca.promises.stat(e);return}catch{}try{await ca.promises.mkdir(e,{recursive:!0})}catch{}}var HJ=1e3,w9=10*60*1e3,UJ=class extends X{constructor(e,t){super(),this.logService=e,this.filename=t,this._timer=this._register(new yE),this._timer.cancelAndSet(async()=>{const i=await dS(e,t);(!i||i.pid!==process.pid)&&(e.info(`Lock '${t}': The lock was lost unexpectedly.`),this._timer.cancel());try{await ca.promises.utimes(t,new Date,new Date)}catch(r){e.error(r),e.info(`Lock '${t}': Could not update mtime.`)}},HJ)}dispose(){super.dispose();try{ca.unlinkSync(this.filename)}catch{}}async setWillRelease(e){this.logService.info(`Lock '${this.filename}': Marking the lockfile as scheduled to be released in ${e} ms.`);try{const t={pid:process.pid,willReleaseAt:Date.now()+e};await dt.writeFile(this.filename,JSON.stringify(t),{flag:"w"})}catch(t){this.logService.error(t)}}};async function y9(e,t,i){try{const s={pid:process.pid,willReleaseAt:0};await dt.writeFile(t,JSON.stringify(s),{flag:"wx"})}catch(s){e.error(s)}const r=await dS(e,t);return!r||r.pid!==process.pid?i?(e.info(`Lock '${t}': Could not acquire lock, giving up.`),null):(e.info(`Lock '${t}': Could not acquire lock, checking if the file is stale.`),BJ(e,t)):(e.info(`Lock '${t}': Lock acquired.`),new UJ(e,t))}async function dS(e,t){let i;try{i=await ca.promises.readFile(t)}catch(r){return e.error(r),null}try{return JSON.parse(String(i))}catch(r){return e.error(r),null}}async function hS(e,t){let i;try{i=await ca.promises.stat(t)}catch(r){return e.error(r),0}return i.mtime.getTime()}function WJ(e){try{return process.kill(e,0),!0}catch{return!1}}async function BJ(e,t){const i=await dS(e,t);if(!i)return e.info(`Lock '${t}': Could not read pid of lock holder.`),Od(e,t);if(i.willReleaseAt){let a=i.willReleaseAt-Date.now();if(a<5e3){for(a>0?e.info(`Lock '${t}': The lockfile is scheduled to be released in ${a} ms.`):e.info(`Lock '${t}': The lockfile is scheduled to have been released.`);a>0;){if(await ui(Math.min(100,a)),await hS(e,t)===0)return Od(e,t);a=i.willReleaseAt-Date.now()}return Od(e,t)}}if(!WJ(i.pid))return e.info(`Lock '${t}': The pid ${i.pid} appears to be gone.`),Od(e,t);const r=await hS(e,t),s=Date.now()-r;if(s<=w9)return e.info(`Lock '${t}': The lock does not look stale, elapsed: ${s} ms, giving up.`),null;e.info(`Lock '${t}': The lock looks stale, waiting for 2s.`),await ui(2e3);const n=await hS(e,t),o=Date.now()-n;return o<=w9?(e.info(`Lock '${t}': The lock does not look stale, elapsed: ${o} ms, giving up.`),null):(e.info(`Lock '${t}': The lock looks stale even after waiting for 2s.`),Od(e,t))}async function Od(e,t){e.info(`Lock '${t}': Deleting a stale lock.`);try{await ca.promises.unlink(t)}catch{}return y9(e,t,!0)}var on;(function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical",e[e.Off=6]="Off"})(on||(on={}));async function VJ(e,t,i,r,s){try{const n=await import("@vscode/spdlog");n.setFlushOn(on.Trace);const o=await n.createAsyncRotatingLogger(e,t,i,r);return s?o.clearFormatters():o.setPattern("%Y-%m-%d %H:%M:%S.%e [%l] %v"),o}catch(n){console.error(n)}return null}function b9(e,t,i){switch(t){case ae.Trace:e.trace(i);break;case ae.Debug:e.debug(i);break;case ae.Info:e.info(i);break;case ae.Warning:e.warn(i);break;case ae.Error:e.error(i);break;case ae.Off:break;default:throw new Error(`Invalid log level ${t}`)}}function S9(e,t){switch(t){case ae.Trace:e.setLevel(on.Trace);break;case ae.Debug:e.setLevel(on.Debug);break;case ae.Info:e.setLevel(on.Info);break;case ae.Warning:e.setLevel(on.Warning);break;case ae.Error:e.setLevel(on.Error);break;case ae.Off:e.setLevel(on.Off);break;default:throw new Error(`Invalid log level ${t}`)}}var zJ=class extends g1{constructor(e,t,i,r,s){super(),this.buffer=[],this.setLevel(s),this._loggerCreationPromise=this._createSpdLogLogger(e,t,i,r),this._register(this.onDidChangeLogLevel(n=>{this._logger&&S9(this._logger,n)}))}async _createSpdLogLogger(e,t,i,r){const s=i?6:1,n=30/s*Lk.MB,o=await VJ(e,t,n,s,r);if(o){this._logger=o,S9(this._logger,this.getLevel());for(const{level:a,message:l}of this.buffer)b9(this._logger,a,l);this.buffer=[]}}log(e,t){this._logger?b9(this._logger,e,t):this.getLevel()<=e&&this.buffer.push({level:e,message:t})}flush(){this._logger?this.flushLogger():this._loggerCreationPromise.then(()=>this.flushLogger())}dispose(){this._logger?this.disposeLogger():this._loggerCreationPromise.then(()=>this.disposeLogger()),super.dispose()}flushLogger(){this._logger&&this._logger.flush()}disposeLogger(){this._logger&&(this._logger.drop(),this._logger=void 0)}},qJ=class extends Jg{doCreateLogger(e,t,i){return e.scheme===V.file?new zJ(i?.name||mt(),e.fsPath,!i?.donotRotate,!!i?.donotUseFormatters,t):super.doCreateLogger(e,t,i)}registerLogger(e){super.registerLogger(e),this._proxy.$registerLogger(e)}deregisterLogger(e){super.deregisterLogger(e),this._proxy.$deregisterLogger(e)}};import{homedir as jJ}from"os";var GJ=class extends qg{homeDir(){return jJ()}},QJ=class extends X{constructor(e,t=[]){super(),this.logger=new OM([e,...t]),this._register(e.onDidChangeLogLevel(i=>this.setLevel(i)))}get onDidChangeLogLevel(){return this.logger.onDidChangeLogLevel}setLevel(e){this.logger.setLevel(e)}getLevel(){return this.logger.getLevel()}trace(e,...t){this.logger.trace(e,...t)}debug(e,...t){this.logger.debug(e,...t)}info(e,...t){this.logger.info(e,...t)}warn(e,...t){this.logger.warn(e,...t)}error(e,...t){this.logger.error(e,...t)}flush(){this.logger.flush()}},fS=class extends QJ{constructor(t,i,r){const s=r.remote.isRemote?"remoteexthost":t?"workerexthost":"exthost",n=r.remote.isRemote?h(2930,null):h(t?2931:2932,null);super(i.createLogger(s,{name:n}))}};fS=__decorate([__param(1,La),__param(2,zt)],fS);import{spawn as JJ}from"child_process";import{readFile as KJ}from"fs/promises";import{homedir as x9}from"os";function XJ(e){const t=new Map,r=e.replace(/\r\n?/g,`
`).split(`
`);for(let o of r){if(o=o.trim(),!o||o.startsWith("#"))continue;const[a,l]=s(o);a&&t.set(a,l)}return t;function s(o){o.startsWith("export ")&&(o=o.substring(7).trim());const a=n(o,d=>d==="="||d===":");if(a===-1)return[null,null];const l=o.substring(0,a).trim();let c=o.substring(a+1).trim();const u=n(c,d=>d==="#");if(u!==-1&&(c=c.substring(0,u).trim()),c.length>=2){const d=c[0],f=c[c.length-1];(d==='"'&&f==='"'||d==="'"&&f==="'"||d==="`"&&f==="`")&&(c=c.substring(1,c.length-1),d==='"'&&(c=c.replace(/\\n/g,`
`).replace(/\\r/g,"\r")))}return[l,c]}function n(o,a){let l=!1,c="";for(let u=0;u<o.length;u++){const d=o[u];if(l)d===c&&o[u-1]!=="\\"&&(l=!1);else if(d==='"'||d==="'"||d==="`")l=!0,c=d;else if(a(d))return u}return-1}}import{Transform as YJ}from"stream";var E9=class extends YJ{constructor(e){if(super(),typeof e=="number")this.splitter=e,this.spitterLen=1;else{const t=Buffer.isBuffer(e)?e:Buffer.from(e);this.splitter=t.length===1?t[0]:t,this.spitterLen=t.length}}_transform(e,t,i){this.buffer?this.buffer=Buffer.concat([this.buffer,e]):this.buffer=e;let r=0;for(;r<this.buffer.length;){const s=typeof this.splitter=="number"?this.buffer.indexOf(this.splitter,r):kE(this.buffer,this.splitter,r);if(s===-1)break;this.push(this.buffer.slice(r,s+this.spitterLen)),r=s+this.spitterLen}this.buffer=r===this.buffer.length?void 0:this.buffer.slice(r),i()}_flush(e){this.buffer&&this.push(this.buffer),e()}},pS=class extends Yg{constructor(t){super(t),this.nodeServers=new Map}_startMcp(t,i){i.type===1?this.startNodeMpc(t,i):super._startMcp(t,i)}$stopMcp(t){const i=this.nodeServers.get(t);i?(i.abortCtrl.abort(),this.nodeServers.delete(t)):super.$stopMcp(t)}$sendMessage(t,i){const r=this.nodeServers.get(t);r?r.child.stdin.write(i+`
`):super.$sendMessage(t,i)}async startNodeMpc(t,i){const r=a=>this._proxy.$onDidChangeState(t,{state:3,code:a.hasOwnProperty("code")?String(a.code):void 0,message:typeof a=="string"?a:a.message}),s={...process.env};if(i.envFile)try{for(const[a,l]of XJ(await KJ(i.envFile,"utf-8")))s[a]=l}catch(a){r(`Failed to read envFile '${i.envFile}': ${a.message}`);return}for(const[a,l]of Object.entries(i.env))s[a]=l===null?void 0:String(l);const n=new AbortController;let o;try{const a=x9(),l=i.cwd?b.revive(i.cwd).fsPath:a,{executable:c,args:u,shell:d}=await eK(ey(i.command,a),i.args.map(f=>ey(f,a)),l,s);this._proxy.$onDidPublishLog(t,ae.Debug,`Server command line: ${c} ${u.join(" ")}`),o=JJ(c,u,{stdio:"pipe",cwd:i.cwd?b.revive(i.cwd).fsPath:x9(),signal:n.signal,env:s,shell:d})}catch(a){r(a),n.abort();return}this._proxy.$onDidChangeState(t,{state:1}),o.stdout.pipe(new E9(`
`)).on("data",a=>this._proxy.$onDidReceiveMessage(t,a.toString())),o.stdin.on("error",r),o.stdout.on("error",r),o.stderr.pipe(new E9(`
`)).on("data",a=>this._proxy.$onDidPublishLog(t,ae.Warning,`[server stderr] ${a.toString().trimEnd()}`)),o.on("spawn",()=>this._proxy.$onDidChangeState(t,{state:2})),o.on("error",a=>{n.signal.aborted?this._proxy.$onDidChangeState(t,{state:0}):r(a)}),o.on("exit",a=>a===0||n.signal.aborted?this._proxy.$onDidChangeState(t,{state:0}):this._proxy.$onDidChangeState(t,{state:3,message:`Process exited with code ${a}`})),this.nodeServers.set(t,{abortCtrl:n,child:o})}};pS=__decorate([__param(0,Pe)],pS);var ZJ=/\.(bat|cmd)$/i,eK=async(e,t,i,r)=>{if(process.platform!=="win32")return{executable:e,args:t,shell:!1};const s=await Zg(e,i,void 0,r);if(s&&ZJ.test(s)){const n=o=>o.includes(" ")?`"${o}"`:o;return{executable:n(s),args:t.map(n),shell:!0}}return{executable:e,args:t,shell:!1}};Ne(Xs,XQ,0),Ne(La,qJ,1),Ne(ke,new ts(fS,[!1],!0)),Ne(Nd,w6,1),Ne(Uw,FJ,0),Ne(Tg,new ts(qw,[!1],!0)),Ne(Oy,Xy,0),Ne(Hy,rb,0),Ne(Ly,jy,0),Ne(Ks,qy,0),Ne(Ig,uS,0),Ne(Vl,GJ,0),Ne(Xg,pS,0);import{createRequire as tK}from"node:module";var C9=tK(import.meta.url);(function(){for(let t=0;t<process.execArgv.length;t++)process.execArgv[t]==="--inspect-port=0"&&(process.execArgv.splice(t,1),t--)})();var Hm=(0,kR.default)(process.argv.slice(2),{boolean:["transformURIs","skipWorkspaceStorageLock"],string:["useHostProxy"]});(function(){const e=C9("module"),t=e._load;e._load=function(i){if(i==="natives")throw new Error('Either the extension or an NPM dependency is using the [unsupported "natives" node module](https://go.microsoft.com/fwlink/?linkid=871887).');return t.apply(this,arguments)}})();var gS=process.exit.bind(process),iK=process.on.bind(process);function rK(e){process.exit=function(t){if(e)gS(t);else{const i=new Error("An extension called process.exit() and this was prevented.");console.warn(i.stack)}},process.crash=function(){const t=new Error("An extension called process.crash() and this was prevented.");console.warn(t.stack)},process.env.ELECTRON_RUN_AS_NODE="1",process.on=function(t,i){if(t==="uncaughtException"){const r=i;i=function(...s){try{return r.apply(void 0,s)}catch{}}}iK(t,i)}}var ps=function(e){gS()};function sK(){const e=fB(process.env);if(e.type===3)return new Promise((t,i)=>{const r=s=>{const n=s[0],o=new fo;n.on("message",a=>o.fire(z.wrap(a.data))),n.on("close",()=>{ps("renderer closed the MessagePort")}),n.start(),t({onMessage:o.event,send:a=>n.postMessage(a.buffer)})};process.parentPort.on("message",s=>r(s.ports))});if(e.type===2)return new Promise((t,i)=>{let r=null;const s=setTimeout(()=>{ps("VSCODE_EXTHOST_IPC_SOCKET timeout")},6e4),n=108e5,o=3e5,a=new bE(()=>ps("renderer disconnected for too long (1)"),n),l=new bE(()=>ps("renderer disconnected for too long (2)"),o);process.on("message",(u,d)=>{if(u&&u.type==="VSCODE_EXTHOST_IPC_SOCKET"){d.setNoDelay(!0);const f=z.wrap(Buffer.from(u.initialDataChunk,"base64"));let p;if(u.skipWebSocketFrames)p=new Cc(d,"extHost-socket");else{const g=z.wrap(Buffer.from(u.inflateBytes,"base64"));p=new KN(new Cc(d,"extHost-socket"),u.permessageDeflate,g,!1)}r?(a.cancel(),l.cancel(),r.beginAcceptReconnection(p,f),r.endAcceptReconnection(),r.sendResume()):(clearTimeout(s),r=new Xv({socket:p,initialChunk:f}),r.sendResume(),r.onDidDispose(()=>ps("renderer disconnected")),t(r),r.onSocketClose(()=>{a.schedule()}))}if(u&&u.type==="VSCODE_EXTHOST_IPC_REDUCE_GRACE_TIME"){if(l.isScheduled())return;a.isScheduled()&&l.schedule()}});const c={type:"VSCODE_EXTHOST_IPC_READY"};process.send?.(c)});{const t=e.pipeName;return new Promise((i,r)=>{const s=IR.createConnection(t,()=>{s.removeListener("error",r);const n=new Xv({socket:new Cc(s,"extHost-renderer")});n.sendResume(),i(n)});s.once("error",r),s.on("close",()=>{ps("renderer closed the socket")})})}}async function nK(){const e=await sK();return new class{constructor(){this._onMessage=new fo,this.onMessage=this._onMessage.event,this._terminating=!1,this._protocolListener=e.onMessage(t=>{kW(t,2)?(this._terminating=!0,this._protocolListener.dispose(),ps("received terminate message from renderer")):this._onMessage.fire(t)})}send(t){this._terminating||e.send(t)}async drain(){if(e.drain)return e.drain()}}}function oK(e){return new Promise(t=>{const i=e.onMessage(r=>{i.dispose();const s=JSON.parse(r.toString());if(s.parentPid){let n=0;setInterval(function(){try{process.kill(s.parentPid,0),n=0}catch(a){a&&a.code==="EPERM"?(n++,n>=3&&ps(`parent process ${s.parentPid} does not exist anymore (3 x EPERM): ${a.message} (code: ${a.code}) (errno: ${a.errno})`)):ps(`parent process ${s.parentPid} does not exist anymore: ${a.message} (code: ${a.code}) (errno: ${a.errno})`)}},1e3);let o;try{o=C9("native-watchdog"),o.start(s.parentPid)}catch(a){pt(a)}}e.send($5(0)),t({protocol:e,initData:s})});e.send($5(1))})}async function aK(){const e=[];process.on("unhandledRejection",(a,l)=>{e.push(l),setTimeout(()=>{const c=e.indexOf(l);c>=0&&l.catch(u=>{e.splice(c,1),Yi(u)||(console.warn(`rejected promise not handled within 1 second: ${u}`),u&&u.stack&&console.warn(`stack trace: ${u.stack}`),a&&pt(a))})},1e3)}),process.on("rejectionHandled",a=>{const l=e.indexOf(a);l>=0&&e.splice(l,1)}),process.on("uncaughtException",function(a){AR(a)||pt(a)}),Pt("code/extHost/willConnectToRenderer");const t=await nK();Pt("code/extHost/didConnectToRenderer");const i=await oK(t);Pt("code/extHost/didWaitForInitData");const{initData:r}=i;rK(!!r.environment.extensionTestsLocationURI),r.environment.useHostProxy=Hm.useHostProxy!==void 0?Hm.useHostProxy!=="false":void 0,r.environment.skipWorkspaceStorageLock=Z(Hm.skipWorkspaceStorageLock,!1);const s=new class{constructor(){this.pid=process.pid}exit(l){gS(l)}fsExists(l){return dt.exists(l)}fsRealpath(l){return $E(l)}};let n=null;r.remote.authority&&Hm.transformURIs&&(n=dB(r.remote.authority));const o=new cB(i.protocol,r,s,n);ps=a=>o.terminate(a)}aK().catch(e=>console.log(e));

//# sourceMappingURL=https://main.vscode-cdn.net/sourcemaps/e3faef6a7e3165b36b094b7db69ec05daa1ceb6f-73cd1db49b039ac35c8c6e524951c2382d96c5b3/core/vs/workbench/api/node/extensionHostProcess.js.map
